var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(t){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var e=document.createElement("div");return e.id="webgl-error-message",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.color="#000",e.style.padding="1.5em",e.style.width="400px",e.style.margin="5em auto 0",this.webgl||(e.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),e},addGetWebGLMessage:function(e){var t,i,n;e=e||{},t=void 0!==e.parent?e.parent:document.body,i=void 0!==e.id?e.id:"oldie",n=Detector.getWebGLErrorMessage(),n.id=i,t.appendChild(n)}};"object"==typeof module&&(module.exports=Detector),THREE.TrackballControls=function(e,t,i){function n(e){h.enabled!==!1&&(window.removeEventListener("keydown",n),f=h._state,h._state===h.STATE.NONE&&(e.keyCode!==h.keys[h.STATE.ROTATE]||h.noRotate?e.keyCode!==h.keys[h.STATE.ZOOM]||h.noZoom?e.keyCode!==h.keys[h.STATE.PAN]||h.noPan||(h._state=h.STATE.PAN):h._state=h.STATE.ZOOM:h._state=h.STATE.ROTATE))}function o(e){h.enabled!==!1&&(h._state=f,window.addEventListener("keydown",n,!1))}function r(e){h.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),h._state===h.STATE.NONE&&(h._state=e.button),h._state!==h.STATE.ROTATE||h.noRotate?h._state!==h.STATE.ZOOM||h.noZoom?h._state!==h.STATE.PAN||h.noPan||(h._panStart.copy(C(e.pageX,e.pageY)),h._panEnd.copy(h._panStart)):(h._zoomStart.copy(C(e.pageX,e.pageY)),h._zoomEnd.copy(h._zoomStart)):(h._rotateStart.copy(S(e.pageX,e.pageY)),h._rotateEnd.copy(h._rotateStart)),document.addEventListener("mousemove",s,!1),document.addEventListener("mouseup",a,!1),h.dispatchEvent(_))}function s(e){h.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),h._state!==h.STATE.ROTATE||h.noRotate?h._state!==h.STATE.ZOOM||h.noZoom?h._state!==h.STATE.PAN||h.noPan||h._panEnd.copy(C(e.pageX,e.pageY)):h._zoomEnd.copy(C(e.pageX,e.pageY)):h._rotateEnd.copy(S(e.pageX,e.pageY)))}function a(e){h.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),h._state=h.STATE.NONE,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",a),h.dispatchEvent(w))}function c(e){if(h.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),h._zoomStart.y=.005*t,h.dispatchEvent(_),h.dispatchEvent(w)}}function d(e){if(h.enabled!==!1){switch(e.touches.length){case 1:h._state=h.STATE.TOUCH_ROTATE,h._rotateStart.copy(S(e.touches[0].pageX,e.touches[0].pageY)),h._rotateEnd.copy(h._rotateStart);break;case 2:h._state=h.STATE.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;b=g=Math.sqrt(t*t+i*i);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;h._panStart.copy(C(n,o)),h._panEnd.copy(h._panStart);break;default:h._state=h.STATE.NONE}h.dispatchEvent(_)}}function l(e){if(h.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:h._rotateEnd.copy(S(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;b=Math.sqrt(t*t+i*i);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;h._panEnd.copy(C(n,o));break;default:h._state=h.STATE.NONE}}function p(e){if(h.enabled!==!1){switch(e.touches.length){case 1:h._rotateEnd.copy(S(e.touches[0].pageX,e.touches[0].pageY)),h._rotateStart.copy(h._rotateEnd);break;case 2:g=b=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;h._panEnd.copy(C(t,i)),h._panStart.copy(h._panEnd)}h._state=h.STATE.NONE,h.dispatchEvent(w)}}var h=this;this.STATE={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var u=1e-6,m=new THREE.Vector3;this._state=this.STATE.NONE;var f=this.STATE.NONE,v=new THREE.Vector3;this._rotateStart=new THREE.Vector3,this._rotateEnd=new THREE.Vector3,this._zoomStart=new THREE.Vector2,this._zoomEnd=new THREE.Vector2;var g=0,b=0;this._panStart=new THREE.Vector2,this._panEnd=new THREE.Vector2,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var y={type:"change"},_={type:"start"},w={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var C=function(){var e=new THREE.Vector2;return function(t,i){return e.set((t-h.screen.left)/h.screen.width,(i-h.screen.top)/h.screen.height),e}}(),S=function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3;return function(n,o){i.set((n-.5*h.screen.width-h.screen.left)/(.5*h.screen.width),(.5*h.screen.height+h.screen.top-o)/(.5*h.screen.height),0);var r=i.length();return h.noRoll?r<Math.SQRT1_2?i.z=Math.sqrt(1-r*r):i.z=.5/r:r>1?i.normalize():i.z=Math.sqrt(1-r*r),v.copy(h.object.position).sub(h.target),e.copy(h.object.up).setLength(i.y),e.add(t.copy(h.object.up).cross(v).setLength(i.x)),e.add(v.setLength(i.z)),e}}();this.rotateCamera=function(e,t){var n=new THREE.Vector3,o=new THREE.Quaternion;return function(e,t){var r;void 0===e&&(r=Math.acos(h._rotateStart.dot(h._rotateEnd)/h._rotateStart.length()/h._rotateEnd.length())),(r||void 0!==e)&&(void 0===e?(n.crossVectors(h._rotateStart,h._rotateEnd).normalize(),r*=h.rotateSpeed,o.setFromAxisAngle(n,-r)):o.copy(e),void 0!==t&&t!==!0||i.quaternion.multiplyQuaternions(o,i.quaternion),v.applyQuaternion(o),h.object.up.applyQuaternion(o),h._rotateEnd.applyQuaternion(o),h.staticMoving?h._rotateStart.copy(h._rotateEnd):(o.setFromAxisAngle(n,r*(h.dynamicDampingFactor-1)),h._rotateStart.applyQuaternion(o)))}}(),this.zoomCamera=function(e,t){if(h._state===h.STATE.TOUCH_ZOOM_PAN){var n;void 0!==e?n=e:(n=g/b,g=b),v.multiplyScalar(n),void 0!==t&&t!==!0||(i._zoomFactor*=n)}else{var n;n=void 0!==e?e:1+(h._zoomEnd.y-h._zoomStart.y)*h.zoomSpeed,void 0!==t&&t!==!0||(i._zoomFactor*=n),1!==n&&(v.multiplyScalar(n),h.staticMoving?h._zoomStart.copy(h._zoomEnd):h._zoomStart.y+=(h._zoomEnd.y-h._zoomStart.y)*this.dynamicDampingFactor)}},this.panCamera=function(e,t){var n=new THREE.Vector2,o=new THREE.Vector3,r=new THREE.Vector3;return function(e,t){void 0!==e?(n=e,void 0!==t&&t!==!0||i.mouseChange.add(e)):(n.copy(h._panEnd).sub(h._panStart),void 0!==t&&t!==!0||i.mouseChange.add(h._panEnd).sub(h._panStart)),n.lengthSq()&&(n.multiplyScalar(v.length()*h.panSpeed),r.copy(v).cross(h.object.up).setLength(n.x),r.add(o.copy(h.object.up).setLength(n.y)),h.object.position.add(r),h.target.add(r),h.staticMoving?h._panStart.copy(h._panEnd):h._panStart.add(n.subVectors(h._panEnd,h._panStart).multiplyScalar(h.dynamicDampingFactor)))}}(),this.checkDistances=function(){h.noZoom&&h.noPan||(v.lengthSq()>h.maxDistance*h.maxDistance&&h.object.position.addVectors(h.target,v.setLength(h.maxDistance)),v.lengthSq()<h.minDistance*h.minDistance&&h.object.position.addVectors(h.target,v.setLength(h.minDistance)))},this.update=function(e){v.subVectors(h.object.position,h.target),h.noRotate||(void 0!==e&&void 0!==e.quaternion?h.rotateCamera(e.quaternion,e.update):h.rotateCamera()),h.noZoom||(void 0!==e&&void 0!==e._zoomFactor?h.zoomCamera(e._zoomFactor,e.update):h.zoomCamera()),h.noPan||(void 0!==e&&void 0!==e.mouseChange?h.panCamera(e.mouseChange,e.update):h.panCamera()),h.object.position.addVectors(h.target,v),h.checkDistances(),h.object.lookAt(h.target),m.distanceToSquared(h.object.position)>u&&(h.dispatchEvent(y),m.copy(h.object.position))},this.reset=function(){h._state=h.STATE.NONE,f=h.STATE.NONE,h.target.copy(h.target0),h.object.position.copy(h.position0),h.object.up.copy(h.up0),v.subVectors(h.object.position,h.target),h.object.lookAt(h.target),h.dispatchEvent(y),m.copy(h.object.position)},this.domElement.addEventListener("contextmn",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",r,!1),this.domElement.addEventListener("mousewheel",c,!1),this.domElement.addEventListener("DOMMouseScroll",c,!1),this.domElement.addEventListener("touchstart",d,!1),this.domElement.addEventListener("touchend",p,!1),this.domElement.addEventListener("touchmove",l,!1),window.addEventListener("keydown",n,!1),window.addEventListener("keyup",o,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls,THREE.OrthographicTrackballControls=function(e,t,i){function n(e){h.enabled!==!1&&(window.removeEventListener("keydown",n),g=h._state,h._state===u.NONE&&(e.keyCode!==h.keys[u.ROTATE]||h.noRotate?e.keyCode!==h.keys[u.ZOOM]||h.noZoom?e.keyCode!==h.keys[u.PAN]||h.noPan||(h._state=u.PAN):h._state=u.ZOOM:h._state=u.ROTATE))}function o(e){h.enabled!==!1&&(h._state=g,window.addEventListener("keydown",n,!1))}function r(e){h.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),h._state===u.NONE&&(h._state=e.button),h._state!==u.ROTATE||h.noRotate?h._state!==u.ZOOM||h.noZoom?h._state!==u.PAN||h.noPan||(h._panStart.copy(k(e.pageX,e.pageY)),h._panEnd.copy(h._panStart)):(h._zoomStart.copy(k(e.pageX,e.pageY)),h._zoomEnd.copy(h._zoomStart)):(h._rotateStart.copy(E(e.pageX,e.pageY)),h._rotateEnd.copy(h._rotateStart)),document.addEventListener("mousemove",s,!1),document.addEventListener("mouseup",a,!1),h.dispatchEvent(S))}function s(e){h.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),h._state!==u.ROTATE||h.noRotate?h._state!==u.ZOOM||h.noZoom?h._state!==u.PAN||h.noPan||h._panEnd.copy(k(e.pageX,e.pageY)):h._zoomEnd.copy(k(e.pageX,e.pageY)):h._rotateEnd.copy(E(e.pageX,e.pageY)))}function a(e){h.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),h._state=u.NONE,document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",a),h.dispatchEvent(A))}function c(e){if(h.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),h._zoomStart.y=.01*t,h.dispatchEvent(S),h.dispatchEvent(A)}}function d(e){if(h.enabled!==!1){switch(e.touches.length){case 1:h._state=u.TOUCH_ROTATE,h._rotateStart.copy(E(e.touches[0].pageX,e.touches[0].pageY)),h._rotateEnd.copy(h._rotateStart);break;case 2:h._state=u.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;w=_=Math.sqrt(t*t+i*i);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;h._panStart.copy(k(n,o)),h._panEnd.copy(h._panStart);break;default:h._state=u.NONE}h.dispatchEvent(S)}}function l(e){if(h.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:h._rotateEnd.copy(E(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;w=Math.sqrt(t*t+i*i);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;h._panEnd.copy(k(n,o));break;default:h._state=u.NONE}}function p(e){if(h.enabled!==!1){switch(e.touches.length){case 1:h._rotateEnd.copy(E(e.touches[0].pageX,e.touches[0].pageY)),h._rotateStart.copy(h._rotateEnd);break;case 2:_=w=0;var t=(e.touches[0].pageX+e.touches[1].pageX)/2,i=(e.touches[0].pageY+e.touches[1].pageY)/2;h._panEnd.copy(k(t,i)),h._panStart.copy(h._panEnd)}h._state=u.NONE,h.dispatchEvent(A)}}var h=this,u={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=.5,this.zoomSpeed=1.2;var m=.01;this.zoomSpeed*=m,this.panSpeed=.03,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.keys=[65,83,68],this.target=new THREE.Vector3;var f=1e-6,v=new THREE.Vector3;this._state=u.NONE;var g=u.NONE,b=new THREE.Vector3;this._rotateStart=new THREE.Vector3,this._rotateEnd=new THREE.Vector3,this._zoomStart=new THREE.Vector2,this._zoomEnd=new THREE.Vector2;var y=1,_=0,w=0;this._panStart=new THREE.Vector2,this._panEnd=new THREE.Vector2,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom,this.center0=new THREE.Vector2((this.left0+this.right0)/2,(this.top0+this.bottom0)/2);var C={type:"change"},S={type:"start"},A={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom,this.center0.set((this.left0+this.right0)/2,(this.top0+this.bottom0)/2)},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var k=function(){var e=new THREE.Vector2;return function(t,i){return e.set((t-h.screen.left)/h.screen.width,(i-h.screen.top)/h.screen.height),e}}(),E=function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3;return function(n,o){i.set((n-.5*h.screen.width-h.screen.left)/(.5*h.screen.width),(.5*h.screen.height+h.screen.top-o)/(.5*h.screen.height),0);var r=i.length();return h.noRoll?r<Math.SQRT1_2?i.z=Math.sqrt(1-r*r):i.z=.5/r:r>1?i.normalize():i.z=Math.sqrt(1-r*r),b.copy(h.object.position).sub(h.target),e.copy(h.object.up).setLength(i.y),e.add(t.copy(h.object.up).cross(b).setLength(i.x)),e.add(b.setLength(i.z)),e}}();this.rotateCamera=function(e,t){var n=new THREE.Vector3,o=new THREE.Quaternion;return function(e,t){var r;void 0===e&&(r=Math.acos(h._rotateStart.dot(h._rotateEnd)/h._rotateStart.length()/h._rotateEnd.length())),(r||void 0!==e)&&(void 0===e?(n.crossVectors(h._rotateStart,h._rotateEnd).normalize(),r*=h.rotateSpeed,o.setFromAxisAngle(n,-r)):o.copy(e),void 0!==t&&t!==!0||i.quaternion.multiplyQuaternions(o,i.quaternion),b.applyQuaternion(o),h.object.up.applyQuaternion(o),h._rotateEnd.applyQuaternion(o),h.staticMoving?h._rotateStart.copy(h._rotateEnd):(o.setFromAxisAngle(n,r*(h.dynamicDampingFactor-1)),h._rotateStart.applyQuaternion(o)))}}(),this.zoomCamera=function(e,t){var n;h._state===u.TOUCH_ZOOM_PAN?void 0!==e?n=e:(n=_/w,_=w):n=void 0!==e?e:1+(h._zoomEnd.y-h._zoomStart.y)*h.zoomSpeed/m,void 0!==t&&t!==!0||(i._zoomFactor*=n),1!==n&&(y=n,h.object.left=y*h.left0+(1-y)*h.center0.x,h.object.right=y*h.right0+(1-y)*h.center0.x,h.object.top=y*h.top0+(1-y)*h.center0.y,h.object.bottom=y*h.bottom0+(1-y)*h.center0.y,h.staticMoving?h._zoomStart.copy(h._zoomEnd):h._zoomStart.y+=(h._zoomEnd.y-h._zoomStart.y)*this.dynamicDampingFactor)},this.panCamera=function(e,t){var n=new THREE.Vector2,o=new THREE.Vector3,r=new THREE.Vector3;return function(e,t){void 0!==e?(n=e,void 0!==t&&t!==!0||i.mouseChange.add(e)):(n.copy(h._panEnd).sub(h._panStart),void 0!==t&&t!==!0||i.mouseChange.add(h._panEnd).sub(h._panStart)),n.lengthSq()&&(n.multiplyScalar(b.length()*h.panSpeed),r.copy(b).cross(h.object.up).setLength(n.x),r.add(o.copy(h.object.up).setLength(n.y)),h.object.position.add(r),h.target.add(r),h.staticMoving?h._panStart.copy(h._panEnd):h._panStart.add(n.subVectors(h._panEnd,h._panStart).multiplyScalar(h.dynamicDampingFactor)))}}(),this.update=function(e){b.subVectors(h.object.position,h.target),h.noRotate||(void 0!==e&&void 0!==e.quaternion?h.rotateCamera(e.quaternion,e.update):h.rotateCamera()),h.noZoom||(void 0!==e&&void 0!==e._zoomFactor?h.zoomCamera(e._zoomFactor,e.update):h.zoomCamera(),h.object.updateProjectionMatrix()),h.noPan||(void 0!==e&&void 0!==e.mouseChange?h.panCamera(e.mouseChange,e.update):h.panCamera()),h.object.position.addVectors(h.target,b),h.object.lookAt(h.target),v.distanceToSquared(h.object.position)>f&&(h.dispatchEvent(C),v.copy(h.object.position))},this.reset=function(){h._state=u.NONE,g=u.NONE,h.target.copy(h.target0),h.object.position.copy(h.position0),h.object.up.copy(h.up0),b.subVectors(h.object.position,h.target),h.object.left=h.left0,h.object.right=h.right0,h.object.top=h.top0,h.object.bottom=h.bottom0,h.object.lookAt(h.target),h.dispatchEvent(C),v.copy(h.object.position)},this.domElement.addEventListener("contextmn",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",r,!1),this.domElement.addEventListener("mousewheel",c,!1),this.domElement.addEventListener("DOMMouseScroll",c,!1),this.domElement.addEventListener("touchstart",d,!1),this.domElement.addEventListener("touchend",p,!1),this.domElement.addEventListener("touchmove",l,!1),window.addEventListener("keydown",n,!1),window.addEventListener("keyup",o,!1),this.handleResize(),this.update()},THREE.OrthographicTrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrthographicTrackballControls.prototype.constructor=THREE.OrthographicTrackballControls,THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0},THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null},THREE.Projector=function(){function e(){if(c===y){var e=new THREE.RenderableObject;return b.push(e),y++,c++,e}return b[c++]}function t(){if(l===w){var e=new THREE.RenderableVertex;return _.push(e),w++,l++,e}return _[l++]}function i(){if(h===S){var e=new THREE.RenderableFace;return C.push(e),S++,h++,e}return C[h++]}function n(){if(m===k){var e=new THREE.RenderableLine;return A.push(e),k++,m++,e}return A[m++]}function o(){if(v===x){var e=new THREE.RenderableSprite;return E.push(e),x++,v++,e}return E[v++]}function r(e,t){return e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function s(e,t){var i=0,n=1,o=e.z+e.w,r=t.z+t.w,s=-e.z+e.w,a=-t.z+t.w;return o>=0&&r>=0&&s>=0&&a>=0||!(o<0&&r<0||s<0&&a<0)&&(o<0?i=Math.max(i,o/(o-r)):r<0&&(n=Math.min(n,o/(o-r))),s<0?i=Math.max(i,s/(s-a)):a<0&&(n=Math.min(n,s/(s-a))),!(n<i)&&(e.lerp(t,i),t.lerp(e,1-n),!0))}var a,c,d,l,p,h,u,m,f,v,g,b=[],y=0,_=[],w=0,C=[],S=0,A=[],k=0,E=[],x=0,R={objects:[],lights:[],elements:[]},T=new THREE.Vector3,H=new THREE.Vector3,D=new THREE.Vector3,I=new THREE.Vector3,O=new THREE.Vector4,M=new THREE.Box3(new THREE.Vector3((-1),(-1),(-1)),new THREE.Vector3(1,1,1)),L=new THREE.Box3,$=new Array(3),P=(new Array(4),new THREE.Matrix4),N=new THREE.Matrix4,z=new THREE.Matrix4,q=new THREE.Matrix3,F=new THREE.Frustum,j=new THREE.Vector4,U=new THREE.Vector4;this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pkRay=function(e,t){console.error("THREE.Projector: .pkRay() is now raycaster.setFromCamera().")};var B=function(){var e=[],o=[],r=null,s=null,a=new THREE.Matrix3,c=function(t){r=t,s=r.material,a.getNormalMatrix(r.matrixWorld),e.length=0,o.length=0},l=function(e){var t=e.position,i=e.positionWorld,n=e.positionScreen;i.copy(t).applyMatrix4(g),n.copy(i).applyMatrix4(N);var o=1/n.w;n.x*=o,n.y*=o,n.z*=o,e.visible=n.x>=-1&&n.x<=1&&n.y>=-1&&n.y<=1&&n.z>=-1&&n.z<=1},h=function(e,i,n){d=t(),d.position.set(e,i,n),l(d)},m=function(t,i,n){e.push(t,i,n)},f=function(e,t){o.push(e,t)},v=function(e,t,i){return e.visible===!0||t.visible===!0||i.visible===!0||($[0]=e.positionScreen,$[1]=t.positionScreen,$[2]=i.positionScreen,M.isIntersectionBox(L.setFromPoints($)))},b=function(e,t,i){return(i.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(i.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0},y=function(e,t){var i=_[e],o=_[t];u=n(),u.id=r.id,u.v1.copy(i),u.v2.copy(o),u.z=(i.positionScreen.z+o.positionScreen.z)/2,u.material=r.material,R.elements.push(u)},w=function(t,n,c){var d=_[t],l=_[n],h=_[c];if(v(d,l,h)!==!1&&(s.side===THREE.DoubleSide||b(d,l,h)===!0)){p=i(),p.id=r.id,p.v1.copy(d),p.v2.copy(l),p.v3.copy(h),p.z=(d.positionScreen.z+l.positionScreen.z+h.positionScreen.z)/3;for(var u=0;u<3;u++){var m=3*arguments[u],f=p.vertexNormalsModel[u];f.set(e[m],e[m+1],e[m+2]),f.applyMatrix3(a).normalize();var g=2*arguments[u],y=p.uvs[u];y.set(o[g],o[g+1])}p.vertexNormalsLength=3,p.material=r.material,R.elements.push(p)}};return{setObject:c,projectVertex:l,checkTriangleVisibility:v,checkBackfaceCulling:b,pushVertex:h,pushNormal:m,pushUv:f,pushLine:y,pushTriangle:w}},G=new B;this.projectScene=function(d,b,y,w){h=0,m=0,v=0,R.elements.length=0,d.autoUpdate===!0&&d.updateMatrixWorld(),void 0===b.parent&&b.updateMatrixWorld(),P.copy(b.matrixWorldInverse.getInverse(b.matrixWorld)),N.multiplyMatrices(b.projectionMatrix,P),F.setFromMatrix(N),c=0,R.objects.length=0,R.lights.length=0,d.traverseVisible(function(t){if(t instanceof THREE.Light)R.lights.push(t);else if(t instanceof THREE.Mesh||t instanceof THREE.Line||t instanceof THREE.Sprite){if(t.material.visible===!1)return;t.frustumCulled!==!1&&F.intersectsObject(t)!==!0||(a=e(),a.id=t.id,a.object=t,I.setFromMatrixPosition(t.matrixWorld),I.applyProjection(N),a.z=I.z,R.objects.push(a))}}),y===!0&&R.objects.sort(r);for(var C=0,S=R.objects.length;C<S;C++){var A=R.objects[C].object,k=A.geometry;if(G.setObject(A),g=A.matrixWorld,l=0,A instanceof THREE.Mesh){if(k instanceof THREE.BufferGeometry){var E=k.attributes,x=k.offsets;if(void 0===E.position)continue;for(var M=E.position.array,L=0,$=M.length;L<$;L+=3)G.pushVertex(M[L],M[L+1],M[L+2]);if(void 0!==E.normal)for(var B=E.normal.array,L=0,$=B.length;L<$;L+=3)G.pushNormal(B[L],B[L+1],B[L+2]);if(void 0!==E.uv)for(var V=E.uv.array,L=0,$=V.length;L<$;L+=2)G.pushUv(V[L],V[L+1]);if(void 0!==E.index){var W=E.index.array;if(x.length>0)for(var C=0;C<x.length;C++)for(var Y=x[C],X=Y.index,L=Y.start,$=Y.start+Y.count;L<$;L+=3)G.pushTriangle(W[L]+X,W[L+1]+X,W[L+2]+X);else for(var L=0,$=W.length;L<$;L+=3)G.pushTriangle(W[L],W[L+1],W[L+2])}else for(var L=0,$=M.length/3;L<$;L+=3)G.pushTriangle(L,L+1,L+2)}else if(k instanceof THREE.Geometry){var Z=k.vertices,K=k.faces,Q=k.faceVertexUvs[0];q.getNormalMatrix(g);for(var J=A.material instanceof THREE.MeshFaceMaterial,ee=J===!0?A.material:null,te=0,ie=Z.length;te<ie;te++){var ne=Z[te];G.pushVertex(ne.x,ne.y,ne.z)}for(var oe=0,re=K.length;oe<re;oe++){var se=K[oe],ae=J===!0?ee.materials[se.materialIndex]:A.material;if(void 0!==ae){var ce=ae.side,de=_[se.a],le=_[se.b],pe=_[se.c];if(ae.morphTargets===!0){var he=k.morphTargets,ue=A.morphTargetInfluences,me=de.position,fe=le.position,ve=pe.position;T.set(0,0,0),H.set(0,0,0),D.set(0,0,0);for(var ge=0,be=he.length;ge<be;ge++){var ye=ue[ge];if(0!==ye){var _e=he[ge].vertices;T.x+=(_e[se.a].x-me.x)*ye,T.y+=(_e[se.a].y-me.y)*ye,T.z+=(_e[se.a].z-me.z)*ye,H.x+=(_e[se.b].x-fe.x)*ye,H.y+=(_e[se.b].y-fe.y)*ye,H.z+=(_e[se.b].z-fe.z)*ye,D.x+=(_e[se.c].x-ve.x)*ye,D.y+=(_e[se.c].y-ve.y)*ye,D.z+=(_e[se.c].z-ve.z)*ye}}de.position.add(T),le.position.add(H),pe.position.add(D),G.projectVertex(de),G.projectVertex(le),G.projectVertex(pe)}if(G.checkTriangleVisibility(de,le,pe)!==!1){var we=G.checkBackfaceCulling(de,le,pe);if(ce!==THREE.DoubleSide){if(ce===THREE.FrontSide&&we===!1)continue;if(ce===THREE.BackSide&&we===!0)continue}p=i(),p.id=A.id,p.v1.copy(de),p.v2.copy(le),p.v3.copy(pe),p.normalModel.copy(se.normal),we!==!1||ce!==THREE.BackSide&&ce!==THREE.DoubleSide||p.normalModel.negate(),p.normalModel.applyMatrix3(q).normalize();for(var Ce=se.vertexNormals,Se=0,Ae=Math.min(Ce.length,3);Se<Ae;Se++){var ke=p.vertexNormalsModel[Se];ke.copy(Ce[Se]),we!==!1||ce!==THREE.BackSide&&ce!==THREE.DoubleSide||ke.negate(),ke.applyMatrix3(q).normalize()}p.vertexNormalsLength=Ce.length;var Ee=Q[oe];if(void 0!==Ee)for(var xe=0;xe<3;xe++)p.uvs[xe].copy(Ee[xe]);p.color=se.color,p.material=ae,p.z=(de.positionScreen.z+le.positionScreen.z+pe.positionScreen.z)/3,R.elements.push(p)}}}}}else if(A instanceof THREE.Line){if(k instanceof THREE.BufferGeometry){var E=k.attributes;if(void 0!==E.position){for(var M=E.position.array,L=0,$=M.length;L<$;L+=3)G.pushVertex(M[L],M[L+1],M[L+2]);if(void 0!==E.index)for(var W=E.index.array,L=0,$=W.length;L<$;L+=2)G.pushLine(W[L],W[L+1]);else for(var Re=A.mode===THREE.LinePieces?2:1,L=0,$=M.length/3-1;L<$;L+=Re)G.pushLine(L,L+1)}}else if(k instanceof THREE.Geometry){z.multiplyMatrices(N,g);var Z=A.geometry.vertices;if(0===Z.length)continue;de=t(),de.positionScreen.copy(Z[0]).applyMatrix4(z);for(var Re=A.mode===THREE.LinePieces?2:1,te=1,ie=Z.length;te<ie;te++)de=t(),de.positionScreen.copy(Z[te]).applyMatrix4(z),(te+1)%Re>0||(le=_[l-2],j.copy(de.positionScreen),U.copy(le.positionScreen),s(j,U)===!0&&(j.multiplyScalar(1/j.w),U.multiplyScalar(1/U.w),u=n(),u.id=A.id,u.v1.positionScreen.copy(j),u.v2.positionScreen.copy(U),u.z=Math.max(j.z,U.z),u.material=A.material,A.material.vertexColors===THREE.VertexColors&&(u.vertexColors[0].copy(A.geometry.colors[te]),u.vertexColors[1].copy(A.geometry.colors[te-1])),R.elements.push(u)))}}else if(A instanceof THREE.Sprite){O.set(g.elements[12],g.elements[13],g.elements[14],1),O.applyMatrix4(N);var Te=1/O.w;O.z*=Te,O.z>=-1&&O.z<=1&&(f=o(),f.id=A.id,f.x=O.x*Te,f.y=O.y*Te,f.z=O.z,f.object=A,f.rotation=A.rotation,f.scale.x=A.scale.x*Math.abs(f.x-(O.x+b.projectionMatrix.elements[0])/(O.w+b.projectionMatrix.elements[12])),f.scale.y=A.scale.y*Math.abs(f.y-(O.y+b.projectionMatrix.elements[5])/(O.w+b.projectionMatrix.elements[13])),f.material=A.material,R.elements.push(f))}}return w===!0&&R.elements.sort(r),R}},!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.MMTF=e.MMTF||{})}(this,function(e){"use strict";function t(e,t,i){for(var n=(e.byteLength,0),o=i.length;o>n;n++){var r=i.charCodeAt(n);if(128>r)e.setUint8(t++,r>>>0&127|0);else if(2048>r)e.setUint8(t++,r>>>6&31|192),e.setUint8(t++,r>>>0&63|128);else if(65536>r)e.setUint8(t++,r>>>12&15|224),e.setUint8(t++,r>>>6&63|128),e.setUint8(t++,r>>>0&63|128);else{if(!(1114112>r))throw new Error("bad codepoint "+r);e.setUint8(t++,r>>>18&7|240),e.setUint8(t++,r>>>12&63|128),e.setUint8(t++,r>>>6&63|128),e.setUint8(t++,r>>>0&63|128)}}}function i(e){for(var t=0,i=0,n=e.length;n>i;i++){var o=e.charCodeAt(i);if(128>o)t+=1;else if(2048>o)t+=2;else if(65536>o)t+=3;else{if(!(1114112>o))throw new Error("bad codepoint "+o);t+=4}}return t}function n(e,o,r){var s=typeof e;if("string"===s){var a=i(e);if(32>a)return o.setUint8(r,160|a),t(o,r+1,e),1+a;if(256>a)return o.setUint8(r,217),o.setUint8(r+1,a),t(o,r+2,e),2+a;if(65536>a)return o.setUint8(r,218),o.setUint16(r+1,a),t(o,r+3,e),3+a;if(4294967296>a)return o.setUint8(r,219),o.setUint32(r+1,a),t(o,r+5,e),5+a}if(e instanceof Uint8Array){var a=e.byteLength,c=new Uint8Array(o.buffer);if(256>a)return o.setUint8(r,196),o.setUint8(r+1,a),c.set(e,r+2),2+a;if(65536>a)return o.setUint8(r,197),o.setUint16(r+1,a),c.set(e,r+3),3+a;if(4294967296>a)return o.setUint8(r,198),o.setUint32(r+1,a),c.set(e,r+5),5+a}if("number"===s){if(!isFinite(e))throw new Error("Number not finite: "+e);if(Math.floor(e)!==e)return o.setUint8(r,203),o.setFloat64(r+1,e),9;if(e>=0){if(128>e)return o.setUint8(r,e),1;if(256>e)return o.setUint8(r,204),o.setUint8(r+1,e),2;if(65536>e)return o.setUint8(r,205),o.setUint16(r+1,e),3;if(4294967296>e)return o.setUint8(r,206),o.setUint32(r+1,e),5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return o.setInt8(r,e),1;if(e>=-128)return o.setUint8(r,208),o.setInt8(r+1,e),2;if(e>=-32768)return o.setUint8(r,209),o.setInt16(r+1,e),3;if(e>=-2147483648)return o.setUint8(r,210),o.setInt32(r+1,e),5;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(null===e)return o.setUint8(r,192),1;if("boolean"===s)return o.setUint8(r,e?195:194),1;if("object"===s){var a,d=0,l=Array.isArray(e);if(l)a=e.length;else{var p=Object.keys(e);a=p.length}var d;if(16>a?(o.setUint8(r,a|(l?144:128)),d=1):65536>a?(o.setUint8(r,l?220:222),o.setUint16(r+1,a),d=3):4294967296>a&&(o.setUint8(r,l?221:223),o.setUint32(r+1,a),d=5),l)for(var h=0;a>h;h++)d+=n(e[h],o,r+d);else for(var h=0;a>h;h++){var u=p[h];d+=n(u,o,r+d),d+=n(e[u],o,r+d)}return d}throw new Error("Unknown type "+s)}function o(e){var t=typeof e;if("string"===t){var n=i(e);if(32>n)return 1+n;if(256>n)return 2+n;if(65536>n)return 3+n;if(4294967296>n)return 5+n}if(e instanceof Uint8Array){var n=e.byteLength;if(256>n)return 2+n;if(65536>n)return 3+n;if(4294967296>n)return 5+n}if("number"===t){if(Math.floor(e)!==e)return 9;if(e>=0){if(128>e)return 1;if(256>e)return 2;if(65536>e)return 3;if(4294967296>e)return 5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if("boolean"===t||null===e)return 1;if("object"===t){var n,r=0;if(Array.isArray(e)){n=e.length;for(var s=0;n>s;s++)r+=o(e[s])}else{var a=Object.keys(e);n=a.length;for(var s=0;n>s;s++){var c=a[s];r+=o(c)+o(e[c])}}if(16>n)return 1+r;if(65536>n)return 3+r;if(4294967296>n)return 5+r;throw new Error("Array or object too long 0x"+n.toString(16))}throw new Error("Unknown type "+t)}function r(e){var t=new ArrayBuffer(o(e)),i=new DataView(t);return n(e,i,0),new Uint8Array(t)}function s(e,t,i){return t?new e(t.buffer,t.byteOffset,t.byteLength/(i||1)):void 0}function a(e){return s(DataView,e)}function c(e){return s(Uint8Array,e)}function d(e){return s(Int8Array,e)}function l(e){return s(Int32Array,e,4)}function p(e){return s(Float32Array,e,4);
}function h(e,t){var i=e.length/2;t||(t=new Int16Array(i));for(var n=0,o=0;i>n;++n,o+=2)t[n]=e[o]<<8^e[o+1]<<0;return t}function u(e,t){var i=e.length;t||(t=new Uint8Array(2*i));for(var n=a(t),o=0;i>o;++o)n.setInt16(2*o,e[o]);return c(t)}function m(e,t){var i=e.length/4;t||(t=new Int32Array(i));for(var n=0,o=0;i>n;++n,o+=4)t[n]=e[o]<<24^e[o+1]<<16^e[o+2]<<8^e[o+3]<<0;return t}function f(e,t){var i=e.length;t||(t=new Uint8Array(4*i));for(var n=a(t),o=0;i>o;++o)n.setInt32(4*o,e[o]);return c(t)}function v(e,t){var i=e.length;t||(t=new Float32Array(i/4));for(var n=a(t),o=a(e),r=0,s=0,c=i/4;c>r;++r,s+=4)n.setFloat32(s,o.getFloat32(s),!0);return t}function g(e,t,i){var n=e.length,o=1/t;i||(i=new Float32Array(n));for(var r=0;n>r;++r)i[r]=e[r]*o;return i}function b(e,t,i){var n=e.length;i||(i=new Int32Array(n));for(var o=0;n>o;++o)i[o]=Math.round(e[o]*t);return i}function y(e,t){var i,n;if(!t){var o=0;for(i=0,n=e.length;n>i;i+=2)o+=e[i+1];t=new e.constructor(o)}var r=0;for(i=0,n=e.length;n>i;i+=2)for(var s=e[i],a=e[i+1],c=0;a>c;++c)t[r]=s,++r;return t}function _(e){if(0===e.length)return new Int32Array;var t,i,n=2;for(t=1,i=e.length;i>t;++t)e[t-1]!==e[t]&&(n+=2);var o=new Int32Array(n),r=0,s=1;for(t=1,i=e.length;i>t;++t)e[t-1]!==e[t]?(o[r]=e[t-1],o[r+1]=s,s=1,r+=2):++s;return o[r]=e[e.length-1],o[r+1]=s,o}function w(e,t){var i=e.length;t||(t=new e.constructor(i)),i&&(t[0]=e[0]);for(var n=1;i>n;++n)t[n]=e[n]+t[n-1];return t}function C(e,t){var i=e.length;t||(t=new e.constructor(i)),t[0]=e[0];for(var n=1;i>n;++n)t[n]=e[n]-e[n-1];return t}function S(e,t){var i,n,o=e instanceof Int8Array?127:32767,r=-o-1,s=e.length;if(!t){var a=0;for(i=0;s>i;++i)e[i]<o&&e[i]>r&&++a;t=new Int32Array(a)}for(i=0,n=0;s>i;){for(var c=0;e[i]===o||e[i]===r;)c+=e[i],++i;c+=e[i],++i,t[n]=c,++n}return t}function A(e,t){var i,n=t?127:32767,o=-n-1,r=e.length,s=0;for(i=0;r>i;++i){var a=e[i];0===a?++s:a>0?(s+=Math.ceil(a/n),a%n===0&&(s+=1)):(s+=Math.ceil(a/o),a%o===0&&(s+=1))}var c=t?new Int8Array(s):new Int16Array(s),d=0;for(i=0;r>i;++i){var a=e[i];if(a>=0)for(;a>=n;)c[d]=n,++d,a-=n;else for(;o>=a;)c[d]=o,++d,a-=o;c[d]=a,++d}return c}function k(e,t){return w(y(e),t)}function E(e){return _(C(e))}function x(e,t,i){return g(y(e,l(i)),t,i)}function R(e,t){return _(b(e,t))}function T(e,t,i){return g(w(e,l(i)),t,i)}function H(e,t,i){return C(b(e,t),i)}function D(e,t,i){return g(S(e,l(i)),t,i)}function I(e,t,i){var n=S(e,l(i));return T(n,t,p(n))}function O(e,t,i){return A(H(e,t),i)}function M(e){var t=a(e),i=t.getInt32(0),n=t.getInt32(4),o=e.subarray(8,12),e=e.subarray(12);return[i,e,n,o]}function L(e,t,i,n){var o=new ArrayBuffer(12+n.byteLength),r=new Uint8Array(o),s=new DataView(o);return s.setInt32(0,e),s.setInt32(4,t),i&&r.set(i,8),r.set(n,12),r}function $(e){var t=e.length,i=c(e);return L(2,t,void 0,i)}function P(e){var t=e.length,i=f(e);return L(4,t,void 0,i)}function N(e,t){var i=e.length/t,n=f([t]),o=c(e);return L(5,i,n,o)}function z(e){var t=e.length,i=f(_(e));return L(6,t,void 0,i)}function q(e){var t=e.length,i=f(E(e));return L(8,t,void 0,i)}function F(e,t){var i=e.length,n=f([t]),o=f(R(e,t));return L(9,i,n,o)}function j(e,t){var i=e.length,n=f([t]),o=u(O(e,t));return L(10,i,n,o)}function U(e){var t={};return ee.forEach(function(i){void 0!==e[i]&&(t[i]=e[i])}),e.bondAtomList&&(t.bondAtomList=P(e.bondAtomList)),e.bondOrderList&&(t.bondOrderList=$(e.bondOrderList)),t.xCoordList=j(e.xCoordList,1e3),t.yCoordList=j(e.yCoordList,1e3),t.zCoordList=j(e.zCoordList,1e3),e.bFactorList&&(t.bFactorList=j(e.bFactorList,100)),e.atomIdList&&(t.atomIdList=q(e.atomIdList)),e.altLocList&&(t.altLocList=z(e.altLocList)),e.occupancyList&&(t.occupancyList=F(e.occupancyList,100)),t.groupIdList=q(e.groupIdList),t.groupTypeList=P(e.groupTypeList),e.secStructList&&(t.secStructList=$(e.secStructList)),e.insCodeList&&(t.insCodeList=z(e.insCodeList)),e.sequenceIndexList&&(t.sequenceIndexList=q(e.sequenceIndexList)),t.chainIdList=N(e.chainIdList,4),e.chainNameList&&(t.chainNameList=N(e.chainNameList,4)),t}function B(e){function t(e){for(var t={},i=0;e>i;i++){var n=r();t[n]=r()}return t}function i(t){var i=e.subarray(s,s+t);return s+=t,i}function n(t){var i=e.subarray(s,s+t);s+=t;var n=65535;if(t>n){for(var o=[],r=0;r<i.length;r+=n)o.push(String.fromCharCode.apply(null,i.subarray(r,r+n)));return o.join("")}return String.fromCharCode.apply(null,i)}function o(e){for(var t=new Array(e),i=0;e>i;i++)t[i]=r();return t}function r(){var r,c,d=e[s];if(0===(128&d))return s++,d;if(128===(240&d))return c=15&d,s++,t(c);if(144===(240&d))return c=15&d,s++,o(c);if(160===(224&d))return c=31&d,s++,n(c);if(224===(224&d))return r=a.getInt8(s),s++,r;switch(d){case 192:return s++,null;case 194:return s++,!1;case 195:return s++,!0;case 196:return c=a.getUint8(s+1),s+=2,i(c);case 197:return c=a.getUint16(s+1),s+=3,i(c);case 198:return c=a.getUint32(s+1),s+=5,i(c);case 202:return r=a.getFloat32(s+1),s+=5,r;case 203:return r=a.getFloat64(s+1),s+=9,r;case 204:return r=e[s+1],s+=2,r;case 205:return r=a.getUint16(s+1),s+=3,r;case 206:return r=a.getUint32(s+1),s+=5,r;case 208:return r=a.getInt8(s+1),s+=2,r;case 209:return r=a.getInt16(s+1),s+=3,r;case 210:return r=a.getInt32(s+1),s+=5,r;case 217:return c=a.getUint8(s+1),s+=2,n(c);case 218:return c=a.getUint16(s+1),s+=3,n(c);case 219:return c=a.getUint32(s+1),s+=5,n(c);case 220:return c=a.getUint16(s+1),s+=3,o(c);case 221:return c=a.getUint32(s+1),s+=5,o(c);case 222:return c=a.getUint16(s+1),s+=3,t(c);case 223:return c=a.getUint32(s+1),s+=5,t(c)}throw new Error("Unknown type 0x"+d.toString(16))}var s=0,a=new DataView(e.buffer);return r()}function G(e,t,i,n){switch(e){case 1:return v(t);case 2:return d(t);case 3:return h(t);case 4:return m(t);case 5:return c(t);case 6:return y(m(t),new Uint8Array(i));case 7:return y(m(t));case 8:return k(m(t));case 9:return x(m(t),m(n)[0]);case 10:return I(h(t),m(n)[0]);case 11:return g(h(t),m(n)[0]);case 12:return D(h(t),m(n)[0]);case 13:return D(d(t),m(n)[0]);case 14:return S(h(t));case 15:return S(d(t))}}function V(e,t){t=t||{};var i=t.ignoreFields,n={};return ie.forEach(function(t){var o=!!i&&-1!==i.indexOf(t),r=e[t];o||void 0===r||(r instanceof Uint8Array?n[t]=G.apply(null,M(r)):n[t]=r)}),n}function W(e){return String.fromCharCode.apply(null,e).replace(/\0/g,"")}function Y(e,t,i){i=i||{};var n,o,r,s,a,c,d=i.firstModelOnly,l=t.onModel,p=t.onChain,h=t.onGroup,u=t.onAtom,m=t.onBond,f=0,v=0,g=0,b=0,y=0,_=-1,w=e.chainNameList,C=e.secStructList,S=e.insCodeList,A=e.sequenceIndexList,k=e.atomIdList,E=e.bFactorList,x=e.altLocList,R=e.occupancyList,T=e.bondAtomList,H=e.bondOrderList;for(n=0,o=e.chainsPerModel.length;o>n&&!(d&&f>0);++n){var D=e.chainsPerModel[f];for(l&&l({chainCount:D,modelIndex:f}),r=0;D>r;++r){var I=e.groupsPerChain[v];if(p){var O=W(e.chainIdList.subarray(4*v,4*v+4)),M=null;w&&(M=W(w.subarray(4*v,4*v+4))),p({groupCount:I,chainIndex:v,modelIndex:f,chainId:O,chainName:M})}for(s=0;I>s;++s){var L=e.groupList[e.groupTypeList[g]],$=L.atomNameList.length;if(h){var P=null;C&&(P=C[g]);var N=null;e.insCodeList&&(N=String.fromCharCode(S[g]));var z=null;A&&(z=A[g]),h({atomCount:$,groupIndex:g,chainIndex:v,modelIndex:f,groupId:e.groupIdList[g],groupType:e.groupTypeList[g],groupName:L.groupName,singleLetterCode:L.singleLetterCode,chemCompType:L.chemCompType,secStruct:P,insCode:N,sequenceIndex:z})}for(a=0;$>a;++a){if(u){var q=null;k&&(q=k[b]);var F=null;E&&(F=E[b]);var j=null;x&&(j=String.fromCharCode(x[b]));var U=null;R&&(U=R[b]),u({atomIndex:b,groupIndex:g,chainIndex:v,modelIndex:f,atomId:q,element:L.elementList[a],atomName:L.atomNameList[a],formalCharge:L.formalChargeList[a],xCoord:e.xCoordList[b],yCoord:e.yCoordList[b],zCoord:e.zCoordList[b],bFactor:F,altLoc:j,occupancy:U})}b+=1}if(m){var B=L.bondAtomList;for(a=0,c=L.bondOrderList.length;c>a;++a)m({atomIndex1:b-$+B[2*a],atomIndex2:b-$+B[2*a+1],bondOrder:L.bondOrderList[a]})}g+=1}v+=1}if(y=_+1,_=b-1,m&&T)for(a=0,c=T.length;c>a;a+=2){var G=T[a],V=T[a+1];(G>=y&&_>=G||V>=y&&_>=V)&&m({atomIndex1:G,atomIndex2:V,bondOrder:H?H[a/2]:null})}f+=1}}function X(e){return r(U(e))}function Z(e,t){e instanceof ArrayBuffer&&(e=new Uint8Array(e));var i;return i=e instanceof Uint8Array?B(e):e,V(i,t)}function K(e,t,i,n){function o(){try{var e=Z(r.response);i(e)}catch(t){n(t)}}var r=new XMLHttpRequest;r.addEventListener("load",o,!0),r.addEventListener("error",n,!0),r.responseType="arraybuffer",r.open("GET",t+e.toUpperCase()),r.send()}function Q(e,t,i){K(e,re,t,i)}function J(e,t,i){K(e,se,t,i)}var ee=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"],te=["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"],ie=ee.concat(te),ne="v1.0.1",oe="//mmtf.rcsb.org/v1.0/",re=oe+"full/",se=oe+"reduced/";e.encode=X,e.decode=Z,e.traverse=Y,e.fetch=Q,e.fetchReduced=J,e.version=ne,e.fetchUrl=re,e.fetchReducedUrl=se,e.encodeMsgpack=r,e.encodeMmtf=U,e.decodeMsgpack=B,e.decodeMmtf=V});var $NGL_shaderTextHash={};if($NGL_shaderTextHash["SphereImpostor.frag"]=["#define STANDARD","#define IMPOSTOR","","uniform vec3 diffuse;","uniform vec3 emissive;","uniform float roughness;","uniform float metalness;","uniform float opacity;","uniform float nearClip;","uniform mat4 projectionMatrix;","uniform float ortho;","","varying float vRadius;","varying float vRadiusSq;","varying vec3 vPoint;","varying vec3 vPointViewPosition;","","#ifdef PICKING","    uniform float objectId;","    varying vec3 vPickingColor;","#else","    #include common","    #include color_pars_fragment","    #include fog_pars_fragment","    #include bsdfs","    #include lights_pars_begin","    #include lights_physical_pars_fragment","#endif","","bool flag2 = false;","bool interior = false;","vec3 cameraPos;","vec3 cameraNormal;","","// Calculate depth based on the given camera position.","float calcDepth( in vec3 cameraPos ){","    vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;","    return 0.5 + 0.5 * clipZW.x / clipZW.y;","}","","float calcClip( vec3 cameraPos ){","    return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, nearClip - 0.5 ) );","}","","bool Impostor( out vec3 cameraPos, out vec3 cameraNormal ){","","    vec3 cameraSpherePos = -vPointViewPosition;","    cameraSpherePos.z += vRadius;","","    vec3 rayOrigin = mix( vec3( 0.0, 0.0, 0.0 ), vPoint, ortho );","    vec3 rayDirection = mix( normalize( vPoint ), vec3( 0.0, 0.0, 1.0 ), ortho );","    vec3 cameraSphereDir = mix( cameraSpherePos, rayOrigin - cameraSpherePos, ortho );","","    float B = dot( rayDirection, cameraSphereDir );","    float det = B * B + vRadiusSq - dot( cameraSphereDir, cameraSphereDir );","","    if( det < 0.0 ){","        discard;","        return false;","    }","        float sqrtDet = sqrt( det );","        float posT = mix( B + sqrtDet, B + sqrtDet, ortho );","        float negT = mix( B - sqrtDet, sqrtDet - B, ortho );","","        cameraPos = rayDirection * negT + rayOrigin;","","        #ifdef NEAR_CLIP","if( calcDepth( cameraPos ) <= 0.0 ){","    cameraPos = rayDirection * posT + rayOrigin;","    interior = true;","    return false;","}else if( calcClip( cameraPos ) > 0.0 ){","    cameraPos = rayDirection * posT + rayOrigin;","    interior = true;","    flag2 = true;","    return false;","}else{","    cameraNormal = normalize( cameraPos - cameraSpherePos );","}","        #else","if( calcDepth( cameraPos ) <= 0.0 ){","    cameraPos = rayDirection * posT + rayOrigin;","    interior = true;","    return false;","}else{","    cameraNormal = normalize( cameraPos - cameraSpherePos );","}","        #endif","","        cameraNormal = normalize( cameraPos - cameraSpherePos );","        cameraNormal *= float(!interior) * 2.0 - 1.0;","         return !interior;","","}","","void main(void){","","    bool flag = Impostor( cameraPos, cameraNormal );","","    #ifdef NEAR_CLIP","        if( calcClip( cameraPos ) > 0.0 )","            discard;","    #endif","","    // FIXME not compatible with custom clipping plane","    //Set the depth based on the new cameraPos.","    gl_FragDepthEXT = calcDepth( cameraPos );","    if( !flag ){","","        // clamp to near clipping plane and add a tiny value to","        // make spheres with a greater radius occlude smaller ones","        #ifdef NEAR_CLIP","if( flag2 ){","    gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( nearClip - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );","}else if( gl_FragDepthEXT >= 0.0 ){","    gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );","}","        #else","if( gl_FragDepthEXT >= 0.0 ){","    gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );","}","        #endif","","    }","","    // bugfix (mac only?)","    if (gl_FragDepthEXT < 0.0)","        discard;","    if (gl_FragDepthEXT > 1.0)","        discard;","","    #ifdef PICKING","","        gl_FragColor = vec4( vPickingColor, objectId );","","    #else","","        vec3 vNormal = cameraNormal;","        vec3 vViewPosition = -cameraPos;","","        vec4 diffuseColor = vec4( diffuse, opacity );","        ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","        vec3 totalEmissiveLight = emissive;","","        #include color_fragment","        #include roughnessmap_fragment","        #include metalnessmap_fragment","","        // don't use include normal_fragment","        vec3 normal = normalize( vNormal );","","        #include lights_physical_fragment","        //include lights_template","        #include lights_fragment_begin","        #include lights_fragment_end","","        vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;","","        gl_FragColor = vec4( outgoingLight, diffuseColor.a );","        //gl_FragColor = vec4( reflectedLight.directSpecular, diffuseColor.a );","","        #include premultiplied_alpha_fragment","        #include tonemapping_fragment","        #include encodings_fragment","        #include fog_fragment","","    #endif","","}"].join("\n"),$NGL_shaderTextHash["SphereImpostor.vert"]=["uniform mat4 projectionMatrixInverse;","uniform float nearClip;","","varying float vRadius;","varying float vRadiusSq;","varying vec3 vPoint;","varying vec3 vPointViewPosition;","varying float fogDepth;","","attribute vec2 mapping;","//attribute vec3 position;","attribute float radius;","","#ifdef PICKING","    #include unpack_clr","    attribute float primitiveId;","    varying vec3 vPickingColor;","#else","    #include color_pars_vertex","#endif","","//include matrix_scale","float matrixScale( in mat4 m ){","    vec4 r = m[ 0 ];","    return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );","}","","const mat4 D = mat4(","    1.0, 0.0, 0.0, 0.0,","    0.0, 1.0, 0.0, 0.0,","    0.0, 0.0, 1.0, 0.0,","    0.0, 0.0, 0.0, -1.0",");","","mat4 transpose( in mat4 inMatrix ) {","    vec4 i0 = inMatrix[0];","    vec4 i1 = inMatrix[1];","    vec4 i2 = inMatrix[2];","    vec4 i3 = inMatrix[3];","","    mat4 outMatrix = mat4(","        vec4(i0.x, i1.x, i2.x, i3.x),","        vec4(i0.y, i1.y, i2.y, i3.y),","        vec4(i0.z, i1.z, i2.z, i3.z),","        vec4(i0.w, i1.w, i2.w, i3.w)","    );","    return outMatrix;","}","","//------------------------------------------------------------------------------","// Compute point size and center using the technique described in:","// 'GPU-Based Ray-Casting of Quadratic Surfaces'","// by Christian Sigg, Tim Weyrich, Mario Botsch, Markus Gross.","//","// Code based on","/*=========================================================================",""," Program:   Visualization Toolkit"," Module:    Quadrics_fs.glsl and Quadrics_vs.glsl",""," Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen"," All rights reserved."," See Copyright.txt or http://www.kitware.com/Copyright.htm for details.",""," This software is distributed WITHOUT ANY WARRANTY; without even"," the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR"," PURPOSE.  See the above copyright notice for more information.",""," =========================================================================*/","","// .NAME Quadrics_fs.glsl and Quadrics_vs.glsl","// .SECTION Thanks","// <verbatim>","//","//  This file is part of the PointSprites plugin developed and contributed by","//","//  Copyright (c) CSCS - Swiss National Supercomputing Centre","//                EDF - Electricite de France","//","//  John Biddiscombe, Ugo Varetto (CSCS)","//  Stephane Ploix (EDF)","//","// </verbatim>","//","// Contributions by Alexander Rose","// - ported to WebGL","// - adapted to work with quads","void ComputePointSizeAndPositionInClipCoordSphere(){","","    vec2 xbc;","    vec2 ybc;","","    mat4 T = mat4(","        radius, 0.0, 0.0, 0.0,","        0.0, radius, 0.0, 0.0,","        0.0, 0.0, radius, 0.0,","        position.x, position.y, position.z, 1.0","    );","","    mat4 R = transpose( projectionMatrix * modelViewMatrix * T );","    float A = dot( R[ 3 ], D * R[ 3 ] );","    float B = -2.0 * dot( R[ 0 ], D * R[ 3 ] );","    float C = dot( R[ 0 ], D * R[ 0 ] );","    xbc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    xbc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    float sx = abs( xbc[ 0 ] - xbc[ 1 ] ) * 0.5;","","    A = dot( R[ 3 ], D * R[ 3 ] );","    B = -2.0 * dot( R[ 1 ], D * R[ 3 ] );","    C = dot( R[ 1 ], D * R[ 1 ] );","    ybc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    ybc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    float sy = abs( ybc[ 0 ] - ybc[ 1 ]  ) * 0.5;","","    gl_Position.xy = vec2( 0.5 * ( xbc.x + xbc.y ), 0.5 * ( ybc.x + ybc.y ) );","    gl_Position.xy -= mapping * vec2( sx, sy );","    gl_Position.xy *= gl_Position.w;","","}","","void main(void){","","    #ifdef PICKING","        vPickingColor = unpackColor( primitiveId );","    #else","        #include color_vertex","    #endif","","    vRadius = radius * matrixScale( modelViewMatrix );","","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    // avoid clipping, added again in fragment shader","    mvPosition.z -= vRadius;","","    gl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );","    ComputePointSizeAndPositionInClipCoordSphere();","","","    vRadiusSq = vRadius * vRadius;","    vec4 vPoint4 = projectionMatrixInverse * gl_Position;","    vPoint = vPoint4.xyz / vPoint4.w;","    vPointViewPosition = -mvPosition.xyz / mvPosition.w;","","}"].join("\n"),$NGL_shaderTextHash["CylinderImpostor.frag"]=["#define STANDARD","#define IMPOSTOR","","// Open-Source PyMOL is Copyright (C) Schrodinger, LLC.","//","//  All Rights Reserved","//","//  Permission to use, copy, modify, distribute, and distribute modified","//  versions of this software and its built-in documentation for any","//  purpose and without fee is hereby granted, provided that the above","//  copyright notice appears in all copies and that both the copyright","//  notice and this permission notice appear in supporting documentation,","//  and that the name of Schrodinger, LLC not be used in advertising or","//  publicity pertaining to distribution of the software without specific,","//  written prior permission.","//","//  SCHRODINGER, LLC DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE,","//  INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN","//  NO EVENT SHALL SCHRODINGER, LLC BE LIABLE FOR ANY SPECIAL, INDIRECT OR","//  CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS","//  OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE","//  OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE","//  USE OR PERFORMANCE OF THIS SOFTWARE.","","// Contributions by Alexander Rose","// - ported to WebGL","// - dual color","// - pk color","// - custom clipping","// - three.js lighting","","uniform vec3 diffuse;","uniform vec3 emissive;","uniform float roughness;","uniform float metalness;","uniform float opacity;","uniform float nearClip;","uniform mat4 projectionMatrix;","uniform float ortho;","","varying vec3 axis;","varying vec4 base_radius;","varying vec4 end_b;","varying vec3 U;","varying vec3 V;","varying vec4 w;","","#ifdef PICKING","    uniform float objectId;","    varying vec3 vPickingColor;","#else","    varying vec3 vColor1;","    varying vec3 vColor2;","    #include common","    #include fog_pars_fragment","    #include bsdfs","    #include lights_pars_begin","    #include lights_physical_pars_fragment","#endif","","bool interior = false;","","float distSq3( vec3 v3a, vec3 v3b ){","    return (","        ( v3a.x - v3b.x ) * ( v3a.x - v3b.x ) +","        ( v3a.y - v3b.y ) * ( v3a.y - v3b.y ) +","        ( v3a.z - v3b.z ) * ( v3a.z - v3b.z )","    );","}","","// Calculate depth based on the given camera position.","float calcDepth( in vec3 cameraPos ){","    vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;","    return 0.5 + 0.5 * clipZW.x / clipZW.y;","}","","float calcClip( vec3 cameraPos ){","    return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, nearClip - 0.5 ) );","}","","void main(){","","    vec3 point = w.xyz / w.w;","","    // unpacking","    vec3 base = base_radius.xyz;","    float vRadius = base_radius.w;","    vec3 end = end_b.xyz;","    float b = end_b.w;","","    vec3 end_cyl = end;","    vec3 surface_point = point;","","    vec3 ray_target = surface_point;","    vec3 ray_origin = vec3(0.0);","    vec3 ray_direction = mix(normalize(ray_origin - ray_target), vec3(0.0, 0.0, 1.0), ortho);","    mat3 basis = mat3( U, V, axis );","","    vec3 diff = ray_target - 0.5 * (base + end_cyl);","    vec3 P = diff * basis;","","    // angle (cos) between cylinder cylinder_axis and ray direction","    float dz = dot( axis, ray_direction );","","    float radius2 = vRadius*vRadius;","","    // calculate distance to the cylinder from ray origin","    vec3 D = vec3(dot(U, ray_direction),","                dot(V, ray_direction),","                dz);","    float a0 = P.x*P.x + P.y*P.y - radius2;","    float a1 = P.x*D.x + P.y*D.y;","    float a2 = D.x*D.x + D.y*D.y;","","    // calculate a dicriminant of the above quadratic equation","    float d = a1*a1 - a0*a2;","    if (d < 0.0)","        // outside of the cylinder","        discard;","","    float dist = (-a1 + sqrt(d)) / a2;","","    // point of intersection on cylinder surface","    vec3 new_point = ray_target + dist * ray_direction;","","    vec3 tmp_point = new_point - base;","    vec3 _normal = normalize( tmp_point - axis * dot(tmp_point, axis) );","","    ray_origin = mix( ray_origin, surface_point, ortho );","","    // test caps","    float front_cap_test = dot( tmp_point, axis );","    float end_cap_test = dot((new_point - end_cyl), axis);","","    // to calculate caps, simply check the angle between","    // the point of intersection - cylinder end vector","    // and a cap plane normal (which is the cylinder cylinder_axis)","    // if the angle < 0, the point is outside of cylinder","    // test front cap","","    #ifndef CAP","        vec3 new_point2 = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;","        vec3 tmp_point2 = new_point2 - base;","    #endif","","    // flat","    if (front_cap_test < 0.0)","    {","        // ray-plane intersection","        float dNV = dot(-axis, ray_direction);","        if (dNV < 0.0)","            discard;","        float near = dot(-axis, (base)) / dNV;","        vec3 front_point = ray_direction * near + ray_origin;","        // within the cap radius?","        if (dot(front_point - base, front_point-base) > radius2)","            discard;","","        #ifdef CAP","            new_point = front_point;","            _normal = axis;","        #else","            new_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;","            dNV = dot(-axis, ray_direction);","            near = dot(axis, end_cyl) / dNV;","            new_point2 = ray_direction * near + ray_origin;","            if (dot(new_point2 - end_cyl, new_point2-base) < radius2)","                discard;","            interior = true;","        #endif","    }","","    // test end cap","","","    // flat","    if( end_cap_test > 0.0 )","    {","        // ray-plane intersection","        float dNV = dot(axis, ray_direction);","        if (dNV < 0.0)","            discard;","        float near = dot(axis, end_cyl) / dNV;","        vec3 end_point = ray_direction * near + ray_origin;","        // within the cap radius?","        if( dot(end_point - end_cyl, end_point-base) > radius2 )","            discard;","","        #ifdef CAP","            new_point = end_point;","            _normal = axis;","        #else","            new_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;","            dNV = dot(-axis, ray_direction);","            near = dot(-axis, (base)) / dNV;","            new_point2 = ray_direction * near + ray_origin;","            if (dot(new_point2 - base, new_point2-base) < radius2)","                discard;","            interior = true;","        #endif","    }","","    gl_FragDepthEXT = calcDepth( new_point );","","    #ifdef NEAR_CLIP","        if( calcClip( new_point ) > 0.0 ){","            dist = (-a1 - sqrt(d)) / a2;","            new_point = ray_target + dist * ray_direction;","            if( calcClip( new_point ) > 0.0 )","                discard;","            interior = true;","            gl_FragDepthEXT = calcDepth( new_point );","            if( gl_FragDepthEXT >= 0.0 ){","                gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( nearClip - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );","            }","        }else if( gl_FragDepthEXT <= 0.0 ){","            dist = (-a1 - sqrt(d)) / a2;","            new_point = ray_target + dist * ray_direction;","            interior = true;","            gl_FragDepthEXT = calcDepth( new_point );","            if( gl_FragDepthEXT >= 0.0 ){","                gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );","            }","        }","    #else","        if( gl_FragDepthEXT <= 0.0 ){","            dist = (-a1 - sqrt(d)) / a2;","            new_point = ray_target + dist * ray_direction;","            interior = true;","            gl_FragDepthEXT = calcDepth( new_point );","            if( gl_FragDepthEXT >= 0.0 ){","                gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );","            }","        }","    #endif","","    // this is a workaround necessary for Mac","    // otherwise the modified fragment won't clip properly","    if (gl_FragDepthEXT < 0.0)","        discard;","    if (gl_FragDepthEXT > 1.0)","        discard;","","    #ifdef PICKING","","        gl_FragColor = vec4( vPickingColor, objectId );","","    #else","","        vec3 vViewPosition = -new_point;","        vec3 vNormal = _normal;","        vec3 vColor;","","        if( distSq3( new_point, end_cyl ) < distSq3( new_point, base ) ){","            if( b < 0.0 ){","                vColor = vColor1;","            }else{","                vColor = vColor2;","            }","        }else{","            if( b > 0.0 ){","                vColor = vColor1;","            }else{","                vColor = vColor2;","            }","        }","","        vec4 diffuseColor = vec4( diffuse, opacity );","        ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","        vec3 totalEmissiveLight = emissive;","","        #include color_fragment","     //ifdef USE_COLOR","     //diffuseColor.r *= vColor[0];","     //diffuseColor.g *= vColor[1];","     //diffuseColor.b *= vColor[2];","     //endif","        #include roughnessmap_fragment","        #include metalnessmap_fragment","","        // don't use include normal_fragment","        vec3 normal = normalize( vNormal );","","        #include lights_physical_fragment","        //include lights_template","        #include lights_fragment_begin","        #include lights_fragment_end","","        vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;","","        gl_FragColor = vec4( outgoingLight, diffuseColor.a );","        //gl_FragColor = vec4( reflectedLight.directSpecular, diffuseColor.a );","","        #include premultiplied_alpha_fragment","        #include tonemapping_fragment","        #include encodings_fragment","        #include fog_fragment","    #endif","","}"].join("\n"),$NGL_shaderTextHash["CylinderImpostor.vert"]=["// Open-Source PyMOL is Copyright (C) Schrodinger, LLC.","//","//  All Rights Reserved","//","//  Permission to use, copy, modify, distribute, and distribute modified","//  versions of this software and its built-in documentation for any","//  purpose and without fee is hereby granted, provided that the above","//  copyright notice appears in all copies and that both the copyright","//  notice and this permission notice appear in supporting documentation,","//  and that the name of Schrodinger, LLC not be used in advertising or","//  publicity pertaining to distribution of the software without specific,","//  written prior permission.","//","//  SCHRODINGER, LLC DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE,","//  INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN","//  NO EVENT SHALL SCHRODINGER, LLC BE LIABLE FOR ANY SPECIAL, INDIRECT OR","//  CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS","//  OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE","//  OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE","//  USE OR PERFORMANCE OF THIS SOFTWARE.","","// Contributions by Alexander Rose","// - ported to WebGL","// - dual color","// - pk color","// - shift","","attribute vec3 mapping;","attribute vec3 position1;","attribute vec3 position2;","attribute float radius;","","varying vec3 axis;","varying vec4 base_radius;","varying vec4 end_b;","varying vec3 U;","varying vec3 V;","varying vec4 w;","varying float fogDepth;","","#ifdef PICKING","    #include unpack_clr","    attribute float primitiveId;","    varying vec3 vPickingColor;","#else","    //attribute vec3 color;","    attribute vec3 color2;","    varying vec3 vColor1;","    varying vec3 vColor2;","#endif","","uniform mat4 modelViewMatrixInverse;","uniform float ortho;","","//include matrix_scale","float matrixScale( in mat4 m ){","    vec4 r = m[ 0 ];","    return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );","}","","void main(){","","    #ifdef PICKING","        vPickingColor = unpackColor( primitiveId );","    #else","        vColor1 = color;","        vColor2 = color2;","    #endif","","    // vRadius = radius;","    base_radius.w = radius * matrixScale( modelViewMatrix );","","    //vec3 center = position;","    vec3 center = ( position2 + position1 ) / 2.0;","    vec3 dir = normalize( position2 - position1 );","    float ext = length( position2 - position1 ) / 2.0;","","    // using cameraPosition fails on some machines, not sure why","    // vec3 cam_dir = normalize( cameraPosition - mix( center, vec3( 0.0 ), ortho ) );","    vec3 cam_dir;","    if( ortho == 0.0 ){","        cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 0, 1 ) ).xyz - center;","    }else{","        cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 1, 0 ) ).xyz;","    }","    cam_dir = normalize( cam_dir );","","    vec3 ldir;","","    float b = dot( cam_dir, dir );","    end_b.w = b;","    // direction vector looks away, so flip","    if( b < 0.0 )","        ldir = -ext * dir;","    // direction vector already looks in my direction","    else","        ldir = ext * dir;","","    vec3 left = normalize( cross( cam_dir, ldir ) );","    left = radius * left;","    vec3 up = radius * normalize( cross( left, ldir ) );","","    // transform to modelview coordinates","    axis = normalize( normalMatrix * ldir );","    U = normalize( normalMatrix * up );","    V = normalize( normalMatrix * left );","","    vec4 base4 = modelViewMatrix * vec4( center - ldir, 1.0 );","    base_radius.xyz = base4.xyz / base4.w;","","    vec4 top_position = modelViewMatrix * vec4( center + ldir, 1.0 );","    vec4 end4 = top_position;","    end_b.xyz = end4.xyz / end4.w;","","    w = modelViewMatrix * vec4(","        center + mapping.x*ldir + mapping.y*left + mapping.z*up, 1.0","    );","","    gl_Position = projectionMatrix * w;","","    // avoid clipping (1.0 seems to induce flickering with some drivers)","    gl_Position.z = 0.99;","","}"].join("\n"),
$NGL_shaderTextHash["SphereInstancing.frag"]=$NGL_shaderTextHash["SphereImpostor.frag"],$NGL_shaderTextHash["SphereInstancing.vert"]=["uniform mat4 projectionMatrixInverse;","uniform float nearClip;","","varying float vRadius;","varying float vRadiusSq;","varying vec3 vPoint;","varying vec3 vPointViewPosition;","varying float fogDepth;","","attribute vec2 mapping;","//attribute vec3 position;","attribute float radius;","attribute vec4 matrix1;","attribute vec4 matrix2;","attribute vec4 matrix3;","attribute vec4 matrix4;","","#ifdef PICKING","    #include unpack_clr","    attribute float primitiveId;","    varying vec3 vPickingColor;","#else","    #include color_pars_vertex","#endif","","//include matrix_scale","float matrixScale( in mat4 m ){","    vec4 r = m[ 0 ];","    return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );","}","","const mat4 D = mat4(","    1.0, 0.0, 0.0, 0.0,","    0.0, 1.0, 0.0, 0.0,","    0.0, 0.0, 1.0, 0.0,","    0.0, 0.0, 0.0, -1.0",");","","mat4 transpose( in mat4 inMatrix ) {","    vec4 i0 = inMatrix[0];","    vec4 i1 = inMatrix[1];","    vec4 i2 = inMatrix[2];","    vec4 i3 = inMatrix[3];","","    mat4 outMatrix = mat4(","        vec4(i0.x, i1.x, i2.x, i3.x),","        vec4(i0.y, i1.y, i2.y, i3.y),","        vec4(i0.z, i1.z, i2.z, i3.z),","        vec4(i0.w, i1.w, i2.w, i3.w)","    );","    return outMatrix;","}","","//------------------------------------------------------------------------------","// Compute point size and center using the technique described in:","// 'GPU-Based Ray-Casting of Quadratic Surfaces'","// by Christian Sigg, Tim Weyrich, Mario Botsch, Markus Gross.","//","// Code based on","/*=========================================================================",""," Program:   Visualization Toolkit"," Module:    Quadrics_fs.glsl and Quadrics_vs.glsl",""," Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen"," All rights reserved."," See Copyright.txt or http://www.kitware.com/Copyright.htm for details.",""," This software is distributed WITHOUT ANY WARRANTY; without even"," the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR"," PURPOSE.  See the above copyright notice for more information.",""," =========================================================================*/","","// .NAME Quadrics_fs.glsl and Quadrics_vs.glsl","// .SECTION Thanks","// <verbatim>","//","//  This file is part of the PointSprites plugin developed and contributed by","//","//  Copyright (c) CSCS - Swiss National Supercomputing Centre","//                EDF - Electricite de France","//","//  John Biddiscombe, Ugo Varetto (CSCS)","//  Stephane Ploix (EDF)","//","// </verbatim>","//","// Contributions by Alexander Rose","// - ported to WebGL","// - adapted to work with quads","void ComputePointSizeAndPositionInClipCoordSphere(vec4 updatePosition){","","    vec2 xbc;","    vec2 ybc;","","    mat4 T = mat4(","        radius, 0.0, 0.0, 0.0,","        0.0, radius, 0.0, 0.0,","        0.0, 0.0, radius, 0.0,","        updatePosition.x, updatePosition.y, updatePosition.z, 1.0","    );","","    mat4 R = transpose( projectionMatrix * modelViewMatrix * T );","    float A = dot( R[ 3 ], D * R[ 3 ] );","    float B = -2.0 * dot( R[ 0 ], D * R[ 3 ] );","    float C = dot( R[ 0 ], D * R[ 0 ] );","    xbc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    xbc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    float sx = abs( xbc[ 0 ] - xbc[ 1 ] ) * 0.5;","","    A = dot( R[ 3 ], D * R[ 3 ] );","    B = -2.0 * dot( R[ 1 ], D * R[ 3 ] );","    C = dot( R[ 1 ], D * R[ 1 ] );","    ybc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    ybc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    float sy = abs( ybc[ 0 ] - ybc[ 1 ]  ) * 0.5;","","    gl_Position.xy = vec2( 0.5 * ( xbc.x + xbc.y ), 0.5 * ( ybc.x + ybc.y ) );","    gl_Position.xy -= mapping * vec2( sx, sy );","    gl_Position.xy *= gl_Position.w;","","}","","  mat4 computeMat(vec4 v1, vec4 v2, vec4 v3, vec4 v4) {","    return mat4(","      v1.x, v1.y, v1.z, v1.w,","      v2.x, v2.y, v2.z, v2.w,","      v3.x, v3.y, v3.z, v3.w,","      v4.x, v4.y, v4.z, v4.w","    );","  }","","void main(void){","","    #ifdef PICKING","        vPickingColor = unpackColor( primitiveId );","    #else","        #include color_vertex","    #endif","","    vRadius = radius * matrixScale( modelViewMatrix );","","    mat4 matrix = computeMat(matrix1, matrix2, matrix3, matrix4);","    vec4 updatePosition = matrix * vec4(position, 1.0);","","//    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    vec4 mvPosition = modelViewMatrix * vec4( updatePosition.xyz, 1.0 );","    // avoid clipping, added again in fragment shader","    mvPosition.z -= vRadius;","","//    gl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );","    gl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );","    ComputePointSizeAndPositionInClipCoordSphere(updatePosition);","","","    vRadiusSq = vRadius * vRadius;","    vec4 vPoint4 = projectionMatrixInverse * gl_Position;","    vPoint = vPoint4.xyz / vPoint4.w;","    vPointViewPosition = -mvPosition.xyz / mvPosition.w;","","}"].join("\n"),$NGL_shaderTextHash["CylinderInstancing.frag"]=$NGL_shaderTextHash["CylinderImpostor.frag"],$NGL_shaderTextHash["CylinderInstancing.vert"]=["// Open-Source PyMOL is Copyright (C) Schrodinger, LLC.","//","//  All Rights Reserved","//","//  Permission to use, copy, modify, distribute, and distribute modified","//  versions of this software and its built-in documentation for any","//  purpose and without fee is hereby granted, provided that the above","//  copyright notice appears in all copies and that both the copyright","//  notice and this permission notice appear in supporting documentation,","//  and that the name of Schrodinger, LLC not be used in advertising or","//  publicity pertaining to distribution of the software without specific,","//  written prior permission.","//","//  SCHRODINGER, LLC DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE,","//  INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN","//  NO EVENT SHALL SCHRODINGER, LLC BE LIABLE FOR ANY SPECIAL, INDIRECT OR","//  CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS","//  OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE","//  OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE","//  USE OR PERFORMANCE OF THIS SOFTWARE.","","// Contributions by Alexander Rose","// - ported to WebGL","// - dual color","// - pk color","// - shift","","attribute vec3 mapping;","attribute vec3 position1;","attribute vec3 position2;","attribute float radius;","attribute vec4 matrix1;","attribute vec4 matrix2;","attribute vec4 matrix3;","attribute vec4 matrix4;","","varying vec3 axis;","varying vec4 base_radius;","varying vec4 end_b;","varying vec3 U;","varying vec3 V;","varying vec4 w;","varying float fogDepth;","","#ifdef PICKING","    #include unpack_clr","    attribute float primitiveId;","    varying vec3 vPickingColor;","#else","    //attribute vec3 color;","    attribute vec3 color2;","    varying vec3 vColor1;","    varying vec3 vColor2;","#endif","","uniform mat4 modelViewMatrixInverse;","uniform float ortho;","","//include matrix_scale","float matrixScale( in mat4 m ){","    vec4 r = m[ 0 ];","    return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );","}","","  mat4 computeMat(vec4 v1, vec4 v2, vec4 v3, vec4 v4) {","    return mat4(","      v1.x, v1.y, v1.z, v1.w,","      v2.x, v2.y, v2.z, v2.w,","      v3.x, v3.y, v3.z, v3.w,","      v4.x, v4.y, v4.z, v4.w","    );","  }","","void main(){","","    #ifdef PICKING","        vPickingColor = unpackColor( primitiveId );","    #else","        vColor1 = color;","        vColor2 = color2;","    #endif","","    // vRadius = radius;","    base_radius.w = radius * matrixScale( modelViewMatrix );","","    //vec3 center = ( position2 + position1 ) / 2.0;","","    mat4 matrix = computeMat(matrix1, matrix2, matrix3, matrix4);","    vec4 updatePosition1 = matrix * vec4(position1, 1.0);","    vec4 updatePosition2 = matrix * vec4(position2, 1.0);","    vec3 center = ( updatePosition2.xyz + updatePosition1.xyz ) / 2.0;","","    //vec3 dir = normalize( position2 - position1 );","    vec3 dir = normalize( updatePosition2.xyz - updatePosition1.xyz );","    float ext = length( position2 - position1 ) / 2.0;","","    // using cameraPosition fails on some machines, not sure why","    // vec3 cam_dir = normalize( cameraPosition - mix( center, vec3( 0.0 ), ortho ) );","    vec3 cam_dir;","    if( ortho == 0.0 ){","        cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 0, 1 ) ).xyz - center;","    }else{","        cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 1, 0 ) ).xyz;","    }","    cam_dir = normalize( cam_dir );","","    vec3 ldir;","","    float b = dot( cam_dir, dir );","    end_b.w = b;","    // direction vector looks away, so flip","    if( b < 0.0 )","        ldir = -ext * dir;","    // direction vector already looks in my direction","    else","        ldir = ext * dir;","","    vec3 left = normalize( cross( cam_dir, ldir ) );","    left = radius * left;","    vec3 up = radius * normalize( cross( left, ldir ) );","","    // transform to modelview coordinates","    axis = normalize( normalMatrix * ldir );","    U = normalize( normalMatrix * up );","    V = normalize( normalMatrix * left );","","    vec4 base4 = modelViewMatrix * vec4( center - ldir, 1.0 );","    base_radius.xyz = base4.xyz / base4.w;","","    vec4 top_position = modelViewMatrix * vec4( center + ldir, 1.0 );","    vec4 end4 = top_position;","    end_b.xyz = end4.xyz / end4.w;","","    w = modelViewMatrix * vec4(","        center + mapping.x*ldir + mapping.y*left + mapping.z*up, 1.0","    );","","    gl_Position = projectionMatrix * w;","","    // avoid clipping (1.0 seems to induce flickering with some drivers)","    gl_Position.z = 0.99;","","}"].join("\n"),$NGL_shaderTextHash["Instancing.frag"]=["#define STANDARD","uniform vec3 diffuse;","uniform vec3 emissive;","uniform float roughness;","uniform float metalness;","uniform float opacity;","uniform float nearClip;","uniform float clipRadius;","uniform mat4 projectionMatrix;","uniform float ortho;","varying float bCylinder;","","#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )","    varying vec3 vViewPosition;","#endif","","#if defined( RADIUS_CLIP )","    varying vec3 vClipCenter;","#endif","","#if defined( PICKING )","    uniform float objectId;","    varying vec3 vPickingColor;","#elif defined( NOLIGHT )","    varying vec3 vColor;","#else","    #ifndef FLAT_SHADED","        varying vec3 vNormal;","    #endif","    #include common","    #include color_pars_fragment","    #include fog_pars_fragment","    #include bsdfs","    #include lights_pars_begin","    #include lights_physical_pars_fragment","#endif","","void main(){","    #include nearclip_fragment","    #include radiusclip_fragment","","    #if defined( PICKING )","","        gl_FragColor = vec4( vPickingColor, objectId );","","    #elif defined( NOLIGHT )","","        gl_FragColor = vec4( vColor, opacity );","","    #else","","        vec4 diffuseColor = vec4( diffuse, opacity );","        ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","        vec3 totalEmissiveLight = emissive;","","        #include color_fragment","        #include roughnessmap_fragment","        #include metalnessmap_fragment","        #include normal_flip","        #include normal_fragment_begin","","        //include dull_interior_fragment","","        #include lights_physical_fragment","        //include lights_template","        #include lights_fragment_begin","        #include lights_fragment_end","","        vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;","","        #include interior_fragment","","        gl_FragColor = vec4( outgoingLight, diffuseColor.a );","","        #include premultiplied_alpha_fragment","        #include tonemapping_fragment","        #include encodings_fragment","        #include fog_fragment","","        #include opaque_back_fragment","","    #endif","","}"].join("\n"),$NGL_shaderTextHash["Instancing.vert"]=["#define STANDARD","","uniform mat4 projectionMatrixInverse;","uniform float nearClip;","uniform vec3 clipCenter;","attribute vec4 matrix1;","attribute vec4 matrix2;","attribute vec4 matrix3;","attribute vec4 matrix4;","attribute float cylinder;","varying float bCylinder;","","#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )","    varying vec3 vViewPosition;","#endif","","#if defined( RADIUS_CLIP )","    varying vec3 vClipCenter;","#endif","","#if defined( PICKING )","    #include unpack_color","    attribute float primitiveId;","    varying vec3 vPickingColor;","#elif defined( NOLIGHT )","    varying vec3 vColor;","#else","    #include color_pars_vertex","    #ifndef FLAT_SHADED","        varying vec3 vNormal;","    #endif","#endif","","#include common","","  mat4 computeMat(vec4 v1, vec4 v2, vec4 v3, vec4 v4) {","    return mat4(","      v1.x, v1.y, v1.z, v1.w,","      v2.x, v2.y, v2.z, v2.w,","      v3.x, v3.y, v3.z, v3.w,","      v4.x, v4.y, v4.z, v4.w","    );","  }","","void main(){","    bCylinder = cylinder;","","    mat4 matrix = computeMat(matrix1, matrix2, matrix3, matrix4);","    vec4 updatePosition = matrix * vec4(position, 1.0);","","    #if defined( PICKING )","        vPickingColor = unpackColor( primitiveId );","    #elif defined( NOLIGHT )","        vColor = color;","    #else","        #include color_vertex","        //include beginnormal_vertex","        //vec3 objectNormal = vec3( normal );","        vec3 objectNormal = vec3(matrix * vec4(normal,0.0));","        #include defaultnormal_vertex","        // Normal computed with derivatives when FLAT_SHADED","        #ifndef FLAT_SHADED","            vNormal = normalize( transformedNormal );","        #endif","    #endif","","    //include begin_vertex","    vec3 transformed = updatePosition.xyz;","    //include project_vertex","    vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );","    gl_Position = projectionMatrix * mvPosition;","","    #if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )","        vViewPosition = -mvPosition.xyz;","    #endif","","    #if defined( RADIUS_CLIP )","        vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;","    #endif","","    #include nearclip_vertex","","}"].join("\n"),"undefined"==typeof jQuery)throw new Error("iCn3D requires jQuery");var iCn3D=function(e){this.id=e,this.container=$("#"+e),this.maxatomcnt=1e5,this.overdraw=0,this.bDrawn=!1,this.bSecondaryStructure=!1,this.bHighlight=1,this.renderOrderPicking=-1,this.ALTERNATE_STRUCTURE=-1,Detector.webgl?(this.renderer=new THREE.WebGLRenderer({canvas:this.container.get(0),antialias:!0,preserveDrawingBuffer:!0,sortObjects:!1,alpha:!0}),this.overdraw=0):alert("Currently your web browser has a problem on WebGL. If you are using Chrome, open a new tab for the same URL and WebGL may work again."),this.matShader=this.setOutlineColor("yellow"),this.frac=new THREE.Color(.1,.1,.1),this.scaleFactor=1.5,this.bImpo=!0,this.bExtFragDepth=this.renderer.extensions.get("EXT_frag_depth"),this.bExtFragDepth?console.log("EXT_frag_depth is supported. All spheres and cylinders are drawn using shaders."):(this.bImpo=!1,console.log("EXT_frag_depth is NOT supported. All spheres and cylinders are drawn using geometry.")),this.bInstanced=this.renderer.extensions.get("ANGLE_instanced_arrays"),this.bInstanced?console.log("ANGLE_instanced_arrays is supported. Assembly is drawn with one copy of the asymmetric unit using hardware instancing."):console.log("ANGLE_instanced_arrays is NOT supported. Assembly is drawn by making copies of the asymmetric unit."),this.posArray=new Array,this.colorArray=new Array,this.pos2Array=new Array,this.color2Array=new Array,this.radiusArray=new Array,this.posArraySphere=new Array,this.colorArraySphere=new Array,this.radiusArraySphere=new Array,this.WIDTH=this.container.width(),this.HEIGHT=this.container.height(),this.setWidthHeight(this.WIDTH,this.HEIGHT),this.axis=!1,this.pk=1,this.highlightlevel=1,this.pickpair=!1,this.pAtomNum=0,this.pAtom=void 0,this.pAtom2=void 0,this.bCtrl=!1,this.bShift=!1,this.bStopRotate=!1,this.bCalphaOnly=!1,this.bAllAtoms=!0,this.bConsiderNeighbors=!1,this.bShowCrossResidueBond=!1,this.effects={none:this.renderer},this.maxD=500,this.oriMaxD=this.maxD,this.cam_z=2*this.maxD,this.commands=[],this.optsHistory=[],this.logs=[],this.bRender=!0,this.hColor=new THREE.Color(16776960),this.sphereGeometry=new THREE.SphereGeometry(1,32,32),this.boxGeometry=new THREE.BoxGeometry(1,1,1),this.cylinderGeometry=new THREE.CylinderGeometry(1,1,1,32,1),this.cylinderGeometryOutline=new THREE.CylinderGeometry(1,1,1,32,1,(!0)),this.axisDIV=5,this.strandDIV=6,this.tubeDIV=8,this.nucleicAcidStrandDIV=6,this.linewidth=1,this.hlLineRadius=.1,this.lineRadius=.1,this.coilWidth=.3,this.cylinderRadius=.4,this.traceRadius=.4,this.dotSphereScale=.3,this.sphereRadius=1.5,this.cylinderHelixRadius=1.6,this.ribbonthickness=.2,this.helixSheetWidth=1.3,this.nucleicAcidWidth=.8,this.threshbox=180,this.maxAtoms3DMultiFile=4e4,this.LABELSIZE=30,this.opts={camera:"perspective",background:"transparent",color:"chain",sidec:"nothing",proteins:"ribbon",nucleotides:"nucleotide cartoon",surface:"nothing",wireframe:"no",map:"nothing",mapwireframe:"yes",emmap:"nothing",emmapwireframe:"yes",opacity:"1.0",chemicals:"stick",water:"nothing",ions:"sphere",hbonds:"no",ssbonds:"no",labels:"no",lines:"no",rotationcenter:"molecule center",axis:"no",fog:"no",slab:"no",pk:"residue",nucleotides:"nucleotide cartoon",chemicalbinding:"hide"},this._zoomFactor=1,this.mouseChange=new THREE.Vector2(0,0),this.quaternion=new THREE.Quaternion(0,0,0,1);var t=this;this.container.bind("contextmn",function(e){e.preventDefault()}),t.typetext=!1,$(document).bind("keyup",function(e){16===e.keyCode&&(t.bShift=!1),17!==e.keyCode&&224!==e.keyCode&&91!==e.keyCode||(t.bCtrl=!1)}),$("input[type=text], textarea").focus(function(){t.typetext=!0}),$("input[type=text], textarea").blur(function(){t.typetext=!1}),$(document).bind("keydown",function(e){if((e.shiftKey||16===e.keyCode)&&(t.bShift=!0),(e.ctrlKey||17===e.keyCode||224===e.keyCode||91===e.keyCode)&&(t.bCtrl=!0),t.controls&&(t.bStopRotate=!0,!t.typetext))if(90===e.keyCode){var i={};t.cam===t.perspectiveCamera?i._zoomFactor=.9:t.cam===t.orthographicCamera&&(t._zoomFactor<.1?t._zoomFactor=.1:t._zoomFactor>1&&(t._zoomFactor=1),i._zoomFactor=.8*t._zoomFactor,i._zoomFactor<.1&&(i._zoomFactor=.1)),i.update=!0,t.controls.update(i),t.render()}else if(88===e.keyCode){var i={};t.cam===t.perspectiveCamera?i._zoomFactor=1.03:t.cam===t.orthographicCamera&&(t._zoomFactor>10?t._zoomFactor=10:t._zoomFactor<1&&(t._zoomFactor=1),i._zoomFactor=1.01*t._zoomFactor,i._zoomFactor>10&&(i._zoomFactor=10)),i.update=!0,t.controls.update(i),t.render()}else if(76===e.keyCode){var n=new THREE.Vector3(0,1,0),o=-5/180*Math.PI;t.setRotation(n,o)}else if(74===e.keyCode){var n=new THREE.Vector3(0,1,0),o=5/180*Math.PI;t.setRotation(n,o)}else if(73===e.keyCode){var n=new THREE.Vector3(1,0,0),o=-5/180*Math.PI;t.setRotation(n,o)}else if(77===e.keyCode){var n=new THREE.Vector3(1,0,0),o=5/180*Math.PI;t.setRotation(n,o)}else 65===e.keyCode&&Object.keys(t.structures).length>1&&t.alternateStructures()}),this.container.bind("mouseup touchend",function(e){t.isDragging=!1}),this.container.bind("mousedown",function(e){if(e.preventDefault(),t.isDragging=!0,t.scene){if(t.bStopRotate=!0,t.pk&&(e.altKey||e.ctrlKey||e.shiftKey||18===e.keyCode||16===e.keyCode||17===e.keyCode||224===e.keyCode||91===e.keyCode)){t.highlightlevel=t.pk;var i=!0;t.rayCaster(e,i)}t.controls.handleResize(),t.controls.update(),t.render()}}),this.container.bind("touchstart",function(e){if(e.preventDefault(),t.isDragging=!0,t.scene){t.bStopRotate=!0,$("[id$=popup]").hide();var i=!0;t.rayCaster(e,i),t.controls.handleResize(),t.controls.update(),t.render()}}),this.container.bind("mousemove touchmove",function(e){if(e.preventDefault(),t.scene){$("[id$=popup]").hide();var i=!1;t.rayCaster(e,i),t.isDragging&&(t.controls.handleResize(),t.controls.update(),t.render())}}),this.container.bind("mousewheel",function(e){e.preventDefault(),t.scene&&(t.bStopRotate=!0,t.controls.handleResize(),t.controls.update(),t.render())}),this.container.bind("DOMMouseScroll",function(e){e.preventDefault(),t.scene&&(t.bStopRotate=!0,t.controls.handleResize(),t.controls.update(),t.render())})};iCn3D.prototype={constructor:iCn3D,rayCaster:function(e,t){var i=this,n=e.pageX,o=e.pageY;e.originalEvent.targetTouches&&e.originalEvent.targetTouches[0]&&(n=e.originalEvent.targetTouches[0].pageX,o=e.originalEvent.targetTouches[0].pageY);var r=n-i.container.offset().left,s=o-i.container.offset().top;i.mouse.x=(n-i.container.offset().left)/i.container.width()*2-1,i.mouse.y=2*-((o-i.container.offset().top)/i.container.height())+1;var a=new THREE.Vector3;a.x=i.mouse.x,a.y=i.mouse.y,this.cam_z>0?a.z=-1:a.z=1,i.cam===i.perspectiveCamera?(this.cam_z>0?a.z=-1:a.z=1,a.unproject(i.cam),i.raycaster.set(i.cam.position,a.sub(i.cam.position).normalize())):i.cam===i.orthographicCamera&&(this.cam_z>0?a.z=1:a.z=-1,a.unproject(i.cam),i.raycaster.set(a,new THREE.Vector3(0,0,(-1)).transformDirection(i.cam.matrixWorld)));var c=i.raycaster.intersectObjects(i.objects),d=!1,l=i.mdl.position;if(c.length>0){c[0].point.sub(l);for(var p=.5,h=i.getAtomsFromPosition(c[0].point,p);!h&&p<10;)p+=.5,h=i.getAtomsFromPosition(c[0].point,p);h?(d=!0,i.pickpair?t&&(i.pAtomNum%2===0?i.pAtom=h:i.pAtom2=h,++i.pAtomNum):i.pAtom=h,t?i.showPicking(h):i.showPicking(h,r,s)):console.log("No atoms were found in 10 andstrom range")}if(!d&&(c=i.raycaster.intersectObjects(i.objects_ghost),l=i.mdl_ghost.position,c.length>0)){c[0].point.sub(l);for(var p=.5,h=i.getAtomsFromPosition(c[0].point,p);!h&&p<10;)p+=.5,h=i.getAtomsFromPosition(c[0].point,p);h?(i.pickpair?t&&(i.pAtomNum%2===0?i.pAtom=h:i.pAtom2=h,++i.pAtomNum):i.pAtom=h,t?i.showPicking(h):i.showPicking(h,r,s)):console.log("No atoms were found in 10 andstrom range")}},setRotation:function(e,t){var i=this;e.applyQuaternion(i.cam.quaternion).normalize();var n=new THREE.Quaternion;n.setFromAxisAngle(e,-t);var o={};o.quaternion=n,o.update=!0,i.controls.update(o),i.render()},setOutlineColor:function(e){var t={outline:{vertex_shader:["uniform float offset;","void main() {","vec4 pos = modelViewMatrix * vec4( position + normal * offset, 1.0 );","gl_Position = projectionMatrix * pos;","}"].join("\n"),fragment_shader:["void main(){","gl_FragColor = vec4( 1.0, 1.0, 0.0, 1.0 );","}"].join("\n")}};"yellow"===e?t.outline.fragment_shader=["void main(){","gl_FragColor = vec4( 1.0, 1.0, 0.0, 1.0 );","}"].join("\n"):"green"===e?t.outline.fragment_shader=["void main(){","gl_FragColor = vec4( 0.0, 1.0, 0.0, 1.0 );","}"].join("\n"):"red"===e&&(t.outline.fragment_shader=["void main(){","gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );","}"].join("\n"));var i={offset:{type:"f",value:.5}},n=t.outline,o=new THREE.ShaderMaterial({uniforms:i,vertexShader:n.vertex_shader,fragmentShader:n.fragment_shader,depthTest:!1,depthWrite:!1,needsUpdate:!0});return o},setWidthHeight:function(e,t){this.renderer.setSize(e*this.scaleFactor,t*this.scaleFactor),this.renderer.domElement.style.width=e+"px",this.renderer.domElement.style.height=t+"px",this.renderer.domElement.width=e*this.scaleFactor,this.renderer.domElement.height=t*this.scaleFactor,this.container.widthInv=1/(this.scaleFactor*e),this.container.heightInv=1/(this.scaleFactor*t),this.container.whratio=e/t},nucleotidesArray:["  G","  A","  T","  C","  U"," DG"," DA"," DT"," DC"," DU"],ionsArray:["  K"," NA"," MG"," AL"," CA"," TI"," MN"," FE"," NI"," CU"," ZN"," AG"," BA","  F"," CL"," BR","  I"],vdwRadii:{H:1.08,HE:1.34,LI:1.75,BE:2.05,B:1.47,C:1.49,N:1.41,O:1.4,F:1.39,NE:1.68,NA:1.84,MG:2.05,AL:2.11,SI:2.07,P:1.92,S:1.82,CL:1.83,AR:1.93,K:2.05,CA:2.21,SC:2.16,TI:1.87,V:1.79,CR:1.89,MN:1.97,FE:1.94,CO:1.92,NI:1.84,CU:1.86,ZN:2.1,GA:2.08,GE:2.15,AS:2.06,SE:1.93,BR:1.98,KR:2.12,RB:2.16,SR:2.24,Y:2.19,ZR:1.86,NB:2.07,MO:2.09,TC:2.09,RU:2.07,RH:1.95,PD:2.02,AG:2.03,CD:2.3,IN:2.36,SN:2.33,SB:2.25,TE:2.23,I:2.23,XE:2.21,CS:2.22,BA:2.51,LA:2.4,CE:2.35,PR:2.39,ND:2.29,PM:2.36,SM:2.29,EU:2.33,GD:2.37,TB:2.21,DY:2.29,HO:2.16,ER:2.35,TM:2.27,YB:2.42,LU:2.21,HF:2.12,TA:2.17,W:2.1,RE:2.17,OS:2.16,IR:2.02,PT:2.09,AU:2.17,HG:2.09,TL:2.35,PB:2.32,BI:2.43,PO:2.29,AT:2.36,RN:2.43,FR:2.56,RA:2.43,AC:2.6,TH:2.37,PA:2.43,U:2.4,NP:2.21,PU:2.56,AM:2.56,CM:2.56,BK:2.56,CF:2.56,ES:2.56,FM:2.56},covalentRadii:{H:.31,HE:.28,LI:1.28,BE:.96,B:.84,C:.76,N:.71,O:.66,F:.57,NE:.58,NA:1.66,MG:1.41,AL:1.21,SI:1.11,P:1.07,S:1.05,CL:1.02,AR:1.06,K:2.03,CA:1.76,SC:1.7,TI:1.6,V:1.53,CR:1.39,MN:1.39,FE:1.32,CO:1.26,NI:1.24,CU:1.32,ZN:1.22,GA:1.22,GE:1.2,AS:1.19,SE:1.2,BR:1.2,KR:1.16,RB:2.2,SR:1.95,Y:1.9,ZR:1.75,NB:1.64,MO:1.54,TC:1.47,RU:1.46,RH:1.42,PD:1.39,AG:1.45,CD:1.44,IN:1.42,SN:1.39,SB:1.39,TE:1.38,I:1.39,XE:1.4,CS:2.44,BA:2.15,LA:2.07,CE:2.04,PR:2.03,ND:2.01,PM:1.99,SM:1.98,EU:1.98,GD:1.96,TB:1.94,DY:1.92,HO:1.92,ER:1.89,TM:1.9,YB:1.87,LU:1.87,HF:1.75,TA:1.7,W:1.62,RE:1.51,OS:1.44,IR:1.41,PT:1.36,AU:1.36,HG:1.32,TL:1.45,PB:1.46,BI:1.48,PO:1.4,AT:1.5,RN:1.5,FR:2.6,RA:2.21,AC:2.15,TH:2.06,PA:2,U:1.96,NP:1.9,PU:1.87,AM:1.8,CM:1.69},atomColors:{H:new THREE.Color(16777215),He:new THREE.Color(16761035),HE:new THREE.Color(16761035),Li:new THREE.Color(11674146),LI:new THREE.Color(11674146),B:new THREE.Color(65280),C:new THREE.Color(13158600),N:new THREE.Color(9408511),O:new THREE.Color(15728640),F:new THREE.Color(14329120),Na:new THREE.Color(255),NA:new THREE.Color(255),Mg:new THREE.Color(2263842),MG:new THREE.Color(2263842),Al:new THREE.Color(8421520),AL:new THREE.Color(8421520),Si:new THREE.Color(14329120),SI:new THREE.Color(14329120),P:new THREE.Color(16753920),S:new THREE.Color(16762930),Cl:new THREE.Color(65280),CL:new THREE.Color(65280),Ca:new THREE.Color(8421520),CA:new THREE.Color(8421520),Ti:new THREE.Color(8421520),TI:new THREE.Color(8421520),Cr:new THREE.Color(8421520),CR:new THREE.Color(8421520),Mn:new THREE.Color(8421520),MN:new THREE.Color(8421520),Fe:new THREE.Color(16753920),FE:new THREE.Color(16753920),Ni:new THREE.Color(10824234),NI:new THREE.Color(10824234),Cu:new THREE.Color(10824234),CU:new THREE.Color(10824234),Zn:new THREE.Color(10824234),ZN:new THREE.Color(10824234),Br:new THREE.Color(10824234),BR:new THREE.Color(10824234),Ag:new THREE.Color(8421520),AG:new THREE.Color(8421520),I:new THREE.Color(10494192),Ba:new THREE.Color(16753920),BA:new THREE.Color(16753920),Au:new THREE.Color(14329120),AU:new THREE.Color(14329120)},defaultAtomColor:new THREE.Color(13421772),stdChainColors:[new THREE.Color(16711935),new THREE.Color(255),new THREE.Color(10053171),new THREE.Color(65433),new THREE.Color(16750848),new THREE.Color(16737894),new THREE.Color(3329330),new THREE.Color(2003199),new THREE.Color(16416882),new THREE.Color(16753920),new THREE.Color(52945),new THREE.Color(16738740),new THREE.Color(65280),new THREE.Color(255),new THREE.Color(16711680),new THREE.Color(16776960),new THREE.Color(65535),new THREE.Color(16711935),new THREE.Color(3978097),new THREE.Color(4620980),new THREE.Color(13458524),new THREE.Color(16770229),new THREE.Color(11529966),new THREE.Color(15631086),new THREE.Color(25600),new THREE.Color(139),new THREE.Color(9109504),new THREE.Color(13468991),new THREE.Color(35723),new THREE.Color(9699539)],backgroundColors:{black:new THREE.Color(0),grey:new THREE.Color(13421772),white:new THREE.Color(16777215),transparent:new THREE.Color(0)},residueColors:{ALA:new THREE.Color(13158600),ARG:new THREE.Color(1334015),ASN:new THREE.Color(56540),ASP:new THREE.Color(15075850),CYS:new THREE.Color(15132160),GLN:new THREE.Color(56540),GLU:new THREE.Color(15075850),GLY:new THREE.Color(15461355),HIS:new THREE.Color(8553170),ILE:new THREE.Color(1016335),LEU:new THREE.Color(1016335),LYS:new THREE.Color(1334015),MET:new THREE.Color(15132160),PHE:new THREE.Color(3289770),PRO:new THREE.Color(14456450),SER:new THREE.Color(16422400),THR:new THREE.Color(16422400),TRP:new THREE.Color(11819700),TYR:new THREE.Color(3289770),VAL:new THREE.Color(1016335),ASX:new THREE.Color(16738740),GLX:new THREE.Color(16738740),G:new THREE.Color(32768),A:new THREE.Color(6324479),T:new THREE.Color(16744448),C:new THREE.Color(16711680),U:new THREE.Color(16744448),DG:new THREE.Color(32768),DA:new THREE.Color(6324479),DT:new THREE.Color(16744448),DC:new THREE.Color(16711680),DU:new THREE.Color(16744448)},defaultResidueColor:new THREE.Color(12492910),chargeColors:{"  G":new THREE.Color(16711680),"  A":new THREE.Color(16711680),"  T":new THREE.Color(16711680),"  C":new THREE.Color(16711680),"  U":new THREE.Color(16711680)," DG":new THREE.Color(16711680)," DA":new THREE.Color(16711680)," DT":new THREE.Color(16711680)," DC":new THREE.Color(16711680)," DU":new THREE.Color(16711680),G:new THREE.Color(16711680),A:new THREE.Color(16711680),T:new THREE.Color(16711680),C:new THREE.Color(16711680),U:new THREE.Color(16711680),DG:new THREE.Color(16711680),DA:new THREE.Color(16711680),DT:new THREE.Color(16711680),DC:new THREE.Color(16711680),DU:new THREE.Color(16711680),ARG:new THREE.Color(255),LYS:new THREE.Color(255),ASP:new THREE.Color(16711680),GLU:new THREE.Color(16711680),GLY:new THREE.Color(8947848),PRO:new THREE.Color(8947848),ALA:new THREE.Color(8947848),VAL:new THREE.Color(8947848),LEU:new THREE.Color(8947848),ILE:new THREE.Color(8947848),PHE:new THREE.Color(8947848),HIS:new THREE.Color(8947848),SER:new THREE.Color(8947848),THR:new THREE.Color(8947848),ASN:new THREE.Color(8947848),GLN:new THREE.Color(8947848),TYR:new THREE.Color(8947848),MET:new THREE.Color(8947848),CYS:new THREE.Color(8947848),TRP:new THREE.Color(8947848)},hydrophobicColors:{"  G":new THREE.Color(8947848),"  A":new THREE.Color(8947848),"  T":new THREE.Color(8947848),"  C":new THREE.Color(8947848),"  U":new THREE.Color(8947848)," DG":new THREE.Color(8947848)," DA":new THREE.Color(8947848)," DT":new THREE.Color(8947848)," DC":new THREE.Color(8947848)," DU":new THREE.Color(8947848),G:new THREE.Color(8947848),A:new THREE.Color(8947848),T:new THREE.Color(8947848),C:new THREE.Color(8947848),U:new THREE.Color(8947848),DG:new THREE.Color(8947848),DA:new THREE.Color(8947848),DT:new THREE.Color(8947848),DC:new THREE.Color(8947848),DU:new THREE.Color(8947848),ARG:new THREE.Color(8947848),LYS:new THREE.Color(8947848),ASP:new THREE.Color(8947848),GLU:new THREE.Color(8947848),GLY:new THREE.Color(65280),PRO:new THREE.Color(65280),ALA:new THREE.Color(65280),VAL:new THREE.Color(65280),LEU:new THREE.Color(65280),ILE:new THREE.Color(65280),PHE:new THREE.Color(65280),HIS:new THREE.Color(8947848),SER:new THREE.Color(8947848),THR:new THREE.Color(8947848),ASN:new THREE.Color(8947848),GLN:new THREE.Color(8947848),TYR:new THREE.Color(8947848),MET:new THREE.Color(8947848),CYS:new THREE.Color(8947848),TRP:new THREE.Color(8947848)},sheetcolor:"green",ssColors:{helix:new THREE.Color(16711680),sheet:new THREE.Color(32768),coil:new THREE.Color(6324479)},ssColors2:{helix:new THREE.Color(16711680),sheet:new THREE.Color(16762880),coil:new THREE.Color(6324479)},defaultBondColor:new THREE.Color(12303291),surfaces:{1:void 0,2:void 0,3:void 0,4:void 0},mapData:{},hasCovalentBond:function(e,t){var i=this.covalentRadii[e.elem]+this.covalentRadii[t.elem];return e.coord.distanceToSquared(t.coord)<1.3*i*i},init_base:function(){this.structures={},this.chains={},this.residues={},this.secondaries={},this.alnChains={},this.chainsSeq={},this.chainsColor={},this.chainsGene={},this.chainsAn={},this.chainsAnTitle={},this.alnChainsSeq={},this.alnChainsAnno={},
this.alnChainsAnTtl={},this.dAtoms={},this.hAtoms={},this.pickedAtomList={},this.prevHighlightObjects=[],this.prevHighlightObjects_ghost=[],this.prevSurfaces=[],this.prevMaps=[],this.prevEmmaps=[],this.defNames2Residues={},this.defNames2Atoms={},this.defNames2Descr={},this.defNames2Command={},this.residueId2Name={},this.atoms={},this.dAtoms={},this.hAtoms={},this.proteins={},this.sidec={},this.nucleotides={},this.nucleotidesO3={},this.chemicals={},this.ions={},this.water={},this.calphas={},this.hbondpnts=[],this.stabilizerpnts=[],this.doublebonds={},this.triplebonds={},this.aromaticbonds={},this.atomPrevColors={},this.style2atoms={},this.labels={},this.lines={},this.rotateCount=0,this.rotateCountMax=20},init:function(){this.init_base(),this.molTitle="",this.ssbondpnts={},this.inputid={idtype:void 0,id:void 0},this.biomtMatrices=[],this.bAssembly=!0,this.bDrawn=!1,this.bSecondaryStructure=!1,this.bHighlight=1},reinitAfterLoad:function(){this.dAtoms=this.cloneHash(this.atoms),this.hAtoms=this.cloneHash(this.atoms),this.prevHighlightObjects=[],this.prevHighlightObjects_ghost=[],this.prevSurfaces=[],this.prevMaps=[],this.prevEmmaps=[],this.labels={},this.lines={},this.bAssembly=!0}},iCn3D.prototype.loadPDB=function(e){var t=[],i=[],n=e.split("\n"),o={},r={};this.init();var s,a,c,d=[],l=[],p=[],h=[],u=[],m=[],f=0,v=1,g="",b="",y="",_=0,w="",C=!1,S={},A={},k="stru",E=0,x="";for(var R in n){var T=n[R],H=T.substr(0,6);if("HEADER"===H)k=T.substr(62,4),this.molTitle="";else if("TITLE "===H){var D=T.substr(10);this.molTitle+=D.trim()+" "}else if("HELIX "===H){this.bSecondaryStructure=!0;for(var I,O=T.substr(19,1),M=parseInt(T.substr(21,4)),L=parseInt(T.substr(33,4)),P=M;P<=L;++P)I=O+"_"+P,h.push(I),P===M&&u.push(I),P===L&&m.push(I);t.push({chain:O,initialResidue:M,initialInscode:T.substr(25,1),terminalResidue:L,terminalInscode:T.substr(37,1)})}else if("SHEET "===H){this.bSecondaryStructure=!0;for(var O=T.substr(21,1),M=parseInt(T.substr(22,4)),L=parseInt(T.substr(33,4)),P=M;P<=L;++P){var I=O+"_"+P;d.push(I),P===M&&l.push(I),P===L&&p.push(I)}i.push({chain:O,initialResidue:M,initialInscode:T.substr(26,1),terminalResidue:L,terminalInscode:T.substr(37,1)})}else if("HBOND "===H);else if("SSBOND"===H){var N=T.substr(15,1),z=T.substr(17,4).replace(/ /g,""),q=k+"_"+N+"_"+z,F=T.substr(29,1),j=T.substr(31,4).replace(/ /g,""),U=k+"_"+F+"_"+j;void 0===this.ssbondpnts[k]&&(this.ssbondpnts[k]=[]),this.ssbondpnts[k].push(q),this.ssbondpnts[k].push(U)}else if("REMARK"===H){var B=parseInt(T.substr(7,3));if(350==B&&"BIOMT"==T.substr(13,5)){var G=parseInt(T[18])-1,V=parseInt(T.substr(21,2))-1;void 0==this.biomtMatrices[V]&&(this.biomtMatrices[V]=(new THREE.Matrix4).identity()),this.biomtMatrices[V].elements[G]=parseFloat(T.substr(24,9)),this.biomtMatrices[V].elements[G+4]=parseFloat(T.substr(34,9)),this.biomtMatrices[V].elements[G+8]=parseFloat(T.substr(44,9)),this.biomtMatrices[V].elements[G+12]=parseFloat(T.substr(54,10))}else if(465==B&&" "==T.substr(18,1)&&" "==T.substr(20,1)&&"S"!=T.substr(21,1)){var W=T.substr(15,3),Y=T.substr(19,1),X=parseInt(T.substr(21,5)),s=k+"_"+Y;void 0===A[s]&&(A[s]=[]);var Z={};Z.resi=X,Z.name=this.residueName2Abbr(W).toLowerCase(),Y!=x&&(E=0),!isNaN(X)&&(""==x||Y!=x||Y==x&&X>E)&&(A[s].push(Z),E=X,x=Y)}else 900==B&&void 0===this.emd&&"RELATED DB: EMDB"==T.substr(34).trim()&&(this.emd=T.substr(23,11).trim())}else if("ENDMDL"===H)++v;else if("JRNL  "===H)"PMID"===T.substr(12,4)&&(this.pmid=T.substr(19).trim());else if("ATOM  "===H||"HETATM"===H){var K=1===v?k:k+v.toString(),Q=T.substr(16,1);++f;var J=parseInt(T.substr(6,5));S[J]=f;var ee=T.substr(76,2).replace(/ /g,"");""===ee&&(ee=T.substr(12,2).replace(/ /g,""));var Y=T.substr(21,1);""===Y&&(Y=1),s=K+"_"+Y,s!==g&&(_=0,C=!1);var te=T.substr(22,5).trim();c=s+"_"+te;var X=parseInt(te);(te!=X||C)&&(C=!0),a=s+"_"+X;var ie=T.substr(12,4).replace(/ /g,""),I=Y+"_"+X,ne=parseFloat(T.substr(30,8)),oe=parseFloat(T.substr(38,8)),re=parseFloat(T.substr(46,8)),W=T.substr(17,3),se=new THREE.Vector3(ne,oe,re),ae={het:"H"===H[0],serial:f,name:ie,alt:Q,resn:W,structure:K,chain:Y,resi:X,coord:se,b:parseFloat(T.substr(60,8)),elem:ee,bonds:[],ss:"coil",ssbegin:!1,ssend:!1};this.atoms[f]=ae,this.dAtoms[f]=1,this.hAtoms[f]=1,$.inArray(I,d)!==-1?(this.atoms[f].ss="sheet",$.inArray(I,l)!==-1&&(this.atoms[f].ssbegin=!0),$.inArray(I,p)!==-1&&(this.atoms[f].ssend=!0)):$.inArray(I,h)!==-1&&(this.atoms[f].ss="helix",$.inArray(I,u)!==-1&&(this.atoms[f].ssbegin=!0),$.inArray(I,m)!==-1&&(this.atoms[f].ssend=!0));var ce="-";if(ce="helix"===this.atoms[f].ss?"H":"sheet"===this.atoms[f].ss?"E":!this.atoms[f].het&&this.residueColors.hasOwnProperty(this.atoms[f].resn.toUpperCase())?"c":"o",this.secondaries[a]=ce,c!==y){var de=this.residueName2Abbr(W);if(this.residueId2Name[a]=de,1!==f&&(this.residues[b]=r),a!==b&&(r={}),s!==g){1!==f&&(this.chains[g]=this.unionHash(this.chains[g],o)),o={},void 0===this.structures[K.toString()]&&(this.structures[K.toString()]=[]),this.structures[K.toString()].push(s),void 0===this.chainsSeq[s]&&(this.chainsSeq[s]=[]);var Z={};Z.resi=X,Z.name=de,this.chainsSeq[s].push(Z)}else{var Z={};Z.resi=X,Z.name=de,this.chainsSeq[s].push(Z)}}o[f]=1,r[f]=1,w=H,g=s,b=a,y=c}else if("CONECT"===H)for(var le=parseInt(T.substr(6,5)),P=0;P<4;++P){var pe=parseInt(T.substr([11,16,21,26][P],5));isNaN(pe)||void 0!==this.atoms[S[le]]&&this.atoms[S[le]].bonds.push(S[pe])}else"TER"===H.substr(0,3)&&++f}for(var he=Object.keys(this.structures),ue=0,me=he.length;ue<me;++ue){var K=he[ue];if(K!=k&&(void 0===this.ssbondpnts[K]&&(this.ssbondpnts[K]=[]),void 0!==this.ssbondpnts[k]))for(var P=0,fe=this.ssbondpnts[k].length;P<fe;++P){var ve=this.ssbondpnts[k][P],ge=ve.indexOf("_"),be=K+ve.substr(ge);this.ssbondpnts[K].push(be)}}this.adjustSeq(A),n=null,this.residues[a]=r,this.chains[s]=this.unionHash2Atoms(this.chains[s],o);var ye,_e,we=[],Ce=this,Se=function(e){for(var t=we.length,i=0;i<t;++i){for(var n=we[i],o=i+1;o<t;++o){var r=we[o];n.alt===r.alt&&Ce.hasCovalentBond(n,r)&&(n.bonds.push(r.serial),r.bonds.push(n.serial))}e&&e(n)}},Ae=new THREE.Vector3(9999,9999,9999),ke=new THREE.Vector3((-9999),(-9999),(-9999)),Ee=new THREE.Vector3,xe=0,Re={};for(var R in this.atoms){var ie=this.atoms[R],se=ie.coord;Ee.add(se),Ae.min(se),ke.max(se),++xe,ie.het?ie.het&&("HOH"===ie.resn||"WAT"===ie.resn||"SOL"===ie.resn?this.water[ie.serial]=1:$.inArray(ie.resn,this.ionsArray)!==-1||ie.elem.trim()===ie.resn.trim()?this.ions[ie.serial]=1:this.chemicals[ie.serial]=1):$.inArray(ie.resn,this.nucleotidesArray)!==-1?(this.nucleotides[ie.serial]=1,"O3'"!==ie.name&&"O3*"!==ie.name||(this.nucleotidesO3[ie.serial]=1,this.secondaries[ie.structure+"_"+ie.chain+"_"+ie.resi]="o")):("P"===ie.elem&&(Re[ie.structure+"_"+ie.chain+"_"+ie.resi]=1),this.proteins[ie.serial]=1,"CA"===ie.name&&(this.calphas[ie.serial]=1),"N"!==ie.name&&"CA"!==ie.name&&"C"!==ie.name&&"O"!==ie.name&&(this.sidec[ie.serial]=1)),ye===ie.chain&&_e===ie.resi||(Se(function(e){("C"===e.name&&"N"===ie.name||"O3'"===e.name&&"P"===ie.name)&&Ce.hasCovalentBond(e,ie)&&(e.bonds.push(ie.serial),ie.bonds.push(e.serial))}),ye=ie.chain,_e=ie.resi,we.length=0),we.push(ie)}for(be in Re){var Te=this.residues[be];for(f in Te){var ie=this.atoms[f];ie.het=!0,this.chemicals[ie.serial]=1,this.secondaries[be]="o",delete this.proteins[ie.serial],"CA"===ie.name&&delete this.calphas[ie.serial],"N"!==ie.name&&"CA"!==ie.name&&"C"!==ie.name&&"O"!==ie.name&&delete this.sidec[ie.serial]}}Se(),this.pmin=Ae,this.pmax=ke,this.cnt=xe,this.maxD=this.pmax.distanceTo(this.pmin),this.center=Ee.multiplyScalar(1/this.cnt),this.maxD<5&&(this.maxD=5),this.oriMaxD=this.maxD,this.oriCenter=this.center.clone()},iCn3D.prototype.adjustSeq=function(e){for(var t in this.chainsSeq)if(void 0!==e[t]){var i,n,o,r=this.chainsSeq[t],s=e[t],a=r.length,c=s.length,d=new Array(a+c);for(i=0,n=0,o=0;i<a&&n<c;)r[i].resi<=s[n].resi?(d[o]=r[i],i++):(d[o]=s[n],n++),o++;if(i<a)for(var l=i;l<a;l++)d[o]=r[l],o++;else for(var l=n;l<c;l++)d[o]=s[l],o++;this.chainsSeq[t]=d}},iCn3D.prototype.createSphere=function(e,t,i,n,o){var r;void 0===t&&(t=.8),void 0===i&&(i=!1),void 0===n&&(n=1);var s=this.vdwRadii[e.elem]||t;if(2===o){n*=1.5;var a=this.hColor;r=new THREE.Mesh(this.sphereGeometry,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:this.frac,shininess:30,emissive:0,color:a})),r.scale.x=r.scale.y=r.scale.z=i?t:s*(n?n:1),r.position.copy(e.coord),this.mdl.add(r)}else if(1===o)r=new THREE.Mesh(this.sphereGeometry,this.matShader),r.scale.x=r.scale.y=r.scale.z=i?t:s*(n?n:1),r.position.copy(e.coord),r.renderOrder=this.renderOrderPicking,this.mdl.add(r);else{void 0===e.color&&(e.color=this.defaultAtomColor);var a=e.color;if(r=new THREE.Mesh(this.sphereGeometry,new THREE.MeshPhongMaterial({specular:this.frac,shininess:30,emissive:0,color:a})),r.scale.x=r.scale.y=r.scale.z=i?t:s*(n?n:1),r.position.copy(e.coord),this.bImpo){this.posArraySphere.push(e.coord.x),this.posArraySphere.push(e.coord.y),this.posArraySphere.push(e.coord.z),this.colorArraySphere.push(e.color.r),this.colorArraySphere.push(e.color.g),this.colorArraySphere.push(e.color.b);var c=i?t:s*(n?n:1);this.radiusArraySphere.push(c),this.cnt<=this.maxatomcnt&&this.mdl_ghost.add(r)}else this.mdl.add(r)}1===o||2===o?this.bImpo?this.cnt<=this.maxatomcnt&&this.prevHighlightObjects_ghost.push(r):this.prevHighlightObjects.push(r):this.bImpo?this.cnt<=this.maxatomcnt&&this.objects_ghost.push(r):this.objects.push(r)},iCn3D.prototype.createCylinder=function(e,t,i,n,o,r,s){var a;1===o?(a=new THREE.Mesh(this.cylinderGeometryOutline,this.matShader),a.position.copy(e).add(t).multiplyScalar(.5),a.matrixAutoUpdate=!1,a.lookAt(t.clone().sub(e)),a.updateMatrix(),a.matrix.multiply((new THREE.Matrix4).makeScale(i,i,e.distanceTo(t))).multiply((new THREE.Matrix4).makeRotationX(.5*Math.PI)),a.renderOrder=this.renderOrderPicking,this.mdl.add(a),this.prevHighlightObjects.push(a)):(2===o?(a=new THREE.Mesh(this.cylinderGeometry,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:this.frac,shininess:30,emissive:0,color:n})),i*=1.5):a=new THREE.Mesh(this.cylinderGeometry,new THREE.MeshPhongMaterial({specular:this.frac,shininess:30,emissive:0,color:n})),a.position.copy(e).add(t).multiplyScalar(.5),a.matrixAutoUpdate=!1,a.lookAt(t.clone().sub(e)),a.updateMatrix(),a.matrix.multiply((new THREE.Matrix4).makeScale(i,i,e.distanceTo(t))).multiply((new THREE.Matrix4).makeRotationX(.5*Math.PI)),this.bImpo?(this.posArray.push(e.x),this.posArray.push(e.y),this.posArray.push(e.z),this.colorArray.push(n.r),this.colorArray.push(n.g),this.colorArray.push(n.b),this.pos2Array.push(t.x),this.pos2Array.push(t.y),this.pos2Array.push(t.z),void 0!==r?(this.color2Array.push(r.r),this.color2Array.push(r.g),this.color2Array.push(r.b)):(this.color2Array.push(n.r),this.color2Array.push(n.g),this.color2Array.push(n.b)),this.radiusArray.push(i),this.cnt<=this.maxatomcnt&&this.mdl_ghost.add(a)):this.mdl.add(a),2===o?this.bImpo?this.cnt<=this.maxatomcnt&&this.prevHighlightObjects_ghost.push(a):this.prevHighlightObjects.push(a):this.bImpo?this.cnt<=this.maxatomcnt&&this.objects_ghost.push(a):(void 0===s||s)&&this.objects.push(a))},iCn3D.prototype.createRepresentationSub=function(e,t,i){var n=this,o=[];for(var r in e){var s=e[r];t&&t(s);for(var a in s.bonds){var c=this.atoms[s.bonds[a]];void 0===c||c.serial<s.serial||(c.chain===s.chain&&(c.resi===s.resi||"C"===s.name&&"N"===c.name||"O3'"===s.name&&"P"===c.name||"O3*"===s.name&&"P"===c.name||"SG"===s.name&&"SG"===c.name)?i&&i(s,c):o.push([s.coord,c.coord]))}}if(o.length>0&&this.bShowCrossResidueBond)for(var d=new THREE.Color(65280),r=0,l=o.length;r<l;++r)n.createCylinder(o[r][0],o[r][1],this.cylinderRadius,d,0)},iCn3D.prototype.createSphereRepresentation=function(e,t,i,n,o){var r=this;this.createRepresentationSub(e,function(e){r.createSphere(e,t,i,n,o)})},iCn3D.prototype.createBoxRepresentation_P_CA=function(e,t,i){var n=this;this.createRepresentationSub(e,function(e){"CA"!==e.name&&"O3'"!==e.name&&"O3*"!==e.name||n.createBox(e,void 0,void 0,t,void 0,i)})},iCn3D.prototype.createStickRepresentation=function(e,t,i,n,o,r){var s=this,a=void 0!==r&&r?t/s.cylinderRadius:1;this.createRepresentationSub(e,function(e){s.createSphere(e,t,!n,n,o)},function(e,t){var n=e.coord.clone().add(t.coord).multiplyScalar(.5),r=e.serial+"_"+t.serial;if(s.doublebonds.hasOwnProperty(r)){var c,d,l,p,h=new THREE.Vector3(Math.random(),Math.random(),Math.random());if(1==e.bonds.length&&1==t.bonds.length){p=t.coord.clone(),p.sub(e.coord);var u=h.clone();p.cross(u).normalize().multiplyScalar(.2*a)}else{if(e.bonds.length>=t.bonds.length&&e.bonds.length>1)c=e.serial,d=e.bonds[0],l=e.bonds[1];else{if(!(t.bonds.length>=e.bonds.length&&t.bonds.length>1))return void console.log("Double bond was not drawn due to the undefined cross plane");c=t.serial,d=t.bonds[0],l=t.bonds[1]}var m=s.atoms[c].coord.clone();m.sub(s.atoms[d].coord);var f=s.atoms[c].coord.clone();f.sub(s.atoms[l].coord),m.cross(f),0==parseInt(1e4*m.length())&&(m=new THREE.Vector3(.2,.3,.5)),p=t.coord.clone(),p.sub(e.coord),p.cross(m).normalize().multiplyScalar(.2*a),0==parseInt(1e4*p.length())&&(m=new THREE.Vector3(.5,.3,.2),p.cross(m).normalize().multiplyScalar(.2*a))}e.color===t.color?(s.createCylinder(e.coord.clone().add(p),t.coord.clone().add(p),s.cylinderRadius*a*.3,e.color,o),s.createCylinder(e.coord.clone().sub(p),t.coord.clone().sub(p),s.cylinderRadius*a*.3,e.color,o)):s.bImpo?(s.createCylinder(e.coord.clone().add(p),t.coord.clone().add(p),s.cylinderRadius*a*.3,e.color,o,t.color),s.createCylinder(e.coord.clone().sub(p),t.coord.clone().sub(p),s.cylinderRadius*a*.3,e.color,o,t.color)):(s.createCylinder(e.coord.clone().add(p),n.clone().add(p),s.cylinderRadius*a*.3,e.color,o),s.createCylinder(t.coord.clone().add(p),n.clone().add(p),s.cylinderRadius*a*.3,t.color,o),s.createCylinder(e.coord.clone().sub(p),n.clone().sub(p),s.cylinderRadius*a*.3,e.color,o),s.createCylinder(t.coord.clone().sub(p),n.clone().sub(p),s.cylinderRadius*a*.3,t.color,o))}else if(s.aromaticbonds.hasOwnProperty(r)){var c,d,l;if(e.bonds.length>t.bonds.length&&e.bonds.length>1)c=e.serial,d=e.bonds[0],l=e.bonds[1];else{if(!(t.bonds.length>1))return;c=t.serial,d=t.bonds[0],l=t.bonds[1]}var m=s.atoms[c].coord.clone();m.sub(s.atoms[d].coord);var f=s.atoms[c].coord.clone();f.sub(s.atoms[l].coord),m.cross(f);var p=t.coord.clone();p.sub(e.coord),p.cross(m).normalize().multiplyScalar(.2*a);for(var v=0,g=0,b=e.bondOrder.length;g<b;++g)"1.5"===e.bondOrder[g]&&e.bonds[g]!==t.serial&&(v=e.bonds[g]);var y="add";if(0===v)y="add";else{var _=e.coord.clone().add(p),w=e.coord.clone().sub(p),C=t.coord.clone().sub(_).normalize(),S=s.atoms[v].coord.clone().sub(_).normalize(),A=t.coord.clone().sub(w).normalize(),k=s.atoms[v].coord.clone().sub(w).normalize(),E=Math.acos(C.dot(S)),x=Math.acos(A.dot(k));y=E<x?"sub":"add"}if(e.color===t.color){var R,T;"add"===y?(s.createCylinder(e.coord.clone().sub(p),t.coord.clone().sub(p),s.cylinderRadius*a*.3,e.color,o),R=e.coord.clone().add(p),T=t.coord.clone().add(p).sub(R).multiplyScalar(1/11)):(s.createCylinder(e.coord.clone().add(p),t.coord.clone().add(p),s.cylinderRadius*a*.3,e.color,o),R=e.coord.clone().sub(p),T=t.coord.clone().sub(p).sub(R).multiplyScalar(1/11));for(var g=0;g<=10;++g)if(g%2==0){var H=R.clone().add(T.clone().multiplyScalar(g)),D=R.clone().add(T.clone().multiplyScalar(g+1));s.createCylinder(H,D,s.cylinderRadius*a*.3,e.color,o)}}else{var R,T;"add"===y?(s.createCylinder(e.coord.clone().sub(p),n.clone().sub(p),s.cylinderRadius*a*.3,e.color,o),s.createCylinder(t.coord.clone().sub(p),n.clone().sub(p),s.cylinderRadius*a*.3,t.color,o),R=e.coord.clone().add(p),T=t.coord.clone().add(p).sub(R).multiplyScalar(1/11)):(s.createCylinder(e.coord.clone().add(p),n.clone().add(p),s.cylinderRadius*a*.3,e.color,o),s.createCylinder(t.coord.clone().add(p),n.clone().add(p),s.cylinderRadius*a*.3,t.color,o),R=e.coord.clone().sub(p),T=t.coord.clone().sub(p).sub(R).multiplyScalar(1/11));for(var g=0;g<=10;++g)if(g%2==0){var H=R.clone().add(T.clone().multiplyScalar(g)),D=R.clone().add(T.clone().multiplyScalar(g+1));g<5?s.createCylinder(H,D,s.cylinderRadius*a*.3,e.color,o):s.createCylinder(H,D,s.cylinderRadius*a*.3,t.color,o)}}}else if(s.triplebonds.hasOwnProperty(r)){var h=new THREE.Vector3(Math.random(),Math.random(),Math.random()),u=t.coord.clone();u.sub(e.coord);var A=h.clone();A.cross(u).normalize().multiplyScalar(.3*a),e.color===t.color?(s.createCylinder(e.coord,t.coord,s.cylinderRadius*a*.2,e.color,o),s.createCylinder(e.coord.clone().add(A),t.coord.clone().add(A),s.cylinderRadius*a*.2,e.color,o),s.createCylinder(e.coord.clone().sub(A),t.coord.clone().sub(A),s.cylinderRadius*a*.2,e.color,o)):s.bImpo?(s.createCylinder(e.coord,t.coord,s.cylinderRadius*a*.2,e.color,o,t.color),s.createCylinder(e.coord.clone().add(A),t.coord.clone().add(A),s.cylinderRadius*a*.2,e.color,o,t.color),s.createCylinder(e.coord.clone().sub(A),t.coord.clone().sub(A),s.cylinderRadius*a*.2,e.color,o,t.color)):(s.createCylinder(e.coord,n,s.cylinderRadius*a*.2,e.color,o),s.createCylinder(t.coord,n,s.cylinderRadius*a*.2,t.color,o),s.createCylinder(e.coord.clone().add(A),n.clone().add(A),s.cylinderRadius*a*.2,e.color,o),s.createCylinder(t.coord.clone().add(A),n.clone().add(A),s.cylinderRadius*a*.2,t.color,o),s.createCylinder(e.coord.clone().sub(A),n.clone().sub(A),s.cylinderRadius*a*.2,e.color,o),s.createCylinder(t.coord.clone().sub(A),n.clone().sub(A),s.cylinderRadius*a*.2,t.color,o))}else e.color===t.color?s.createCylinder(e.coord,t.coord,i,e.color,o):s.bImpo?s.createCylinder(e.coord,t.coord,i,e.color,o,t.color):(s.createCylinder(e.coord,n,i,e.color,o),s.createCylinder(t.coord,n,i,t.color,o))})},iCn3D.prototype.createLineRepresentation=function(e,t){var i=new THREE.Geometry;if(this.createRepresentationSub(e,void 0,function(e,t){if(e.color===t.color)i.vertices.push(e.coord),i.vertices.push(t.coord),i.colors.push(e.color),i.colors.push(t.color);else{var n=e.coord.clone().add(t.coord).multiplyScalar(.5);i.vertices.push(e.coord),i.vertices.push(n),i.vertices.push(t.coord),i.vertices.push(n),i.colors.push(e.color),i.colors.push(e.color),i.colors.push(t.color),i.colors.push(t.color)}}),2!==t){var n;1===t||(n=new THREE.LineSegments(i,new THREE.LineBasicMaterial({linewidth:this.linewidth,vertexColors:!0})),this.mdl.add(n)),1===t?this.prevHighlightObjects.push(n):this.objects.push(n)}else 2===t&&this.createBoxRepresentation_P_CA(e,.8,t)},iCn3D.prototype.getKnot=function(e,t,i,n){return i.distanceTo(n)+t},iCn3D.prototype.getValueFromKnot=function(e,t,i,n,o,r,s,a,c){var d,l,p=9999,h=(s-r)/(i-t),u=(a-s)/(n-i),m=(c-a)/(o-n),f=u*(e-i)+s,v=(i+n)*(i+n)-4*(t*i+n*o-t*o);0==v?(d=p,l=p):(d=6*(3*u*i+2*h*o+m*i-2*h*i-2*u*o-u*n-m*i)/v,l=6*(3*u*n+2*m*t+h*i-2*u*t-2*m*n-h*n-u*i)/v);var g=(2*d+l)/6/(i-n),b=(2*l+d)/6/(n-i),y=g*(e-i)*(e-n)*(e-n)+b*(e-i)*(e-i)*(e-n),_=f+y;return _},iCn3D.prototype.subdivide=function(e,t,i,n,o,r,s,a){var c=[],d=[],l=[],p=new Array,h=void 0!==r?r.length:0,u=void 0!==s?s.length:0;h>0&&p.push(r[0]),p.push(e[0]);for(var m=1,f=e.length-1;m<f;++m){var v=e[m],g=e[m+1];p.push(v.smoothen?v.clone().add(g).multiplyScalar(.5):v)}p.push(e[e.length-1]),u>0&&p.push(s[0]),u>1&&p.push(s[1]);var b=[],y=[],_=[],w=u;a&&(w=u>0?u-1:0);for(var C=1,m=-1,S=p.length,A=1/i;m<=S-3;++m){var k=m-h,v=p[m===-1?0:m],g=p[m+1],E=p[m+2],x=p[m===S-3?S-1:m+3],R=0,T=this.getKnot(C,R,v,g),H=this.getKnot(C,T,g,E),D=this.getKnot(C,H,E,x);T-R<1e-4&&(T=R+1),H-T<1e-4&&(H=T+1),D-H<1e-4&&(D=H+1),m>-1&&(void 0===n||n[k+1])&&m>=-1+h&&m<=S-3-w+1&&(c=c.concat(b),d=d.concat(y),l=l.concat(_)),b=[],y=[],_=[];for(var I=(H-T)*A,O=0;O<i;++O){var M=T+I*O,L=this.getValueFromKnot(M,R,T,H,D,v.x,g.x,E.x,x.x),$=this.getValueFromKnot(M,R,T,H,D,v.y,g.y,E.y,x.y),P=this.getValueFromKnot(M,R,T,H,D,v.z,g.z,E.z,x.z);n?(m>=-1+h&&m<=S-3-w&&n[k+1]&&O<=parseInt(i/2)&&(c.push(new THREE.Vector3(L,$,P)),d.push(n[k+1]),l.push(t[k+1])),m>=-1+h&&m<=S-3-w+1&&n[k+2]&&O>parseInt(i/2)&&(b.push(new THREE.Vector3(L,$,P)),y.push(n[k+2]),_.push(t[k+2]))):m>=-1+h&&m<=S-3-w&&(c.push(new THREE.Vector3(L,$,P)),d.push(k+1),l.push(t[k+1]))}}n&&!n[k+1]||(c=c.concat(b),d=d.concat(y),l=l.concat(_),c.push(p[p.length-1-w]),d.push(p.length-1-w),l.push(t[p.length-1-w])),b=[],y=[],_=[],p=[];var N=[];return N.push(c),N.push(d),N.push(l),N},iCn3D.prototype.createCurveSubArrow=function(e,t,i,n,o,r,s,a,c,d,l,p,h,u,m){var f=[],v=[];f.push(e),v.push(a),this.prepareStrand(f,v,t,i,n,void 0,o,r,s,c,d,!1,l,p,h,u,m),f=[],v=[]},iCn3D.prototype.setCalphaDrawnCoord=function(e,t,i){var n=0;if(void 0!==i)for(var o=0,r=e.length;o<r;o+=t){var s=i[n];this.atoms.hasOwnProperty(s)&&(this.atoms[s].coord2=e[o].clone()),++n}},iCn3D.prototype.createCurveSub=function(e,t,i,n,o,r,s,a,c,d,l,p){if(0!==e.length){n=n||5;var h;if(s)h=e;else{var u=!0,m=this.subdivide(e,i,n,a,o,l,p,u);h=m[0],i=m[2]}if(0!==h.length){if(this.setCalphaDrawnCoord(h,n,c),1===o){var f=this.coilWidth/2,v=4,g=!1;if(h.length>1)if(void 0!==d){for(var b,y,_=[],w=0,C=h.length;w<C;++w){if(b=d[w],b!==y&&b!==y+1&&void 0!==y||w===C-1){var S=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(_),_.length,f,v,g);mesh=new THREE.Mesh(S,this.matShader),mesh.renderOrder=this.renderOrderPicking,this.mdl.add(mesh),this.prevHighlightObjects.push(mesh),S=null,_=[]}_.push(h[w]),y=b}_=[]}else{var S=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(h),h.length,f,v,g);mesh=new THREE.Mesh(S,this.matShader),mesh.renderOrder=this.renderOrderPicking,this.mdl.add(mesh),this.prevHighlightObjects.push(mesh),S=null}}else{var A=new THREE.Geometry;if(2===o&&r)for(var w=0;w<h.length;++w)h[w].addScalar(.6),A.vertices.push(h[w]),A.colors.push(new THREE.Color(i[w]));else for(var w=0;w<h.length;++w)A.vertices.push(h[w]),A.colors.push(new THREE.Color(i[w]));var k=new THREE.Line(A,new THREE.LineBasicMaterial({linewidth:t,vertexColors:!0}));this.mdl.add(k),2===o?this.prevHighlightObjects.push(k):this.objects.push(k)}h=null}}},iCn3D.prototype.createCylinderCurve=function(e,t,i,n,o){var r,s,a,c=null,d=8;for(a in e){var l=e[a];if(!l.het&&t.indexOf(l.name)!=-1){if(null!==c&&r===l.chain&&s+1===l.resi&&Math.abs(c.coord.x-l.coord.x)<d&&Math.abs(c.coord.y-l.coord.y)<d&&Math.abs(c.coord.z-l.coord.z)<d){var p=c.coord.clone().add(l.coord).multiplyScalar(.5);if(o)1===o&&(this.createCylinder(c.coord,p,i,c.color,o),this.createCylinder(p,l.coord,i,l.color,o),this.createSphere(l,i,!0,1,o));else if(n){var h=this.createSingleLine(c.coord,p,c.color,!1);this.mdl.add(h),this.objects.push(h),h=this.createSingleLine(p,l.coord,l.color,!1),this.mdl.add(h),this.objects.push(h)}else this.createCylinder(c.coord,p,i,c.color),this.createCylinder(p,l.coord,i,l.color),this.createSphere(l,i,!0,1,o)}c=l,r=l.chain,s=l.resi,2===o&&this.createBox(l,void 0,void 0,void 0,void 0,o)}}if(null!==c&&r===l.chain&&s+1===l.resi&&Math.abs(c.coord.x-l.coord.x)<d&&Math.abs(c.coord.y-l.coord.y)<d&&Math.abs(c.coord.z-l.coord.z)<d){var p=c.coord.add(l.coord).multiplyScalar(.5);if(o)1===o&&(this.createCylinder(c.coord,p,i,c.color,o),this.createCylinder(p,l.coord,i,l.color,o),this.createSphere(l,i,!0,1,o));else if(n){var h=this.createSingleLine(c.coord,p,c.color,!1);this.mdl.add(h),this.objects.push(h),h=this.createSingleLine(p,l.coord,l.color,!1),this.mdl.add(h),this.objects.push(h)}else this.createCylinder(c.coord,p,i,c.color),this.createCylinder(p,l.coord,i,l.color)}},iCn3D.prototype.prepareStrand=function(e,t,i,n,o,r,s,a,c,d,l,p,h,u,m,f,v){if(1!==d.length){var g=[];g.push(n[n.length-2]),g.push(n[n.length-1]),o=o||this.axisDIV;for(var b,y,_,w,C=2/(c-1),S={},A=[],k=0,E=t.length;k<E;++k)S[k]=[];var x=this.subdivide(d,n,o,void 0,void 0,f,v),R=x[0];if(1!==R.length){for(var A=[],T=void 0===m||m?d.length-2:d.length,k=0,E=T;k<E;++k){for(var H=0,D=t.length;H<D;++H)S[H].push(e[H][k]);A.push(n[k])}if(A.push(n[k]),void 0===m||m)for(var k=0,E=t.length;k<E;++k)b=-1+C*t[k],y=R.length-1-o,_=d.length-2,w=new THREE.Vector3(R[y].x+l[_].x*b,R[y].y+l[_].y*b,R[y].z+l[_].z*b),S[k].push(w);for(var I,O=[],k=0,E=t.length;k<E;++k)I=this.subdivide(S[k],A,o,h,s),S[k]=I[0],n=I[2],0===k&&(O=I[1]);if(p?this.createStrip(S[0],S[1],n,o,r,s,!0,void 0,u,O,f,v):this.createCurveSub(S[0],i,n,o,s,a,!0,void 0,u,O,f,v),void 0===m||m){A=[],O=[];for(var H=0,D=t.length;H<D;++H){S[H]=[];for(var k=o*(d.length-2),E=o*(d.length-1);h[parseInt(k/o)]&&k<E;k+=o)for(var M=parseInt(k/o),L=0;L<o;++L){var b=-1+C*t[H],$=1.8;b=b*$*(o-L)/o;var P=parseInt(k/o),w=new THREE.Vector3(R[k+L].x+l[P].x*b,R[k+L].y+l[P].y*b,R[k+L].z+l[P].z*b);w.smoothen=!0,S[H].push(w),A.push(g[0]),0===H&&O.push(M)}var b=0,y=R.length-1,_=d.length-1,w=new THREE.Vector3(R[y].x+l[_].x*b,R[y].y+l[_].y*b,R[y].z+l[_].z*b);w.smoothen=!0,S[H].push(w),A.push(g[1]),0===H&&O.push(y)}R=[],p?this.createStrip(S[0],S[1],A,o,r,s,!0,void 0,void 0,O,f,v):this.createCurveSub(S[0],i,A,o,s,a,!0,void 0,void 0,O,f,v)}for(var k in S){for(var L=0,N=S[k].length;L<N;++L)S[k][L]=null;S[k]=[]}S={}}}},iCn3D.prototype.createStripArrow=function(e,t,i,n,o,r,s,a,c,d,l,p,h,u,m,f){var v=[],g=[];v.push(e),v.push(t),g.push(a),g.push(c),this.prepareStrand(v,g,void 0,i,n,o,r,void 0,s,d,l,!0,p,h,u,m,f),v=[],g=[]},iCn3D.prototype.createStrip=function(e,t,i,n,o,r,s,a,c,d,l,p){if(!(e.length<2)){if(n=n||this.axisDIV,!s){var h=!0,u=this.subdivide(e,i,n,a,r,l,p,h),m=this.subdivide(t,i,n,a,r,l,p,h);e=u[0],t=m[0],i=u[2]}if(!(e.length<2)){if(this.setCalphaDrawnCoord(e,n,c),1===r){var f=this.coilWidth/2,v=4,g=!1;if(void 0!==d){for(var b,y,_=[],w=[],C=0,S=e.length;C<S;++C){if(b=d[C],b!==y&&b!==y+1&&void 0!==y||C===S-1){var A=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(_),_.length,f,v,g);q=new THREE.Mesh(A,this.matShader),q.renderOrder=this.renderOrderPicking,this.mdl.add(q),this.prevHighlightObjects.push(q),A=null;var k=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(w),w.length,f,v,g);q=new THREE.Mesh(k,this.matShader),q.renderOrder=this.renderOrderPicking,this.mdl.add(q),this.prevHighlightObjects.push(q),k=null,_=[],w=[]}_.push(e[C]),w.push(t[C]),y=b}_=[],w=[]}else{var A=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(e),e.length,f,v,g);q=new THREE.Mesh(A,this.matShader),q.renderOrder=this.renderOrderPicking,this.mdl.add(q),this.prevHighlightObjects.push(q),A=null;var k=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(t),t.length,f,v,g);q=new THREE.Mesh(k,this.matShader),q.renderOrder=this.renderOrderPicking,this.mdl.add(q),this.prevHighlightObjects.push(q),k=null}}else{for(var E,x,R,T,H,D=new THREE.Geometry,I=D.vertices,O=D.faces,C=0,M=e.length;C<M;++C)I.push(x=e[C]),I.push(x),I.push(R=t[C]),I.push(R),C<M-1&&(E=t[C].clone().sub(e[C]).cross(e[C+1].clone().sub(e[C])).normalize().multiplyScalar(o)),I.push(T=e[C].clone().add(E)),I.push(T),I.push(H=t[C].clone().add(E)),I.push(H);for(var L=[[0,2,-6,-8],[-4,-2,6,4],[7,3,-5,-1],[-3,-7,1,5]],C=1,M=e.length;C<M;++C)for(var $=8*C,P=new THREE.Color(i[C-1]),N=0;N<4;++N)O.push(new THREE.Face3($+L[N][0],$+L[N][1],$+L[N][2],(void 0),P)),O.push(new THREE.Face3($+L[N][3],$+L[N][0],$+L[N][2],(void 0),P));for(var z=I.length-8,C=0;C<4;++C)I.push(I[2*C]),I.push(I[z+2*C]);z+=8,O.push(new THREE.Face3(z,z+2,z+6,(void 0),O[0].color)),O.push(new THREE.Face3(z+4,z,z+6,(void 0),O[0].color)),O.push(new THREE.Face3(z+1,z+5,z+7,(void 0),O[O.length-3].color)),O.push(new THREE.Face3(z+3,z+1,z+7,(void 0),O[O.length-3].color)),D.computeFaceNormals(),D.computeVertexNormals(!1);var q;2===r?(q=new THREE.Mesh(D,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:this.frac,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),this.mdl.add(q),this.prevHighlightObjects.push(q)):(q=new THREE.Mesh(D,new THREE.MeshPhongMaterial({specular:this.frac,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),this.mdl.add(q),this.objects.push(q))}e=null,t=null}}},iCn3D.prototype.createStrand=function(e,t,i,n,o,r,s,a,c){var d=!!n,l={};if(this.bAllAtoms)l=e;else{var p,h,u,m,f,v,g,b,y=0,_=Object.keys(e).length;l=this.cloneHash(e);for(var w in e){if(p=e[w].structure+"_"+e[w].chain,h=parseInt(e[w].resi),u=e[w],void 0===m&&(g=e[w]),p!==m&&void 0!==m||h!==f&&h!==f+1&&void 0!==f||y===_-1){p!==m&&void 0!==m||h!==f&&h!==f+1&&void 0!==f?b=v:y===_-1&&(b=u);var C=g.resi;if("coil"!==g.ss&&!g.ssbegin){for(var S=g.resi-1;S>0;--S){var A=g.structure+"_"+g.chain+"_"+S;if(!this.residues.hasOwnProperty(A))break;var k=this.getFirstCalphaAtomObj(this.residues[A]);if(k.ss===g.ss&&k.ssbegin){C=k.resi;break}}for(var S=C;S<g.resi;++S){var A=g.structure+"_"+g.chain+"_"+S;l=this.unionHash(l,this.hash2Atoms(this.residues[A]))}}if(3===this.pk&&1===c&&"coil"===g.ss){var A=g.structure+"_"+g.chain+"_"+(g.resi-1);this.residues.hasOwnProperty(A)&&(l=this.unionHash(l,this.hash2Atoms(this.residues[A])),e=this.unionHash(e,this.hash2Atoms(this.residues[A])))}var E=b.resi;if("coil"!==b.ss&&!b.ssend&&!b.notshow){for(var x=this.getLastAtomObj(this.chains[b.structure+"_"+b.chain]).resi,S=b.resi+1;S<=x;++S){var A=b.structure+"_"+b.chain+"_"+S;if(!this.residues.hasOwnProperty(A))break;var k=this.getFirstCalphaAtomObj(this.residues[A]);if(k.ss===b.ss&&k.ssend){E=k.resi;break}}for(var S=b.resi+1;S<=E;++S){var A=b.structure+"_"+b.chain+"_"+S;l=this.unionHash(l,this.hash2Atoms(this.residues[A]))}}if(3===this.pk&&1===c&&"coil"===b.ss){var A=b.structure+"_"+b.chain+"_"+(b.resi+1);this.residues.hasOwnProperty(A)&&(l=this.unionHash(l,this.hash2Atoms(this.residues[A])),e=this.unionHash(e,this.hash2Atoms(this.residues[A])))}b.notshow&&(b.notshow=void 0),g=u}m=p,f=h,v=u,++y}}2===c&&(n?(n=!1,t=null,i=null,o=null,r=null,a=void 0):(n=!0,t=2,i=void 0,o=void 0,r=void 0,a=this.ribbonthickness)),t=t||this.strandDIV,i=i||this.axisDIV,o=o||this.coilWidth,s=s||!1,r=r||this.helixSheetWidth;for(var R={},T=0;T<t;++T)R[T]=[];var H,D,I,k,O=[],M=[],L=[],$=[],P=[],N=null,z=null,q=null,F=null,j=null,U=null,B=null,G=null,V=!1,W=null,Y=null,f=null,X=null,Z=null,K=!1,Q=!1,J={};this.bCalphaOnly=this.isCalphaPhosOnly(l);var ee={};for(var S in l){var k=l[S];A=k.structure+"_"+k.chain+"_"+k.resi,ee[A]=1}var te=Object.keys(ee).length,ie=0,ne=0,oe=Object.keys(this.hAtoms).length==Object.keys(this.atoms).length,re=[];for(var S in l){k=l[S];if(("O"===k.name||"CA"===k.name)&&!k.het&&("CA"===k.name&&(e.hasOwnProperty(S)&&("helix"!==k.ss&&"sheet"!==k.ss||k.ssend||k.ssbegin)&&(J[S]=k),N=k.coord,q=k.color,X=k.serial,re.push(k.serial)),"O"===k.name||this.bCalphaOnly&&"CA"===k.name)){null!==N&&void 0!==N||(N=k.coord,q=k.color,X=k.serial),"O"===k.name&&(z=k.coord);var se=!0;if(H!==k.chain&&(se=!1),k.ssend&&"sheet"===k.ss?K=!0:k.ssend&&"helix"===k.ss&&(Q=!0),j){1===c||2===c?P.push(this.hColor):P.push(U),I="coil"!==G&&"coil"===k.ss?o:V&&k.ssbegin?o:"coil"===G?o:r;var ae,ce,de=4;"O"===k.name?(ae=j.clone(),null!==F&&void 0!==F?ae.sub(F):(F=j.clone(),re.length>de+1?(ae=F.clone(),ce=this.atoms[re[re.length-1-de-1]].coord.clone(),ae.sub(ce)):ae=new THREE.Vector3(Math.random(),Math.random(),Math.random()))):this.bCalphaOnly&&"CA"===k.name&&(re.length>de+1?(ae=F.clone(),ce=this.atoms[re[re.length-1-de-1]].coord.clone(),ae.sub(ce)):ae=new THREE.Vector3(Math.random(),Math.random(),Math.random())),ae.normalize(),ae.multiplyScalar(I),null!==B&&ae.dot(B)<0&&ae.negate(),B=ae;for(var le=0,pe=2/(t-1);le<t;++le){var he=-1+pe*le,ue=new THREE.Vector3(F.x+B.x*he,F.y+B.y*he,F.z+B.z*he);s||"sheet"!==G||(ue.smoothen=!0),R[le].push(ue)}O.push(F),M.push(B),e.hasOwnProperty(Y)?(L.push(f),$.push(Z),++ne):(L.push(0),$.push(0)),++ie}if((k.ssbegin||k.ssend||ie===te-1)&&R[0].length>0&&se){var me="CA",fe=[],ve=[],ge=this.atoms[Y].structure+"_"+this.atoms[Y].chain+"_"+(this.atoms[Y].resi-1).toString(),be=this.getAtomCoordFromResi(ge,me);fe=void 0!==be?[be]:[];var ye=this.atoms[Y].structure+"_"+this.atoms[Y].chain+"_"+(this.atoms[Y].resi+1).toString(),_e=this.getAtomCoordFromResi(ye,me);void 0!==_e&&ve.push(_e);var we=this.atoms[Y].structure+"_"+this.atoms[Y].chain+"_"+(this.atoms[Y].resi+2).toString(),Ce=this.getAtomCoordFromResi(we,me);void 0!==Ce&&ve.push(Ce),1===c||2===c?P.push(this.hColor):P.push(U),I=k.ssend&&"sheet"===k.ss?0:"coil"===G&&k.ssbegin?o:V&&k.ssbegin?o:"coil"===k.ss?o:r;var ae,ce,de=4;"O"===k.name?(ae=z.clone(),
ae.sub(N)):this.bCalphaOnly&&"CA"===k.name&&(re.length>de?(ae=N.clone(),ce=this.atoms[re[re.length-1-de]].coord.clone(),ae.sub(ce)):ae=new THREE.Vector3(Math.random(),Math.random(),Math.random())),ae.normalize(),ae.multiplyScalar(I),null!==B&&ae.dot(B)<0&&ae.negate(),B=ae;for(var le=0,pe=2/(t-1);le<t;++le){var he=-1+pe*le,ue=new THREE.Vector3(N.x+B.x*he,N.y+B.y*he,N.z+B.z*he);s||"sheet"!==G||(ue.smoothen=!0),R[le].push(ue)}W=k.serial,O.push(N),M.push(B),e.hasOwnProperty(W)?(L.push(k.resi),$.push(X)):(L.push(0),$.push(0));for(var le=0;!n&&le<t;++le)K?this.createCurveSubArrow(R[le],1,P,i,c,d,t,le,O,M,L,$,!0,fe,ve):Q&&(oe?this.createCurveSub(R[le],1,P,i,c,d,!1,L,$,void 0,fe,ve):this.createCurveSubArrow(R[le],1,P,i,c,d,t,le,O,M,L,$,!1,fe,ve));if(n)if(K){var Se=0,Ae=t-1;this.createStripArrow(R[0],R[t-1],P,i,a,c,t,Se,Ae,O,M,L,$,!0,fe,ve)}else if(Q)if(oe)this.createStrip(R[0],R[t-1],P,i,a,c,!1,L,$,void 0,fe,ve);else{var Se=0,Ae=t-1;this.createStripArrow(R[0],R[t-1],P,i,a,c,t,Se,Ae,O,M,L,$,!0,fe,ve)}else 2===c&&this.createStrip(R[0],R[t-1],P,i,a,c,!1,L,$,void 0,fe,ve);for(var T=0;T<t;++T)R[T]=[];P=[],O=[],M=[],L=[],$=[],K=!1,Q=!1}if(H!==k.chain&&R[0].length>0){for(var me="CA",ge=this.atoms[Y].structure+"_"+this.atoms[Y].chain+"_"+(this.atoms[Y].resi-1).toString(),be=this.getAtomCoordFromResi(ge,me),fe=void 0!==be?[be]:[],ve=[],le=0;!n&&le<t;++le)K?this.createCurveSubArrow(R[le],1,P,i,c,d,t,le,O,M,L,$,!0,fe,ve):Q&&(oe?this.createCurveSub(R[le],1,P,i,c,d,!1,L,$,void 0,fe,ve):this.createCurveSubArrow(R[le],1,P,i,c,d,t,le,O,M,L,$,!1,fe,ve));if(n)if(K){var Se=0,Ae=t-1;this.createStripArrow(R[0],R[t-1],P,i,a,c,t,Se,Ae,O,M,L,$,!0,fe,ve)}else if(Q)if(oe)this.createStrip(R[0],R[t-1],P,i,a,c,!1,L,$,void 0,fe,ve);else{var Se=0,Ae=t-1;this.createStripArrow(R[0],R[t-1],P,i,a,c,t,Se,Ae,O,M,L,$,!1,fe,ve)}for(var T=0;T<t;++T)R[T]=[];P=[],O=[],M=[],L=[],$=[],K=!1,Q=!1}H=k.chain,D=k.resi,G=k.ss,V=k.ssend,Y=k.serial,f=k.resi,Z=X,F=N,j=k.coord,U=q}}re=[],this.createTube(J,"CA",o,c),J={},R={}},iCn3D.prototype.createTubeSub=function(e,t,i,n,o,r){if(!(e.length<2)){var s=this.tubeDIV,a=this.axisDIV,c=1/s,d=1/a,l=new THREE.Geometry,p=this.subdivide(e,t,a,void 0,void 0,o,r),h=p[0];t=p[2];for(var u,m=new THREE.Vector3,f=0,v=h.length;f<v;++f){var g,b=(f-1)*d;if(0===f)g=i[0];else if(b%1===0)g=i[b];else{var y=Math.floor(b),_=b-y;g=i[y]*_+i[y+1]*(1-_)}var w,C,S;f<v-1?(w=h[f].clone().sub(h[f+1]),C=new THREE.Vector3(0,(-w.z),w.y).normalize().multiplyScalar(g),S=w.clone().cross(C).normalize().multiplyScalar(g),m.dot(C)<0&&(C.negate(),S.negate()),m=C,u=S):(C=m,S=u);for(var A=0;A<s;++A){var k=2*Math.PI*c*A;l.vertices.push(h[f].clone().add(C.clone().multiplyScalar(Math.cos(k))).add(S.clone().multiplyScalar(Math.sin(k))))}}for(var E=0,f=0,v=h.length-1;f<v;++f){var x=new THREE.Color(t[f]),R=0,T=l.vertices[E].clone().sub(l.vertices[E+s]).lengthSq(),H=l.vertices[E].clone().sub(l.vertices[E+s+1]).lengthSq();T>H&&(T=H,R=1);for(var A=0;A<s;++A)l.faces.push(new THREE.Face3(E+A,E+(A+R)%s+s,E+(A+1)%s,(void 0),x)),l.faces.push(new THREE.Face3(E+(A+1)%s,E+(A+R)%s+s,E+(A+R+1)%s+s,(void 0),x));E+=s}l.computeFaceNormals(),l.computeVertexNormals(!1);var D;2===n?(D=new THREE.Mesh(l,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:this.frac,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),this.mdl.add(D)):1===n?(D=new THREE.Mesh(l,this.matShader),D.renderOrder=this.renderOrderPicking,this.mdl.add(D)):(D=new THREE.Mesh(l,new THREE.MeshPhongMaterial({specular:this.frac,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),this.mdl.add(D)),1===n||2===n?this.prevHighlightObjects.push(D):this.objects.push(D)}},iCn3D.prototype.getAtomCoordFromResi=function(e,t){if(this.residues.hasOwnProperty(e))for(var i in this.residues[e])if(this.atoms[i].name===t&&!this.atoms[i].het){var n=void 0!==this.atoms[i].coord2?this.atoms[i].coord2:this.atoms[i].coord;return n}},iCn3D.prototype.createTube=function(e,t,i,n){var o,r,s,a,c,d=[],l=[],p=[],h=[],u=[],m=0,f=6,v=3,g=[];for(var b in e)if(c=e[b],c.name===t&&!c.het){if(0==m&&(a=c),m>0&&(o!==c.chain||Math.abs(c.coord.x-s.coord.x)>f||Math.abs(c.coord.y-s.coord.y)>f||Math.abs(c.coord.z-s.coord.z)>f||r+1!==c.resi&&(Math.abs(c.coord.x-s.coord.x)>v||Math.abs(c.coord.y-s.coord.y)>v||Math.abs(c.coord.z-s.coord.z)>v))){if(2!==n){var y=a.structure+"_"+a.chain+"_"+(a.resi-1).toString(),_=this.getAtomCoordFromResi(y,t);h=void 0!==_?[_]:[];var w=s.structure+"_"+s.chain+"_"+(s.resi+1).toString(),C=this.getAtomCoordFromResi(w,t);void 0!==C&&u.push(C);var S=s.structure+"_"+s.chain+"_"+(s.resi+2).toString(),A=this.getAtomCoordFromResi(S,t);void 0!==A&&u.push(A),g.push({pnts:d,colors:l,radii:p,prevone:h,nexttwo:u})}d=[],l=[],p=[],h=[],u=[],a=c,m=0}d.push(c.coord);var k=i;k=i?i:c.b>0&&c.b<=100?.01*c.b:c.b>100?1:this.coilWidth,p.push(k),l.push(c.color),1===m&&(l[l.length-2]=c.color),o=c.chain,r=c.resi;var E=1.2;2!==n||c.ssbegin||this.createBox(c,void 0,void 0,E,void 0,n),++m,s=c}if(2!==n){if(h=[],void 0!==a){var y=a.structure+"_"+a.chain+"_"+(a.resi-1).toString(),_=this.getAtomCoordFromResi(y,t);h=void 0!==_?[_]:[]}if(u=[],void 0!==c){var w=c.structure+"_"+c.chain+"_"+(c.resi+1).toString(),C=this.getAtomCoordFromResi(w,t);void 0!==C&&u.push(C);var S=c.structure+"_"+c.chain+"_"+(c.resi+2).toString(),A=this.getAtomCoordFromResi(S,t);void 0!==A&&u.push(A)}g.push({pnts:d,colors:l,radii:p,prevone:h,nexttwo:u})}for(var b=0,x=g.length;b<x;++b){var d=g[b].pnts,l=g[b].colors,p=g[b].radii,h=g[b].prevone,u=g[b].nexttwo;this.createTubeSub(d,l,p,n,h,u)}g=[]},iCn3D.prototype.createCylinderHelix=function(e,t,i){var n,o,r,s=null,a={},c={};for(r in e){var d=e[r];d.het||(("helix"!==d.ss&&"sheet"!==d.ss||d.ssend||d.ssbegin)&&(a[d.serial]=d),"sheet"===d.ss&&(c[d.serial]=d),"CA"===d.name&&("helix"===d.ss&&d.ssend&&(null!==s&&n===d.chain&&o<d.resi&&(1===i||2===i?this.createCylinder(s.coord,d.coord,t,this.hColor,i):this.createCylinder(s.coord,d.coord,t,d.color)),s=null),null===s&&"helix"===d.ss&&d.ssbegin&&(s=d,n=d.chain,o=d.resi)))}1===i||2===i?(Object.keys(a).length>0&&this.createTube(a,"CA",this.coilWidth,i),Object.keys(c).length>0&&this.createStrand(c,void 0,void 0,!0,0,this.helixSheetWidth,!1,2*this.ribbonthickness,i)):(Object.keys(a).length>0&&this.createTube(a,"CA",this.coilWidth),Object.keys(c).length>0&&this.createStrand(c,void 0,void 0,!0,0,this.helixSheetWidth,!1,2*this.ribbonthickness))},iCn3D.prototype.drawNucleicAcidStick=function(e,t){var i,n,o,r=null,s=null;for(o in e){var a=e[o];void 0===a||a.het||(a.resi===n&&a.chain===i||(null!==r&&null!==s&&this.createCylinder(new THREE.Vector3(r.coord.x,r.coord.y,r.coord.z),new THREE.Vector3(s.coord.x,s.coord.y,s.coord.z),this.cylinderRadius,r.color,t),r=null,s=null),"O3'"!==a.name&&"O3*"!==a.name||(r=a),"  A"===a.resn||"  G"===a.resn||" DA"===a.resn||" DG"===a.resn?"N1"===a.name&&(s=a):"N3"===a.name&&(s=a),n=a.resi,i=a.chain)}null!==r&&null!==s&&this.createCylinder(new THREE.Vector3(r.coord.x,r.coord.y,r.coord.z),new THREE.Vector3(s.coord.x,s.coord.y,s.coord.z),this.cylinderRadius,r.color,t)},iCn3D.prototype.isCalphaPhosOnly=function(e){var t=!1,i=0,n=50,o=0;for(var r in e){if(!(i<n))break;"CA"!==e[r].name&&"P"!==e[r].name&&"O3'"!==e[r].name&&"O3*"!==e[r].name&&++o,++i}return o<.5*i&&(t=!0),t},iCn3D.prototype.drawCartoonNucleicAcid=function(e,t,i,n){this.drawStrandNucleicAcid(e,2,t,!0,void 0,i,n)},iCn3D.prototype.drawStrandNucleicAcid=function(e,t,i,n,o,r,s){2===s&&(t=void 0,r=void 0),o=o||this.nucleicAcidWidth,i=i||this.axisDIV,t=t||this.nucleicAcidStrandDIV;var a,c,d,l=[];for(d=0;d<t;d++)l[d]=[];var p,h,u,m=[],f=null;for(a in e){var v=e[a];if(void 0!==v&&("O3'"===v.name||"OP2"===v.name||"O3*"===v.name||"O2P"===v.name)&&!v.het)if("O3'"===v.name||"O3*"===v.name){if(p!==v.chain||h+1!==v.resi){if(u&&f)for(c=0;c<t;c++){var g=-1+2/(t-1)*c;l[c].push(new THREE.Vector3(u.x+f.x*g,u.y+f.y*g,u.z+f.z*g))}for(n&&this.createStrip(l[0],l[1],m,i,r,s),c=0;!r&&c<t;c++)this.createCurveSub(l[c],1,m,i,s);var l=[];for(d=0;d<t;d++)l[d]=[];m=[],f=null}u=new THREE.Vector3(v.coord.x,v.coord.y,v.coord.z),p=v.chain,h=v.resi,1===s||2===s?m.push(this.hColor):m.push(v.color)}else if("OP2"===v.name||"O2P"===v.name){if(!u){f=null;continue}var b=new THREE.Vector3(v.coord.x,v.coord.y,v.coord.z);for(b.sub(u),b.normalize().multiplyScalar(o),null!==f&&b.dot(f)<0&&b.negate(),f=b,c=0;c<t;c++){var g=-1+2/(t-1)*c;l[c].push(new THREE.Vector3(u.x+f.x*g,u.y+f.y*g,u.z+f.z*g))}u=null}}if(u&&f)for(c=0;c<t;c++){var g=-1+2/(t-1)*c;l[c].push(new THREE.Vector3(u.x+f.x*g,u.y+f.y*g,u.z+f.z*g))}for(n&&this.createStrip(l[0],l[1],m,i,r,s),c=0;!r&&c<t;c++)this.createCurveSub(l[c],1,m,i,s)},iCn3D.prototype.createSingleLine=function(e,t,i,n,o){var r,s=new THREE.Geometry;r=n?new THREE.LineDashedMaterial({linewidth:1,color:i,dashSize:o,gapSize:.5*o}):new THREE.LineBasicMaterial({linewidth:1,color:i}),s.vertices.push(e),s.vertices.push(t),n&&s.computeLineDistances();var a=new THREE.LineSegments(s,r);return a},iCn3D.prototype.createBox=function(e,t,i,n,o,r){var s;void 0===t&&(t=.8),void 0===i&&(i=!1),void 0===n&&(n=.8),r?(void 0===o&&(o=this.hColor),s=new THREE.Mesh(this.boxGeometry,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:this.frac,shininess:30,emissive:0,color:o}))):(void 0===o&&(o=e.color),s=new THREE.Mesh(this.boxGeometry,new THREE.MeshPhongMaterial({specular:this.frac,shininess:30,emissive:0,color:o}))),s.scale.x=s.scale.y=s.scale.z=i?t:(this.vdwRadii[e.elem]||t)*(n?n:1),s.position.copy(e.coord),this.mdl.add(s),r?this.prevHighlightObjects.push(s):this.objects.push(s)},iCn3D.prototype.makeTextSprite=function(e,t){void 0===t&&(t={});var i=t.hasOwnProperty("fontface")?t.fontface:"Arial",n=t.hasOwnProperty("fontsize")?t.fontsize:18,o=t.hasOwnProperty("alpha")?t.alpha:1,r=!0,s=!1;t.hasOwnProperty("bSchematic")&&t.bSchematic&&(s=!0,n=40);var a,c,d;t.hasOwnProperty("backgroundColor")&&void 0!==t.backgroundColor?(a=this.hexToRgb(t.backgroundColor,o),c=t.hasOwnProperty("borderColor")?this.hexToRgb(t.borderColor,o):{r:0,g:0,b:0,a:1},d=t.hasOwnProperty("borderThickness")?t.borderThickness:4):(r=!1,a=void 0,c=void 0,d=0);var l=1,p=t.hasOwnProperty("textColor")&&void 0!==t.textColor?this.hexToRgb(t.textColor,l):{r:255,g:255,b:0,a:1},h=document.createElement("canvas"),u=h.getContext("2d");u.font="Bold "+n+"px "+i;var m=u.measureText(e),f=m.width,v=f+2*d,g=n+2*d;s&&(v>g?g=v:v=g);var b=s?3*this.maxD/100:3*this.maxD/100,y=.8*f/g;if(h.width=v,h.height=g,u.clearRect(0,0,v,g),r)if(u.fillStyle="rgba("+a.r+","+a.g+","+a.b+","+a.a+")",u.strokeStyle="rgba("+c.r+","+c.g+","+c.b+","+c.a+")",u.lineWidth=d,s){var _=.35*v;this.circle(u,0,0,v,g,_)}else{var _=0;this.roundRect(u,0,0,v,g,_)}u.font="Bold "+n+"px "+i,u.textAlign="center",u.textBaseline="middle",u.fillStyle="rgba("+p.r+", "+p.g+", "+p.b+", 1.0)",u.strokeStyle="rgba("+p.r+", "+p.g+", "+p.b+", 1.0)",u.fillText(e,.5*v,.5*g);var w=new THREE.Texture(h);w.needsUpdate=!0;var C=!0,S=new THREE.SpriteMaterial({map:w,depthTest:!C,depthWrite:!C});S.map.minFilter=THREE.LinearFilter;var A=new THREE.Sprite(S);return s?A.scale.set(b,b,1):A.scale.set(y*b,b,1),A},iCn3D.prototype.roundRect=function(e,t,i,n,o,r){e.beginPath(),e.moveTo(t+r,i),e.lineTo(t+n-r,i),e.quadraticCurveTo(t+n,i,t+n,i+r),e.lineTo(t+n,i+o-r),e.quadraticCurveTo(t+n,i+o,t+n-r,i+o),e.lineTo(t+r,i+o),e.quadraticCurveTo(t,i+o,t,i+o-r),e.lineTo(t,i+r),e.quadraticCurveTo(t,i,t+r,i),e.closePath(),e.fill(),e.stroke()},iCn3D.prototype.circle=function(e,t,i,n,o,r){e.beginPath(),e.arc(t+n/2,i+o/2,r,0,2*Math.PI,!0),e.closePath(),e.fill(),e.stroke()},iCn3D.prototype.createLabelRepresentation=function(e){this.maxD;for(var t in e)for(var i=void 0!==e[t]?e[t]:[],n=0,o=i.length;n<o;++n){var r=i[n];0==r.size&&(r.size=void 0),0==r.color&&(r.color=void 0),0==r.background&&(r.background=void 0);var s=void 0!==r.size?r.size:this.LABELSIZE,a=void 0!==r.color?r.color:"#ffff00",c=void 0!==r.background?r.background:"#cccccc",d=void 0!==r.alpha?r.alpha:1;c=r.background,void 0!==a&&void 0!==c&&a.toLowerCase()===c.toLowerCase()&&(a="#888888");var l=!1,p=!1;if(Object.keys(this.proteins).length+Object.keys(this.nucleotides).length>0){var h=this.getFirstAtomObj(this.hAtoms);void 0!==h&&((this.chemicals.hasOwnProperty(h.serial)||"c alpha trace"==h.style||"o3 trace"==h.style)&&(l=!0),"stick"!=h.style&&"ball and stick"!=h.style||(p=!0))}var u;u=void 0!==r.bSchematic&&r.bSchematic?this.makeTextSprite(r.text,{fontsize:parseInt(s),textColor:a,borderColor:c,backgroundColor:c,alpha:d,bSchematic:1}):1===r.text.length?this.makeTextSprite(r.text,{fontsize:parseInt(s),textColor:a,borderColor:c,backgroundColor:c,alpha:d,bSchematic:1}):this.makeTextSprite(r.text,{fontsize:parseInt(s),textColor:a,borderColor:c,backgroundColor:c,alpha:d,bSchematic:0}),u.position.set(r.position.x,r.position.y,r.position.z),this.mdl.add(u)}},iCn3D.prototype.setAtmClr=function(e,t){for(var i in e){var n=this.atoms[i];n.color=(new THREE.Color).setHex(t),this.atomPrevColors[i]=n.color}},iCn3D.prototype.updateChainsColor=function(e){var t=e.structure+"_"+e.chain;void 0!==this.chainsColor[t]&&(this.chainsColor[t]=e.color)},iCn3D.prototype.setMmdbChainColor=function(e){var t=void 0===e?this.hAtoms:e;this.applyOriginalColor(this.hash2Atoms(t));var i=this.unionHash(this.chemicals,this.ions);for(var n in i){var o=this.atoms[n];o.color=this.atomColors[o.elem]||this.defaultAtomColor,this.atomPrevColors[n]=o.color}},iCn3D.prototype.setConservationColor=function(e,t){this.setMmdbChainColor(e);for(var i in this.alnChainsSeq)for(var n=this.alnChainsSeq[i],o=0,r=n.length;o<r;++o){var s=i+"_"+n[o].resi;for(var a in this.residues[s])if(e.hasOwnProperty(a)){var c=t?new THREE.Color(n[o].color):new THREE.Color(n[o].color2);this.atoms[a].color=c,this.atomPrevColors[a]=c}}},iCn3D.prototype.setColorByOptions=function(e,t,i){if(void 0!==e)if(void 0!==i&&i)for(var n in t){var o=this.atoms[n];this.atomPrevColors[n]=o.color}else if(0===e.color.indexOf("#"))for(var n in t){var o=this.atoms[n];o.color=(new THREE.Color).setStyle(e.color.toLowerCase()),this.atomPrevColors[n]=o.color}else switch(e.color.toLowerCase()){case"spectrum":var r=0,a=0;for(var n in t){var o=this.atoms[n];o.het||++a}var c=1/a;for(var n in t){var o=this.atoms[n];o.color=o.het?this.atomColors[o.elem]||this.defaultAtomColor:(new THREE.Color).setHSL(2/3*(1-r++*c),1,.45),this.atomPrevColors[n]=o.color}break;case"chain":if(void 0!==this.chainsColor&&Object.keys(this.chainsColor).length>0)this.setMmdbChainColor();else{var d=-1,l="",p=this.stdChainColors.length;for(var n in t){var o=this.atoms[n];o.chain!=l&&(++d,d%=p),o.color=this.stdChainColors[d],Object.keys(this.chainsColor).length>0&&this.updateChainsColor(o),this.atomPrevColors[n]=o.color,l=o.chain}}break;case"secondary structure":this.sheetcolor="green";for(var n in t){var o=this.atoms[n];o.color=o.het?this.atomColors[o.elem]||this.defaultAtomColor:this.ssColors[o.ss]||new THREE.Color(16711935),this.atomPrevColors[n]=o.color}break;case"secondary structure yellow":this.sheetcolor="yellow";for(var n in t){var o=this.atoms[n];o.color=o.het?this.atomColors[o.elem]||this.defaultAtomColor:this.ssColors2[o.ss]||new THREE.Color(16711935),this.atomPrevColors[n]=o.color}break;case"residue":for(var n in t){var o=this.atoms[n];o.color=o.het?this.atomColors[o.elem]||this.defaultAtomColor:this.residueColors[o.resn]||this.defaultResidueColor,this.atomPrevColors[n]=o.color}break;case"charge":for(var n in t){var o=this.atoms[n];o.color=o.het?this.defaultAtomColor:this.chargeColors[o.resn]||this.defaultResidueColor,this.atomPrevColors[n]=o.color}break;case"hydrophobic":for(var n in t){var o=this.atoms[n];o.color=o.het?this.defaultAtomColor:this.hydrophobicColors[o.resn]||this.defaultResidueColor,this.atomPrevColors[n]=o.color}break;case"atom":for(var n in t){var o=this.atoms[n];o.color=this.atomColors[o.elem]||this.defaultAtomColor,this.atomPrevColors[n]=o.color}break;case"b factor":this.middB=50,this.spanBinv1=.02,this.spanBinv2=.02;for(var n in t){var o=this.atoms[n];if(void 0===o.b||0==parseInt(1e3*o.b))o.color=(new THREE.Color).setRGB(0,1,0);else{var h=o.b;h>100&&(h=100),o.color=h<this.middB?(new THREE.Color).setRGB(1-(s=(this.middB-h)*this.spanBinv1),1-s,1):(new THREE.Color).setRGB(1,1-(s=(h-this.middB)*this.spanBinv2),1-s)}this.atomPrevColors[n]=o.color}break;case"b factor percentile":var u=1e3,m=-1e3;if(!this.bfactorArray){this.bfactorArray=[];for(var n in this.atoms){var o=this.atoms[n];u>o.b&&(u=o.b),m<o.b&&(m=o.b),this.bfactorArray.push(o.b)}this.bfactorArray.sort(function(e,t){return e-t})}var f=this.bfactorArray.length;for(var n in t){var o=this.atoms[n];if(void 0===o.b||0==parseInt(1e3*o.b)||0==this.bfactorArray.length)o.color=(new THREE.Color).setRGB(0,1,0);else{var v=this.bfactorArray.indexOf(o.b)/f;o.color=v<.5?(new THREE.Color).setRGB(2*v,2*v,1):(new THREE.Color).setRGB(1,2*(1-v),2*(1-v))}this.atomPrevColors[n]=o.color}break;case"identity":this.setConservationColor(t,!0);break;case"conserved":this.setConservationColor(t,!0);break;case"conservation":this.setConservationColor(t,!1);break;case"white":this.setAtmClr(t,16777215);break;case"grey":this.setAtmClr(t,8947848);break;case"red":this.setAtmClr(t,16711680);break;case"green":this.setAtmClr(t,65280);break;case"blue":this.setAtmClr(t,255);break;case"magenta":this.setAtmClr(t,16711935);break;case"yellow":this.setAtmClr(t,16776960);break;case"cyan":this.setAtmClr(t,65535);break;case"custom":break;default:for(var n in t){var o=this.atoms[n];o.color=(new THREE.Color).setStyle("#"+e.color.toLowerCase()),this.atomPrevColors[n]=o.color}}},iCn3D.prototype.applyDisplayOptions=function(e,t,i){var n=this;void 0===e&&(e=this.opts);var o,r={},s={},a={};if(1===i&&Object.keys(t).length<Object.keys(this.atoms).length){a=this.hash2Atoms(t),r=n.getResiduesFromAtoms(t);for(var c in r){o=c;var d=c.lastIndexOf("_"),l=c.substr(0,d+1),p=parseInt(c.substr(d+1)),h=l+(p-1).toString(),u=l+(p+1).toString();r.hasOwnProperty(h)||r.hasOwnProperty(h)||(s[c]=1)}if(1===Object.keys(a).length&&Object.keys(this.residues[o]).length>1&&"sphere"!==a[Object.keys(a)[0]].style&&"dot"!==a[Object.keys(a)[0]].style){if(void 0===this.bCid||!this.bCid)for(var c in a){var m=a[c],f=1;this.createBox(m,void 0,void 0,f,void 0,i)}}else for(var o in s){var v=this.getFirstCalphaAtomObj(this.residues[o]),m=v,h=m.structure+"_"+m.chain+"_"+parseInt(m.resi-1),u=m.structure+"_"+m.chain+"_"+parseInt(m.resi+1);if("cylinder and plate"===m.style&&"helix"===m.ss)for(var c in this.residues[o]){var m=this.atoms[c],f=1;this.createBox(m,void 0,void 0,f,void 0,i)}else if("ribbon"===m.style&&"coil"===m.ss||"strand"===m.style&&"coil"===m.ss||"o3 trace"===m.style||"schematic"===m.style||"c alpha trace"===m.style||"b factor tube"===m.style||"cylinder and plate"===m.style&&"helix"!==m.ss){if(void 0!==v&&void 0!==v.style2&&"nothing"!==v.style2)continue;var g=!1;if(!g&&this.residues.hasOwnProperty(u)){var b=Object.keys(this.residues[u])[0],y=this.hash2Atoms(this.residues[u])[b];if(m.style===y.style&&!y.ssbegin||y.ssbegin){var _=this.residues[u];if(t=this.unionHash(t,_),g=!0,y.ssbegin)for(var c in _)this.atoms[c].notshow=!0}}if(!g&&this.residues.hasOwnProperty(h)){var b=Object.keys(this.residues[h])[0],y=this.hash2Atoms(this.residues[h])[b];m.style===y.style&&(t=this.unionHash(t,this.residues[h]),g=!0)}}else if("ribbon"===m.style&&"coil"!==m.ss&&m.ssend||"strand"===m.style&&"coil"!==m.ss&&m.ssend){if(void 0!==v&&void 0!==v.style2&&"nothing"!==v.style2)continue;var g=!1;if(!g&&this.residues.hasOwnProperty(u)){var b=Object.keys(this.residues[u])[0],y=this.hash2Atoms(this.residues[u])[b];t=this.unionHash(t,this.residues[u]),g=!0}}}a={}}this.setStyle2Atoms(t),this.bAllAtoms=!1,t&&void 0!==t&&(this.bAllAtoms=Object.keys(t).length===Object.keys(this.atoms).length);var w=.5*this.cylinderRadius;void 0!==this.labels&&delete this.labels.schematic;var C=!1;if(i){var S=this.getResiduesFromCalphaAtoms(this.hAtoms),A=this.intHash(this.hAtoms,this.proteins),r=this.getResiduesFromAtoms(A);Object.keys(r)>Object.keys(S)&&(C=!0)}for(var k in this.style2atoms){var E=this.style2atoms[k],x=this.isCalphaPhosOnly(this.hash2Atoms(E));if("ribbon"!==k||i&&(!i||C))if("strand"!==k||i&&(!i||C))if("cylinder and plate"!==k||i&&(!i||C))if("nucleotide cartoon"===k)x?this.createCylinderCurve(this.hash2Atoms(E),["P"],this.traceRadius,!1,i):(this.drawCartoonNucleicAcid(this.hash2Atoms(E),null,this.ribbonthickness,i),2!==i&&this.drawNucleicAcidStick(this.hash2Atoms(E),i));else if("o3 trace"===k)x?this.createCylinderCurve(this.hash2Atoms(E),["P"],this.traceRadius,!1,i):this.createCylinderCurve(this.hash2Atoms(E),["O3'","O3*"],this.traceRadius,!1,i);else if("schematic"===k){var R=this.getFirstAtomObj(E);this.chemicals.hasOwnProperty(R.serial)?(this.addNonCarbonAtomLabels(this.hash2Atoms(E)),bSchematic=!0,this.createStickRepresentation(this.hash2Atoms(E),w,w,void 0,i,bSchematic)):(this.addResiudeLabels(this.hash2Atoms(E),!0),x?this.createCylinderCurve(this.hash2Atoms(E),["P"],this.traceRadius,!1,i):this.createCylinderCurve(this.hash2Atoms(E),["O3'","O3*"],this.traceRadius,!1,i),this.createCylinderCurve(this.hash2Atoms(E),["CA"],this.traceRadius,!1,i))}else"c alpha trace"===k?this.createCylinderCurve(this.hash2Atoms(E),["CA"],this.traceRadius,!1,i):"b factor tube"===k?this.createTube(this.hash2Atoms(E),"CA",null,i):"lines"===k?1===i?this.createStickRepresentation(this.hash2Atoms(E),this.hlLineRadius,this.hlLineRadius,void 0,i):this.createLineRepresentation(this.hash2Atoms(E),i):"stick"===k?this.createStickRepresentation(this.hash2Atoms(E),this.cylinderRadius,this.cylinderRadius,void 0,i):"ball and stick"===k?this.createStickRepresentation(this.hash2Atoms(E),this.cylinderRadius,.5*this.cylinderRadius,this.dotSphereScale,i):"sphere"===k?this.createSphereRepresentation(this.hash2Atoms(E),this.sphereRadius,void 0,void 0,i):"dot"===k&&this.createSphereRepresentation(this.hash2Atoms(E),this.sphereRadius,!1,this.dotSphereScale,i);else this.createCylinderHelix(this.hash2Atoms(E),this.cylinderHelixRadius,i);else this.createStrand(this.hash2Atoms(E),null,null,null,null,null,!1,void 0,i);else this.createStrand(this.hash2Atoms(E),2,void 0,!0,void 0,void 0,!1,this.ribbonthickness,i)}this.cnt>this.maxmaxatomcnt&&this.init_base(),void 0!==this.labels&&Object.keys(this.labels).length>0&&(this.hideLabels(),this.createLabelRepresentation(this.labels))},iCn3D.prototype.hideLabels=function(){if(void 0!==this.mdl)for(var e=0,t=this.mdl.children.length;e<t;++e){var i=this.mdl.children[e];void 0!==i&&"Sprite"===i.type&&this.mdl.remove(i)}},iCn3D.prototype.setStyle2Atoms=function(e){this.style2atoms={};for(var t in e)void 0===this.style2atoms[this.atoms[t].style]&&(this.style2atoms[this.atoms[t].style]={}),this.style2atoms[this.atoms[t].style][t]=1,void 0!==this.atoms[t].style2&&"nothing"!==this.atoms[t].style2&&(void 0===this.style2atoms[this.atoms[t].style2]&&(this.style2atoms[this.atoms[t].style2]={}),this.style2atoms[this.atoms[t].style2][t]=1)},iCn3D.prototype.setAtomStyleByOptions=function(e){void 0===e&&(e=this.opts);var t;if(void 0!==e.proteins){t=this.intHash(this.hAtoms,this.proteins);for(var i in t)this.atoms[i].style=e.proteins.toLowerCase()}if(void 0!==e.sidec&&"nothing"!==e.sidec){t=this.intHash(this.hAtoms,this.sidec);for(var i in t)this.atoms[i].style2=e.sidec.toLowerCase()}if(void 0!==e.chemicals){t=this.intHash(this.hAtoms,this.chemicals);for(var i in t)this.atoms[i].style=e.chemicals.toLowerCase()}if(void 0!==e.ions){t=this.intHash(this.hAtoms,this.ions);for(var i in t)this.atoms[i].style=e.ions.toLowerCase()}if(void 0!==e.water){t=this.intHash(this.hAtoms,this.water);for(var i in t)this.atoms[i].style=e.water.toLowerCase()}if(void 0!==e.nucleotides){t=this.intHash(this.hAtoms,this.nucleotides);for(var i in t)this.atoms[i].style=e.nucleotides.toLowerCase()}},iCn3D.prototype.rebuildSceneBase=function(e){var t=this;if(jQuery.extend(t.opts,e),this.cam_z=2*this.maxD,void 0!==this.scene)for(var i=this.scene.children.length-1;i>=0;i--){var n=this.scene.children[i];this.scene.remove(n)}else this.scene=new THREE.Scene;if(void 0!==this.scene_ghost)for(var i=this.scene_ghost.children.length-1;i>=0;i--){var n=this.scene_ghost.children[i];this.scene_ghost.remove(n)}else this.scene_ghost=new THREE.Scene;this.directionalLight=new THREE.DirectionalLight(16777215,1),this.cam_z>0?this.directionalLight.position.set(0,0,1):this.directionalLight.position.set(0,0,-1);var o=new THREE.AmbientLight(4210752);this.scene.add(this.directionalLight),this.scene.add(o),this.mdl=new THREE.Object3D,this.mdlImpostor=new THREE.Object3D,this.scene.add(this.mdl),this.scene.add(this.mdlImpostor),this.mdl_ghost=new THREE.Object3D,this.scene_ghost.add(this.mdl_ghost),this.objects=[],this.objects_ghost=[],this.raycaster=new THREE.Raycaster,this.projector=new THREE.Projector,this.mouse=new THREE.Vector2;var r=this.backgroundColors[this.opts.background.toLowerCase()];"transparent"===this.opts.background.toLowerCase()?this.renderer.setClearColor(r,0):this.renderer.setClearColor(r,1),this.perspectiveCamera=new THREE.PerspectiveCamera(20,this.container.whratio,.1,1e4),this.perspectiveCamera.position.set(0,0,this.cam_z),this.perspectiveCamera.lookAt(new THREE.Vector3(0,0,0)),this.orthographicCamera=new THREE.OrthographicCamera,this.orthographicCamera.position.set(0,0,this.cam_z),this.orthographicCamera.lookAt(new THREE.Vector3(0,0,0)),this.cams={perspective:this.perspectiveCamera,orthographic:this.orthographicCamera}},iCn3D.prototype.setCamera=function(){if(this.cam=this.cams[this.opts.camera.toLowerCase()],this.cam===this.perspectiveCamera){var e=void 0!==this.biomtMatrices&&this.biomtMatrices.length*this.cnt>10*this.maxatomcnt?1:2;this.cam_z>0?this.cam.position.z=this.maxD*e:this.cam.position.z=-this.maxD*e,"yes"===this.opts.slab?this.cam.near=2*this.maxD:this.cam.near=.1,this.cam.far=1e4,this.controls=new THREE.TrackballControls(this.cam,document.getElementById(this.id),this)}else this.cam===this.orthographicCamera&&(void 0!==this.biomtMatrices&&this.biomtMatrices.length*this.cnt>10*this.maxatomcnt?this.cam.right=this.maxD/2*1.5:this.cam.right=this.maxD/2*2.5,this.cam.left=-this.cam.right,this.cam.top=this.cam.right/this.container.whratio,this.cam.bottom=-this.cam.right/this.container.whratio,"yes"===this.opts.slab?this.cam.near=2*this.maxD:this.cam.near=0,this.cam.far=1e4,this.controls=new THREE.OrthographicTrackballControls(this.cam,document.getElementById(this.id),this));this.cam.updateProjectionMatrix()},iCn3D.prototype.render=function(){this.directionalLight.position.copy(this.cam.position),this.renderer.gammaInput=!0,this.renderer.gammaOutput=!0,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.render(this.scene,this.cam)},iCn3D.prototype.clearImpostors=function(){this.posArray=[],this.colorArray=[],this.pos2Array=[],this.color2Array=[],this.radiusArray=[],this.posArraySphere=[],this.colorArraySphere=[],this.radiusArraySphere=[]},iCn3D.prototype.applyTransformation=function(e,t,i){var n={};n.update=!1,n._zoomFactor=e,n.mouseChange=new THREE.Vector2,n.mouseChange.copy(t),n.quaternion=new THREE.Quaternion,n.quaternion.copy(i),this.controls.update(n)},iCn3D.prototype.applyCenterOptions=function(e){switch(void 0===e&&(e=this.opts),e.rotationcenter.toLowerCase()){case"molecule center":void 0!==this.center&&this.setRotationCenter(this.center);break;case"pick center":void 0!==this.pAtom&&this.setRotationCenter(this.pAtom.coord);break;case"display center":var t=this.centerAtoms(this.dAtoms).center;this.setRotationCenter(t);break;case"highlight center":var t=this.centerAtoms(this.hAtoms).center;this.setRotationCenter(t)}},iCn3D.prototype.setRotationCenter=function(e){this.mdl.position.set(0,0,0),this.mdlImpostor.position.set(0,0,0),this.mdl_ghost.position.set(0,0,0),this.mdl.position.sub(e),this.mdlImpostor.position.sub(e),this.mdl_ghost.position.sub(e)},iCn3D.prototype.applyOriginalColor=function(e){void 0===e&&(e=this.atoms);for(var t in e){var i=e[t],n=i.structure+"_"+i.chain;this.chainsColor.hasOwnProperty(n)?i.color=this.chainsColor[n]:i.color=this.atomColors[i.elem],this.atomPrevColors[t]=i.color}},iCn3D.prototype.onBeforeRender=function(e,t,i,n,o){var r=o.uniforms,s=[];if(r.objectId&&(r.objectId.value=SupportsReadPixelsFloat?this.id:this.id/255,s.push("objectId")),(r.modelViewMatrixInverse||r.modelViewMatrixInverseTranspose||r.modelViewProjectionMatrix||r.modelViewProjectionMatrixInverse)&&this.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,this.matrixWorld),r.modelViewMatrixInverse&&(r.modelViewMatrixInverse.value.getInverse(this.modelViewMatrix),s.push("modelViewMatrixInverse")),r.modelViewMatrixInverseTranspose&&(r.modelViewMatrixInverse?r.modelViewMatrixInverseTranspose.value.copy(r.modelViewMatrixInverse.value).transpose():r.modelViewMatrixInverseTranspose.value.getInverse(this.modelViewMatrix).transpose(),s.push("modelViewMatrixInverseTranspose")),r.modelViewProjectionMatrix&&(i.updateProjectionMatrix(),r.modelViewProjectionMatrix.value.multiplyMatrices(i.projectionMatrix,this.modelViewMatrix),s.push("modelViewProjectionMatrix")),r.modelViewProjectionMatrixInverse){var a=new THREE.Matrix4;r.modelViewProjectionMatrix?(a.copy(r.modelViewProjectionMatrix.value),r.modelViewProjectionMatrixInverse.value.getInverse(a)):(i.updateProjectionMatrix(),a.multiplyMatrices(i.projectionMatrix,this.modelViewMatrix),r.modelViewProjectionMatrixInverse.value.getInverse(a)),s.push("modelViewProjectionMatrixInverse")}if(r.projectionMatrix&&(i.updateProjectionMatrix(),r.projectionMatrix.value.copy(i.projectionMatrix),s.push("projectionMatrix")),r.projectionMatrixInverse&&(i.updateProjectionMatrix(),r.projectionMatrixInverse.value.getInverse(i.projectionMatrix),s.push("projectionMatrixInverse")),s.length){var c=e.properties.get(o);if(c.program){var d=e.getContext(),l=c.program;d.useProgram(l.program);var p=l.getUniforms();s.forEach(function(e){p.setValue(d,e,r[e].value)})}}},iCn3D.prototype.setParametersForShader=function(e){var t=this.backgroundColors[this.opts.background.toLowerCase()],i=1.5*this.maxD,n=3*this.maxD,o=void 0!==e?e:1;this.uniforms=THREE.UniformsUtils.merge([THREE.UniformsLib.common,{modelViewMatrix:{value:new THREE.Matrix4},modelViewMatrixInverse:{value:new THREE.Matrix4},modelViewMatrixInverseTranspose:{value:new THREE.Matrix4},modelViewProjectionMatrix:{value:new THREE.Matrix4},modelViewProjectionMatrixInverse:{value:new THREE.Matrix4},projectionMatrix:{value:new THREE.Matrix4},projectionMatrixInverse:{value:new THREE.Matrix4},diffuse:{type:"v3",value:[1,1,1]},emissive:{type:"v3",value:[0,0,0]},roughness:{type:"f",value:.5},metalness:{type:"f",value:.3},opacity:{type:"f",value:o},nearClip:{type:"f",value:.1},ortho:{type:"f",value:0},shrink:{type:"f",value:.13},fogColor:{type:"v3",value:[t.r,t.g,t.b]},fogNear:{type:"f",value:i},fogFar:{type:"f",value:n},fogDensity:{type:"f",value:2}},THREE.UniformsLib.ambient,THREE.UniformsLib.lights]),this.defines={USE_COLOR:1,NEAR_CLIP:1,CAP:1},"yes"===this.opts.fog&&(this.defines.USE_FOG=1,"orthographic"===this.opts.camera&&(this.defines.FOG_EXP2=1)),this.bExtFragDepth&&(this.defines.USE_LOGDEPTHBUF_EXT=1)},iCn3D.prototype.drawImpostorShader=function(){this.setParametersForShader(),this.createImpostorShaderSphere("SphereImpostor"),this.createImpostorShaderCylinder("CylinderImpostor")},iCn3D.prototype.getShader=function(e){var t=$NGL_shaderTextHash[e],i=/#include\s+(\S+)/gim;return t=t.replace(i,function(e,t){var i;return THREE.ShaderChunk.hasOwnProperty(t)&&(i=THREE.ShaderChunk[t]),i?i:""})},iCn3D.prototype.createImpostorShaderBase=function(e,t,i,n,o,r,s,a,c){var d=this,l=new THREE.ShaderMaterial({defines:d.defines,uniforms:d.uniforms,vertexShader:d.getShader(e+".vert"),fragmentShader:d.getShader(e+".frag"),depthTest:!0,depthWrite:!0,needsUpdate:!0,lights:!0});l.extensions.fragDepth=!0,"CylinderImpostor"==e?this.CylinderImpostorMaterial=l:"SphereImpostor"==e&&(this.SphereImpostorMaterial=l);for(var p,h,u=r*s,m=r*a,f=u>65535?Uint32Array:Uint16Array,v=new f(m),g=0;g<r;g++){p=g*a,h=g*s,v.set(i,p);for(var b=0;b<a;++b)v[p+b]+=h;
}var y=new THREE.BufferGeometry,_=!0;v&&(y.setIndex(new THREE.BufferAttribute(v,1)),y.getIndex().setDynamic(_));var w={f:1,v2:2,v3:3,c:3};for(var C in o){var S,A=o[C];S=new Float32Array(u*w[A.type]),y.addAttribute(C,new THREE.BufferAttribute(S,w[A.type]).setDynamic(_))}var A,k,E,x,R,T,H=y.attributes;for(var C in n){k=n[C],A=H[C],E=A.itemSize,x=A.array;for(var D=0;D<r;++D){m=D*E,R=m*s;for(var I=0;I<s;++I){T=R+E*I;for(var O=0;O<E;++O)x[T+O]=k[m+O]}}A.needsUpdate=!0}for(var M=y.attributes.mapping.array,g=0;g<r;g++)M.set(t,g*c*s);var L=new THREE.Mesh(y,l);L.frustumCulled=!1,L.scale.x=L.scale.y=L.scale.z=1,"CylinderImpostor"==e?L.type="Cylinder":"SphereImpostor"==e&&(L.type="Sphere"),L.onBeforeRender=this.onBeforeRender,this.mdlImpostor.add(L)},iCn3D.prototype.createImpostorShaderCylinder=function(e){var t=this,i=new Float32Array(t.posArray),n=new Float32Array(t.colorArray),o=new Float32Array(t.pos2Array),r=new Float32Array(t.color2Array),s=new Float32Array(t.radiusArray),a=new Float32Array([-1,1,-1,-1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,-1,1]),c=new Uint16Array([0,1,2,1,4,2,2,4,3,4,5,3]),d=12,l="v3",p=6,h=3,u=i.length/3,m={position1:i,color:n,position2:o,color2:r,radius:s},f={position1:{type:"v3",value:null},color:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"v3",value:null},radius:{type:"f",value:null},mapping:{type:l,value:null}};this.createImpostorShaderBase(e,a,c,m,f,u,p,d,h),m=null,i=null,n=null,o=null,r=null,s=null,t.posArray=null,t.colorArray=null,t.pos2Array=null,t.color2Array=null,t.radiusArray=null},iCn3D.prototype.createImpostorShaderSphere=function(e){var t=this,i=new Float32Array(t.posArraySphere),n=new Float32Array(t.colorArraySphere),o=new Float32Array(t.radiusArraySphere),r=new Float32Array([-1,1,-1,-1,1,1,1,-1]),s=new Uint16Array([0,1,2,1,3,2]),a=6,c="v2",d=4,l=2,p=i.length/3,h={position:i,color:n,radius:o},u={position:{type:"v3",value:null},color:{type:"v3",value:null},radius:{type:"f",value:null},mapping:{type:c,value:null}};this.createImpostorShaderBase(e,r,s,h,u,p,d,a,l),h=null,i=null,n=null,o=null,t.posArraySphere=null,t.colorArraySphere=null,t.radiusArraySphere=null},iCn3D.prototype.positionFromGeometry=function(e){for(var t,i,n=e.geometry,o=n.vertices,r=e.position,s=e.scale,a=e.matrix,c=o.length,d=[],l=0;l<c;l++)t=3*l,i="SphereGeometry"==n.type||"BoxGeometry"==n.type?o[l].clone().multiply(s).add(r):"CylinderGeometry"==n.type?o[l].clone().applyMatrix4(a):o[l],d[t+0]=i.x,d[t+1]=i.y,d[t+2]=i.z;return d},iCn3D.prototype.colorFromGeometry=function(e){var t=e.geometry,i=new THREE.Color(1,1,1);"SphereGeometry"!=t.type&&"BoxGeometry"!=t.type&&"CylinderGeometry"!=t.type||void 0!==e.material&&(i=e.material.color);for(var n,o,r,s,a,c=t.faces,d=(t.vertices.length,"Surface"==t.type,c.length),l=[],p=0;p<d;p++)o=c[p],"Surface"==t.type?(r=o.vertexColors[0],s=o.vertexColors[1],a=o.vertexColors[2]):"SphereGeometry"==t.type||"BoxGeometry"==t.type||"CylinderGeometry"==t.type?(r=i,s=i,a=i):(r=o.color,s=o.color,a=o.color),n=3*o.a,l[n+0]=r.r,l[n+1]=r.g,l[n+2]=r.b,n=3*o.b,l[n+0]=s.r,l[n+1]=s.g,l[n+2]=s.b,n=3*o.c,l[n+0]=a.r,l[n+1]=a.g,l[n+2]=a.b;return l},iCn3D.prototype.indexFromGeometry=function(e){for(var t,i,n=e.geometry,o=n.faces,r=o.length,s=[],a=0;a<r;a++)t=3*a,i=o[a],s[t+0]=i.a,s[t+1]=i.b,s[t+2]=i.c;return s},iCn3D.prototype.normalFromGeometry=function(e){for(var t,i,n,o,r,s,a=e.geometry,c=a.faces,d=(a.vertices.length,c.length),l=[],p=0;p<d;p++)i=c[p],n=i.vertexNormals,o=n[0],r=n[1],s=n[2],t=3*i.a,l[t+0]=o.x,l[t+1]=o.y,l[t+2]=o.z,t=3*i.b,l[t+0]=r.x,l[t+1]=r.y,l[t+2]=r.z,t=3*i.c,l[t+0]=s.x,l[t+1]=s.y,l[t+2]=s.z;return l},iCn3D.prototype.hashvalue2array=function(e){var t=[];for(var i in e)t.push(e[i]);return t},iCn3D.prototype.drawSymmetryMates=function(){this.bInstanced&&Object.keys(this.atoms).length*this.biomtMatrices.length>this.maxatomcnt?this.drawSymmetryMatesInstancing():this.drawSymmetryMatesNoInstancing()},iCn3D.prototype.drawSymmetryMatesNoInstancing=function(){if(void 0!==this.biomtMatrices&&0!=this.biomtMatrices.length){var e=1,t=this.center.clone(),i=new THREE.Matrix4;i.identity();for(var n=0;n<this.biomtMatrices.length;n++){var o=this.biomtMatrices[n];if(void 0!==o&&!o.equals(i)){var r=this.mdl.clone();r.applyMatrix(o),this.mdl.add(r),r=this.mdlImpostor.clone(),r.applyMatrix(o);for(var s=r.children.length-1;s>=0;s--){var a=r.children[s];a.onBeforeRender=this.onBeforeRender}this.mdlImpostor.add(r),r=this.mdl_ghost.clone(),r.applyMatrix(o),this.mdl_ghost.add(r);var c=this.center.clone();c.applyMatrix4(o),t.add(c),++e}}void 0!==this.bSetInstancing&&this.bSetInstancing?(this.maxD=this.maxDAssembly,this.center=this.centerAssembly.clone(),this.setCenter(this.center),this.setCamera()):(this.maxD*=Math.sqrt(e),this.center=t.multiplyScalar(1/e),this.maxDAssembly=this.maxD,this.centerAssembly=this.center.clone(),this.setCenter(this.center),this.setCamera()),this.bSetInstancing=!0}},iCn3D.prototype.createInstancedGeometry=function(e){var t=e.geometry,i=new THREE.InstancedBufferGeometry,n=[],o=[],r=[],s=[],a=[],c=[],d=[],l=[];if(t.vertices&&t.faces){this.instancedMaterial=this.getInstancedMaterial("Instancing");var p=this.positionFromGeometry(e),h=this.normalFromGeometry(e),u=this.colorFromGeometry(e),m=this.indexFromGeometry(e);n=n.concat(p),o=o.concat(h),r=r.concat(u),s=s.concat(m);for(var f=[],v="CylinderGeometry"==t.type?1:0,g=0,b=n.length/3;g<b;++g)f.push(v);i.addAttribute("position",new THREE.BufferAttribute(new Float32Array(n),3)),i.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(o),3)),i.addAttribute("color",new THREE.BufferAttribute(new Float32Array(r),3)),i.addAttribute("cylinder",new THREE.BufferAttribute(new Float32Array(f),1)),i.setIndex(new THREE.BufferAttribute(new Uint32Array(s),1)),p=null,h=null,u=null,m=null}else if(this.bImpo&&void 0!==t.attributes.color2){this.instancedMaterial=this.getInstancedMaterial("CylinderInstancing");var p=this.hashvalue2array(t.attributes.position1.array),u=this.hashvalue2array(t.attributes.color.array),y=this.hashvalue2array(t.attributes.position2.array),_=this.hashvalue2array(t.attributes.color2.array),m=this.hashvalue2array(t.index.array),w=this.hashvalue2array(t.attributes.radius.array),C=this.hashvalue2array(t.attributes.mapping.array);n=n.concat(p),r=r.concat(u),d=d.concat(y),l=l.concat(_),s=s.concat(m),a=a.concat(w),c=c.concat(C),i.addAttribute("position1",new THREE.BufferAttribute(new Float32Array(n),3)),i.addAttribute("color",new THREE.BufferAttribute(new Float32Array(r),3)),i.addAttribute("position2",new THREE.BufferAttribute(new Float32Array(d),3)),i.addAttribute("color2",new THREE.BufferAttribute(new Float32Array(l),3)),i.addAttribute("radius",new THREE.BufferAttribute(new Float32Array(a),1)),i.addAttribute("mapping",new THREE.BufferAttribute(new Float32Array(c),3)),i.setIndex(new THREE.BufferAttribute(new Uint32Array(s),1)),p=null,u=null,y=null,_=null,m=null,w=null,C=null}else if(this.bImpo&&void 0!==t.attributes.color){this.instancedMaterial=this.getInstancedMaterial("SphereInstancing");var p=this.hashvalue2array(t.attributes.position.array),u=this.hashvalue2array(t.attributes.color.array),m=this.hashvalue2array(t.index.array),w=this.hashvalue2array(t.attributes.radius.array),C=this.hashvalue2array(t.attributes.mapping.array);n=n.concat(p),r=r.concat(u),s=s.concat(m),a=a.concat(w),c=c.concat(C),i.addAttribute("position",new THREE.BufferAttribute(new Float32Array(n),3)),i.addAttribute("color",new THREE.BufferAttribute(new Float32Array(r),3)),i.addAttribute("radius",new THREE.BufferAttribute(new Float32Array(a),1)),i.addAttribute("mapping",new THREE.BufferAttribute(new Float32Array(c),2)),i.setIndex(new THREE.BufferAttribute(new Uint32Array(s),1)),p=null,u=null,m=null,w=null,C=null}n=null,o=null,r=null,s=null,a=null,c=null,d=null,l=null;var S=new THREE.InstancedBufferAttribute(new Float32Array(this.matricesElements1),4),A=new THREE.InstancedBufferAttribute(new Float32Array(this.matricesElements2),4),k=new THREE.InstancedBufferAttribute(new Float32Array(this.matricesElements3),4),E=new THREE.InstancedBufferAttribute(new Float32Array(this.matricesElements4),4);return i.addAttribute("matrix1",S),i.addAttribute("matrix2",A),i.addAttribute("matrix3",k),i.addAttribute("matrix4",E),i},iCn3D.prototype.getInstancedMaterial=function(e){var t=new THREE.ShaderMaterial({defines:this.defines,uniforms:this.uniforms,vertexShader:this.getShader(e+".vert"),fragmentShader:this.getShader(e+".frag"),depthTest:!0,depthWrite:!0,needsUpdate:!0,lights:!0});return t.extensions.fragDepth=!0,t.extensions.derivatives="#extension GL_OES_standard_derivatives : enable",t},iCn3D.prototype.drawSymmetryMatesInstancing=function(){if(void 0!==this.biomtMatrices&&0!=this.biomtMatrices.length){var e=1,t=this.center.clone();if(this.setParametersForShader(),void 0===this.bSetInstancing||!this.bSetInstancing){this.matricesElements1=[],this.matricesElements2=[],this.matricesElements3=[],this.matricesElements4=[];var i=new THREE.Matrix4;i.identity();for(var n=0;n<this.biomtMatrices.length;n++){var o=this.biomtMatrices[n];if(void 0!==o){var r=o.toArray();if(!o.equals(i)){this.matricesElements1.push(r[0],r[1],r[2],r[3]),this.matricesElements2.push(r[4],r[5],r[6],r[7]),this.matricesElements3.push(r[8],r[9],r[10],r[11]),this.matricesElements4.push(r[12],r[13],r[14],r[15]);var s=this.center.clone();s.applyMatrix4(o),t.add(s),++e}}}}for(var n=0,a=this.mdl.children.length;n<a;++n){var c=this.mdl.children[n];if("Sprite"!==c.type){var d=this.createInstancedGeometry(c),l=new THREE.Mesh(d,this.instancedMaterial);l.onBeforeRender=this.onBeforeRender,l.frustumCulled=!1,d=void 0,this.mdl.add(l)}}for(var n=0,a=this.mdlImpostor.children.length;n<a;++n){var c=this.mdlImpostor.children[n],d=this.createInstancedGeometry(c),l=new THREE.Mesh(d,this.instancedMaterial);l.onBeforeRender=this.onBeforeRender,l.frustumCulled=!1,d=null,this.mdlImpostor.add(l)}void 0!==this.bSetInstancing&&this.bSetInstancing?(this.maxD=this.maxDAssembly,this.center=this.centerAssembly.clone(),this.setCenter(this.center),this.setCamera()):(this.maxD*=Math.sqrt(e),this.center=t.multiplyScalar(1/e),this.maxDAssembly=this.maxD,this.centerAssembly=this.center.clone(),this.setCenter(this.center),this.setCamera()),this.bSetInstancing=!0}},iCn3D.prototype.cloneHash=function(e){var t={};for(var i in e)t[i]=e[i];return t},iCn3D.prototype.residueName2Abbr=function(e){switch(void 0!==e&&" "!==e.charAt(0)&&" "===e.charAt(1)&&(e=e.charAt(0)),e){case"  A":return"A";case"  C":return"C";case"  G":return"G";case"  T":return"T";case"  U":return"U";case"  I":return"I";case" DA":return"A";case" DC":return"C";case" DG":return"G";case" DT":return"T";case" DU":return"U";case" DI":return"I";case"ALA":return"A";case"ARG":return"R";case"ASN":return"N";case"ASP":return"D";case"CYS":return"C";case"GLU":return"E";case"GLN":return"Q";case"GLY":return"G";case"HIS":return"H";case"ILE":return"I";case"LEU":return"L";case"LYS":return"K";case"MET":return"M";case"PHE":return"F";case"PRO":return"P";case"SER":return"S";case"THR":return"T";case"TRP":return"W";case"TYR":return"Y";case"VAL":return"V";case"SEC":return"U";case"HOH":return"O";case"WAT":return"O";default:return e}},iCn3D.prototype.intHash=function(e,t){var i={};if(Object.keys(e).length<Object.keys(t).length)for(var n in e)void 0!==t&&t[n]&&(i[n]=e[n]);else for(var n in t)void 0!==e&&e[n]&&(i[n]=t[n]);return e={},t={},i},iCn3D.prototype.exclHash=function(e,t){var i={};for(var n in e)n in t||(i[n]=e[n]);return e={},t={},i},iCn3D.prototype.unionHash=function(e,t){return this.unionHashNotInPlace(e,t)},iCn3D.prototype.unionHashNotInPlace=function(e,t){var i=jQuery.extend({},e,t);return e={},t={},i},iCn3D.prototype.intHash2Atoms=function(e,t){return this.hash2Atoms(this.intHash(e,t))},iCn3D.prototype.exclHash2Atoms=function(e,t){return this.hash2Atoms(this.exclHash(e,t))},iCn3D.prototype.unionHash2Atoms=function(e,t){return this.hash2Atoms(this.unionHash(e,t))},iCn3D.prototype.hash2Atoms=function(e){var t={};for(var i in e)t[i]=this.atoms[i];return e={},t},iCn3D.prototype.exportCanvas=function(){this.render(),window.open(this.renderer.domElement.toDataURL("image/png"))},iCn3D.prototype.zoomIn=function(e){var t={};t._zoomFactor=1-e,t.update=!0,this.controls.update(t),this.render()},iCn3D.prototype.zoomOut=function(e){var t={};t._zoomFactor=1+e,t.update=!0,this.controls.update(t),this.render()},iCn3D.prototype.rotateLeft=function(e){var t=new THREE.Vector3(0,1,0),i=-e/180*Math.PI;t.applyQuaternion(this.cam.quaternion).normalize();var n=new THREE.Quaternion;n.setFromAxisAngle(t,-i);var o={};o.quaternion=n,o.update=!0,this.controls.update(o),this.render()},iCn3D.prototype.rotateRight=function(e){var t=new THREE.Vector3(0,1,0),i=e/180*Math.PI;t.applyQuaternion(this.cam.quaternion).normalize();var n=new THREE.Quaternion;n.setFromAxisAngle(t,-i);var o={};o.quaternion=n,o.update=!0,this.controls.update(o),this.render()},iCn3D.prototype.rotateUp=function(e){var t=new THREE.Vector3(1,0,0),i=-e/180*Math.PI;t.applyQuaternion(this.cam.quaternion).normalize();var n=new THREE.Quaternion;n.setFromAxisAngle(t,-i);var o={};o.quaternion=n,o.update=!0,this.controls.update(o),this.render()},iCn3D.prototype.rotateDown=function(e){var t=new THREE.Vector3(1,0,0),i=e/180*Math.PI;t.applyQuaternion(this.cam.quaternion).normalize();var n=new THREE.Quaternion;n.setFromAxisAngle(t,-i);var o={};o.quaternion=n,o.update=!0,this.controls.update(o),this.render()},iCn3D.prototype.translateLeft=function(e){var t=new THREE.Vector2(0,0);t.x-=e/100;var i={};i.mouseChange=t,i.update=!0,this.controls.update(i),this.render()},iCn3D.prototype.translateRight=function(e){var t=new THREE.Vector2(0,0);t.x+=e/100;var i={};i.mouseChange=t,i.update=!0,this.controls.update(i),this.render()},iCn3D.prototype.translateUp=function(e){var t=new THREE.Vector2(0,0);t.y-=e/100;var i={};i.mouseChange=t,i.update=!0,this.controls.update(i),this.render()},iCn3D.prototype.translateDown=function(e){var t=new THREE.Vector2(0,0);t.y+=e/100;var i={};i.mouseChange=t,i.update=!0,this.controls.update(i),this.render()},iCn3D.prototype.showPickingHilight=function(e){if(this.bShift||this.bCtrl||this.removeHlObjects(),this.pickedAtomList={},1===this.pk)this.pickedAtomList[e.serial]=1;else if(2===this.pk){var t=e.structure+"_"+e.chain+"_"+e.resi;this.pickedAtomList=this.residues[t]}else if(3===this.pk)this.pickedAtomList=this.selectStrandHelixFromAtom(e);else if(4===this.pk){var i=e.structure+"_"+e.chain;this.pickedAtomList=this.chains[i]}0===this.pk?this.bShowHighlight=!1:this.bShowHighlight=!0;var n=Object.keys(this.hAtoms).length==Object.keys(this.atoms).length?{}:this.intHash(this.hAtoms,this.pickedAtomList),o=Object.keys(n).length;if(this.bShift||this.bCtrl)if(this.bShift){if(void 0===this.prevPickedAtomList)this.hAtoms=this.unionHash(this.hAtoms,this.pickedAtomList);else{var r=this.getFirstAtomObj(this.prevPickedAtomList),s=this.getFirstAtomObj(this.pickedAtomList),a=r.structure+"_"+r.chain,c=s.structure+"_"+s.chain;if(a!=c)this.hAtoms=this.unionHash(this.hAtoms,this.pickedAtomList);else for(var d=this.unionHash(this.prevPickedAtomList,this.pickedAtomList),l=this.getFirstAtomObj(d),p=this.getLastAtomObj(d),h=l.serial;h<=p.serial;++h)this.hAtoms[h]=1}this.prevPickedAtomList=this.cloneHash(this.pickedAtomList)}else this.bCtrl&&(o>0?this.hAtoms=this.exclHash(this.hAtoms,this.pickedAtomList):this.hAtoms=this.unionHash(this.hAtoms,this.pickedAtomList));else this.hAtoms=this.cloneHash(this.pickedAtomList);this.removeHlObjects(),this.addHlObjects()},iCn3D.prototype.showPicking=function(e,t,i){this.showPickingBase(e,t,i)},iCn3D.prototype.showPickingBase=function(e,t,i){void 0===t&&void 0===i&&this.showPickingHilight(e)},iCn3D.prototype.removeHlObjects=function(){for(var e in this.prevHighlightObjects)this.mdl.remove(this.prevHighlightObjects[e]);this.prevHighlightObjects=[];for(var e in this.prevHighlightObjects_ghost)this.mdl.remove(this.prevHighlightObjects_ghost[e]);this.prevHighlightObjects_ghost=[]},iCn3D.prototype.addHlObjects=function(e,t,i){void 0===e&&(e=this.hColor),void 0===i&&(i=this.hAtoms),this.applyDisplayOptions(this.opts,this.intHash(i,this.dAtoms),this.bHighlight),(void 0===t||t)&&this.render()},iCn3D.prototype.resetOrientation=function(){var e=!1;if(this.commands.length>0){var t=this.commands[0].split("|||");if(2==t.length){var i=JSON.parse(t[1]);this._zoomFactor=i.factor,this.mouseChange.x=i.mouseChange.x,this.mouseChange.y=i.mouseChange.y,this.quaternion._x=i.quaternion._x,this.quaternion._y=i.quaternion._y,this.quaternion._z=i.quaternion._z,this.quaternion._w=i.quaternion._w,e=!0}}e||(this._zoomFactor=1,this.mouseChange=new THREE.Vector2(0,0),this.quaternion=new THREE.Quaternion(0,0,0,1)),this.maxD=this.oriMaxD,this.center=this.oriCenter.clone(),"show"==this.ori_chemicalbinding?this.bSkipChemicalbinding=!1:"hide"==this.ori_chemicalbinding&&(this.bSkipChemicalbinding=!0)},iCn3D.prototype.getAtomsFromPosition=function(e,t){var i,n;void 0!==t&&null!==t||(t=1);for(i in this.atoms){var n=this.atoms[i];if(this.ions.hasOwnProperty(i)&&"sphere"===this.opts.ions){var o=this.vdwRadii[n.elem];if(Math.abs(n.coord.x-e.x)-o>t)continue;if(Math.abs(n.coord.y-e.y)-o>t)continue;if(Math.abs(n.coord.z-e.z)-o>t)continue}else{if(n.coord.x<e.x-t||n.coord.x>e.x+t)continue;if(n.coord.y<e.y-t||n.coord.y>e.y+t)continue;if(n.coord.z<e.z-t||n.coord.z>e.z+t)continue}return n}return null},iCn3D.prototype.getFirstAtomObj=function(e){if(void 0==e)return this.atoms[0];var t=Object.keys(e),i=t[0];return this.atoms[i]},iCn3D.prototype.getFirstCalphaAtomObj=function(e){if(void 0==e)return this.atoms[0];var t;for(var i in e)if("CA"==this.atoms[i].name){t=i;break}return void 0!==t?this.atoms[t]:this.getFirstAtomObj(e)},iCn3D.prototype.getLastAtomObj=function(e){var t=Object.keys(e),i=t[t.length-1];return this.atoms[i]},iCn3D.prototype.hexToRgb=function(e,t){var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16),a:t}:null},iCn3D.prototype.selectStrandHelixFromAtom=function(e){var t=e,i=e,n={},o=t.resi;if(!t.ssbegin){for(var r=t.resi-1;r>0;--r){var s=t.structure+"_"+t.chain+"_"+r;if(!this.residues.hasOwnProperty(s))break;var e=this.getFirstCalphaAtomObj(this.residues[s]);if(o=e.resi,"coil"!==t.ss&&e.ss===t.ss&&e.ssbegin||"coil"===t.ss&&e.ss!==t.ss){"coil"===t.ss&&e.ss!==t.ss&&(o=e.resi+1);break}}for(var r=o;r<=t.resi;++r){var s=t.structure+"_"+t.chain+"_"+r;n=this.unionHash(n,this.hash2Atoms(this.residues[s]))}}for(var a=i.resi,c=this.getLastAtomObj(this.chains[i.structure+"_"+i.chain]).resi,r=i.resi+1;r<=c;++r){var s=i.structure+"_"+i.chain+"_"+r;if(!this.residues.hasOwnProperty(s))break;var e=this.getFirstCalphaAtomObj(this.residues[s]);if(a=e.resi,"coil"!==i.ss&&e.ss===i.ss&&e.ssend||"coil"===i.ss&&e.ss!==i.ss){"coil"===i.ss&&e.ss!==i.ss&&(a=e.resi-1);break}}for(var r=i.resi+1;r<=a;++r){var s=i.structure+"_"+i.chain+"_"+r;n=this.unionHash(n,this.hash2Atoms(this.residues[s]))}return n},iCn3D.prototype.addNonCarbonAtomLabels=function(e){var t=18,i="#FFFFFF",n=this.intHash(this.hAtoms,e);void 0===this.labels.schematic&&(this.labels.schematic=[]);for(var o in n){var r=this.atoms[o];if(this.residues.hasOwnProperty(r.structure+"_"+r.chain+"_"+r.resi)&&"C"!==r.elem){var s={};s.position=r.coord,s.bSchematic=1,s.text=r.elem,s.size=t,s.color="#"+r.color.getHexString(),s.background=i,this.labels.schematic.push(s)}}this.removeHlObjects()},iCn3D.prototype.addResiudeLabels=function(e,t,i){var n=18,o="#CCCCCC";void 0===i&&(i=1);var r=this.intHash(this.hAtoms,e);t?void 0===this.labels.schematic&&(this.labels.schematic=[]):void 0===this.labels.residue&&(this.labels.residue=[]);var s="";for(var a in r){var c=this.atoms[a],d={},l=c.structure+"_"+c.chain+"_"+c.resi;if(!c.het&&("CA"===c.name||"O3'"===c.name||"O3*"===c.name)||this.water.hasOwnProperty(c.serial)||this.ions.hasOwnProperty(c.serial)||this.chemicals.hasOwnProperty(c.serial)&&l!==s){d.position=c.coord,d.bSchematic=0,t&&(d.bSchematic=1),d.text=this.residueName2Abbr(c.resn),d.size=n;var p=c.color.getHexString().toUpperCase();d.color="CCCCCC"===p||"C8C8C8"===p?"#888888":"#"+p,d.background=o,t?this.labels.schematic.push(d):this.labels.residue.push(d)}s=l}this.removeHlObjects()},iCn3D.prototype.setCenter=function(e){this.mdl.position.set(0,0,0),this.mdlImpostor.position.set(0,0,0),this.mdl_ghost.position.set(0,0,0),this.mdl.position.sub(e),this.mdlImpostor.position.sub(e),this.mdl_ghost.position.sub(e)},iCn3D.prototype.getResiduesFromAtoms=function(e){var t={};for(var i in e){var n=this.atoms[i].structure+"_"+this.atoms[i].chain+"_"+this.atoms[i].resi;t[n]=1}return t},iCn3D.prototype.getResiduesFromCalphaAtoms=function(e){var t={};for(var i in e)if("CA"==this.atoms[i].name&&this.proteins.hasOwnProperty(i)||!this.proteins.hasOwnProperty(i)){var n=this.atoms[i].structure+"_"+this.atoms[i].chain+"_"+this.atoms[i].resi;t[n]=1}return t},function(e){"use strict";var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,i=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),n=i&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),o=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,r=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,s=(i||o)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,s,a,c,d,l,p,h,u;if(t=e.match(r),!t)throw new Error("invalid data URI");for(s=t[2]?t[1]:"text/plain"+(t[3]||";charset=US-ASCII"),a=!!t[4],c=e.slice(t[0].length),d=a?atob(c):decodeURIComponent(c),l=new ArrayBuffer(d.length),p=new Uint8Array(l),h=0;h<d.length;h+=1)p[h]=d.charCodeAt(h);return i?new Blob([n?p:l],{type:s}):(u=new o,u.append(l),u.getBlob(s))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,i,n){var o=this;setTimeout(function(){e(n&&t.toDataURL&&s?s(o.toDataURL(i,n)):o.mozGetAsFile("blob",i))})}:t.toDataURL&&s&&(t.toBlob=function(e,t,i){var n=this;setTimeout(function(){e(s(n.toDataURL(t,i)))})})),"function"==typeof define&&define.amd?define(function(){return s}):"object"==typeof module&&module.exports?module.exports=s:e.dataURLtoBlob=s}(window);var saveAs=saveAs||function(e){"use strict";if(!("undefined"==typeof e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,i=function(){return e.URL||e.webkitURL||e},n=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in n,r=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},s=/constructor/i.test(e.HTMLElement)||e.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent),c=e.setImmediate||e.setTimeout,d=function(e){c(function(){throw e},0)},l="application/octet-stream",p=4e4,h=function(e){var t=function(){"string"==typeof e?i().revokeObjectURL(e):e.remove()};setTimeout(t,p)},u=function(e,t,i){t=[].concat(t);for(var n=t.length;n--;){var o=e["on"+t[n]];if("function"==typeof o)try{o.call(e,i||e)}catch(r){d(r)}}},m=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},f=function(t,d,p){p||(t=m(t));var f,v=this,g=t?t.type:void 0,b=g===l,y=function(){u(v,"writestart progress write writeend".split(" "))},_=function(){if((a||b&&s)&&e.FileReader){var n=new FileReader;return n.onloadend=function(){var t=a?n.result:n.result.replace(/^data:[^;]*;/,"data:attachment/file;"),i=e.open(t,"_blank");i||(e.location.href=t),t=void 0,v.readyState=v.DONE,y()},n.readAsDataURL(t),void(v.readyState=v.INIT)}if(f||(f=i().createObjectURL(t)),b)e.location.href=f;else{var o=e.open(f,"_blank");o||(e.location.href=f)}v.readyState=v.DONE,y(),h(f)};return v.readyState=v.INIT,o?(f||(f=i().createObjectURL(t)),void c(function(){n.href=f,n.download=d,r(n),y(),h(f),v.readyState=v.DONE},0)):void _()},v=f.prototype,g=function(e,t,i){return new f(e,t||e.name||"download",i)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,i){return t=t||e.name||"download",i||(e=m(e)),navigator.msSaveOrOpenBlob(e,t)}:(v.abort=function(){},v.readyState=v.INIT=0,v.WRITING=1,v.DONE=2,v.error=v.onwritestart=v.onprogress=v.onwrite=v.onabort=v.onerror=v.onwriteend=null,g)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this),$3Dmol=$3Dmol||{};$3Dmol.MarchingCubeInitializer=function(){var e=2,t={};t.march=function(t,s,a,c){var d=!!c.fulltable,l=c.hasOwnProperty("origin")&&c.origin.hasOwnProperty("x")?c.origin:{x:0,y:0,z:0},p=!!c.voxel,h=c.matrix,u=c.nX||0,m=c.nY||0,f=c.nZ||0,v=c.scale||1,g=null;g=c.unitCube?c.unitCube:{x:v,y:v,z:v};var b,y,_=new Int32Array(u*m*f);for(b=0,y=_.length;b<y;++b)_[b]=-1;var w=function(e,t,i,n,o,r){var a={x:0,y:0,z:0},c=!!(n&1<<o),d=!!(n&1<<r),u=o;!c&&d&&(u=r),1&u&&i++,2&u&&t++,4&u&&e++,h?(a=new $3Dmol.Vector3(e,t,i),a=a.applyMatrix4(h),a={x:a.x,y:a.y,z:a.z}):(a.x=l.x+g.x*e,a.y=l.y+g.y*t,a.z=l.z+g.z*i);var v=(m*e+t)*f+i;return p?(s.push(a),s.length-1):(_[v]<0&&(_[v]=s.length,s.push(a)),_[v])},C=new Int32Array(12),S=d?o:i,A=d?r:n;for(b=0;b<u-1;++b)for(var k=0;k<m-1;++k)for(var E=0;E<f-1;++E){for(var x=0,R=0;R<8;++R){var T=(m*(b+((4&R)>>2))+k+((2&R)>>1))*f+E+(1&R),H=!!(t[T]&e);x|=H<<R}if(0!==x&&255!==x){var D=S[x];if(0!==D){var I=A[x];1&D&&(C[0]=w(b,k,E,x,0,1)),2&D&&(C[1]=w(b,k,E,x,1,3)),4&D&&(C[2]=w(b,k,E,x,3,2)),8&D&&(C[3]=w(b,k,E,x,2,0)),16&D&&(C[4]=w(b,k,E,x,4,5)),32&D&&(C[5]=w(b,k,E,x,5,7)),64&D&&(C[6]=w(b,k,E,x,7,6)),128&D&&(C[7]=w(b,k,E,x,6,4)),256&D&&(C[8]=w(b,k,E,x,0,4)),512&D&&(C[9]=w(b,k,E,x,1,5)),1024&D&&(C[10]=w(b,k,E,x,3,7)),2048&D&&(C[11]=w(b,k,E,x,2,6));for(var O=0;O<I.length;O+=3){var M=C[I[O]],L=C[I[O+1]],$=C[I[O+2]];p&&O>=3&&(s.push(s[M]),M=s.length-1,s.push(s[L]),L=s.length-1,s.push(s[$]),$=s.length-1),a.push(M),a.push(L),a.push($)}}}}},t.laplacianSmooth=function(e,t,i){var n,o,r,s,a,c=new Array(t.length);for(n=0,o=t.length;n<o;n++)c[n]={x:0,y:0,z:0};var d,l=new Array(20);for(n=0;n<20;n++)l[n]=new Array(t.length);for(n=0,o=t.length;n<o;n++)l[0][n]=0;for(n=0,o=i.length/3;n<o;n++){var p=3*n,h=3*n+1,u=3*n+2;for(d=!0,r=0,s=l[0][i[p]];r<s;r++)if(i[h]==l[r+1][i[p]]){d=!1;break}for(d&&(l[0][i[p]]++,l[l[0][i[p]]][i[p]]=i[h]),d=!0,r=0,s=l[0][i[p]];r<s;r++)if(i[u]==l[r+1][i[p]]){d=!1;break}for(d&&(l[0][i[p]]++,l[l[0][i[p]]][i[p]]=i[u]),d=!0,r=0,s=l[0][i[h]];r<s;r++)if(i[p]==l[r+1][i[h]]){d=!1;break}for(d&&(l[0][i[h]]++,l[l[0][i[h]]][i[h]]=i[p]),d=!0,r=0,s=l[0][i[h]];r<s;r++)if(i[u]==l[r+1][i[h]]){d=!1;break}for(d&&(l[0][i[h]]++,l[l[0][i[h]]][i[h]]=i[u]),d=!0,r=0;r<l[0][i[u]];r++)if(i[p]==l[r+1][i[u]]){d=!1;break}for(d&&(l[0][i[u]]++,l[l[0][i[u]]][i[u]]=i[p]),d=!0,r=0,s=l[0][i[u]];r<s;r++)if(i[h]==l[r+1][i[u]]){d=!1;break}d&&(l[0][i[u]]++,l[l[0][i[u]]][i[u]]=i[h])}var m=1,f=.5;for(a=0;a<e;a++){for(n=0,o=t.length;n<o;n++)if(l[0][n]<3)c[n].x=t[n].x,c[n].y=t[n].y,c[n].z=t[n].z;else if(3==l[0][n]||4==l[0][n]){for(c[n].x=0,c[n].y=0,c[n].z=0,r=0,s=l[0][n];r<s;r++)c[n].x+=t[l[r+1][n]].x,c[n].y+=t[l[r+1][n]].y,c[n].z+=t[l[r+1][n]].z;c[n].x+=f*t[n].x,c[n].y+=f*t[n].y,c[n].z+=f*t[n].z,c[n].x/=f+l[0][n],c[n].y/=f+l[0][n],c[n].z/=f+l[0][n]}else{for(c[n].x=0,c[n].y=0,c[n].z=0,r=0,s=l[0][n];r<s;r++)c[n].x+=t[l[r+1][n]].x,c[n].y+=t[l[r+1][n]].y,c[n].z+=t[l[r+1][n]].z;c[n].x+=m*t[n].x,c[n].y+=m*t[n].y,c[n].z+=m*t[n].z,c[n].x/=m+l[0][n],c[n].y/=m+l[0][n],c[n].z/=m+l[0][n]}for(n=0,o=t.length;n<o;n++)t[n].x=c[n].x,t[n].y=c[n].y,t[n].z=c[n].z}},t.edgeTable=[0,0,0,0,0,0,0,2816,0,0,0,1792,0,3328,3584,3840,0,0,0,138,0,21,0,134,0,0,0,652,0,2067,3865,3600,0,0,0,42,0,0,0,294,0,0,21,28,0,3875,1049,3360,0,168,162,170,0,645,2475,2210,0,687,293,172,4010,3747,3497,3232,0,0,0,0,0,69,0,900,0,0,0,1792,138,131,1608,1920,0,81,0,2074,84,85,84,86,0,81,0,3676,330,1105,1881,1616,0,0,0,42,0,69,0,502,0,0,21,3580,138,2035,1273,1520,2816,104,2337,106,840,581,367,102,2816,3695,3429,3180,1898,1635,1385,1120,0,0,0,0,0,0,0,3910,0,0,69,588,42,2083,41,2880,0,0,0,1722,0,2293,4095,3830,0,255,757,764,2538,2291,3065,2800,0,0,81,338,0,3925,1119,3414,84,855,85,340,2130,2899,89,2384,1792,712,194,1162,4036,3781,3535,3270,708,719,197,204,3018,2755,2505,2240,0,0,0,0,168,420,168,1958,162,162,676,2988,170,163,680,928,3328,3096,3328,3642,52,53,1855,1590,2340,2111,2869,2620,298,51,825,560,3584,3584,3090,3482,1668,1941,1183,1430,146,2975,2069,2460,154,915,153,400,3840,3592,3329,3082,1796,1541,1295,1030,2818,2575,2309,2060,778,515,265,0];var i=new Uint32Array(t.edgeTable),n=t.triTable=[[],[],[],[],[],[],[],[11,9,8],[],[],[],[8,10,9],[],[10,8,11],[9,11,10],[8,10,9,8,11,10],[],[],[],[1,7,3],[],[4,2,0],[],[2,1,7],[],[],[],[2,7,3,2,9,7],[],[1,4,11,1,0,4],[3,8,0,11,9,4,11,10,9],[4,11,9,11,10,9],[],[],[],[5,3,1],[],[],[],[2,5,8,2,1,5],[],[],[2,4,0],[3,2,4],[],[0,9,1,8,10,5,8,11,10],[3,4,0,3,10,4],[5,8,10,8,11,10],[],[3,5,7],[7,1,5],[1,7,3,1,5,7],[],[9,2,0,9,7,2],[0,3,8,1,7,11,1,5,7],[11,1,7,1,5,7],[],[9,1,0,5,3,2,5,7,3],[8,2,5,8,0,2],[2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[],[],[],[],[],[0,6,2],[],[7,2,9,7,9,8],[],[],[],[8,10,9],[7,1,3],[7,1,0],[6,9,3,6,10,9],[7,10,8,10,9,8],[],[6,0,4],[],[11,1,4,11,3,1],[2,4,6],[2,0,4,2,4,6],[2,4,6],[1,4,2,4,6,2],[],[6,0,4],[],[2,11,3,6,9,4,6,10,9],[8,6,1,8,1,3],[10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[],[],[],[5,3,1],[],[0,6,2],[],[7,4,8,5,2,1,5,6,2],[],[],[2,4,0],[7,4,8,2,11,3,10,5,6],[7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[9,11,8],[3,5,6],[0,5,11,0,11,8],[6,3,5,3,1,5],[3,9,6,3,8,9],[9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[],[],[],[],[],[],[],[1,10,2,9,11,6,9,8,11],[],[],[6,0,2],[3,6,9,3,2,6],[3,5,1],[0,5,1,0,11,5],[0,3,5],[6,9,11,9,8,11],[],[],[],[4,5,9,7,1,10,7,3,1],[],[11,6,7,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[],[],[0,6,4],[8,6,4,8,1,6],[],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[4,2,6],[1,0,9,2,4,8,2,6,4],[2,4,0,2,6,4],[8,2,4,2,6,4],[11,4,1,11,6,4],[0,9,1,4,11,6,4,8,11],[3,6,0,6,4,0],[8,6,4,8,11,6],[10,8,9],[6,3,9,6,7,3],[6,7,1],[10,7,1,7,3,1],[7,11,6,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2],[1,0,9,3,6,7,3,2,6],[7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[],[],[],[],[5,3,7],[8,5,2,8,7,5],[5,3,7],[1,10,2,5,8,7,5,9,8],[1,7,5],[1,7,5],[9,2,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[0,7,1,7,5,1],[9,3,5,3,7,5],[9,7,5,9,8,7],[8,10,11],[3,4,10,3,10,11],[8,10,11],[5,9,4,1,11,3,1,10,11],[2,4,5],[5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[2,8,5,2,11,8],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[11,9,10],[11,9,10],[1,11,4,1,10,11],[8,7,4,11,1,10,11,3,1],[2,7,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[1,7,4],[3,2,11,4,8,7,9,1,0],[11,4,2,4,0,2],[2,11,3,7,4,8],[4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[3,9,11,9,10,11],[0,10,8,10,11,8],[10,3,1,10,11,3],[2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]],o=[0,265,515,778,2060,2309,2575,2822,1030,1295,1541,1804,3082,3331,3593,3840,400,153,915,666,2460,2197,2975,2710,1430,1183,1941,1692,3482,3219,3993,3728,560,825,51,314,2620,2869,2111,2358,1590,1855,1077,1340,3642,3891,3129,3376,928,681,419,170,2988,2725,2479,2214,1958,1711,1445,1196,4010,3747,3497,3232,2240,2505,2755,3018,204,453,719,966,3270,3535,3781,4044,1226,1475,1737,1984,2384,2137,2899,2650,348,85,863,598,3414,3167,3925,3676,1370,1107,1881,1616,2800,3065,2291,2554,764,1013,255,502,3830,4095,3317,3580,1786,2035,1273,1520,2912,2665,2403,2154,876,613,367,102,3942,3695,3429,3180,1898,1635,1385,1120,1120,1385,1635,1898,3180,3429,3695,3942,102,367,613,876,2154,2403,2665,2912,1520,1273,2035,1786,3580,3317,4095,3830,502,255,1013,764,2554,2291,3065,2800,1616,1881,1107,1370,3676,3925,3167,3414,598,863,85,348,2650,2899,2137,2384,1984,1737,1475,1226,4044,3781,3535,3270,966,719,453,204,3018,2755,2505,2240,3232,3497,3747,4010,1196,1445,1711,1958,2214,2479,2725,2988,170,419,681,928,3376,3129,3891,3642,1340,1077,1855,1590,2358,2111,2869,2620,314,51,825,560,3728,3993,3219,3482,1692,1941,1183,1430,2710,2975,2197,2460,666,915,153,400,3840,3593,3331,3082,1804,1541,1295,1030,2822,2575,2309,2060,778,515,265,0],r=[[],[8,3,0],[9,0,1],[8,3,1,8,1,9],[11,2,3],[11,2,0,11,0,8],[11,2,3,0,1,9],[2,1,11,1,9,11,11,9,8],[10,1,2],[8,3,0,1,2,10],[9,0,2,9,2,10],[3,2,8,2,10,8,8,10,9],[10,1,3,10,3,11],[1,0,10,0,8,10,10,8,11],[0,3,9,3,11,9,9,11,10],[8,10,9,8,11,10],[8,4,7],[3,0,4,3,4,7],[1,9,0,8,4,7],[9,4,1,4,7,1,1,7,3],[2,3,11,7,8,4],[7,11,4,11,2,4,4,2,0],[3,11,2,4,7,8,9,0,1],[2,7,11,2,1,7,1,4,7,1,9,4],[10,1,2,8,4,7],[2,10,1,0,4,7,0,7,3],[4,7,8,0,2,10,0,10,9],[2,7,3,2,9,7,7,9,4,2,10,9],[8,4,7,11,10,1,11,1,3],[11,4,7,1,4,11,1,11,10,1,0,4],[3,8,0,7,11,4,11,9,4,11,10,9],[7,11,4,4,11,9,11,10,9],[9,5,4],[3,0,8,4,9,5],[5,4,0,5,0,1],[4,8,5,8,3,5,5,3,1],[11,2,3,9,5,4],[9,5,4,8,11,2,8,2,0],[3,11,2,1,5,4,1,4,0],[8,5,4,2,5,8,2,8,11,2,1,5],[2,10,1,9,5,4],[0,8,3,5,4,9,10,1,2],[10,5,2,5,4,2,2,4,0],[3,4,8,3,2,4,2,5,4,2,10,5],[5,4,9,1,3,11,1,11,10],[0,9,1,4,8,5,8,10,5,8,11,10],[3,4,0,3,10,4,4,10,5,3,11,10],[4,8,5,5,8,10,8,11,10],[9,5,7,9,7,8],[0,9,3,9,5,3,3,5,7],[8,0,7,0,1,7,7,1,5],[1,7,3,1,5,7],[11,2,3,8,9,5,8,5,7],[9,2,0,9,7,2,2,7,11,9,5,7],[0,3,8,2,1,11,1,7,11,1,5,7],[2,1,11,11,1,7,1,5,7],[1,2,10,5,7,8,5,8,9],[9,1,0,10,5,2,5,3,2,5,7,3],[5,2,10,8,2,5,8,5,7,8,0,2],[10,5,2,2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[11,7,6],[0,8,3,11,7,6],[9,0,1,11,7,6],[7,6,11,3,1,9,3,9,8],[2,3,7,2,7,6],[8,7,0,7,6,0,0,6,2],[1,9,0,3,7,6,3,6,2],[7,6,2,7,2,9,2,1,9,7,9,8],[1,2,10,6,11,7],[2,10,1,7,6,11,8,3,0],[11,7,6,10,9,0,10,0,2],[7,6,11,3,2,8,8,2,10,8,10,9],[6,10,7,10,1,7,7,1,3],[6,10,1,6,1,7,7,1,0,7,0,8],[9,0,3,6,9,3,6,10,9,6,3,7],[6,10,7,7,10,8,10,9,8],[8,4,6,8,6,11],[11,3,6,3,0,6,6,0,4],[0,1,9,4,6,11,4,11,8],[1,9,4,11,1,4,11,3,1,11,4,6],[3,8,2,8,4,2,2,4,6],[2,0,4,2,4,6],[1,9,0,3,8,2,2,8,4,2,4,6],[9,4,1,1,4,2,4,6,2],[10,1,2,11,8,4,11,4,6],[10,1,2,11,3,6,6,3,0,6,0,4],[0,2,10,0,10,9,4,11,8,4,6,11],[2,11,3,6,9,4,6,10,9],[8,4,6,8,6,1,6,10,1,8,1,3],[1,0,10,10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[9,5,4,7,6,11],[4,9,5,3,0,8,11,7,6],[6,11,7,4,0,1,4,1,5],[6,11,7,4,8,5,5,8,3,5,3,1],[4,9,5,6,2,3,6,3,7],[9,5,4,8,7,0,0,7,6,0,6,2],[4,0,1,4,1,5,6,3,7,6,2,3],[7,4,8,5,2,1,5,6,2],[6,11,7,1,2,10,9,5,4],[11,7,6,8,3,0,1,2,10,9,5,4],[11,7,6,10,5,2,2,5,4,2,4,0],[7,4,8,2,11,3,10,5,6],[4,9,5,6,10,7,7,10,1,7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[5,6,9,6,11,9,9,11,8],[0,9,5,0,5,3,3,5,6,3,6,11],[0,1,5,0,5,11,5,6,11,0,11,8],[11,3,6,6,3,5,3,1,5],[9,5,6,3,9,6,3,8,9,3,6,2],[5,6,9,9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[1,2,10,5,6,9,9,6,11,9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[10,6,5],[8,3,0,10,6,5],[0,1,9,5,10,6],[10,6,5,9,8,3,9,3,1],[3,11,2,10,6,5],[6,5,10,2,0,8,2,8,11],[1,9,0,6,5,10,11,2,3],[1,10,2,5,9,6,9,11,6,9,8,11],[1,2,6,1,6,5],[0,8,3,2,6,5,2,5,1],[5,9,6,9,0,6,6,0,2],[9,6,5,3,6,9,3,9,8,3,2,6],[11,6,3,6,5,3,3,5,1],[0,5,1,0,11,5,5,11,6,0,8,11],[0,5,9,0,3,5,3,6,5,3,11,6],[5,9,6,6,9,11,9,8,11],[10,6,5,4,7,8],[5,10,6,7,3,0,7,0,4],[5,10,6,0,1,9,8,4,7],[4,5,9,6,7,10,7,1,10,7,3,1],[7,8,4,2,3,11,10,6,5],[11,6,7,10,2,5,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[7,8,4,5,1,2,5,2,6],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,8,0,7,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,4,5,8,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[10,6,4,10,4,9],[8,3,0,9,10,6,9,6,4],[1,10,0,10,6,0,0,6,4],[8,6,4,8,1,6,6,1,10,8,3,1],[2,3,11,6,4,9,6,9,10],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,11,6,3,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[9,1,4,1,2,4,4,2,6],[1,0,9,3,2,8,2,4,8,2,6,4],[2,4,0,2,6,4],[3,2,8,8,2,4,2,6,4],[1,4,9,11,4,1,11,1,3,11,6,4],[0,9,1,4,11,6,4,8,11],[11,6,3,3,6,0,6,4,0],[8,6,4,8,11,6],[6,7,10,7,8,10,10,8,9],[9,3,0,6,3,9,6,9,10,6,7,3],[6,1,10,6,7,1,7,0,1,7,8,0],[6,7,10,10,7,1,7,3,1],[7,11,6,3,8,2,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2,2,9,1,7,8,9],[1,0,9,3,6,7,3,2,6],[8,0,7,7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[11,7,5,11,5,10],[3,0,8,7,5,10,7,10,11],[9,0,1,10,11,7,10,7,5],[3,1,9,3,9,8,7,10,11,7,5,10],[10,2,5,2,3,5,5,3,7],[5,10,2,8,5,2,8,7,5,8,2,0],[9,0,1,10,2,5,5,2,3,5,3,7],[1,10,2,5,8,7,5,9,8],[2,11,1,11,7,1,1,7,5],[0,8,3,2,11,1,1,11,7,1,7,5],[9,0,2,9,2,7,2,11,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[8,7,0,0,7,1,7,5,1],[0,3,9,9,3,5,3,7,5],[9,7,5,9,8,7],[4,5,8,5,10,8,8,10,11],[3,0,4,3,4,10,4,5,10,3,10,11],[0,1,9,4,5,8,8,5,10,8,10,11],[5,9,4,1,11,3,1,10,11],[3,8,4,3,4,2,2,4,5,2,5,10],[10,2,5,5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[8,4,5,2,8,5,2,11,8,2,5,1],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[4,5,8,8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[7,4,11,4,9,11,11,9,10],[3,0,8,7,4,11,11,4,9,11,9,10],[11,7,4,1,11,4,1,10,11,1,4,0],[8,7,4,11,1,10,11,3,1],[2,3,7,2,7,9,7,4,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[2,11,7,2,7,1,1,7,4,1,4,9],[3,2,11,4,8,7,9,1,0],[7,4,11,11,4,2,4,0,2],[2,11,3,7,4,8],[9,1,4,4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[0,9,3,3,9,11,9,10,11],[1,10,0,0,10,8,10,11,8],[10,3,1,10,11,3],[3,8,2,2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[2,11,1,1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]];
return t},$3Dmol.MarchingCube=$3Dmol.MarchingCubeInitializer(),"undefined"==typeof console&&(console={log:function(){}}),$3Dmol.ProteinSurface=function(e){var t,n,o,r=1,s=2,a=4,c=0,d=0,l=0,p=1.4,h=2,u=h,m=0,f=0,v=0,g=0,b=null,y=null,_=null,w=0,C=0,S=0,A=0,E=0,x=0,R={H:1.2,Li:1.82,Na:2.27,K:2.75,C:1.7,N:1.55,O:1.52,F:1.47,P:1.8,S:1.8,CL:1.75,BR:1.85,SE:1.9,ZN:1.39,CU:1.4,NI:1.63,X:2},T=function(e){return e.elem&&"undefined"!=typeof R[e.elem]?e.elem:"X"},H={},D={},I=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])];this.getFacesAndVertices=function(e){var i,o,r={};for(i=0,o=e.length;i<o;i++)r[e[i]]=1;var s=n;for(i=0,o=s.length;i<o;i++)s[i].x=s[i].x/u-c,s[i].y=s[i].y/u-d,s[i].z=s[i].z/u-l;var a=[];for(i=0,o=t.length;i<o;i+=3){var p=t[i],h=t[i+1],m=t[i+2],f=s[p].atomid,v=s[h].atomid,g=s[m].atomid,w=f;v<w&&(w=v),g<w&&(w=g),r[w]&&p!==h&&h!==m&&p!==m&&a.push({a:p,b:h,c:m})}return b=null,y=null,_=null,{vertices:s,faces:a}},this.initparm=function(t,i,n){var r=1/u*5.5;o=t,w=t[0][0],A=t[1][0],C=t[0][1],E=t[1][1],S=t[0][2],x=t[1][2],i?(w-=p+r,C-=p+r,S-=p+r,A+=p+r,E+=p+r,x+=p+r):(w-=r,C-=r,S-=r,A+=r,E+=r,x+=r),w=Math.floor(w*u)/u,C=Math.floor(C*u)/u,S=Math.floor(S*u)/u,A=Math.ceil(A*u)/u,E=Math.ceil(E*u)/u,x=Math.ceil(x*u)/u,c=-w,d=-C,l=-S;var s=128;if(u=A-w,E-C>u&&(u=E-C),x-S>u&&(u=x-S),u=(s-1)/u,s=Math.floor(s*h/u),u=h,s>e){var a=e/s;s=Math.floor(e),u*=a}v=Math.ceil(u*(A-w))+1,f=Math.ceil(u*(E-C))+1,m=Math.ceil(u*(x-S))+1,this.boundingatom(i),g=p*u,b=new Uint8Array(v*f*m),y=new Float64Array(v*f*m),_=new Int32Array(v*f*m)},this.boundingatom=function(e){var t,i,n,o=[];flagradius=e;for(var r in R)if(R.hasOwnProperty(r)){var s=R[r];for(e?o[r]=(s+p)*u+.5:o[r]=s*u+.5,n=o[r]*o[r],D[r]=Math.floor(o[r])+1,H[r]=new Int32Array(D[r]*D[r]),indx=0,j=0;j<D[r];j++)for(k=0;k<D[r];k++)t=j*j+k*k,t>n?H[r][indx]=-1:(i=Math.sqrt(n-t),H[r][indx]=Math.floor(i)),indx++}},this.fillvoxels=function(e,t){var i,n;for(i=0,n=b.length;i<n;i++)b[i]=0,y[i]=-1,_[i]=-1;for(i in t){var o=e[t[i]];void 0!==o&&this.fillAtom(o,e)}for(i=0,n=b.length;i<n;i++)b[i]&r&&(b[i]|=s)},this.fillAtom=function(e,t){var i,n,o,s,a,p,h,g,y,w,C,S,A,k,E,x,R,I,O;i=Math.floor(.5+u*(e.coord.x+c)),n=Math.floor(.5+u*(e.coord.y+d)),o=Math.floor(.5+u*(e.coord.z+l));var M=T(e),L=0,$=f*m;for(w=0,O=D[M];w<O;w++)for(C=0;C<O;C++){if(H[M][L]!=-1)for(x=-1;x<2;x++)for(R=-1;R<2;R++)for(I=-1;I<2;I++)if(0!==x&&0!==R&&0!==I)for(h=x*w,y=I*C,S=0;S<=H[M][L];S++)if(g=S*R,A=i+h,k=n+g,E=o+y,!(A<0||k<0||E<0||A>=v||k>=f||E>=m)){var P=A*$+k*m+E;if(b[P]&r){var N=t[_[P]];N.serial!=e.serial&&(s=i+h-Math.floor(.5+u*(N.x+c)),a=n+g-Math.floor(.5+u*(N.y+d)),p=o+y-Math.floor(.5+u*(N.z+l)),h*h+g*g+y*y<s*s+a*a+p*p&&(_[P]=e.serial))}else b[P]|=r,_[P]=e.serial}L++}},this.fillvoxelswaals=function(e,t){var i,n;for(i=0,n=b.length;i<n;i++)b[i]&=-3;for(i in t){var o=e[t[i]];void 0!==o&&this.fillAtomWaals(o,e)}},this.fillAtomWaals=function(e,t){var i,n,o,r,a,p,h,g,y,w,C,S,A,k,E,x,R,I,O,M=0;i=Math.floor(.5+u*(e.coord.x+c)),n=Math.floor(.5+u*(e.coord.y+d)),o=Math.floor(.5+u*(e.coord.z+l));var L=T(e),$=f*m;for(A=0,O=D[L];A<O;A++)for(k=0;k<O;k++){if(H[L][M]!=-1)for(x=-1;x<2;x++)for(R=-1;R<2;R++)for(I=-1;I<2;I++)if(0!==x&&0!==R&&0!==I)for(h=x*A,y=I*k,E=0;E<=H[L][M];E++)if(g=E*R,w=i+h,C=n+g,S=o+y,!(w<0||C<0||S<0||w>=v||C>=f||S>=m)){var P=w*$+C*m+S;if(b[P]&s){var N=t[_[P]];N.serial!=e.serial&&(r=i+h-Math.floor(.5+u*(N.x+c)),a=n+g-Math.floor(.5+u*(N.y+d)),p=o+y-Math.floor(.5+u*(N.z+l)),h*h+g*g+y*y<r*r+a*a+p*p&&(_[P]=e.serial))}else b[P]|=s,_[P]=e.serial}M++}},this.buildboundary=function(){var e=f*m;for(i=0;i<v;i++)for(j=0;j<m;j++)for(k=0;k<f;k++){var t=i*e+k*m+j;if(b[t]&r)for(var n=0;n<26;){var o=i+I[n][0],s=j+I[n][2],c=k+I[n][1];if(o>-1&&o<v&&c>-1&&c<f&&s>-1&&s<m&&!(b[o*e+c*m+s]&r)){b[t]|=a;break}n++}}};var O=function(e,t,i){var n=new Int32Array(e*t*i*3);this.set=function(e,o,r,s){var a=3*((e*t+o)*i+r);n[a]=s.ix,n[a+1]=s.iy,n[a+2]=s.iz},this.get=function(e,o,r){var s=3*((e*t+o)*i+r);return{ix:n[s],iy:n[s+1],iz:n[s+2]}}};this.fastdistancemap=function(){var e,t,i,n,o,c=new O(v,f,m),d=f*m,l=g*g,p=[],h=[];for(e=0;e<v;e++)for(t=0;t<f;t++)for(i=0;i<m;i++)if(o=e*d+t*m+i,b[o]&=-3,b[o]&r&&b[o]&a){var _={ix:e,iy:t,iz:i};c.set(e,t,i,_),p.push(_),y[o]=0,b[o]|=s,b[o]&=-5}do for(h=this.fastoneshell(p,c),p=[],e=0,n=h.length;e<n;e++)o=d*h[e].ix+m*h[e].iy+h[e].iz,b[o]&=-5,y[o]<=1.0404*l&&p.push({ix:h[e].ix,iy:h[e].iy,iz:h[e].iz});while(0!==p.length);p=[],h=[],c=null;var w=u-.5;w<0&&(w=0);var C=l-.5/(.1+w);for(e=0;e<v;e++)for(t=0;t<f;t++)for(i=0;i<m;i++)o=e*d+t*m+i,b[o]&=-5,b[o]&r&&(b[o]&s&&!(b[o]&s&&y[o]>=C)||(b[o]|=a))},this.fastoneshell=function(e,t){var i,n,o,c,d,l,p,h,u,g,_,w,C=[];if(0===e.length)return C;tnv={ix:-1,iy:-1,iz:-1};var S=f*m;for(p=0,u=e.length;p<u;p++)for(i=e[p].ix,n=e[p].iy,o=e[p].iz,_=t.get(i,n,o),h=0;h<6;h++)tnv.ix=i+I[h][0],tnv.iy=n+I[h][1],tnv.iz=o+I[h][2],tnv.ix<v&&tnv.ix>-1&&tnv.iy<f&&tnv.iy>-1&&tnv.iz<m&&tnv.iz>-1&&(w=tnv.ix*S+m*tnv.iy+tnv.iz,b[w]&r&&!(b[w]&s)?(t.set(tnv.ix,tnv.iy,o+I[h][2],_),c=tnv.ix-_.ix,d=tnv.iy-_.iy,l=tnv.iz-_.iz,g=c*c+d*d+l*l,y[w]=g,b[w]|=s,b[w]|=a,C.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):b[w]&r&&b[w]&s&&(c=tnv.ix-_.ix,d=tnv.iy-_.iy,l=tnv.iz-_.iz,g=c*c+d*d+l*l,g<y[w]&&(t.set(tnv.ix,tnv.iy,tnv.iz,_),y[w]=g,b[w]&a||(b[w]|=a,C.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})))));for(p=0,u=e.length;p<u;p++)for(i=e[p].ix,n=e[p].iy,o=e[p].iz,_=t.get(i,n,o),h=6;h<18;h++)tnv.ix=i+I[h][0],tnv.iy=n+I[h][1],tnv.iz=o+I[h][2],tnv.ix<v&&tnv.ix>-1&&tnv.iy<f&&tnv.iy>-1&&tnv.iz<m&&tnv.iz>-1&&(w=tnv.ix*S+m*tnv.iy+tnv.iz,b[w]&r&&!(b[w]&s)?(t.set(tnv.ix,tnv.iy,o+I[h][2],_),c=tnv.ix-_.ix,d=tnv.iy-_.iy,l=tnv.iz-_.iz,g=c*c+d*d+l*l,y[w]=g,b[w]|=s,b[w]|=a,C.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):b[w]&r&&b[w]&s&&(c=tnv.ix-_.ix,d=tnv.iy-_.iy,l=tnv.iz-_.iz,g=c*c+d*d+l*l,g<y[w]&&(t.set(tnv.ix,tnv.iy,tnv.iz,_),y[w]=g,b[w]&a||(b[w]|=a,C.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})))));for(p=0,u=e.length;p<u;p++)for(i=e[p].ix,n=e[p].iy,o=e[p].iz,_=t.get(i,n,o),h=18;h<26;h++)tnv.ix=i+I[h][0],tnv.iy=n+I[h][1],tnv.iz=o+I[h][2],tnv.ix<v&&tnv.ix>-1&&tnv.iy<f&&tnv.iy>-1&&tnv.iz<m&&tnv.iz>-1&&(w=tnv.ix*S+m*tnv.iy+tnv.iz,b[w]&r&&!(b[w]&s)?(t.set(tnv.ix,tnv.iy,o+I[h][2],_),c=tnv.ix-_.ix,d=tnv.iy-_.iy,l=tnv.iz-_.iz,g=c*c+d*d+l*l,y[w]=g,b[w]|=s,b[w]|=a,C.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):b[w]&r&&b[w]&s&&(c=tnv.ix-_.ix,d=tnv.iy-_.iy,l=tnv.iz-_.iz,g=c*c+d*d+l*l,g<y[w]&&(t.set(tnv.ix,tnv.iy,tnv.iz,_),y[w]=g,b[w]&a||(b[w]|=a,C.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})))));return C},this.marchingcubeinit=function(e){for(var t=0,i=b.length;t<i;t++)1==e?b[t]&=-5:4==e?(b[t]&=-3,b[t]&a&&(b[t]|=s),b[t]&=-5):2==e?b[t]&a&&b[t]&s?b[t]&=-5:b[t]&a&&!(b[t]&s)&&(b[t]|=s):3==e&&(b[t]&=-5)};this.marchingcube=function(e){this.marchingcubeinit(e),n=[],t=[],$3Dmol.MarchingCube.march(b,n,t,{smooth:1,nX:v,nY:f,nZ:m});for(var i=f*m,o=0,r=n.length;o<r;o++)n[o].atomid=_[n[o].x*i+m*n[o].y+n[o].z];$3Dmol.MarchingCube.laplacianSmooth(1,n,t)}},$3Dmol.SetupSurface=function(e){var t=e.threshbox,i=new $3Dmol.ProteinSurface(t);i.initparm(e.extent,1!==e.type),i.fillvoxels(e.allatoms,e.extendedAtoms),i.buildboundary(),2===e.type&&(i.fastdistancemap(),i.boundingatom(!1),i.fillvoxelswaals(e.allatoms,e.extendedAtoms)),i.marchingcube(),i.vpBits=null,i.vpDistance=null,i.vpAtomID=null;var n=i.getFacesAndVertices(e.atomsToShow);return i.faces=null,i.verts=null,n},"undefined"==typeof console&&(console={log:function(){}}),$3Dmol.ElectronMap=function(e){var t,n,o,r,s,a,c,d,l,p=1,h=2,u=4,m=1.5,f={},v=0,g=0,b=0,y=1.4,_=2,w=_,C=0,S=0,A=0,E=0,x=null,R=null,T=null,H=0,D=0,I=0,O=0,M=0,L=0,$=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])];this.getFacesAndVertices=function(e,i){var n,o,r={};for(n=0,o=i.length;n<o;n++)r[i[n]]=1;var s=l;for(n=0,o=s.length;n<o;n++){var a=new THREE.Vector3(s[n].x,s[n].y,s[n].z).applyMatrix4(t);s[n].x=a.x/w-v,s[n].y=a.y/w-g,s[n].z=a.z/w-b}var c=[];for(n=0,o=d.length;n<o;n+=3){var p=d[n],h=d[n+1],u=d[n+2];p!==h&&h!==u&&p!==u&&c.push({a:p,b:h,c:u})}return x=null,R=null,T=null,{vertices:s,faces:c}},this.initparm=function(e,i,d,l,p,h,u,_,k,R){a=e,m=void 0!==a.max?a.min+(a.max-a.min)*l/100:void 0!==a.mean?a.mean+a.sigma*l:l,f=i,t=d,n=p,maxdist=h,o=u,r=_,s=k,c=R;H=0,O=a.xExtent-1,D=0,M=a.yExtent-1,I=0,L=a.zExtent-1,v=-H,g=-D,b=-I;var $=O-H;M-D>$&&($=M-D),L-I>$&&($=L-I),w=1,boxLength=$,A=Math.ceil(w*(O-H))+1,S=Math.ceil(w*(M-D))+1,C=Math.ceil(w*(L-I))+1,E=y*w,x=new Uint8Array(A*S*C),T=new Uint8Array(A*S*C)},this.fillvoxels=function(e,i){var n,o,r,s;for(n=0,s=x.length;n<s;n++)x[n]=0,T[n]=0;var d=(new THREE.Matrix4).getInverse(t),l=[];maxdist=parseInt(maxdist);var u=S*C;for(var v in i){var g=e[i[v]],b=new THREE.Vector3(g.coord.x,g.coord.y,g.coord.z).applyMatrix4(d);for(n=Math.floor(b.x)-maxdist,s=Math.ceil(b.x)+maxdist;n<=s;++n)if(!(n<0||n>a.xExtent-1))for(o=Math.floor(b.y)-maxdist,jl=Math.ceil(b.y)+maxdist;o<=jl;++o)if(!(o<0||o>a.yExtent-1))for(r=Math.floor(b.z)-maxdist,kl=Math.ceil(b.z)+maxdist;r<=kl;++r)if(!(r<0||r>a.zExtent-1)){var y=n*u+o*C+r;l.push(y)}}for(n=0,s=l.length;n<s;++n){var y=l[n];"2fofc"==c?x[y]=f[y]>=m?1:0:"fofc"==c?(x[y]=f[y]>=m||f[y]<=-m?1:0,T[y]=f[y]>=0?1:0):"em"==c&&(x[y]=f[y]>=m?1:0)}for(n=0,s=x.length;n<s;n++)x[n]&p&&(x[n]|=h)},this.buildboundary=function(){var e=S*C;for(i=0;i<A;i++)for(j=0;j<C;j++)for(k=0;k<S;k++){var t=i*e+k*C+j;if(x[t]&p)for(var n=0;n<26;){var o=i+$[n][0],r=j+$[n][2],s=k+$[n][1];if(o>-1&&o<A&&s>-1&&s<S&&r>-1&&r<C&&!(x[o*e+s*C+r]&p)){x[t]|=u;break}n++}}},this.marchingcubeinit=function(e){for(var t=0,i=x.length;t<i;t++)1==e?x[t]&=-5:4==e?(x[t]&=-3,x[t]&u&&(x[t]|=h),x[t]&=-5):2==e?x[t]&u&&x[t]&h?x[t]&=-5:x[t]&u&&!(x[t]&h)&&(x[t]|=h):3==e?x[t]&=-5:x[t]&=-5};this.marchingcube=function(e){this.marchingcubeinit(e),l=[],d=[],$3Dmol.MarchingCube.march(x,l,d,{smooth:1,nX:A,nY:S,nZ:C});for(var t=S*C,i=0,n=l.length;i<n;i++)l[i].atomid=T[l[i].x*t+C*l[i].y+l[i].z];$3Dmol.MarchingCube.laplacianSmooth(1,l,d)}},$3Dmol.SetupMap=function(e){var t=new $3Dmol.ElectronMap;t.initparm(e.header,e.data,e.matrix,e.isovalue,e.center,e.maxdist,e.pmin,e.pmax,e.water,e.type),t.fillvoxels(e.allatoms,e.extendedAtoms),t.buildboundary(),t.marchingcube(),t.vpBits=null,t.vpAtomID=null;var i=t.getFacesAndVertices(e.allatoms,e.atomsToShow);return t.faces=null,t.verts=null,i},iCn3D.prototype.createSurfaceRepresentation=function(e,t,i,n){var o=this;if(0!=Object.keys(e).length){void 0==n&&(n=1),this.opacity=n;var r,s=this.getExtent(e),a=5,c=[];c=this.bConsiderNeighbors?Object.keys(this.unionHash(e,this.getAtomsWithinAtom(this.atoms,e,a))):Object.keys(e);var d,l=1,p=!(10==parseInt(10*n)||i||this.bInstanced&&Object.keys(this.atoms).length*this.biomtMatrices.length>this.maxatomcnt);11==t?d=$3Dmol.SetupMap({allatoms:this.atoms,atomsToShow:Object.keys(e),extendedAtoms:c,water:this.water,header:o.mapData.header2,data:o.mapData.data2,matrix:o.mapData.matrix2,isovalue:o.mapData.sigma2,center:this.center,maxdist:l,pmin:this.pmin,pmax:this.pmax,type:"2fofc"}):12==t?d=$3Dmol.SetupMap({allatoms:this.atoms,atomsToShow:Object.keys(e),extendedAtoms:c,water:this.water,header:o.mapData.header,data:o.mapData.data,matrix:o.mapData.matrix,isovalue:o.mapData.sigma,center:this.center,maxdist:l,pmin:this.pmin,pmax:this.pmax,type:"fofc"}):13==t?(l=3,d=$3Dmol.SetupMap({allatoms:this.atoms,atomsToShow:Object.keys(e),extendedAtoms:c,water:this.water,header:o.mapData.headerEm,data:o.mapData.dataEm,matrix:o.mapData.matrixEm,isovalue:o.mapData.sigmaEm,center:this.center,maxdist:l,pmin:this.pmin,pmax:this.pmax,type:"em"})):d=$3Dmol.SetupSurface({extent:s,allatoms:this.atoms,atomsToShow:Object.keys(e),extendedAtoms:c,type:t,threshbox:p?60:this.threshbox});var h=d.vertices,u=d.faces,m=new THREE.Color("#00FFFF"),f=new THREE.Color("#00FF00"),v=new THREE.Color("#ff0000"),g=new THREE.Color("#00FFFF");r=new THREE.Geometry,r.vertices=h.map(function(e){var t=new THREE.Vector3(e.x,e.y,e.z);return t.atomid=e.atomid,t}),r.faces=u.map(function(e){var i=["a","b","c"].map(function(i){if(11==t)return m;if(12==t)return r.vertices[e[i]].atomid?f:v;if(13==t)return g;var n=r.vertices[e[i]].atomid;return o.atoms[n].color});return new THREE.Face3(e.a,e.b,e.c,(void 0),i)}),r.computeVertexNormals(!0),r.colorsNeedUpdate=!0,r.normalsNeedUpdate=!0,r.type="Surface";var b=JSON.parse(JSON.stringify(r)).data.normals;if(p){for(var y={},_=0,w=u.length;_<w;++_){var C=u[_].a,S=u[_].b,A=u[_].c;void 0===y[C]&&(y[C]=[]),y[C].push(S),y[C].push(A)}for(var C in y){var k=new THREE.Geometry;k.vertices=[],k.faces=[];for(var E=y[C],_=0,w=E.length;_<w;_+=2){var S=E[_],A=E[_+1];k.vertices.push(new THREE.Vector3(h[C].x,h[C].y,h[C].z)),k.vertices.push(new THREE.Vector3(h[S].x,h[S].y,h[S].z)),k.vertices.push(new THREE.Vector3(h[A].x,h[A].y,h[A].z));var x=[];x.push(o.atoms[h[C].atomid].color),x.push(o.atoms[h[S].atomid].color),x.push(o.atoms[h[A].atomid].color);var R=[];R.push(b[C]),R.push(b[S]),R.push(b[A]);var T=_/2*3;k.faces.push(new THREE.Face3(T,T+1,T+2,R,x))}k.colorsNeedUpdate=!0,k.type="Surface";for(var H=new THREE.Mesh(k,new THREE.MeshPhongMaterial({specular:this.frac,shininess:10,emissive:0,vertexColors:THREE.VertexColors,wireframe:i,opacity:n,transparent:!0,side:THREE.DoubleSide})),D=new THREE.Vector3(0,0,0),_=0,w=H.geometry.vertices.length;_<w;++_)D=D.add(H.geometry.vertices[_]);var I=D.multiplyScalar(1/H.geometry.vertices.length).sub(o.oriCenter).applyMatrix4(o.cam.matrixWorldInverse);H.renderOrder=o.cam_z>0?-parseInt(I.z):parseInt(I.z),H.onBeforeRender=function(e,t,i,n,r,s){for(var a=new THREE.Vector3(0,0,0),c=0,d=this.geometry.vertices.length;c<d;++c)a=a.add(this.geometry.vertices[c]);var l=a.multiplyScalar(1/this.geometry.vertices.length).sub(o.oriCenter).applyMatrix4(o.cam.matrixWorldInverse);this.renderOrder=o.cam_z>0?-parseInt(l.z):parseInt(l.z)},o.mdl.add(H),11==t||12==t?this.prevMaps.push(H):13==t?this.prevEmmaps.push(H):this.prevSurfaces.push(H)}}else{var H=new THREE.Mesh(r,new THREE.MeshPhongMaterial({specular:this.frac,shininess:10,emissive:0,vertexColors:THREE.VertexColors,wireframe:i,opacity:n,transparent:!0,side:THREE.DoubleSide}));H.renderOrder=0,o.mdl.add(H),11==t||12==t?this.prevMaps.push(H):13==t?this.prevEmmaps.push(H):this.prevSurfaces.push(H)}d=null,h=null,u=null,r=null}},iCn3D.prototype.buildAxes=function(e){var t=new THREE.Object3D;t.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0+e,0,0),16711680,!1,.5)),t.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0-e,0,0),8388608,!0,.5)),t.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0+e,0),65280,!1,.5)),t.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0-e,0),32768,!0,.5)),t.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,0+e),255,!1,.5)),t.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,0-e),128,!0,.5)),this.scene.add(t)},iCn3D.prototype.createLines=function(e){if(void 0!==e)for(var t in e)for(var i=e[t],n=0,o=i.length;n<o;++n){var r=i[n],s=r.position1,a=r.position2,c=!!r.dashed&&r.dashed,d=.3,l=this.lineRadius,p="#"+r.color.replace(/\#/g,""),h=new THREE.Color(p);if(c)for(var u,m,f=s.distanceTo(a),v=parseInt(f/d),g=a.clone().sub(s).multiplyScalar(d/f),b=0;b<v;++b)b%2==1&&(u=s.clone().add(g.clone().multiplyScalar(b)),m=s.clone().add(g.clone().multiplyScalar(b+1)),"stabilizer"==t?this.createBrick(u,m,l,h):this.createCylinder(u,m,l,h));else"stabilizer"==t?this.createBrick(s,a,l,h):this.createCylinder(s,a,l,h)}},iCn3D.prototype.createBrick=function(e,t,i,n){var o=new THREE.CylinderGeometry(1,1,1,4,1),r=new THREE.Mesh(o,new THREE.MeshPhongMaterial({specular:this.frac,shininess:30,emissive:0,color:n}));r.position.copy(e).add(t).multiplyScalar(.5),r.matrixAutoUpdate=!1,r.lookAt(t.clone().sub(e)),r.updateMatrix(),r.matrix.multiply((new THREE.Matrix4).makeScale(i,i,e.distanceTo(t))).multiply((new THREE.Matrix4).makeRotationX(.5*Math.PI)),this.mdl.add(r)},iCn3D.prototype.applyPrevColor=function(){for(var e in this.atoms){var t=this.atoms[e];t.color=this.atomPrevColors[e]}},iCn3D.prototype.applyChemicalbindingOptions=function(e){if(void 0===e&&(e=this.opts),"show"===e.chemicalbinding){var t;void 0!==this.chemicals&&Object.keys(this.chemicals).length>0&&(t=this.hash2Atoms(this.chemicals));var i=4;if(void 0!==t){var n=this.getAtomsWithinAtom(this.atoms,t,i),o=3.5;this.opts.hbonds="yes",Object.keys(n).length>0&&this.calculateChemicalHbonds(t,n,parseFloat(o)),this.zoominSelection(this.unionHash(t,n))}}else"hide"===e.chemicalbinding&&(this.hideHbonds(),this.zoominSelection(this.atoms))},iCn3D.prototype.hideHbonds=function(){this.opts.hbonds="no",void 0===this.lines&&(this.lines={}),this.lines.hbond=[],this.hbondpnts=[];for(var e in this.atoms)this.atoms[e].style2="nothing";for(var e in this.sidec)this.atoms[e].style2=this.opts.sidec;for(var e in this.water)this.atoms[e].style=this.opts.water},iCn3D.prototype.applySsbondsOptions=function(e){if(void 0===e&&(e=this.opts),"yes"===e.ssbonds.toLowerCase()&&void 0!==this.ssbondpnts){var t,i,n="#FFFF00",o=new THREE.Color(16776960),r=Object.keys(this.structures);this.bAlternate?(t=this.ALTERNATE_STRUCTURE,i=this.ALTERNATE_STRUCTURE+1):(t=0,i=r.length),this.lines.ssbond=[];for(var s=t,a=i;s<a;++s){var c=r[s];if(void 0!==this.ssbondpnts[c])for(var d=Math.floor(this.ssbondpnts[c].length/2)-1;d>=0;d--){var l,p,h=this.ssbondpnts[c][2*d],u=this.ssbondpnts[c][2*d+1],m={};m.color=n,m.dashed=!0;var f=!1;for(var v in this.residues[h])if("SG"===this.atoms[v].name){l=this.atoms[v].serial,m.position1=this.atoms[v].coord,m.serial1=this.atoms[v].serial,f=!0;break}if(!f)for(var v in this.residues[h])if("CA"===this.atoms[v].name){m.position1=this.atoms[v].coord,m.serial1=this.atoms[v].serial,f=!0;break}f=!1;for(var v in this.residues[u])if("SG"===this.atoms[v].name){p=this.atoms[v].serial,m.position2=this.atoms[v].coord,m.serial2=this.atoms[v].serial,f=!0;break}if(!f)for(var v in this.residues[u])if("CA"===this.atoms[v].name){m.position2=this.atoms[v].coord,m.serial2=this.atoms[v].serial,f=!0;break}if(void 0===m.serial1||void 0===m.serial2||this.dAtoms.hasOwnProperty(m.serial1)||this.dAtoms.hasOwnProperty(m.serial2)){var g=3;if(void 0===m.position1||void 0===m.position2||m.position1.distanceTo(m.position2)>g)this.ssbondpnts[c].splice(2*d,2);else{var b,y,_=this.atoms[l].bonds.indexOf(p);_!=-1&&(b=this.atoms[l].bonds.slice(0,_),y=this.atoms[l].bonds.slice(_+1),this.atoms[l].bonds=b.concat(y)),_=this.atoms[p].bonds.indexOf(l),_!=-1&&(b=this.atoms[p].bonds.slice(0,_),y=this.atoms[p].bonds.slice(_+1),this.atoms[p].bonds=b.concat(y)),this.lines.ssbond.push(m),this.createCylinder(m.position1,m.position2,this.cylinderRadius,o);var w=this.unionHash(this.residues[h],this.residues[u]),C=this.intHash(w,this.sidec),S=this.intHash(w,this.calphas);C=this.unionHash(C,S);for(var v in C)this.atoms[v].style2="stick"}}}}}},iCn3D.prototype.applyMapOptions=function(e){switch(void 0===e&&(e=this.opts),e.mapwireframe){case"yes":e.mapwireframe=!0;break;case"no":e.mapwireframe=!1}var t,i;switch(t=this.intHash(this.dAtoms,this.hAtoms),i=this.hash2Atoms(t),e.map.toLowerCase()){case"2fofc":this.createSurfaceRepresentation(i,11,e.mapwireframe);break;case"fofc":this.createSurfaceRepresentation(i,12,e.mapwireframe);break;case"nothing":this.removeMaps()}},iCn3D.prototype.applyEmmapOptions=function(e){switch(void 0===e&&(e=this.opts),e.emmapwireframe){case"yes":e.emmapwireframe=!0;break;case"no":e.emmapwireframe=!1}var t,i;switch(t=this.intHash(this.dAtoms,this.hAtoms),i=this.hash2Atoms(t),e.emmap.toLowerCase()){case"em":this.createSurfaceRepresentation(i,13,e.emmapwireframe);break;case"nothing":this.removeEmmaps()}},iCn3D.prototype.setFog=function(){var e=this.backgroundColors[this.opts.background.toLowerCase()];"yes"===this.opts.fog?"perspective"===this.opts.camera?this.scene.fog=new THREE.Fog(e,1.5*this.maxD,3*this.maxD):"orthographic"===this.opts.camera&&(this.scene.fog=void 0):this.scene.fog=void 0},iCn3D.prototype.alternateStructures=function(){var e=Object.keys(this.hAtoms).length,t=Object.keys(this.atoms).length;this.dAtoms={};for(var i=Object.keys(this.structures),n=0,o=i.length;n<o;++n){var r=i[n];if(n>this.ALTERNATE_STRUCTURE||this.ALTERNATE_STRUCTURE===o-1&&0===n){for(var s in this.structures[r]){var a=this.structures[r][s];this.dAtoms=this.unionHash(this.dAtoms,this.chains[a])}this.ALTERNATE_STRUCTURE=n;break}}e<t&&(this.dAtoms=this.intHash(this.dAtoms,this.hAtoms),this.bShowHighlight=!1,this.opts.rotationcenter="highlight center"),this.removeSurfaces(),this.applySurfaceOptions(),this.removeMaps(),this.applyMapOptions(),this.removeEmmaps(),this.applyEmmapOptions(),this.draw(),this.bShowHighlight=!0,this.opts.rotationcenter="molecule center"},iCn3D.prototype.updateStabilizer=function(){if(this.stabilizerpnts=[],void 0!==this.pairArray)for(var e=0,t=this.pairArray.length;e<t;e+=2){var i=this.getResidueRepPos(this.pairArray[e]),n=this.getResidueRepPos(this.pairArray[e+1]);this.stabilizerpnts.push(i),this.stabilizerpnts.push(n)}},iCn3D.prototype.getResidueRepPos=function(e){var t,i=this.atoms[e],n=i.structure+"_"+i.chain+"_"+i.resi;if(this.proteins.hasOwnProperty(e)||this.nucleotides.hasOwnProperty(e))for(var o in this.residues[n]){var r=this.atoms[o];if("N3"===r.name){t=this.atoms[o].coord;break}if("CA"===r.name&&"coil"==r.ss){t=this.atoms[o].coord;break}if("CA"===r.name&&("helix"==r.ss||"sheet"==r.ss)){t=void 0!==this.atoms[o].coord2?this.atoms[o].coord2:this.atoms[o].coord;break}}else t=i.coord;return void 0===t&&(t=i.coord),t},iCn3D.prototype.applySurfaceOptions=function(e){switch(void 0===e&&(e=this.opts),e.wireframe){case"yes":e.wireframe=!0;break;case"no":e.wireframe=!1}e.opacity=parseFloat(e.opacity);var t,i;switch(t=this.intHash(this.dAtoms,this.hAtoms),"nothing"===e.water&&(t=this.exclHash(t,this.water)),i=this.hash2Atoms(t),e.surface.toLowerCase()){case"van der waals surface":this.createSurfaceRepresentation(i,1,e.wireframe,e.opacity);break;case"solvent accessible surface":this.createSurfaceRepresentation(i,3,e.wireframe,e.opacity);break;case"molecular surface":this.createSurfaceRepresentation(i,2,e.wireframe,e.opacity);break;case"van der waals surface with context":this.createSurfaceRepresentation(i,1,e.wireframe,e.opacity);break;case"solvent accessible surface with context":this.createSurfaceRepresentation(i,3,e.wireframe,e.opacity);break;case"molecular surface with context":this.createSurfaceRepresentation(i,2,e.wireframe,e.opacity);break;case"nothing":this.removeSurfaces()}},iCn3D.prototype.applyOtherOptions=function(e){if(void 0===e&&(e=this.opts),this.lines.hbond=[],"yes"===e.hbonds.toLowerCase())for(var t="#00FF00",i=this.hbondpnts,n=0,o=Math.floor(i.length/2);n<o;n++){var r={};r.position1=i[2*n].coord,r.serial1=i[2*n].serial,r.position2=i[2*n+1].coord,r.serial2=i[2*n+1].serial,r.color=t,r.dashed=!0,(void 0===r.serial1||void 0===r.serial2||this.dAtoms.hasOwnProperty(r.serial1)||this.dAtoms.hasOwnProperty(r.serial2))&&(void 0===this.lines.hbond&&(this.lines.hbond=[]),this.lines.hbond.push(r))}if(void 0!==this.pairArray&&this.pairArray.length>0){this.updateStabilizer();var t="#FFFFFF",i=this.stabilizerpnts;this.lines.stabilizer=[];for(var n=0,o=Math.floor(i.length/2);n<o;n++){var r={};r.position1=i[2*n],r.position2=i[2*n+1],r.color=t,r.dashed=!1,this.lines.stabilizer.push(r)}}if(this.createLines(this.lines),void 0!==this.prevMaps)for(var n=0,s=this.prevMaps.length;n<s;++n)this.mdl.add(this.prevMaps[n]);if(void 0!==this.prevEmmaps)for(var n=0,s=this.prevEmmaps.length;n<s;++n)this.mdl.add(this.prevEmmaps[n]);if(void 0!==this.prevSurfaces)for(var n=0,s=this.prevSurfaces.length;n<s;++n)this.mdl.add(this.prevSurfaces[n]);switch(this.applyCenterOptions(e),e.axis.toLowerCase()){case"yes":this.axis=!0,this.buildAxes(this.maxD/2);break;case"no":this.axis=!1}switch(e.pk.toLowerCase()){case"atom":this.pk=1;break;case"no":this.pk=0;break;case"residue":this.pk=2;break;case"strand":this.pk=3}},iCn3D.prototype.rebuildScene=function(e){var t=this;this.rebuildSceneBase(e),void 0!==this.bSkipChemicalbinding&&this.bSkipChemicalbinding||this.applyChemicalbindingOptions(),this.bSkipChemicalbinding=!0,this.applySsbondsOptions(),this.applyDisplayOptions(this.opts,this.dAtoms),this.applyOtherOptions(),this.setFog(),this.setCamera(),t.scene_ghost.updateMatrixWorld(!0)},iCn3D.prototype.draw=function(){this.rebuildScene(),this.bImpo&&this.drawImpostorShader(),this.applyPrevColor(),void 0!==this.biomtMatrices&&this.biomtMatrices.length>1&&(this.bAssembly?this.drawSymmetryMates():this.centerSelection());var e=void 0!==this.hAtoms?Object.keys(this.hAtoms).length:0;e>0&&e<Object.keys(this.dAtoms).length&&(this.removeHlObjects(),(void 0===this.bShowHighlight||this.bShowHighlight)&&this.addHlObjects()),this.bRender===!0&&(this.applyTransformation(this._zoomFactor,this.mouseChange,this.quaternion),this.render()),this.clearImpostors()},iCn3D.prototype.calculateChemicalHbonds=function(e,t,i){if(0!==Object.keys(e).length&&0!==Object.keys(t).length){var n,o,r={},s=i*i;for(var a in e){var c=e[a];"N"!==c.elem&&"O"!==c.elem&&"F"!==c.elem||(o=c.structure+"_"+c.chain+"_"+c.resi+"_"+c.name,r[o]=c)}var d={},l={};for(var a in t){var c=t[a];if("N"===c.elem||"O"===c.elem||"F"===c.elem){n=c.structure+"_"+c.chain+"_"+c.resi,o=n+"_"+c.name;for(var p in r){var h=Math.abs(c.coord.x-r[p].coord.x);if(!(h>i)){var u=Math.abs(c.coord.y-r[p].coord.y);if(!(u>i)){var m=Math.abs(c.coord.z-r[p].coord.z);if(!(m>i)){var f=h*h+u*u+m*m;f>s||(this.hbondpnts.push({serial:c.serial,coord:c.coord}),this.hbondpnts.push({serial:r[p].serial,coord:r[p].coord}),d=this.unionHash(d,this.residues[c.structure+"_"+c.chain+"_"+c.resi]),d=this.unionHash(d,this.residues[r[p].structure+"_"+r[p].chain+"_"+r[p].resi]),l[n]=1)}}}}}}for(var v=Object.keys(l),a=0,g=v.length;a<g;++a)for(var p in this.residues[v[a]])this.atoms[p].style2="stick";return d}},iCn3D.prototype.getChainsFromAtoms=function(e){var t={};for(var i in e){var n=this.atoms[i],o=n.structure+"_"+n.chain;t[o]=1}return t},iCn3D.prototype.getNeighboringAtoms=function(e,t,i){var n=this,o=this.getExtent(t),r=(o[2][0]-o[0][0])*(o[2][0]-o[0][0])+(o[2][1]-o[0][1])*(o[2][1]-o[0][1])+(o[2][2]-o[0][2])*(o[2][2]-o[0][2]),s=(o[2][0]-o[1][0])*(o[2][0]-o[1][0])+(o[2][1]-o[1][1])*(o[2][1]-o[1][1])+(o[2][2]-o[1][2])*(o[2][2]-o[1][2]),a=r>s?r:s,c=Math.sqrt(a),d=(c+i)*(c+i),l={};for(var p in e){var h=n.atoms[p];if(!(h.serial in t||h.coord.x<o[0][0]-i||h.coord.x>o[1][0]+i||h.coord.y<o[0][1]-i||h.coord.y>o[1][1]+i||h.coord.z<o[0][2]-i||h.coord.z>o[1][2]+i)){var u=(h.coord.x-o[2][0])*(h.coord.x-o[2][0])+(h.coord.y-o[2][1])*(h.coord.y-o[2][1])+(h.coord.z-o[2][2])*(h.coord.z-o[2][2]);u<d&&(l[h.serial]=h)}}return l},iCn3D.prototype.getAtomsWithinAtom=function(e,t,i){var n=this,o=this.getNeighboringAtoms(e,t,i),r={};for(var s in t){var a=n.atoms[s],c=this.vdwRadii[a.elem]||this.defaultRadius;for(var d in o){var l=o[d];if(!(l.serial in t)){var p=(l.coord.x-a.coord.x)*(l.coord.x-a.coord.x)+(l.coord.y-a.coord.y)*(l.coord.y-a.coord.y)+(l.coord.z-a.coord.z)*(l.coord.z-a.coord.z),h=(c+i)*(c+i);p<h&&(r[l.serial]=l)}}}return r},iCn3D.prototype.getExtent=function(e){var t,i=this,n=ymin=zmin=9999,o=ymax=zmax=-9999,r=ysum=zsum=cnt=0;for(t in e){var s=i.atoms[t];cnt++,r+=s.coord.x,ysum+=s.coord.y,zsum+=s.coord.z,n=n<s.coord.x?n:s.coord.x,ymin=ymin<s.coord.y?ymin:s.coord.y,zmin=zmin<s.coord.z?zmin:s.coord.z,o=o>s.coord.x?o:s.coord.x,ymax=ymax>s.coord.y?ymax:s.coord.y,zmax=zmax>s.coord.z?zmax:s.coord.z}return[[n,ymin,zmin],[o,ymax,zmax],[r/cnt,ysum/cnt,zsum/cnt]]},iCn3D.prototype.centerAtoms=function(e){var t=new THREE.Vector3(9999,9999,9999),i=new THREE.Vector3((-9999),(-9999),(-9999)),n=new THREE.Vector3,o=0;for(var r in e){var s=this.atoms[r],a=s.coord;n.add(a),t.min(a),i.max(a),++o}var c=i.distanceTo(t);return{center:n.multiplyScalar(1/o),maxD:c}},iCn3D.prototype.removeSurfaces=function(){for(var e=0,t=this.prevSurfaces.length;e<t;++e)this.mdl.remove(this.prevSurfaces[e]);this.prevSurfaces=[]},iCn3D.prototype.removeLastSurface=function(){this.prevSurfaces.length>0&&(this.mdl.remove(this.prevSurfaces[this.prevSurfaces.length-1]),this.prevSurfaces.slice(this.prevSurfaces.length-1,1))},iCn3D.prototype.removeMaps=function(){for(var e=0,t=this.prevMaps.length;e<t;++e)this.mdl.remove(this.prevMaps[e]);this.prevMaps=[]},iCn3D.prototype.removeEmmaps=function(){for(var e=0,t=this.prevEmmaps.length;e<t;++e)this.mdl.remove(this.prevEmmaps[e]);this.prevEmmaps=[]},iCn3D.prototype.removeLastMap=function(){this.prevMaps.length>0&&(this.mdl.remove(this.prevMaps[this.prevMaps.length-1]),this.prevMaps.slice(this.prevMaps.length-1,1))},iCn3D.prototype.removeLastEmmap=function(){this.prevEmmaps.length>0&&(this.mdl.remove(this.prevEmmaps[this.prevEmmaps.length-1]),this.prevEmmaps.slice(this.prevEmmaps.length-1,1))},iCn3D.prototype.zoominSelection=function(e){if(void 0===e&&(e=this.hash2Atoms(this.hAtoms)),Object.keys(e).length>1){var t=this.centerAtoms(e);this.maxD=t.maxD,this.maxD<5&&(this.maxD=5),this.mdl.position.set(0,0,0),this.mdlImpostor.position.set(0,0,0),this.mdl_ghost.position.set(0,0,0),this.mdl.position.sub(t.center),this.mdlImpostor.position.sub(t.center),this.mdl_ghost.position.sub(t.center),this.center=t.center,this.setCamera()}},iCn3D.prototype.centerSelection=function(e){if(this.resetOrientation(),void 0===e&&(e=this.hash2Atoms(this.hAtoms)),Object.keys(e).length>1){var t=this.centerAtoms(e);this.center=t.center,this.setCenter(this.center),this.setCamera()}},$.ui.dialog.prototype._makeDraggableBase||($.ui.dialog.prototype._makeDraggableBase=$.ui.dialog.prototype._makeDraggable,$.ui.dialog.prototype._makeDraggable=function(){this._makeDraggableBase(),this.uiDialog.draggable("option","containment",!1)});var iCn3DUI=function(e){var t=this;this.REVISION="2.7.4",t.bFullUi=!0,t.cfg=e,t.divid=t.cfg.divid,t.pre=t.divid+"_",t.inputid="",t.setOperation="or",t.WIDTH=400,t.HEIGHT=400,t.RESIDUE_WIDTH=10,t.MENU_HEIGHT=40,t.MENU_WIDTH=750,t.LESSWIDTH=20,t.LESSWIDTH_RESIZE=20,t.LESSHEIGHT=20,t.ROT_DIR="right",t.bHideSelection=!0,t.CMD_HEIGHT=.8*t.MENU_HEIGHT,t.EXTRAHEIGHT=t.MENU_HEIGHT+t.CMD_HEIGHT,void 0!=t.cfg.showmenu&&0==t.cfg.showmenu&&(t.EXTRAHEIGHT-=t.MENU_HEIGHT),void 0!=t.cfg.showcommand&&0==t.cfg.showcommand&&(t.EXTRAHEIGHT-=t.CMD_HEIGHT),t.GREY8="#888888",t.GREYB="#BBBBBB",t.GREYC="#CCCCCC",t.GREYD="#DDDDDD",t.ORANGE="#FFA500",t.b62ResArray=["A","R","N","D","C","Q","E","G","H","I","L","K","M","F","P","S","T","W","Y","V","B","Z","X","*"],t.b62Matrix=[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0,-4],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1,-4],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1,-4],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1,-4],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2,-4],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1,-4],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1,-4],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1,-4],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1,-4],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1,-4],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1,-4],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1,-4],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1,-4],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1,-4],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2,-4],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0,-4],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0,-4],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2,-4],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1,-4],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1,-4],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1,-4],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1,-4],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1,-4],[-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,1]],
t.opts={},t.opts.camera="perspective",t.opts.background="transparent",t.opts.color="chain",t.opts.proteins="ribbon",t.opts.sidec="nothing",t.opts.nucleotides="nucleotide cartoon",t.opts.surface="nothing",t.opts.opacity="1.0",t.opts.wireframe="no",t.opts.map="nothing",t.opts.mapwireframe="yes",t.opts.emmap="nothing",t.opts.emmapwireframe="yes",t.opts.chemicals="stick",t.opts.water="nothing",t.opts.ions="sphere",t.opts.hbonds="no",t.opts.ssbonds="yes",t.opts.rotationcenter="molecule center",t.opts.axis="no",t.opts.fog="no",t.opts.slab="no",t.opts.pk="residue",t.opts.chemicalbinding="hide",void 0!==t.cfg.align&&(t.opts.color="identity"),void 0!==t.cfg.blast_rep_id&&(t.opts.color="conservation"),void 0!==t.cfg.cid&&(t.opts.color="atom"),void 0!==t.cfg.options&&jQuery.extend(t.opts,t.cfg.options),t.init(),t.modifyIcn3d()};if(iCn3DUI.prototype={constructor:iCn3DUI,init:function(){var e=this;e.bSelectResidue=!1,e.bSelectAlignResidue=!1,e.selectedResidues={},e.bAnnoShown=!1,e.bSetChainsAdvancedMenu=!1,e.b2DShown=!1,e.bCrashed=!1,e.prevCommands="",e.bAddCommands=!0,e.bAddLogs=!0,e.bNotLoadStructure=!1,e.bInitial=!0,$("#"+e.pre+"dl_annotations").html(""),$("#"+e.pre+"dl_2ddgm").html("")},modifyIcn3d:function(){var e=this;e.modifyIcn3dshowPicking()},switchHighlightLevelUp:function(){var e=this;if(e.icn3d.bShift||e.icn3d.bCtrl||e.icn3d.removeHlObjects(),1===e.icn3d.highlightlevel){e.icn3d.highlightlevel=2;var t=e.icn3d.getFirstAtomObj(e.icn3d.pickedAtomList);e.icn3d.bShift||e.icn3d.bCtrl?e.icn3d.hAtoms=e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.residues[t.structure+"_"+t.chain+"_"+t.resi]):e.icn3d.hAtoms=e.icn3d.cloneHash(e.icn3d.residues[t.structure+"_"+t.chain+"_"+t.resi])}else if(2===e.icn3d.highlightlevel){e.icn3d.highlightlevel=3;var t=e.icn3d.getFirstAtomObj(e.icn3d.pickedAtomList);e.icn3d.bShift||e.icn3d.bCtrl?e.icn3d.hAtoms=e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.selectStrandHelixFromAtom(t)):e.icn3d.hAtoms=e.icn3d.cloneHash(e.icn3d.selectStrandHelixFromAtom(t))}else if(3===e.icn3d.highlightlevel){e.icn3d.highlightlevel=4;var t=e.icn3d.getFirstAtomObj(e.icn3d.pickedAtomList);e.icn3d.bShift||e.icn3d.bCtrl?e.icn3d.hAtoms=e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.chains[t.structure+"_"+t.chain]):e.icn3d.hAtoms=e.icn3d.cloneHash(e.icn3d.chains[t.structure+"_"+t.chain])}else if(4===e.icn3d.highlightlevel||5===e.icn3d.highlightlevel){e.icn3d.highlightlevel=5;var t=e.icn3d.getFirstAtomObj(e.icn3d.pickedAtomList);e.icn3d.bShift||e.icn3d.bCtrl||(e.icn3d.hAtoms={});for(var i=e.icn3d.structures[t.structure],n=0,o=i.length;n<o;++n)e.icn3d.hAtoms=e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.chains[i[n]])}e.icn3d.addHlObjects(),e.updateHlAll()},switchHighlightLevelDown:function(){var e=this;if(e.icn3d.removeHlObjects(),2!==e.icn3d.highlightlevel&&1!==e.icn3d.highlightlevel||1!==Object.keys(e.icn3d.pickedAtomList).length){if(3===e.icn3d.highlightlevel){var t={};for(var i in e.icn3d.pickedAtomList)residueid=e.icn3d.atoms[i].structure+"_"+e.icn3d.atoms[i].chain+"_"+e.icn3d.atoms[i].resi,t[residueid]=1;if(1===Object.keys(t).length){e.icn3d.highlightlevel=2;var n=e.icn3d.getFirstAtomObj(e.icn3d.pickedAtomList);e.icn3d.bShift||e.icn3d.bCtrl?e.icn3d.hAtoms=e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.residues[n.structure+"_"+n.chain+"_"+n.resi]):e.icn3d.hAtoms=e.icn3d.cloneHash(e.icn3d.residues[n.structure+"_"+n.chain+"_"+n.resi])}}else if(4===e.icn3d.highlightlevel){e.icn3d.highlightlevel=3;var n=e.icn3d.getFirstAtomObj(e.icn3d.pickedAtomList);e.icn3d.bShift||e.icn3d.bCtrl?e.icn3d.hAtoms=e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.selectStrandHelixFromAtom(n)):e.icn3d.hAtoms=e.icn3d.cloneHash(e.icn3d.selectStrandHelixFromAtom(n))}else if(5===e.icn3d.highlightlevel){e.icn3d.highlightlevel=4;var n=e.icn3d.getFirstAtomObj(e.icn3d.pickedAtomList);e.icn3d.bShift||e.icn3d.bCtrl?e.icn3d.hAtoms=e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.chains[n.structure+"_"+n.chain]):e.icn3d.hAtoms=e.icn3d.cloneHash(e.icn3d.chains[n.structure+"_"+n.chain])}}else e.icn3d.highlightlevel=1,e.icn3d.hAtoms=e.icn3d.cloneHash(e.icn3d.pickedAtomList),e.icn3d.bShift||e.icn3d.bCtrl?e.icn3d.hAtoms=e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.pickedAtomList):e.icn3d.hAtoms=e.icn3d.cloneHash(e.icn3d.pickedAtomList);e.icn3d.addHlObjects(),e.updateHlAll()},switchHighlightLevel:function(){var e=this;$(document).bind("keydown",function(t){38===t.keyCode?(t.preventDefault(),0!=Object.keys(e.icn3d.pickedAtomList).length&&e.icn3d.hAtoms.hasOwnProperty(e.icn3d.getFirstAtomObj(e.icn3d.pickedAtomList).serial)||(e.icn3d.pickedAtomList=e.icn3d.cloneHash(e.icn3d.hAtoms)),e.switchHighlightLevelUp(),e.setLogCmd("highlight level up",!0)):40===t.keyCode&&(t.preventDefault(),0!=Object.keys(e.icn3d.pickedAtomList).length&&e.icn3d.hAtoms.hasOwnProperty(e.icn3d.getFirstAtomObj(e.icn3d.pickedAtomList).serial)||(e.icn3d.pickedAtomList=e.icn3d.cloneHash(e.icn3d.hAtoms)),e.switchHighlightLevelDown(),e.setLogCmd("highlight level down",!0))})},allCustomEvents:function(){},setCustomDialogs:function(){var e="";return e},modifyIcn3dshowPicking:function(){var e=this;iCn3D.prototype.showPicking=function(t,i,n){if(void 0!==e.cfg.cid&&(this.pk=1),e.icn3d.highlightlevel=e.icn3d.pk,this.showPickingBase(t,i,n),void 0!==i&&void 0!==n){void 0!=e.cfg.showmenu&&1==e.cfg.showmenu&&(n+=e.MENU_HEIGHT);var o=1==this.pk?t.resn+t.resi+"@"+t.name:t.resn+t.resi;Object.keys(e.icn3d.structures).length>1?(o=t.structure+" "+o,$("#"+e.pre+"popup").css("width","100px")):$("#"+e.pre+"popup").css("width","80px"),$("#"+e.pre+"popup").html(o),$("#"+e.pre+"popup").css("top",n).css("left",i+20).show()}else{var r=this.id.split("_");e.pre=r[0]+"_",e.updateHlAll();var s={};s.factor=this._zoomFactor,s.mouseChange=this.mouseChange,s.quaternion={},s.quaternion._x=parseFloat(this.quaternion._x).toPrecision(5),s.quaternion._y=parseFloat(this.quaternion._y).toPrecision(5),s.quaternion._z=parseFloat(this.quaternion._z).toPrecision(5),s.quaternion._w=parseFloat(this.quaternion._w).toPrecision(5),e.bAddCommands&&(this.commands.push("pickatom "+t.serial+"|||"+e.getTransformationStr(s)),this.optsHistory.push(this.cloneHash(this.opts)),this.optsHistory[this.optsHistory.length-1].hlatomcount=Object.keys(this.hAtoms).length,e.isSessionStorageSupported()&&e.saveCommandsToSession(),e.STATENUMBER=this.commands.length),this.logs.push("pickatom "+t.serial+" (chain: "+t.structure+"_"+t.chain+", residue: "+t.resn+", number: "+t.resi+", atom: "+t.name+")"),$("#"+e.pre+"logtext").length&&$("#"+e.pre+"logtext").val("> "+this.logs.join("\n> ")+"\n> ").scrollTop($("#"+e.pre+"logtext")[0].scrollHeight)}}},show3DStructure:function(){var e=this;return e.deferred=$.Deferred(function(){e.isSessionStorageSupported()&&e.getCommandsBeforeCrash(),e.setViewerWidthHeight();var t,i;t=e.cfg.width.toString().indexOf("%")!==-1?e.WIDTH*e.cfg.width.substr(0,e.cfg.width.toString().indexOf("%"))/100-e.LESSWIDTH:e.cfg.width,i=e.cfg.height.toString().indexOf("%")!==-1?e.HEIGHT*e.cfg.height.substr(0,e.cfg.height.toString().indexOf("%"))/100-e.EXTRAHEIGHT-e.LESSHEIGHT:e.cfg.height,e.realWidth=t,e.realHeight=i,e.setTopMenusHtml(e.divid),e.allEventFunctions(),e.allCustomEvents();var n=0;if((void 0==e.cfg.showmenu||e.cfg.showmenu)&&(n+=e.MENU_HEIGHT),(void 0==e.cfg.showcommand||e.cfg.showcommand)&&(n+=e.CMD_HEIGHT),void 0!=e.cfg.showmenu&&0==e.cfg.showmenu?e.hideMenu():e.showMenu(),void 0!=e.cfg.showtitle&&0==e.cfg.showtitle?$("#"+e.pre+"title").hide():$("#"+e.pre+"title").show(),$("#"+e.pre+"viewer").width(t).height(parseInt(i)+n),$("#"+e.pre+"canvas").width(t).height(parseInt(i)),e.icn3d=new iCn3D(e.pre+"canvas"),e.isMobile()||(e.icn3d.scaleFactor=2),e.handleContextLost(),e.icn3d.setWidthHeight(t,i),e.icn3d.ori_chemicalbinding=e.opts.chemicalbinding,void 0!==e.cfg.bCalphaOnly&&(e.icn3d.bCalphaOnly=e.cfg.bCalphaOnly),e.icn3d.opts=e.icn3d.cloneHash(e.opts),e.STATENUMBER=e.icn3d.commands.length,e.isSessionStorageSupported()&&e.bCrashed){e.bCrashed=!1;var o=e.commandsBeforeCrash.split("|||")[0],r=o.substr(o.lastIndexOf(" ")+1);if(r===e.cfg.mmtfid||r===e.cfg.pdbid||r===e.cfg.mmdbid||r===e.cfg.gi||r===e.cfg.blast_rep_id||r===e.cfg.cid||r===e.cfg.mmcifid||r===e.cfg.align)return void e.loadScript(e.commandsBeforeCrash,!0)}if(e.icn3d.molTitle="",void 0!==e.cfg.url){var s=e.cfg.url.split("|"),a=s[0],c=s[1];e.icn3d.molTitle="",e.inputid=void 0,e.setLogCmd("load url "+c+" | type "+a,!0),e.downloadUrl(c,a)}else if(void 0!==e.cfg.mmtfid)e.inputid=e.cfg.mmtfid,e.setLogCmd("load mmtf "+e.cfg.mmtfid,!0),e.downloadMmtf(e.cfg.mmtfid);else if(void 0!==e.cfg.pdbid)e.inputid=e.cfg.pdbid,e.setLogCmd("load pdb "+e.cfg.pdbid,!0),e.downloadPdb(e.cfg.pdbid);else if(void 0!==e.cfg.mmdbid)e.inputid=e.cfg.mmdbid,e.setLogCmd("load mmdb "+e.cfg.mmdbid+" | parameters "+e.cfg.inpara,!0),e.downloadMmdb(e.cfg.mmdbid);else if(void 0!==e.cfg.gi)e.setLogCmd("load gi "+e.cfg.gi,!0),e.downloadGi(e.cfg.gi);else if(void 0!==e.cfg.blast_rep_id)e.setLogCmd("load seq_struct_ids "+e.cfg.query_id+","+e.cfg.blast_rep_id,!0),e.downloadBlast_rep_id(e.cfg.query_id+","+e.cfg.blast_rep_id);else if(void 0!==e.cfg.cid){e.inputid=e.cfg.cid;var c="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+e.inputid+"/description/jsonp";$.ajax({url:c,dataType:"jsonp",tryCount:0,retryLimit:1,success:function(t){void 0!==t.InformationList&&void 0!==t.InformationList.Information&&(e.icn3d.molTitle=t.InformationList.Information[0].Title)},error:function(e,t,i){if(this.tryCount++,this.tryCount<=this.retryLimit)return void $.ajax(this)}}),e.setLogCmd("load cid "+e.cfg.cid,!0),e.downloadCid(e.cfg.cid)}else if(void 0!==e.cfg.mmcifid)e.inputid=e.cfg.mmcifid,e.setLogCmd("load mmcif "+e.cfg.mmcifid,!0),e.downloadMmcif(e.cfg.mmcifid);else if(void 0!==e.cfg.align){var d=e.cfg.align.split(",");6===d.length?e.inputid=d[0]+"_"+d[3]:2===d.length&&(e.inputid=d[0]+"_"+d[1]),e.setLogCmd("load alignment "+e.cfg.align+" | parameters "+e.cfg.inpara,!0),e.downloadAlignment(e.cfg.align)}else void 0!==e.cfg.command&&""!==e.cfg.command?e.loadScript(e.cfg.command):alert('Please use the "File" menu to retrieve a structure of interest or to display a local file.')}),e.deferred.promise()},hideMenu:function(){var e=this;void 0!==$("#"+e.pre+"mnlist")[0]&&($("#"+e.pre+"mnlist")[0].style.display="none"),void 0!==$("#"+e.pre+"mnLogSection")[0]&&($("#"+e.pre+"mnLogSection")[0].style.display="none"),void 0!==$("#"+e.pre+"cmdlog")[0]&&($("#"+e.pre+"cmdlog")[0].style.display="none"),$("#"+e.pre+"title")[0].style.margin="10px 0 0 10px"},showMenu:function(){var e=this;void 0!==$("#"+e.pre+"mnlist")[0]&&($("#"+e.pre+"mnlist")[0].style.display="block"),void 0!==$("#"+e.pre+"mnLogSection")[0]&&($("#"+e.pre+"mnLogSection")[0].style.display="block"),void 0!==$("#"+e.pre+"cmdlog")[0]&&($("#"+e.pre+"cmdlog")[0].style.display="block")},saveSelectionIfSelected:function(e,t){var i=this;if(i.bSelectResidue||i.bSelectAlignResidue){var n=$("#"+i.pre+"seq_command_name2").val().replace(/\s+/g,"_");""===n&&(n=$("#"+i.pre+"alignseq_command_name").val().replace(/\s+/g,"_")),""!==n&&i.saveSelection(n,n),i.bSelectResidue=!1,i.bSelectAlignResidue=!1}},setOption:function(e,t){var i=this;if(i.icn3d.opts[e]=t,i.saveSelectionIfSelected(),"color"===e){i.icn3d.setColorByOptions(i.icn3d.opts,i.icn3d.hAtoms),i.icn3d.draw();var n=i.icn3d.getResiduesFromCalphaAtoms(i.icn3d.hAtoms);i.changeSeqColor(Object.keys(n))}else"surface"===e||"opacity"===e||"wireframe"===e?("opacity"!==e&&"wireframe"!==e||i.icn3d.removeLastSurface(),i.icn3d.applySurfaceOptions(),i.icn3d.draw()):"map"===e||"mapwireframe"===e?("mapwireframe"===e&&i.icn3d.removeLastMap(),i.icn3d.applyMapOptions(),i.icn3d.draw()):"emmap"===e||"emmapwireframe"===e?("emmapwireframe"===e&&i.icn3d.removeLastEmmap(),i.icn3d.applyEmmapOptions(),i.icn3d.draw()):"chemicalbinding"===e?(i.icn3d.bSkipChemicalbinding=!1,i.icn3d.draw()):i.icn3d.draw()},setStyle:function(e,t){var i=this,n={};switch(e){case"proteins":n=i.icn3d.intHash(i.icn3d.hAtoms,i.icn3d.proteins);break;case"sidec":n=i.icn3d.intHash(i.icn3d.hAtoms,i.icn3d.sidec),calpha_atoms=i.icn3d.intHash(i.icn3d.hAtoms,i.icn3d.calphas),n=i.icn3d.unionHash(n,calpha_atoms);break;case"nucleotides":n=i.icn3d.intHash(i.icn3d.hAtoms,i.icn3d.nucleotides);break;case"chemicals":n=i.icn3d.intHash(i.icn3d.hAtoms,i.icn3d.chemicals);break;case"ions":n=i.icn3d.intHash(i.icn3d.hAtoms,i.icn3d.ions);break;case"water":n=i.icn3d.intHash(i.icn3d.hAtoms,i.icn3d.water)}if("sidec"===e)for(var o in n)i.icn3d.atoms[o].style2=t;else for(var o in n)i.icn3d.atoms[o].style=t;i.icn3d.opts[e]=t,i.saveSelectionIfSelected(),i.icn3d.draw()},setLogCmd:function(e,t,i){var n=this;if(""===e.trim())return!1;var o=e.indexOf("|||");o!==-1&&(e=e.substr(0,o));var r={};if(r.factor=n.icn3d._zoomFactor,r.mouseChange=n.icn3d.mouseChange,r.quaternion={},r.quaternion._x=parseFloat(n.icn3d.quaternion._x).toPrecision(5),r.quaternion._y=parseFloat(n.icn3d.quaternion._y).toPrecision(5),r.quaternion._z=parseFloat(n.icn3d.quaternion._z).toPrecision(5),r.quaternion._w=parseFloat(n.icn3d.quaternion._w).toPrecision(5),t&&n.bAddCommands)if(n.STATENUMBER<n.icn3d.commands.length){var s=n.icn3d.commands[n.STATENUMBER-1],o=s.indexOf("|||");e!==s.substr(0,o)&&(n.icn3d.commands=n.icn3d.commands.slice(0,n.STATENUMBER),n.icn3d.commands.push(e+"|||"+n.getTransformationStr(r)),n.icn3d.optsHistory.push(n.icn3d.cloneHash(n.icn3d.opts)),n.icn3d.optsHistory[n.icn3d.optsHistory.length-1].hlatomcount=Object.keys(n.icn3d.hAtoms).length,n.isSessionStorageSupported()&&n.saveCommandsToSession(),n.STATENUMBER=n.icn3d.commands.length)}else n.icn3d.commands.push(e+"|||"+n.getTransformationStr(r)),n.icn3d.optsHistory.push(n.icn3d.cloneHash(n.icn3d.opts)),void 0!==n.icn3d.hAtoms&&(n.icn3d.optsHistory[n.icn3d.optsHistory.length-1].hlatomcount=Object.keys(n.icn3d.hAtoms).length),n.isSessionStorageSupported()&&n.saveCommandsToSession(),n.STATENUMBER=n.icn3d.commands.length;n.bAddLogs&&n.cfg.showcommand&&(n.icn3d.logs.push(e),$("#"+n.pre+"logtext").val("> "+n.icn3d.logs.join("\n> ")+"\n> ").scrollTop($("#"+n.pre+"logtext")[0].scrollHeight)),n.adjustIcon()},renderStructure:function(){var e=this;e.bInitial?(void 0!==e.cfg.command&&""!==e.cfg.command?(e.icn3d.bRender=!1,jQuery.extend(e.icn3d.opts,e.opts),e.icn3d.draw()):(jQuery.extend(e.icn3d.opts,e.opts),e.icn3d.draw()),Object.keys(e.icn3d.structures).length>1?$("#"+e.pre+"alternate").show():$("#"+e.pre+"alternate").hide()):(e.saveSelectionIfSelected(),e.icn3d.draw()),e.bInitial&&void 0!==e.cfg.command&&""!==e.cfg.command&&(e.icn3d.bRender=!0,e.loadScript(e.cfg.command)),setTimeout(function(){if(e.bInitial){if(void 0!==e.cfg.showsets&&e.cfg.showsets&&e.showSets(),void 0!==e.cfg.align){var t=!1;seqObj=e.getAlignSequencesAnnotations(Object.keys(e.icn3d.alnChains),void 0,void 0,t),$("#"+e.pre+"dl_sequence2").html(seqObj.sequencesHtml),$("#"+e.pre+"dl_sequence2").width(e.RESIDUE_WIDTH*seqObj.maxSeqCnt+200)}if(void 0!==e.cfg.showanno&&e.cfg.showanno){var i="view annotations";e.setLogCmd(i,!0),e.showAnnotations()}}else e.updateHlAll();e.bInitial=!1},0)},exportCustomAtoms:function(){for(var e=this,t="",i=void 0!==e.icn3d.defNames2Residues?Object.keys(e.icn3d.defNames2Residues).sort():[],n=0,o=i.length;n<o;++n){var r=i[n],s=e.icn3d.defNames2Residues[r],a=(e.icn3d.defNames2Descr[r],e.icn3d.defNames2Command[r]);a=a.replace(/,/g,", "),t+=r+"\tselect ",t+=e.residueids2spec(s),t+="\n"}i=void 0!==e.icn3d.defNames2Atoms?Object.keys(e.icn3d.defNames2Atoms).sort():[];for(var n=0,o=i.length;n<o;++n){var r=i[n],c=e.icn3d.defNames2Atoms[r],a=(e.icn3d.defNames2Descr[r],e.icn3d.defNames2Command[r]);a=a.replace(/,/g,", ");var s=e.atoms2residues(c);s.length>0&&(t+=r+"\tselect ",t+=e.residueids2spec(s),t+="\n")}return t},atoms2residues:function(e){for(var t=this,i={},n=0,o=e.length;n<o;++n)i[e[n]]=1;var r=t.icn3d.getResiduesFromCalphaAtoms(i);return Object.keys(r)},residueids2spec:function(e){var t=this,i="";if(void 0!==e){for(var n,o,r,s,a,c,d,l=e.sort(function(e,t){if(""!==e&&!isNaN(e))return parseInt(e)-parseInt(t);var i=e.lastIndexOf("_"),n=t.lastIndexOf("_");if(e.substr(0,i)<t.substr(0,n))return-1;if(e.substr(0,i)>t.substr(0,n))return 1;if(e.substr(0,i)==t.substr(0,n)){if(parseInt(e.substr(i+1))<parseInt(t.substr(n+1)))return-1;if(parseInt(e.substr(i+1))>parseInt(t.substr(n+1)))return 1;if(parseInt(e.substr(i+1))==parseInt(t.substr(n+1)))return 0}}),p="",h=0,u=1!=Object.keys(t.icn3d.structures).length,m=0,f=l.length;m<f;++m){var v=l[m];r=v.lastIndexOf("_"),n=v.substr(0,r),o=parseInt(v.substr(r+1)),s=p.indexOf("_"),a=p.substr(0,s),c=p.substr(s+1),p!==n?(m>0&&(i+=h===d?u?"$"+a+"."+c+":"+d+" or ":"."+c+":"+d+" or ":u?"$"+a+"."+c+":"+d+"-"+h+" or ":"."+c+":"+d+"-"+h+" or "),d=o):p===n&&o!==h+1&&(i+=h===d?u?"$"+a+"."+c+":"+d+" or ":"."+c+":"+d+" or ":u?"$"+a+"."+c+":"+d+"-"+h+" or ":"."+c+":"+d+"-"+h+" or ",d=o),p=n,h=o}s=p.indexOf("_"),a=p.substr(0,s),c=p.substr(s+1),i+=h===d?u?"$"+a+"."+c+":"+d:"."+c+":"+d:u?"$"+a+"."+c+":"+d+"-"+h:"."+c+":"+d+"-"+h}return i},pickCustomSphere:function(e){var t=this,i="select zone cutoff "+e,n={};for(var o in t.icn3d.hAtoms)n[o]=t.icn3d.atoms[o];var r=t.icn3d.getAtomsWithinAtom(t.icn3d.atoms,n,parseFloat(e)),s={};for(var o in r){var a=r[o],c=a.structure+"_"+a.chain+"_"+a.resi;s[c]=1}var d=Object.keys(s);t.icn3d.hAtoms={};for(var l=0,p=d.length;l<p;++l){var c=d[l];for(var o in t.icn3d.residues[c])t.icn3d.hAtoms[o]=1}t.icn3d.dAtoms=t.icn3d.cloneHash(t.icn3d.atoms);var h,u,m=t.icn3d.getFirstAtomObj(n);h="sphere."+m.chain+":"+t.icn3d.residueName2Abbr(m.resn.substr(0,3))+m.resi+"-"+$("#"+t.pre+"radius_aroundsphere").val()+"A",u="select a sphere around currently selected "+Object.keys(t.icn3d.hAtoms).length+" atoms with a radius of "+e+" angstrom",t.addCustomSelection(d,h,u,i,!0);t.saveSelectionIfSelected(),t.icn3d.draw()},showHbonds:function(e){var t=this;t.icn3d.opts.hbonds="yes",t.icn3d.opts.water="dot";var i="hbonds "+e,n={};for(var o in t.icn3d.atoms)!t.icn3d.hAtoms.hasOwnProperty(o)&&t.icn3d.dAtoms.hasOwnProperty(o)&&(n[o]=t.icn3d.atoms[o]);var r=t.icn3d.getFirstAtomObj(t.icn3d.hAtoms);if(Object.keys(n).length>0&&Object.keys(t.icn3d.hAtoms).length>0){var s=t.icn3d.calculateChemicalHbonds(n,t.icn3d.intHash2Atoms(t.icn3d.dAtoms,t.icn3d.hAtoms),parseFloat(e)),a={};for(var o in s){var c=t.icn3d.atoms[o].structure+"_"+t.icn3d.atoms[o].chain+"_"+t.icn3d.atoms[o].resi;a[c]=1}t.icn3d.hAtoms={};for(var d in a)for(var o in t.icn3d.residues[d])t.icn3d.hAtoms[o]=1,t.icn3d.atoms[o].style2="stick";var l="hbonds_"+r.serial,p="all atoms that are hydrogen-bonded with the selected atoms";t.addCustomSelection(Object.keys(a),l,p,i,!0);t.saveSelectionIfSelected(),t.icn3d.draw()}},showSsbonds:function(){var e=this;e.icn3d.opts.ssbonds="yes";for(var t="disulfide bonds",i={},n=Object.keys(e.icn3d.structures),o=0,r=n.length;o<r;++o){var s=n[o];if(void 0!==e.icn3d.ssbondpnts[s])for(var a=0,c=Math.floor(e.icn3d.ssbondpnts[s].length/2);a<c;a++){var d=e.icn3d.ssbondpnts[s][2*a],l=e.icn3d.ssbondpnts[s][2*a+1];i[d]=1,i[l]=1,e.icn3d.hAtoms=e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.residues[d]),e.icn3d.hAtoms=e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.residues[l])}}if(Object.keys(i).length>0){var p="ssbonds",h="all atoms that have disulfide bonds";e.addCustomSelection(Object.keys(i),p,h,t,!0);e.saveSelectionIfSelected(),e.icn3d.draw()}},addLine:function(e,t,i,n,o,r,s,a,c){var d=this,l={};l.position1=new THREE.Vector3(e,t,i),l.position2=new THREE.Vector3(n,o,r),l.color=s,l.dashed=a,void 0===d.icn3d.lines[c]&&(d.icn3d.lines[c]=[]),void 0!==c?d.icn3d.lines[c].push(l):d.icn3d.lines.custom.push(l),d.icn3d.removeHlObjects()},back:function(){var e=this;e.backForward=!0,e.STATENUMBER--,e.bAddCommands=!1,e.bAddLogs=!1,e.bNotLoadStructure=!0,e.STATENUMBER<1?e.STATENUMBER=1:e.execCommands(0,e.STATENUMBER-1,e.STATENUMBER),e.adjustIcon(),e.bAddCommands=!0,e.bAddLogs=!0},forward:function(){var e=this;e.backForward=!0,e.STATENUMBER++,e.bAddCommands=!1,e.bAddLogs=!1,e.bNotLoadStructure=!0,e.STATENUMBER>e.icn3d.commands.length?e.STATENUMBER=e.icn3d.commands.length:e.execCommands(0,e.STATENUMBER-1,e.STATENUMBER),e.adjustIcon(),e.bAddCommands=!0,e.bAddLogs=!0},toggleSelection:function(){var e=this;if(e.bHideSelection){for(var t in e.icn3d.dAtoms)e.icn3d.hAtoms.hasOwnProperty(t)&&delete e.icn3d.dAtoms[t];e.bHideSelection=!1}else e.icn3d.dAtoms=e.icn3d.unionHash(e.icn3d.dAtoms,e.icn3d.hAtoms),e.bHideSelection=!0;e.icn3d.draw()},adjustIcon:function(){var e=this;1===e.STATENUMBER?$("#"+e.pre+"back").hasClass("icn3d-middleIcon")&&($("#"+e.pre+"back").toggleClass("icn3d-middleIcon"),$("#"+e.pre+"back").toggleClass("icn3d-endIcon")):$("#"+e.pre+"back").hasClass("icn3d-endIcon")&&($("#"+e.pre+"back").toggleClass("icn3d-middleIcon"),$("#"+e.pre+"back").toggleClass("icn3d-endIcon")),e.STATENUMBER===e.icn3d.commands.length?$("#"+e.pre+"forward").hasClass("icn3d-middleIcon")&&($("#"+e.pre+"forward").toggleClass("icn3d-middleIcon"),$("#"+e.pre+"forward").toggleClass("icn3d-endIcon")):$("#"+e.pre+"forward").hasClass("icn3d-endIcon")&&($("#"+e.pre+"forward").toggleClass("icn3d-middleIcon"),$("#"+e.pre+"forward").toggleClass("icn3d-endIcon"))},toggle:function(e,t,i,n){$("#"+e).toggleClass("ui-icon-plus"),$("#"+e).toggleClass("ui-icon-minus"),$("#"+t).toggleClass("ui-icon-plus"),$("#"+t).toggleClass("ui-icon-minus"),$("#"+e).toggleClass("icn3d-shown"),$("#"+e).toggleClass("icn3d-hidden"),$("#"+t).toggleClass("icn3d-shown"),$("#"+t).toggleClass("icn3d-hidden"),$("#"+i).toggleClass("icn3d-shown"),$("#"+i).toggleClass("icn3d-hidden"),$("#"+n).toggleClass("icn3d-shown"),$("#"+n).toggleClass("icn3d-hidden")},selectComplement:function(){var e=this,t={};for(var i in e.icn3d.atoms)e.icn3d.hAtoms.hasOwnProperty(i)||(t[i]=1);e.icn3d.hAtoms=e.icn3d.cloneHash(t),e.updateHlAll()},saveCommandsToSession:function(){var e=this,t=e.icn3d.commands.join("\n"),i=decodeURIComponent(t);sessionStorage.setItem("commands",i)},addChainLabels:function(e){var t=this,i=18,n="#CCCCCC",o=t.icn3d.intHash(t.icn3d.hAtoms,e);void 0===t.icn3d.labels.chain&&(t.icn3d.labels.chain=[]);var r=t.icn3d.getChainsFromAtoms(o);for(var s in r){var a={};a.position=t.icn3d.centerAtoms(t.icn3d.chains[s]).center;var c=s.indexOf("_"),d=s.substr(c+1),l=t.getProteinName(s);l.length>20&&(l=l.substr(0,20)+"..."),a.text="Chain "+d+": "+l,a.size=i;var p=t.icn3d.getFirstCalphaAtomObj(t.icn3d.chains[s]).color.getHexString().toUpperCase();a.color="CCCCCC"===p||"C8C8C8"===p?"#888888":"#"+p,a.background=n,t.icn3d.labels.chain.push(a)}t.icn3d.removeHlObjects()},addTerminiLabels:function(e){var t=this,i=18,n="#CCCCCC",o=t.icn3d.unionHash(t.icn3d.proteins,t.icn3d.nucleotides),r=t.icn3d.intHash(t.icn3d.dAtoms,o),s=t.icn3d.intHash(r,e);void 0===t.icn3d.labels.chain&&(t.icn3d.labels.chain=[]);var a=t.icn3d.getChainsFromAtoms(s);for(var c in a){var d=t.icn3d.intHash(r,t.icn3d.chains[c]),l=Object.keys(d),p=t.icn3d.atoms[l[0]],h=t.icn3d.atoms[l[l.length-1]],u={},m={};u.position=p.coord,m.position=h.coord,u.text="N-",m.text="C-",t.icn3d.nucleotides.hasOwnProperty(p.serial)&&(u.text="5'",m.text="3'"),u.size=i,m.size=i;var f=p.color.getHexString().toUpperCase(),v=h.color.getHexString().toUpperCase();u.color="CCCCCC"===f||"C8C8C8"===f?"#888888":"#"+f,m.color="CCCCCC"===v||"C8C8C8"===v?"#888888":"#"+v,u.background=n,m.background=n,t.icn3d.labels.chain.push(u),t.icn3d.labels.chain.push(m)}t.icn3d.removeHlObjects()},getCommandsBeforeCrash:function(){var e=this;window.addEventListener("load",function(){sessionStorage.setItem("good_exit","pending")}),window.addEventListener("beforeunload",function(){sessionStorage.setItem("good_exit","true")}),sessionStorage.getItem("good_exit")&&"pending"===sessionStorage.getItem("good_exit")&&(e.isMac()||(e.bCrashed=!0),e.commandsBeforeCrash=sessionStorage.getItem("commands"),e.commandsBeforeCrash||(e.commandsBeforeCrash=""))},addLineFromPicking:function(e){var t,i=this,t=$("#"+i.pre+e+"color").val(),n=((i.icn3d.pAtom.coord.x+i.icn3d.pAtom2.coord.x)/2,(i.icn3d.pAtom.coord.y+i.icn3d.pAtom2.coord.y)/2,(i.icn3d.pAtom.coord.z+i.icn3d.pAtom2.coord.z)/2,"stabilizer"!=e);i.setLogCmd("add line | x1 "+i.icn3d.pAtom.coord.x.toPrecision(4)+" y1 "+i.icn3d.pAtom.coord.y.toPrecision(4)+" z1 "+i.icn3d.pAtom.coord.z.toPrecision(4)+" | x2 "+i.icn3d.pAtom2.coord.x.toPrecision(4)+" y2 "+i.icn3d.pAtom2.coord.y.toPrecision(4)+" z2 "+i.icn3d.pAtom2.coord.z.toPrecision(4)+" | color "+t+" | dashed "+n+" | type "+e,!0),i.addLine(i.icn3d.pAtom.coord.x,i.icn3d.pAtom.coord.y,i.icn3d.pAtom.coord.z,i.icn3d.pAtom2.coord.x,i.icn3d.pAtom2.coord.y,i.icn3d.pAtom2.coord.z,t,n,e),i.icn3d.pickpair=!1},setEntrezLinks:function(e){var t,i=this,n=Object.keys(i.icn3d.structures);1===n.length?(t="https://www.ncbi.nlm.nih.gov/"+e+"/?term="+n[0],i.setLogCmd("Entrez "+e+" about PDB "+n[0]+": "+t,!1),window.open(t,"_blank")):2===n.length&&(t="https://www.ncbi.nlm.nih.gov/"+e+"/?term="+n[0]+" OR "+n[1],i.setLogCmd("Entrez "+e+" about PDB "+n[0]+" OR "+n[1]+": "+t,!1),window.open(t,"_blank"))},shareLink:function(){var e=this,t=e.shareLinkUrl();if(e.bInputfile)return void alert("Share Link does NOT work when the data is from custom files. Please save 'iCn3D PNG Image' in the File menu and open it in iCn3D.");if(t.length>4e3)return void alert("The url is more than 4000 characters and may not work. Please save 'iCn3D PNG Image' or 'State File' and open them in iCn3D.");e.setLogCmd("share link: "+t,!1);var i="https://firebasedynamiclinks.googleapis.com/v1/shortLinks?key=AIzaSyBxl9CgM0dY5lagHL4UOhEpLWE1fuwdnvc";$.ajax({url:i,type:"POST",data:{longDynamicLink:"https://icn3d.page.link/?link="+encodeURIComponent(t)},dataType:"json",success:function(i){var n="Problem in getting shortened URL";void 0!==i.shortLink&&(n=i.shortLink),$("#"+e.pre+"ori_url").val(t),$("#"+e.pre+"short_url").val(n),e.openDialog(e.pre+"dl_copyurl","Copy a Share Link URL")},error:function(i,n,o){var r="Problem in getting shortened URL";$("#"+e.pre+"ori_url").val(t),$("#"+e.pre+"short_url").val(r),e.openDialog(e.pre+"dl_copyurl","Copy a Share Link URL")}})},exportInteractions:function(){var e=this,t="<html><body><b>Interacting residues</b>:<br/><table border=1 cellpadding=0 cellspacing=0><tr><th>Base Chain: Residues</th><th>Interacting Chain</th></tr>";for(var i in e.chainname2residues)for(var n in e.chainname2residues[i]){var o=i.substr(0,i.indexOf("_"))+"_"+n.substr(0,n.indexOf(" "));t+="<tr><td>"+i+": ",t+=e.residueids2spec(e.chainname2residues[i][n]),t+="</td><td>"+o+"</td></tr>"}t+="</table><br/></body></html>";var r=e.inputid?e.inputid:"custom";e.saveFile(r+"_interactions.html","html",t)},saveColor:function(){var e=this;for(var t in e.icn3d.atoms){var i=e.icn3d.atoms[t];i.colorSave=i.color.clone()}},applySavedColor:function(){var e=this;for(var t in e.icn3d.atoms){var i=e.icn3d.atoms[t];void 0!==i.colorSave&&(i.color=i.colorSave.clone())}e.icn3d.draw(),e.changeSeqColor(Object.keys(e.icn3d.residues))},saveStyle:function(){var e=this;for(var t in e.icn3d.atoms){var i=e.icn3d.atoms[t];i.styleSave=i.style,void 0!==i.style2&&(i.style2Save=i.style2)}},applySavedStyle:function(){var e=this;for(var t in e.icn3d.atoms){var i=e.icn3d.atoms[t];void 0!==i.styleSave&&(i.style=i.styleSave),void 0!==i.style2Save&&(i.style2=i.style2Save)}e.icn3d.draw()},clickBack:function(){var e=this;$("#"+e.pre+"back").add("#"+e.pre+"mn6_back").click(function(t){t.preventDefault(),e.setLogCmd("back",!1),e.back()})},clickForward:function(){var e=this;$("#"+e.pre+"forward").add("#"+e.pre+"mn6_forward").click(function(t){t.preventDefault(),e.setLogCmd("forward",!1),e.forward()})},clickToggle:function(){var e=this;$("#"+e.pre+"toggle").add("#"+e.pre+"mn2_toggle").click(function(t){e.toggleSelection(),e.setLogCmd("toggle selection",!0)})},clickHlColorYellow:function(){var e=this;$("#"+e.pre+"mn2_hl_clrYellow").click(function(t){e.setLogCmd("set highlight color yellow",!0),e.icn3d.hColor=new THREE.Color(16776960),e.icn3d.matShader=e.icn3d.setOutlineColor("yellow"),e.icn3d.draw()})},clickHlColorGreen:function(){var e=this;$("#"+e.pre+"mn2_hl_clrGreen").click(function(t){e.setLogCmd("set highlight color green",!0),e.icn3d.hColor=new THREE.Color(65280),e.icn3d.matShader=e.icn3d.setOutlineColor("green"),e.icn3d.draw()})},clickHlColorRed:function(){var e=this;$("#"+e.pre+"mn2_hl_clrRed").click(function(t){e.setLogCmd("set highlight color red",!0),e.icn3d.hColor=new THREE.Color(16711680),e.icn3d.matShader=e.icn3d.setOutlineColor("red"),e.icn3d.draw()})},clickHlStyleOutline:function(){var e=this;$("#"+e.pre+"mn2_hl_styleOutline").click(function(t){e.setLogCmd("set highlight style outline",!0),e.icn3d.bHighlight=1,e.showHighlight()})},clickHlStyleObject:function(){var e=this;$("#"+e.pre+"mn2_hl_styleObject").click(function(t){e.setLogCmd("set highlight style 3d",!0),e.icn3d.bHighlight=2,e.showHighlight()})},clickHlStyleNone:function(){var e=this;$("#"+e.pre+"mn2_hl_styleNone").click(function(t){t.stopImmediatePropagation(),e.clearHighlight(),e.setLogCmd("clear selection",!0)})},clickAlternate:function(){var e=this;$("#"+e.pre+"alternate").add("#"+e.pre+"mn2_alternate").click(function(t){e.icn3d.bAlternate=!0,e.icn3d.alternateStructures(),e.icn3d.bAlternate=!1,e.setLogCmd("alternate structures",!1)})},clkMn1_mmtfid:function(){var e=this;$("#"+e.pre+"mn1_mmtfid").click(function(t){e.openDialog(e.pre+"dl_mmtfid","Please input MMTF ID")})},clkMn1_pdbid:function(){var e=this;$("#"+e.pre+"mn1_pdbid").click(function(t){e.openDialog(e.pre+"dl_pdbid","Please input PDB ID")})},clkMn1_align:function(){var e=this;$("#"+e.pre+"mn1_align").click(function(t){e.openDialog(e.pre+"dl_align","Align two 3D structures")})},clkMn1_pdbfile:function(){var e=this;$("#"+e.pre+"mn1_pdbfile").click(function(t){e.openDialog(e.pre+"dl_pdbfile","Please input PDB File")})},clkMn1_mol2file:function(){var e=this;$("#"+e.pre+"mn1_mol2file").click(function(t){e.openDialog(e.pre+"dl_mol2file","Please input Mol2 File")})},clkMn1_sdffile:function(){var e=this;$("#"+e.pre+"mn1_sdffile").click(function(t){e.openDialog(e.pre+"dl_sdffile","Please input SDF File")})},clkMn1_xyzfile:function(){var e=this;$("#"+e.pre+"mn1_xyzfile").click(function(t){e.openDialog(e.pre+"dl_xyzfile","Please input XYZ File")})},clkMn1_urlfile:function(){var e=this;$("#"+e.pre+"mn1_urlfile").click(function(t){e.openDialog(e.pre+"dl_urlfile","Load data by URL")})},clkMn1_mmciffile:function(){var e=this;$("#"+e.pre+"mn1_mmciffile").click(function(t){e.openDialog(e.pre+"dl_mmciffile","Please input mmCIF File")})},clkMn1_mmcifid:function(){var e=this;$("#"+e.pre+"mn1_mmcifid").click(function(t){e.openDialog(e.pre+"dl_mmcifid","Please input mmCIF ID")})},clkMn1_mmdbid:function(){var e=this;$("#"+e.pre+"mn1_mmdbid").click(function(t){e.openDialog(e.pre+"dl_mmdbid","Please input MMDB ID")})},clkMn1_blast_rep_id:function(){var e=this;$("#"+e.pre+"mn1_blast_rep_id").click(function(t){e.openDialog(e.pre+"dl_blast_rep_id","Align sequence to structure")})},clkMn1_gi:function(){var e=this;$("#"+e.pre+"mn1_gi").click(function(t){e.openDialog(e.pre+"dl_gi","Please input protein gi")})},clkMn1_cid:function(){var e=this;$("#"+e.pre+"mn1_cid").click(function(t){e.openDialog(e.pre+"dl_cid","Please input PubChem CID")})},clkMn1_pngimage:function(){var e=this;$("#"+e.pre+"mn1_pngimage").click(function(t){e.openDialog(e.pre+"dl_pngimage","Please input the PNG image")})},clkMn1_state:function(){var e=this;$("#"+e.pre+"mn1_state").click(function(t){e.openDialog(e.pre+"dl_state","Please input the state file")})},clkMn1_selection:function(){var e=this;$("#"+e.pre+"mn1_selection").click(function(t){e.openDialog(e.pre+"dl_selection","Please input the selection file")})},clkMn1_exportState:function(){var e=this;$("#"+e.pre+"mn1_exportState").click(function(t){e.setLogCmd("export state file",!1);var i=e.inputid?e.inputid:"custom";e.saveFile(i+"_statefile.txt","command")})},exportStlFile:function(e){var t=this;void 0!==t.icn3d.biomtMatrices&&t.icn3d.biomtMatrices.length>1&&t.icn3d.bAssembly&&(t.icn3d.threshbox=180/Math.pow(t.icn3d.biomtMatrices.length,.33),t.icn3d.removeSurfaces(),t.icn3d.applySurfaceOptions(),t.icn3d.removeMaps(),t.icn3d.applyMapOptions(),t.icn3d.removeEmmaps(),
t.icn3d.applyEmmapOptions());var i=t.saveStlFile(),n=t.inputid?t.inputid:"custom";if(t.saveFile(n+e+".stl","binary",i),void 0!==t.icn3d.biomtMatrices&&t.icn3d.biomtMatrices.length>1&&t.icn3d.bAssembly&&Object.keys(t.icn3d.dAtoms).length*t.icn3d.biomtMatrices.length>t.icn3d.maxAtoms3DMultiFile){alert(t.icn3d.biomtMatrices.length+" files will be generated for this assembly. Please merge these files using some software and 3D print the merged file.");var o=new THREE.Matrix4;o.identity();for(var r=1,s=0;s<t.icn3d.biomtMatrices.length;s++){var a=t.icn3d.biomtMatrices[s];if(void 0!==a&&!a.equals(o)){var c=100*(s+1);setTimeout(function(o,r){i=t.saveStlFile(o),t.saveFile(n+e+r+".stl","binary",i),i=""}.bind(this,a,r),c),++r}}t.icn3d.threshbox=180}},exportVrmlFile:function(e){var t=this;void 0!==t.icn3d.biomtMatrices&&t.icn3d.biomtMatrices.length>1&&t.icn3d.bAssembly&&(t.icn3d.threshbox=180/Math.pow(t.icn3d.biomtMatrices.length,.33),t.icn3d.removeSurfaces(),t.icn3d.applySurfaceOptions(),t.icn3d.removeMaps(),t.icn3d.applyMapOptions(),t.icn3d.removeEmmaps(),t.icn3d.applyEmmapOptions());var i=t.saveVrmlFile(),n=t.inputid?t.inputid:"custom";if(t.saveFile(n+e+".vrml","text",i),void 0!==t.icn3d.biomtMatrices&&t.icn3d.biomtMatrices.length>1&&t.icn3d.bAssembly&&Object.keys(t.icn3d.dAtoms).length*t.icn3d.biomtMatrices.length>t.icn3d.maxAtoms3DMultiFile){alert(t.icn3d.biomtMatrices.length+" files will be generated for this assembly. Please merge these files using some software and 3D print the merged file.");var o=new THREE.Matrix4;o.identity();for(var r=1,s=0;s<t.icn3d.biomtMatrices.length;s++){var a=t.icn3d.biomtMatrices[s];if(void 0!==a&&!a.equals(o)){var c=100*(s+1);setTimeout(function(o,r){i=t.saveVrmlFile(o),t.saveFile(n+e+r+".vrml","text",i),i=""}.bind(this,a,r),c),++r}}t.icn3d.threshbox=180}},clkMn1_exportStl:function(){var e=this;$("#"+e.pre+"mn1_exportStl").click(function(t){e.setLogCmd("export stl file",!1),e.exportStlFile("")})},clkMn1_exportVrml:function(){var e=this;$("#"+e.pre+"mn1_exportVrml").click(function(t){e.setLogCmd("export vrml file",!1),e.exportVrmlFile("")})},clkMn1_exportStlStab:function(){var e=this;$("#"+e.pre+"mn1_exportStlStab").click(function(t){e.setLogCmd("export stl stabilizer file",!1),e.hideStabilizer(),e.resetAfter3Dprint(),e.addStabilizer(),e.exportStlFile("_stab")})},clkMn1_exportVrmlStab:function(){var e=this;$("#"+e.pre+"mn1_exportVrmlStab").click(function(t){e.setLogCmd("export vrml stabilizer file",!1),e.hideStabilizer(),e.resetAfter3Dprint(),e.addStabilizer(),e.exportVrmlFile("_stab")})},clkMn6_exportInteraction:function(){var e=this;$("#"+e.pre+"mn6_exportInteraction").click(function(t){e.setLogCmd("export interactions",!1),e.exportInteractions()})},clkMn1_exportCanvas:function(){var e=this;$("#"+e.pre+"mn1_exportCanvas").add("#"+e.pre+"saveimage").click(function(t){e.setLogCmd("export canvas",!1);var i=e.inputid?e.inputid:"custom";e.saveFile(i+"_image_icn3d_loadable.png","png")})},clkMn1_exportCounts:function(){var e=this;$("#"+e.pre+"mn1_exportCounts").click(function(t){e.setLogCmd("export counts",!1);var i="<html><body><b>Total Count for atoms with coordinates</b>:<br/><table border=1><tr><th>Structure Count</th><th>Chain Count</th><th>Residue Count</th><th>Atom Count</th></tr>";i+="<tr><td>"+Object.keys(e.icn3d.structures).length+"</td><td>"+Object.keys(e.icn3d.chains).length+"</td><td>"+Object.keys(e.icn3d.residues).length+"</td><td>"+Object.keys(e.icn3d.atoms).length+"</td></tr>",i+="</table><br/>",i+="<b>Counts by Chain for atoms with coordinates</b>:<br/><table border=1><tr><th>Structure</th><th>Chain</th><th>Residue Count</th><th>Atom Count</th></tr>";for(var n=Object.keys(e.icn3d.chains),o=0,r=n.length;o<r;++o){var s=n[o],a=s.indexOf("_"),c=s.substr(0,a),d=s.substr(a+1),l={},p=e.icn3d.chains[s];for(var h in p)l[e.icn3d.atoms[h].resi]=1;i+="<tr><td>"+c+"</td><td>"+d+"</td><td>"+Object.keys(l).length+"</td><td>"+Object.keys(e.icn3d.chains[s]).length+"</td></tr>"}i+="</table><br/></body></html>";var u=e.inputid?e.inputid:"custom";e.saveFile(u+"_counts.html","html",i)})},clkMn1_exportSelections:function(){var e=this;$("#"+e.pre+"mn1_exportSelections").click(function(t){e.setLogCmd("export all selections",!1);var i=e.exportCustomAtoms(),n=e.inputid?e.inputid:"custom";e.saveFile(n+"_selections.txt","text",[i])})},clkMn1_sharelink:function(){var e=this;$("#"+e.pre+"mn1_sharelink").click(function(t){e.shareLink()})},clkMn1_link_structure:function(){var e=this;$("#"+e.pre+"mn1_link_structure").click(function(t){var i=e.getLinkToStructureSummary(!0);window.open(i,"_blank")})},clkMn1_link_bind:function(){var e=this;$("#"+e.pre+"mn1_link_bind").click(function(t){url="https://www.ncbi.nlm.nih.gov/pccompound?LinkName=pccompound_structure&from_uid="+e.inputid,e.setLogCmd("link to 3D protein structures bound to CID "+e.inputid+": "+url,!1),window.open(url,"_blank")})},clkMn1_link_vast:function(){var e=this;$("#"+e.pre+"mn1_link_vast").click(function(t){if(void 0===e.inputid)i="https://www.ncbi.nlm.nih.gov/pccompound?term="+e.icn3d.molTitle,e.setLogCmd("link to compounds "+e.icn3d.molTitle+": "+i,!1);else{if(void 0!==e.cfg.cid)i="https://www.ncbi.nlm.nih.gov/pccompound?LinkName=pccompound_pccompound_3d&from_uid="+e.inputid,e.setLogCmd("link to compounds with structure similar to CID "+e.inputid+": "+i,!1);else{var i,n=e.inputid.split("_");1===n.length?(i="https://www.ncbi.nlm.nih.gov/Structure/vastplus/vastplus.cgi?uid="+e.inputid,e.setLogCmd("link to structures similar to "+e.inputid+": "+i,!1)):2===n.length&&(i="https://www.ncbi.nlm.nih.gov/Structure/vastplus/vastplus.cgi?uid="+n[0],e.setLogCmd("link to structures similar to "+n[0]+": "+i,!1))}window.open(i,"_blank")}})},clkMn1_link_pubmed:function(){var e=this;$("#"+e.pre+"mn1_link_pubmed").click(function(t){var i;if(void 0===e.inputid){var i;i="https://www.ncbi.nlm.nih.gov/pubmed/?term="+e.icn3d.molTitle,e.setLogCmd("link to literature about "+e.icn3d.molTitle+": "+i,!1),window.open(i,"_blank")}else if(void 0!==e.pmid){var i,n=e.pmid.toString().split("_");1===n.length?(i="https://www.ncbi.nlm.nih.gov/pubmed/"+e.pmid,e.setLogCmd("link to PubMed ID "+e.pmid+": "+i,!1)):2===n.length&&(i="https://www.ncbi.nlm.nih.gov/pubmed/?term="+n[0]+" OR "+n[1],e.setLogCmd("link to PubMed IDs "+n[0]+", "+n[1]+": "+i,!1)),window.open(i,"_blank")}else if(isNaN(e.inputid)){var i,n=e.inputid.toString().split("_");1===n.length?(i="https://www.ncbi.nlm.nih.gov/pubmed/?term="+e.inputid,e.setLogCmd("link to literature about PDB "+e.inputid+": "+i,!1)):2===n.length&&(i="https://www.ncbi.nlm.nih.gov/pubmed/?term="+n[0]+" OR "+n[1],e.setLogCmd("link to literature about PDB "+n[0]+" OR "+n[1]+": "+i,!1)),window.open(i,"_blank")}else void 0!==e.cfg.cid?alert("No literature information is available for this compound in the SDF file."):alert("No literature information is available for this structure.")})},clkMn1_link_protein:function(){var e=this;$("#"+e.pre+"mn1_link_protein").click(function(t){for(var i=Object.keys(e.icn3d.structures),n=Object.keys(e.icn3d.chains),o="",r=0,s=n.length;r<s;++r){var a=e.icn3d.getFirstCalphaAtomObj(e.icn3d.chains[n[r]]);e.icn3d.proteins.hasOwnProperty(a.serial)&&6==n[r].length&&(o+=n[r]+"[accession] OR ")}o.length>0&&(o=o.substr(0,o.length-4));var c="https://www.ncbi.nlm.nih.gov/protein/?term="+o;e.setLogCmd("link to Entrez protein about PDB "+i+": "+c,!1),window.open(c,"_blank")})},clkMn2_selectannotations:function(){var e=this;$("#"+e.pre+"mn6_selectannotations").click(function(t){e.showAnnotations(),e.setLogCmd("view annotations",!0)})},clkMn2_selectall:function(){var e=this;$("#"+e.pre+"mn2_selectall").click(function(t){e.setLogCmd("select all",!0),e.selectAll(),e.removeHlAll(),e.icn3d.draw()}),$("#"+e.pre+"clearall").click(function(t){e.setLogCmd("clear all",!0),e.bSelectResidue=!1,e.selectAll(),e.removeHlAll(),e.icn3d.draw()})},clkMn2_selectcomplement:function(){var e=this;$("#"+e.pre+"mn2_selectcomplement").click(function(t){Object.keys(e.icn3d.hAtoms).length<Object.keys(e.icn3d.atoms).length&&(e.setLogCmd("select complement",!0),e.selectComplement())})},clkMn2_selectsidechains:function(){var e=this;$("#"+e.pre+"mn2_selectsidechains").click(function(t){e.setLogCmd("select side chains",!0),e.selectSideChains()})},clkMn2_alignment:function(){var e=this;$("#"+e.pre+"mn2_alignment").click(function(t){e.openDialog(e.pre+"dl_alignment","Select residues in aligned sequences")})},clkMn2_command:function(){var e=this;$("#"+e.pre+"mn2_command").click(function(t){e.openDialog(e.pre+"dl_advanced2","Select by specification")})},clkMn2_definedsets:function(){var e=this;$("#"+e.pre+"mn2_definedsets").add("#"+e.pre+"definedsets").click(function(t){e.showSets(),e.setLogCmd("defined sets",!0)}),$("#"+e.pre+"setOr").click(function(t){e.setOperation="or"}),$("#"+e.pre+"setAnd").click(function(t){e.setOperation="and"}),$("#"+e.pre+"setNot").click(function(t){e.setOperation="not"})},clkMn2_pkNo:function(){var e=this;$("#"+e.pre+"mn2_pkNo").click(function(t){e.icn3d.pk=0,e.icn3d.opts.pk="no",e.setLogCmd("set pk off",!0),e.icn3d.draw(),e.icn3d.removeHlObjects()})},clkMn2_pkYes:function(){var e=this;$("#"+e.pre+"mn2_pkYes").click(function(t){e.icn3d.pk=1,e.icn3d.opts.pk="atom",e.setLogCmd("set pk atom",!0)})},clkMn2_pkResidue:function(){var e=this;$("#"+e.pre+"mn2_pkResidue").click(function(t){e.icn3d.pk=2,e.icn3d.opts.pk="residue",e.setLogCmd("set pk residue",!0)})},clkMn2_pkStrand:function(){var e=this;$("#"+e.pre+"mn2_pkStrand").click(function(t){e.icn3d.pk=3,e.icn3d.opts.pk="strand",e.setLogCmd("set pk strand",!0)})},clkMn2_pkChain:function(){var e=this;$("#"+e.pre+"mn2_pkChain").click(function(t){e.icn3d.pk=4,e.icn3d.opts.pk="chain",e.setLogCmd("set pk chain",!0)})},clkMn2_aroundsphere:function(){var e=this;$("#"+e.pre+"mn2_aroundsphere").click(function(t){e.openDialog(e.pre+"dl_aroundsphere","Select a sphere around current selection")})},clkMn2_select_chain:function(){var e=this;$("#"+e.pre+"mn2_select_chain").add("#"+e.pre+"definedSets").click(function(t){e.openDialog(e.pre+"dl_select_chain","Select Structure/Chain/Custom Selection")})},clkMn3_proteinsRibbon:function(){var e=this;$("#"+e.pre+"mn3_proteinsRibbon").click(function(t){e.setStyle("proteins","ribbon"),e.setLogCmd("style proteins ribbon",!0)})},clkMn3_proteinsStrand:function(){var e=this;$("#"+e.pre+"mn3_proteinsStrand").click(function(t){e.setStyle("proteins","strand"),e.setLogCmd("style proteins strand",!0)})},clkMn3_proteinsCylinder:function(){var e=this;$("#"+e.pre+"mn3_proteinsCylinder").click(function(t){e.setStyle("proteins","cylinder and plate"),e.setLogCmd("style proteins cylinder and plate",!0)})},clkMn3_proteinsSchematic:function(){var e=this;$("#"+e.pre+"mn3_proteinsSchematic").click(function(t){e.setStyle("proteins","schematic"),e.setLogCmd("style proteins schematic",!0)})},clkMn3_proteinsCalpha:function(){var e=this;$("#"+e.pre+"mn3_proteinsCalpha").click(function(t){e.setStyle("proteins","c alpha trace"),e.setLogCmd("style proteins c alpha trace",!0)})},clkMn3_proteinsBfactor:function(){var e=this;$("#"+e.pre+"mn3_proteinsBfactor").click(function(t){e.setStyle("proteins","b factor tube"),e.setLogCmd("style proteins b factor tube",!0)})},clkMn3_proteinsLines:function(){var e=this;$("#"+e.pre+"mn3_proteinsLines").click(function(t){e.setStyle("proteins","lines"),e.setLogCmd("style proteins lines",!0)})},clkMn3_proteinsStick:function(){var e=this;$("#"+e.pre+"mn3_proteinsStick").click(function(t){e.setStyle("proteins","stick"),e.setLogCmd("style proteins stick",!0)})},clkMn3_proteinsBallstick:function(){var e=this;$("#"+e.pre+"mn3_proteinsBallstick").click(function(t){e.setStyle("proteins","ball and stick"),e.setLogCmd("style proteins ball and stick",!0)})},clkMn3_proteinsSphere:function(){var e=this;$("#"+e.pre+"mn3_proteinsSphere").click(function(t){e.setStyle("proteins","sphere"),e.setLogCmd("style proteins sphere",!0)})},clkMn3_proteinsNo:function(){var e=this;$("#"+e.pre+"mn3_proteinsNo").click(function(t){e.setStyle("proteins","nothing"),e.setLogCmd("style proteins nothing",!0)})},clkMn3_sidecLines:function(){var e=this;$("#"+e.pre+"mn3_sidecLines").click(function(t){e.setStyle("sidec","lines"),e.setLogCmd("style sidec lines",!0)})},clkMn3_sidecStick:function(){var e=this;$("#"+e.pre+"mn3_sidecStick").click(function(t){e.setStyle("sidec","stick"),e.setLogCmd("style sidec stick",!0)})},clkMn3_sidecBallstick:function(){var e=this;$("#"+e.pre+"mn3_sidecBallstick").click(function(t){e.setStyle("sidec","ball and stick"),e.setLogCmd("style sidec ball and stick",!0)})},clkMn3_sidecSphere:function(){var e=this;$("#"+e.pre+"mn3_sidecSphere").click(function(t){e.setStyle("sidec","sphere"),e.setLogCmd("style sidec sphere",!0)})},clkMn3_sidecNo:function(){var e=this;$("#"+e.pre+"mn3_sidecNo").click(function(t){e.setStyle("sidec","nothing"),e.setLogCmd("style sidec nothing",!0)})},clkMn3_nuclCartoon:function(){var e=this;$("#"+e.pre+"mn3_nuclCartoon").click(function(t){e.setStyle("nucleotides","nucleotide cartoon"),e.setLogCmd("style nucleotides nucleotide cartoon",!0)})},clkMn3_nuclSchematic:function(){var e=this;$("#"+e.pre+"mn3_nuclSchematic").click(function(t){e.setStyle("nucleotides","schematic"),e.setLogCmd("style nucleotides schematic",!0)})},clkMn3_nuclPhos:function(){var e=this;$("#"+e.pre+"mn3_nuclPhos").click(function(t){e.setStyle("nucleotides","o3 trace"),e.setLogCmd("style nucleotides o3 trace",!0)})},clkMn3_nuclLines:function(){var e=this;$("#"+e.pre+"mn3_nuclLines").click(function(t){e.setStyle("nucleotides","lines"),e.setLogCmd("style nucleotides lines",!0)})},clkMn3_nuclStick:function(){var e=this;$("#"+e.pre+"mn3_nuclStick").click(function(t){e.setStyle("nucleotides","stick"),e.setLogCmd("style nucleotides stick",!0)})},clkMn3_nuclBallstick:function(){var e=this;$("#"+e.pre+"mn3_nuclBallstick").click(function(t){e.setStyle("nucleotides","ball and stick"),e.setLogCmd("style nucleotides ball and stick",!0)})},clkMn3_nuclSphere:function(){var e=this;$("#"+e.pre+"mn3_nuclSphere").click(function(t){e.setStyle("nucleotides","sphere"),e.setLogCmd("style nucleotides sphere",!0)})},clkMn3_nuclNo:function(){var e=this;$("#"+e.pre+"mn3_nuclNo").click(function(t){e.setStyle("nucleotides","nothing"),e.setLogCmd("style nucleotides nothing",!0)})},clkMn3_ligLines:function(){var e=this;$("#"+e.pre+"mn3_ligLines").click(function(t){e.setStyle("chemicals","lines"),e.setLogCmd("style chemicals lines",!0)})},clkMn3_ligStick:function(){var e=this;$("#"+e.pre+"mn3_ligStick").click(function(t){e.setStyle("chemicals","stick"),e.setLogCmd("style chemicals stick",!0)})},clkMn3_ligBallstick:function(){var e=this;$("#"+e.pre+"mn3_ligBallstick").click(function(t){e.setStyle("chemicals","ball and stick"),e.setLogCmd("style chemicals ball and stick",!0)})},clkMn3_ligSchematic:function(){var e=this;$("#"+e.pre+"mn3_ligSchematic").click(function(t){e.setStyle("chemicals","schematic"),e.setLogCmd("style chemicals schematic",!0)})},clkMn3_ligSphere:function(){var e=this;$("#"+e.pre+"mn3_ligSphere").click(function(t){e.setStyle("chemicals","sphere"),e.setLogCmd("style chemicals sphere",!0)})},clkMn3_ligNo:function(){var e=this;$("#"+e.pre+"mn3_ligNo").click(function(t){e.setStyle("chemicals","nothing"),e.setLogCmd("style chemicals nothing",!0)})},clkMn3_ionsSphere:function(){var e=this;$("#"+e.pre+"mn3_ionsSphere").click(function(t){e.setStyle("ions","sphere"),e.setLogCmd("style ions sphere",!0)})},clkMn3_ionsDot:function(){var e=this;$("#"+e.pre+"mn3_ionsDot").click(function(t){e.setStyle("ions","dot"),e.setLogCmd("style ions dot",!0)})},clkMn3_ionsNo:function(){var e=this;$("#"+e.pre+"mn3_ionsNo").click(function(t){e.setStyle("ions","nothing"),e.setLogCmd("style ions nothing",!0)})},clkMn3_waterSphere:function(){var e=this;$("#"+e.pre+"mn3_waterSphere").click(function(t){e.setStyle("water","sphere"),e.setLogCmd("style water sphere",!0)})},clkMn3_waterDot:function(){var e=this;$("#"+e.pre+"mn3_waterDot").click(function(t){e.setStyle("water","dot"),e.setLogCmd("style water dot",!0)})},clkMn3_waterNo:function(){var e=this;$("#"+e.pre+"mn3_waterNo").click(function(t){e.setStyle("water","nothing"),e.setLogCmd("style water nothing",!0)})},clkMn4_clrSpectrum:function(){var e=this;$("#"+e.pre+"mn4_clrSpectrum").click(function(t){e.setOption("color","spectrum"),e.setLogCmd("color spectrum",!0)})},clkMn4_clrChain:function(){var e=this;$("#"+e.pre+"mn4_clrChain").click(function(t){e.setOption("color","chain"),e.setLogCmd("color chain",!0)})},clkMn4_clrSSGreen:function(){var e=this;$("#"+e.pre+"mn4_clrSSGreen").click(function(t){e.icn3d.sheetcolor="green",e.setOption("color","secondary structure"),e.setLogCmd("color secondary structure",!0)})},clkMn4_clrSSYellow:function(){var e=this;$("#"+e.pre+"mn4_clrSSYellow").click(function(t){e.icn3d.sheetcolor="yellow",e.setOption("color","secondary structure yellow"),e.setLogCmd("color secondary structure yellow",!0)})},clkMn4_clrResidue:function(){var e=this;$("#"+e.pre+"mn4_clrResidue").click(function(t){e.setOption("color","residue"),e.setLogCmd("color residue",!0)})},clkMn4_clrCharge:function(){var e=this;$("#"+e.pre+"mn4_clrCharge").click(function(t){e.setOption("color","charge"),e.setLogCmd("color charge",!0)})},clkMn4_clrHydrophobic:function(){var e=this;$("#"+e.pre+"mn4_clrHydrophobic").click(function(t){e.setOption("color","hydrophobic"),e.setLogCmd("color hydrophobic",!0)})},clkMn4_clrAtom:function(){var e=this;$("#"+e.pre+"mn4_clrAtom").click(function(t){e.setOption("color","atom"),e.setLogCmd("color atom",!0)})},clkMn4_clrBfactor:function(){var e=this;$("#"+e.pre+"mn4_clrBfactor").click(function(t){e.setOption("color","b factor"),e.setLogCmd("color b factor",!0)})},clkMn4_clrBfactorNorm:function(){var e=this;$("#"+e.pre+"mn4_clrBfactorNorm").click(function(t){e.setOption("color","b factor percentile"),e.setLogCmd("color b factor percentile",!0)})},clkMn4_clrIdentity:function(){var e=this;$("#"+e.pre+"mn4_clrIdentity").click(function(t){e.setOption("color","identity"),e.setLogCmd("color identity",!0)})},clkMn4_clrConserved:function(){var e=this;$("#"+e.pre+"mn4_clrConserved").click(function(t){e.setOption("color","conservation"),e.setLogCmd("color conservation",!0)})},clkMn4_clrRed:function(){var e=this;$("#"+e.pre+"mn4_clrRed").click(function(t){e.setOption("color","red"),e.setLogCmd("color red",!0)})},clkMn4_clrGreen:function(){var e=this;$("#"+e.pre+"mn4_clrGreen").click(function(t){e.setOption("color","green"),e.setLogCmd("color green",!0)})},clkMn4_clrBlue:function(){var e=this;$("#"+e.pre+"mn4_clrBlue").click(function(t){e.setOption("color","blue"),e.setLogCmd("color blue",!0)})},clkMn4_clrMagenta:function(){var e=this;$("#"+e.pre+"mn4_clrMagenta").click(function(t){e.setOption("color","magenta"),e.setLogCmd("color magenta",!0)})},clkMn4_clrYellow:function(){var e=this;$("#"+e.pre+"mn4_clrYellow").click(function(t){e.setOption("color","yellow"),e.setLogCmd("color yellow",!0)})},clkMn4_clrCyan:function(){var e=this;$("#"+e.pre+"mn4_clrCyan").click(function(t){e.setOption("color","cyan"),e.setLogCmd("color cyan",!0)})},clkMn4_clrWhite:function(){var e=this;$("#"+e.pre+"mn4_clrWhite").click(function(t){e.setOption("color","white"),e.setLogCmd("color white",!0)})},clkMn4_clrGrey:function(){var e=this;$("#"+e.pre+"mn4_clrGrey").click(function(t){e.setOption("color","grey"),e.setLogCmd("color grey",!0)})},clkMn4_clrCustom:function(){var e=this;$("#"+e.pre+"mn4_clrCustom").click(function(t){e.openDialog(e.pre+"dl_clr","Color picker")})},clkMn4_clrSave:function(){var e=this;$("#"+e.pre+"mn4_clrSave").click(function(t){e.saveColor(),e.setLogCmd("save color",!0)})},clkMn4_clrApplySave:function(){var e=this;$("#"+e.pre+"mn4_clrApplySave").click(function(t){e.applySavedColor(),e.setLogCmd("apply saved color",!0)})},clkMn3_styleSave:function(){var e=this;$("#"+e.pre+"mn3_styleSave").click(function(t){e.saveStyle(),e.setLogCmd("save style",!0)})},clkMn3_styleApplySave:function(){var e=this;$("#"+e.pre+"mn3_styleApplySave").click(function(t){e.applySavedStyle(),e.setLogCmd("apply saved style",!0)})},clkMn5_neighborsYes:function(){var e=this;$("#"+e.pre+"mn5_neighborsYes").click(function(t){e.icn3d.bConsiderNeighbors=!0,e.icn3d.removeLastSurface(),e.icn3d.applySurfaceOptions(),e.icn3d.render(),e.setLogCmd("set surface neighbors on",!0)})},clkMn5_neighborsNo:function(){var e=this;$("#"+e.pre+"mn5_neighborsNo").click(function(t){e.icn3d.bConsiderNeighbors=!1,e.icn3d.removeLastSurface(),e.icn3d.applySurfaceOptions(),e.icn3d.render(),e.setLogCmd("set surface neighbors off",!0)})},clkMn5_surfaceVDW:function(){var e=this;$("#"+e.pre+"mn5_surfaceVDW").click(function(t){e.icn3d.bConsiderNeighbors=!1,e.setOption("surface","Van der Waals surface"),e.setLogCmd("set surface Van der Waals surface",!0)})},clkMn5_surfaceSAS:function(){var e=this;$("#"+e.pre+"mn5_surfaceSAS").click(function(t){e.icn3d.bConsiderNeighbors=!1,e.setOption("surface","solvent accessible surface"),e.setLogCmd("set surface solvent accessible surface",!0)})},clkMn5_surfaceMolecular:function(){var e=this;$("#"+e.pre+"mn5_surfaceMolecular").click(function(t){e.icn3d.bConsiderNeighbors=!1,e.setOption("surface","molecular surface"),e.setLogCmd("set surface molecular surface",!0)})},clkMn5_surfaceVDWContext:function(){var e=this;$("#"+e.pre+"mn5_surfaceVDWContext").click(function(t){e.icn3d.bConsiderNeighbors=!0,e.setOption("surface","Van der Waals surface with context"),e.setLogCmd("set surface Van der Waals surface with context",!0)})},clkMn5_surfaceSASContext:function(){var e=this;$("#"+e.pre+"mn5_surfaceSASContext").click(function(t){e.icn3d.bConsiderNeighbors=!0,e.setOption("surface","solvent accessible surface with context"),e.setLogCmd("set surface solvent accessible surface with context",!0)})},clkMn5_surfaceMolecularContext:function(){var e=this;$("#"+e.pre+"mn5_surfaceMolecularContext").click(function(t){e.icn3d.bConsiderNeighbors=!0,e.setOption("surface","molecular surface with context"),e.setLogCmd("set surface molecular surface with context",!0)})},clkMn5_surfaceNo:function(){var e=this;$("#"+e.pre+"mn5_surfaceNo").click(function(t){e.setOption("surface","nothing"),e.setLogCmd("set surface nothing",!0)})},clkMn5_opacity10:function(){var e=this;$("#"+e.pre+"mn5_opacity10").click(function(t){e.setOption("opacity","1.0"),e.setLogCmd("set surface opacity 1.0",!0)})},clkMn5_opacity09:function(){var e=this;$("#"+e.pre+"mn5_opacity09").click(function(t){e.setOption("opacity","0.9"),e.setLogCmd("set surface opacity 0.9",!0)})},clkMn5_opacity08:function(){var e=this;$("#"+e.pre+"mn5_opacity08").click(function(t){e.setOption("opacity","0.8"),e.setLogCmd("set surface opacity 0.8",!0)})},clkMn5_opacity07:function(){var e=this;$("#"+e.pre+"mn5_opacity07").click(function(t){e.setOption("opacity","0.7"),e.setLogCmd("set surface opacity 0.7",!0)})},clkMn5_opacity06:function(){var e=this;$("#"+e.pre+"mn5_opacity06").click(function(t){e.setOption("opacity","0.6"),e.setLogCmd("set surface opacity 0.6",!0)})},clkMn5_opacity05:function(){var e=this;$("#"+e.pre+"mn5_opacity05").click(function(t){e.setOption("opacity","0.5"),e.setLogCmd("set surface opacity 0.5",!0)})},clkMn5_opacity04:function(){var e=this;$("#"+e.pre+"mn5_opacity04").click(function(t){e.setOption("opacity","0.4"),e.setLogCmd("set surface opacity 0.4",!0)})},clkMn5_opacity03:function(){var e=this;$("#"+e.pre+"mn5_opacity03").click(function(t){e.setOption("opacity","0.3"),e.setLogCmd("set surface opacity 0.3",!0)})},clkMn5_opacity02:function(){var e=this;$("#"+e.pre+"mn5_opacity02").click(function(t){e.setOption("opacity","0.2"),e.setLogCmd("set surface opacity 0.2",!0)})},clkMn5_opacity01:function(){var e=this;$("#"+e.pre+"mn5_opacity01").click(function(t){e.setOption("opacity","0.1"),e.setLogCmd("set surface opacity 0.1",!0)})},clkMn5_wireframeYes:function(){var e=this;$("#"+e.pre+"mn5_wireframeYes").click(function(t){e.setOption("wireframe","yes"),e.setLogCmd("set surface wireframe on",!0)})},clkMn5_wireframeNo:function(){var e=this;$("#"+e.pre+"mn5_wireframeNo").click(function(t){e.setOption("wireframe","no"),e.setLogCmd("set surface wireframe off",!0)})},clkMn5_elecmap2fofc:function(){var e=this;$("#"+e.pre+"mn5_elecmap2fofc").click(function(t){e.openDialog(e.pre+"dl_elecmap2fofc","2Fo-Fc Electron Density Map")})},clkMn5_elecmapfofc:function(){var e=this;$("#"+e.pre+"mn5_elecmapfofc").click(function(t){e.openDialog(e.pre+"dl_elecmapfofc","Fo-Fc Electron Density Map")})},clkMn5_elecmapNo:function(){var e=this;$("#"+e.pre+"mn5_elecmapNo").add("#"+e.pre+"elecmapNo2").add("#"+e.pre+"elecmapNo3").click(function(t){e.setOption("map","nothing"),e.setLogCmd("set map nothing",!0)})},clickApplymap2fofc:function(){var e=this;$("#"+e.pre+"applymap2fofc").click(function(t){t.preventDefault();var i=parseFloat($("#"+e.pre+"sigma2fofc").val()),n="2fofc";e.Dsn6Parser(e.inputid,n,i),e.setLogCmd("set map 2fofc sigma "+i+";",!0)})},clickApplymapfofc:function(){var e=this;$("#"+e.pre+"applymapfofc").click(function(t){t.preventDefault();var i=parseFloat($("#"+e.pre+"sigmafofc").val()),n="fofc";e.Dsn6Parser(e.inputid,n,i),e.setLogCmd("set map fofc sigma "+i+";",!0)})},clkMn5_mapwireframeYes:function(){var e=this;$("#"+e.pre+"mn5_mapwireframeYes").click(function(t){e.setOption("mapwireframe","yes"),e.setLogCmd("set map wireframe on",!0)})},clkMn5_mapwireframeNo:function(){var e=this;$("#"+e.pre+"mn5_mapwireframeNo").click(function(t){e.setOption("mapwireframe","no"),e.setLogCmd("set map wireframe off",!0)})},clkMn5_emmap:function(){var e=this;$("#"+e.pre+"mn5_emmap").click(function(t){e.openDialog(e.pre+"dl_emmap","EM Density Map")})},clkMn5_emmapNo:function(){var e=this;$("#"+e.pre+"mn5_emmapNo").add("#"+e.pre+"emmapNo2").click(function(t){e.setOption("emmap","nothing"),e.setLogCmd("set emmap nothing",!0)})},clickApplyemmap:function(){var e=this;$("#"+e.pre+"applyemmap").click(function(t){t.preventDefault();var i=parseFloat($("#"+e.pre+"empercentage").val()),n="em";e.DensityCifParser(e.inputid,n,i,e.icn3d.emd),e.setLogCmd("set emmap percentage "+i+";",!0)})},clkMn5_emmapwireframeYes:function(){var e=this;$("#"+e.pre+"mn5_emmapwireframeYes").click(function(t){e.setOption("emmapwireframe","yes"),e.setLogCmd("set emmap wireframe on",!0)})},clkMn5_emmapwireframeNo:function(){var e=this;$("#"+e.pre+"mn5_emmapwireframeNo").click(function(t){e.setOption("emmapwireframe","no"),e.setLogCmd("set emmap wireframe off",!0)})},clkMn6_assemblyYes:function(){var e=this;$("#"+e.pre+"mn6_assemblyYes").click(function(t){e.icn3d.bAssembly=!0,e.setLogCmd("set assembly on",!0),e.icn3d.draw()})},clkMn6_assemblyNo:function(){var e=this;$("#"+e.pre+"mn6_assemblyNo").click(function(t){e.icn3d.bAssembly=!1,e.setLogCmd("set assembly off",!0),e.icn3d.draw()})},clkMn6_addlabelResidues:function(){var e=this;$("#"+e.pre+"mn6_addlabelResidues").click(function(t){e.icn3d.addResiudeLabels(e.icn3d.hAtoms),e.saveSelectionIfSelected(),e.setLogCmd("add residue labels",!0),e.icn3d.draw()})},clkMn6_addlabelChains:function(){var e=this;$("#"+e.pre+"mn6_addlabelChains").click(function(t){e.addChainLabels(e.icn3d.hAtoms),e.saveSelectionIfSelected(),e.setLogCmd("add chain labels",!0),e.icn3d.draw()})},clkMn6_addlabelTermini:function(){var e=this;$("#"+e.pre+"mn6_addlabelTermini").click(function(t){e.addTerminiLabels(e.icn3d.hAtoms),e.saveSelectionIfSelected(),e.setLogCmd("add terminal labels",!0),e.icn3d.draw()})},clkMn6_addlabelYes:function(){var e=this;$("#"+e.pre+"mn6_addlabelYes").click(function(t){e.openDialog(e.pre+"dl_addlabel","Add custom labels by selection"),e.icn3d.pk=1,e.icn3d.opts.pk="atom",e.icn3d.pickpair=!0,e.icn3d.pAtomNum=0})},clkMn6_addlabelSelection:function(){var e=this;$("#"+e.pre+"mn6_addlabelSelection").click(function(t){e.openDialog(e.pre+"dl_addlabelselection","Add custom labels by the current selection")})},clkMn2_saveselection:function(){var e=this;$("#"+e.pre+"mn2_saveselection").click(function(t){e.openDialog(e.pre+"dl_saveselection","Save the current selection")})},clkMn6_addlabelNo:function(){var e=this;$("#"+e.pre+"mn6_addlabelNo").add("#"+e.pre+"removeLabels").click(function(t){e.icn3d.pickpair=!1;var i="set labels off";e.setLogCmd(i,!0);for(var n in e.icn3d.labels)e.icn3d.labels[n]=[];e.icn3d.draw()})},clkMn6_distanceYes:function(){var e=this;$("#"+e.pre+"mn6_distanceYes").click(function(t){e.openDialog(e.pre+"dl_distance","Measure the distance of atoms"),e.icn3d.pk=1,e.icn3d.opts.pk="atom",e.icn3d.pickpair=!0,e.icn3d.pAtomNum=0,e.bMeasureDistance=!0})},clkMn6_distanceNo:function(){var e=this;$("#"+e.pre+"mn6_distanceNo").click(function(t){e.icn3d.pickpair=!1;var i="set lines off";e.setLogCmd(i,!0),e.icn3d.labels.distance=[],e.icn3d.lines.distance=[],e.icn3d.pk=2,e.icn3d.draw()})},clkMn2_selectedcenter:function(){var e=this;$("#"+e.pre+"mn2_selectedcenter").add("#"+e.pre+"zoomin_selection").click(function(t){e.icn3d.zoominSelection(),e.icn3d.draw(),e.setLogCmd("zoom selection",!0)})},clkMn6_center:function(){var e=this;$("#"+e.pre+"mn6_center").click(function(t){e.icn3d.centerSelection(),e.icn3d.draw(),e.setLogCmd("center selection",!0)})},clkMn6_resetOrientation:function(){var e=this;$("#"+e.pre+"mn6_resetOrientation").add("#"+e.pre+"resetOrientation").click(function(t){e.icn3d.resetOrientation(),e.icn3d.applyOriginalColor(),e.icn3d.draw(),e.setLogCmd("reset orientation",!0)})},clkMn6_chemicalbindingshow:function(){var e=this;$("#"+e.pre+"mn6_chemicalbindingshow").add("#"+e.pre+"chemicalbindingshow").click(function(t){e.setOption("chemicalbinding","show"),e.setLogCmd("set chemicalbinding show",!0)})},clkMn6_chemicalbindinghide:function(){var e=this;$("#"+e.pre+"mn6_chemicalbindinghide").add("#"+e.pre+"chemicalbindinghide").click(function(t){e.setOption("chemicalbinding","hide"),e.setLogCmd("set chemicalbinding hide",!0)})},clkMn6_rotateleft:function(){var e=this;$("#"+e.pre+"mn6_rotateleft").click(function(t){e.setLogCmd("rotate left",!0),e.icn3d.bStopRotate=!1,e.icn3d.rotateCount=0,e.icn3d.rotateCountMax=6e3,e.ROT_DIR="left",e.rotStruc("left")})},clkMn6_rotateright:function(){var e=this;$("#"+e.pre+"mn6_rotateright").click(function(t){e.setLogCmd("rotate right",!0),e.icn3d.bStopRotate=!1,e.icn3d.rotateCount=0,e.icn3d.rotateCountMax=6e3,e.ROT_DIR="right",e.rotStruc("right")})},clkMn6_rotateup:function(){var e=this;$("#"+e.pre+"mn6_rotateup").click(function(t){e.setLogCmd("rotate up",!0),e.icn3d.bStopRotate=!1,e.icn3d.rotateCount=0,e.icn3d.rotateCountMax=6e3,e.ROT_DIR="up",e.rotStruc("up")})},clkMn6_rotatedown:function(){var e=this;$("#"+e.pre+"mn6_rotatedown").click(function(t){e.setLogCmd("rotate down",!0),e.icn3d.bStopRotate=!1,e.icn3d.rotateCount=0,e.icn3d.rotateCountMax=6e3,e.ROT_DIR="down",e.rotStruc("down")})},clkMn6_cameraPers:function(){var e=this;$("#"+e.pre+"mn6_cameraPers").click(function(t){e.setOption("camera","perspective"),e.setLogCmd("set camera perspective",!0)})},clkMn6_cameraOrth:function(){var e=this;$("#"+e.pre+"mn6_cameraOrth").click(function(t){e.setOption("camera","orthographic"),e.setLogCmd("set camera orthographic",!0)})},clkMn6_bkgdBlack:function(){var e=this;$("#"+e.pre+"mn6_bkgdBlack").click(function(t){e.setOption("background","black"),e.setLogCmd("set background black",!0)})},clkMn6_bkgdGrey:function(){var e=this;$("#"+e.pre+"mn6_bkgdGrey").click(function(t){e.setOption("background","grey"),e.setLogCmd("set background grey",!0)})},clkMn6_bkgdWhite:function(){var e=this;$("#"+e.pre+"mn6_bkgdWhite").click(function(t){e.setOption("background","white"),e.setLogCmd("set background white",!0)})},clkMn6_bkgdTransparent:function(){var e=this;$("#"+e.pre+"mn6_bkgdTransparent").click(function(t){e.setOption("background","transparent"),e.setLogCmd("set background transparent",!0)})},clkMn6_showfogYes:function(){var e=this;$("#"+e.pre+"mn6_showfogYes").click(function(t){e.setOption("fog","yes"),e.setLogCmd("set fog on",!0)})},clkMn6_showfogNo:function(){var e=this;$("#"+e.pre+"mn6_showfogNo").click(function(t){e.setOption("fog","no"),e.setLogCmd("set fog off",!0)})},clkMn6_showslabYes:function(){var e=this;$("#"+e.pre+"mn6_showslabYes").click(function(t){
e.setOption("slab","yes"),e.setLogCmd("set slab on",!0)})},clkMn6_showslabNo:function(){var e=this;$("#"+e.pre+"mn6_showslabNo").click(function(t){e.setOption("slab","no"),e.setLogCmd("set slab off",!0)})},clkMn6_showaxisYes:function(){var e=this;$("#"+e.pre+"mn6_showaxisYes").click(function(t){e.setOption("axis","yes"),e.setLogCmd("set axis on",!0)})},clkMn6_showaxisNo:function(){var e=this;$("#"+e.pre+"mn6_showaxisNo").click(function(t){e.setOption("axis","no"),e.setLogCmd("set axis off",!0)})},clkMn6_hbondsYes:function(){var e=this;$("#"+e.pre+"mn6_hbondsYes").click(function(t){e.openDialog(e.pre+"dl_hbonds","Hydrogen bonds to selection")})},clkMn6_hbondsNo:function(){var e=this;$("#"+e.pre+"mn6_hbondsNo").click(function(t){var i="set hbonds off";e.setLogCmd(i,!0),e.icn3d.hideHbonds(),e.icn3d.draw()})},clkmn1_stabilizerYes:function(){var e=this;$("#"+e.pre+"mn1_stabilizerYes").click(function(t){var i="stabilizer";e.addStabilizer(),e.prepareFor3Dprint(),e.setLogCmd(i,!0)})},clkmn1_stabilizerNo:function(){var e=this;$("#"+e.pre+"mn1_stabilizerNo").click(function(t){var i="set stabilizer off";e.setLogCmd(i,!0),e.hideStabilizer(),e.icn3d.draw()})},clkmn1_stabilizerOne:function(){var e=this;$("#"+e.pre+"mn1_stabilizerOne").click(function(t){e.openDialog(e.pre+"dl_stabilizer","Add One Stabilizer"),e.icn3d.pk=1,e.icn3d.opts.pk="atom",e.icn3d.pickpair=!0,e.icn3d.pAtomNum=0})},clkmn1_stabilizerRmOne:function(){var e=this;$("#"+e.pre+"mn1_stabilizerRmOne").click(function(t){e.openDialog(e.pre+"dl_stabilizer_rm","Remove One Stabilizer"),e.icn3d.pk=1,e.icn3d.opts.pk="atom",e.icn3d.pickpair=!0,e.icn3d.pAtomNum=0})},clkmn1_thicknessSet:function(){var e=this;$("#"+e.pre+"mn1_thicknessSet").click(function(t){e.openDialog(e.pre+"dl_thickness","Set Thickness for 3D Printing")})},clkmn5_setThickness:function(){var e=this;$("#"+e.pre+"mn3_setThickness").click(function(t){e.openDialog(e.pre+"dl_thickness2","Set Thickness")})},clkmn1_thicknessReset:function(){var e=this;$("#"+e.pre+"mn1_thicknessReset").click(function(t){var i="reset thickness";e.setLogCmd(i,!0),e.bSetThickness=!1,e.resetAfter3Dprint(),e.icn3d.draw()})},clkMn6_ssbondsYes:function(){var e=this;$("#"+e.pre+"mn6_ssbondsYes").click(function(t){var i="disulfide bonds";e.setLogCmd(i,!0),e.showSsbonds()})},clkMn6_ssbondsNo:function(){var e=this;$("#"+e.pre+"mn6_ssbondsNo").click(function(t){e.icn3d.opts.ssbonds="no";var i="set disulfide bonds off";e.setLogCmd(i,!0),e.icn3d.lines.ssbond=[],e.setStyle("sidec","nothing")})},clkMn6_clbondsYes:function(){var e=this;$("#"+e.pre+"mn6_clbondsYes").click(function(t){var i="cross linkage";e.setLogCmd(i,!0),e.icn3d.bShowCrossResidueBond=!0,e.setStyle("proteins","lines")})},clkMn6_clbondsNo:function(){var e=this;$("#"+e.pre+"mn6_clbondsNo").click(function(t){e.icn3d.opts.clbonds="no";var i="set cross linkage off";e.setLogCmd(i,!0),e.icn3d.bShowCrossResidueBond=!1,e.setStyle("proteins","ribbon")})},clickViewswitch:function(){var e=this;$("#"+e.pre+"anno_summary").click(function(t){t.preventDefault(),e.setAnnoViewAndDisplay("overview"),e.setLogCmd("set view overview",!0)}),$("#"+e.pre+"anno_details").click(function(t){t.preventDefault(),e.setAnnoViewAndDisplay("detailed view"),e.setLogCmd("set view detailed view",!0)})},clickShow_annotations:function(){var e=this;$("#"+e.pre+"show_annotations").click(function(t){e.showAnnotations(),e.setLogCmd("view annotations",!0)})},clickShowallchains:function(){var e=this;$("#"+e.pre+"showallchains").click(function(t){e.showAnnoAllChains(),e.setLogCmd("show annotations all chains",!0)})},clickShow_alignsequences:function(){var e=this;$("#"+e.pre+"show_alignsequences").click(function(t){e.openDialog(e.pre+"dl_alignment","Select residues in aligned sequences")})},clickShow_2ddgm:function(){var e=this;$("#"+e.pre+"show_2ddgm").add("#"+e.pre+"mn2_2ddgm").click(function(t){if(e.openDialog(e.pre+"dl_2ddgm","Interactions"),!e.b2DShown)if(void 0!==e.cfg.align){var i=Object.keys(e.icn3d.structures);e.set2DDiagramsForAlign(i[0].toUpperCase(),i[1].toUpperCase())}else e.download2Ddgm(e.inputid.toUpperCase());e.setLogCmd("view interactions",!0)})},clickSearchSeq:function(){var e=this;$(document).on("click","#"+e.pre+"search_seq_button",function(t){t.stopImmediatePropagation();var i=$("#"+e.pre+"search_seq").val();isNaN(i)&&i.indexOf("$")==-1&&i.indexOf(".")==-1&&i.indexOf(":")==-1&&i.indexOf("@")==-1&&(i=":"+i);var n=i,o=i;e.selectByCommand(i,n,o),e.setLogCmd("select "+i+" | name "+n,!0)})},clickReload_mmtf:function(){var e=this;$("#"+e.pre+"reload_mmtf").click(function(t){t.preventDefault(),dialog.dialog("close"),e.setLogCmd("load mmtf "+$("#"+e.pre+"mmtfid").val(),!1),window.open("https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?mmtfid="+$("#"+e.pre+"mmtfid").val(),"_blank")})},clickReload_pdb:function(){var e=this;$("#"+e.pre+"reload_pdb").click(function(t){t.preventDefault(),dialog.dialog("close"),e.setLogCmd("load pdb "+$("#"+e.pre+"pdbid").val(),!1),window.open("https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?pdbid="+$("#"+e.pre+"pdbid").val(),"_blank")})},clickReload_align_refined:function(){var e=this;$("#"+e.pre+"reload_align_refined").click(function(t){t.preventDefault(),dialog.dialog("close");var i=$("#"+e.pre+"alignid1").val()+","+$("#"+e.pre+"alignid2").val();e.setLogCmd("load alignment "+i+" | parameters &atype=1",!1),window.open("https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?align="+i+"&showalignseq=1&atype=1","_blank")})},clickReload_align_ori:function(){var e=this;$("#"+e.pre+"reload_align_ori").click(function(t){t.preventDefault(),dialog.dialog("close");var i=$("#"+e.pre+"alignid1").val()+","+$("#"+e.pre+"alignid2").val();e.setLogCmd("load alignment "+i+" | parameters &atype=0",!1),window.open("https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?align="+i+"&showalignseq=1&atype=0","_blank")})},clickReload_mmcif:function(){var e=this;$("#"+e.pre+"reload_mmcif").click(function(t){t.preventDefault(),dialog.dialog("close"),e.setLogCmd("load mmcif "+$("#"+e.pre+"mmcifid").val(),!1),window.open("https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?mmcifid="+$("#"+e.pre+"mmcifid").val(),"_blank")})},clickReload_mmdb:function(){var e=this;$("#"+e.pre+"reload_mmdb").click(function(t){t.preventDefault(),dialog.dialog("close"),e.setLogCmd("load mmdb "+$("#"+e.pre+"mmdbid").val(),!1),window.open("https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?mmdbid="+$("#"+e.pre+"mmdbid").val(),"_blank")})},clickReload_blast_rep_id:function(){var e=this;$("#"+e.pre+"reload_blast_rep_id").click(function(t){t.preventDefault(),dialog.dialog("close");var i=$("#"+e.pre+"query_id").val(),n=encodeURIComponent($("#"+e.pre+"query_fasta").val()),o=$("#"+e.pre+"blast_rep_id").val();e.setLogCmd("load seq_struc_ids "+i+","+o,!1),i=""!==i&&void 0!==i?i:n,window.open("https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?from=icn3d&blast_rep_id="+o+"&query_id="+i,"_blank")})},clickReload_gi:function(){var e=this;$("#"+e.pre+"reload_gi").click(function(t){t.preventDefault(),dialog.dialog("close"),e.setLogCmd("load gi "+$("#"+e.pre+"gi").val(),!1),window.open("https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?gi="+$("#"+e.pre+"gi").val(),"_blank")})},clickReload_cid:function(){var e=this;$("#"+e.pre+"reload_cid").click(function(t){t.preventDefault(),dialog.dialog("close"),e.setLogCmd("load cid "+$("#"+e.pre+"cid").val(),!1),window.open("https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?cid="+$("#"+e.pre+"cid").val(),"_blank")})},clickReload_pngimage:function(){var e=this;$("#"+e.pre+"reload_pngimage").click(function(t){t.preventDefault(),dialog.dialog("close"),$(".ui-dialog-content").dialog("close"),e.init(),e.icn3d.init();var i=$("#"+e.pre+"pngimage")[0].files[0];if(i){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");var n=new FileReader;n.onload=function(t){var i=t.target.result,n="Share Link: ",o=i.indexOf(n),r="Start of data file======\n",s=i.indexOf(r);if(o==-1&&s==-1)alert('Please load a PNG image saved by clicking "Save Datas > PNG Image" in the Data menu...');else if(o!=-1){var a=i.substr(o+n.length);e.setLogCmd("load iCn3D PNG image "+$("#"+e.pre+"pngimage").val(),!1),window.open(a)}else if(s!=-1){e.bInputfile=!0;var c=i.indexOf("End of data file======\n"),d=i.substr(s+r.length,c-s-r.length),l="Start of state file======\n",p=i.indexOf(l),h=i.indexOf("End of state file======\n"),u=i.substr(p+l.length,h-p-l.length),m="Start of type file======\n",f=i.indexOf(m),v=i.indexOf("End of type file======\n"),g=i.substr(f+m.length,v-f-m.length-1);"pdb"===g?$.when(e.loadPdbData(d)).then(function(){e.icn3d.commands=[],e.icn3d.optsHistory=[],e.loadScript(u,!0)}):("mol2"===g?e.loadMol2Data(d):"sdf"===g?e.loadSdfData(d):"xyz"===g?e.loadXyzData(d):"mmcif"===g&&e.loadMmcifData(d),e.icn3d.commands=[],e.icn3d.optsHistory=[],e.loadScript(u,!0)),e.setLogCmd("load iCn3D PNG image "+$("#"+e.pre+"pngimage").val(),!1)}},n.readAsText(i)}else alert("Please select a file before clicking 'Load'")})},clickReload_state:function(){var e=this;$("#"+e.pre+"reload_state").click(function(t){t.preventDefault(),dialog.dialog("close"),$(".ui-dialog-content").dialog("close"),e.bInputfile||(e.init(),e.icn3d.init());var i=$("#"+e.pre+"state")[0].files[0];if(i){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");var n=new FileReader;n.onload=function(t){var i=t.target.result;e.setLogCmd("load state file "+$("#"+e.pre+"state").val(),!1),e.icn3d.commands=[],e.icn3d.optsHistory=[],e.loadScript(i,!0)},n.readAsText(i)}else alert("Please select a file before clicking 'Load'")})},clickReload_selectionfile:function(){var e=this;$("#"+e.pre+"reload_selectionfile").click(function(t){t.preventDefault(),dialog.dialog("close");var i=$("#"+e.pre+"selectionfile")[0].files[0];if(i){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");var n=new FileReader;n.onload=function(t){var i=t.target.result;e.loadSelection(i),e.setLogCmd("load selection file "+$("#"+e.pre+"selectionfile").val(),!1)},n.readAsText(i)}else alert("Please select a file before clicking 'Load'")})},clickReload_pdbfile:function(){var e=this;$("#"+e.pre+"reload_pdbfile").click(function(t){t.preventDefault(),e.bInitial=!0,dialog.dialog("close"),$(".ui-dialog-content").dialog("close");var i=$("#"+e.pre+"pdbfile")[0].files[0];if(i){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");var n=new FileReader;n.onload=function(t){var i=t.target.result;e.setLogCmd("load pdb file "+$("#"+e.pre+"pdbfile").val(),!1),e.icn3d.molTitle="",e.init(),e.icn3d.init(),e.bInputfile=!0,e.InputfileData=i,e.InputfileType="pdb",e.loadPdbData(i)},n.readAsText(i)}else alert("Please select a file before clicking 'Load'")})},clickReload_mol2file:function(){var e=this;$("#"+e.pre+"reload_mol2file").click(function(t){t.preventDefault(),e.bInitial=!0,dialog.dialog("close"),$(".ui-dialog-content").dialog("close");var i=$("#"+e.pre+"mol2file")[0].files[0];if(i){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");var n=new FileReader;n.onload=function(t){var i=t.target.result;e.setLogCmd("load mol2 file "+$("#"+e.pre+"mol2file").val(),!1),e.icn3d.molTitle="",e.inputid=void 0,e.init(),e.icn3d.init(),e.bInputfile=!0,e.InputfileData=i,e.InputfileType="mol2",e.loadMol2Data(i)},n.readAsText(i)}else alert("Please select a file before clicking 'Load'")})},clickReload_sdffile:function(){var e=this;$("#"+e.pre+"reload_sdffile").click(function(t){t.preventDefault(),e.bInitial=!0,dialog.dialog("close"),$(".ui-dialog-content").dialog("close");var i=$("#"+e.pre+"sdffile")[0].files[0];if(i){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");var n=new FileReader;n.onload=function(t){var i=t.target.result;e.setLogCmd("load sdf file "+$("#"+e.pre+"sdffile").val(),!1),e.icn3d.molTitle="",e.inputid=void 0,e.init(),e.icn3d.init(),e.bInputfile=!0,e.InputfileData=i,e.InputfileType="sdf",e.loadSdfData(i)},n.readAsText(i)}else alert("Please select a file before clicking 'Load'")})},clickReload_xyzfile:function(){var e=this;$("#"+e.pre+"reload_xyzfile").click(function(t){t.preventDefault(),e.bInitial=!0,dialog.dialog("close"),$(".ui-dialog-content").dialog("close");var i=$("#"+e.pre+"xyzfile")[0].files[0];if(i){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");var n=new FileReader;n.onload=function(t){var i=t.target.result;e.setLogCmd("load xyz file "+$("#"+e.pre+"xyzfile").val(),!1),e.icn3d.molTitle="",e.inputid=void 0,e.init(),e.icn3d.init(),e.bInputfile=!0,e.InputfileData=i,e.InputfileType="xyz",e.loadXyzData(i)},n.readAsText(i)}else alert("Please select a file before clicking 'Load'")})},clickReload_urlfile:function(){var e=this;$("#"+e.pre+"reload_urlfile").click(function(t){t.preventDefault(),e.bInitial=!0,dialog.dialog("close"),$(".ui-dialog-content").dialog("close");var i=$("#"+e.pre+"filetype").val(),n=$("#"+e.pre+"urlfile").val();e.init(),e.icn3d.init(),e.bInputfile=!0,e.downloadUrl(n,i)})},clickReload_mmciffile:function(){var e=this;$("#"+e.pre+"reload_mmciffile").click(function(t){t.preventDefault(),e.bInitial=!0,dialog.dialog("close"),$(".ui-dialog-content").dialog("close");var i=$("#"+e.pre+"mmciffile")[0].files[0];if(i){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");var n=new FileReader;n.onload=function(t){var i=t.target.result;e.setLogCmd("load mmcif file "+$("#"+e.pre+"mmciffile").val(),!1),e.icn3d.molTitle="";var n="//www.ncbi.nlm.nih.gov/Structure/mmcifparser/mmcifparser.cgi";e.icn3d.bCid=void 0,$.ajax({url:n,type:"POST",data:{mmciffile:i},dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){$("#"+e.pre+"wait")&&$("#"+e.pre+"wait").show(),$("#"+e.pre+"canvas")&&$("#"+e.pre+"canvas").hide(),$("#"+e.pre+"cmdlog")&&$("#"+e.pre+"cmdlog").hide()},complete:function(){$("#"+e.pre+"wait")&&$("#"+e.pre+"wait").hide(),$("#"+e.pre+"canvas")&&$("#"+e.pre+"canvas").show(),$("#"+e.pre+"cmdlog")&&$("#"+e.pre+"cmdlog").show()},success:function(t){e.init(),e.icn3d.init(),e.bInputfile=!0,e.InputfileData=t,e.InputfileType="mmcif",e.loadMmcifData(t)},error:function(e,t,i){if(this.tryCount++,this.tryCount<=this.retryLimit)return void $.ajax(this)}})},n.readAsText(i)}else alert("Please select a file before clicking 'Load'")})},clickApplycustomcolor:function(){var e=this;$("#"+e.pre+"applycustomcolor").click(function(t){t.preventDefault(),dialog.dialog("close"),e.setOption("color",$("#"+e.pre+"colorcustom").val()),e.setLogCmd("color "+$("#"+e.pre+"colorcustom").val(),!0)})},clickApplypick_aroundsphere:function(){var e=this;$("#"+e.pre+"applypick_aroundsphere").click(function(t){t.preventDefault(),dialog.dialog("close");var i=parseFloat($("#"+e.pre+"radius_aroundsphere").val()),n="select zone cutoff "+i;e.pickCustomSphere(i),e.updateHlAll(),e.setLogCmd(n,!0)})},clickApplyhbonds:function(){var e=this;$("#"+e.pre+"applyhbonds").click(function(t){t.preventDefault(),dialog.dialog("close");var i=parseFloat($("#"+e.pre+"hbondthreshold").val()),n="hbonds "+i;e.showHbonds(i),e.setLogCmd(n,!0)})},clickApplypick_labels:function(){var e=this;$("#"+e.pre+"applypick_labels").click(function(t){t.preventDefault(),dialog.dialog("close");var i=$("#"+e.pre+"labeltext").val(),n=$("#"+e.pre+"labelsize").val(),o=$("#"+e.pre+"labelcolor").val(),r=$("#"+e.pre+"labelbkgd").val();if("0"!==n&&""!==n&&"undefined"!==n||(n=0),"0"!==o&&""!==o&&"undefined"!==o||(o=0),"0"!==r&&""!==r&&"undefined"!==r||(r=0),void 0===e.icn3d.pAtom||void 0===e.icn3d.pAtom2)alert("Please pick another atom");else{var s=(e.icn3d.pAtom.coord.x+e.icn3d.pAtom2.coord.x)/2,a=(e.icn3d.pAtom.coord.y+e.icn3d.pAtom2.coord.y)/2,c=(e.icn3d.pAtom.coord.z+e.icn3d.pAtom2.coord.z)/2;e.addLabel(i,s,a,c,n,o,r,"custom"),e.icn3d.pickpair=!1;var d="",l="",p="";0!=n&&(d=" | size "+n),0!=o&&(l=" | color "+o),0!=r&&(p=" | background "+r),e.setLogCmd("add label "+i+" | x "+s.toPrecision(4)+" y "+a.toPrecision(4)+" z "+c.toPrecision(4)+d+l+p+" | type custom",!0),e.icn3d.draw()}})},clickApplyselection_labels:function(){var e=this;$("#"+e.pre+"applyselection_labels").click(function(t){t.preventDefault(),dialog.dialog("close");var i=$("#"+e.pre+"labeltext2").val(),n=$("#"+e.pre+"labelsize2").val(),o=$("#"+e.pre+"labelcolor2").val(),r=$("#"+e.pre+"labelbkgd2").val();"0"!==n&&""!==n&&"undefined"!==n||(n=0),"0"!==o&&""!==o&&"undefined"!==o||(o=0),"0"!==r&&""!==r&&"undefined"!==r||(r=0);var s=e.icn3d.centerAtoms(e.icn3d.hash2Atoms(e.icn3d.hAtoms)),a=s.center.x,c=s.center.y,d=s.center.z;e.addLabel(i,a,c,d,n,o,r,"custom");var l="",p="",h="";0!=n&&(l=" | size "+n),0!=o&&(p=" | color "+o),0!=r&&(h=" | background "+r),e.setLogCmd("add label "+i+" | x "+a.toPrecision(4)+" y "+c.toPrecision(4)+" z "+d.toPrecision(4)+l+p+h+" | type custom",!0),e.icn3d.draw()})},clickApplypick_stabilizer:function(){var e=this;$("#"+e.pre+"applypick_stabilizer").click(function(t){t.preventDefault(),dialog.dialog("close"),void 0===e.icn3d.pAtom||void 0===e.icn3d.pAtom2?alert("Please pick another atom"):(e.icn3d.pickpair=!1,e.setLogCmd("add one stabilizer | "+e.icn3d.pAtom.serial+" "+e.icn3d.pAtom2.serial,!0),void 0===e.icn3d.pairArray&&(e.icn3d.pairArray=[]),e.icn3d.pairArray.push(e.icn3d.pAtom.serial),e.icn3d.pairArray.push(e.icn3d.pAtom2.serial),e.setThichknessFor3Dprint(),e.icn3d.draw())})},pickColor:function(){var e=this,t=new CP(document.querySelector("#"+e.pre+"colorcustom"));t.on("change",function(e){this.target.value=e}),$("#"+e.pre+"colorcustom").on("input keyup paste cut",function(){var i=$("#"+e.pre+"colorcustom").val();t.set("#"+i).enter()})},clickApplypick_stabilizer_rm:function(){var e=this;$("#"+e.pre+"applypick_stabilizer_rm").click(function(t){if(t.preventDefault(),dialog.dialog("close"),void 0===e.icn3d.pAtom||void 0===e.icn3d.pAtom2)alert("Please pick another atom");else{e.icn3d.pickpair=!1,e.setLogCmd("remove one stabilizer | "+e.icn3d.pAtom.serial+" "+e.icn3d.pAtom2.serial,!0);var i=[];i.push(e.icn3d.pAtom.serial),i.push(e.icn3d.pAtom2.serial),e.removeOneStabilizer(i),e.icn3d.draw()}})},clickApplypick_measuredistance:function(){var e=this;$("#"+e.pre+"applypick_measuredistance").click(function(t){if(t.preventDefault(),dialog.dialog("close"),e.bMeasureDistance=!1,void 0===e.icn3d.pAtom||void 0===e.icn3d.pAtom2)alert("Please pick another atom");else{var i,n=0,o=0,i=$("#"+e.pre+"linecolor").val(),r=(e.icn3d.pAtom.coord.x+e.icn3d.pAtom2.coord.x)/2,s=(e.icn3d.pAtom.coord.y+e.icn3d.pAtom2.coord.y)/2,a=(e.icn3d.pAtom.coord.z+e.icn3d.pAtom2.coord.z)/2;e.addLineFromPicking("distance");var c=parseInt(10*e.icn3d.pAtom.coord.distanceTo(e.icn3d.pAtom2.coord))/10,d=c.toString()+" A";e.addLabel(d,r,s,a,n,i,o,"distance");var l="",p="",h="";0!=n&&(l=" | size "+n),0!=i&&(p=" | color "+i),0!=o&&(h=" | background "+o),e.setLogCmd("add label "+d+" | x "+r.toPrecision(4)+" y "+s.toPrecision(4)+" z "+a.toPrecision(4)+l+p+h+" | type distance",!0),e.icn3d.draw(),e.icn3d.pk=2}})},clickApply_thickness:function(){var e=this;$("#"+e.pre+"apply_thickness_3dprint").click(function(t){t.preventDefault(),e.bSetThickness=!0,e.icn3d.lineRadius=parseFloat($("#"+e.pre+"linerad_3dprint").val()),e.icn3d.coilWidth=parseFloat($("#"+e.pre+"coilrad_3dprint").val()),e.icn3d.cylinderRadius=parseFloat($("#"+e.pre+"stickrad_3dprint").val()),e.icn3d.traceRadius=parseFloat($("#"+e.pre+"stickrad_3dprint").val()),e.icn3d.dotSphereScale=parseFloat($("#"+e.pre+"ballscale_3dprint").val()),e.icn3d.ribbonthickness=parseFloat($("#"+e.pre+"ribbonthick_3dprint").val()),e.icn3d.helixSheetWidth=parseFloat($("#"+e.pre+"prtribbonwidth_3dprint").val()),e.icn3d.nucleicAcidWidth=parseFloat($("#"+e.pre+"nucleotideribbonwidth_3dprint").val()),e.setLogCmd("set thickness | linerad "+e.icn3d.lineRadius+" | coilrad "+e.icn3d.coilWidth+" | stickrad "+e.icn3d.cylinderRadius+" | tracerad "+e.icn3d.traceRadius+" | ribbonthick "+e.icn3d.ribbonthickness+" | proteinwidth "+e.icn3d.helixSheetWidth+" | nucleotidewidth "+e.icn3d.nucleicAcidWidth+" | ballscale "+e.icn3d.dotSphereScale,!0),e.icn3d.draw()}),$("#"+e.pre+"apply_thickness_style").click(function(t){t.preventDefault(),e.bSetThickness=!0,e.icn3d.lineRadius=parseFloat($("#"+e.pre+"linerad_style").val()),e.icn3d.coilWidth=parseFloat($("#"+e.pre+"coilrad_style").val()),e.icn3d.cylinderRadius=parseFloat($("#"+e.pre+"stickrad_style").val()),e.icn3d.traceRadius=parseFloat($("#"+e.pre+"stickrad_style").val()),e.icn3d.dotSphereScale=parseFloat($("#"+e.pre+"ballscale_style").val()),e.icn3d.ribbonthickness=parseFloat($("#"+e.pre+"ribbonthick_style").val()),e.icn3d.helixSheetWidth=parseFloat($("#"+e.pre+"prtribbonwidth_style").val()),e.icn3d.nucleicAcidWidth=parseFloat($("#"+e.pre+"nucleotideribbonwidth_style").val()),e.setLogCmd("set thickness | linerad "+e.icn3d.lineRadius+" | coilrad "+e.icn3d.coilWidth+" | stickrad "+e.icn3d.cylinderRadius+" | tracerad "+e.icn3d.traceRadius+" | ribbonthick "+e.icn3d.ribbonthickness+" | proteinwidth "+e.icn3d.helixSheetWidth+" | nucleotidewidth "+e.icn3d.nucleicAcidWidth+" | ballscale "+e.icn3d.dotSphereScale,!0),e.icn3d.draw()})},clickReset:function(){var e=this;$("#"+e.pre+"reset").click(function(t){e.icn3d.maxD=e.icn3d.oriMaxD,e.icn3d.center=e.icn3d.oriCenter.clone(),e.icn3d.reinitAfterLoad(),e.renderFinalStep(1),e.setMode("all"),e.setLogCmd("reset",!0),e.removeSeqChainBkgd(),e.removeSeqResidueBkgd(),e.removeHl2D(),e.removeHlMenus()})},clickToggleHighlight:function(){var e=this;$("#"+e.pre+"toggleHighlight").add("#"+e.pre+"toggleHighlight2").click(function(t){t.stopImmediatePropagation(),e.toggleHighlight()}),$(document).on("click","#"+e.pre+"seq_clearselection",function(t){t.stopImmediatePropagation(),dialog.dialog("close"),e.clearHighlight()}),$(document).on("click","#"+e.pre+"seq_clearselection2",function(t){t.stopImmediatePropagation(),t.preventDefault(),e.clearHighlight(),e.setLogCmd("clear selection",!0)}),$(document).on("click","#"+e.pre+"alignseq_clearselection",function(t){t.stopImmediatePropagation(),e.clearHighlight(),e.setLogCmd("clear selection",!0)})},pressCommandtext:function(){var e=this;$("#"+e.pre+"logtext").keypress(function(t){e.bAddLogs=!1;var i=t.keyCode?t.keyCode:t.which;if(13==i){t.preventDefault();var n=$(this).val();e.icn3d.bRender=!0;var o=n.split("\n"),r=o[o.length-1].substr(2).trim();if(e.icn3d.logs.push(r),$("#"+e.pre+"logtext").val("> "+e.icn3d.logs.join("\n> ")+"\n> ").scrollTop($("#"+e.pre+"logtext")[0].scrollHeight),""!==r){var s={};s.factor=e.icn3d._zoomFactor,s.mouseChange=e.icn3d.mouseChange,s.quaternion=e.icn3d.quaternion,e.icn3d.commands.push(r+"|||"+e.getTransformationStr(s)),e.icn3d.optsHistory.push(e.icn3d.cloneHash(e.icn3d.opts)),e.icn3d.optsHistory[e.icn3d.optsHistory.length-1].hlatomcount=Object.keys(e.icn3d.hAtoms).length,e.isSessionStorageSupported()&&e.saveCommandsToSession(),e.STATENUMBER=e.icn3d.commands.length,r.indexOf("load")!==-1?e.applyCommandLoad(r):r.indexOf("set map")!==-1&&r.indexOf("set map wireframe")===-1?e.applyCommandMap(r):0==r.indexOf("view annotations")?e.applyCommandAnnotationsAndCddSite(r):0==r.indexOf("set annotation clinvar")||0==r.indexOf("set annotation snp")?e.applyCommandSnpClinvar(r):0==r.indexOf("set annotation 3ddomain")?e.applyCommand3ddomain(r):0==r.indexOf("set annotation all")?($.when(e.applyCommandSnpClinvar(r)).then(e.applyCommandSnpClinvar(r)),e.setAnnoTabAll()):e.applyCommand(r+"|||"+e.getTransformationStr(s)),e.saveSelectionIfSelected(),e.icn3d.draw()}}e.bAddLogs=!0})},clickSeqSaveSelection:function(){var e=this;$(document).on("click","#"+e.pre+"seq_saveselection",function(t){t.stopImmediatePropagation(),dialog.dialog("close"),$("#"+e.pre+"dl_definedsets").hasClass("ui-dialog-content")&&$("#"+e.pre+"dl_definedsets").dialog("isOpen")||e.openDialog(e.pre+"dl_definedsets","Select sets"),e.bSelectResidue=!1;var i=$("#"+e.pre+"seq_command_name").val().replace(/\s+/g,"_");e.saveSelection(i,i)}),$(document).on("click","#"+e.pre+"seq_saveselection2",function(t){t.stopImmediatePropagation(),$("#"+e.pre+"dl_definedsets").hasClass("ui-dialog-content")&&$("#"+e.pre+"dl_definedsets").dialog("isOpen")||e.openDialog(e.pre+"dl_definedsets","Select sets"),e.bSelectResidue=!1;var i=$("#"+e.pre+"seq_command_name2").val().replace(/\s+/g,"_");e.saveSelection(i,i)})},clickAlignSeqSaveSelection:function(){var e=this;$(document).on("click","#"+e.pre+"alignseq_saveselection",function(t){t.stopImmediatePropagation(),$("#"+e.pre+"dl_definedsets").hasClass("ui-dialog-content")&&$("#"+e.pre+"dl_definedsets").dialog("isOpen")||e.openDialog(e.pre+"dl_definedsets","Select sets"),e.bSelectAlignResidue=!1;var i=$("#"+e.pre+"alignseq_command_name").val().replace(/\s+/g,"_");e.saveSelection(i,i)})},clickOutputSelection:function(){var e=this;$(document).on("click","."+e.pre+"outputselection",function(t){t.stopImmediatePropagation(),e.bSelectResidue=!1,e.bSelectAlignResidue=!1,e.setLogCmd("output selection",!0),e.outputSelection()})},bindMouseup:function(){var e=this;$("accordion").bind("mouseup touchend",function(t){e.icn3d.controls&&(e.icn3d.controls.noRotate=!1,e.icn3d.controls.noZoom=!1,e.icn3d.controls.noPan=!1)})},bindMousedown:function(){var e=this;$("accordion").bind("mousedown touchstart",function(t){e.icn3d.controls&&(e.icn3d.controls.noRotate=!0,e.icn3d.controls.noZoom=!0,e.icn3d.controls.noPan=!0)})},expandShrink:function(){$(document).on("click",".icn3d-expand",function(e){e.stopImmediatePropagation();var t=$(this).attr("id"),i=t.lastIndexOf("_"),n=t.substr(0,i);$("#"+n).show(),$("#"+n+"_expand").hide(),$("#"+n+"_shrink").show()}),$(document).on("click",".icn3d-shrink",function(e){e.stopImmediatePropagation();var t=$(this).attr("id"),i=t.lastIndexOf("_"),n=t.substr(0,i);$("#"+n).hide(),$("#"+n+"_expand").show(),$("#"+n+"_shrink").hide()})},scrollAnno:function(){var e=this;window.onscroll=function(t){"detailed view"==e.view&&0==$(window).scrollTop()&&0==$(window).scrollTop()&&0==$("#"+e.pre+"dl_selectannotations").scrollTop()?e.showFixedTitle():e.hideFixedTitle()},$("#"+e.pre+"dl_selectannotations").scroll(function(){"detailed view"==e.view&&0==$(window).scrollTop()&&0==$(window).scrollTop()&&0==$("#"+e.pre+"dl_selectannotations").scrollTop()?e.showFixedTitle():e.hideFixedTitle()})},allEventFunctions:function(){var e=this;e.clickModeswitch(),e.clickViewswitch(),e.isMobile()?(e.selectSequenceMobile(),e.selectChainMobile()):e.selectSequenceNonMobile(),e.clickBack(),e.clickForward(),e.clickToggle(),e.clickHlColorYellow(),e.clickHlColorGreen(),e.clickHlColorRed(),e.clickHlStyleOutline(),e.clickHlStyleObject(),e.clickHlStyleNone(),e.clickAlternate(),e.clkMn1_mmtfid(),e.clkMn1_pdbid(),e.clkMn1_align(),e.clkMn1_pdbfile(),e.clkMn1_mol2file(),e.clkMn1_sdffile(),e.clkMn1_xyzfile(),e.clkMn1_urlfile(),e.clkMn1_mmciffile(),e.clkMn1_mmcifid(),e.clkMn1_mmdbid(),e.clkMn1_blast_rep_id(),e.clkMn1_gi(),e.clkMn1_cid(),e.clkMn1_pngimage(),e.clkMn1_state(),e.clkMn1_selection(),e.clkMn1_exportState(),e.clkMn1_exportStl(),e.clkMn1_exportVrml(),e.clkMn1_exportStlStab(),e.clkMn1_exportVrmlStab(),e.clkMn6_exportInteraction(),e.clkMn1_exportCanvas(),e.clkMn1_exportCounts(),e.clkMn1_exportSelections(),e.clkMn1_sharelink(),e.clkMn1_link_structure(),e.clkMn1_link_bind(),e.clkMn1_link_vast(),e.clkMn1_link_pubmed(),e.clkMn1_link_protein(),e.clkMn2_selectannotations(),e.clkMn2_selectcomplement(),e.clkMn2_selectsidechains(),e.clkMn2_selectall(),e.clkMn2_alignment(),e.clkMn2_command(),e.clkMn2_definedsets(),e.clkMn2_pkYes(),e.clkMn2_pkNo(),e.clkMn2_pkResidue(),e.clkMn2_pkStrand(),e.clkMn2_pkChain(),e.clkMn2_aroundsphere(),e.clkMn2_select_chain(),e.clkMn3_proteinsRibbon(),e.clkMn3_proteinsStrand(),e.clkMn3_proteinsCylinder(),e.clkMn3_proteinsSchematic(),e.clkMn3_proteinsCalpha(),e.clkMn3_proteinsBfactor(),e.clkMn3_proteinsLines(),e.clkMn3_proteinsStick(),e.clkMn3_proteinsBallstick(),e.clkMn3_proteinsSphere(),e.clkMn3_proteinsNo(),e.clkMn3_sidecLines(),e.clkMn3_sidecStick(),e.clkMn3_sidecBallstick(),e.clkMn3_sidecSphere(),e.clkMn3_sidecNo(),e.clkMn3_nuclCartoon(),e.clkMn3_nuclSchematic(),e.clkMn3_nuclPhos(),e.clkMn3_nuclLines(),e.clkMn3_nuclStick(),e.clkMn3_nuclBallstick(),e.clkMn3_nuclSphere(),e.clkMn3_nuclNo(),e.clkMn3_ligLines(),e.clkMn3_ligStick(),e.clkMn3_ligBallstick(),e.clkMn3_ligSchematic(),e.clkMn3_ligSphere(),e.clkMn3_ligNo(),e.clkMn3_ionsSphere(),e.clkMn3_ionsDot(),e.clkMn3_ionsNo(),e.clkMn3_waterSphere(),e.clkMn3_waterDot(),e.clkMn3_waterNo(),e.clkMn4_clrSpectrum(),e.clkMn4_clrChain(),e.clkMn4_clrSSGreen(),e.clkMn4_clrSSYellow(),e.clkMn4_clrResidue(),e.clkMn4_clrCharge(),e.clkMn4_clrHydrophobic(),e.clkMn4_clrAtom(),e.clkMn4_clrBfactor(),e.clkMn4_clrBfactorNorm(),e.clkMn4_clrConserved(),e.clkMn4_clrIdentity(),e.clkMn4_clrRed(),e.clkMn4_clrGreen(),e.clkMn4_clrBlue(),e.clkMn4_clrMagenta(),e.clkMn4_clrYellow(),e.clkMn4_clrCyan(),e.clkMn4_clrWhite(),e.clkMn4_clrGrey(),e.clkMn4_clrCustom(),e.clkMn4_clrSave(),e.clkMn4_clrApplySave(),e.clkMn3_styleSave(),e.clkMn3_styleApplySave(),e.clkMn5_neighborsYes(),e.clkMn5_neighborsNo(),e.clkMn5_surfaceVDW(),e.clkMn5_surfaceSAS(),e.clkMn5_surfaceMolecular(),e.clkMn5_surfaceVDWContext(),e.clkMn5_surfaceSASContext(),e.clkMn5_surfaceMolecularContext(),e.clkMn5_surfaceNo(),e.clkMn5_opacity10(),e.clkMn5_opacity09(),e.clkMn5_opacity08(),e.clkMn5_opacity07(),e.clkMn5_opacity06(),e.clkMn5_opacity05(),e.clkMn5_opacity04(),e.clkMn5_opacity03(),e.clkMn5_opacity02(),e.clkMn5_opacity01(),e.clkMn5_wireframeYes(),e.clkMn5_wireframeNo(),e.clkMn5_elecmap2fofc(),e.clkMn5_elecmapfofc(),e.clkMn5_elecmapNo(),e.clkMn5_mapwireframeYes(),e.clkMn5_mapwireframeNo(),e.clkMn5_emmap(),e.clkMn5_emmapNo(),e.clickApplyemmap(),e.clkMn5_emmapwireframeYes(),e.clkMn5_emmapwireframeNo(),e.clkMn6_assemblyYes(),e.clkMn6_assemblyNo(),e.clkMn6_addlabelResidues(),e.clkMn6_addlabelChains(),e.clkMn6_addlabelTermini(),e.clkMn6_addlabelYes(),e.clkMn6_addlabelSelection(),e.clkMn2_saveselection(),e.clkMn6_addlabelNo(),e.clkMn6_distanceYes(),e.clkmn1_stabilizerOne(),e.clkmn1_stabilizerRmOne(),e.clkmn1_thicknessSet(),e.clkmn5_setThickness(),e.clkmn1_thicknessReset(),e.clkMn6_distanceNo(),e.clkMn2_selectedcenter(),e.clkMn6_center(),e.clkMn6_resetOrientation(),e.clkMn6_chemicalbindingshow(),e.clkMn6_chemicalbindinghide(),e.clkMn6_rotateleft(),e.clkMn6_rotateright(),e.clkMn6_rotateup(),e.clkMn6_rotatedown(),e.clkMn6_cameraPers(),e.clkMn6_cameraOrth(),e.clkMn6_bkgdBlack(),e.clkMn6_bkgdGrey(),e.clkMn6_bkgdWhite(),e.clkMn6_bkgdTransparent(),e.clkMn6_showfogYes(),e.clkMn6_showfogNo(),e.clkMn6_showslabYes(),e.clkMn6_showslabNo(),e.clkMn6_showaxisYes(),e.clkMn6_showaxisNo(),e.clkMn6_hbondsYes(),e.clkMn6_hbondsNo(),e.clkmn1_stabilizerYes(),e.clkmn1_stabilizerNo(),e.clkMn6_ssbondsYes(),e.clkMn6_ssbondsNo(),e.clkMn6_clbondsYes(),e.clkMn6_clbondsNo(),e.clickCustomAtoms(),e.clickShow_selected(),e.clickShow_annotations(),e.clickShowallchains(),e.clickShow_alignsequences(),e.clickShow_2ddgm(),e.clickCommand_apply(),e.clickSearchSeq(),e.clickReload_pdb(),e.clickReload_align_refined(),e.clickReload_align_ori(),e.clickReload_mmtf(),e.clickReload_pdbfile(),e.clickReload_mol2file(),e.clickReload_sdffile(),e.clickReload_xyzfile(),e.clickReload_urlfile(),e.clickReload_mmciffile(),e.clickReload_mmcif(),e.clickReload_mmdb(),e.clickReload_blast_rep_id(),e.clickReload_gi(),e.clickReload_cid(),e.clickReload_pngimage(),e.clickReload_state(),e.clickReload_selectionfile(),e.clickApplycustomcolor(),e.clickApplypick_aroundsphere(),e.clickApplyhbonds(),e.clickApplymap2fofc(),e.clickApplymapfofc(),e.clickApplypick_labels(),e.clickApplyselection_labels(),e.clickApplypick_measuredistance(),e.clickApplypick_stabilizer(),e.clickApplypick_stabilizer_rm(),e.pickColor(),e.clickApply_thickness(),e.clickReset(),e.clickToggleHighlight(),
e.pressCommandtext(),e.clickSeqSaveSelection(),e.clickAlignSeqSaveSelection(),e.clickOutputSelection(),e.click2Ddgm(),e.bindMouseup(),e.bindMousedown(),e.windowResize(),e.setTabs(),e.clickAddTrack(),e.clickDefineHelix(),e.clickDefineSheet(),e.clickDefineCoil(),e.clickDeleteSets(),e.clickAddTrackButton(),e.expandShrink(),e.scrollAnno(),e.switchHighlightLevel()}},"undefined"==typeof jQuery)throw new Error("iCn3DUI requires jQuery");if("undefined"==typeof iCn3D)throw new Error("iCn3DUI requires iCn3D");iCn3DUI.prototype.rotStruc=function(e,t){var i=this;if(i.icn3d.bStopRotate)return!1;if(i.icn3d.rotateCount>i.icn3d.rotateCountMax)return i.icn3d.resetOrientation(),!1;if(++i.icn3d.rotateCount,void 0!==t&&t)if("left"===e)i.ROT_DIR="left";else if("right"===e)i.ROT_DIR="right";else if("up"===e)i.ROT_DIR="up";else{if("down"!==e)return!1;i.ROT_DIR="down"}if("left"===e&&"left"===i.ROT_DIR)i.icn3d.rotateLeft(1);else if("right"===e&&"right"===i.ROT_DIR)i.icn3d.rotateRight(1);else if("up"===e&&"up"===i.ROT_DIR)i.icn3d.rotateUp(1);else{if("down"!==e||"down"!==i.ROT_DIR)return!1;i.icn3d.rotateDown(1)}setTimeout(function(){i.rotStruc(e)},100)},iCn3DUI.prototype.showTitle=function(){var e=this;if(void 0!==e.icn3d.molTitle&&""!==e.icn3d.molTitle){var t=e.icn3d.molTitle;if(void 0===e.inputid)e.icn3d.molTitle.length>40&&(t=e.icn3d.molTitle.substr(0,40)+"..."),$("#"+e.pre+"title").html(t);else if(void 0!==e.cfg.cid){var i=e.getLinkToStructureSummary();$("#"+e.pre+"title").html("PubChem CID <a href='"+i+"' target='_blank' style='color:"+e.GREYD+"'>"+e.inputid.toUpperCase()+"</a>: "+t)}else if(void 0!==e.cfg.align)$("#"+e.pre+"title").html(t);else{var i=e.getLinkToStructureSummary();e.icn3d.molTitle.length>40&&(t=e.icn3d.molTitle.substr(0,40)+"...");var n="";$("#"+e.pre+"title").html("PDB ID <a href='"+i+"' target='_blank' style='color:"+e.GREYD+"'>"+e.inputid.toUpperCase()+"</a>"+n+": "+t)}}else $("#"+e.pre+"title").html("")},iCn3DUI.prototype.getLinkToStructureSummary=function(e){var t=this,i="https://www.ncbi.nlm.nih.gov/structure/?term=";if(i=void 0!==t.cfg.cid?"https://www.ncbi.nlm.nih.gov/pccompound/?term=":t.inputid.indexOf(",")!==-1?"https://www.ncbi.nlm.nih.gov/structure/?term=":"https://www.ncbi.nlm.nih.gov/Structure/pdb/",void 0===t.inputid)i="https://www.ncbi.nlm.nih.gov/pccompound/?term="+t.molTitle;else{var n=t.inputid.split("_");1===n.length?(i+=t.inputid,void 0!==e&&e&&t.setLogCmd("link to Structure Summary "+t.inputid+": "+i,!1)):2===n.length&&(i+=n[0]+" OR "+n[1],void 0!==e&&e&&t.setLogCmd("link to structures "+n[0]+" and "+n[1]+": "+i,!1))}return i},iCn3DUI.prototype.isIE=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");return!!(t>0||navigator.userAgent.match(/Trident.*rv\:11\./))},iCn3DUI.prototype.passFloat32=function(e,t){var i=this,n=e.length;t||(t=new Uint8Array(4*n));for(var o=i.getDataView(t),r=0;r<n;++r)o.setFloat32(4*r,e[r],!0);return i.getUint8View(t)},iCn3DUI.prototype.passInt8=function(e,t){var i=this,n=e.length;t||(t=new Uint8Array(1*n));for(var o=i.getDataView(t),r=0;r<n;++r)o.setInt8(1*r,e[r],!0);return i.getUint8View(t)},iCn3DUI.prototype.passInt16=function(e,t){var i=this,n=e.length;t||(t=new Uint8Array(2*n));for(var o=i.getDataView(t),r=0;r<n;++r)o.setInt16(2*r,e[r],!0);return i.getUint8View(t)},iCn3DUI.prototype.passInt32=function(e,t){var i=this,n=e.length;t||(t=new Uint8Array(4*n));for(var o=i.getDataView(t),r=0;r<n;++r)o.setInt32(4*r,e[r],!0);return i.getUint8View(t)},iCn3DUI.prototype.getUint8View=function(e){var t=this;return t.getView(Uint8Array,e)},iCn3DUI.prototype.getDataView=function(e){var t=this;return t.getView(DataView,e)},iCn3DUI.prototype.getView=function(e,t,i){return t?new e(t.buffer,t.byteOffset,t.byteLength/(i||1)):void 0},iCn3DUI.prototype.getBlobFromBufferAndText=function(e,t){for(var i=this,n=new Uint8Array(e),o=new Uint8Array(t.length),r=0;r<t.length;++r)o[r]=i.passInt8([t.charCodeAt(r)])[0];var s=[];s.push(new Blob([n],{type:"application/octet-stream"})),s.push(new Blob([o],{type:"application/octet-stream"}));var a=new Blob(s,{type:"image/png"});return a},iCn3DUI.prototype.getTransformationStr=function(e){var t={factor:1,mouseChange:{x:0,y:0},quaternion:{_x:0,_y:0,_z:0,_w:1}};return t.factor=parseFloat(e.factor).toPrecision(5),t.mouseChange.x=parseFloat(e.mouseChange.x).toPrecision(5),t.mouseChange.y=parseFloat(e.mouseChange.y).toPrecision(5),t.quaternion._x=parseFloat(e.quaternion._x).toPrecision(5),t.quaternion._y=parseFloat(e.quaternion._y).toPrecision(5),t.quaternion._z=parseFloat(e.quaternion._z).toPrecision(5),t.quaternion._w=parseFloat(e.quaternion._w).toPrecision(5),"1.0000"==t.factor&&(t.factor=1),"0.0000"==t.mouseChange.x&&(t.mouseChange.x=0),"0.0000"==t.mouseChange.y&&(t.mouseChange.y=0),"0.0000"==t.quaternion._x&&(t.quaternion._x=0),"0.0000"==t.quaternion._y&&(t.quaternion._y=0),"0.0000"==t.quaternion._z&&(t.quaternion._z=0),"1.0000"==t.quaternion._w&&(t.quaternion._w=1),JSON.stringify(t)},iCn3DUI.prototype.saveFile=function(e,t,i){var n,o=this;if("command"===t){for(var r="",s=0,a=o.icn3d.commands.length;s<a;++s){var c=o.icn3d.commands[s].trim();if(s==a-1){var d=c.split("|||"),l={};l.factor=o.icn3d._zoomFactor,l.mouseChange=o.icn3d.mouseChange,l.quaternion=o.icn3d.quaternion,c=d[0]+"|||"+o.getTransformationStr(l)}r+=c+"\n"}var p=decodeURIComponent(r);n=new Blob([p],{type:"text;charset=utf-8;"})}else if("png"===t){o.icn3d.render();var h=!0;if(window.File&&window.FileReader&&window.FileList&&window.Blob||(h=!1),o.isIE()){if(n=o.icn3d.renderer.domElement.msToBlob(),h){var u=new FileReader;u.onload=function(t){var i=t.target.result,r=o.shareLinkUrl(),s="";o.bInputfile?(s+="\nStart of type file======\n",s+=o.InputfileType+"\n",s+="End of type file======\n",s+="Start of data file======\n",s+=o.InputfileData,s+="End of data file======\n",s+="Start of state file======\n",s+=r,s+="End of state file======\n"):s+="\nShare Link: "+r,n=o.getBlobFromBufferAndText(i,s),saveAs(n,e)},u.readAsArrayBuffer(n)}}else o.icn3d.renderer.domElement.toBlob(function(t){if(!h)return n=t,void saveAs(n,e);var i=new FileReader;i.onload=function(t){var i=t.target.result,r=o.shareLinkUrl(),s="";o.bInputfile?(s+="\nStart of type file======\n",s+=o.InputfileType+"\n",s+="End of type file======\n",s+="Start of data file======\n",s+=o.InputfileData,s+="End of data file======\n",s+="Start of state file======\n",s+=r,s+="End of state file======\n"):s+="\nShare Link: "+r,n=o.getBlobFromBufferAndText(i,s),saveAs(n,e)},i.readAsArrayBuffer(t)})}else if("html"===t){var r=i,p=decodeURIComponent(r);n=new Blob([p],{type:"text/html;charset=utf-8;"})}else if("text"===t){var p=i;n=new Blob(p,{type:"text;charset=utf-8;"})}else if("binary"===t){var p=i;n=new Blob(p,{type:"application/octet-stream"})}"png"!==t&&saveAs(n,e)},iCn3DUI.prototype.isMobile=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},iCn3DUI.prototype.isMac=function(){return/Mac/i.test(navigator.userAgent)},iCn3DUI.prototype.isSessionStorageSupported=function(){var e="test";try{return sessionStorage.setItem(e,"1"),sessionStorage.removeItem(e),!0}catch(t){return!1}},iCn3DUI.prototype.resizeCanvas=function(e,t,i,n){var o=this;if(void 0!==i&&i||void 0!==o.cfg.resize&&o.cfg.resize){var r=t;$("#"+o.pre+"canvas").width(e).height(r),$("#"+o.pre+"viewer").width(e).height(t),o.icn3d.setWidthHeight(e,r),(void 0===n||n)&&o.icn3d.draw()}},iCn3DUI.prototype.handleContextLost=function(){var e=this,t=$("#"+e.pre+"canvas")[0];t.addEventListener("webglcontextlost",function(e){e.preventDefault()},!1),t.addEventListener("webglcontextrestored",function(t){console.log("WebGL context was lost. Reset WebGLRenderer and launch iCn3D again."),e.icn3d.renderer=new THREE.WebGLRenderer({canvas:e.icn3d.container.get(0),antialias:!0,preserveDrawingBuffer:!0,alpha:!0}),e.icn3d.draw()},!1)},iCn3DUI.prototype.windowResize=function(){var e=this;void 0!==e.cfg.resize&&e.cfg.resize&&!e.isMobile()&&$(window).resize(function(){e.WIDTH=$(window).width(),e.HEIGHT=$(window).height();var t=e.WIDTH-e.LESSWIDTH_RESIZE,i=e.HEIGHT-e.LESSHEIGHT-e.EXTRAHEIGHT;void 0!==e.icn3d&&e.resizeCanvas(t,i)})},iCn3DUI.prototype.setViewerWidthHeight=function(){var e=this;e.WIDTH=$(window).width(),e.HEIGHT=$(window).height();var t=$("#"+e.pre+"viewer").width(),i=$("#"+e.pre+"viewer").height();t&&e.WIDTH>t&&(e.WIDTH=t),i&&e.HEIGHT>i&&(e.HEIGHT=i),e.isMac()&&e.isMobile()&&(e.WIDTH<e.MENU_WIDTH&&(e.WIDTH=e.MENU_WIDTH),e.HEIGHT=$(window).height()/$(window).width()*e.MENU_WIDTH),e.cfg.width.toString().indexOf("%")===-1&&(e.WIDTH=parseInt(e.cfg.width)+e.LESSWIDTH),e.cfg.height.toString().indexOf("%")===-1&&(e.HEIGHT=parseInt(e.cfg.height)+e.EXTRAHEIGHT+e.LESSHEIGHT)},iCn3DUI.prototype.shareLinkUrl=function(){var e=this,t="https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?",i=-1;void 0!==e.cfg.inpara&&(i=e.cfg.inpara.indexOf("&command="));var n=i!==-1?e.cfg.inpara.substr(0,i):e.cfg.inpara,o=0;void 0!==n?(t+=n.substr(1)+"&command=",o=1):(t+="command=",o=0),e.bInputfile&&(o=0);var r={};r.factor=e.icn3d._zoomFactor,r.mouseChange=e.icn3d.mouseChange,r.quaternion=e.icn3d.quaternion;for(var s=!1,a="",c=o,d=e.icn3d.commands.length;c<d;++c){s=!0;var l=e.icn3d.commands[c].split("|||"),p=l[0].trim();c===d-1?(1!==c&&0!==c&&(t+="; "),t+=p+"|||"+e.getTransformationStr(r)):1===c?t+=p:1!==c&&c!==d-1&&(t+="; "+p),a+=e.icn3d.commands[c]+"\n"}return s||(t=t.substr(0,t.length-9)),e.bInputfile&&(t=a),t},iCn3DUI.prototype.addLabel=function(e,t,i,n,o,r,s,a){var c=this,d={};"0"!==o&&""!==o&&"undefined"!==o||(o=void 0),"0"!==r&&""!==r&&"undefined"!==r||(r=void 0),"0"!==s&&""!==s&&"undefined"!==s||(s=void 0);var l=new THREE.Vector3;l.x=t,l.y=i,l.z=n,d.position=l,d.text=e,d.size=o,d.color=r,d.background=s,void 0===c.icn3d.labels[a]&&(c.icn3d.labels[a]=[]),void 0!==a?c.icn3d.labels[a].push(d):c.icn3d.labels.custom.push(d),c.icn3d.removeHlObjects()},iCn3DUI.prototype.showLoading=function(){var e=this;$("#"+e.pre+"wait")&&$("#"+e.pre+"wait").show(),$("#"+e.pre+"canvas")&&$("#"+e.pre+"canvas").hide(),$("#"+e.pre+"cmdlog")&&$("#"+e.pre+"cmdlog").hide()},iCn3DUI.prototype.hideLoading=function(){var e=this;void 0!==e.bCommandLoad&&e.bCommandLoad||($("#"+e.pre+"wait")&&$("#"+e.pre+"wait").hide(),$("#"+e.pre+"canvas")&&$("#"+e.pre+"canvas").show(),$("#"+e.pre+"cmdlog")&&$("#"+e.pre+"cmdlog").show())},iCn3DUI.prototype.downloadMmcif=function(e){var t,i,n=this;t="https://files.rcsb.org/view/"+e+".cif",i="text",n.icn3d.bCid=void 0,$.ajax({url:t,dataType:i,cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){n.showLoading()},complete:function(){n.hideLoading()},success:function(e){t="https://www.ncbi.nlm.nih.gov/Structure/mmcifparser/mmcifparser.cgi",$.ajax({url:t,type:"POST",data:{mmciffile:e},dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){n.showLoading()},complete:function(){n.hideLoading()},success:function(e){n.loadMmcifData(e)},error:function(e,t,i){if(this.tryCount++,this.tryCount<=this.retryLimit)return void $.ajax(this)}})},error:function(e,t,i){if(this.tryCount++,this.tryCount<=this.retryLimit)return void $.ajax(this)}})},iCn3DUI.prototype.downloadMmcifSymmetry=function(e,t){var i=this;return i.deferredSymmetry=$.Deferred(function(){i.downloadMmcifSymmetryBase(e,t)}),i.deferredSymmetry.promise()},iCn3DUI.prototype.downloadMmcifSymmetryBase=function(e,t){var i,n,o=this;i=o.isMac()?"https://files.rcsb.org/view/"+e+".cif":"https://files.rcsb.org/header/"+e+".cif",n="text",o.icn3d.bCid=void 0,$.ajax({url:i,dataType:n,cache:!0,tryCount:0,retryLimit:1,success:function(n){i="https://www.ncbi.nlm.nih.gov/Structure/mmcifparser/mmcifparser.cgi",$.ajax({url:i,type:"POST",data:{mmcifheader:n},dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,success:function(i){if(void 0!==i.emd&&(o.icn3d.emd=i.emd),o.bAssemblyUseAsu&&o.loadMmcifSymmetry(i),"mmtfid"===t&&void 0!==i.missingseq){for(var n=0,r="",s={},a=0,c=i.missingseq.length;a<c;++a){var d=i.missingseq[a].resn,l=i.missingseq[a].chain,p=i.missingseq[a].resi,h=e+"_"+l;void 0===s[h]&&(s[h]=[]);var u={};u.resi=p,u.name=o.icn3d.residueName2Abbr(d).toLowerCase(),l!=r&&(n=0),!isNaN(p)&&(""==r||l!=r||l==r&&p>n)&&(s[h].push(u),n=p,r=l)}o.icn3d.adjustSeq(s)}void 0!==o.deferredSymmetry&&o.deferredSymmetry.resolve()},error:function(e,t,i){return this.tryCount++,this.tryCount<=this.retryLimit?void $.ajax(this):void(void 0!==o.deferredSymmetry&&o.deferredSymmetry.resolve())}})},error:function(e,t,i){if(this.tryCount++,this.tryCount<=this.retryLimit)return void $.ajax(this)}})},iCn3DUI.prototype.loadMmcifData=function(e){var t=this;if(void 0===e.atoms)return alert("invalid atoms data."),!1;t.icn3d.init(),void 0!==e.emd&&(t.icn3d.emd=e.emd),void 0!==t.icn3d.emd?($("#"+t.pre+"mapWrapper1").hide(),$("#"+t.pre+"mapWrapper2").hide(),$("#"+t.pre+"mapWrapper3").hide()):($("#"+t.pre+"emmapWrapper1").hide(),$("#"+t.pre+"emmapWrapper2").hide(),$("#"+t.pre+"emmapWrapper3").hide()),t.loadAtomDataIn(e,e.mmcif,"mmcifid"),void 0===t.cfg.align&&1==Object.keys(t.icn3d.structures).length&&$("#"+t.pre+"alternateWrapper").hide();for(var i=void 0!==e.assembly?e.assembly:[],n=0,o=i.length;n<o;++n){void 0==t.icn3d.biomtMatrices[n]&&(t.icn3d.biomtMatrices[n]=(new THREE.Matrix4).identity());for(var r=0,s=i[n].length;r<s;++r)t.icn3d.biomtMatrices[n].elements[r]=i[n][r]}void 0!==t.icn3d.biomtMatrices&&t.icn3d.biomtMatrices.length>1?($("#"+t.pre+"assemblyWrapper").show(),t.icn3d.asuCnt=t.icn3d.biomtMatrices.length):$("#"+t.pre+"assemblyWrapper").hide(),t.icn3d.setAtomStyleByOptions(t.opts),t.icn3d.setColorByOptions(t.opts,t.icn3d.atoms),t.renderStructure(),void 0!==t.cfg.rotate&&t.rotStruc(t.cfg.rotate,!0),void 0!==t.deferred&&t.deferred.resolve(),void 0!==t.deferred2&&t.deferred2.resolve()},iCn3DUI.prototype.loadMmcifSymmetry=function(e){for(var t=this,i=e.assembly,n=(e.pmatrix,0),o=i.length;n<o;++n){var r=new THREE.Matrix4;r.fromArray(i[n]),t.icn3d.biomtMatrices[n]=r}t.icn3d.asuCnt=t.icn3d.biomtMatrices.length},iCn3DUI.prototype.parseMmdbData=function(e){var t=this;if(void 0===e.atoms&&void 0===e.molid2rescount)return alert("invalid MMDB data."),!1;t.icn3d.init(),t.interactionData={moleculeInfor:e.moleculeInfor,intrac:e.intrac,intracResidues:e.intracResidues},t.mmdb_data=e;var i=void 0!==e.pdbId?e.pdbId:e.mmdbId;t.inputid=i;var n=e.moleculeInfor,o={},r={},s={};t.icn3d.chainsColor={},t.icn3d.chainsGene={};var a="<table width='100%'><tr><td></td><th>#</th><th align='center'>Chain</th><th align='center'>Residue Count</th></tr>",c=1,d={};for(var l in n){var p="#"+("000000"+n[l].color.toString(16)).slice(-6),h=n[l].chain.trim();void 0===d[h]?d[h]=1:++d[h];var u=1===d[h]?h:h+d[h].toString(),m=i+"_"+u;a+="<tr style='color:"+p+"'><td><input type='checkbox' name='"+t.pre+"filter_ckbx' value='"+l+"' chain='"+m+"'/></td><td align='center'>"+c+"</td><td align='center'>"+u+"</td><td align='center'>"+n[l].resCount+"</td></tr>",o[l]=p,r[m]=l,s[l]=m,t.icn3d.chainsColor[m]=new THREE.Color(p),t.icn3d.chainsGene[m]={geneId:n[l].geneId,geneSymbol:n[l].geneSymbol,geneDesc:n[l].geneDesc},++c}void 0!==t.icn3d.chemicals&&Object.keys(t.icn3d.chemicals).length>0&&(a+="<tr><td><input type='checkbox' name='"+t.pre+"filter_ckbx' value='chemicals'/></td><td align='center'>"+c+"</td><td align='center'>Chemicals</td><td align='center'>"+Object.keys(t.icn3d.chemicals).length+" atoms</td></tr>"),a+="</table>",t.icn3d.molid2color=o,t.icn3d.chain2molid=r,t.icn3d.molid2chain=s,$("#"+t.pre+"accordion5").show(),t.loadAtomDataIn(e,i,"mmdbid"),t.bAssemblyUseAsu=void 0!==e.asuAtomCount,$.when(t.downloadMmcifSymmetry(i)).then(function(){t.downloadMmdbPart2()})},iCn3DUI.prototype.downloadMmdb=function(e,t){var i,n=this;i=void 0!==t&&t?"https://www.ncbi.nlm.nih.gov/Structure/mmdb/mmdb_strview.cgi?v=2&program=icn3d&b=1&s=1&ft=1&gi="+e:"https://www.ncbi.nlm.nih.gov/Structure/mmdb/mmdb_strview.cgi?v=2&program=icn3d&b=1&s=1&ft=1&uid="+e,n.icn3d.bCid=void 0,void 0!==n.cfg.inpara&&(i+=n.cfg.inpara),void 0===n.chainids2resids&&(n.chainids2resids={}),$.ajax({url:i,dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){n.showLoading()},complete:function(){n.hideLoading()},success:function(o){var r=n.icn3d.isCalphaPhosOnly(o.atoms);r||o.atomCount<=n.icn3d.maxatomcnt?n.parseMmdbData(o):(o=null,$.ajax({url:i+"&complexity=2",dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){n.showLoading()},complete:function(){n.hideLoading()},success:function(e){n.parseMmdbData(e)},error:function(i,o,r){return this.tryCount++,this.tryCount<=this.retryLimit?void $.ajax(this):void(t?alert("This gi "+e+" has no corresponding 3D structure..."):alert("This mmdbid "+e+" with the parameters "+n.cfg.inpara+" may not have 3D structure data. Please visit the summary page for details: https://www.ncbi.nlm.nih.gov/Structure/pdb/"+e))}}))},error:function(i,o,r){return this.tryCount++,this.tryCount<=this.retryLimit?void $.ajax(this):void(t?alert("This gi "+e+" has no corresponding 3D structure..."):alert("This mmdbid "+e+" with the parameters "+n.cfg.inpara+" may not have 3D structure data. Please visit the summary page for details: https://www.ncbi.nlm.nih.gov/Structure/pdb/"+e))}})},iCn3DUI.prototype.downloadMmdbPart2=function(){var e=this;e.bAssemblyUseAsu?($("#"+e.pre+"assemblyWrapper").show(),e.icn3d.bAssembly=!0):($("#"+e.pre+"assemblyWrapper").hide(),e.icn3d.bAssembly=!1),void 0!==e.icn3d.emd?($("#"+e.pre+"mapWrapper1").hide(),$("#"+e.pre+"mapWrapper2").hide(),$("#"+e.pre+"mapWrapper3").hide()):($("#"+e.pre+"emmapWrapper1").hide(),$("#"+e.pre+"emmapWrapper2").hide(),$("#"+e.pre+"emmapWrapper3").hide()),e.icn3d.setAtomStyleByOptions(e.opts),void 0!==e.cfg.blast_rep_id?e.icn3d.setColorByOptions(e.opts,e.icn3d.atoms):e.icn3d.setColorByOptions(e.opts,e.icn3d.atoms,!0),e.renderStructure(),void 0!==e.cfg.rotate&&e.rotStruc(e.cfg.rotate,!0),e.html2ddgm="",void 0!==e.cfg.show2d&&e.cfg.show2d&&(e.openDialog(e.pre+"dl_2ddgm","Interactions"),e.bFullUi&&e.download2Ddgm(e.inputid.toUpperCase())),void 0===e.cfg.align&&1==Object.keys(e.icn3d.structures).length&&null!==$("#"+e.pre+"alternateWrapper")&&$("#"+e.pre+"alternateWrapper").hide(),void 0!==e.deferred&&e.deferred.resolve(),void 0!==e.deferred2&&e.deferred2.resolve()},iCn3DUI.prototype.downloadGi=function(e){var t=this;t.icn3d.bCid=void 0;var i=!0;t.downloadMmdb(e,i)},iCn3DUI.prototype.downloadBlast_rep_id=function(e){var t=this;t.icn3d.bCid=void 0;var i=e.split(",");t.cfg.query_id=i[0],t.cfg.blast_rep_id=i[1];var n=t.cfg.blast_rep_id.split("_")[0];t.downloadMmdb(n)},iCn3DUI.prototype.getMissingResidues=function(e,t,i){for(var n=this,o=-9999,r=0,s=!0,a=0,c=e.length;a<c;++a){var d,l;"mmdbid"===t?(d=e[a][1],l=0):"mmcifid"===t?(d=e[a][1],d=n.icn3d.residueName2Abbr(d),l=0):"align"===t&&(d=e[a][2],l=1),""===d&&(d="x");var p={};p.resi=a+1;var h=parseInt(e[a][l]),u=a==c-1?9999:parseInt(e[a+1][l]);if(0!==h||0===h&&(o===-1||1==u)){if(p.name=d.toLowerCase(),s&&r>0){void 0===n.countNextresiArray[i]&&(n.countNextresiArray[i]=[]);var m=[r,parseInt(e[a][0])];n.countNextresiArray[i].push(m),r=0}s=!1}else p.name=d.toLowerCase(),++r,s=!0;void 0===n.icn3d.chainsSeq[i]&&(n.icn3d.chainsSeq[i]=[]);var f="";p.resi%10===0&&(f=p.resi.toString()),n.icn3d.chainsSeq[i].push(p),o=h}},iCn3DUI.prototype.loadAtomDataIn=function(e,t,i,n){var o=this,r=new THREE.Vector3(9999,9999,9999),s=new THREE.Vector3((-9999),(-9999),(-9999)),a=new THREE.Vector3,c=e.atoms,d=0,l=0,p={},h={};o.pmid=e.pubmedId;var u={},m={},f={};if(o.chainid2title={},o.chainid2sid={},"align"===i){o.pmid="";var v=o.cfg.inpara.indexOf("atype=1")!==-1?"Invariant Core ":"";o.icn3d.molTitle=v+"Structure Alignment of ";for(var g=0,b=e.alignedStructures[0].length;g<b;++g){var y=e.alignedStructures[0][g];1===g&&(o.icn3d.secondId=y.pdbId);for(var _=y.pdbId,w=y.mmdbId,C=y.serialInterval[0],S=y.serialInterval[1];C<=S;++C)p[C]=_.toString(),h[w]=_;for(var C=0,S=y.molecules.length;C<S;++C){var A=y.molecules[C].chain,k=y.molecules[C].kind,E=y.molecules[C].name,x=y.molecules[C].sequence,R=y.molecules[C].sid,T=_+"_"+A;o.bFullUi&&(u[T]=x),m[T]=k,o.chainid2title[T]=E,void 0!==R&&(o.chainid2sid[T]=R)}o.icn3d.molTitle+='<a href="https://www.ncbi.nlm.nih.gov/Structure/mmdb/mmdbsrv.cgi?uid='+y.pdbId.toUpperCase()+'" target="_blank" style="color: '+o.GREYD+';">'+y.pdbId.toUpperCase()+"</a>",void 0!==y.descr&&(o.pmid+=y.descr.pubmedid),0===g&&(o.icn3d.molTitle+=" and ",void 0!==y.descr&&(o.pmid+="_"))}o.icn3d.molTitle+=" from VAST+"}else if(void 0!==e.descr&&(o.icn3d.molTitle+=e.descr.name),"mmdbid"===i){var _=e.pdbId,H={};for(var D in e.moleculeInfor){var A=e.moleculeInfor[D].chain.trim(),T=_+"_"+A;H.hasOwnProperty(A)?(++H[A],T+=H[A]):H[A]=1;var k=e.moleculeInfor[D].kind,I=e.moleculeInfor[D].color,R=e.moleculeInfor[D].sid;m[T]=k,f[T]=I,void 0!==R&&(o.chainid2sid[T]=R)}}if(o.countNextresiArray={},o.bFullUi)if("mmdbid"===i||"mmcifid"===i)for(var A in e.sequences){var O=e.sequences[A],T=t+"_"+A;o.getMissingResidues(O,i,T)}else if("align"===i)for(var T in u){var O=u[T];o.getMissingResidues(O,i,T)}var D,M={},L="",$="",P="",N="",z="",q="",l=0,F=0,j=!0,U=!1,B="",G="";o.mmdbMolidResid2mmdbChainResi={};var V=o.icn3d.isCalphaPhosOnly(c),W=0;biopolymerChainsHash={};for(var g in c){++d,M[g]=d;var Y=c[g];Y.serial=d;var X;"mmdbid"===i||"mmcifid"===i?X=t:"align"===i&&(X=p[d]);var Z=0;if("mmdbid"===i||"align"===i?(Y.resi_ori=parseInt(Y.resi),Y.resi=Y.ids.r,Z=Y.resi-Y.resi_ori):Y.resi=parseInt(Y.resi),void 0!==Y.chain||"mmdbid"!==i&&"align"!==i)Y.chain=""===Y.chain?"Misc":Y.chain;else if("mmdbid"===i)if(D=Y.ids.m,void 0!==o.icn3d.molid2chain[D]){var K=o.icn3d.molid2chain[D].indexOf("_");Y.chain=o.icn3d.molid2chain[D].substr(K+1)}else{var Q="Misc";++W,"solvent"!==m[z]&&"HOH"!==Y.resn||(Y.resi=W),Y.chain=Q}else if("align"===i)if(D=Y.ids.m,void 0!==o.icn3d.pdbid_molid2chain[X+"_"+D])Y.chain=o.icn3d.pdbid_molid2chain[X+"_"+D];else{var Q="Misc";++W,"solvent"!==m[z]&&"HOH"!==Y.resn||(Y.resi=W),Y.chain=Q}Y.chain=Y.chain.trim(),"mmdbid"!==i&&"align"!==i||(Y.structure=X),N=Y.structure,z=N+"_"+Y.chain,z!==$&&(F=0,l=0),"mmdbid"===i?Y.coord=new THREE.Vector3(Y.coord[0],Y.coord[1],Y.coord[2]):Y.coord=new THREE.Vector3(Y.coord.x,Y.coord.y,Y.coord.z);var J=o.icn3d.residueName2Abbr(Y.resn.substr(0,3));"mmdbid"!==i&&"align"!==i||!o.bFullUi||(o.mmdbMolidResid2mmdbChainResi[X+"_"+Y.ids.m+"_"+Y.ids.r]=X+"_"+Y.chain+"_"+Y.resi),r.min(Y.coord),s.max(Y.coord),a.add(Y.coord);var ee=void 0===o.cfg.mmcifid?"protein"===m[z]:"p"===Y.mt,te=void 0===o.cfg.mmcifid?"nucleotide"===m[z]:"n"===Y.mt,ie=void 0===o.cfg.mmcifid?"solvent"===m[z]:"s"===Y.mt,ne=void 0===o.cfg.mmcifid?"ligand"===m[z]||void 0!==m[z]&&m[z].indexOf("other")!==-1||void 0===m[z]:"l"===Y.mt;"Misc"!==Y.chain&&"other"!==m[z]||"protein"===biopolymerChainsHash[z]||"nucleotide"===biopolymerChainsHash[z]||("CA"===Y.name?biopolymerChainsHash[z]="protein":"P"===Y.name?biopolymerChainsHash[z]="nucleotide":biopolymerChainsHash[z]="chemical"),ee||te?(ee?(o.icn3d.proteins[d]=1,"CA"===Y.name&&(o.icn3d.calphas[d]=1),"N"!==Y.name&&"CA"!==Y.name&&"C"!==Y.name&&"O"!==Y.name&&(o.icn3d.sidec[d]=1)):te&&(o.icn3d.nucleotides[d]=1,("O3'"==Y.name||"O3*"==Y.name||V&&"P"==Y.name)&&(o.icn3d.nucleotidesO3[d]=1)),Y.het=!1):ie?(o.icn3d.water[d]=1,Y.het=!0):ne&&("HOH"===Y.resn||"O"===Y.resn?o.icn3d.water[d]=1:Y.elem===Y.resn?o.icn3d.ions[d]=1:o.icn3d.chemicals[d]=1,Y.het=!0),"mmdbid"===i?Y.het?Y.color=o.icn3d.atomColors[Y.elem]||o.icn3d.defaultAtomColor:Y.color=void 0!==f[z]?new THREE.Color(f[z]):o.icn3d.chargeColors[Y.resn]:void 0!==Y.color&&(Y.color=new THREE.Color(Y.color))," "!==Y.resn.charAt(0)&&" "===Y.resn.charAt(1)&&(Y.resn=Y.resn.charAt(0)),"HOH"==Y.resn&&(o.icn3d.water[d]=1),o.icn3d.atoms[d]=Y,o.icn3d.dAtoms[d]=1,o.icn3d.hAtoms[d]=1;var T=Y.structure+"_"+Y.chain;void 0===o.icn3d.chains[T]&&(o.icn3d.chains[T]={}),o.icn3d.chains[T][d]=1;var oe=Y.structure+"_"+Y.chain+"_"+Y.resi;void 0===o.icn3d.residues[oe]&&(o.icn3d.residues[oe]={}),o.icn3d.residues[oe][d]=1,q=z+"_"+Y.resi,q!==P&&z!==$&&(j=!0,1!==d&&(void 0===o.icn3d.structures[L]&&(o.icn3d.structures[L]=[]),o.icn3d.structures[L].push($))),o.icn3d.residueId2Name[oe]=J;var re="-";if("helix"===Y.ss?re="H":"sheet"===Y.ss?re="E":Y.het||te?re="o":!Y.het&&o.icn3d.residueColors.hasOwnProperty(Y.resn.toUpperCase())?re="c":"coil"===Y.ss&&(re="c"),o.icn3d.secondaries[Y.structure+"_"+Y.chain+"_"+Y.resi]=re,(Y.resi!=l||D!=B)&&o.bFullUi)if(void 0===o.icn3d.chainsSeq[T]&&(o.icn3d.chainsSeq[T]=[],j=!1),j&&!U&&void 0!==o.icn3d.chainsSeq[T][Y.resi-1])o.icn3d.chainsSeq[T][Y.resi-1].name=J;else if(!j||!o.icn3d.chainsSeq[T].hasOwnProperty(Y.resi-1)){var se={};se.resi=Y.resi,se.name=J;var ae="";Y.resi%10===0&&(ae=Y.resi.toString()),o.icn3d.chainsSeq[T].push(se),U=!0}l=Y.resi,L=N,$=z,P=q,B=D,G=X}for(var T in biopolymerChainsHash)if(!(Object.keys(o.icn3d.chains[T]).length<10)&&"chemical"!==biopolymerChainsHash[T])for(var d in o.icn3d.chains[T]){var Y=o.icn3d.atoms[d];delete o.icn3d.chemicals[d],Y.het=!1,"protein"===biopolymerChainsHash[T]?(o.icn3d.proteins[d]=1,"CA"===Y.name&&(o.icn3d.calphas[d]=1),"N"!==Y.name&&"CA"!==Y.name&&"C"!==Y.name&&"O"!==Y.name&&(o.icn3d.sidec[d]=1)):"nucleotide"===biopolymerChainsHash[T]&&(o.icn3d.nucleotides[d]=1,("O3'"==Y.name||"O3*"==Y.name||V&&"P"==Y.name)&&(o.icn3d.nucleotidesO3[d]=1))}if(e.atoms={},void 0===o.icn3d.structures[N]&&(o.icn3d.structures[N]=[]),o.icn3d.structures[N].push(z),"mmcifid"!==i)for(var g in o.icn3d.atoms)for(var ce=void 0===o.icn3d.atoms[g].bonds?0:o.icn3d.atoms[g].bonds.length,C=0;C<ce;++C)o.icn3d.atoms[g].bonds[C]=M[o.icn3d.atoms[g].bonds[C]];if(o.icn3d.cnt=d,(o.icn3d.cnt>o.icn3d.maxatomcnt||void 0!==o.icn3d.biomtMatrices&&o.icn3d.biomtMatrices.length*o.icn3d.cnt>10*o.icn3d.maxatomcnt)&&(o.opts.proteins="c alpha trace",o.opts.nucleotides="o3 trace"),o.icn3d.pmin=r,o.icn3d.pmax=s,o.icn3d.maxD=s.distanceTo(r),o.icn3d.center=a.multiplyScalar(1/o.icn3d.cnt),o.icn3d.maxD<5&&(o.icn3d.maxD=5),o.icn3d.oriMaxD=o.icn3d.maxD,o.icn3d.oriCenter=o.icn3d.center.clone(),"mmdbid"===i){var de=e.disulfides;if(void 0!==de)for(var g=0,b=de.length;g<b;++g){var le=de[g][0].ca,pe=de[g][1].ca,he=o.icn3d.atoms[le],ue=o.icn3d.atoms[pe],me=he.structure+"_"+he.chain+"_"+he.resi,fe=ue.structure+"_"+ue.chain+"_"+ue.resi;void 0===o.icn3d.ssbondpnts[he.structure]&&(o.icn3d.ssbondpnts[he.structure]=[]),o.icn3d.ssbondpnts[he.structure].push(me),o.icn3d.ssbondpnts[he.structure].push(fe)}}else if("mmcifid"===i){var de=e.disulfides;if(void 0!==de){void 0===o.icn3d.ssbondpnts[t]&&(o.icn3d.ssbondpnts[t]=[]);for(var g=0,b=de.length;g<b;++g){var me=de[g][0],fe=de[g][1];o.icn3d.ssbondpnts[t].push(me),o.icn3d.ssbondpnts[t].push(fe)}for(var ve=Object.keys(o.icn3d.structures),ge=0,be=ve.length;ge<be;++ge){var y=ve[ge];if(y!=t){void 0===o.icn3d.ssbondpnts[y]&&(o.icn3d.ssbondpnts[y]=[]);for(var C=0,S=o.icn3d.ssbondpnts[t].length;C<S;++C){var ye=o.icn3d.ssbondpnts[t][C],K=ye.indexOf("_"),_e=y+ye.substr(K);o.icn3d.ssbondpnts[y].push(_e)}}}}}else if("align"===i){var we={};for(var T in u)if("protein"==m[T])for(var x=u[T],y=T.substr(0,T.indexOf("_")),g=0,b=x.length;g<b;++g)"C"==x[g][2]&&(void 0==we[y]&&(we[y]=[]),we[y].push(T+"_"+x[g][0]));var Ce=4,Se=Ce*Ce;for(var y in we)for(var Ae=we[y],g=0,b=Ae.length;g<b;++g)for(var C=g+1,S=Ae.length;C<S;++C){var me=Ae[g],fe=Ae[C],ke=void 0,Ee=void 0;for(var d in o.icn3d.residues[me])if("S"==o.icn3d.atoms[d].elem){ke=o.icn3d.atoms[d].coord;break}for(var d in o.icn3d.residues[fe])if("S"==o.icn3d.atoms[d].elem){Ee=o.icn3d.atoms[d].coord;break}void 0!==ke&&void 0!==Ee&&(Math.abs(ke.x-Ee.x)>Ce||Math.abs(ke.y-Ee.y)>Ce||Math.abs(ke.z-Ee.z)>Ce||(distSqr=(ke.x-Ee.x)*(ke.x-Ee.x)+(ke.y-Ee.y)*(ke.y-Ee.y)+(ke.z-Ee.z)*(ke.z-Ee.z),distSqr<Se&&(void 0===o.icn3d.ssbondpnts[y]&&(o.icn3d.ssbondpnts[y]=[]),o.icn3d.ssbondpnts[y].push(me),o.icn3d.ssbondpnts[y].push(fe))))}}"align"===i&&void 0!==n&&o.bFullUi&&o.setSeqAlign(n,e.alignedStructures),o.showTitle(),e={}},iCn3DUI.prototype.downloadMmtf=function(e){var t=this;MMTF.fetchReduced(e,function(i){if(10*i.numAtoms>t.icn3d.maxatomcnt){var n=!1;t.parseMmtfData(i,n)}else i=null,MMTF.fetch(e,function(e){var i=!0;t.parseMmtfData(e,i)},function(e){console.error(e)})},function(e){console.error(e)})},iCn3DUI.prototype.parseMmtfData=function(e,t){var i=this;e.numAtoms;i.icn3d.init();var n=new THREE.Vector3(9999,9999,9999),o=new THREE.Vector3((-9999),(-9999),(-9999)),r=new THREE.Vector3,s=e.structureId;if(i.icn3d.molTitle=e.title,void 0!==e.bioAssemblyList&&void 0!==e.bioAssemblyList[0]&&e.bioAssemblyList[0].transformList.length>1){i.icn3d.biomtMatrices=[];for(var a=0,c=e.bioAssemblyList[0].transformList.length;a<c;++a){var d=(new THREE.Matrix4).fromArray(e.bioAssemblyList[0].transformList[a].matrix).transpose();i.icn3d.biomtMatrices.push(d)}}void 0!==i.icn3d.biomtMatrices&&i.icn3d.biomtMatrices.length>1?($("#"+i.pre+"assemblyWrapper").show(),i.icn3d.asuCnt=i.icn3d.biomtMatrices.length):$("#"+i.pre+"assemblyWrapper").hide();var l,p,h,u,m,f,v,g,b,y,_,w,C,S,A,k={},E=[],x="coil",R="",T=0,H=0,D=!1,I={onModel:function(e){l=0===e.modelIndex?s:s+(e.modelIndex+1).toString()},onChain:function(e){D=!1,p=e.chainName;var t=l+"_"+p;void 0===i.icn3d.structures[l]&&(i.icn3d.structures[l]=[]),i.icn3d.structures[l].push(t)},onGroup:function(e){h=e.groupName,u=e.groupId;var t=l+"_"+p+"_"+u;m=0===e.secStruct||2===e.secStruct||4===e.secStruct?"helix":3===e.secStruct?"sheet":e.secStruct===-1?"other":"coil";var n=!1;if(p!==R){if("coil"!==m&&"other"!==m?(f=!0,v=!1):(f=!1,v=!1),"coil"!==x&&"other"!==x){var o=l+"_"+R+"_"+T.toString();for(var r in i.icn3d.residues[o])i.icn3d.atoms[r].ssbegin=!1,i.icn3d.atoms[r].ssend=!0}}else m!==x?"coil"===x||"other"===x?(f=!0,v=!1):"coil"===m||"other"===m?(n=!0,f=!1,v=!1):("sheet"===x&&"helix"===m||"helix"===x&&"sheet"===m)&&(n=!0,f=!0,v=!1):(f=!1,v=!1);if(n){var o=l+"_"+p+"_"+(u-1).toString();for(var r in i.icn3d.residues[o])i.icn3d.atoms[r].ssbegin=!1,i.icn3d.atoms[r].ssend=!0}x=m,R=p,T=u,g=!1,b=!1,y=!1,"non-polymer"===e.chemCompType.toLowerCase()||"other"===e.chemCompType.toLowerCase()||e.chemCompType.toLowerCase().indexOf("saccharide")!==-1?g=!0:e.chemCompType.toLowerCase().indexOf("peptide")!==-1?b=!0:e.chemCompType.toLowerCase().indexOf("dna")!==-1||e.chemCompType.toLowerCase().indexOf("rna")!==-1?y=!0:b=!0;var s=l+"_"+p,a={};a.resi=u,a.name=i.icn3d.residueName2Abbr(h),i.icn3d.residueId2Name[t]=a.name;var c="";a.resi%10===0&&(c=a.resi.toString());var d="-";"helix"===m?d="H":"sheet"===m?d="E":"coil"===m?d="c":"other"===m&&(d="o"),void 0===i.icn3d.chainsSeq[s]&&(i.icn3d.chainsSeq[s]=[]),i.bFullUi&&i.icn3d.chainsSeq[s].push(a),i.icn3d.secondaries[t]=d},onAtom:function(e){if(_=e.element,w=e.atomName,C=new THREE.Vector3(e.xCoord,e.yCoord,e.zCoord),S=e.bFactor,A=e.altLoc,"\0"===e.altLoc&&(A=""),""===A||"A"===A){++H,"SG"===w&&E.push(H),k[e.atomIndex]=H;var s={het:g,serial:H,name:w,alt:A,resn:h,structure:l,chain:p,resi:u,coord:C,b:S,elem:_,bonds:[],bondOrder:[],ss:m,ssbegin:f,ssend:v};i.icn3d.atoms[H]=s,n.min(C),o.max(C),r.add(C);var a=l+"_"+p,c=a+"_"+u;void 0===i.icn3d.chains[a]&&(i.icn3d.chains[a]={}),i.icn3d.chains[a][H]=1,void 0===i.icn3d.residues[c]&&(i.icn3d.residues[c]={}),i.icn3d.residues[c][H]=1,b?(i.icn3d.proteins[H]=1,"CA"===w&&(i.icn3d.calphas[H]=1),"N"!==w&&"CA"!==w&&"C"!==w&&"O"!==w&&(i.icn3d.sidec[H]=1)):y?(i.icn3d.nucleotides[H]=1,!t||"O3'"!=w&&"O3*"!=w?t||"P"!=w||(i.icn3d.nucleotidesO3[H]=1):i.icn3d.nucleotidesO3[H]=1):_.toLowerCase()===h.toLowerCase()?i.icn3d.ions[H]=1:"HOH"===h||"WAT"===h||"SQL"===h||"H2O"===h||"W"===h||"DOD"===h||"D3O"===h?i.icn3d.water[H]=1:i.icn3d.chemicals[H]=1,i.icn3d.dAtoms[H]=1,i.icn3d.hAtoms[H]=1}},onBond:function(e){var t=k[e.atomIndex1],n=k[e.atomIndex2];if(k.hasOwnProperty(e.atomIndex1)&&k.hasOwnProperty(e.atomIndex2)&&(i.icn3d.atoms[t].bonds.push(n),i.icn3d.atoms[n].bonds.push(t),g)){var o=e.bondOrder;i.icn3d.atoms[t].bondOrder.push(o),i.icn3d.atoms[n].bondOrder.push(o),2===o?(i.icn3d.doublebonds[t+"_"+n]=1,i.icn3d.doublebonds[n+"_"+t]=1):3===o&&(i.icn3d.triplebonds[t+"_"+n]=1,i.icn3d.triplebonds[n+"_"+t]=1)}}};MMTF.traverse(e,I);for(var O=E.length,a=0,c=O;a<c;++a)for(var M=a+1;M<c;++M){
var L=E[a],P=E[M],N=i.icn3d.atoms[L],z=i.icn3d.atoms[P];if($.inArray(P,N.bonds)!==-1){var q=N.structure+"_"+N.chain+"_"+N.resi,F=z.structure+"_"+z.chain+"_"+z.resi;void 0===i.icn3d.ssbondpnts[N.structure]&&(i.icn3d.ssbondpnts[N.structure]=[]),i.icn3d.ssbondpnts[N.structure].push(q),i.icn3d.ssbondpnts[N.structure].push(F)}}i.icn3d.cnt=H,(i.icn3d.cnt>i.icn3d.maxatomcnt||void 0!==i.icn3d.biomtMatrices&&i.icn3d.biomtMatrices.length*i.icn3d.cnt>10*i.icn3d.maxatomcnt)&&(i.opts.proteins="c alpha trace",i.opts.nucleotides="o3 trace"),i.icn3d.pmin=n,i.icn3d.pmax=o,i.icn3d.maxD=o.distanceTo(n),i.icn3d.center=r.multiplyScalar(1/i.icn3d.cnt),i.icn3d.maxD<5&&(i.icn3d.maxD=5),i.icn3d.oriMaxD=i.icn3d.maxD,i.icn3d.oriCenter=i.icn3d.center.clone(),void 0===i.cfg.align&&1==Object.keys(i.icn3d.structures).length&&$("#"+i.pre+"alternateWrapper").hide(),i.icn3d.setAtomStyleByOptions(i.opts),i.icn3d.setColorByOptions(i.opts,i.icn3d.atoms),i.renderStructure(),i.showTitle(),void 0!==i.cfg.rotate&&i.rotStruc(i.cfg.rotate,!0),void 0!==i.deferred&&i.deferred.resolve(),void 0!==i.deferred2&&i.deferred2.resolve()},iCn3DUI.prototype.downloadPdb=function(e){var t,i,n=this;t="https://files.rcsb.org/view/"+e+".pdb",i="text",n.icn3d.bCid=void 0,$.ajax({url:t,dataType:i,cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){n.showLoading()},complete:function(){n.hideLoading()},success:function(e){n.loadPdbData(e)},error:function(e,t,i){if(this.tryCount++,this.tryCount<=this.retryLimit)return void $.ajax(this)}})},iCn3DUI.prototype.downloadUrl=function(e,t){var i=this,n="text";i.icn3d.bCid=void 0,$.ajax({url:e,dataType:n,cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){$("#"+i.pre+"wait")&&$("#"+i.pre+"wait").show(),$("#"+i.pre+"canvas")&&$("#"+i.pre+"canvas").hide(),$("#"+i.pre+"cmdlog")&&$("#"+i.pre+"cmdlog").hide()},complete:function(){$("#"+i.pre+"wait")&&$("#"+i.pre+"wait").hide(),$("#"+i.pre+"canvas")&&$("#"+i.pre+"canvas").show(),$("#"+i.pre+"cmdlog")&&$("#"+i.pre+"cmdlog").show()},success:function(e){i.InputfileData=e,i.InputfileType=t,"pdb"===t?i.loadPdbData(e):"mol2"===t?i.loadMol2Data(e):"sdf"===t?i.loadSdfData(e):"xyz"===t?i.loadXyzData(e):"mmcif"===t&&i.loadMmcifData(e)},error:function(e,t,i){if(this.tryCount++,this.tryCount<=this.retryLimit)return void $.ajax(this)}})},iCn3DUI.prototype.loadPdbData=function(e){var t=this;return t.icn3d.loadPDB(e),void 0!==t.icn3d.biomtMatrices&&t.icn3d.biomtMatrices.length>1?($("#"+t.pre+"assemblyWrapper").show(),t.icn3d.asuCnt=t.icn3d.biomtMatrices.length):$("#"+t.pre+"assemblyWrapper").hide(),void 0!==t.icn3d.emd?($("#"+t.pre+"mapWrapper1").hide(),$("#"+t.pre+"mapWrapper2").hide(),$("#"+t.pre+"mapWrapper3").hide()):($("#"+t.pre+"emmapWrapper1").hide(),$("#"+t.pre+"emmapWrapper2").hide(),$("#"+t.pre+"emmapWrapper3").hide()),t.icn3d.bSecondaryStructure?void t.loadPdbDataRender():(t.deferredSecondary=$.Deferred(function(){var i=t.icn3d.isCalphaPhosOnly(t.icn3d.hash2Atoms(t.icn3d.proteins)),n=i?"1":"0";t.loadPdbDataBase(e,n)}),t.deferredSecondary.promise())},iCn3DUI.prototype.loadPdbDataBase=function(e,t){var i=this,n="https://www.ncbi.nlm.nih.gov/Structure/mmcifparser/mmcifparser.cgi";$.ajax({url:n,type:"POST",data:{dssp:"t",calphaonly:t,pdbfile:e},dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,success:function(e){var t=e;if(JSON.stringify(e).indexOf("Oops there was a problem")===-1)for(var n in i.icn3d.chainsSeq)for(var o=n.indexOf("_"),r=n.substr(o+1),s=i.icn3d.chainsSeq[n],a="coil",c=0,d=s.length;c<d;++c){var l=s[c].resi,p=r+"_"+l,h="c";t.hasOwnProperty(p)&&(h=t[p]);var u;u="H"===h?"helix":"E"===h?"sheet":"coil";var m=n+"_"+l;i.icn3d.secondaries[m]=h;var f=0;if(u!==a?"coil"===a?(ssbegin=!0,ssend=!1):"coil"===u?(f=2,ssbegin=!1,ssend=!1):("sheet"===a&&"helix"===u||"helix"===a&&"sheet"===u)&&(f=1,ssbegin=!0,ssend=!1):(ssbegin=!1,ssend=!1),1==f){var v=n+"_"+(l-1).toString();for(var g in i.icn3d.residues[v])i.icn3d.atoms[g].ssbegin=!0,i.icn3d.atoms[g].ssend=!1}else if(2==f){var v=n+"_"+(l-1).toString();for(var g in i.icn3d.residues[v])i.icn3d.atoms[g].ssbegin=!1,i.icn3d.atoms[g].ssend=!0}for(var g in i.icn3d.residues[m])i.icn3d.atoms[g].ss=u,i.icn3d.atoms[g].ssbegin=ssbegin,i.icn3d.atoms[g].ssend=ssend;a=u}i.loadPdbDataRender(),void 0!==i.deferredSecondary&&i.deferredSecondary.resolve()},error:function(e,t,n){return this.tryCount++,this.tryCount<=this.retryLimit?void $.ajax(this):(i.loadPdbDataRender(),void(void 0!==i.deferredSecondary&&i.deferredSecondary.resolve()))}})},iCn3DUI.prototype.loadPdbDataRender=function(){var e=this;e.pmid=e.icn3d.pmid,void 0===e.cfg.align&&1==Object.keys(e.icn3d.structures).length&&$("#"+e.pre+"alternateWrapper").hide(),e.icn3d.setAtomStyleByOptions(e.opts),e.icn3d.setColorByOptions(e.opts,e.icn3d.atoms),e.renderStructure(),e.showTitle(),void 0!==e.cfg.rotate&&e.rotStruc(e.cfg.rotate,!0),void 0!==e.deferred&&e.deferred.resolve(),void 0!==e.deferred2&&e.deferred2.resolve()},iCn3DUI.prototype.downloadCid=function(e){var t=this,i="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+e+"/record/SDF/?record_type=3d&response_type=display";t.opts.pk="atom",t.opts.chemicals="ball and stick",t.icn3d.opts.pk="atom",t.icn3d.opts.chemicals="ball and stick",t.icn3d.bCid=!0,$.ajax({url:i,dataType:"text",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){t.showLoading()},complete:function(){t.hideLoading()},success:function(i){var n=t.loadSdfAtomData(i,e);void 0===t.cfg.align&&1==Object.keys(t.icn3d.structures).length&&$("#"+t.pre+"alternateWrapper").hide(),n?(t.icn3d.setAtomStyleByOptions(t.opts),t.icn3d.setColorByOptions(t.opts,t.icn3d.atoms),t.renderStructure(),void 0!==t.cfg.rotate&&t.rotStruc(t.cfg.rotate,!0),void 0!==t.deferred&&t.deferred.resolve(),void 0!==t.deferred2&&t.deferred2.resolve()):alert("The SDF of CID "+e+" has the wrong format...")},error:function(e,t,i){if(this.tryCount++,this.tryCount<=this.retryLimit)return void $.ajax(this)}}).fail(function(){alert("This CID may not have 3D structure...")})},iCn3DUI.prototype.loadSdfData=function(e){var t=this,i=t.loadSdfAtomData(e);void 0===t.cfg.align&&1==Object.keys(t.icn3d.structures).length&&$("#"+t.pre+"alternateWrapper").hide(),i?(t.icn3d.setAtomStyleByOptions(t.opts),t.icn3d.setColorByOptions(t.opts,t.icn3d.atoms),t.renderStructure(),void 0!==t.cfg.rotate&&t.rotStruc(t.cfg.rotate,!0),void 0!==t.deferred&&t.deferred.resolve(),void 0!==t.deferred2&&t.deferred2.resolve()):alert("The SDF file has the wrong format...")},iCn3DUI.prototype.loadSdfAtomData=function(e,t){var i=this,n=e.split(/\r?\n|\r/);if(n.length<4)return!1;i.icn3d.init();var o=t?t:1,r="A",s=1,a="LIG",c=o,d=o+"_"+r,l=d+"_"+s,p=parseInt(n[3].substr(0,3));if(isNaN(p)||p<=0)return!1;var h=parseInt(n[3].substr(3,3)),u=4;if(n.length<u+p+h)return!1;var m,f,v=0,g=p,b={},y={},_={},w=1;for(m=v;m<g;m++){f=n[u],u++;var C=f.substr(31,3).replace(/ /g,"");if("H"!==C){var S=parseFloat(f.substr(0,10)),A=parseFloat(f.substr(10,10)),k=parseFloat(f.substr(20,10)),E=new THREE.Vector3(S,A,k),x={het:!0,serial:w,name:C,resn:a,structure:o,chain:r,resi:s,coord:E,b:0,elem:C,bonds:[],ss:"coil",ssbegin:!1,ssend:!1,bondOrder:[]};i.icn3d.atoms[w]=x,_[w]=1,b[m]=w,++w}else y[m]=1}i.icn3d.dAtoms=_,i.icn3d.hAtoms=_,i.icn3d.structures[c]=[d],i.icn3d.chains[d]=_,i.icn3d.residues[l]=_,i.icn3d.residueId2Name[l]=a,void 0===i.icn3d.chainsSeq[d]&&(i.icn3d.chainsSeq[d]=[]);var R={};for(R.resi=s,R.name=a,i.icn3d.chainsSeq[d].push(R),m=0;m<h;m++){f=n[u],u++;var T=parseInt(f.substr(0,3))-1+v,H=parseInt(f.substr(3,3))-1+v,D=f.substr(6,3).trim();if(!y.hasOwnProperty(T)&&!y.hasOwnProperty(H)){var I=b[T],O=b[H];i.icn3d.atoms[I].bonds.push(O),i.icn3d.atoms[I].bondOrder.push(D),i.icn3d.atoms[O].bonds.push(I),i.icn3d.atoms[O].bondOrder.push(D),"2"==D?(i.icn3d.doublebonds[I+"_"+O]=1,i.icn3d.doublebonds[O+"_"+I]=1):"3"==D&&(i.icn3d.triplebonds[I+"_"+O]=1,i.icn3d.triplebonds[O+"_"+I]=1)}}return i.setMaxD(),i.showTitle(),!0},iCn3DUI.prototype.setMaxD=function(){var e=this,t=new THREE.Vector3(9999,9999,9999),i=new THREE.Vector3((-9999),(-9999),(-9999)),n=new THREE.Vector3,o=0;for(var r in e.icn3d.atoms){var s=e.icn3d.atoms[r],a=s.coord;n.add(a),t.min(a),i.max(a),++o,s.het&&($.inArray(s.elem,e.icn3d.ionsArray)!==-1?e.icn3d.ions[s.serial]=1:e.icn3d.chemicals[s.serial]=1)}e.icn3d.pmin=t,e.icn3d.pmax=i,e.icn3d.cnt=o,e.icn3d.maxD=e.icn3d.pmax.distanceTo(e.icn3d.pmin),e.icn3d.center=n.multiplyScalar(1/e.icn3d.cnt),e.icn3d.maxD<5&&(e.icn3d.maxD=5),e.icn3d.oriMaxD=e.icn3d.maxD,e.icn3d.oriCenter=e.icn3d.center.clone()},iCn3DUI.prototype.saveStlFile=function(e){var t=this;if(Object.keys(t.icn3d.dAtoms).length>7e4)return alert("Please display a subset of the structure to export 3D files. Then merge the files for 3D printing..."),[""];t.prepareFor3Dprint();for(var i=0,n=0,o=t.icn3d.mdl.children.length;n<o;++n){var r=t.icn3d.mdl.children[n];if("Sprite"!==r.type){var s=r.geometry,a=s.faces;if(void 0!==a)for(var c=0,d=a.length;c<d;++c)++i}}for(var n=0,o=t.icn3d.mdl_ghost.children.length;n<o;++n){var r=t.icn3d.mdl_ghost.children[n];if("Sprite"!==r.type){var s=r.geometry,a=s.faces;if(void 0!==a)for(var c=0,d=a.length;c<d;++c)++i}}for(var l=[],p=new Uint8Array(84),h="STL file for the structure(s) ",u=Object.keys(t.icn3d.structures),n=0,o=u.length;n<o;++n)h+=u[n],n<o-1&&(h+=", ");h.length>80&&(h=h.substr(0,80));for(var n=0;n<80;++n)n<h.length?p[n]=t.passInt8([h.charCodeAt(n)])[0]:p[n]=t.passInt8([" ".charCodeAt(0)])[0];if(p=void 0!==t.icn3d.biomtMatrices&&t.icn3d.biomtMatrices.length>1&&t.icn3d.bAssembly&&Object.keys(t.icn3d.dAtoms).length*t.icn3d.biomtMatrices.length<=t.icn3d.maxAtoms3DMultiFile?t.updateArray(p,t.passInt32([i*t.icn3d.biomtMatrices.length]),80):t.updateArray(p,t.passInt32([i]),80),l.push(new Blob([p],{type:"application/octet-stream"})),l=t.processStlMeshGroup(t.icn3d.mdl,l,e),l=t.processStlMeshGroup(t.icn3d.mdl_ghost,l,e),void 0!==t.icn3d.biomtMatrices&&t.icn3d.biomtMatrices.length>1&&t.icn3d.bAssembly&&Object.keys(t.icn3d.dAtoms).length*t.icn3d.biomtMatrices.length<=t.icn3d.maxAtoms3DMultiFile){var m=new THREE.Matrix4;m.identity();for(var n=0;n<t.icn3d.biomtMatrices.length;n++){var f=t.icn3d.biomtMatrices[n];void 0!==f&&(f.equals(m)||(l=t.processStlMeshGroup(t.icn3d.mdl,l,f),l=t.processStlMeshGroup(t.icn3d.mdl_ghost,l,f)))}}return l},iCn3DUI.prototype.updateArray=function(e,t,i){for(var n=0,o=t.length;n<o;++n)e[i+n]=t[n];return e},iCn3DUI.prototype.processStlMeshGroup=function(e,t,i){for(var n=this,o=0,r=e.children.length;o<r;++o){var s=e.children[o];if("Sprite"!==s.type){var a=s.geometry,c=a.vertices,d=a.faces;if(void 0!==d){for(var l=s.position,p=s.scale,h=s.matrix,u=new Uint8Array(50*d.length),m=0,f=0,v=d.length;f<v;++f){var g,b,y,_=d[f].a,w=d[f].b,C=d[f].c,S=d[f].normal;"SphereGeometry"==a.type||"BoxGeometry"==a.type?(g=c[_].clone().multiply(p).add(l),b=c[w].clone().multiply(p).add(l),y=c[C].clone().multiply(p).add(l)):"CylinderGeometry"==a.type?(g=c[_].clone().applyMatrix4(h),b=c[w].clone().applyMatrix4(h),y=c[C].clone().applyMatrix4(h)):(g=c[_].clone(),b=c[w].clone(),y=c[C].clone()),void 0!==S?(void 0!==i&&S.applyMatrix4(i),u=n.updateArray(u,n.passFloat32([S.x,S.y,S.z]),m),m+=12):(u=n.updateArray(u,n.passFloat32([0,0,0]),m),m+=12),void 0!==i&&(g.applyMatrix4(i),b.applyMatrix4(i),y.applyMatrix4(i)),u=n.updateArray(u,n.passFloat32([g.x,g.y,g.z]),m),m+=12,u=n.updateArray(u,n.passFloat32([b.x,b.y,b.z]),m),m+=12,u=n.updateArray(u,n.passFloat32([y.x,y.y,y.z]),m),m+=12,g=b=y=void 0,u=n.updateArray(u,n.passInt16([0]),m),m+=2}t.push(new Blob([u],{type:"application/octet-stream"})),u=null}}}return t},iCn3DUI.prototype.saveVrmlFile=function(e){var t=this;if(Object.keys(t.icn3d.dAtoms).length>5e4)return alert("Please display a subset of the structure to export 3D files. Then merge the files for 3D printing..."),[""];t.prepareFor3Dprint();var i=[];i.push("#VRML V2.0 utf8\n");var n=0,o=t.processVrmlMeshGroup(t.icn3d.mdl,i,n,e);if(i=o.vrmlStrArray,n=o.vertexCnt,o=t.processVrmlMeshGroup(t.icn3d.mdl_ghost,i,n,e),i=o.vrmlStrArray,n=o.vertexCnt,void 0!==t.icn3d.biomtMatrices&&t.icn3d.biomtMatrices.length>1&&t.icn3d.bAssembly&&Object.keys(t.icn3d.dAtoms).length*t.icn3d.biomtMatrices.length<=t.icn3d.maxAtoms3DMultiFile){var r=new THREE.Matrix4;r.identity();for(var s=0;s<t.icn3d.biomtMatrices.length;s++){var a=t.icn3d.biomtMatrices[s];void 0!==a&&(a.equals(r)||(o=t.processVrmlMeshGroup(t.icn3d.mdl,i,n,a),i=o.vrmlStrArray,n=o.vertexCnt,o=t.processVrmlMeshGroup(t.icn3d.mdl_ghost,i,n,a),i=o.vrmlStrArray,n=o.vertexCnt))}}return i},iCn3DUI.prototype.processVrmlMeshGroup=function(e,t,i,n){for(var o=0,r=e.children.length;o<r;++o){var s=e.children[o];if("Sprite"!==s.type){var a=s.geometry,c=(s.material.type,"Surface"==a.type),d=a.vertices;if(void 0!==d){i+=d.length;var l=a.faces,p=s.position,h=s.scale,u=s.matrix,m=new THREE.Color(1,1,1);"SphereGeometry"!=a.type&&"BoxGeometry"!=a.type&&"CylinderGeometry"!=a.type||void 0!==s.material&&(m=s.material.color),t.push("Shape {\n"),t.push("geometry IndexedFaceSet {\n"),t.push("coord Coordinate { point [ ");for(var f=[],v=0,g=d.length;v<g;++v){var b;b="SphereGeometry"==a.type||"BoxGeometry"==a.type?d[v].clone().multiply(h).add(p):"CylinderGeometry"==a.type?d[v].clone().applyMatrix4(u):d[v].clone(),void 0!==n&&b.applyMatrix4(n),t.push(b.x.toPrecision(5)+" "+b.y.toPrecision(5)+" "+b.z.toPrecision(5)),b=void 0,v<g-1&&t.push(", "),f.push(new THREE.Color(1,1,1))}t.push(" ] }\n");var y="",_="";if(c){for(var v=0,g=l.length;v<g;++v){var w=l[v].a,C=l[v].b,S=l[v].c;y+=w+" "+C+" "+S,v<g-1&&(y+=", -1, "),f[w]=l[v].vertexColors[0],f[C]=l[v].vertexColors[1],f[S]=l[v].vertexColors[2]}for(var v=0,g=f.length;v<g;++v){var A=f[v];_+=A.r.toPrecision(3)+" "+A.g.toPrecision(3)+" "+A.b.toPrecision(3),v<g-1&&(_+=", ")}t.push("coordIndex [ "+y+" ]\n"),t.push("color Color { color [ "+_+" ] } colorPerVertex TRUE\n")}else{for(var v=0,g=l.length;v<g;++v){var A,w=l[v].a,C=l[v].b,S=l[v].c;A="SphereGeometry"==a.type||"BoxGeometry"==a.type||"CylinderGeometry"==a.type?m:l[v].color,y+=w+" "+C+" "+S,v<g-1&&(y+=", -1, "),f[w]=A,f[C]=A,f[S]=A}for(var v=0,g=f.length;v<g;++v){var A=f[v];_+=A.r.toPrecision(3)+" "+A.g.toPrecision(3)+" "+A.b.toPrecision(3),v<g-1&&(_+=", ")}t.push("coordIndex [ "+y+" ]\n"),t.push("color Color { color [ "+_+" ] } colorPerVertex TRUE\n")}t.push("  }\n"),t.push("}\n")}}}return{vrmlStrArray:t,vertexCnt:i}},iCn3DUI.prototype.setThichknessFor3Dprint=function(){var e=this;e.icn3d.lineRadius=1,e.icn3d.coilWidth=1.2,e.icn3d.cylinderRadius=.8,e.icn3d.traceRadius=1,e.icn3d.dotSphereScale=.6,e.icn3d.sphereRadius=1.5,e.icn3d.ribbonthickness=1,e.icn3d.helixSheetWidth=2,e.icn3d.nucleicAcidWidth=1.4},iCn3DUI.prototype.prepareFor3Dprint=function(){var e=this;if(e.icn3d.bShowHighlight=!1,e.icn3d.removeHlObjects(),e.bDashedLines=!1,e.bSetThickness||void 0!==e.cfg.cid||e.setThichknessFor3Dprint(),void 0!==e.icn3d.lines.hbond)for(var t=0,i=e.icn3d.lines.hbond.length;t<i;++t){var n=e.icn3d.lines.hbond[t];n.dashed=!1,e.bDashedLines=!0}if(void 0!==e.icn3d.lines.distance)for(var t=0,i=e.icn3d.lines.distance.length;t<i;++t){var n=e.icn3d.lines.distance[t];n.dashed=!1,e.bDashedLines=!0}e.icn3d.draw()},iCn3DUI.prototype.resetAfter3Dprint=function(){var e=this;if(void 0!==e.icn3d.lines.hbond)for(var t=0,i=e.icn3d.lines.hbond.length;t<i;++t){var n=e.icn3d.lines.hbond[t];n.dashed=!0}if(void 0!==e.icn3d.lines.distance)for(var t=0,i=e.icn3d.lines.distance.length;t<i;++t){var n=e.icn3d.lines.distance[t];n.dashed=!0}e.icn3d.lineRadius=.1,e.icn3d.coilWidth=.3,e.icn3d.cylinderRadius=.4,e.icn3d.traceRadius=.4,e.icn3d.dotSphereScale=.3,e.icn3d.sphereRadius=1.5,e.icn3d.cylinderHelixRadius=1.6,e.icn3d.ribbonthickness=.2,e.icn3d.helixSheetWidth=1.3,e.icn3d.nucleicAcidWidth=.8},iCn3DUI.prototype.removeOneStabilizer=function(e){for(var t,i=this,n=0,o=i.icn3d.pairArray.length;n<o;n+=2){var r=i.getResidueRepAtom(i.icn3d.pairArray[n]),s=i.getResidueRepAtom(i.icn3d.pairArray[n+1]);if(void 0!=e)for(var a=0,c=e.length;a<c;a+=2){var d=i.getResidueRepAtom(e[a]),l=i.getResidueRepAtom(e[a+1]);if(r.serial==d.serial&&s.serial==l.serial||r.serial==l.serial&&s.serial==d.serial){t=n;break}}if(void 0!==t)break}void 0!==t&&i.icn3d.pairArray.splice(t,2)},iCn3DUI.prototype.outputSelection=function(){var e=this,t={};for(var i in e.icn3d.hAtoms){var n=e.icn3d.atoms[i].structure+"_"+e.icn3d.atoms[i].chain+"_"+e.icn3d.atoms[i].resi;t[n]=1}for(var o=Object.keys(t).sort(function(e,t){if(""!==e&&!isNaN(e))return parseInt(e)-parseInt(t);var i=e.lastIndexOf("_"),n=t.lastIndexOf("_");if(e.substr(0,i)<t.substr(0,i))return-1;if(e.substr(0,i)>t.substr(0,i))return 1;if(e.substr(0,i)==t.substr(0,i)){if(parseInt(e.substr(i+1))<parseInt(t.substr(n+1)))return-1;if(parseInt(e.substr(i+1))>parseInt(t.substr(n+1)))return 1;if(parseInt(e.substr(i+1))==parseInt(t.substr(n+1)))return 0}}),r="<table><tr><th>Structure</th><th>Chain</th><th>Residue Number</th></tr>",i=0,s=o.length;i<s;++i){var a=o[i].indexOf("_"),c=o[i].lastIndexOf("_"),d=o[i].substr(0,a),l=o[i].substr(a+1,c-a-1),p=o[i].substr(c+1);r+="<tr><td>"+d+"</td><td>"+l+"</td><td>"+p+"</td></tr>"}var h=e.inputid?e.inputid:"custom";e.saveFile(h+"_residues.txt","html",r)},iCn3DUI.prototype.addStabilizer=function(){var e=this,t=3.5,i=3.2;if(e.icn3d.opts.water="dot",Object.keys(e.icn3d.dAtoms).length>0){var n,o={},r=t*t,s=i*i;for(var a in e.icn3d.dAtoms){var c=e.icn3d.atoms[a];!e.icn3d.nucleotides.hasOwnProperty(c.serial)||"N1"!==c.name&&"N2"!==c.name&&"N3"!==c.name&&"N4"!==c.name&&"N6"!==c.name&&"O2"!==c.name&&"O6"!==c.name||(n=c.structure+"_"+c.chain+"_"+c.resi+"_"+c.name,o[n]=c)}var d=Object.keys(o),l=d.length;void 0===e.icn3d.pairArray&&(e.icn3d.pairArray=[]);for(var a=0;a<l;++a)for(var p=a+1;p<l;++p){var h=d[a],u=d[p],m=Math.abs(o[h].coord.x-o[u].coord.x);if(!(m>t)){var f=Math.abs(o[h].coord.y-o[u].coord.y);if(!(f>t)){var v=Math.abs(o[h].coord.z-o[u].coord.z);if(!(v>t)){var g=m*m+f*f+v*v;g>r||g<s||(e.icn3d.pairArray.push(o[h].serial),e.icn3d.pairArray.push(o[u].serial))}}}}var b=6,y={};for(var a in e.icn3d.dAtoms){var c=e.icn3d.atoms[a],_=c.structure+"_"+c.chain+"_"+c.resi;y[_]=1}var w={};for(var a in e.icn3d.chemicals){var c=e.icn3d.atoms[a],_=c.structure+"_"+c.chain+"_"+c.resi;y.hasOwnProperty(_)&&(w[_]=1)}for(var a in e.icn3d.ions){var c=e.icn3d.atoms[a],_=c.structure+"_"+c.chain+"_"+c.resi;y.hasOwnProperty(_)&&(w[_]=1)}for(var C=Object.keys(e.icn3d.chains),a=0,S=C.length;a<S;++a){for(var _,A=C[a],k=0,E=0,p=0,x=e.icn3d.chainsSeq[A].length;p<x;++p)_=A+"_"+e.icn3d.chainsSeq[A][p].resi,"c"!=e.icn3d.secondaries[_]&&"E"!=e.icn3d.secondaries[_]&&"H"!=e.icn3d.secondaries[_]||(k%3!=0&&e.icn3d.chainsSeq[A][p].resi==E+1||y.hasOwnProperty(_)&&(w[_]=1),++k,E=e.icn3d.chainsSeq[A][p].resi);"c"!=e.icn3d.secondaries[_]&&"E"!=e.icn3d.secondaries[_]&&"H"!=e.icn3d.secondaries[_]||y.hasOwnProperty(_)&&(w[_]=1)}var R=Object.keys(w);void 0===e.icn3d.pairArray&&(e.icn3d.pairArray=[]);for(var T=e.icn3d.exclHash(e.icn3d.dAtoms,e.icn3d.water),a=0,S=R.length;a<S;++a){var _=R[a],H=e.icn3d.secondaries[_],D=e.icn3d.getNeighboringAtoms(T,e.icn3d.hash2Atoms(e.icn3d.residues[_]),b),I=Object.keys(D).sort(),d=Object.keys(e.icn3d.residues[_]).sort(),O=!1;if(e.icn3d.proteins.hasOwnProperty(d[0])){d=[d[0]],O=!0;var M=parseInt(_.substr(_.lastIndexOf("_")+1)),L={};for(var $ in D)if(!e.icn3d.chemicals.hasOwnProperty($)&&!e.icn3d.ions.hasOwnProperty($)){var c=e.icn3d.atoms[$];("c"==H&&(c.resi>M+1||c.resi<M-1)||"E"==H&&(c.resi>M+2||c.resi<M-2)||"H"==H&&(c.resi>M+4||c.resi<M-4))&&(L[$]=1)}I=Object.keys(L).sort()}if(I.length>0&&d.length>0)if(O){var P=parseInt((I.length+.5)/2);e.icn3d.pairArray.push(d[0]),e.icn3d.pairArray.push(I[P])}else for(var N=10,z=parseInt(I.length/(N+1)),p=0,x=d.length;p<x;++p)if(p%N==0){var q=parseInt(p/N)*z,P=q<I.length?q:I.length-1;e.icn3d.pairArray.push(d[p]),e.icn3d.pairArray.push(I[P]),d.length<N+1&&(e.icn3d.pairArray.push(d[p]),e.icn3d.pairArray.push(I[I.length-1]))}}}},iCn3DUI.prototype.hideStabilizer=function(){var e=this;e.icn3d.pairArray=[],e.icn3d.lines.stabilizer=[],e.icn3d.stabilizerpnts=[];for(var t in e.icn3d.water)e.icn3d.atoms[t].style=e.icn3d.opts.water},iCn3DUI.prototype.getResidueRepPos=function(e){var t,i=this,n=i.icn3d.atoms[e],o=n.structure+"_"+n.chain+"_"+n.resi;if(i.icn3d.proteins.hasOwnProperty(e)||i.icn3d.nucleotides.hasOwnProperty(e))for(var r in i.icn3d.residues[o]){var s=i.icn3d.atoms[r];if("N3"===s.name){t=i.icn3d.atoms[r].coord;break}if("CA"===s.name&&"coil"==s.ss){t=i.icn3d.atoms[r].coord;break}if("CA"===s.name&&("helix"==s.ss||"sheet"==s.ss)){t=void 0!==i.icn3d.atoms[r].coord2?i.icn3d.atoms[r].coord2:i.icn3d.atoms[r].coord;break}}else t=n.coord;return void 0===t&&(t=n.coord),t},iCn3DUI.prototype.getResidueRepAtom=function(e){var t,i=this,n=i.icn3d.atoms[e],o=n.structure+"_"+n.chain+"_"+n.resi;if(i.icn3d.proteins.hasOwnProperty(e)||i.icn3d.nucleotides.hasOwnProperty(e))for(var r in i.icn3d.residues[o]){var s=i.icn3d.atoms[r];if("CA"===s.name||"N3"===s.name){t=i.icn3d.atoms[r];break}}else t=n;return void 0===t&&(t=n),t},iCn3DUI.prototype.downloadAlignment=function(e){var t=this;if(t.opts.proteins="c alpha trace",t.icn3d.opts.proteins="c alpha trace",t.bFullUi&&t.isMac()&&t.isMobile){t.MENU_WIDTH=950,t.setViewerWidthHeight();var i=t.WIDTH-t.LESSWIDTH,n=t.HEIGHT-t.LESSHEIGHT;t.resizeCanvas(i,n,!0,!1)}var o=e.split(","),r="ids="+e,s="https://www.ncbi.nlm.nih.gov/Structure/vastplus/vastplus.cgi?v=2&cmd=c&b=1&s=1&w3d&"+r,a="https://www.ncbi.nlm.nih.gov/Structure/vastplus/vastplus.cgi?v=2&cmd=c1&b=1&s=1&d=1&"+r;void 0!==t.cfg.inpara&&(s+=t.cfg.inpara,a+=t.cfg.inpara),t.icn3d.bCid=void 0,t.icn3d.pdbid_chain2title={},void 0===t.chainids2resids&&(t.chainids2resids={});var c=$.ajax({url:a,dataType:"jsonp",cache:!0}),d={},l=c.then(function(e){if(d=e.seqalign,void 0===d)return alert("These two MMDB IDs "+o+" do not have 3D alignment data."),!1;t.icn3d.pdbid_molid2chain={},t.icn3d.chainsColor={};for(var i=0,n=2;i<n;++i){var r=e.alignedStructures[0][i],a=void 0!==r.pdbId?r.pdbId:r.mmdbId,c={};for(var l in r.molecules){var p=r.molecules[l].chain.trim();void 0===c[p]?c[p]=1:++c[p];var h=1===c[p]?p:p+c[p].toString();t.icn3d.pdbid_molid2chain[a+"_"+l]=h,"p"!==r.molecules[l].kind&&"n"!==r.molecules[l].kind||(t.icn3d.chainsColor[a+"_"+h]=new THREE.Color(t.GREY8))}}for(var i=0,n=2;i<n;++i){var r=e.alignedStructures[0][i],a=r.pdbId,u=r.molecules;for(var m in u){var f=u[m].chain;t.icn3d.pdbid_chain2title[a+"_"+f]=u[m].name}}t.alignmolid2color=[],t.alignmolid2color[0]={},t.alignmolid2color[1]={};for(var i=(t.icn3d.stdChainColors.length,0),n=d.length;i<n;++i){var v=d[i][0].moleculeId,g=d[i][1].moleculeId;t.alignmolid2color[0][v]=(i+1).toString(),t.alignmolid2color[1][g]=(i+1).toString()}return $.ajax({url:s,dataType:"jsonp",cache:!0,beforeSend:function(){t.showLoading()},complete:function(){t.hideLoading()}})});l.done(function(e){if(void 0===e.atoms)return alert("invalid atoms data."),!1;t.icn3d.init(),t.loadAtomDataIn(e,void 0,"align",d),void 0===t.cfg.align&&1==Object.keys(t.icn3d.structures).length&&$("#"+t.pre+"alternateWrapper").hide();var i={};for(var n in t.icn3d.atoms)i[n]=1;t.icn3d.dAtoms=i,t.icn3d.hAtoms=i,t.icn3d.setAtomStyleByOptions(t.opts),t.icn3d.setColorByOptions(t.opts,t.icn3d.atoms),t.mmdbidArray=[];for(var n=0,o=e.alignedStructures[0].length;n<o;++n)t.mmdbidArray.push(e.alignedStructures[0][n].pdbId);t.renderStructure(),void 0!==t.cfg.rotate&&t.rotStruc(t.cfg.rotate,!0),t.html2ddgm="",void 0!==t.cfg.showalignseq&&t.cfg.showalignseq&&t.openDialog(t.pre+"dl_alignment","Select residues in aligned sequences"),void 0!==t.cfg.show2d&&t.cfg.show2d&&t.bFullUi&&t.set2DDiagramsForAlign(t.mmdbidArray[0].toUpperCase(),t.mmdbidArray[1].toUpperCase()),void 0!==t.deferred&&t.deferred.resolve(),void 0!==t.deferred2&&t.deferred2.resolve()})},iCn3DUI.prototype.set2DDiagramsForAlign=function(e,t){var i=this;i.openDialog(i.pre+"dl_2ddgm","Interactions");var n="https://www.ncbi.nlm.nih.gov/Structure/mmdb/mmdb_strview.cgi?v=2&program=icn3d&uid="+e+"&intrac=1",o="https://www.ncbi.nlm.nih.gov/Structure/mmdb/mmdb_strview.cgi?v=2&program=icn3d&uid="+t+"&intrac=1";void 0!==i.cfg.inpara&&(n+=i.cfg.inpara,o+=i.cfg.inpara);var r=$.ajax({url:n,dataType:"jsonp",cache:!0}),s=r.then(function(t){return i.interactionData1=t,i.html2ddgm="",i.draw2Ddgm(t,e,0),void 0!==i.cfg.show2d&&i.cfg.show2d&&i.openDialog(i.pre+"dl_2ddgm","Interactions"),$.ajax({url:o,dataType:"jsonp",cache:!0})});s.done(function(e){i.interactionData2=e,i.draw2Ddgm(e,t,1),i.html2ddgm+="<br>"+i.set2DdgmNote(!0),$("#"+i.pre+"dl_2ddgm").html(i.html2ddgm),i.b2DShown=!0,void 0!==i.deferredViewinteraction&&i.deferredViewinteraction.resolve()})},iCn3DUI.prototype.download2Ddgm=function(e,t){var i=this;i.set2DDiagrams(e)},iCn3DUI.prototype.set2DDiagrams=function(e){var t=this;t.openDialog(t.pre+"dl_2ddgm","Interactions"),void 0!==t.b2DShown&&t.b2DShown||(t.html2ddgm="",t.draw2Ddgm(t.interactionData,e),t.html2ddgm+="<br>"+t.set2DdgmNote(),$("#"+t.pre+"dl_2ddgm").html(t.html2ddgm)),t.b2DShown=!0},iCn3DUI.prototype.setSeqAlign=function(e,t){var i=this,n=t[0][0].pdbId,o=t[0][1].pdbId;i.conservedName1=n+"_cons",i.nonConservedName1=n+"_ncons",i.notAlignedName1=n+"_nalign",i.conservedName2=o+"_cons",i.nonConservedName2=o+"_ncons",i.notAlignedName2=o+"_nalign",i.consHash1={},i.nconsHash1={},i.nalignHash1={},i.consHash2={},i.nconsHash2={},i.nalignHash2={};for(var r=0,s=e.length;r<s;++r){for(var a=e[r][0],c=a.moleculeId,d=i.icn3d.pdbid_molid2chain[n+"_"+c],l=n+"_"+d,p={},h=a.sequence.length,u=-1,m=!1,f=0,v=a.sequence.length;f<v;++f){var g=a.sequence[f][0],b="~"===a.sequence[f][2]?"-":a.sequence[f][2],y=a.sequence[f][3]?1:0;1==y&&(f<h&&!m&&(h=f,m=!0),f>u&&(u=f)),p[f]={resi:g,resn:b,aligned:y}}a=e[r][1];var _=a.moleculeId,w=i.icn3d.pdbid_molid2chain[o+"_"+_],C=o+"_"+w;void 0===i.icn3d.alnChainsAnTtl[l]&&(i.icn3d.alnChainsAnTtl[l]=[]),void 0===i.icn3d.alnChainsAnTtl[l][0]&&(i.icn3d.alnChainsAnTtl[l][0]=[]),void 0===i.icn3d.alnChainsAnTtl[l][1]&&(i.icn3d.alnChainsAnTtl[l][1]=[]),void 0===i.icn3d.alnChainsAnTtl[l][2]&&(i.icn3d.alnChainsAnTtl[l][2]=[]),void 0===i.icn3d.alnChainsAnTtl[l][3]&&(i.icn3d.alnChainsAnTtl[l][3]=[]),void 0===i.icn3d.alnChainsAnTtl[l][4]&&(i.icn3d.alnChainsAnTtl[l][4]=[]),void 0===i.icn3d.alnChainsAnTtl[l][5]&&(i.icn3d.alnChainsAnTtl[l][5]=[]),void 0===i.icn3d.alnChainsAnTtl[l][6]&&(i.icn3d.alnChainsAnTtl[l][6]=[]),i.icn3d.alnChainsAnTtl[l][0].push(C),i.icn3d.alnChainsAnTtl[l][1].push(l),i.icn3d.alnChainsAnTtl[l][2].push(""),i.icn3d.alnChainsAnTtl[l][3].push(""),i.icn3d.alnChainsAnTtl[l][4].push(C),i.icn3d.alnChainsAnTtl[l][5].push(l),i.icn3d.alnChainsAnTtl[l][6].push("");for(var S=1,f=h;f<=u;++f){var A,k,E,g=a.sequence[f][0],b="~"===a.sequence[f][2]?"-":a.sequence[f][2],x=a.sequence[f][3]?1:0,y=p[f].aligned+x;2===y?(p[f].resn===b?(A="#FF0000",E="icn3d-cons",i.consHash1[l+"_"+p[f].resi]=1,i.consHash2[C+"_"+g]=1):(A="#0000FF",E="icn3d-ncons",i.nconsHash1[l+"_"+p[f].resi]=1,i.nconsHash2[C+"_"+g]=1),k="#"+i.getColorhexFromBlosum62(p[f].resn,b)):(A=i.GREY8,E="icn3d-nalign",i.nalignHash1[l+"_"+p[f].resi]=1,i.nalignHash2[C+"_"+g]=1),void 0===i.icn3d.alnChainsSeq[l]&&(i.icn3d.alnChainsSeq[l]=[]);var R={};R.mmdbid=n,R.chain=d,R.resi=p[f].resi,R.resn=""===R.resi||"icn3d-nalign"===E?p[f].resn.toLowerCase():p[f].resn,R.aligned=y,R.color=""===R.resi?i.GREYC:A,R.color2=""===R.resi?i.GREYC:k,R["class"]=E,i.icn3d.alnChainsSeq[l].push(R),""!==p[f].resi&&(void 0===i.icn3d.alnChains[l]&&(i.icn3d.alnChains[l]={}),$.extend(i.icn3d.alnChains[l],i.icn3d.residues[l+"_"+p[f].resi])),void 0===i.icn3d.alnChainsSeq[C]&&(i.icn3d.alnChainsSeq[C]=[]),R={},R.mmdbid=o,R.chain=w,R.resi=g,R.resn=""===R.resi||"icn3d-nalign"===E?b.toLowerCase():b,R.aligned=y,R.color=""===R.resi?i.GREYC:A,R.color2=""===R.resi?i.GREYC:k,R["class"]=E,i.icn3d.alnChainsSeq[C].push(R),""!==R.resi&&(void 0===i.icn3d.alnChains[C]&&(i.icn3d.alnChains[C]={}),$.extend(i.icn3d.alnChains[C],i.icn3d.residues[C+"_"+g])),void 0===i.icn3d.alnChainsAnno[l]&&(i.icn3d.alnChainsAnno[l]=[]),void 0===i.icn3d.alnChainsAnno[l][0]&&(i.icn3d.alnChainsAnno[l][0]=[]),void 0===i.icn3d.alnChainsAnno[l][1]&&(i.icn3d.alnChainsAnno[l][1]=[]),void 0===i.icn3d.alnChainsAnno[l][2]&&(i.icn3d.alnChainsAnno[l][2]=[]),void 0===i.icn3d.alnChainsAnno[l][3]&&(i.icn3d.alnChainsAnno[l][3]=[]),f===h&&(void 0===i.icn3d.alnChainsAnno[l][4]&&(i.icn3d.alnChainsAnno[l][4]=[]),void 0===i.icn3d.alnChainsAnno[l][5]&&(i.icn3d.alnChainsAnno[l][5]=[]),void 0===i.icn3d.alnChainsAnno[l][6]&&(i.icn3d.alnChainsAnno[l][6]=[]),i.icn3d.alnChainsAnno[l][4].push(i.icn3d.pdbid_chain2title[C]),i.icn3d.alnChainsAnno[l][5].push(i.icn3d.pdbid_chain2title[l]),i.icn3d.alnChainsAnno[l][6].push(""));var T=l+"_"+p[f].resi,H=C+"_"+g,D=i.icn3d.secondaries[T],I=i.icn3d.secondaries[H];void 0!==I?i.icn3d.alnChainsAnno[l][0].push(I):i.icn3d.alnChainsAnno[l][0].push("-"),void 0!==D?i.icn3d.alnChainsAnno[l][1].push(D):i.icn3d.alnChainsAnno[l][1].push("-");var O=".";S%5===0&&(O="*"),S%10===0&&(O="|"),i.icn3d.alnChainsAnno[l][2].push(O);var M="";S%10===0&&(M=S.toString()),i.icn3d.alnChainsAnno[l][3].push(M),++S}}e={}},iCn3DUI.prototype.loadMol2Data=function(e){var t=this,i=t.loadMol2AtomData(e);void 0===t.cfg.align&&1==Object.keys(t.icn3d.structures).length&&$("#"+t.pre+"alternateWrapper").hide(),i?(t.icn3d.setAtomStyleByOptions(t.opts),t.icn3d.setColorByOptions(t.opts,t.icn3d.atoms),t.renderStructure(),void 0!==t.cfg.rotate&&t.rotStruc(t.cfg.rotate,!0),void 0!==t.deferred&&t.deferred.resolve(),void 0!==t.deferred2&&t.deferred2.resolve()):alert("The Mol2 file has the wrong format...")},iCn3DUI.prototype.loadMol2AtomData=function(e){var t=this,i=e.split(/\r?\n|\r/);if(i.length<4)return!1;t.icn3d.init();for(var n,o,r=1,s="A",a="LIG",c=1,d={},l=1,p="1_A",h="1_A_1",u=0,m=0,f=1,v=!1,g=!1,b={},y={},_="",w=0,C=i.length;w<C;++w){var S=i[w].trim();if(""!==S&&"#"!==S.substr(0,1)){if("@<TRIPOS>MOLECULE"==S){t.icn3d.molTitle=i[w+1].trim();var A=i[w+2].trim().replace(/\s+/g," ").split(" ");n=A[0],o=A[1],w+=4}else"@<TRIPOS>ATOM"==S?(f=1,v=!0,++w):"@<TRIPOS>BOND"==S?(g=!0,v=!1,++w):"@<TRIPOS>SUBSTRUCTURE"==S&&(g=!1,++w);if(S=i[w].trim(),""!==S&&"#"!==S.substr(0,1)){if(v&&u<n){var k=S.replace(/\s+/g," ").split(" "),E=parseInt(k[0]);b[E]=f;var x,R=k[1],T=parseFloat(k[2]),H=parseFloat(k[3]),D=parseFloat(k[4]),I=new THREE.Vector3(T,H,D),O=k[5],M=O.indexOf(".");if(x=M===-1?O:O.substr(0,M),"H"===x&&x===O)y[E]=1;else{var L={het:!0,serial:f,name:R,resn:a,structure:r,chain:s,resi:c,coord:I,b:0,elem:x,bonds:[],ss:"coil",ssbegin:!1,ssend:!1,bondOrder:[]};t.icn3d.atoms[f]=L,d[f]=1,++f}++u}if(g&&m<o){var $=S.replace(/\s+/g," ").split(" "),P=parseInt($[1]),N=parseInt($[2]),z=$[3],q=z;if("am"===z&&(q="1"),"ar"===z&&(q="1.5"),!(y.hasOwnProperty(P)||y.hasOwnProperty(N)||"1"!==q&&"2"!==q&&"3"!==q&&"1.5"!==q)){var F=q,j=b[P],U=b[N];t.icn3d.atoms[j].bonds.push(U),t.icn3d.atoms[j].bondOrder.push(F),t.icn3d.atoms[U].bonds.push(j),t.icn3d.atoms[U].bondOrder.push(F),"2"==F?(t.icn3d.doublebonds[j+"_"+U]=1,t.icn3d.doublebonds[U+"_"+j]=1):"3"==F?(t.icn3d.triplebonds[j+"_"+U]=1,t.icn3d.triplebonds[U+"_"+j]=1):"1.5"==F&&(t.icn3d.aromaticbonds[j+"_"+U]=1,t.icn3d.aromaticbonds[U+"_"+j]=1)}++m,_=z}}}}t.icn3d.dAtoms=d,t.icn3d.hAtoms=d,t.icn3d.structures[l]=[p],t.icn3d.chains[p]=d,t.icn3d.residues[h]=d,t.icn3d.residueId2Name[h]=a,void 0===t.icn3d.chainsSeq[p]&&(t.icn3d.chainsSeq[p]=[]);var B={};return B.resi=c,B.name=a,t.icn3d.chainsSeq[p].push(B),t.setMaxD(),t.showTitle(),!0},iCn3DUI.prototype.loadXyzData=function(e){var t=this,i=t.loadXyzAtomData(e);void 0===t.cfg.align&&1==Object.keys(t.icn3d.structures).length&&$("#"+t.pre+"alternateWrapper").hide(),i?(t.icn3d.setAtomStyleByOptions(t.opts),t.icn3d.setColorByOptions(t.opts,t.icn3d.atoms),t.renderStructure(),void 0!==t.cfg.rotate&&t.rotStruc(t.cfg.rotate,!0),void 0!==t.deferred&&t.deferred.resolve(),void 0!==t.deferred2&&t.deferred2.resolve()):alert("The XYZ file has the wrong format...")},iCn3DUI.prototype.setXyzAtomSeq=function(e,t,i,n){var o=this;o.icn3d.dAtoms=o.icn3d.unionHash(o.icn3d.dAtoms,e),o.icn3d.hAtoms=o.icn3d.unionHash(o.icn3d.hAtoms,e),o.icn3d.structures[t]=[i],o.icn3d.chains[i]=e,
o.icn3d.residues[n]=e,o.icn3d.residueId2Name[n]="LIG",void 0===o.icn3d.chainsSeq[i]&&(o.icn3d.chainsSeq[i]=[]);var r={};r.resi=1,r.name="LIG",o.icn3d.chainsSeq[i].push(r);for(var s=Object.keys(e),a=0,c=s.length;a<c;++a)for(var d=o.icn3d.atoms[s[a]],l=a+1,p=s.length;l<p;++l){var h=o.icn3d.atoms[s[l]],u=1.2*(o.icn3d.covalentRadii[d.elem]+o.icn3d.covalentRadii[h.elem]);Math.abs(d.coord.x-h.coord.x)>u||Math.abs(d.coord.y-h.coord.y)>u||Math.abs(d.coord.z-h.coord.z)>u||o.icn3d.hasCovalentBond(d,h)&&(o.icn3d.atoms[s[a]].bonds.push(s[l]),o.icn3d.atoms[s[l]].bonds.push(s[a]))}},iCn3DUI.prototype.loadXyzAtomData=function(e){var t=this,i=e.split(/\r?\n|\r/);if(i.length<3)return!1;t.icn3d.init();var n,o,r,s,a="A",c="LIG",d=1,l={},p=0,h=1,u=2;t.icn3d.molTitle="";for(var m=0,f=i.length;m<f;++m){var v=i[m].trim();if(""!==v&&(""===v||isNaN(v)||(0!==m&&t.setXyzAtomSeq(l,p,n,o),++p,l={},r=p,n=r+"_"+a,o=n+"_"+d,s=parseInt(v),p>1&&(t.icn3d.molTitle+="; "),t.icn3d.molTitle+=i[m+1].trim(),m+=u),v=i[m].trim(),""!==v)){var g=v.replace(/,/," ").replace(/\s+/g," ").split(" "),b=g[0],y=parseFloat(g[1]),_=parseFloat(g[2]),w=parseFloat(g[3]),C=new THREE.Vector3(y,_,w),S={het:!0,serial:h,name:b,resn:c,structure:r,chain:a,resi:d,coord:C,b:0,elem:b,bonds:[],ss:"coil",ssbegin:!1,ssend:!1,bondOrder:[]};t.icn3d.atoms[h]=S,l[h]=1,++h}}return t.setXyzAtomSeq(l,p,n,o),t.setMaxD(),t.showTitle(),!0},iCn3DUI.prototype.Dsn6Parser=function(e,t,i){var n,o=this;if(n="https://edmaps.rcsb.org/maps/"+e.toLowerCase()+"_"+t+".dsn6",bCid=void 0,"2fofc"==t&&o.bAjax2fofc)o.icn3d.mapData.sigma2=i,o.setOption("map",t);else if("fofc"==t&&o.bAjaxfofc)o.icn3d.mapData.sigma=i,o.setOption("map",t);else{var r=new XMLHttpRequest;r.open("GET",n,!0),r.responseType="arraybuffer",r.onreadystatechange=function(){if(4==this.readyState){if(o.hideLoading(),200==this.status){var e=r.response;o.loadDsn6Data(e,t,i),"2fofc"==t?o.bAjax2fofc=!0:"fofc"==t&&(o.bAjaxfofc=!0),o.setOption("map",t)}else alert("RCSB server has no corresponding eletron density map for this structure.");void 0!==o.deferredMap&&o.deferredMap.resolve()}else o.showLoading()},r.send()}},iCn3DUI.prototype.loadDsn6Data=function(e,t,i){var n,o,r=this,s=1,a={},c=e.buffer&&e.buffer instanceof ArrayBuffer?e.buffer:e,d=new Int16Array(c),l=new Uint8Array(c),p=String.fromCharCode.apply(null,l.subarray(0,512));if(0==p.indexOf(":-)"))a.xStart=parseInt(p.substr(10,5)),a.yStart=parseInt(p.substr(15,5)),a.zStart=parseInt(p.substr(20,5)),a.xExtent=parseInt(p.substr(32,5)),a.yExtent=parseInt(p.substr(38,5)),a.zExtent=parseInt(p.substr(42,5)),a.xRate=parseInt(p.substr(52,5)),a.yRate=parseInt(p.substr(58,5)),a.zRate=parseInt(p.substr(62,5)),a.xlen=parseFloat(p.substr(73,10))*s,a.ylen=parseFloat(p.substr(83,10))*s,a.zlen=parseFloat(p.substr(93,10))*s,a.alpha=parseFloat(p.substr(103,10)),a.beta=parseFloat(p.substr(113,10)),a.gamma=parseFloat(p.substr(123,10)),n=parseFloat(p.substr(138,12))/100,o=parseInt(p.substr(155,8)),a.sigma=100*parseFloat(p.substr(170,12));else{if(100!==d[18])for(var h=0,u=d.length;h<u;++h){var m=d[h];d[h]=(255&m)<<8|m>>8&255}a.zStart=d[2],a.xStart=d[0],a.yStart=d[1],a.xExtent=d[3],a.yExtent=d[4],a.zExtent=d[5],a.xRate=d[6],a.yRate=d[7],a.zRate=d[8];var f=1/d[17],v=f*s;a.xlen=d[9]*v,a.ylen=d[10]*v,a.zlen=d[11]*v,a.alpha=d[12]*f,a.beta=d[13]*f,a.gamma=d[14]*f,n=d[15]/100,o=d[16]}for(var g=new Float32Array(a.xExtent*a.yExtent*a.zExtent),b=512,y=Math.ceil(a.xExtent/8),_=Math.ceil(a.yExtent/8),w=Math.ceil(a.zExtent/8),C=0;C<w;++C)for(var S=0;S<_;++S)for(var A=0;A<y;++A)for(var k=0;k<8;++k)for(var E=8*C+k,x=0;x<8;++x)for(var R=8*S+x,h=0;h<8;++h){var T=8*A+h;if(!(T<a.xExtent&&R<a.yExtent&&E<a.zExtent)){b+=8-h;break}var H=(T*a.yExtent+R)*a.zExtent+E;g[H]=(l[b]-o)/n,++b}"2fofc"==t?(r.icn3d.mapData.header2=a,r.icn3d.mapData.data2=g,r.icn3d.mapData.matrix2=r.getMatrix(a),r.icn3d.mapData.type2=t,r.icn3d.mapData.sigma2=i):(r.icn3d.mapData.header=a,r.icn3d.mapData.data=g,r.icn3d.mapData.matrix=r.getMatrix(a),r.icn3d.mapData.type=t,r.icn3d.mapData.sigma=i)},iCn3DUI.prototype.getMatrix=function(e){var t=e,i=[t.xlen,0,0],n=[t.ylen*Math.cos(Math.PI/180*t.gamma),t.ylen*Math.sin(Math.PI/180*t.gamma),0],o=[t.zlen*Math.cos(Math.PI/180*t.beta),t.zlen*(Math.cos(Math.PI/180*t.alpha)-Math.cos(Math.PI/180*t.gamma)*Math.cos(Math.PI/180*t.beta))/Math.sin(Math.PI/180*t.gamma),0];o[2]=Math.sqrt(t.zlen*t.zlen*Math.sin(Math.PI/180*t.beta)*Math.sin(Math.PI/180*t.beta)-o[1]*o[1]);var r=[[],i,n,o],s=[0,t.xRate,t.yRate,t.zRate],a=[0,1,2,3],c=new THREE.Matrix4;return c.set(r[a[1]][0]/s[a[1]],r[a[2]][0]/s[a[2]],r[a[3]][0]/s[a[3]],0,r[a[1]][1]/s[a[1]],r[a[2]][1]/s[a[2]],r[a[3]][1]/s[a[3]],0,r[a[1]][2]/s[a[1]],r[a[2]][2]/s[a[2]],r[a[3]][2]/s[a[3]],0,0,0,0,1),c.multiply((new THREE.Matrix4).makeTranslation(t.xStart,t.yStart,t.zStart)),c},iCn3DUI.prototype.DensityCifParser=function(e,t,i,n){var o,r=this,s=r.isMobile()?0:4;if("2fofc"==t||"fofc"==t?o="https://www.ebi.ac.uk/pdbe/densities/x-ray/"+e.toLowerCase()+"/cell?detail="+s:"em"==t&&(o="https://www.ebi.ac.uk/pdbe/densities/emd/"+n.toLowerCase()+"/cell?detail="+s),bCid=void 0,"2fofc"==t&&r.bAjax2fofc)r.icn3d.mapData.sigma2=i,r.setOption("map",t);else if("fofc"==t&&r.bAjaxfofc)r.icn3d.mapData.sigma=i,r.setOption("map",t);else if("em"==t&&r.bAjaxEm)r.icn3d.mapData.sigmaEm=i,r.setOption("emmap",t);else{var a=new XMLHttpRequest;a.open("GET",o,!0),a.responseType="arraybuffer",a.onreadystatechange=function(){if(4==this.readyState){if(r.hideLoading(),200==this.status){var e=a.response;r.parseChannels(e,t,i),"2fofc"==t||"fofc"==t?(r.bAjax2fofc=!0,r.bAjaxfofc=!0,r.setOption("map",t)):"em"==t&&(r.bAjaxEm=!0,r.setOption("emmap",t))}else"2fofc"==t||"fofc"==t?alert("Density server at EBI has no corresponding electron density map for this structure."):"em"==t&&alert("Density server at EBI has no corresponding EM density map for this structure.");void 0!==r.deferredEmmap&&r.deferredEmmap.resolve()}else r.showLoading()},a.send()}},iCn3DUI.prototype.parseChannels=function(e,t,i){var n=this,o=n.BinaryParse(e);if("2fofc"==t||"fofc"==t){var r=n.getChannel(o,"2FO-FC"),s=n.getChannel(o,"FO-FC"),a=r,c=a.box.sampleCount,d={xExtent:c[0],yExtent:c[1],zExtent:c[2],mean:a.valuesInfo.mean,sigma:a.valuesInfo.sigma};n.icn3d.mapData.header2=d,n.icn3d.mapData.data2=a.data;var l=a.box.origin,p=a.box.dimensions,h=a.spacegroup.basis,u=(new THREE.Matrix4).makeScale(p[0]/c[0],p[1]/c[1],p[2]/c[2]),m=(new THREE.Matrix4).makeTranslation(l[0],l[1],l[2]),f=(new THREE.Matrix4).set(h.x[0],h.y[0],h.z[0],0,0,h.y[1],h.z[1],0,0,0,h.z[2],0,0,0,0,1),v=f.multiply(m).multiply(u);n.icn3d.mapData.matrix2=v,n.icn3d.mapData.type2=t,n.icn3d.mapData.sigma2=i;var a=s,c=a.box.sampleCount,d={xExtent:c[0],yExtent:c[1],zExtent:c[2],mean:a.valuesInfo.mean,sigma:a.valuesInfo.sigma};n.icn3d.mapData.header=d,n.icn3d.mapData.data=a.data;var l=a.box.origin,p=a.box.dimensions,h=a.spacegroup.basis,u=(new THREE.Matrix4).makeScale(p[0]/c[0],p[1]/c[1],p[2]/c[2]),m=(new THREE.Matrix4).makeTranslation(l[0],l[1],l[2]),f=(new THREE.Matrix4).set(h.x[0],h.y[0],h.z[0],0,0,h.y[1],h.z[1],0,0,0,h.z[2],0,0,0,0,1),v=f.multiply(m).multiply(u);n.icn3d.mapData.matrix=v,n.icn3d.mapData.type=t,n.icn3d.mapData.sigma=i}else if("em"==t){var a=n.getChannel(o,"EM"),c=a.box.sampleCount,d={xExtent:c[0],yExtent:c[1],zExtent:c[2],max:a.valuesInfo.max,min:a.valuesInfo.min};n.icn3d.mapData.headerEm=d,n.icn3d.mapData.dataEm=a.data;var l=a.box.origin,p=a.box.dimensions,h=a.spacegroup.basis,u=(new THREE.Matrix4).makeScale(p[0]/c[0],p[1]/c[1],p[2]/c[2]),m=(new THREE.Matrix4).makeTranslation(l[0],l[1],l[2]),f=(new THREE.Matrix4).set(h.x[0],h.y[0],h.z[0],0,0,h.y[1],h.z[1],0,0,0,h.z[2],0,0,0,0,1),v=f.multiply(m).multiply(u);n.icn3d.mapData.matrixEm=v,n.icn3d.mapData.typeEm=t,n.icn3d.mapData.sigmaEm=i}},iCn3DUI.prototype.getChannel=function(e,t){for(var i,n=this,o=e.toJSON(),r=0,s=o.length;r<s;++r)o[r].id==t&&(i=e.dataBlocks[r]);var a=n.CIFParse(i);return a},iCn3DUI.prototype.CIFParse=function(e){function t(e){for(var t=[0,0,0],i=0;i<3;i++)t[i]=s.getColumn(e+"["+i+"]").getFloat(0);return t}function i(e){return s.getColumn(e).getFloat(0)}function n(e){return[e[c[0]],e[c[1]],e[c[2]]]}function o(e,t,i,n){for(var o=new Float32Array(t[0]*t[1]*t[2]),r=[0,0,0],s=n[0],a=n[1],c=n[2],d=i[0],l=i[1],p=i[2],h=(t[0],t[0]*t[1],t[2]),u=t[1]*t[2],m=0,f=e.getFloat(0),v=f,g=0;g<p;g++){r[2]=g;for(var b=0;b<l;b++){r[1]=b;for(var y=0;y<d;y++){r[0]=y;var _=e.getFloat(m);m+=1,o[r[c]+r[a]*h+r[s]*u]=_,_<f?f=_:_>v&&(v=_)}}}return{data:o,min:f,max:v}}function r(e,t,i){var n=Math.PI/180*i[0],o=Math.PI/180*i[1],r=Math.PI/180*i[2],s=t[0],a=t[1],c=t[2],d=Math.cos(o),l=(Math.cos(n)-Math.cos(o)*Math.cos(r))/Math.sin(r),p=Math.sqrt(1-d*d-l*l),h=[s,0,0],u=[Math.cos(r)*a,Math.sin(r)*a,0],m=[d*c,l*c,p*c];return{number:e,size:t,angles:i,basis:{x:h,y:u,z:m}}}var s=e.getCategory("_volume_data_3d_info");if(!s)return void conole.log("_volume_data_3d_info category is missing.");if(!e.getCategory("_volume_data_3d"))return void conole.log("_volume_data_3d category is missing.");var a={name:s.getColumn("name").getString(0),axisOrder:t("axis_order"),origin:t("origin"),dimensions:t("dimensions"),sampleCount:t("sample_count"),spacegroupNumber:0|i("spacegroup_number"),cellSize:t("spacegroup_cell_size"),cellAngles:t("spacegroup_cell_angles"),mean:i("mean_sampled"),sigma:i("sigma_sampled")},c=[0,0,0];c[a.axisOrder[0]]=0,c[a.axisOrder[1]]=1,c[a.axisOrder[2]]=2;var d=n(a.sampleCount),l=o(e.getCategory("_volume_data_3d").getColumn("values"),d,a.sampleCount,c),p={name:a.name,spacegroup:r(a.spacegroupNumber,a.cellSize,a.cellAngles),box:{origin:n(a.origin),dimensions:n(a.dimensions),sampleCount:d},data:l.data,valuesInfo:{min:l.min,max:l.max,mean:a.mean,sigma:a.sigma}};return p},iCn3DUI.prototype.BinaryParse=function(e){function t(e,t){switch(e){case 1:return new Int8Array(t);case 2:return new Int16Array(t);case 3:return new Int32Array(t);case 4:return new Uint8Array(t);case 5:return new Uint16Array(t);case 6:return new Uint32Array(t);default:throw new Error("Unsupported integer data type.")}}function i(e,t){switch(e){case 32:return new Float32Array(t);case 33:return new Float64Array(t);default:throw new Error("Unsupported floating data type.")}}function n(e){return new Int8Array(e.buffer,e.byteOffset)}function o(e,t){for(var i=new ArrayBuffer(e.length),n=new Uint8Array(i),o=0,r=e.length;o<r;o+=t)for(var s=0;s<t;s++)n[o+t-s-1]=e[o+s];return i}function r(e,t,i){return new i(H?e.buffer:o(e,t))}function s(e){return r(e,2,Int16Array)}function a(e){return r(e,2,Uint16Array)}function c(e){return r(e,4,Int32Array)}function d(e){return r(e,4,Uint32Array)}function l(e){return r(e,4,Float32Array)}function p(e){return r(e,8,Float64Array)}function h(e,t){for(var n=e.length,o=i(t.srcType,n),r=1/t.factor,s=0;s<n;s++)o[s]=r*e[s];return o}function u(e,t){for(var n=e.length,o=i(t.srcType,n),r=(t.max-t.min)/(t.numSteps-1),s=t.min,a=0;a<n;a++)o[a]=s+r*e[a];return o}function m(e,i){for(var n=t(i.srcType,i.srcSize),o=0,r=0,s=e.length;r<s;r+=2)for(var a=e[r],c=e[r+1],d=0;d<c;++d)n[o++]=a;return n}function f(e,i){var n=e.length,o=t(i.srcType,n);if(!n)return o;o[0]=e[0]+(0|i.origin);for(var r=1;r<n;++r)o[r]=e[r]+o[r-1];return o}function v(e,t){for(var i=1===t.byteCount?127:32767,n=-i-1,o=e.length,r=new Int32Array(t.srcSize),s=0,a=0;s<o;){for(var c=0,d=e[s];d===i||d===n;)c+=d,s++,d=e[s];c+=d,r[a]=c,s++,a++}return r}function g(e,t){for(var i=1===t.byteCount?255:65535,n=e.length,o=new Int32Array(t.srcSize),r=0,s=0;r<n;){for(var a=0,c=e[r];c===i;)a+=c,r++,c=e[r];a+=c,o[s]=a,r++,s++}return o}function b(e,t){return t.isUnsigned?g(e,t):v(e,t)}function y(e,t){for(var i=t.stringData,n=w({encoding:t.offsetEncoding,data:t.offsets}),o=w({encoding:t.dataEncoding,data:e}),r=Object.create(null),s=new Array(o.length),a=0,c=0,d=o;c<d.length;c++){var l=d[c];if(l<0)s[a++]=null;else{var p=r[l];void 0===p&&(p=i.substring(n[l],n[l+1]),r[l]=p),s[a++]=p}}return s}function _(e,t){switch(t.kind){case"ByteArray":switch(t.type){case 4:return e;case 1:return n(e);case 2:return s(e);case 5:return a(e);case 3:return c(e);case 6:return d(e);case 32:return l(e);case 33:return p(e);default:throw new Error("Unsupported ByteArray type.")}case"FixedPoint":return h(e,t);case"IntervalQuantization":return u(e,t);case"RunLength":return m(e,t);case"Delta":return f(e,t);case"IntegerPacking":return b(e,t);case"StringArray":return y(e,t)}}function w(e){for(var t=e.data,i=e.encoding.length-1;i>=0;i--)t=_(t,e.encoding[i]);return t}function C(e){if(!e.data.data)return _UndefinedColumn;var t=w(e.data),i=void 0;return e.mask&&(i=w(e.mask)),t.buffer&&t.byteLength&&t.BYTES_PER_ELEMENT?i?new I(t,i):new D(t):i?new M(t,i):new O(t)}function S(e,t,i){var n=0,o=1;for(45===e.charCodeAt(t)&&(o=-1,t++);t<i;t++){var r=e.charCodeAt(t)-48;if(r>9||r<0)return o*n|0;n=10*n+r|0}return o*n}function A(e,t,i){var n=1,o=0,r=0,s=1;for(45===e.charCodeAt(t)&&(n=-1,++t);t<i;){var a=e.charCodeAt(t)-48;if(!(a>=0&&a<10)){if(a===-2){for(++t;t<i;){if(a=e.charCodeAt(t)-48,!(a>=0&&a<10))return 53===a||21===a?parseScientific(n*(o+r/s),e,t+1,i):n*(o+r/s);r=10*r+a,s=10*s,++t}return n*(o+r/s)}if(53===a||21===a)return parseScientific(n*o,e,t+1,i);break}o=10*o+a,++t}return n*o}var k=this,E=new Uint8Array(e),x=k.MessagePackParse({buffer:E,offset:0,dataView:new DataView(E.buffer)}),R=function(){function e(e){this.additionalData={},this.header=e.header,this.categoryList=e.categories.map(function(e){return new T(e)}),this.categoryMap=new Map;for(var t=0,i=this.categoryList;t<i.length;t++){var n=i[t];this.categoryMap.set(n.name,n)}}return Object.defineProperty(e.prototype,"categories",{get:function(){return this.categoryList},enumerable:!0,configurable:!0}),e.prototype.getCategory=function(e){return this.categoryMap.get(e)},e.prototype.toJSON=function(){return{id:this.header,categories:this.categoryList.map(function(e){return e.toJSON()}),additionalData:this.additionalData}},e}(),T=function(){function e(e){this.name=e.name,this.columnCount=e.columns.length,this.rowCount=e.rowCount,this.columnNameList=[],this.encodedColumns=new Map;for(var t=0,i=e.columns;t<i.length;t++){var n=i[t];this.encodedColumns.set(n.name,n),this.columnNameList.push(n.name)}}Object.defineProperty(e.prototype,"columnNames",{get:function(){return this.columnNameList},enumerable:!0,configurable:!0});var t=function(){function e(){this.isDefined=!1}return e.prototype.getString=function(e){return null},e.prototype.getInteger=function(e){return 0},e.prototype.getFloat=function(e){return 0},e.prototype.getValuePresence=function(e){return 1},e.prototype.areValuesEqual=function(e,t){return!0},e.prototype.stringEquals=function(e,t){return null===t},e}();return e.prototype.getColumn=function(e){var i=this.encodedColumns.get(e);return i?C(i):t},e.prototype.toJSON=function(){for(var e=this,t=[],i=this.columnNameList.map(function(t){return{name:t,column:e.getColumn(t)}}),n=0;n<this.rowCount;n++){for(var o={},r=0,s=i;r<s.length;r++){var a=s[r],c=a.column.getValuePresence(n);0===c?o[a.name]=a.column.getString(n):1===c?o[a.name]=".":o[a.name]="?"}t[n]=o}return{name:this.name,columns:this.columnNames,rows:t}},e}(),H=function(){var e=new ArrayBuffer(2),t=new Uint8Array(e),i=new Uint16Array(e);return t[0]=170,t[1]=187,48042===i[0]}(),D=function(){function e(e){this.data=e,this.isDefined=!0}return e.prototype.getString=function(e){return""+this.data[e]},e.prototype.getInteger=function(e){return 0|this.data[e]},e.prototype.getFloat=function(e){return 1*this.data[e]},e.prototype.stringEquals=function(e,t){return this.data[e]===A(t,0,t.length)},e.prototype.areValuesEqual=function(e,t){return this.data[e]===this.data[t]},e.prototype.getValuePresence=function(e){return 0},e}(),I=function(){function e(e,t){this.data=e,this.mask=t,this.isDefined=!0}return e.prototype.getString=function(e){return 0===this.mask[e]?""+this.data[e]:null},e.prototype.getInteger=function(e){return 0===this.mask[e]?this.data[e]:0},e.prototype.getFloat=function(e){return 0===this.mask[e]?this.data[e]:0},e.prototype.stringEquals=function(e,t){return 0===this.mask[e]?this.data[e]===A(t,0,t.length):null===t||void 0===t},e.prototype.areValuesEqual=function(e,t){return this.data[e]===this.data[t]},e.prototype.getValuePresence=function(e){return this.mask[e]},e}(),O=function(){function e(e){this.data=e,this.isDefined=!0}return e.prototype.getString=function(e){return this.data[e]},e.prototype.getInteger=function(e){var t=this.data[e];return S(t,0,t.length)},e.prototype.getFloat=function(e){var t=this.data[e];return A(t,0,t.length)},e.prototype.stringEquals=function(e,t){return this.data[e]===t},e.prototype.areValuesEqual=function(e,t){return this.data[e]===this.data[t]},e.prototype.getValuePresence=function(e){return 0},e}(),M=function(){function e(e,t){this.data=e,this.mask=t,this.isDefined=!0}return e.prototype.getString=function(e){return 0===this.mask[e]?this.data[e]:null},e.prototype.getInteger=function(e){if(0!==this.mask[e])return 0;var t=this.data[e];return S(t||"",0,(t||"").length)},e.prototype.getFloat=function(e){if(0!==this.mask[e])return 0;var t=this.data[e];return A(t||"",0,(t||"").length)},e.prototype.stringEquals=function(e,t){return this.data[e]===t},e.prototype.areValuesEqual=function(e,t){return this.data[e]===this.data[t]},e.prototype.getValuePresence=function(e){return this.mask[e]},e}(),L=function(){function e(e){this.dataBlocks=e.dataBlocks.map(function(e){return new R(e)})}return e.prototype.toJSON=function(){return this.dataBlocks.map(function(e){return e.toJSON()})},e}(),$=new L(x);return $},iCn3DUI.prototype.MessagePackParse=function(e){function t(e,t){for(var i={},n=0;n<t;n++){var o=c.MessagePackParse(e);i[o]=c.MessagePackParse(e)}return i}function i(e,t){for(var i=new Uint8Array(t),n=e.offset,o=0;o<t;o++)i[o]=e.buffer[o+n];return e.offset+=t,i}function n(e,t){for(var i=new Array(t),n=0;n<t;n++)i[n]=c.MessagePackParse(e);return i}function o(e,t){var i=r(e.buffer,e.offset,t);return e.offset+=t,i}function r(e,t,i){for(var n=d,o=void 0,r=[],s=512,a=0,c=t,l=t+i;c<l;c++){var p=e[c];0===(128&p)?r[a++]=n[p]:192===(224&p)?r[a++]=n[(15&p)<<6|63&e[++c]]:224===(240&p)?r[a++]=String.fromCharCode((15&p)<<12|(63&e[++c])<<6|(63&e[++c])<<0):240===(248&p)?r[a++]=String.fromCharCode((7&p)<<18|(63&e[++c])<<12|(63&e[++c])<<6|(63&e[++c])<<0):throwError("Invalid byte "+p.toString(16)),a===s&&(o=o||[],o[o.length]=r.join(""),a=0)}return o?(a>0&&(o[o.length]=r.slice(0,a).join("")),o.join("")):r.slice(0,a).join("")}var s,a,c=this,d=function(){for(var e=[],t=0;t<1024;t++)e[t]=String.fromCharCode(t);return e}(),l=e.buffer[e.offset];if(0===(128&l))return e.offset++,l;if(128===(240&l))return a=15&l,e.offset++,t(e,a);if(144===(240&l))return a=15&l,e.offset++,n(e,a);if(160===(224&l))return a=31&l,e.offset++,o(e,a);if(224===(224&l))return s=e.dataView.getInt8(e.offset),e.offset++,s;switch(l){case 192:return e.offset++,null;case 194:return e.offset++,!1;case 195:return e.offset++,!0;case 196:return a=e.dataView.getUint8(e.offset+1),e.offset+=2,i(e,a);case 197:return a=e.dataView.getUint16(e.offset+1),e.offset+=3,i(e,a);case 198:return a=e.dataView.getUint32(e.offset+1),e.offset+=5,i(e,a);case 202:return s=e.dataView.getFloat32(e.offset+1),e.offset+=5,s;case 203:return s=e.dataView.getFloat64(e.offset+1),e.offset+=9,s;case 204:return s=e.buffer[e.offset+1],e.offset+=2,s;case 205:return s=e.dataView.getUint16(e.offset+1),e.offset+=3,s;case 206:return s=e.dataView.getUint32(e.offset+1),e.offset+=5,s;case 208:return s=e.dataView.getInt8(e.offset+1),e.offset+=2,s;case 209:return s=e.dataView.getInt16(e.offset+1),e.offset+=3,s;case 210:return s=e.dataView.getInt32(e.offset+1),e.offset+=5,s;case 217:return a=e.dataView.getUint8(e.offset+1),e.offset+=2,o(e,a);case 218:return a=e.dataView.getUint16(e.offset+1),e.offset+=3,o(e,a);case 219:return a=e.dataView.getUint32(e.offset+1),e.offset+=5,o(e,a);case 220:return a=e.dataView.getUint16(e.offset+1),e.offset+=3,n(e,a);case 221:return a=e.dataView.getUint32(e.offset+1),e.offset+=5,n(e,a);case 222:return a=e.dataView.getUint16(e.offset+1),e.offset+=3,t(e,a);case 223:return a=e.dataView.getUint32(e.offset+1),e.offset+=5,t(e,a)}},iCn3DUI.prototype.showAnnotations=function(){var e=this;if(e.openDialog(e.pre+"dl_selectannotations","Sequences and Annotations"),(void 0===e.bAssemblyNote||!e.bAssemblyNote)&&void 0!==e.icn3d.asuCnt){var t="     <br><div id='"+e.pre+"assembly_note' style='margin-left:5px;'><span class='icn3d-annoLargeTitle'>Assembly Tips:</span> Only the asymmetric unit is shown in the sequence window.<br>Click \"Assembly\" in the menu \"View\" to switch between asymmetric unit and biological assembly (<b>"+e.icn3d.asuCnt+"</b> asymmetric unit).</div>";$("#"+e.pre+"dl_annotations_tabs").append(t),e.bAssemblyNote=!0}if(void 0===e.bAnnoShown||!e.bAnnoShown){var i=Object.keys(e.icn3d.chains);void 0===e.giSeq&&(e.giSeq={}),void 0===e.currClin&&(e.currClin={}),void 0===e.resi2disease_nonempty&&(e.resi2disease_nonempty={}),void 0===e.baseResi&&(e.baseResi={}),void 0===e.matchedPos&&(e.matchedPos={});var n=$("#"+e.pre+"dl_selectannotations").dialog("option","width");e.seqAnnWidth=n-120-60-50,e.maxAnnoLength=1;for(var o in e.icn3d.chainsSeq)e.icn3d.chainsSeq[o].length>e.maxAnnoLength&&(e.maxAnnoLength=e.icn3d.chainsSeq[o].length);var r={},s={},a={};e.protein_chainid={};for(var c=0,d=i.length;c<d;++c){var l,p=(Math.round(i[c].indexOf("_")),e.icn3d.getFirstCalphaAtomObj(e.icn3d.chains[i[c]])),h=i[c].substr(i[c].indexOf("_")+1);if(h.indexOf("_")!==-1?(h=h.substr(0,h.indexOf("_")),l=i[c].substr(0,i[c].indexOf("_"))+"_"+h):l=i[c],e.icn3d.proteins.hasOwnProperty(p.serial))e.protein_chainid[i[c]]=l;else if(e.icn3d.nucleotides.hasOwnProperty(p.serial))r[i[c]]=l;else if(e.icn3d.chainsSeq[i[c]].length>1)s[i[c]]=l;else{var u=e.icn3d.chainsSeq[i[c]][0].name,m=i[c]+"_"+e.icn3d.chainsSeq[i[c]][0].resi;void 0===a[u]&&(a[u]=[]),a[u].push(m)}if((void 0!==e.cfg.pdbid||void 0!==e.cfg.mmcifid||void 0!==e.cfg.mmtfid)&&(e.icn3d.proteins.hasOwnProperty(p.serial)||e.icn3d.nucleotides.hasOwnProperty(p.serial)))for(var f=0,v=e.icn3d.chainsSeq[i[c]].length;f<v;++f){var g=e.icn3d.chainsSeq[i[c]][f];if(""!==g.name&&"-"!==g.name&&g.name==g.name.toUpperCase()){var m=i[c]+"_"+g.resi,p=e.icn3d.getFirstCalphaAtomObj(e.icn3d.residues[m]);if(e.icn3d.proteins.hasOwnProperty(p.serial)||e.icn3d.nucleotides.hasOwnProperty(p.serial))continue;var u=g.name.trim();void 0===a[u]&&(a[u]=[]),a[u].push(m)}}}if(void 0===e.cfg.blast_rep_id){if(e.bFullUi)if(void 0!==e.cfg.mmtfid){var b=i[0].substr(0,i[0].indexOf("_"));$.when(e.downloadMmcifSymmetry(b,"mmtfid")).then(function(){e.showAnnoSeqData(r,s,a)})}else e.showAnnoSeqData(r,s,a)}else if(void 0!==e.cfg.blast_rep_id){var y="https://www.ncbi.nlm.nih.gov/Structure/pwaln/pwaln.fcgi?from=querytarget",_={targets:e.cfg.blast_rep_id,queries:e.cfg.query_id};if(void 0!==e.cfg.query_from_to){for(var w=e.cfg.query_from_to.split(":"),c=0,d=w.length;c<d;++c)w[c]=parseInt(w[c])-1;_.queries=e.cfg.query_id+":"+w.join(":")}if(void 0!==e.cfg.target_from_to){for(var C=e.cfg.target_from_to.split(":"),c=0,d=C.length;c<d;++c)C[c]=parseInt(C[c])-1;_.targets=e.cfg.blast_rep_id+":"+C.join(":")}$.ajax({url:y,type:"POST",data:_,dataType:"jsonp",tryCount:0,retryLimit:1,success:function(t){e.seqStructAlignData=t,e.showAnnoSeqData(r,s,a)},error:function(e,t,i){if(this.tryCount++,this.tryCount<=this.retryLimit)return void $.ajax(this)}})}}e.bAnnoShown=!0},iCn3DUI.prototype.showAnnoSeqData=function(e,t,i){var n=this;n.getAnnotationData();var o=0;for(var r in e)n.getSequenceData(r,e[r],"nucleotide",o),++o;n.interactChainChainbase=n.icn3d.unionHash(n.protein_chainid,e),o=0;for(var r in t)n.getSequenceData(r,t[r],"chemical",o),++o;n.interactChainChainbase=n.icn3d.unionHash(n.interactChainChainbase,t),n.ssbondChainChainbase=n.icn3d.unionHash(n.protein_chainid,t);for(var s in i)n.getCombinedSequenceData(s,i[s],o),++o;n.enableHlSeq(),setTimeout(function(){n.hideAllAnno(),n.clickCdd()},0)},iCn3DUI.prototype.enableHlSeq=function(){var e=this;e.isMobile()?(e.selectSequenceMobile(),e.selectChainMobile()):e.selectSequenceNonMobile(),Object.keys(e.icn3d.hAtoms).length<Object.keys(e.icn3d.dAtoms).length&&e.updateHlSeq()},iCn3DUI.prototype.updateSnpClinvar=function(){var e=this;if(void 0===e.bSnpClinvarShown||!e.bSnpClinvarShown)for(var t in e.protein_chainid){var i=e.protein_chainid[t];e.showSnpClinvar(t,i)}e.bSnpClinvarShown=!0},iCn3DUI.prototype.updateDomain=function(){var e=this;void 0!==e.bDomainShown&&e.bDomainShown||e.showDomainAll(),e.bDomainShown=!0},iCn3DUI.prototype.updateInteraction=function(){var e=this;if(void 0===e.bInteractionShown||!e.bInteractionShown)for(var t in e.interactChainChainbase){var i=e.interactChainChainbase[t];e.showInteraction(t,i)}e.bInteractionShown=!0},iCn3DUI.prototype.updateSsbond=function(){var e=this;if(void 0===e.bSSbondShown||!e.bSSbondShown)for(var t in e.ssbondChainChainbase){var i=e.interactChainChainbase[t];e.showSsbond(t,i)}e.bSSbondShown=!0},iCn3DUI.prototype.getAnDiv=function(e,t){var i=this,n="Loading "+t+"...";return"custom"==t?n="":"domain"==t&&(n="Loading 3D "+t+"..."),"<div id='"+i.pre+t+"_"+e+"'><div id='"+i.pre+"tt_"+t+"_"+e+"' class='icn3d-fixed-pos' style='display:none!important'></div><div id='"+i.pre+"dt_"+t+"_"+e+"' style='display:none'>"+n+"</div><div id='"+i.pre+"ov_"+t+"_"+e+"'>"+n+"</div></div>"},iCn3DUI.prototype.addButton=function(e,t,i,n,o,r){return"<div class='"+t+"' chainid='"+e+"' style='display:inline-block; font-size:11px; font-weight:bold; width:"+o+"px!important;'><button style='-webkit-appearance:"+r+"; height:18px; width:"+o+"px;'><span style='white-space:nowrap; margin-left:-3px;' title='"+n+"'>"+i+"</span></button></div>"},iCn3DUI.prototype.conservativeReplacement=function(e,t){var i=this,n=i.b62ResArray.indexOf(e)!==-1?i.b62ResArray.indexOf(e):i.b62ResArray.length-1,o=i.b62ResArray.indexOf(t)!==-1?i.b62ResArray.indexOf(t):i.b62ResArray.length-1,r=i.b62Matrix[n][o];return r>0},iCn3DUI.prototype.getColorhexFromBlosum62=function(e,t){var i=this,n=i.b62ResArray.indexOf(e)!==-1?i.b62ResArray.indexOf(e):i.b62ResArray.length-1,o=i.b62ResArray.indexOf(t)!==-1?i.b62ResArray.indexOf(t):i.b62ResArray.length-1,r=i.b62Matrix[n][o];if(void 0===r)return"333333";var s="333333";if(r>0){var a=221-parseInt(r/11*221),c=a<10?"0"+a.toString(16):a.toString(16);s="DD"+c+c}else{var a=221-parseInt(-1*r/4*221),c=a<10?"0"+a.toString(16):a.toString(16);s=c+c+"DD"}return s},iCn3DUI.prototype.getAnnotationData=function(){var e=this,t=$.map(e.protein_chainid,function(e){return e}),i=0;for(var n in e.protein_chainid){var o=e.isMobile()?"none":"button",r=e.getProteinName(n),s=r,a=0==i?"<span class='icn3d-annoLargeTitle'><b>Proteins</b>: </span><br><br>":"",c=e.icn3d.chainsGene[n]&&e.icn3d.chainsGene[n].geneId?" (Gene: <a href='https://www.ncbi.nlm.nih.gov/gene/"+e.icn3d.chainsGene[n].geneId+"' target='_blank' title='"+e.icn3d.chainsGene[n].geneDesc+"'>"+e.icn3d.chainsGene[n].geneSymbol+"</a>)":"",d="<div id='"+e.pre+"anno_"+n+"' class='icn3d-annotation'>"+a+"<span style='font-weight:bold;'>Annotations of "+n+"</span>: <a class='icn3d-blue' href='https://www.ncbi.nlm.nih.gov/protein?term="+n+"' target='_blank' title='"+r+"'>"+s+"</a>"+c+"&nbsp;&nbsp;&nbsp;"+e.addButton(n,"icn3d-addtrack","Add Track","Add a custom track",60,o)+"&nbsp;&nbsp;&nbsp;"+e.addButton(n,"icn3d-helixsets","Helix Sets",'Define sets for each helix in this chain and add them to the menu of "Defined Sets"',60,o)+"&nbsp;"+e.addButton(n,"icn3d-sheetsets","Sheet Sets",'Define sets for each sheet in this chain and add them to the menu of "Defined Sets"',60,o)+"&nbsp;"+e.addButton(n,"icn3d-coilsets","Coil Sets",'Define sets for each coil in this chain and add them to the menu of "Defined Sets"',60,o);$("#"+e.pre+"dl_annotations").append(d),$("#"+e.pre+"anno_"+n).append(e.getAnDiv(n,"giseq")),$("#"+e.pre+"anno_"+n).append(e.getAnDiv(n,"cdd")),$("#"+e.pre+"anno_"+n).append(e.getAnDiv(n,"clinvar")),$("#"+e.pre+"anno_"+n).append(e.getAnDiv(n,"snp")),$("#"+e.pre+"anno_"+n).append(e.getAnDiv(n,"domain")),$("#"+e.pre+"anno_"+n).append(e.getAnDiv(n,"site")),$("#"+e.pre+"anno_"+n).append(e.getAnDiv(n,"interaction")),$("#"+e.pre+"anno_"+n).append(e.getAnDiv(n,"custom")),$("#"+e.pre+"anno_"+n).append(e.getAnDiv(n,"ssbond")),$("#"+e.pre+"anno_"+n).append("<br><hr><br>"),++i}e.setToolTip(),e.chain2gi={};var l="https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?db=protein&retmode=json&id="+t;$.ajax({url:l,dataType:"json",cache:!0,tryCount:0,retryLimit:1,success:function(t){for(var i in t.result)"uids"!==i&&(e.chain2gi[t.result[i].caption]=i)},error:function(e,t,i){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}});var p="https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=protein&retmode=json&rettype=fasta&id="+t;$.ajax({url:p,dataType:"text",cache:!0,tryCount:0,retryLimit:1,success:function(t){for(var i=t.split("\n\n"),n={},o=0,r=i.length;o<r;++o){var s=i[o].split("\n");if(s.length>0){var a=s[0],c=a.split(" "),d=c[0].split("|"),l=d[1]+"_"+d[2];s.shift();var p=s.join("");n[l]=p}}for(var h in e.protein_chainid){var u=e.protein_chainid[h];if(n.hasOwnProperty(h)){var p=n[h];e.giSeq[h]=p;for(var m="",o=0;o<10&&o<e.icn3d.chainsSeq[h].length;++o)m+=e.icn3d.chainsSeq[h][o].name.substr(0,1);var f=p.toLowerCase().indexOf(m.toLowerCase());f==-1?(console.log("The gi sequence didn't match the protein sequence. The start of 3D protein sequence: "+m+". The gi sequence: "+p.substr(0,10)+"."),e.setAlternativeSeq(h,u)):(e.matchedPos[h]=f,e.baseResi[h]=e.icn3d.chainsSeq[h][0].resi-e.matchedPos[h]-1)}else console.log("No data were found for the protein "+h+"..."),e.setAlternativeSeq(h,u);if(e.cfg.blast_rep_id!=h)e.showSeq(h,u);else if(e.cfg.blast_rep_id==h&&void 0===e.seqStructAlignData.data){var a;a=e.cfg.query_id.length>14?"Query: "+e.cfg.query_id.substr(0,6):isNaN(e.cfg.query_id)?"Query: "+e.cfg.query_id:"Query: gi "+e.cfg.query_id,D=void 0,y=void 0;var v="cannot be aligned";e.queryStart="",e.queryEnd="",alert("The sequence can NOT be aligned to the structure"),e.showSeq(h,u,void 0,a,D,v,y)}else if(e.cfg.blast_rep_id==h&&void 0!==e.seqStructAlignData.data){var a;a=e.cfg.query_id.length>14?"Query: "+e.cfg.query_id.substr(0,6):isNaN(e.cfg.query_id)?"Query: "+e.cfg.query_id:"Query: gi "+e.cfg.query_id;var g,b,t=e.seqStructAlignData;void 0!==t.data&&(g=t.data[0].query,b=t.data[0].targets[h.replace(/_/g,"")],b=b.hsps.length>0?b.hsps[0]:void 0);var v="",y="";if(e.queryStart="",e.queryEnd="",void 0!==g&&void 0!==b){var _=b.scores.e_value.toPrecision(2);_>1e-200&&(_=parseFloat(_).toExponential());var w=(b.scores.bit_score,t.targets[h.replace(/_/g,"")].seqdata),C=g.seqdata,S=b.segs,A={};e.targetGapHash={},e.fullpos2ConsTargetpos={},e.consrvResPosArray=[];var k=0,E=0;e.nTotalGap=0,e.queryStart=S[0].from+1,e.queryEnd=S[S.length-1].to+1;for(var o=0,r=S.length;o<r;++o){var x=S[o];if(o>0)if(x.orifrom-k<x.from-E)e.targetGapHash[x.orifrom]={from:E+1,to:x.from-1},e.nTotalGap+=e.targetGapHash[x.orifrom].to-e.targetGapHash[x.orifrom].from+1;else if(x.orifrom-k>x.from-E)for(var R=k+1;R<x.orifrom;++R)A[R]=-1;for(var R=0;R<=x.orito-x.orifrom;++R)A[R+x.orifrom]=R+x.from;k=x.orito,E=x.to}var T=0;e.icn3d.alnChainsSeq[h]=[];for(var o=0,r=w.length;o<r;++o){if(e.targetGapHash.hasOwnProperty(o))for(var R=e.targetGapHash[o].from;R<=e.targetGapHash[o].to;++R)v+=C[R];if(y+=e.insertGap(h,o,"-",!0),e.targetGapHash.hasOwnProperty(o)&&(T+=e.targetGapHash[o].to-e.targetGapHash[o].from+1),A.hasOwnProperty(o)&&A[o]!==-1){v+=C[A[o]];var H=e.getColorhexFromBlosum62(w[o],C[A[o]]);w[o]==C[A[o]]?(y+=w[o],e.fullpos2ConsTargetpos[o+T]={same:1,pos:o+1,res:w[o],color:H},e.consrvResPosArray.push(o+1),e.icn3d.alnChainsSeq[h].push({resi:o+1,color:"#FF0000",color2:"#"+H})):e.conservativeReplacement(w[o],C[A[o]])?(y+="+",e.fullpos2ConsTargetpos[o+T]={same:0,pos:o+1,res:w[o],color:H},e.consrvResPosArray.push(o+1),e.icn3d.alnChainsSeq[h].push({resi:o+1,color:"#0000FF",color2:"#"+H})):(y+=" ",e.fullpos2ConsTargetpos[o+T]={same:-1,pos:o+1,res:w[o],color:H},e.icn3d.alnChainsSeq[h].push({resi:o+1,color:e.GREYC,
color2:"#"+H}))}else v+="-",y+=" "}}else v+="cannot be aligned",alert("The sequence can NOT be aligned to the structure");var D="BLAST, E: "+_;e.showSeq(h,u,void 0,a,D,v,y);var I,O={};if(void 0!==e.consrvResPosArray)for(var o=0,r=e.consrvResPosArray.length;o<r;++o)I=u+"_"+e.consrvResPosArray[o],O[I]=1;e.selectResidueList(O,"aligned_protein",D,!1)}}e.enableHlSeq(),e.showCddSiteAll()},error:function(i,n,o){if(this.tryCount++,this.tryCount<=this.retryLimit)return void $.ajax(this);e.enableHlSeq(),console.log("No data were found for the protein "+t+"...");for(var r in e.protein_chainid){var s=e.protein_chainid[r];e.setAlternativeSeq(r,s),e.showSeq(r,s)}e.showCddSiteAll()}})},iCn3DUI.prototype.setAlternativeSeq=function(e,t){var i=this,n=i.icn3d.chainsSeq[e];i.giSeq[e]=[];for(var o=0,r=n.length;o<r;++o){var s=n[o].name;i.giSeq[e][o]=s}i.matchedPos[e]=0,i.baseResi[e]=i.icn3d.chainsSeq[e][0].resi-i.matchedPos[e]-1},iCn3DUI.prototype.getProteinName=function(e){var t=this,i="";if(void 0===t.cfg.mmdbid&&void 0===t.cfg.gi&&void 0===t.cfg.blast_rep_id||void 0===t.mmdb_data)void 0!==t.cfg.align&&void 0!==t.chainid2title&&void 0!==t.chainid2title[e]&&(i=t.chainid2title[e]);else{var n=t.mmdb_data.moleculeInfor,o=e.substr(e.indexOf("_")+1);for(var r in n)if(n[r].chain==o){i=n[r].name.replace(/\'/g,"&prime;"),proteinName=i;break}}return i},iCn3DUI.prototype.getSequenceData=function(e,t,i,n){var o=this,r=o.getProteinName(e),s=r;s.length>40&&(s=s.substr(0,40)+"...");var a="";0==n&&("protein"==i?a="<span class='icn3d-annoLargeTitle'><b>Proteins</b>: </span><br><br>":"nucleotide"==i?a="<span class='icn3d-annoLargeTitle'><b>Nucleotides</b>: </span><br><br>":"chemical"==i&&(a="<span class='icn3d-annoLargeTitle'><b>Chemicals/Ions/Water</b>: </span><br><br>")),$("#"+o.pre+"dl_annotations").append("<div id='"+o.pre+"anno_"+e+"' class='icn3d-annotation'>"+a+"<b>"+e+"</b>: <span title='"+r+"'>"+s+"</span> </div>"),$("#"+o.pre+"anno_"+e).append(o.getAnDiv(e,"giseq")),$("#"+o.pre+"anno_"+e).append(o.getAnDiv(e,"interaction")),$("#"+o.pre+"anno_"+e).append("<br><hr><br>"),o.giSeq[e]=[];for(var c=0;c<o.icn3d.chainsSeq[e].length;++c){var d=o.icn3d.chainsSeq[e][c].name;o.giSeq[e][c]=d}o.matchedPos[e]=0,o.baseResi[e]=o.icn3d.chainsSeq[e][0].resi-o.matchedPos[e]-1,o.showSeq(e,t,i)},iCn3DUI.prototype.getCombinedSequenceData=function(e,t,i){var n,o=this,r=0==i?"<span class='icn3d-annoLargeTitle'><b>Chemicals/Ions/Water</b>: </span><br><br>":"",s=t[0].lastIndexOf("_"),a=t[0].substr(0,s),c=void 0!==o.cfg.mmdbid?o.chainid2sid[a]:void 0;n=void 0!==c?"<b><a class='icn3d-blue' href='https://pubchem.ncbi.nlm.nih.gov/substance/"+c+"#section=2D-Structure' target='_blank'>"+e+" <img src='https://pubchem.ncbi.nlm.nih.gov/image/imgsrv.fcgi?sid="+c+"'></a></b>":"<b>"+e+"</b>",$("#"+o.pre+"dl_annotations").append("<div id='"+o.pre+"anno_"+e+"' class='icn3d-annotation'>"+r+n+"</div>"),$("#"+o.pre+"anno_"+e).append("<div id='"+o.pre+"giseq_"+e+"'><div id='"+o.pre+"dt_giseq_"+e+"' style='display:none'></div><div id='"+o.pre+"ov_giseq_"+e+"'></div></div>"),$("#"+o.pre+"anno_"+e).append("<br><hr><br>");var d='<div id="'+o.pre+'giseq_sequence" class="icn3d-dl_sequence">',l="Chem.",p="Chemical";d+='<div class="icn3d-seqTitle" anno="sequence"><span style="white-space:nowrap;" title="'+p+" "+e+'">'+l+" "+e+"</span></div>",d+='<span class="icn3d-residueNum" style="width:60px!important;" title="starting protein sequence number">Count: '+t.length+"</span>",d+='<span class="icn3d-seqLine">';for(var h=d,u=d,m=0,f=t.length;m<f;++m){var v=e,g=v;v.length>3&&(g=v.substr(0,3)),m<t.length-1&&(g+=",");var b=t[m],y=b.substr(b.lastIndexOf("_")+1);h+='<span id="giseq_'+o.pre+b+'" title="'+v+y+'" class="icn3d-residue icn3d-chemical">'+g+"</span>"}var _=o.GREY8,w=Math.round(o.seqAnnWidth*t.length/o.maxAnnoLength);w<1&&(w=1),u+='<div class="icn3d-seqTitle" style="display:inline-block; color:white; font-weight:bold; background-color:'+_+"; width:"+w+'px;">&nbsp;</div>',d="</span>",d+="<br>",d+="</div>",h+=d,u+=d,$("#"+o.pre+"dt_giseq_"+e).html(h),$("#"+o.pre+"ov_giseq_"+e).html(u)},iCn3DUI.prototype.insertGap=function(e,t,i,n){var o=this,r="";if(o.cfg.blast_rep_id==e&&void 0!==o.targetGapHash&&o.targetGapHash.hasOwnProperty(t))for(var s=0;s<o.targetGapHash[t].to-o.targetGapHash[t].from+1;++s)r+=void 0!==n&&n?i:"<span>"+i+"</span>";return r},iCn3DUI.prototype.insertGapOverview=function(e,t){var i=this,n="";if(i.cfg.blast_rep_id==e&&void 0!==i.targetGapHash&&i.targetGapHash.hasOwnProperty(t)){var o=i.seqAnnWidth*(i.targetGapHash[t].to-i.targetGapHash[t].from+1)/(i.maxAnnoLength+i.nTotalGap);n+='<div style="display:inline-block; background-color:#333; width:'+o+'px; height:3px;">&nbsp;</div>'}return n},iCn3DUI.prototype.showSeq=function(e,t,i,n,o,r,s){var a,c=this,d=!1;if(void 0===c.cfg.mmdbid&&void 0===c.cfg.gi&&void 0===c.cfg.blast_rep_id&&void 0===c.cfg.align){d=!0,a=[];for(var l=0;l<c.giSeq[e].length;++l)a.push(c.icn3d.chainsSeq[e][l])}else a=c.giSeq[e];var p=c.RESIDUE_WIDTH*c.giSeq[e].length+200,h=c.giSeq[e].length;h>c.maxAnnoLength&&(c.maxAnnoLength=h),$("#"+c.pre+"giseq_"+e).width(p),$("#"+c.pre+"interaction_"+e).width(p),$("#"+c.pre+"ssbond_"+e).width(p),$("#"+c.pre+"custom_"+e).length&&$("#"+c.pre+"custom_"+e).width(p),$("#"+c.pre+"clinvar_"+e).length&&$("#"+c.pre+"clinvar_"+e).width(p),$("#"+c.pre+"snp_"+e).length&&$("#"+c.pre+"snp_"+e).width(p),$("#"+c.pre+"cddsite_"+e).length&&$("#"+c.pre+"cddsite_"+e).width(p),$("#"+c.pre+"domain_"+e).length&&$("#"+c.pre+"domain_"+e).width(p);var u,m="",f="",v="";if(m+='<div class="icn3d-dl_sequence">',v+='<div class="icn3d-dl_sequence">',c.giSeq[e].length>10){u='<div class="icn3d-residueLine" style="white-space:nowrap;">';var g=c.icn3d.getFirstCalphaAtomObj(c.icn3d.chains[e]);u+=void 0===c.cfg.mmdbid&&void 0===c.cfg.gi&&void 0===c.cfg.blast_rep_id&&void 0===c.cfg.align||void 0===g.resi_ori||g.resi_ori==g.resi||e.indexOf("Misc")!=-1?'<div class="icn3d-annoTitle" anno="0"></div>':'<div class="icn3d-annoTitle" anno="0" title="NCBI Residue Numbers">NCBI Residue Numbers</div>',u+='<span class="icn3d-residueNum"></span>',v+=u+"<br>",m+=u+'<span class="icn3d-seqLine">';for(var b=0,y=0,l=0,_=a.length;l<_;++l){m+=c.insertGap(e,l,"-");var w;w=d?a[l].resi:l>=c.matchedPos[e]&&l-c.matchedPos[e]<c.icn3d.chainsSeq[e].length?c.icn3d.chainsSeq[e][l-c.matchedPos[e]].resi:c.baseResi[e]+1+l,m+="<span>",w%10===0&&(m+=w+" ");var C=e+"_"+w;if(c.icn3d.residues.hasOwnProperty(C)){var g=c.icn3d.getFirstCalphaAtomObj(c.icn3d.residues[C]);"H"==c.icn3d.secondaries[C]&&g.ssbegin?(++b,m+='<span class="icn3d-helix-color">H'+b+"</span>"):"E"==c.icn3d.secondaries[C]&&g.ssbegin&&(++y,"green"==c.icn3d.sheetcolor?m+='<span class="icn3d-sheet-color">S'+y+"</span>":"yellow"==c.icn3d.sheetcolor&&(m+='<span class="icn3d-sheet-colory">S'+y+"</span>"))}m+="</span>"}m+='<span class="icn3d-residueNum"></span>',m+="</span>",m+="<br>",m+="</div>",v+="</div>"}u='<div class="icn3d-residueLine" style="white-space:nowrap;">',u+='<div class="icn3d-annoTitle" anno="0"></div>',u+='<span class="icn3d-residueNum"></span>',v+=u+"<br>",m+=u+'<span class="icn3d-seqLine">';for(var l=0,_=a.length;l<_;++l){m+=c.insertGap(e,l,"-");var S=l>=c.matchedPos[e]&&l-c.matchedPos[e]<c.icn3d.chainsSeq[e].length?c.icn3d.chainsSeq[e][l-c.matchedPos[e]].resi:c.baseResi[e]+1+l,C=e+"_"+S;if(c.icn3d.residues.hasOwnProperty(C))if("H"==c.icn3d.secondaries[C])m+=l%2==0?'<span class="icn3d-helix">':'<span class="icn3d-helix2">',m+="&nbsp;</span>";else if("E"==c.icn3d.secondaries[C]){var g=c.icn3d.getFirstCalphaAtomObj(c.icn3d.residues[C]);g.ssend?"green"==c.icn3d.sheetcolor?m+='<span class="icn3d-sheet2">':"yellow"==c.icn3d.sheetcolor&&(m+='<span class="icn3d-sheet2y">'):"green"==c.icn3d.sheetcolor?m+='<span class="icn3d-sheet">':"yellow"==c.icn3d.sheetcolor&&(m+='<span class="icn3d-sheety">'),m+="&nbsp;</span>"}else"c"==c.icn3d.secondaries[C]?m+='<span class="icn3d-coil">&nbsp;</span>':"o"==c.icn3d.secondaries[C]&&(m+='<span class="icn3d-other">&nbsp;</span>');else m+="<span>-</span>"}m+='<span class="icn3d-residueNum"></span>',m+="</span>",m+="<br>",m+="</div>",m+="</div>",v+="</div></div>",u=c.cfg.blast_rep_id===e?'<div id="'+c.pre+'giseq_sequence" class="icn3d-dl_sequence" style="border: solid 1px #000;">':'<div id="'+c.pre+'giseq_sequence" class="icn3d-dl_sequence">';var A="Protein",k="Protein";void 0!==i&&("nucleotide"==i?(A="Nucl.",k="Nucleotide"):"chemical"==i&&(A="Chem.",k="Chemical")),u+='<div class="icn3d-seqTitle icn3d-link icn3d-blue" gi="'+e+'" anno="sequence" chain="'+e+'"><span style="white-space:nowrap;" title="'+k+" "+e+'">'+A+" "+e+"</span></div>",u+='<span class="icn3d-residueNum" title="starting protein sequence number">'+(c.baseResi[e]+1).toString()+"</span>",v+=u+"<br>";var E='<span class="icn3d-seqLine">';m+=u+E,f+=u+E;for(var x=0,l=0,_=a.length;l<_;++l){m+=c.insertGap(e,l,"-"),void 0!==c.targetGapHash&&c.targetGapHash.hasOwnProperty(l)&&(x+=c.targetGapHash[l].to-c.targetGapHash[l].from+1);var R=d?a[l].name:a[l],T=R;R.length>1&&(T=R[0]+"..");var H=l>=c.matchedPos[e]&&l-c.matchedPos[e]<c.icn3d.chainsSeq[e].length?c.icn3d.chainsSeq[e][l-c.matchedPos[e]].resi:c.baseResi[e]+1+l;if(c.icn3d.residues.hasOwnProperty(e+"_"+H)){var D="333333";if(c.cfg.blast_rep_id==e&&void 0!==c.fullpos2ConsTargetpos&&void 0!==c.fullpos2ConsTargetpos[l+x])D=c.fullpos2ConsTargetpos[l+x].color;else{var g=c.icn3d.getFirstCalphaAtomObj(c.icn3d.residues[e+"_"+H]);D=g.color?g.color.getHexString():c.icn3d.defaultAtomColor}m+='<span id="giseq_'+c.pre+e+"_"+H+'" title="'+R+H+'" class="icn3d-residue" style="color:#'+D+'">'+T+"</span>"}else T=T.toLowerCase(),m+='<span title="'+R+H+'" class="icn3d-residue">'+T+"</span>"}c.cfg.blast_rep_id==e&&(c.opts.color="conservation",c.icn3d.setColorByOptions(c.opts,c.icn3d.atoms));var g=c.icn3d.getFirstCalphaAtomObj(c.icn3d.chains[e]),D=g.color?g.color.getHexString():c.icn3d.defaultAtomColor,I=Math.round(c.seqAnnWidth*a.length/c.maxAnnoLength);if(I<1&&(I=1),c.cfg.blast_rep_id!=e)f+='<div id="giseq_summary_'+c.pre+e+'" class="icn3d-seqTitle icn3d-link" gi chain="'+e+'" style="display:inline-block; color:white; font-weight:bold; background-color:#'+D+"; width:"+I+'px;">'+e+"</div>";else{var O=[],M=[];O.push(0);for(var l=0,_=a.length;l<_;++l)void 0!==c.targetGapHash&&c.targetGapHash.hasOwnProperty(l)&&(M.push(l-1),O.push(l));M.push(a.length-1),f+='<div id="giseq_summary_'+c.pre+e+'" class="icn3d-seqTitle icn3d-link" gi chain="'+e+'" style="width:'+I+'px;">';for(var l=0,_=O.length;l<_;++l)f+=c.insertGapOverview(e,O[l]),f+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+D+"; width:"+Math.round(c.seqAnnWidth*(M[l]-O[l]+1)/(c.maxAnnoLength+c.nTotalGap))+'px;" class="icn3d-seqTitle icn3d-link icn3d-blue" anno="sequence" gi chain="'+e+'" title="'+e+'">'+e+"</div>";f+="</div>"}if(u='<span class="icn3d-residueNum" title="ending protein sequence number">'+H+"</span>",u+="</span>",u+="<br>",m+=u,f+=u,c.cfg.blast_rep_id==e){if(void 0!==s&&""!==s){u='<div class="icn3d-seqTitle icn3d-link icn3d-blue" blast="" posarray="'+c.consrvResPosArray.toString()+'" title="'+o+'" setname="'+e+'_blast" anno="sequence" chain="'+e+'"><span style="white-space:nowrap;" title="'+o+'">'+o+"</span></div>",u+='<span class="icn3d-residueNum"></span>',v+=u+"<br>";var E='<span class="icn3d-seqLine">';m+=u+E,f+=u+E;for(var L=0,P=0,N=1,z=c.queryStart,l=0,_=s.length;l<_;++l){var T=s[l];if("-"==T)m+="<span>-</span>";else if(" "==T)m+="<span> </span>";else{var H=c.fullpos2ConsTargetpos[l].pos;if(c.icn3d.residues.hasOwnProperty(e+"_"+H)){var D=c.fullpos2ConsTargetpos[l].color;m+='<span id="giseq_'+c.pre+e+"_"+H+'" title="'+c.fullpos2ConsTargetpos[l].res+H+'" class="icn3d-residue" style="color:#'+D+'">'+T+"</span>"}else T=T.toLowerCase(),m+='<span class="icn3d-residue">'+T+"</span>";f+=c.insertGapOverview(e,l);var q=Math.round(c.seqAnnWidth*l/(c.maxAnnoLength+c.nTotalGap)-L-P);q<0&&(q=0),f+='<div style="display:inline-block; width:'+q+'px;">&nbsp;</div>',f+='<div style="display:inline-block; background-color:#F00; width:'+N+'px;" title="'+T+H+'">&nbsp;</div>',L+=q,P+=N,++z}}u='<span class="icn3d-residueNum"></span>',u+="</span>",u+="<br>",m+=u,f+=u}u='<div class="icn3d-annoTitle" anno="sequence" chain="'+e+'"><span style="white-space:nowrap;" title="'+n+'">'+n+"</span></div>",u+='<span class="icn3d-residueNum" title="starting protein sequence number">'+c.queryStart+"</span>",v+=u+"<br>";var E='<span class="icn3d-seqLine" style="font-weight: bold;">';m+=u+E,f+=u+E;for(var z=c.queryStart,l=0,_=r.length;l<_;++l){var T=r[l];" "==T||"-"==T?m+="<span>-</span>":(void 0===c.fullpos2ConsTargetpos||void 0===c.fullpos2ConsTargetpos[l]||c.icn3d.residues.hasOwnProperty(e+"_"+c.fullpos2ConsTargetpos[l].pos)?m+='<span title="'+T+z+'" class="icn3d-residue">'+T+"</span>":(T=T.toLowerCase(),m+='<span title="'+T+z+'" class="icn3d-residue">'+T+"</span>"),++z)}for(var g=c.icn3d.getFirstCalphaAtomObj(c.icn3d.chains[e]),D=g.color?g.color.getHexString():c.icn3d.defaultAtomColor,O=[],M=[],F="-",l=0,_=r.length;l<_;++l){var T=r[l];"-"!=T&&"-"==F?O.push(l):"-"==T&&"-"!=F&&M.push(l-1),F=T}"-"!=F&&M.push(r.length-1);for(var l=0,_=O.length;l<_;++l){var q=0==l?Math.round(c.seqAnnWidth*O[l]/(c.maxAnnoLength+c.nTotalGap)):Math.round(c.seqAnnWidth*(O[l]-M[l-1]-1)/(c.maxAnnoLength+c.nTotalGap));f+='<div style="display:inline-block; width:'+q+'px;">&nbsp;</div>',f+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+D+"; width:"+Math.round(c.seqAnnWidth*(M[l]-O[l]+1)/(c.maxAnnoLength+c.nTotalGap))+'px;" anno="sequence" chain="'+e+'" title="'+n+'">'+n+"</div>"}u='<span class="icn3d-residueNum" title="ending protein sequence number">'+c.queryEnd+"</span>",u+="</span>",u+="<br>",m+=u,f+=u}if(m+="</div>",f+="</div>",v+="</div>",c.giSeq[e].length>10){var g=c.icn3d.getFirstCalphaAtomObj(c.icn3d.chains[e]);if((void 0!==c.cfg.mmdbid||void 0!==c.cfg.gi||void 0!==c.cfg.blast_rep_id||void 0!==c.cfg.align)&&void 0!==g.resi_ori&&g.resi_ori!=g.resi&&e.indexOf("Misc")==-1){u='<div class="icn3d-dl_sequence">',u+='<div class="icn3d-residueLine" style="white-space:nowrap;">',u+='<div class="icn3d-annoTitle" anno="0" title="PDB Residue Numbers">PDB Residue Numbers</div>',u+='<span class="icn3d-residueNum"></span>',v+=u+"<br>",m+=u+'<span class="icn3d-seqLine">';for(var l=0,_=a.length;l<_;++l)if(m+=c.insertGap(e,l,"-"),l>=c.matchedPos[e]&&l-c.matchedPos[e]<c.icn3d.chainsSeq[e].length){var w=c.icn3d.chainsSeq[e][l-c.matchedPos[e]].resi,C=e+"_"+w;if(c.icn3d.residues.hasOwnProperty(C)){var g=c.icn3d.getFirstCalphaAtomObj(c.icn3d.residues[C]),j=g.resi_ori;m+="<span>",j%10===0&&(m+=j+" "),m+="</span>"}else m+="<span></span>"}else m+="<span></span>";m+='<span class="icn3d-residueNum"></span>',m+="</span>",m+="<br>",m+="</div>",m+="</div>",v+="</div></div>"}}$("#"+c.pre+"dt_giseq_"+e).html(m),$("#"+c.pre+"ov_giseq_"+e).html(f),$("#"+c.pre+"tt_giseq_"+e).html(v)},iCn3DUI.prototype.navClinVar=function(e){var t=this;t.currClin[e]=-1,$(document).on("click","#"+t.pre+e+"_prevclin",function(i){i.stopImmediatePropagation();var n=void 0!==t.resi2disease_nonempty[e]?Object.keys(t.resi2disease_nonempty[e]).length:0;--t.currClin[e],t.currClin[e]<0&&(t.currClin[e]=n-1),t.showClinVarLabelOn3D(e)}),$(document).on("click","#"+t.pre+e+"_nextclin",function(i){i.stopImmediatePropagation();var n=void 0!==t.resi2disease_nonempty[e]?Object.keys(t.resi2disease_nonempty[e]).length:0;++t.currClin[e],t.currClin[e]>n-1&&(t.currClin[e]=0),t.showClinVarLabelOn3D(e)})},iCn3DUI.prototype.showClinVarLabelOn3D=function(e){var t,i,n=this,o=Object.keys(n.resi2disease_nonempty[e]);t=e,i=t+"_"+o[n.currClin[e]];for(var r="",s=n.resi2disease_nonempty[e][o[n.currClin[e]]],a=0,c=s.length;a<c;++a)if(""!=s[a]&&"not specified"!=s[a]&&"not provided"!=s[a]){r=s[a];break}var d=n.icn3d.centerAtoms(n.icn3d.hash2Atoms(n.icn3d.residues[i])),l=30;r.length>l&&(r=r.substr(0,l)+"..."),n.removeSelection(),void 0==n.icn3d.labels&&(n.icn3d.labels={}),n.icn3d.labels.clinvar=[];var p=n.icn3d.LABELSIZE,h="#FFFF00";n.addLabel(r,d.center.x+1,d.center.y+1,d.center.z+1,p,h,void 0,"clinvar"),n.icn3d.hAtoms={};for(var u in n.icn3d.residues[i])n.icn3d.hAtoms[u]=1;$("#clinvar_"+n.pre+i).addClass("icn3d-highlightSeq"),$("#"+n.pre+"modeswitch")[0].checked||n.setMode("selection"),n.icn3d.draw()},iCn3DUI.prototype.getSnpLine=function(e,t,i,n,o,r,s,a,c,d,l,p,h,u,m,f){var v=this,g="",b=u?"clinvar":"snp";if(l){var y="ClinVar",_="SNP";g+=u?'<div class="icn3d-seqTitle icn3d-link icn3d-blue icn3d-clinvar-path" clinvar="clinvar" posarray="'+d+'" shorttitle="'+y+'" setname="'+p+"_"+y+'" anno="sequence" chain="'+p+'" title="'+y+'">'+y+"</div>":'<div class="icn3d-seqTitle icn3d-link icn3d-blue" clinvar="clinvar" posarray="'+c+'" shorttitle="'+_+'" setname="'+p+"_"+_+'" anno="sequence" chain="'+p+'" title="'+_+'">'+_+"</div>"}else if(2==e&&u){var w=v.isMobile()?"none":"button";g+='<div id="'+v.pre+p+'_prevclin" style="display:inline-block; font-size:11px; font-weight:bold; width:60px!important;"><button class="link" style="-webkit-appearance:'+w+'; height:18px; width:55px;"><span style="white-space:nowrap; margin-left:-40px;" title="Show the previous ClinVar on structure">&lt; ClinVar</span></button></div>',g+='<div id="'+v.pre+p+'_nextclin" style="display:inline-block; font-size:11px; font-weight:bold; width:60px!important;"><button class="link" style="-webkit-appearance:'+w+'; height:18px; width:55px;"><span style="white-space:nowrap; margin-left:-40px;" title="Show the next ClinVar on structure">ClinVar &gt;</span></button></div>'}else g+='<div class="icn3d-seqTitle"></div>';for(var C=b,S=0,A=0,k={},E={},x=1,R=v.giSeq[p].length;x<=R;++x)if(void 0!==s[x]){++S;for(var T="",H=0,D=i[x].length;H<D&&!f;++H){for(var I=r[x][H].split("; "),O=a[x][H].split("; "),M="",L=0,P=I.length;L<P;++L)""!=I[L]&&"not specified"!=I[L]&&"not provided"!=I[L]&&(M+=I[L]+" ("+O[L]+"); ");""!=M&&(k[x]="icn3d-clinvar",H==e-2&&(E[x]="icn3d-clinvar",M.indexOf("Pathogenic")!=-1&&(E[x]="icn3d-clinvar-path"))),T+=M+" | "}T.indexOf("Pathogenic")!=-1&&(k[x]="icn3d-clinvar-path"),"icn3d-clinvar"!=k[x]&&"icn3d-clinvar-path"!=k[x]||++A}if(0==S)return $("#"+v.pre+"dt_clinvar_"+p).html(""),$("#"+v.pre+"ov_clinvar_"+p).html(""),$("#"+v.pre+"tt_clinvar_"+p).html(""),$("#"+v.pre+"dt_snp_"+p).html(""),$("#"+v.pre+"ov_snp_"+p).html(""),$("#"+v.pre+"tt_snp_"+p).html(""),"";if(0==A&&u)return $("#"+v.pre+"dt_clinvar_"+p).html(""),$("#"+v.pre+"ov_clinvar_"+p).html(""),$("#"+v.pre+"tt_clinvar_"+p).html(""),"";var N=u?A:S;if(0==A?v.bClinvarCnt=!1:v.bClinvarCnt=!0,g+=1==e?'<span class="icn3d-residueNum" title="residue count">'+N+" Res</span>":'<span class="icn3d-residueNum"></span>',void 0!==m&&m)return g+"<br>";g+='<span class="icn3d-seqLine">';for(var z="",q=0,F=0,j=1,x=1,R=v.giSeq[p].length;x<=R;++x)if(h){if(void 0!==s[x]){var U=v.giSeq[p][x-1],B=U;U.length>1&&(B=U[0]+"..");for(var G=x>=v.matchedPos[p]&&x-1-v.matchedPos[p]<v.icn3d.chainsSeq[p].length?v.icn3d.chainsSeq[p][x-1-v.matchedPos[p]].resi:v.baseResi[p]+1+x-1,V=G+B+">",T="",H=0,D=i[x].length;H<D;++H)if(V+=i[x][H],!f){for(var I=r[x][H].split("; "),O=a[x][H].split("; "),M="",L=0,P=I.length;L<P;++L)""!=I[L]&&"not specified"!=I[L]&&"not provided"!=I[L]&&(M+=I[L]+" ("+O[L]+"); ");T+=M+" | "}g+=v.insertGapOverview(p,x-1);var W=v.cfg.blast_rep_id==p?Math.round(v.seqAnnWidth*(x-1)/(v.maxAnnoLength+v.nTotalGap)-q-F):Math.round(v.seqAnnWidth*(x-1)/v.maxAnnoLength-q-F);W<0&&(W=0),u?"icn3d-clinvar"!=k[x]&&"icn3d-clinvar-path"!=k[x]||(W>0&&(g+='<div style="display:inline-block; width:'+W+'px;">&nbsp;</div>'),g+='<div style="display:inline-block; background-color:#000; width:'+j+'px;" title="'+V+'">&nbsp;</div>',q+=W,F+=j):(W>0&&(g+='<div style="display:inline-block; width:'+W+'px;">&nbsp;</div>'),g+='<div style="display:inline-block; background-color:#000; width:'+j+'px;" title="'+V+'">&nbsp;</div>',q+=W,F+=j)}}else if(g+=v.insertGap(p,x-1,"-"),void 0!==s[x])if(u||1!=e){var U=v.giSeq[p][x-1],B=U;U.length>1&&(B=U[0]+"..");var Y,G=x>=v.matchedPos[p]&&x-1-v.matchedPos[p]<v.icn3d.chainsSeq[p].length?v.icn3d.chainsSeq[p][x-1-v.matchedPos[p]].resi:v.baseResi[p]+1+x-1,X="",V="<div class='snptip'>",D=i[x].length,Z=0,K=0;if(2==e?(Z=0,K=1):3==e&&(Z=1,K=D),u){Y=1;for(var Q=0,H=Z;H<D&&H<K;++H){for(var I=r[x][H].split("; "),O=a[x][H].split("; "),M="",J=0,L=0,P=I.length;L<P;++L)""!=I[L]&&"not specified"!=I[L]&&"not provided"!=I[L]&&(J>0?M+="; ":0!==H&&1!==H||(z='disease="'+I[L]+'"'),M+=I[L]+" ("+O[L]+")",++J);""!=M&&(Q<Y&&(X+=i[x][H]),V+=G+B+">"+i[x][H],V+=": "+M,V+="<br>Links: <a href='https://www.ncbi.nlm.nih.gov/clinvar/?term="+o[x][H]+"[AlleleID]' target='_blank'>ClinVar</a>, <a href='https://www.ncbi.nlm.nih.gov/snp/?term="+n[x][H]+"' target='_blank'>dbSNP (rs"+n[x][H]+")</a>",H<D-1&&(V+="<br><br>"),++Q)}Q>Y&&3==e&&(X+="..")}else{Y=2;for(var H=Z;H<D&&H<K;++H)if(H<Y&&(X+=i[x][H]),V+=G+B+">"+i[x][H],f)H<D-1&&(V+="<br>");else{for(var I=r[x][H].split("; "),O=a[x][H].split("; "),M="",J=0,L=0,P=I.length;L<P;++L)""!=I[L]&&"not specified"!=I[L]&&"not provided"!=I[L]&&(J>0?M+="; ":0!==H&&1!==H||(z='disease="'+I[L]+'"'),M+=I[L]+" ("+O[L]+")",++J);""!=M?(V+=": "+M,V+="<br>Links: <a href='https://www.ncbi.nlm.nih.gov/clinvar/?term="+o[x][H]+"[AlleleID]' target='_blank'>ClinVar</a>, <a href='https://www.ncbi.nlm.nih.gov/snp/?term="+n[x][H]+"' target='_blank'>dbSNP (rs"+n[x][H]+")</a>"):V+="<br>Link: <a href='https://www.ncbi.nlm.nih.gov/snp/?term="+n[x][H]+"' target='_blank'>dbSNP (rs"+n[x][H]+")</a>",H<D-1&&(V+="<br><br>")}D>Y&&3==e&&(X+="..")}V+="</div>",g+=u?"icn3d-clinvar"==k[x]||"icn3d-clinvar-path"==k[x]?1==e?"<span>&dArr;</span>":""==X||" "==X?"<span>-</span>":'<span id="'+C+"_"+v.pre+p+"_"+G+'" label title="'+V+'" '+z+' class="icn3d-tooltip icn3d-residue '+E[x]+'">'+X+"</span>":"<span>-</span>":""==X||" "==X?"<span>-</span>":f?'<span id="'+C+"_"+v.pre+p+"_"+G+'" label title="'+V+'" class="icn3d-residue '+E[x]+'">'+X+"</span>":'<span id="'+C+"_"+v.pre+p+"_"+G+'" label title="'+V+'" '+z+' class="icn3d-tooltip icn3d-residue '+E[x]+'">'+X+"</span>"}else g+="<span>&dArr;</span>";else g+="<span>-</span>";return g+=1==e?'<span class="icn3d-residueNum" title="residue count">&nbsp;'+N+" Residues</span>":'<span class="icn3d-residueNum"></span>',g+="</span>",g+="<br>"},iCn3DUI.prototype.processSnpClinvar=function(e,t,i,n){var o=this,r='<div id="'+o.pre+t+'_snpseq_sequence" class="icn3d-dl_sequence">',s=r,a=r,c='<div id="'+o.pre+t+'_clinvarseq_sequence" class="icn3d-dl_sequence">',d=c,l=c,p=e.split("\n"),h={},u={},m={};o.resi2disease_nonempty[t]={};for(var f={},v={},g={},b={},y={},_="",w=0,C=p.length;w<C;++w)if(""!=p[w]){var S=p[w].split("\t"),A=S[3];if(A==_)continue;_=A;var k=A.substr(0,A.length-3),E=Math.round(k),x=(A.substr(A.length-3,1),A.substr(A.length-1,1)),R=n?"":S[4],T=n?"":S[5],H=n?"":S[6],D=n?"":S[7];b[E+o.baseResi[t]]=1,""!=H&&(y[E+o.baseResi[t]]=1),u[E]=w+1,void 0===h[E]&&(h[E]=[]),h[E].push(x),void 0===v[E]&&(v[E]=[]),v[E].push(R),void 0===g[E]&&(g[E]=[]),g[E].push(T),void 0===m[E]&&(m[E]=[]),m[E].push(H),""!=H&&(void 0===o.resi2disease_nonempty[t][E]&&(o.resi2disease_nonempty[t][E]=[]),o.resi2disease_nonempty[t][E].push(H)),void 0===f[E]&&(f[E]=[]),f[E].push(D)}var I=Object.keys(b),O=Object.keys(y),M=!1;r+=o.getSnpLine(1,3,h,v,g,m,u,f,I,O,1,t,!1,M,void 0,n),r+=o.getSnpLine(2,3,h,v,g,m,u,f,I,O,0,t,!1,M,void 0,n),r+=o.getSnpLine(3,3,h,v,g,m,u,f,I,O,0,t,!1,M,void 0,n),a+=o.getSnpLine(1,3,h,v,g,m,u,f,I,O,1,t,!1,M,!0,n),a+=o.getSnpLine(2,3,h,v,g,m,u,f,I,O,0,t,!1,M,!0,n),a+=o.getSnpLine(3,3,h,v,g,m,u,f,I,O,0,t,!1,M,!0,n),s+=o.getSnpLine(1,3,h,v,g,m,u,f,I,O,1,t,!0,M,void 0,n),r+="</div>",s+="</div>",a+="</div>",$("#"+o.pre+"dt_snp_"+t).html(r),$("#"+o.pre+"ov_snp_"+t).html(s),$("#"+o.pre+"tt_snp_"+t).html(a),!n&&o.bClinvarCnt?(M=!0,c+=o.getSnpLine(1,3,h,v,g,m,u,f,I,O,1,t,!1,M,void 0,n),c+=o.getSnpLine(2,3,h,v,g,m,u,f,I,O,0,t,!1,M,void 0,n),c+=o.getSnpLine(3,3,h,v,g,m,u,f,I,O,0,t,!1,M,void 0,n),l+=o.getSnpLine(1,3,h,v,g,m,u,f,I,O,1,t,!1,M,!0,n),l+=o.getSnpLine(2,3,h,v,g,m,u,f,I,O,0,t,!1,M,!0,n),l+=o.getSnpLine(3,3,h,v,g,m,u,f,I,O,0,t,!1,M,!0,n),d+=o.getSnpLine(1,3,h,v,g,m,u,f,I,O,1,t,!0,M,void 0,n),c+="</div>",d+="</div>",l+="</div>",$("#"+o.pre+"dt_clinvar_"+t).html(c),$("#"+o.pre+"ov_clinvar_"+t).html(d),$("#"+o.pre+"tt_clinvar_"+t).html(l),o.navClinVar(t,i)):($("#"+o.pre+"dt_clinvar_"+t).html(""),$("#"+o.pre+"ov_clinvar_"+t).html(""),$("#"+o.pre+"tt_clinvar_"+t).html("")),o.enableHlSeq(),o.bAjaxSnpClinvar=!0,void 0!==o.deferredSnpClinvar&&o.deferredSnpClinvar.resolve()},iCn3DUI.prototype.showSnpClinvar=function(e,t){var i=this,n="https://www.ncbi.nlm.nih.gov/projects/SNP/beVarSearch_mt.cgi?appname=iCn3D&format=bed&report=pdb2bed&acc="+t;$.ajax({url:n,dataType:"text",cache:!0,tryCount:0,retryLimit:1,success:function(n){if(""!=n){var o=!1;i.processSnpClinvar(n,e,t,o)}else if(void 0!==i.chain2gi&&Object.keys(i.chain2gi).length>0){var r=i.chain2gi[t];i.showSnpClinvarAlt(e,t,r)}else{var s="https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?db=protein&retmode=json&id="+t;$.ajax({url:s,dataType:"json",cache:!0,tryCount:0,retryLimit:1,success:function(n){var o;for(var r in n.result)"uids"!==r&&(o=r);i.showSnpClinvarAlt(e,t,o)},error:function(t,n,o){return this.tryCount++,this.tryCount<=this.retryLimit?void $.ajax(this):void i.processNoSnpClinvar(e)}})}},error:function(t,n,o){return this.tryCount++,this.tryCount<=this.retryLimit?void $.ajax(this):void i.processNoSnpClinvar(e)}})},iCn3DUI.prototype.showSnpClinvarAlt=function(e,t,i){var n=this;if(void 0!==i){var o="https://www.ncbi.nlm.nih.gov/projects/SNP/beVarSearch.cgi?appname=iCn3D&format=bed&report=pdb2bed&gi="+i;$.ajax({url:o,dataType:"text",cache:!0,tryCount:0,retryLimit:1,success:function(i){if(""!=i){var o=!0;n.processSnpClinvar(i,e,t,o)}else n.processNoSnpClinvar(e)},error:function(t,i,o){return this.tryCount++,this.tryCount<=this.retryLimit?void $.ajax(this):void n.processNoSnpClinvar(e)}})}else console.log("No gi was found for the chain "+t+"...")},iCn3DUI.prototype.processNoSnpClinvar=function(e){var t=this;console.log("No SNP data were found for the protein "+e+"..."),$("#"+t.pre+"dt_clinvar_"+e).html(""),$("#"+t.pre+"ov_clinvar_"+e).html(""),$("#"+t.pre+"dt_snp_"+e).html(""),$("#"+t.pre+"ov_snp_"+e).html(""),t.enableHlSeq(),t.bAjaxSnpClinvar=!0,void 0!==t.deferredSnpClinvar&&t.deferredSnpClinvar.resolve()},iCn3DUI.prototype.showCddSiteAll=function(){var e=this,t=$.map(e.protein_chainid,function(e){return e}),i=Object.keys(e.protein_chainid),n="https://www.ncbi.nlm.nih.gov/Structure/cdannots/cdannots.fcgi?fmt&queries="+t;$.ajax({url:n,dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,success:function(t){for(var n={},o=0,r=t.data.length;o<r;++o){var s=t.data[o],a=(s._id,i[o]);n[a]=1;for(var c='<div id="'+e.pre+a+'_cddseq_sequence" class="icn3d-cdd icn3d-dl_sequence">',d=c,l=c,p=s.doms,h=void 0!==p?p.length:0,u=0;u<h;++u){var m=p[u].acc,f=p[u].type;f="domain";var v=p[u].title.split(":")[0],g=p[u].defline,b=f+": "+v;b.length>14&&(b=b.substr(0,14)+"...");for(var y=f+": "+v,_=p[u].locs,w=0,C=_.length;w<C;++w){for(var S=[],A=[],k={},E=0,x=0,R=_[w].segs.length;x<R;++x){var T=Math.round(_[w].segs[x].from),H=Math.round(_[w].segs[x].to);S.push(T+e.baseResi[a]),A.push(H+e.baseResi[a]);for(var D=T;D<=H;++D)k[D]=1;E+=H-T+1}var I='<div class="icn3d-seqTitle icn3d-link icn3d-blue" domain="'+m+'" from="'+S+'" to="'+A+'" shorttitle="'+b+'" setname="'+a+"_"+f+"_"+u+"_"+w+'" anno="sequence" chain="'+a+'" title="'+y+'">'+b+" </div>",O='<span class="icn3d-residueNum" title="residue count">'+E.toString()+" Res</span>";l+=I+O+"<br>";var M='<span class="icn3d-seqLine">';c+=I+O+M,d+='<div style="width:20px; display:inline-block;"><span id="'+e.pre+a+"_"+m+"_"+w+'_cddseq_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+e.pre+a+"_"+m+"_"+w+'_cddseq_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div>',d+='<div style="width:100px!important;" class="icn3d-seqTitle icn3d-link icn3d-blue" domain="'+m+'" from="'+S+'" to="'+A+'" shorttitle="'+b+'" index="'+u+'" setname="'+a+"_"+f+"_"+u+"_"+w+'" anno="sequence" chain="'+a+'" title="'+y+'">'+b+" </div>",d+=O+M;for(var L=f+u.toString(),D=0,P=e.giSeq[a].length;D<P;++D)if(c+=e.insertGap(a,D,"-"),k.hasOwnProperty(D)){var N=e.giSeq[a][D],z=N;N.length>1&&(z=N[0]+"..");var q=D>=e.matchedPos[a]&&D-e.matchedPos[a]<e.icn3d.chainsSeq[a].length?e.icn3d.chainsSeq[a][D-e.matchedPos[a]].resi:e.baseResi[a]+1+D;c+='<span id="'+L+"_"+e.pre+a+"_"+q+'" title="'+z+q+'" class="icn3d-residue">'+N+"</span>"}else c+="<span>-</span>";var F=e.icn3d.getFirstCalphaAtomObj(e.icn3d.chains[a]),j=F.color?F.color.getHexString():e.icn3d.defaultAtomColor;if(e.cfg.blast_rep_id!=a)for(var D=0,P=S.length;D<P;++D){var U=0==D?Math.round(e.seqAnnWidth*S[D]/e.maxAnnoLength):Math.round(e.seqAnnWidth*(S[D]-A[D-1]-1)/e.maxAnnoLength);d+='<div style="display:inline-block; width:'+U+'px;">&nbsp;</div>',d+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+j+"; width:"+Math.round(e.seqAnnWidth*(A[D]-S[D]+1)/e.maxAnnoLength)+'px;" class="icn3d-seqTitle icn3d-link icn3d-blue" domain="'+(u+1).toString()+'" from="'+S+'" to="'+A+'" shorttitle="'+b+'" index="'+u+'" setname="'+a+"_domain_"+u+"_"+w+'" id="'+a+"_domain_"+u+"_"+w+'" anno="sequence" chain="'+a+'" title="'+y+'">'+v+" </div>"}else{for(var B=[],G=[],D=0,P=S.length;D<P;++D){B.push(S[D]);for(var V=S[D];V<=A[D];++V)void 0!==e.targetGapHash&&e.targetGapHash.hasOwnProperty(V)&&(G.push(V-1),B.push(V));G.push(A[D])}for(var D=0,P=B.length;D<P;++D){d+=e.insertGapOverview(a,B[D]);var U=0==D?Math.round(e.seqAnnWidth*B[D]/(e.maxAnnoLength+e.nTotalGap)):Math.round(e.seqAnnWidth*(B[D]-G[D-1]-1)/(e.maxAnnoLength+e.nTotalGap));d+='<div style="display:inline-block; width:'+U+'px;">&nbsp;</div>',d+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+j+"; width:"+Math.round(e.seqAnnWidth*(G[D]-B[D]+1)/(e.maxAnnoLength+e.nTotalGap))+'px;" class="icn3d-seqTitle icn3d-link icn3d-blue" domain="'+(u+1).toString()+'" from="'+B+'" to="'+G+'" shorttitle="'+b+'" index="'+u+'" setname="'+a+"_domain_"+u+"_"+w+'" id="'+a+"_domain_"+u+"_"+w+'" anno="sequence" chain="'+a+'" title="'+y+'">'+v+" </div>"}}M='<span class="icn3d-residueNum" title="residue count">&nbsp;'+E.toString()+" Residues</span>",M+="</span>",M+="<br>",c+=M,d+=M,d+='<div id="'+e.pre+a+"_"+m+"_"+w+'_cddseq" style="display:none; white-space:normal;" class="icn3d-box">'+g+' (<a href="https://www.ncbi.nlm.nih.gov/Structure/cdd/cddsrv.cgi?uid='+m+'" target="_blank" class="icn3d-blue">open details view...</a>)</div>'}}c+="</div>",d+="</div>",l+="</div>",$("#"+e.pre+"dt_cdd_"+a).html(c),$("#"+e.pre+"ov_cdd_"+a).html(d),$("#"+e.pre+"tt_cdd_"+a).html(l),c='<div id="'+e.pre+a+'_siteseq_sequence" class="icn3d-dl_sequence">',d=c,l=c;for(var W=t.data[o].sites,h=void 0!==W?W.length:0,u=0;u<h;++u){var v=W[u].srcdom,f=W[u].type,E=W[u].sz,b="site: "+W[u].title;b.length>17&&(b=b.substr(0,17)+"...");for(var y=W[u].title,Y=W[u].locs[0].coords,X=[],D=0,P=Y.length;D<P;++D)X.push(Math.round(Y[D])+e.baseResi[a]);var I='<div class="icn3d-seqTitle icn3d-link icn3d-blue" site="site" posarray="'+X.toString()+'" shorttitle="'+b+'" setname="'+a+"_site_"+u+'" anno="sequence" chain="'+a+'" title="'+y+'">'+b+" </div>",O='<span class="icn3d-residueNum" title="residue count">'+E.toString()+" Res</span>",M='<span class="icn3d-seqLine">';l+=I+O+"<br>",c+=I+O+M,d+=I+O+M;for(var L="site"+u.toString(),Z=e.seqAnnWidth/e.maxAnnoLength,K=0,Q=0,Z=1,D=0,P=e.giSeq[a].length;D<P;++D)if(c+=e.insertGap(a,D,"-"),Y.indexOf(D)!=-1){var N=e.giSeq[a][D],z=N;N.length>1&&(z=N[0]+"..");var q=D>=e.matchedPos[a]&&D-e.matchedPos[a]<e.icn3d.chainsSeq[a].length?e.icn3d.chainsSeq[a][D-e.matchedPos[a]].resi:e.baseResi[a]+1+D;c+='<span id="'+L+"_"+e.pre+a+"_"+q+'" title="'+z+q+'" class="icn3d-residue">'+N+"</span>",
d+=e.insertGapOverview(a,D);var U=e.cfg.blast_rep_id==a?Math.round(e.seqAnnWidth*D/(e.maxAnnoLength+e.nTotalGap)-K-Q):Math.round(e.seqAnnWidth*D/e.maxAnnoLength-K-Q);U<0&&(U=0),d+='<div style="display:inline-block; width:'+U+'px;">&nbsp;</div>',d+='<div style="display:inline-block; background-color:#000; width:'+Z+'px;" title="'+z+q+'">&nbsp;</div>',K+=U,Q+=Z}else c+="<span>-</span>";M='<span class="icn3d-residueNum" title="residue count">&nbsp;'+E.toString()+" Residues</span>",M+="</span>",M+="<br>",c+=M,d+=M}c+="</div>",d+="</div>",l+="</div>",$("#"+e.pre+"dt_site_"+a).html(c),$("#"+e.pre+"ov_site_"+a).html(d),$("#"+e.pre+"tt_site_"+a).html(l)}for(var a in e.protein_chainid)n.hasOwnProperty(a)||($("#"+e.pre+"dt_cdd_"+a).html(""),$("#"+e.pre+"ov_cdd_"+a).html(""),$("#"+e.pre+"tt_cdd_"+a).html(""),$("#"+e.pre+"dt_site_"+a).html(""),$("#"+e.pre+"ov_site_"+a).html(""),$("#"+e.pre+"tt_site_"+a).html(""));e.enableHlSeq(),e.bAjaxCddSite=!0,void 0!==e.deferredAnnoCddSite&&e.deferredAnnoCddSite.resolve()},error:function(i,n,o){if(this.tryCount++,this.tryCount<=this.retryLimit)return void $.ajax(this);console.log("No CDD data were found for the protein "+t+"...");for(var r in e.protein_chainid)$("#"+e.pre+"dt_cdd_"+r).html(""),$("#"+e.pre+"ov_cdd_"+r).html(""),$("#"+e.pre+"tt_cdd_"+r).html(""),$("#"+e.pre+"dt_site_"+r).html(""),$("#"+e.pre+"ov_site_"+r).html(""),$("#"+e.pre+"tt_site_"+r).html("");e.enableHlSeq(),e.bAjaxCddSite=!0,void 0!==e.deferredAnnoCddSite&&e.deferredAnnoCddSite.resolve()}})},iCn3DUI.prototype.showDomainPerStructure=function(e){var t=this,i=Object.keys(t.icn3d.structures),n=i[e],o="https://www.ncbi.nlm.nih.gov/Structure/mmdb/mmdb_strview.cgi?v=2&program=icn3d&domain&molinfor&uid="+n;if(0==e&&void 0!==t.mmdb_data)for(var r in t.protein_chainid)r.indexOf(n)!==-1&&t.showDomainWithData(r,t.mmdb_data);else if(void 0!==t.mmdb_dataArray[e])for(var r in t.protein_chainid)r.indexOf(n)!==-1&&t.showDomainWithData(r,t.mmdb_dataArray[e]);else $.ajax({url:o,dataType:"json",cache:!0,tryCount:0,retryLimit:1,success:function(o){t.mmdb_dataArray[e]=o;for(var r in t.protein_chainid)r.indexOf(n)!==-1&&t.showDomainWithData(r,t.mmdb_dataArray[e]);if(t.enableHlSeq(),t.bAjax3ddomain=!0,t.bAjaxDoneArray[e]=!0,void 0!==t.deferred3ddomain)if(void 0===t.cfg.align)t.deferred3ddomain.resolve();else{for(var s=!0,a=0,c=i.length;a<c;++a)s=s&&t.bAjaxDoneArray[a];s&&t.deferred3ddomain.resolve()}},error:function(e,o,r){if(this.tryCount++,this.tryCount<=this.retryLimit)return void $.ajax(this);console.log("No 3D domain data were found for the protein "+n+"...");for(var s in t.protein_chainid)s.indexOf(n)!==-1&&($("#"+t.pre+"dt_domain_"+s).html(""),$("#"+t.pre+"ov_domain_"+s).html(""),$("#"+t.pre+"tt_domain_"+s).html(""));if(t.enableHlSeq(),t.bAjax3ddomain=!0,bAjaxDone1=!0,void 0!==t.deferred3ddomain)if(void 0===t.cfg.align)t.deferred3ddomain.resolve();else{for(var a=!0,c=0,d=i.length;c<d;++c)a=a&&t.bAjaxDoneArray[c];a&&t.deferred3ddomain.resolve()}}})},iCn3DUI.prototype.showDomainAll=function(){var e=this,t=Object.keys(e.icn3d.structures);e.mmdb_dataArray=[],e.bAjaxDoneArray=[];for(var i=0,n=t.length;i<n;++i)e.bAjaxDoneArray[i]=!1;for(var i=0,n=t.length;i<n;++i)e.showDomainPerStructure(i)},iCn3DUI.prototype.showDomainWithData=function(e,t){var i,n,o,r=this,s='<div id="'+r.pre+e+'_domainseq_sequence" class="icn3d-dl_sequence">',a=s,c=s,d=e.indexOf("_"),l=e.substr(d+1),p=t.moleculeInfor;for(var h in p)if(p[h].chain===l){o=h,n=p[h].name;break}void 0!==o&&void 0!==t.domains[o]&&(i=t.domains[o].domains),void 0===i&&(i=[]);for(var u=0,m=i.length;u<m;++u){for(var f="3D domain "+(u+1).toString()+" of "+n,v=f.length>17?f.substr(0,17)+"...":f,g=i[u].intervals,b={},y=[],_=[],w={},C=0,S=0,A=g.length;S<A;++S){var k=Math.round(g[S][0])-1,E=Math.round(g[S][1])-1;if(domainStr=k+","+E,!b.hasOwnProperty(domainStr)){b[domainStr]=1,y.push(k+r.baseResi[e]),_.push(E+r.baseResi[e]),C+=E-k+1;for(var x=k;x<=E;++x)w[x+1]=1}}var R='<div class="icn3d-seqTitle icn3d-link icn3d-blue" 3ddomain="'+(u+1).toString()+'" from="'+y+'" to="'+_+'" shorttitle="'+v+'" index="'+u+'" setname="'+e+"_3d_domain_"+u+'" anno="sequence" chain="'+e+'" title="'+f+'">'+v+" </div>",T='<span class="icn3d-residueNum" title="residue count">'+C.toString()+" Res</span>";c+=R+T+"<br>";var H='<span class="icn3d-seqLine">';s+=R+T+H,a+=R+T+H;for(var D="domain3d"+u.toString(),S=0,A=r.giSeq[e].length;S<A;++S)if(s+=r.insertGap(e,S,"-"),w.hasOwnProperty(S+1)){var I=r.giSeq[e][S],O=I;I.length>1&&(O=I[0]+"..");var d=S>=r.matchedPos[e]&&S-r.matchedPos[e]<r.icn3d.chainsSeq[e].length?r.icn3d.chainsSeq[e][S-r.matchedPos[e]].resi:r.baseResi[e]+1+S;s+='<span id="'+D+"_"+r.pre+e+"_"+d+'" title="'+O+d+'" class="icn3d-residue">'+I+"</span>"}else s+="<span>-</span>";var M=r.icn3d.getFirstCalphaAtomObj(r.icn3d.chains[e]),L=M.color?M.color.getHexString():r.icn3d.defaultAtomColor;if(r.cfg.blast_rep_id!=e)for(var S=0,A=y.length;S<A;++S){var P=0==S?Math.round(r.seqAnnWidth*y[S]/r.maxAnnoLength):Math.round(r.seqAnnWidth*(y[S]-_[S-1]-1)/r.maxAnnoLength);a+='<div style="display:inline-block; width:'+P+'px;">&nbsp;</div>',a+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+L+"; width:"+Math.round(r.seqAnnWidth*(_[S]-y[S]+1)/r.maxAnnoLength)+'px;" class="icn3d-seqTitle icn3d-link icn3d-blue" 3ddomain="'+(u+1).toString()+'" from="'+y+'" to="'+_+'" shorttitle="'+v+'" index="'+u+'" setname="'+e+"_3d_domain_"+u+'" id="'+e+"_3d_domain_"+u+'" anno="sequence" chain="'+e+'" title="'+f+'">3D domain '+(u+1).toString()+"</div>"}else{for(var N=[],z=[],S=0,A=y.length;S<A;++S){N.push(y[S]);for(var x=y[S];x<=_[S];++x)void 0!==r.targetGapHash&&r.targetGapHash.hasOwnProperty(x)&&(z.push(x-1),N.push(x));z.push(_[S])}for(var S=0,A=N.length;S<A;++S){a+=r.insertGapOverview(e,N[S]);var P=0==S?Math.round(r.seqAnnWidth*N[S]/(r.maxAnnoLength+r.nTotalGap)):Math.round(r.seqAnnWidth*(N[S]-z[S-1]-1)/(r.maxAnnoLength+r.nTotalGap));a+='<div style="display:inline-block; width:'+P+'px;">&nbsp;</div>',a+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+L+"; width:"+Math.round(r.seqAnnWidth*(z[S]-N[S]+1)/(r.maxAnnoLength+r.nTotalGap))+'px;" class="icn3d-seqTitle icn3d-link icn3d-blue" 3ddomain="'+(u+1).toString()+'" from="'+N+'" to="'+z+'" shorttitle="'+v+'" index="'+u+'" setname="'+e+"_3d_domain_"+u+'" id="'+e+"_3d_domain_"+u+'" anno="sequence" chain="'+e+'" title="'+f+'">3D domain '+(u+1).toString()+"</div>"}}H='<span class="icn3d-residueNum" title="residue count">&nbsp;'+C.toString()+" Residues</span>",H+="</span>",H+="<br>",s+=H,a+=H}s+="</div>",a+="</div>",c+="</div>",$("#"+r.pre+"dt_domain_"+e).html(s),$("#"+r.pre+"ov_domain_"+e).html(a),$("#"+r.pre+"tt_domain_"+e).html(c)},iCn3DUI.prototype.showInteraction=function(e,t){var i=this;void 0!==i.chainname2residues||void 0===i.cfg.mmdbid&&void 0===i.cfg.gi&&void 0===i.cfg.blast_rep_id&&void 0===i.cfg.align?i.showInteraction_base(e,t):setTimeout(function(){i.showInteraction_base(e,t)},1e3)},iCn3DUI.prototype.showInteraction_base=function(e,t){var i=this;void 0===i.chainname2residues&&(i.chainname2residues={});var n=4,o=Object.keys(i.icn3d.chains),r=e,s=Math.round(r.indexOf("_"));if(!(s>4)){var a=i.icn3d.getFirstCalphaAtomObj(i.icn3d.chains[r]);if(void 0===i.chainname2residues[r]){i.chainname2residues[r]={};var c=o.length;if(c>100&&void 0===i.cfg.mmdbid&&void 0===i.cfg.gi&&void 0===i.cfg.blast_rep_id&&void 0===i.cfg.align)return $("#"+i.pre+"dt_interaction_"+e).html(""),void $("#"+i.pre+"ov_interaction_"+e).html("");for(var d=0;d<c;++d){var l=o[d];if(l!==r&&l.substr(0,l.indexOf("_"))===r.substr(0,r.indexOf("_"))&&(s=Math.round(r.indexOf("_")),!(s>4))){var p,h=i.icn3d.getFirstCalphaAtomObj(i.icn3d.chains[l]);i.icn3d.chemicals.hasOwnProperty(h.serial)?p="chemical":i.icn3d.nucleotides.hasOwnProperty(h.serial)?p="nucleotide":i.icn3d.ions.hasOwnProperty(h.serial)?p="ion":i.icn3d.proteins.hasOwnProperty(h.serial)?p="protein":i.icn3d.water.hasOwnProperty(h.serial)&&(p="water");var u=i.icn3d.getAtomsWithinAtom(i.icn3d.hash2Atoms(i.icn3d.chains[r]),i.icn3d.hash2Atoms(i.icn3d.chains[l]),n);if(0!=Object.keys(u).length){var m={};for(var f in u){var a=i.icn3d.atoms[f],v=a.structure+"_"+a.chain+"_"+a.resi;m[v]=1}var g=l.substr(l.indexOf("_")+1)+" ("+p+")";i.chainname2residues[r][g]=Object.keys(m)}}}}var b='<div id="'+i.pre+e+'_interseq_sequence" class="icn3d-dl_sequence">',y=b,_=b,w=0;for(var C in i.chainname2residues[e]){var S=i.chainname2residues[e][C],A="Interact ."+C;A.length>17&&(A=A.substr(0,17)+"...");for(var k="Interact ."+C,E=[],x=0,R=S.length;x<R;++x){var T=S[x],H=Math.round(T.substr(S[x].lastIndexOf("_")+1)),D=Object.keys(i.icn3d.residues[T])[0];(i.icn3d.proteins.hasOwnProperty(D)||i.icn3d.nucleotides.hasOwnProperty(D))&&E.push(H)}var I=E.length;if(0!=I){var O=C.replace(/\s/g,""),M='<div class="icn3d-seqTitle icn3d-link icn3d-blue" interaction="'+(w+1).toString()+'" posarray="'+E.toString()+'" shorttitle="'+A+'" setname="'+e+"_"+O+'" anno="sequence" chain="'+e+'" title="'+k+'">'+A+" </div>",L='<span class="icn3d-residueNum" title="residue count">'+I.toString()+" Res</span>";_+=M+L+"<br>";var P='<span class="icn3d-seqLine">';b+=M+L+P,y+=M+L+P;for(var N="inter"+w.toString(),z=0,q=0,F=1,x=0,R=i.giSeq[e].length;x<R;++x)if(b+=i.insertGap(e,x,"-"),E.indexOf(x+1+i.baseResi[e])!=-1){var j=i.giSeq[e][x],U=j;j.length>1&&(U=j[0]+"..");var s=x>=i.matchedPos[e]&&x-i.matchedPos[e]<i.icn3d.chainsSeq[e].length?i.icn3d.chainsSeq[e][x-i.matchedPos[e]].resi:i.baseResi[e]+1+x;b+='<span id="'+N+"_"+i.pre+e+"_"+s+'" title="'+j+s+'" class="icn3d-residue">'+U+"</span>",y+=i.insertGapOverview(e,x);var B=i.cfg.blast_rep_id==e?Math.round(i.seqAnnWidth*x/(i.maxAnnoLength+i.nTotalGap)-z-q):Math.round(i.seqAnnWidth*x/i.maxAnnoLength-z-q);B<0&&(B=0),y+='<div style="display:inline-block; width:'+B+'px;">&nbsp;</div>',y+='<div style="display:inline-block; background-color:#000; width:'+F+'px;" title="'+U+s+'">&nbsp;</div>',z+=B,q+=F}else b+="<span>-</span>";P='<span class="icn3d-residueNum" title="residue count">&nbsp;'+I.toString()+" Residues</span>",P+="</span>",P+="<br>",b+=P,y+=P,++w}}b+="</div>",y+="</div>",_+="</div>",$("#"+i.pre+"dt_interaction_"+e).html(b),$("#"+i.pre+"ov_interaction_"+e).html(y),$("#"+i.pre+"tt_interaction_"+e).html(_),i.isMobile()?(i.selectSequenceMobile(),i.selectChainMobile()):i.selectSequenceNonMobile()}},iCn3DUI.prototype.showSsbond=function(e,t){var i=this;void 0===i.icn3d.ssbondpnts?setTimeout(function(){i.showSsbond_base(e,t)},1e3):i.showSsbond_base(e,t)},iCn3DUI.prototype.showSsbond_base=function(e,t){var i=this,n=(Object.keys(i.icn3d.chains),t),o=(i.icn3d.getFirstCalphaAtomObj(i.icn3d.chains[n]),'<div id="'+i.pre+e+'_ssbondseq_sequence" class="icn3d-dl_sequence">'),r=o,s=o,a={},c=n.substr(0,n.indexOf("_")),d=i.icn3d.ssbondpnts[c];if(void 0===d)return $("#"+i.pre+"dt_ssbond_"+e).html(""),$("#"+i.pre+"ov_ssbond_"+e).html(""),void $("#"+i.pre+"tt_ssbond_"+e).html("");for(var l=0,p=d.length;l<p;l+=2){var h=d[l],u=d[l+1],m=h.substr(0,h.lastIndexOf("_")),f=u.substr(0,u.lastIndexOf("_"));n===m&&(void 0===a[h]&&(a[h]=[]),a[h].push(u)),n===f&&(void 0===a[u]&&(a[u]=[]),a[u].push(h))}var v=Object.keys(a),g="Disulfide Bonds";g.length>17&&(g=g.substr(0,17)+"...");for(var b=g,y=[],l=0,p=v.length;l<p;++l){var _=v[l],w=Math.round(_.substr(v[l].lastIndexOf("_")+1));y.push(w)}if(0===y.length)return $("#"+i.pre+"dt_ssbond_"+e).html(""),$("#"+i.pre+"ov_ssbond_"+e).html(""),void $("#"+i.pre+"tt_ssbond_"+e).html("");var C=y.length,S="ssbond",A='<div class="icn3d-seqTitle icn3d-link icn3d-blue" ssbond="" posarray="'+y.toString()+'" shorttitle="'+g+'" setname="'+e+"_"+S+'" anno="sequence" chain="'+e+'" title="'+b+'">'+g+" </div>",k='<span class="icn3d-residueNum" title="residue count">'+C.toString()+" Res</span>";s+=A+k+"<br>";var E='<span class="icn3d-seqLine">';o+=A+k+E,r+=A+k+E;for(var x="ssbond",R=0,T=0,H=1,l=0,p=i.giSeq[e].length;l<p;++l)if(o+=i.insertGap(e,l,"-"),y.indexOf(l+1+i.baseResi[e])!=-1){var D=i.giSeq[e][l],I=D;D.length>1&&(I=D[0]+"..");var O=l>=i.matchedPos[e]&&l-i.matchedPos[e]<i.icn3d.chainsSeq[e].length?i.icn3d.chainsSeq[e][l-i.matchedPos[e]].resi:i.baseResi[e]+1+l,_=e+"_"+(l+1+i.baseResi[e]).toString(),g="Residue "+_+" has disulfide bond with";if(void 0!==a[_])for(var M=0,L=a[_].length;M<L;++M)g+=" residue "+a[_][M];o+='<span id="'+x+"_"+i.pre+e+"_"+O+'" title="'+g+'" class="icn3d-residue">'+I+"</span>",r+=i.insertGapOverview(e,l);var P=i.cfg.blast_rep_id==e?Math.round(i.seqAnnWidth*l/(i.maxAnnoLength+i.nTotalGap)-R-T):Math.round(i.seqAnnWidth*l/i.maxAnnoLength-R-T);P<0&&(P=0),r+='<div style="display:inline-block; width:'+P+'px;">&nbsp;</div>',r+='<div style="display:inline-block; background-color:#000; width:'+H+'px;" title="'+g+'">&nbsp;</div>',R+=P,T+=H}else o+="<span>-</span>";E='<span class="icn3d-residueNum" title="residue count">&nbsp;'+C.toString()+" Residues</span>",E+="</span>",E+="<br>",o+=E,r+=E,o+="</div>",r+="</div>",s+="</div>",$("#"+i.pre+"dt_ssbond_"+e).html(o),$("#"+i.pre+"ov_ssbond_"+e).html(r),$("#"+i.pre+"tt_ssbond_"+e).html(s)},iCn3DUI.prototype.hideAllAnno=function(){var e=this;$("[id^="+e.pre+"site]").hide(),$("[id^="+e.pre+"snp]").hide(),$("[id^="+e.pre+"clinvar]").hide(),$("[id^="+e.pre+"cdd]").hide(),$("[id^="+e.pre+"domain]").hide(),$("[id^="+e.pre+"interaction]").hide(),$("[id^="+e.pre+"custom]").hide(),$("[id^="+e.pre+"ssbond]").hide()},iCn3DUI.prototype.setAnnoTabAll=function(){var e=this;$("#"+e.pre+"anno_all").length&&($("#"+e.pre+"anno_all")[0].checked=!0),$("#"+e.pre+"anno_binding").length&&($("#"+e.pre+"anno_binding")[0].checked=!0),$("#"+e.pre+"anno_snp").length&&($("#"+e.pre+"anno_snp")[0].checked=!0),$("#"+e.pre+"anno_clinvar").length&&($("#"+e.pre+"anno_clinvar")[0].checked=!0),$("#"+e.pre+"anno_cdd").length&&($("#"+e.pre+"anno_cdd")[0].checked=!0),$("#"+e.pre+"anno_3dd").length&&($("#"+e.pre+"anno_3dd")[0].checked=!0),$("#"+e.pre+"anno_interact").length&&($("#"+e.pre+"anno_interact")[0].checked=!0),$("#"+e.pre+"anno_custom").length&&($("#"+e.pre+"anno_custom")[0].checked=!0),$("#"+e.pre+"anno_ssbond").length&&($("#"+e.pre+"anno_ssbond")[0].checked=!0),$("[id^="+e.pre+"site]").show(),$("[id^="+e.pre+"snp]").show(),$("[id^="+e.pre+"clinvar]").show(),$("[id^="+e.pre+"cdd]").show(),$("[id^="+e.pre+"domain]").show(),$("[id^="+e.pre+"interaction]").show(),$("[id^="+e.pre+"custom]").show(),$("[id^="+e.pre+"ssbond]").show(),e.updateSnpClinvar(),e.updateDomain(),e.updateInteraction(),e.updateSsbond()},iCn3DUI.prototype.hideAnnoTabAll=function(){var e=this;$("#"+e.pre+"anno_all").length&&($("#"+e.pre+"anno_all")[0].checked=!1),$("#"+e.pre+"anno_binding").length&&($("#"+e.pre+"anno_binding")[0].checked=!1),$("#"+e.pre+"anno_snp").length&&($("#"+e.pre+"anno_snp")[0].checked=!1),$("#"+e.pre+"anno_clinvar").length&&($("#"+e.pre+"anno_clinvar")[0].checked=!1),$("#"+e.pre+"anno_cdd").length&&($("#"+e.pre+"anno_cdd")[0].checked=!1),$("#"+e.pre+"anno_3dd").length&&($("#"+e.pre+"anno_3dd")[0].checked=!1),$("#"+e.pre+"anno_interact").length&&($("#"+e.pre+"anno_interact")[0].checked=!1),$("#"+e.pre+"anno_custom").length&&($("#"+e.pre+"anno_custom")[0].checked=!1),$("#"+e.pre+"anno_ssbond").length&&($("#"+e.pre+"anno_ssbond")[0].checked=!1),e.hideAllAnno()},iCn3DUI.prototype.setAnnoTabCustom=function(){var e=this;$("[id^="+e.pre+"custom]").show(),$("#"+e.pre+"anno_custom").length&&($("#"+e.pre+"anno_custom")[0].checked=!0)},iCn3DUI.prototype.hideAnnoTabCustom=function(){var e=this;$("[id^="+e.pre+"custom]").hide(),$("#"+e.pre+"anno_custom").length&&($("#"+e.pre+"anno_custom")[0].checked=!1)},iCn3DUI.prototype.setAnnoTabClinvar=function(){var e=this;$("[id^="+e.pre+"clinvar]").show(),$("#"+e.pre+"anno_clinvar").length&&($("#"+e.pre+"anno_clinvar")[0].checked=!0),e.updateSnpClinvar()},iCn3DUI.prototype.hideAnnoTabClinvar=function(){var e=this;$("[id^="+e.pre+"clinvar]").hide(),$("#"+e.pre+"anno_clinvar").length&&($("#"+e.pre+"anno_clinvar")[0].checked=!1)},iCn3DUI.prototype.setAnnoTabSnp=function(){var e=this;$("[id^="+e.pre+"snp]").show(),$("#"+e.pre+"anno_snp").length&&($("#"+e.pre+"anno_snp")[0].checked=!0),e.updateSnpClinvar()},iCn3DUI.prototype.hideAnnoTabSnp=function(){var e=this;$("[id^="+e.pre+"snp]").hide(),$("#"+e.pre+"anno_snp").length&&($("#"+e.pre+"anno_snp")[0].checked=!1)},iCn3DUI.prototype.setAnnoTabCdd=function(){var e=this;$("[id^="+e.pre+"cdd]").show(),$("#"+e.pre+"anno_cdd").length&&($("#"+e.pre+"anno_cdd")[0].checked=!0)},iCn3DUI.prototype.hideAnnoTabCdd=function(){var e=this;$("[id^="+e.pre+"cdd]").hide(),$("#"+e.pre+"anno_cdd").length&&($("#"+e.pre+"anno_cdd")[0].checked=!1)},iCn3DUI.prototype.setAnnoTab3ddomain=function(){var e=this;$("[id^="+e.pre+"domain]").show(),$("#"+e.pre+"anno_3dd").length&&($("#"+e.pre+"anno_3dd")[0].checked=!0),e.updateDomain()},iCn3DUI.prototype.hideAnnoTab3ddomain=function(){var e=this;$("[id^="+e.pre+"domain]").hide(),$("#"+e.pre+"anno_3dd").length&&($("#"+e.pre+"anno_3dd")[0].checked=!1)},iCn3DUI.prototype.setAnnoTabSite=function(){var e=this;$("[id^="+e.pre+"site]").show(),$("#"+e.pre+"anno_binding").length&&($("#"+e.pre+"anno_binding")[0].checked=!0)},iCn3DUI.prototype.hideAnnoTabSite=function(){var e=this;$("[id^="+e.pre+"site]").hide(),$("#"+e.pre+"anno_binding").length&&($("#"+e.pre+"anno_binding")[0].checked=!1)},iCn3DUI.prototype.setAnnoTabInteraction=function(){var e=this;$("[id^="+e.pre+"interaction]").show(),$("#"+e.pre+"anno_interact").length&&($("#"+e.pre+"anno_interact")[0].checked=!0),e.updateInteraction()},iCn3DUI.prototype.hideAnnoTabInteraction=function(){var e=this;$("[id^="+e.pre+"interaction]").hide(),$("#"+e.pre+"anno_interact").length&&($("#"+e.pre+"anno_interact")[0].checked=!1)},iCn3DUI.prototype.setAnnoTabSsbond=function(){var e=this;$("[id^="+e.pre+"ssbond]").show(),$("#"+e.pre+"anno_ssbond").length&&($("#"+e.pre+"anno_ssbond")[0].checked=!0),e.updateSsbond()},iCn3DUI.prototype.hideAnnoTabSsbond=function(){var e=this;$("[id^="+e.pre+"ssbond]").hide(),$("#"+e.pre+"anno_ssbond").length&&($("#"+e.pre+"anno_ssbond")[0].checked=!1)},iCn3DUI.prototype.setTabs=function(){var e=this;$("#"+e.pre+"dl_addtrack_tabs").tabs(),$("#"+e.pre+"dl_anno_view_tabs").tabs(),$("#"+e.pre+"anno_all").click(function(t){$("#"+e.pre+"anno_all")[0].checked?(e.setAnnoTabAll(),e.setLogCmd("set annotation all",!0)):(e.hideAnnoTabAll(),e.setLogCmd("hide annotation all",!0))}),$("#"+e.pre+"anno_binding").click(function(t){$("#"+e.pre+"anno_binding")[0].checked?(e.setAnnoTabSite(),e.setLogCmd("set annotation site",!0)):(e.hideAnnoTabSite(),e.setLogCmd("hide annotation site",!0))}),$("#"+e.pre+"anno_snp").click(function(t){$("#"+e.pre+"anno_snp")[0].checked?(e.setAnnoTabSnp(),e.setLogCmd("set annotation snp",!0)):(e.hideAnnoTabSnp(),e.setLogCmd("hide annotation snp",!0))}),$("#"+e.pre+"anno_clinvar").click(function(t){$("#"+e.pre+"anno_clinvar")[0].checked?(e.setAnnoTabClinvar(),e.setLogCmd("set annotation clinvar",!0)):(e.hideAnnoTabClinvar(),e.setLogCmd("hide annotation clinvar",!0))}),$("#"+e.pre+"anno_cdd").click(function(t){e.clickCdd()}),$("#"+e.pre+"anno_3dd").click(function(t){$("#"+e.pre+"anno_3dd")[0].checked?(e.setAnnoTab3ddomain(),e.setLogCmd("set annotation 3ddomain",!0)):(e.hideAnnoTab3ddomain(),e.setLogCmd("hide annotation 3ddomain",!0))}),$("#"+e.pre+"anno_interact").click(function(t){$("#"+e.pre+"anno_interact")[0].checked?(e.setAnnoTabInteraction(),e.setLogCmd("set annotation interaction",!0)):(e.hideAnnoTabInteraction(),e.setLogCmd("hide annotation interaction",!0))}),$("#"+e.pre+"anno_custom").click(function(t){$("#"+e.pre+"anno_custom")[0].checked?(e.setAnnoTabCustom(),e.setLogCmd("set annotation custom",!0)):(e.hideAnnoTabCustom(),e.setLogCmd("hide annotation custom",!0))}),$("#"+e.pre+"anno_ssbond").click(function(t){$("#"+e.pre+"anno_ssbond")[0].checked?(e.setAnnoTabSsbond(),e.setLogCmd("set annotation ssbond",!0)):(e.hideAnnoTabSsbond(),e.setLogCmd("hide annotation ssbond",!0))})},iCn3DUI.prototype.clickCdd=function(){var e=this;$("[id^="+e.pre+"cdd]").length>0&&($("#"+e.pre+"anno_cdd")[0].checked?(e.setAnnoTabCdd(),e.setLogCmd("set annotation cdd",!0)):(e.hideAnnoTabCdd(),e.setLogCmd("hide annotation cdd",!0)))},iCn3DUI.prototype.setToolTip=function(){var e=this;$("[id^="+e.pre+"snp]").add("[id^="+e.pre+"clinvar]").add("[id^="+e.pre+"ssbond]").tooltip({content:function(){return $(this).prop("title")},show:null,close:function(e,t){t.tooltip.hover(function(){$(this).stop(!0).fadeTo(400,1)},function(){$(this).fadeOut("200",function(){$(this).remove()})})}})},iCn3DUI.prototype.showAnnoSelectedChains=function(){var e=this,t={};for(var i in e.icn3d.hAtoms){var n=e.icn3d.atoms[i],o=n.structure+"_"+n.chain;t[o]=1}$("#"+e.pre+"dl_annotations > .icn3d-annotation").hide();for(var o in t){$("#"+e.pre+"anno_"+o).length&&$("#"+e.pre+"anno_"+o).show();var n=e.icn3d.getFirstCalphaAtomObj(e.icn3d.chains[o]),r=e.icn3d.residueName2Abbr(n.resn.substr(0,3));$("#"+e.pre+"anno_"+r).show()}},iCn3DUI.prototype.showAnnoAllChains=function(){var e=this;$("#"+e.pre+"dl_annotations > .icn3d-annotation").show()},iCn3DUI.prototype.setAnnoView=function(e){var t=this;"detailed view"===e?(t.view="detailed view",$("#"+t.pre+"dl_anno_view_tabs").tabs("option","active",1)):(t.view="overview",$("#"+t.pre+"dl_anno_view_tabs").tabs("option","active",0))},iCn3DUI.prototype.showFixedTitle=function(){var e=this,t="display:block;";$("[id^="+e.pre+"tt_giseq]").attr("style",t),$("[id^="+e.pre+"tt_custom]").attr("style",t),$("[id^="+e.pre+"tt_site]").attr("style",t),$("[id^="+e.pre+"tt_snp]").attr("style",t),$("[id^="+e.pre+"tt_clinvar]").attr("style",t),$("[id^="+e.pre+"tt_cdd]").attr("style",t),$("[id^="+e.pre+"tt_domain]").attr("style",t),$("[id^="+e.pre+"tt_interaction]").attr("style",t),$("[id^="+e.pre+"tt_ssbond]").attr("style",t)},iCn3DUI.prototype.hideFixedTitle=function(){var e=this,t="display:none!important;";$("[id^="+e.pre+"tt_giseq]").attr("style",t),$("[id^="+e.pre+"tt_custom]").attr("style",t),$("[id^="+e.pre+"tt_site]").attr("style",t),$("[id^="+e.pre+"tt_snp]").attr("style",t),$("[id^="+e.pre+"tt_clinvar]").attr("style",t),$("[id^="+e.pre+"tt_cdd]").attr("style",t),$("[id^="+e.pre+"tt_domain]").attr("style",t),$("[id^="+e.pre+"tt_interaction]").attr("style",t),$("[id^="+e.pre+"tt_ssbond]").attr("style",t)},iCn3DUI.prototype.setAnnoViewAndDisplay=function(e){var t=this;if("detailed view"===e){t.setAnnoView("detailed view");var i="display:block;";$("[id^="+t.pre+"dt_giseq]").attr("style",i),$("[id^="+t.pre+"dt_custom]").attr("style",i),$("[id^="+t.pre+"dt_site]").attr("style",i),$("[id^="+t.pre+"dt_snp]").attr("style",i),$("[id^="+t.pre+"dt_clinvar]").attr("style",i),$("[id^="+t.pre+"dt_cdd]").attr("style",i),$("[id^="+t.pre+"dt_domain]").attr("style",i),$("[id^="+t.pre+"dt_interaction]").attr("style",i),$("[id^="+t.pre+"dt_ssbond]").attr("style",i),$("#"+t.pre+"seqguide_wrapper").attr("style",i),i="display:none;",$("[id^="+t.pre+"ov_giseq]").attr("style",i),$("[id^="+t.pre+"ov_custom]").attr("style",i),$("[id^="+t.pre+"ov_site]").attr("style",i),$("[id^="+t.pre+"ov_snp]").attr("style",i),$("[id^="+t.pre+"ov_clinvar]").attr("style",i),$("[id^="+t.pre+"ov_cdd]").attr("style",i),$("[id^="+t.pre+"ov_domain]").attr("style",i),$("[id^="+t.pre+"ov_interaction]").attr("style",i),$("[id^="+t.pre+"ov_ssbond]").attr("style",i)}else{t.setAnnoView("overview"),t.hideFixedTitle();var i="display:none;";$("[id^="+t.pre+"dt_giseq]").attr("style",i),$("[id^="+t.pre+"dt_custom]").attr("style",i),$("[id^="+t.pre+"dt_site]").attr("style",i),$("[id^="+t.pre+"dt_snp]").attr("style",i),$("[id^="+t.pre+"dt_clinvar]").attr("style",i),$("[id^="+t.pre+"dt_cdd]").attr("style",i),$("[id^="+t.pre+"dt_domain]").attr("style",i),$("[id^="+t.pre+"dt_interaction]").attr("style",i),$("[id^="+t.pre+"dt_ssbond]").attr("style",i),$("#"+t.pre+"seqguide_wrapper").attr("style",i),i="display:block;",$("[id^="+t.pre+"ov_giseq]").attr("style",i),$("[id^="+t.pre+"ov_custom]").attr("style",i),$("[id^="+t.pre+"ov_site]").attr("style",i),$("[id^="+t.pre+"ov_snp]").attr("style",i),$("[id^="+t.pre+"ov_clinvar]").attr("style",i),$("[id^="+t.pre+"ov_cdd]").attr("style",i),$("[id^="+t.pre+"ov_domain]").attr("style",i),$("[id^="+t.pre+"ov_interaction]").attr("style",i),$("[id^="+t.pre+"ov_ssbond]").attr("style",i)}},iCn3DUI.prototype.clickAddTrack=function(){var e=this;$(document).on("click",".icn3d-addtrack",function(t){t.stopImmediatePropagation(),$("#"+e.pre+"anno_custom")[0].checked=!0,$("[id^="+e.pre+"custom]").show();var i=$(this).attr("chainid");$("#"+e.pre+"track_chainid").val(i),e.openDialog(e.pre+"dl_addtrack","Add track for Chain: "+i),$("#"+e.pre+"track_gi").focus()})},iCn3DUI.prototype.clickDefineHelix=function(){var e=this;$(document).on("click",".icn3d-helixsets",function(t){t.stopImmediatePropagation();var i=$(this).attr("chainid");e.defineSecondary(i,"helix"),e.setLogCmd("define helix sets | chain "+i,!0)})},iCn3DUI.prototype.clickDefineSheet=function(){var e=this;$(document).on("click",".icn3d-sheetsets",function(t){t.stopImmediatePropagation();var i=$(this).attr("chainid");e.defineSecondary(i,"sheet"),e.setLogCmd("define sheet sets | chain "+i,!0)})},iCn3DUI.prototype.clickDefineCoil=function(){var e=this;$(document).on("click",".icn3d-coilsets",function(t){t.stopImmediatePropagation();var i=$(this).attr("chainid");e.defineSecondary(i,"coil"),e.setLogCmd("define coil sets | chain "+i,!0)})},iCn3DUI.prototype.clickDeleteSets=function(){var e=this;$("#"+e.pre+"deletesets").click(function(t){e.deleteSelectedSets(),e.setLogCmd("delete selected sets",!0)})},iCn3DUI.prototype.defineSecondary=function(e,t){var i=this;$("#"+i.pre+"dl_definedsets").hasClass("ui-dialog-content")&&$("#"+i.pre+"dl_definedsets").dialog("isOpen")||i.openDialog(i.pre+"dl_definedsets","Select sets");var n,o,r={},s=!1,a=!0,c=1,d=0,l=0,p=e+"_C(Nterm";i.icn3d.hAtoms={};for(var h=0,u=i.icn3d.chainsSeq[e].length;h<u;++h){var m=i.icn3d.chainsSeq[e][h].resi,f=e+"_"+m;if(i.icn3d.residues.hasOwnProperty(f)){var v=i.icn3d.getFirstCalphaAtomObj(i.icn3d.residues[f]);currSS=i.icn3d.secondaries[f],"H"==currSS?(v.ssbegin&&(++d,Object.keys(r).length>0&&(o=n+"H"+d+")","coil"==t&&(i.selectResidueList(r,o,o,s,a),s||(s=!0)),r={},++c)),n=e+"_H"+d,r[f]=1,v.ssend&&(p=e+"_C(H"+d,"helix"==t&&(i.selectResidueList(r,n,n,s,a),s||(s=!0)),r={},++c)):"E"==currSS?(v.ssbegin&&(++l,Object.keys(r).length>0&&(o=n+"S"+l+")","coil"==t&&(i.selectResidueList(r,o,o,s,a),s||(s=!0)),r={},++c)),n=e+"_S"+l,r[f]=1,v.ssend&&(p=e+"_C(S"+l,"sheet"==t&&(i.selectResidueList(r,n,n,s,a),s||(s=!0)),r={},++c)):(n=p+"-",r[f]=1)}}Object.keys(r).length>0&&(o=n+"Cterm)","coil"==t&&i.selectResidueList(r,o,o,s,a))},iCn3DUI.prototype.simplifyText=function(e){var t,i="",n=!1,o=-1;for(t=0,il=e.length;t<il;++t)"-"==e[t]||" "==e[t]?(n&&t!==o&&(i+=o+1==t-1?(o+1+1).toString()+" "+e.substr(o+1,t-1-o)+", ":(o+1+1).toString()+"-"+(t-1+1).toString()+" "+e.substr(o+1,t-1-o)+", ",n=!1),o=t):n=!0;return n&&t==il&&(i+=o+1==t-1?(o+1+1).toString()+" "+e.substr(o+1,t-1-o)+", ":(o+1+1).toString()+"-"+(t-1+1).toString()+" "+e.substr(o+1,t-1-o)+", "),i},iCn3DUI.prototype.alignSequenceToStructure=function(e,t,i){var n,o,r=this;void 0!==t.data&&(n=t.data[0].query,o=t.data[0].targets[e.replace(/_/g,"")],o=o.hsps[0]);var s="";if(void 0!==n&&void 0!==o){var a=o.scores.e_value.toPrecision(2);a>1e-200&&(a=parseFloat(a).toExponential());for(var c=(o.scores.bit_score,t.targets[e.replace(/_/g,"")].seqdata),d=n.seqdata,l=o.segs,p={},h=0,u=l.length;h<u;++h)for(var m=l[h],f=0;f<=m.orito-m.orifrom;++f)p[f+m.orifrom]=f+m.from;for(var h=0,u=c.length;h<u;++h)s+=p.hasOwnProperty(h)?d[p[h]]:"-";i+=", E: "+a}else s+="cannot be aligned";r.showNewTrack(e,i,s,void 0,p),r.setLogCmd("add track | chainid "+e+" | title "+i+" | text "+r.simplifyText(s),!0)},iCn3DUI.prototype.clickAddTrackButton=function(){var e=this;$(document).on("click","#"+e.pre+"addtrack_button1",function(t){t.stopImmediatePropagation(),dialog.dialog("close");var i=$("#"+e.pre+"track_chainid").val(),n=$("#"+e.pre+"track_gi").val(),o=isNaN(n)?"Acc "+n:"gi "+n,r="https://www.ncbi.nlm.nih.gov/Structure/pwaln/pwaln.fcgi?from=track";$.ajax({url:r,type:"POST",data:{targets:i,queries:n},dataType:"jsonp",tryCount:0,retryLimit:1,success:function(t){e.alignSequenceToStructure(i,t,o)},error:function(e,t,i){if(this.tryCount++,this.tryCount<=this.retryLimit)return void $.ajax(this)}})}),$(document).on("click","#"+e.pre+"addtrack_button2",function(t){t.stopImmediatePropagation(),dialog.dialog("close");var i=$("#"+e.pre+"track_chainid").val(),n=$("#"+e.pre+"track_fasta").val(),o="fasta "+n.substr(0,5),r="https://www.ncbi.nlm.nih.gov/Structure/pwaln/pwaln.fcgi?from=track";$.ajax({url:r,type:"POST",data:{targets:i,queries:n},dataType:"jsonp",tryCount:0,retryLimit:1,success:function(t){e.alignSequenceToStructure(i,t,o)},error:function(e,t,i){if(this.tryCount++,this.tryCount<=this.retryLimit)return void $.ajax(this)}})}),$(document).on("click","#"+e.pre+"addtrack_button3",function(t){t.stopImmediatePropagation(),dialog.dialog("close");var i=$("#"+e.pre+"track_chainid").val(),n=$("#"+e.pre+"track_bed")[0].files[0];if(n){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");var o=new FileReader;o.onload=function(t){for(var n,o=t.target.result,r=o.split("\n"),s=!1,a=!1,c=0,d=r.length;c<d;++c)if("browser"!=r[c].substr(0,7))if("track"==r[c].substr(0,5)){if(r[c].toLowerCase().indexOf("itemrgb")!=-1&&(s=!0),r[c].toLowerCase().indexOf("colorbystrand=")!=-1){a=!0;var l=r[c].toLowerCase().indexOf("colorbystrand="),p=r[c].substr(l),h=p.indexOf('"');if(h!=-1){var u=p.substr(h+1),m=u.indexOf('"');if(h!=-1){var f=u.substr(0,m);n=f.split(" ")}}}}else{if(""==r[c])continue;var v=r[c].replace(/\s+/g," ").split(" ");(v.length>8||v.length<6)&&(a=!1),v.length<9&&(s=!1);var g=(v[0],v[1]),b=v[2],y=v[3];if(v.length>4){v[4]}if(v.length>5)var _=v[5];if(v.length>6){v[6]}if(v.length>7){v[7]}if(v.length>8)var w=v[8];if(v.length>9){v[9]}if(v.length>10){v[10]}if(v.length>11){v[11]}var C=y,S="51,51,51";s?S=w:a&&("+"==_&&n.length>0?S=n[0]:"-"==_&&n.length>1?S=n[1]:"."==_&&n.length>2&&(S=n[2]));for(var A="",k=[],E=0,x=b;E<x;++E)E<g?(A+="-",k.push("")):(A+=e.giSeq[i][E],k.push("rgb("+S+")"));e.showNewTrack(i,C,A,k),e.setLogCmd("add track | chainid "+i+" | title "+C+" | text "+e.simplifyText(A),!0)}},o.readAsText(n)}else alert("Please select a file...")}),$(document).on("click","#"+e.pre+"addtrack_button4",function(t){t.stopImmediatePropagation(),dialog.dialog("close");var i=$("#"+e.pre+"track_chainid").val(),n=$("#"+e.pre+"track_title").val(),o=$("#"+e.pre+"track_text").val();e.showNewTrack(i,n,e.getFullText(o)),e.setLogCmd("add track | chainid "+i+" | title "+n+" | text "+o,!0)}),$(document).on("click","#"+e.pre+"addtrack_button5",function(t){t.stopImmediatePropagation(),dialog.dialog("close");for(var i=$("#"+e.pre+"track_chainid").val(),n=$("#"+e.pre+"track_selection").val(),o="",r=e.icn3d.intHash(e.icn3d.hAtoms,e.icn3d.chains[i]),s=e.icn3d.getResiduesFromCalphaAtoms(r),a=[],c=0,d=e.giSeq[i].length;c<d;++c){var l=e.giSeq[i][c],p=l;l.length>1&&(p=l[0]);var h=c>=e.matchedPos[i]&&c-e.matchedPos[i]<e.icn3d.chainsSeq[i].length?e.icn3d.chainsSeq[i][c-e.matchedPos[i]].resi:e.baseResi[i]+1+c;if(s.hasOwnProperty(i+"_"+h)){var u=e.icn3d.getFirstCalphaAtomObj(e.icn3d.residues[i+"_"+h]),m=u.color.getHexString();o+=p,a.push("#"+m)}else o+="-",a.push("")}e.showNewTrack(i,n,o,a),e.setLogCmd("add track | chainid "+i+" | title "+n+" | text "+e.simplifyText(o),!0)})},iCn3DUI.prototype.showNewTrack=function(e,t,i,n,o){var r=this,s=!1;"cannot be aligned"==i&&(s=!0);var a=i.replace(/-/g,""),c=a.length;if(c>r.giSeq[e].length&&(c=r.giSeq[e].length),i.length>r.giSeq[e].length)i=i.substr(0,r.giSeq[e].length);else if(i.length<r.giSeq[e].length&&!s){for(var d="",l=0,p=r.giSeq[e].length-i.length;l<p;++l)d+="-";i+=d}var h=t.replace(/\s/g,"_").replace(/\./g,"dot").replace(/\W/g,"");h.length>20&&(h=h.substr(0,20));var u=r.RESIDUE_WIDTH*i.length+200;
$("#"+r.pre+"dt_custom_"+e).append("<div id='"+r.pre+"dt_custom_"+e+"_"+h+"'></div>"),$("#"+r.pre+"dt_custom_"+e+"_"+h).width(u),$("#"+r.pre+"ov_custom_"+e).append("<div id='"+r.pre+"ov_custom_"+e+"_"+h+"'></div>"),$("#"+r.pre+"ov_custom_"+e+"_"+h).width(u),$("#"+r.pre+"tt_custom_"+e).append("<div id='"+r.pre+"tt_custom_"+e+"_"+h+"'></div>"),$("#"+r.pre+"tt_custom_"+e+"_"+h).width(u);var m='<div id="'+r.pre+'giseq_sequence" class="icn3d-dl_sequence">',f=m,v=m,g='<div class="icn3d-seqTitle" gi="'+e+'" anno="sequence" chain="'+e+'"><span style="white-space:nowrap;">'+t+"</span></div>",b='<span class="icn3d-residueNum" title="residue count">'+c.toString()+" Pos</span>";v+=g+b+"<br>";var y='<span class="icn3d-seqLine">';m+=g+b+y,f+=g+b+y;for(var _=e.indexOf("_"),w="cst"+e.substr(_),C=0,S=0,A=1,l=0,p=i.length;l<p;++l){m+=r.insertGap(e,l,"-");var k=i.charAt(l);if(" "!=k&&"-"!=k){var E=r.icn3d.chainsSeq[e][l].resi-r.matchedPos[e];void 0!==o&&(E=o[l]+1),m+=void 0!==n&&""!=n[l]?'<span id="'+w+"_"+r.pre+e+"_"+E+'" title="'+k+E+'" class="icn3d-residue" style="color:'+n[l]+'">'+k+"</span>":'<span id="'+w+"_"+r.pre+e+"_"+E+'" title="'+k+E+'" class="icn3d-residue">'+k+"</span>",f+=r.insertGapOverview(e,l);var x=r.cfg.blast_rep_id==e?Math.round(r.seqAnnWidth*l/(r.maxAnnoLength+r.nTotalGap)-C-S):Math.round(r.seqAnnWidth*l/r.maxAnnoLength-C-S);x<0&&(x=0),f+='<div style="display:inline-block; width:'+x+'px;">&nbsp;</div>',f+=void 0!==n&&""!=n[l]?'<div style="display:inline-block; background-color:'+n[l]+"; width:"+A+'px;" title="'+k+(l+1).toString()+'">&nbsp;</div>':'<div style="display:inline-block; background-color:#333; width:'+A+'px;" title="'+k+(l+1).toString()+'">&nbsp;</div>',C+=x,S+=A}else m+=s?"<span>"+k+"</span>":"<span>-</span>"}var y='<span class="icn3d-residueNum" title="residue count">'+c.toString()+" Pos</span>";y+="</span>",y+="<br>",y+="</div>",m+=y,f+=y,v+="</div>",$("#"+r.pre+"dt_custom_"+e+"_"+h).html(m),$("#"+r.pre+"ov_custom_"+e+"_"+h).html(f),$("#"+r.pre+"tt_custom_"+e+"_"+h).html(v)},iCn3DUI.prototype.checkGiSeq=function(e,t,i,n){var o=this;return!(n>20)&&(void 0!==o.giSeq&&void 0!==o.giSeq[e]?(i=o.getFullText(i),o.showNewTrack(e,t,i),!1):void setTimeout(function(){o.checkGiSeq(e,t,i,n+1)},100))},iCn3DUI.prototype.getFullText=function(e){for(var t="",i=e.split(","),n=-1,o=0,r=i.length;o<r;++o){var s=i[o].trim();if(0!=s.length){var a=s.split(" ");if(2===a.length){var c,d,l=a[1],p=a[0].split("-");if(2==p.length)c=p[0]-1,d=p[1]-1;else{if(1!=p.length)continue;c=p[0]-1,d=c}for(var h=0;h<c-n-1;++h)t+="-";var u=d-c+1;t+=l.length>u?l.substr(0,u):l;for(var h=0;h<u-l.length;++h)t+="-";n=d}}}return t},iCn3DUI.prototype.clickShow_selected=function(){var e=this;$("#"+e.pre+"show_selected").add("#"+e.pre+"mn2_show_selected").click(function(t){e.showSelection(),e.setLogCmd("show selection",!0)})},iCn3DUI.prototype.showSelection=function(e){var t=this;t.icn3d.dAtoms={},t.icn3d.dAtoms=t.icn3d.cloneHash(t.icn3d.hAtoms);var i=t.icn3d.centerAtoms(t.icn3d.hash2Atoms(t.icn3d.dAtoms));t.icn3d.maxD=i.maxD,t.icn3d.maxD<5&&(t.icn3d.maxD=5),t.icn3d.opts.rotationcenter="display center",t.saveSelectionIfSelected(),t.icn3d.draw(),t.update2DdgmContent(),t.updateHl2D(),t.showAnnoSelectedChains()},iCn3DUI.prototype.clickModeswitch=function(){var e=this;$("#"+e.pre+"modeswitch").click(function(t){$("#"+e.pre+"modeswitch")[0].checked?e.setModeAndDisplay("selection"):e.setModeAndDisplay("all")}),$("#"+e.pre+"mn6_modeall").click(function(t){e.setModeAndDisplay("all")}),$("#"+e.pre+"mn6_modeselection").click(function(t){e.setModeAndDisplay("selection")})},iCn3DUI.prototype.selectAll=function(){var e=this;e.icn3d.hAtoms={};for(var t in e.icn3d.chains)e.icn3d.hAtoms=e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.chains[t]),e.icn3d.dAtoms=e.icn3d.unionHash(e.icn3d.dAtoms,e.icn3d.chains[t]);e.icn3d.removeHlObjects(),e.removeHl2D(),e.removeHlMenus(),e.bSelectResidue=!1,e.bSelectAlignResidue=!1,e.removeSeqResidueBkgd(),e.update2DdgmContent(),$("#"+e.pre+"dl_annotations > .icn3d-annotation").show(),e.setMode("all")},iCn3DUI.prototype.setModeAndDisplay=function(e){var t=this;"all"===e?(t.setMode("all"),t.icn3d.prevHighlightAtoms=t.icn3d.cloneHash(t.icn3d.hAtoms),t.setLogCmd("set mode all",!0),t.selectAll(),t.icn3d.draw()):(t.setMode("selection"),void 0!==t.icn3d.prevHighlightAtoms?t.icn3d.hAtoms=t.icn3d.cloneHash(t.icn3d.prevHighlightAtoms):t.selectAll(),t.setLogCmd("set mode selection",!0),t.updateHlAll())},iCn3DUI.prototype.setMode=function(e){var t=this;"all"===e?($("#"+t.pre+"modeall").show(),$("#"+t.pre+"modeselection").hide(),$("#"+t.pre+"modeswitch")[0].checked=!1,$("#"+t.pre+"style").hasClass("icn3d-modeselection")&&$("#"+t.pre+"style").removeClass("icn3d-modeselection"),$("#"+t.pre+"color").hasClass("icn3d-modeselection")&&$("#"+t.pre+"color").removeClass("icn3d-modeselection")):($("#"+t.pre+"modeall").hide(),$("#"+t.pre+"modeselection").show(),$("#"+t.pre+"modeswitch")[0].checked=!0,$("#"+t.pre+"style").hasClass("icn3d-modeselection")||$("#"+t.pre+"style").addClass("icn3d-modeselection"),$("#"+t.pre+"color").hasClass("icn3d-modeselection")||$("#"+t.pre+"color").addClass("icn3d-modeselection"))},iCn3DUI.prototype.saveSelection=function(e,t){var i=this;i.selectedResidues={},i.selectedResidues=i.icn3d.getResiduesFromCalphaAtoms(i.icn3d.hAtoms),Object.keys(i.selectedResidues).length>0&&(i.selectResidueList(i.selectedResidues,e,t),i.updateSelectionNameDesc(),i.setLogCmd("select "+i.residueids2spec(Object.keys(i.selectedResidues))+" | name "+e,!0))},iCn3DUI.prototype.removeSelection=function(){var e=this;e.bAnnotations||e.removeSeqChainBkgd(),e.icn3d.bCtrl||e.icn3d.bShift||(e.removeSeqResidueBkgd(),e.removeSeqChainBkgd()),e.selectedResidues={},e.bSelectResidue=!1,e.icn3d.hAtoms={},e.icn3d.removeHlObjects(),e.removeHl2D()},iCn3DUI.prototype.updateSelectionNameDesc=function(){var e=this,t=Object.keys(e.icn3d.defNames2Residues).length+Object.keys(e.icn3d.defNames2Atoms).length;$("#"+e.pre+"seq_command_name").val("seq_"+t),$("#"+e.pre+"seq_command_name2").val("seq_"+t),$("#"+e.pre+"alignseq_command_name").val("alseq_"+t)},iCn3DUI.prototype.selectAChain=function(e,t,i,n){var o=this,t=t.replace(/\s/g,""),r=void 0!==i||i?"select alignChain "+e:"select chain "+e;void 0!==n&&n?(o.icn3d.hAtoms=o.icn3d.unionHash(o.icn3d.hAtoms,o.icn3d.chains[e]),void 0===o.menuHlHash&&(o.menuHlHash={})):(o.icn3d.hAtoms={},o.menuHlHash={}),o.menuHlHash[e]=1;for(var s=i?o.icn3d.alnChainsSeq[e]:o.icn3d.chainsSeq[e],a={},c=0,d=s.length;c<d;++c){var l=s[c],p=e+"_"+l.resi,h=l.name;if(""!==h&&"-"!==h){a[p]=1;for(var u in o.icn3d.residues[p])o.icn3d.hAtoms[u]=1}}void 0!==o.icn3d.defNames2Atoms&&o.icn3d.defNames2Atoms.hasOwnProperty(e)||void 0!==o.icn3d.defNames2Residues&&o.icn3d.defNames2Residues.hasOwnProperty(e)||o.addCustomSelection(Object.keys(a),t,t,r,!0);var m=!0;i?o.updateHlAll(void 0,void 0,n,m):o.updateHlAll(Object.keys(o.menuHlHash),void 0,n,m)},iCn3DUI.prototype.selectResidueList=function(e,t,i,n,o){var r=this;if(Object.keys(e).length>0){void 0!==n&&n?void 0===r.menuHlHash&&(r.menuHlHash={}):(r.icn3d.hAtoms={},r.menuHlHash={});for(var s in e)for(var a in r.icn3d.residues[s])r.icn3d.hAtoms[a]=1;var t=t.replace(/\s/g,"");r.menuHlHash[t]=1;var c="select "+r.residueids2spec(Object.keys(e)),d=Object.keys(e);r.addCustomSelection(d,t,i,c,!0),(void 0===o||o)&&r.updateHlAll(Object.keys(r.menuHlHash),void 0,n)}},iCn3DUI.prototype.addCustomSelection=function(e,t,i,n,o){var r=this;o?r.icn3d.defNames2Residues[t]=e:r.icn3d.defNames2Atoms[t]=e,r.icn3d.defNames2Command[t]=n,r.icn3d.defNames2Descr[t]=i,r.updateHlMenus([t])},iCn3DUI.prototype.selectSideChains=function(){var e=this,t=e.icn3d.cloneHash(e.icn3d.hAtoms);e.icn3d.hAtoms={};for(var i in t)e.icn3d.proteins.hasOwnProperty(i)&&"CA"!==e.icn3d.atoms[i].name&&(e.icn3d.hAtoms[i]=1);e.showHighlight()},iCn3DUI.prototype.clickCommand_apply=function(){var e=this;$("#"+e.pre+"command_apply").click(function(t){t.preventDefault();var i=$("#"+e.pre+"command").val(),n=$("#"+e.pre+"command_name").val().replace(/;/g,"_").replace(/\s+/g,"_");e.selectByCommand(i,n,n),e.setLogCmd("select "+i+" | name "+n,!0)}),$("#"+e.pre+"command_apply2").click(function(t){t.preventDefault();var i=$("#"+e.pre+"command2").val(),n=$("#"+e.pre+"command_name2").val().replace(/;/g,"_").replace(/\s+/g,"_");e.selectByCommand(i,n,n),e.setLogCmd("select "+i+" | name "+n,!0)})},iCn3DUI.prototype.selectCombinedSets=function(e,t){for(var i=this,n=e.split(" "),o=[],r=[],s=[],a="or",c=0,d=n.length;c<d;++c)"or"!==n[c]&&"and"!==n[c]&&"not"!==n[c]?"or"===a?o.push(n[c]):"and"===a?r.push(n[c]):"not"===a&&s.push(n[c]):a=n[c];null!==n&&i.combineSets(o,r,s,t)},iCn3DUI.prototype.selectByCommand=function(e,t,i){var n=this;if(0===e.indexOf("saved atoms")){var o=12,r=e.substr(o);n.selectCombinedSets(r,t)}else{for(var s=e.replace(/ AND /g," and ").replace(/ OR /g," or ").replace(/ or and /g," and ").replace(/ and /g," or and ").replace(/ or not /g," not ").replace(/ not /g," or not "),a="select"===s.trim().substr(0,6)?s.trim().substr(7):s.trim(),c=a.split(" or "),d={},l=0,p=c.length;l<p;++l){var h=c[l].trim().replace(/\s+/g," "),o=h.indexOf(" ");n.icn3d.hAtoms={},"and"===h.substr(0,o).toLowerCase()?(n.applyCommand("select "+h.substr(o+1)),d=n.icn3d.intHash(d,n.icn3d.hAtoms)):"not"===h.substr(0,o).toLowerCase()?(n.applyCommand("select "+h.substr(o+1)),d=n.icn3d.exclHash(d,n.icn3d.hAtoms)):(n.applyCommand("select "+h),d=n.icn3d.unionHash(d,n.icn3d.hAtoms))}n.icn3d.hAtoms=n.icn3d.cloneHash(d);var u=Object.keys(n.icn3d.hAtoms);if(""!==t){n.addCustomSelection(u,t,i,e,!1);var m=[t];n.changeCustomAtoms(m)}}},iCn3DUI.prototype.selectBySpec=function(e,t,i,n){var o=this;e="select"===e.trim().substr(0,6)?e.trim().substr(7):e.trim(),o.icn3d.hAtoms={};for(var r=e.replace(/\s+/g," ").replace(/ AND /g," and ").split(" and "),s={},a={},c=!0,d=0,l=r.length;d<l;++d){var p,h,u,m,f=r[d].indexOf("$"),v=r[d].indexOf("."),g=r[d].indexOf(":"),b=r[d].indexOf("@"),y=r[d];b===-1?m="*":(m=y.substr(b+1),y=y.substr(0,b)),g===-1?u="*":(u=y.substr(g+1),y=y.substr(0,g)),v===-1?h="*":(h=y.substr(v+1),y=y.substr(0,v)),f===-1?p="*":(p=y.substr(f+1),y=y.substr(0,f)),"*"!==m&&(c=!1);var _,w,C,S,A=[],k=[];if(A="*"===p?Object.keys(o.icn3d.structures):p.split(","),"*"===h)for(var E=Object.keys(o.icn3d.chains),x=0,R=E.length;x<R;++x)w=E[x],_=w.substr(0,w.indexOf("_")),A.toString().toLowerCase().indexOf(_.toLowerCase())!==-1&&k.push(w);else for(var x=0,R=A.length;x<R;++x){_=A[x];var T=h.split(",");for(var H in T)k.push(_+"_"+T[H])}for(var D=u.split(","),x=0,R=D.length;x<R;++x){var I,O=!1,M=D[x].indexOf("-"),L=!1,$=!1;if(M!==-1)C=D[x].substr(0,M),S=D[x].substr(M+1),O=!0;else if(""===D[x]||isNaN(D[x])){if("*"===D[x])L=!0;else if("proteins"!==D[x]&&"nucleotides"!==D[x]&&"chemicals"!==D[x]&&"ions"!==D[x]&&"water"!==D[x]){var P=D[x].toUpperCase();I=P,$=!0}}else C=D[x],S=C,O=!0;for(var N=0,z=k.length;N<z;++N)if(w=k[N],O)for(var H=parseInt(C);H<=parseInt(S);++H){var q=w+"_"+H;0===d?s[q]=1:s.hasOwnProperty(q)||delete s[q];for(var F in o.icn3d.residues[q])"*"!==m&&m!==o.icn3d.atoms[F].name||(0===d?a[F]=1:a.hasOwnProperty(F)||delete a[F])}else if(w in o.icn3d.chains){var j=o.icn3d.chains[w];for(var F in j){var P=o.icn3d.atoms[F].resn.substr(0,3).toUpperCase();if(L||"proteins"===D[x]&&F in o.icn3d.proteins||"nucleotides"===D[x]&&F in o.icn3d.nucleotides||"chemicals"===D[x]&&F in o.icn3d.chemicals||"ions"===D[x]&&F in o.icn3d.ions||"water"===D[x]&&F in o.icn3d.water){if(0===d)s[w+"_"+o.icn3d.atoms[F].resi]=1;else{var U=w+"_"+o.icn3d.atoms[F].resi;s.hasOwnProperty(U)||delete s[U]}"*"!==m&&m!==o.icn3d.atoms[F].name||(0===d?a[F]=1:a.hasOwnProperty(F)||delete a[F])}}if($){for(var B="",G=[],V=0,W=o.icn3d.chainsSeq[w].length;V<W;++V)B+=1==o.icn3d.chainsSeq[w][V].name.length?o.icn3d.chainsSeq[w][V].name:o.icn3d.chainsSeq[w][V].name.substr(0,1),G.push(o.icn3d.chainsSeq[w][V].resi);B=B.toUpperCase();for(var Y=I.replace(/x/gi,"."),X=[],Z=new RegExp(Y,"i"),K=B,Q=K.search(Z),J=Q;Q!==-1;)X.push(J),K=K.substr(Q+1),Q=K.search(Z),J+=Q+1;for(var V=0,W=X.length;V<W;++V)for(var Q=X[V],ee=0,te=I.length;ee<te;++ee){var q=w+"_"+G[ee+Q];0===d?s[q]=1:s.hasOwnProperty(q)||delete s[q];for(var F in o.icn3d.residues[q])"*"!==m&&m!==o.icn3d.atoms[F].name||(0===d?a[F]=1:a.hasOwnProperty(F)||delete a[F])}}}}}o.icn3d.hAtoms=o.icn3d.cloneHash(a),(void 0===n||n)&&o.updateHlAll();var ie;if(ie=c?Object.keys(s):Object.keys(a),""!=t){o.addCustomSelection(ie,t,i,e,c);var ne=[t];o.changeCustomAtoms(ne)}},iCn3DUI.prototype.showSets=function(){var e=this;e.openDialog(e.pre+"dl_definedsets","Select sets"),$("#"+e.pre+"dl_setsmenu").show(),$("#"+e.pre+"dl_setoperations").show(),$("#"+e.pre+"dl_command").hide(),$("#"+e.pre+"atomsCustom").resizable(),void 0!==e.bSetChainsAdvancedMenu&&e.bSetChainsAdvancedMenu||(e.setPredefinedInMenu(),e.bSetChainsAdvancedMenu=!0),e.updateHlMenus()},iCn3DUI.prototype.clickCustomAtoms=function(){var e=this;$("#"+e.pre+"atomsCustom").change(function(t){var i=$(this).val();if(null!==i){var n=!1;e.changeCustomAtoms(i,n),e.setLogCmd("select saved atoms "+i.join(" "+e.setOperation+" "),!0),e.bSelectResidue=!1}}),$("#"+e.pre+"atomsCustom").focus(function(t){e.isMobile()&&$("#"+e.pre+"atomsCustom").val("")})},iCn3DUI.prototype.deleteSelectedSets=function(){for(var e=this,t=$("#"+e.pre+"atomsCustom").val(),i=0;i<t.length;++i){var n=t[i];(void 0!==e.icn3d.defNames2Atoms&&e.icn3d.defNames2Atoms.hasOwnProperty(n)||void 0!==e.icn3d.defNames2Residues&&e.icn3d.defNames2Residues.hasOwnProperty(n))&&(void 0!==e.icn3d.defNames2Atoms&&e.icn3d.defNames2Atoms.hasOwnProperty(n)&&delete e.icn3d.defNames2Atoms[n],void 0!==e.icn3d.defNames2Residues&&e.icn3d.defNames2Residues.hasOwnProperty(n)&&delete e.icn3d.defNames2Residues[n])}e.updateHlMenus()},iCn3DUI.prototype.changeCustomAtoms=function(e,t){var i=this;i.icn3d.hAtoms={};for(var n=0;n<e.length;++n){var o=e[n];if(void 0!==i.icn3d.defNames2Atoms&&i.icn3d.defNames2Atoms.hasOwnProperty(o)||void 0!==i.icn3d.defNames2Residues&&i.icn3d.defNames2Residues.hasOwnProperty(o)){if(void 0!==i.icn3d.defNames2Atoms&&i.icn3d.defNames2Atoms.hasOwnProperty(o))for(var r=i.icn3d.defNames2Atoms[o],s=0,a=r.length;s<a;++s)i.icn3d.hAtoms[r[s]]=1;if(void 0!==i.icn3d.defNames2Residues&&i.icn3d.defNames2Residues.hasOwnProperty(o)){for(var c=i.icn3d.defNames2Residues[o],d={},s=0,a=c.length;s<a;++s)d=i.icn3d.unionHash(d,i.icn3d.residues[c[s]]);i.icn3d.hAtoms=i.icn3d.unionHash(i.icn3d.hAtoms,d)}}}i.updateHlAll(e,t),i.showAnnoSelectedChains(),$("#"+i.pre+"command").val(""),$("#"+i.pre+"command_name").val("");for(var n=0,l=e.length;n<l;++n){var r=i.icn3d.defNames2Atoms[e[n]];i.icn3d.defNames2Residues[e[n]],i.icn3d.defNames2Descr[e[n]];if(0===n)$("#"+i.pre+"command").val("saved atoms "+e[n]),$("#"+i.pre+"command_name").val(e[n]);else{var p=$("#"+i.pre+"command").val();$("#"+i.pre+"command").val(p+" "+i.setOperation+" "+e[n]);var p=$("#"+i.pre+"command_name").val();$("#"+i.pre+"command_name").val(p+" "+i.setOperation+" "+e[n])}}},iCn3DUI.prototype.setHAtomsFromSets=function(e,t){for(var i=this,n=0;n<e.length;++n){var o=e[n];if(void 0!==i.icn3d.defNames2Atoms&&i.icn3d.defNames2Atoms.hasOwnProperty(o)||void 0!==i.icn3d.defNames2Residues&&i.icn3d.defNames2Residues.hasOwnProperty(o)){if(void 0!==i.icn3d.defNames2Atoms&&i.icn3d.defNames2Atoms.hasOwnProperty(o)){var r=i.icn3d.defNames2Atoms[o];if("or"===t)for(var s=0,a=r.length;s<a;++s)i.icn3d.hAtoms[r[s]]=1;else if("and"===t){for(var c={},s=0,a=r.length;s<a;++s)c[r[s]]=1;i.icn3d.hAtoms=i.icn3d.intHash(i.icn3d.hAtoms,c)}else if("not"===t)for(var s=0,a=r.length;s<a;++s)i.icn3d.hAtoms[r[s]]=void 0}if(void 0!==i.icn3d.defNames2Residues&&i.icn3d.defNames2Residues.hasOwnProperty(o)){for(var d=i.icn3d.defNames2Residues[o],c={},s=0,a=d.length;s<a;++s)c=i.icn3d.unionHash(c,i.icn3d.residues[d[s]]);"or"===t?i.icn3d.hAtoms=i.icn3d.unionHash(i.icn3d.hAtoms,c):"and"===t?i.icn3d.hAtoms=i.icn3d.intHash(i.icn3d.hAtoms,c):"not"===t&&(i.icn3d.hAtoms=i.icn3d.exclHash(i.icn3d.hAtoms,c))}}}},iCn3DUI.prototype.updateAdvancedCommands=function(e,t){for(var i=this,n=" "+t+" ",o=0,r=e.length;o<r;++o)if(0===o&&"or"==t)$("#"+i.pre+"command").val("saved atoms "+e[o]),$("#"+i.pre+"command_name").val(e[o]);else{var s=$("#"+i.pre+"command").val();$("#"+i.pre+"command").val(s+n+e[o]);var s=$("#"+i.pre+"command_name").val();$("#"+i.pre+"command_name").val(s+n+e[o])}},iCn3DUI.prototype.combineSets=function(e,t,i,n){var o=this;if(o.icn3d.hAtoms={},o.setHAtomsFromSets(e,"or"),0==Object.keys(o.icn3d.hAtoms).length&&(o.icn3d.hAtoms=o.icn3d.cloneHash(o.icn3d.atoms)),o.setHAtomsFromSets(t,"and"),o.setHAtomsFromSets(i,"not"),o.updateHlAll(),o.showAnnoSelectedChains(),$("#"+o.pre+"command").val(""),$("#"+o.pre+"command_name").val(""),o.updateAdvancedCommands(e,"or"),o.updateAdvancedCommands(t,"and"),o.updateAdvancedCommands(i,"not"),void 0!==n){var r="select "+$("#"+o.pre+"command").val();$("#"+o.pre+"command_name").val(n),o.addCustomSelection(Object.keys(o.icn3d.hAtoms),n,n,r,!1)}},iCn3DUI.prototype.setProtNuclLigInMenu=function(){var e=this;for(var t in e.icn3d.chains)Object.keys(e.icn3d.proteins).length>0&&(e.icn3d.defNames2Residues.proteins=Object.keys(e.icn3d.getResiduesFromAtoms(e.icn3d.proteins)),e.icn3d.defNames2Descr.proteins="proteins",e.icn3d.defNames2Command.proteins="select :proteins"),Object.keys(e.icn3d.nucleotides).length>0&&(e.icn3d.defNames2Residues.nucleotides=Object.keys(e.icn3d.getResiduesFromAtoms(e.icn3d.nucleotides)),e.icn3d.defNames2Descr.nucleotides="nucleotides",e.icn3d.defNames2Command.nucleotides="select :nucleotides"),Object.keys(e.icn3d.chemicals).length>0&&(e.icn3d.defNames2Residues.chemicals=Object.keys(e.icn3d.getResiduesFromAtoms(e.icn3d.chemicals)),e.icn3d.defNames2Descr.chemicals="chemicals",e.icn3d.defNames2Command.chemicals="select :chemicals"),Object.keys(e.icn3d.ions).length>0&&(e.icn3d.defNames2Residues.ions=Object.keys(e.icn3d.getResiduesFromAtoms(e.icn3d.ions)),e.icn3d.defNames2Descr.ions="ions",e.icn3d.defNames2Command.ions="select :ions"),Object.keys(e.icn3d.water).length>0&&(e.icn3d.defNames2Residues.water=Object.keys(e.icn3d.getResiduesFromAtoms(e.icn3d.water)),e.icn3d.defNames2Descr.water="water",e.icn3d.defNames2Command.water="select :water")},iCn3DUI.prototype.setChainsInMenu=function(){var e=this;for(var t in e.icn3d.chains)if(e.icn3d.chainsSeq[t].length>1){e.icn3d.defNames2Residues[t]=Object.keys(e.icn3d.getResiduesFromAtoms(e.icn3d.chains[t])),e.icn3d.defNames2Descr[t]=t;var i=t.indexOf("_"),n=t.substr(0,i),o=t.substr(i+1);e.icn3d.defNames2Command[t]="select $"+n+"."+o}},iCn3DUI.prototype.loadScript=function(e,t){var i=this;i.bCommandLoad=!0,i.icn3d.bRender=!1,i.icn3d.bStopRotate=!0,e=e.replace(/\+/g," ").replace(/;/g,"\n");var n=[];i.icn3d.commands.length>0&&(n[0]=i.icn3d.commands[0]),i.icn3d.commands=e.trim().split("\n"),i.STATENUMBER=i.icn3d.commands.length,i.icn3d.commands=n.concat(i.icn3d.commands),i.STATENUMBER=i.icn3d.commands.length,void 0!==t&&t?i.execCommands(0,i.STATENUMBER-1,i.STATENUMBER):i.execCommands(1,i.STATENUMBER-1,i.STATENUMBER)},iCn3DUI.prototype.loadSelection=function(e){for(var t=this,i=e.trim().split("\n"),n=0,o=i.length;n<o;++n){var r=i[n].split("\t"),s=r[0],a=r[1],c=a.indexOf(" ");t.selectByCommand(a.substr(c+1),s,s,!1)}},iCn3DUI.prototype.execCommands=function(e,t,i){var n=this;n.icn3d.bRender=!1,n.icn3d.reinitAfterLoad(),n.icn3d.opts=n.icn3d.cloneHash(n.opts),n.execCommandsBase(e,t,i)},iCn3DUI.prototype.execCommandsBase=function(e,t,i){for(var n=this,o=e;o<=t;++o){var r=o===i-1;if(n.icn3d.commands[o].indexOf("load")!==-1)return 0===t&&e===t?void(n.bNotLoadStructure?(n.icn3d.hAtoms=n.icn3d.cloneHash(n.icn3d.atoms),1===n.icn3d.commands.length&&(n.bAddCommands=!0),r&&n.renderFinalStep(i)):$.when(n.applyCommandLoad(n.icn3d.commands[o])).then(function(){1===n.icn3d.commands.length&&(n.bAddCommands=!0),r&&n.renderFinalStep(i)})):void(n.bNotLoadStructure?(n.icn3d.hAtoms=n.icn3d.cloneHash(n.icn3d.atoms),void 0!==n.backForward&&n.backForward&&n.renderFinalStep(1),n.execCommandsBase(o+1,t,i)):$.when(n.applyCommandLoad(n.icn3d.commands[o])).then(function(){void 0!==n.backForward&&n.backForward&&n.renderFinalStep(1),n.execCommandsBase(o+1,t,i)}));if(0==n.icn3d.commands[o].trim().indexOf("set map")&&n.icn3d.commands[o].trim().indexOf("set map wireframe")==-1){var s=n.icn3d.commands[o].trim().substr(8),a=s.split(" ");if(3==a.length&&"sigma"==a[1]){var c=(a[2],a[0]);return void(("2fofc"!=c||void 0!==n.bAjax2fofc&&n.bAjax2fofc)&&("fofc"!=c||void 0!==n.bAjaxfofc&&n.bAjaxfofc)?(n.applyCommandMap(n.icn3d.commands[o].trim()),n.execCommandsBase(o+1,t,i)):$.when(n.applyCommandMap(n.icn3d.commands[o].trim())).then(function(){n.execCommandsBase(o+1,t,i)}))}}else if(0==n.icn3d.commands[o].trim().indexOf("set emmap")&&n.icn3d.commands[o].trim().indexOf("set emmap wireframe")==-1){var s=n.icn3d.commands[o].trim().substr(10),a=s.split(" ");if(2==a.length&&"percentage"==a[0]){a[1];return void(void 0!==n.bAjaxEm&&n.bAjaxEm?(n.applyCommandEmmap(n.icn3d.commands[o].trim()),n.execCommandsBase(o+1,t,i)):$.when(n.applyCommandEmmap(n.icn3d.commands[o].trim())).then(function(){n.execCommandsBase(o+1,t,i)}))}}else{if(0==n.icn3d.commands[o].trim().indexOf("view annotations")){var d=n.icn3d.commands[o].split("|||");return void(Object.keys(n.icn3d.proteins).length>0&&(void 0===n.bAjaxCddSite||!n.bAjaxCddSite)?$.when(n.applyCommandAnnotationsAndCddSite(d[0].trim())).then(function(){n.execCommandsBase(o+1,t,i)}):(Object.keys(n.icn3d.proteins).length>0&&n.applyCommandAnnotationsAndCddSiteBase(d[0].trim()),n.execCommandsBase(o+1,t,i)))}if(0==n.icn3d.commands[o].trim().indexOf("set annotation clinvar")||0==n.icn3d.commands[o].trim().indexOf("set annotation snp")){var d=n.icn3d.commands[o].split("|||");return void(Object.keys(n.icn3d.proteins).length>0&&(void 0===n.bAjaxSnpClinvar||!n.bAjaxSnpClinvar)?$.when(n.applyCommandSnpClinvar(d[0].trim())).then(function(){n.execCommandsBase(o+1,t,i)}):(Object.keys(n.icn3d.proteins).length>0&&n.applyCommandSnpClinvar(d[0].trim()),n.execCommandsBase(o+1,t,i)))}if(0==n.icn3d.commands[o].trim().indexOf("set annotation 3ddomain")){var d=n.icn3d.commands[o].split("|||");return void(Object.keys(n.icn3d.proteins).length>0&&void 0===n.mmdb_data&&(void 0===n.bAjax3ddomain||!n.bAjax3ddomain)?$.when(n.applyCommand3ddomain(d[0].trim())).then(function(){n.execCommandsBase(o+1,t,i)}):(Object.keys(n.icn3d.proteins).length>0&&n.applyCommand3ddomain(d[0].trim()),n.execCommandsBase(o+1,t,i)))}if(0==n.icn3d.commands[o].trim().indexOf("set annotation all")){var d=n.icn3d.commands[o].split("|||");return void(!(Object.keys(n.icn3d.proteins).length>0)||void 0!==n.bAjaxSnpClinvar&&n.bAjaxSnpClinvar||void 0!==n.bAjax3ddomain&&n.bAjax3ddomain&&void 0!==n.mmdb_data?Object.keys(n.icn3d.proteins).length>0&&(void 0===n.bAjaxSnpClinvar||!n.bAjaxSnpClinvar)?$.when(n.applyCommandSnpClinvar(d[0].trim())).then(function(){n.setAnnoTabAll(),n.execCommandsBase(o+1,t,i)}):Object.keys(n.icn3d.proteins).length>0&&(void 0===n.bAjax3ddomain||!n.bAjax3ddomain||void 0===n.mmdb_data)?$.when(n.applyCommand3ddomain(d[0].trim())).then(function(){n.setAnnoTabAll(),n.execCommandsBase(o+1,t,i)}):(Object.keys(n.icn3d.proteins).length>0&&(void 0!==n.bAjaxSnpClinvar&&n.bAjaxSnpClinvar||void 0!==n.bAjax3ddomain&&n.bAjax3ddomain&&void 0!==n.mmdb_data?void 0!==n.bAjaxSnpClinvar&&n.bAjaxSnpClinvar?void 0!==n.bAjax3ddomain&&n.bAjax3ddomain&&void 0!==n.mmdb_data||n.applyCommand3ddomainBase(d[0].trim()):n.applyCommandSnpClinvarBase(d[0].trim()):(n.applyCommandSnpClinvarBase(d[0].trim()),n.applyCommand3ddomainBase(d[0].trim()))),n.setAnnoTabAll(),n.execCommandsBase(o+1,t,i)):$.when(n.applyCommandSnpClinvar(d[0].trim())).then(n.applyCommand3ddomain(d[0].trim())).then(function(){n.setAnnoTabAll(),n.execCommandsBase(o+1,t,i)}))}if(0==n.icn3d.commands[o].trim().indexOf("view interactions")&&void 0!==n.cfg.align){var d=n.icn3d.commands[o].split("|||");return void(void 0!==n.b2DShown&&n.b2DShown?n.execCommandsBase(o+1,t,i):$.when(n.applyCommandViewinteraction(d[0].trim())).then(function(){n.execCommandsBase(o+1,t,i)}))}n.applyCommand(n.icn3d.commands[o])}}o===i&&(n.bCommandLoad=!1,n.hideLoading(),o+1===n.icn3d.commands.length&&(n.bAddCommands=!0),n.renderFinalStep(i))},iCn3DUI.prototype.renderFinalStep=function(e){var t=this;t.icn3d.bRender=!0;var i=t.icn3d.commands[e-1].split("|||");if(2==i.length){var n=JSON.parse(i[1]);t.icn3d._zoomFactor=n.factor,t.icn3d.mouseChange.x=n.mouseChange.x,t.icn3d.mouseChange.y=n.mouseChange.y,t.icn3d.quaternion._x=n.quaternion._x,t.icn3d.quaternion._y=n.quaternion._y,t.icn3d.quaternion._z=n.quaternion._z,t.icn3d.quaternion._w=n.quaternion._w}if(1===e||Object.keys(t.icn3d.hAtoms).length===Object.keys(t.icn3d.atoms).length||void 0!==t.icn3d.optsHistory[e-1]&&t.icn3d.optsHistory[e-1].hasOwnProperty("hlatomcount")&&t.icn3d.optsHistory[e-1].hlatomcount===Object.keys(t.icn3d.atoms).length)if(1===e&&(t.icn3d.setAtomStyleByOptions(t.icn3d.optsHistory[e-1]),t.icn3d.setColorByOptions(t.icn3d.optsHistory[e-1],t.icn3d.hAtoms)),t.icn3d.optsHistory.length>=e){var o=t.icn3d.optsHistory[e-1].pk;"no"===o?t.icn3d.pk=0:"atom"===o?t.icn3d.pk=1:"residue"===o?t.icn3d.pk=2:"strand"===o&&(t.icn3d.pk=3),1===e&&t.icn3d.applyOriginalColor(),t.updateHlAll(),jQuery.extend(t.icn3d.opts,t.icn3d.optsHistory[e-1]),t.icn3d.draw()}else t.updateHlAll(),t.icn3d.draw();else t.icn3d.draw()},iCn3DUI.prototype.applyCommandLoad=function(e){var t=this;return t.deferred2=$.Deferred(function(){t.bAddCommands=!1;var i=e.split("|||"),n=i[0].replace(/\s\s/g," ").trim(),o=n.toLowerCase();if(o.indexOf("load")!==-1){var r=o.split(" | "),s=r[0];if(r.length>1){var a=r[r.length-1].indexOf(" ");t.cfg.inpara=r[r.length-1].substr(a+1),"undefined"===t.cfg.inpara&&(t.cfg.inpara="")}var c=s.substr(s.lastIndexOf(" ")+1);if(t.inputid=c,o.indexOf("load mmtf")!==-1)t.cfg.mmtfid=c,t.downloadMmtf(c);else if(o.indexOf("load pdb")!==-1)t.cfg.pdbid=c,t.downloadPdb(c);else if(o.indexOf("load mmcif")!==-1)t.cfg.mmcifid=c,t.downloadMmcif(c);else if(o.indexOf("load mmdb")!==-1)t.cfg.mmdbid=c,t.downloadMmdb(c);else if(o.indexOf("load gi")!==-1)t.cfg.gi=c,t.downloadGi(c);else if(o.indexOf("load seq_struc_ids")!==-1)t.downloadBlast_rep_id(c);else if(o.indexOf("load cid")!==-1)t.cfg.cid=c,t.downloadCid(c);else if(o.indexOf("load align")!==-1)t.cfg.align=c,t.downloadAlignment(c);else if(o.indexOf("load url")!==-1){var d=r[1],l=void 0!==d?d.indexOf("type "):-1,p="pdb";l!==-1&&(p=d.substr(l+5)),t.cfg.url=c,t.downloadUrl(c,p)}}t.bAddCommands=!0}),t.deferred2.promise()},iCn3DUI.prototype.applyCommandMap=function(e){var t=this;return t.deferredMap=$.Deferred(function(){var i=e.substr(8),n=i.split(" ");if(3==n.length&&"sigma"==n[1]){var o=n[2],r=n[0];t.Dsn6Parser(t.inputid,r,o)}}),t.deferredMap.promise()},iCn3DUI.prototype.applyCommandEmmap=function(e){var t=this;return t.deferredEmmap=$.Deferred(function(){var i=e.substr(10),n=i.split(" ");if(2==n.length&&"percentage"==n[0]){var o=n[1],r="em";t.DensityCifParser(t.inputid,r,o,t.icn3d.emd)}}),t.deferredEmmap.promise()},iCn3DUI.prototype.applyCommandAnnotationsAndCddSiteBase=function(e){var t=this;"view annotations"==e&&(void 0!==t.cfg.showanno&&t.cfg.showanno||t.showAnnotations())},iCn3DUI.prototype.applyCommandAnnotationsAndCddSite=function(e){var t=this;return t.deferredAnnoCddSite=$.Deferred(function(){t.applyCommandAnnotationsAndCddSiteBase(e)}),t.deferredAnnoCddSite.promise()},iCn3DUI.prototype.applyCommandSnpClinvarBase=function(e){var t=this,i=e.lastIndexOf(" "),n=e.substr(i+1);"clinvar"==n?t.setAnnoTabClinvar():"snp"==n?t.setAnnoTabSnp():"all"==n&&(t.setAnnoTabClinvar(),t.setAnnoTabSnp())},iCn3DUI.prototype.applyCommandSnpClinvar=function(e){var t=this;return t.deferredSnpClinvar=$.Deferred(function(){t.applyCommandSnpClinvarBase(e)}),t.deferredSnpClinvar.promise()},iCn3DUI.prototype.applyCommand3ddomainBase=function(e){var t=this,i=e.lastIndexOf(" "),n=e.substr(i+1);"3ddomain"!=n&&"all"!=n||t.setAnnoTab3ddomain()},iCn3DUI.prototype.applyCommand3ddomain=function(e){var t=this;return t.deferred3ddomain=$.Deferred(function(){t.applyCommand3ddomainBase(e)}),t.deferred3ddomain.promise()},iCn3DUI.prototype.applyCommandViewinteractionBase=function(e){var t=this;if(void 0!==t.cfg.align){var i=Object.keys(t.icn3d.structures);t.set2DDiagramsForAlign(i[0].toUpperCase(),i[1].toUpperCase())}},iCn3DUI.prototype.applyCommandViewinteraction=function(e){var t=this;return t.deferredViewinteraction=$.Deferred(function(){t.applyCommandViewinteractionBase(e)}),t.deferredViewinteraction.promise()},iCn3DUI.prototype.applyCommand=function(e){var t=this;t.bAddCommands=!1;var i=e.split("|||"),n=i[0].replace(/\s+/g," ").trim(),o=n.toLowerCase(),r=!0,s=t.inputid?t.inputid:"custom";if("export state file"==o);else if("export canvas"==o)setTimeout(function(){t.saveFile(s+"_icn3d_loadable.png","png")},500);else if("export interactions"==o)t.exportInteractions();else if("export stl file"==o)setTimeout(function(){var e=t.saveStlFile();t.saveFile(s+".stl","binary",e),e=""},500);else if("export vrml file"==o)setTimeout(function(){var e=t.saveVrmlFile();t.saveFile(s+".wrl","text",e),e=""},500);else if("export stl stabilizer file"==o)setTimeout(function(){t.hideStabilizer(),t.resetAfter3Dprint(),t.addStabilizer();var e=t.saveStlFile();t.saveFile(s+"_stab.stl","binary",e),e=""},500);else if("export vrml stabilizer file"==o)setTimeout(function(){t.hideStabilizer(),t.resetAfter3Dprint(),t.addStabilizer();var e=t.saveVrmlFile();t.saveFile(s+"_stab.wrl","text",e),e=""},500);else if("select all"==o)t.selectAll();else if("select complement"==o)t.selectComplement();else if("set pk atom"==o)t.icn3d.pk=1,t.icn3d.opts.pk="atom";else if("set pk off"==o)t.icn3d.pk=0,t.icn3d.opts.pk="no",t.icn3d.draw(),t.icn3d.removeHlObjects();else if("set pk residue"==o)t.icn3d.pk=2,t.icn3d.opts.pk="residue";else if("set pk strand"==o)t.icn3d.pk=3,t.icn3d.opts.pk="strand";else if("set pk chain"==o)t.icn3d.pk=4,t.icn3d.opts.pk="chain";else if("set surface wireframe on"==o)t.icn3d.opts.wireframe="yes",t.icn3d.applySurfaceOptions();else if("set surface wireframe off"==o)t.icn3d.opts.wireframe="no",t.icn3d.applySurfaceOptions();else if("set map wireframe on"==o)t.icn3d.opts.mapwireframe="yes",t.icn3d.applyMapOptions();else if("set map wireframe off"==o)t.icn3d.opts.mapwireframe="no",t.icn3d.applyMapOptions();else if("set emmap wireframe on"==o)t.icn3d.opts.emmapwireframe="yes",t.icn3d.applyMapOptions();else if("set emmap wireframe off"==o)t.icn3d.opts.emmapwireframe="no",t.icn3d.applyMapOptions();else if("set surface neighbors on"==o)t.icn3d.bConsiderNeighbors=!0,t.icn3d.applySurfaceOptions();else if("set surface neighbors off"==o)t.icn3d.bConsiderNeighbors=!1,t.icn3d.applySurfaceOptions();else if("set axis on"==o)t.icn3d.opts.axis="yes";else if("set axis off"==o)t.icn3d.opts.axis="no";else if("set fog on"==o)t.icn3d.opts.fog="yes";else if("set fog off"==o)t.icn3d.opts.fog="no";else if("set slab on"==o)t.icn3d.opts.slab="yes";else if("set slab off"==o)t.icn3d.opts.slab="no";else if("set assembly on"==o)t.icn3d.bAssembly=!0;else if("set assembly off"==o)t.icn3d.bAssembly=!1;else if("set chemicalbinding show"==o)t.setOption("chemicalbinding","show");else if("set chemicalbinding hide"==o)t.setOption("chemicalbinding","hide");else if("set hbonds off"==o)t.icn3d.hideHbonds(),t.icn3d.draw();else if("set stabilizer off"==o)t.hideStabilizer(),t.icn3d.draw();else if("set disulfide bonds off"==o)t.icn3d.opts.ssbonds="no",t.icn3d.draw();else if("set cross linkage off"==o)t.icn3d.bShowCrossResidueBond=!1,t.setStyle("proteins","ribbon");else if("set lines off"==o)t.icn3d.labels.distance=[],t.icn3d.lines.distance=[],t.icn3d.draw();else if("set labels off"==o){for(var a in t.icn3d.labels)t.icn3d.labels[a]=[];t.icn3d.draw()}else if("set mode all"==o)t.setModeAndDisplay("all");else if("set mode selection"==o)t.setModeAndDisplay("selection");else if("set view detailed view"==o)t.setAnnoViewAndDisplay("detailed view");else if("set view overview"==o)t.setAnnoViewAndDisplay("overview");else if("set annotation custom"==o)t.setAnnoTabCustom();else if("set annotation interaction"==o)t.setAnnoTabInteraction();else if("set annotation cdd"==o)t.setAnnoTabCdd();else if("set annotation site"==o)t.setAnnoTabSite();else if("set annotation ssbond"==o)t.setAnnoTabSsbond();else if("highlight level up"==o)t.switchHighlightLevelUp();else if("highlight level down"==o)t.switchHighlightLevelDown();else if(0==o.indexOf("hide annotation")){
var c=o.lastIndexOf(" "),d=o.substr(c+1);"all"==d?t.hideAnnoTabAll():"custom"==d?t.hideAnnoTabCustom():"clinvar"==d?t.hideAnnoTabClinvar():"snp"==d?t.hideAnnoTabSnp():"cdd"==d?t.hideAnnoTabCdd():"3ddomain"==d?t.hideAnnoTab3ddomain():"site"==d?t.hideAnnoTabSite():"interaction"==d?t.hideAnnoTabInteraction():"ssbond"==d&&t.hideAnnoTabSsbond()}else if("add residue labels"==o)t.icn3d.addResiudeLabels(t.icn3d.hAtoms),t.icn3d.draw();else if("add chain labels"==o)t.addChainLabels(t.icn3d.hAtoms),t.icn3d.draw();else if("add terminal labels"==o)t.addTerminiLabels(t.icn3d.hAtoms),t.icn3d.draw();else if("rotate left"==o)t.icn3d.bStopRotate=!1,t.ROT_DIR="left",t.rotStruc("left");else if("rotate right"==o)t.icn3d.bStopRotate=!1,t.ROT_DIR="right",t.rotStruc("right");else if("rotate up"==o)t.icn3d.bStopRotate=!1,t.ROT_DIR="up",t.rotStruc("up");else if("rotate down"==o)t.icn3d.bStopRotate=!1,t.ROT_DIR="down",t.rotStruc("down");else if("reset"===o)t.icn3d.reinitAfterLoad(),t.renderFinalStep(1),t.icn3d.render();else if("reset orientation"===o)t.icn3d.resetOrientation(),t.icn3d.draw();else if("reset thickness"==o)t.resetAfter3Dprint(),t.icn3d.draw();else if("clear selection"==o)t.icn3d.removeHlObjects(),t.removeHl2D(),t.icn3d.bShowHighlight=!1,t.bSelectResidue=!1;else if("zoom selection"==o)t.icn3d.zoominSelection(),t.icn3d.draw();else if("center selection"==o)t.icn3d.centerSelection(),t.icn3d.draw();else if("show selection"==o)t.showSelection();else if("output selection"==o)t.outputSelection();else if("toggle selection"==o)t.toggleSelection();else if("toggle highlight"==o)t.icn3d.prevHighlightObjects.length>0?(t.icn3d.removeHlObjects(),t.icn3d.bShowHighlight=!1):(t.icn3d.addHlObjects(),t.icn3d.bShowHighlight=!0);else if("stabilizer"==o)t.addStabilizer(),t.prepareFor3Dprint();else if("disulfide bonds"==o)t.showSsbonds();else if("cross linkage"==o)t.icn3d.bShowCrossResidueBond=!0,t.setStyle("proteins","lines");else if("back"==o)t.back();else if("forward"==o)t.forward();else if("clear all"==o)t.selectAll();else if("defined sets"==o)t.showSets();else if("delete selected sets"==o)t.deleteSelectedSets();else if("view interactions"==o)void 0===t.cfg.mmdbid&&void 0===t.cfg.gi||t.set2DDiagrams(t.inputid);else if("show annotations all chains"==o)t.showAnnoAllChains();else if("save color"==o)t.saveColor();else if("apply saved color"==o)t.applySavedColor();else if("save style"==o)t.saveStyle();else if("apply saved style"==o)t.applySavedStyle();else if("select side chains"==o)t.selectSideChains();else if(0==n.indexOf("define helix sets")){var l=n.split(" | ")[1],p=l.split(" ")[1];t.defineSecondary(p,"helix")}else if(0==n.indexOf("define sheet sets")){var l=n.split(" | ")[1],p=l.split(" ")[1];t.defineSecondary(p,"sheet")}else if(0==n.indexOf("define coil sets")){var l=n.split(" | ")[1],p=l.split(" ")[1];t.defineSecondary(p,"coil")}else if(0==n.indexOf("select interaction")){var h=n.substr(n.lastIndexOf(" ")+1).split(",");if(null!==h){var u=h[0].split("_")[0];t.b2DShown||t.download2Ddgm(u.toUpperCase()),t.selectInteraction(h[0],h[1])}}else if(0==n.indexOf("select saved atoms")){var m=n.split(" | "),f=m[0].replace(/,/g," or "),c=19,v=f.substr(c),g=v;t.selectCombinedSets(v,g)}else if(n.indexOf("select chain")!==-1)for(var h=n.substr(n.lastIndexOf(" ")+1).split(","),b=0,y=h.length;b<y;++b)t.selectAChain(h[b],h[b],!1);else if(n.indexOf("select alignChain")!==-1)for(var h=n.substr(n.lastIndexOf(" ")+1).split(","),b=0,y=h.length;b<y;++b)t.selectAChain(h[b],"align_"+h[b],!0);else if(0==o.indexOf("select zone cutoff")){var _=parseFloat(o.substr(o.lastIndexOf(" ")+1));t.pickCustomSphere(_)}else if(0==o.indexOf("set surface opacity")){var w=o.substr(o.lastIndexOf(" ")+1);t.icn3d.opts.opacity=w,t.icn3d.applySurfaceOptions()}else if(0==o.indexOf("set surface")){var w=o.substr(12);t.icn3d.opts.surface=w,t.icn3d.applySurfaceOptions()}else if(0==o.indexOf("set camera")){var w=o.substr(o.lastIndexOf(" ")+1);t.icn3d.opts.camera=w}else if(0==o.indexOf("set background")){var w=o.substr(o.lastIndexOf(" ")+1);t.icn3d.opts.background=w}else if(0==n.indexOf("set thickness")){var m=o.split(" | ");t.bSetThickness=!0;for(var b=1,y=m.length;b<y;++b){var C=m[b].split(" "),S=C[0],w=parseFloat(C[1]);"linerad"==S&&(t.icn3d.lineRadius=w),"coilrad"==S&&(t.icn3d.coilWidth=w),"stickrad"==S&&(t.icn3d.cylinderRadius=w),"tracerad"==S&&(t.icn3d.traceRadius=w),"ballscale"==S&&(t.icn3d.dotSphereScale=w),"ribbonthick"==S&&(t.icn3d.ribbonthickness=w),"proteinwidth"==S&&(t.icn3d.helixSheetWidth=w),"nucleotidewidth"==S&&(t.icn3d.nucleicAcidWidth=w),t.icn3d.draw()}}else if(0==o.indexOf("set highlight color")){var A=o.substr(20);"yellow"===A?(t.icn3d.hColor=new THREE.Color(16776960),t.icn3d.matShader=t.icn3d.setOutlineColor("yellow")):"green"===A?(t.icn3d.hColor=new THREE.Color(65280),t.icn3d.matShader=t.icn3d.setOutlineColor("green")):"red"===A&&(t.icn3d.hColor=new THREE.Color(16711680),t.icn3d.matShader=t.icn3d.setOutlineColor("red")),t.icn3d.draw()}else if(0==o.indexOf("set highlight style")){var k=o.substr(20);"outline"===k?t.icn3d.bHighlight=1:"3d"===k&&(t.icn3d.bHighlight=2),t.icn3d.draw()}else if(0==o.indexOf("add line")){var m=o.split(" | "),C=m[1].split(" "),E=m[2].split(" "),A=m[3].substr(m[3].lastIndexOf(" ")+1),x="true"===m[4].substr(m[4].lastIndexOf(" ")+1),d=m[5].substr(m[5].lastIndexOf(" ")+1);t.addLine(parseFloat(C[1]),parseFloat(C[3]),parseFloat(C[5]),parseFloat(E[1]),parseFloat(E[3]),parseFloat(E[5]),A,x,d),t.icn3d.draw()}else if(0==n.indexOf("add label")){for(var R,T,H,D,A,I,d,m=n.split(" | "),O=m[0].substr("add label".length+1),M=!1,b=1,y=m.length;b<y;++b){var L=m[b].split(" ");"x"==L[0]?(M=!0,R=L[1],T=L[3],H=L[5]):"size"==L[0]?D=m[b].substr(m[b].lastIndexOf(" ")+1):"color"==L[0]?A=m[b].substr(m[b].lastIndexOf(" ")+1):"background"==L[0]?I=m[b].substr(m[b].lastIndexOf(" ")+1):"type"==L[0]&&(d=m[b].substr(m[b].lastIndexOf(" ")+1))}if(!M){var P=t.icn3d.centerAtoms(t.icn3d.hash2Atoms(t.icn3d.hAtoms));R=P.center.x,T=P.center.y,H=P.center.z}t.addLabel(O,R,T,H,D,A,I,d),t.icn3d.draw()}else if(0==n.indexOf("add track")){var m=n.split(" | "),p=m[1].substr(8),N=m[2].substr(6),O=m[3].substr(5);$("#"+t.pre+"anno_custom")[0].checked=!0,$("[id^="+t.pre+"custom]").show(),t.checkGiSeq(p,N,O,0)}else if(0==o.indexOf("remove one stabilizer")){var m=o.split(" | "),C=m[1].split(" "),z=[];z.push(parseInt(C[0])),z.push(parseInt(C[1])),t.removeOneStabilizer(z),t.icn3d.draw()}else if(0==o.indexOf("add one stabilizer")){var m=o.split(" | "),C=m[1].split(" ");void 0===t.icn3d.pairArray&&(t.icn3d.pairArray=[]),t.icn3d.pairArray.push(parseInt(C[0])),t.icn3d.pairArray.push(parseInt(C[1])),t.icn3d.draw()}else if(0==o.indexOf("pickatom")){var q=parseInt(o.substr(o.lastIndexOf(" ")+1));t.icn3d.pAtom=t.icn3d.atoms[q],t.icn3d.showPicking(t.icn3d.pAtom)}else if(0==o.indexOf("hbonds")){var F=parseFloat(o.substr(o.indexOf(" ")+1));isNaN(F)||t.showHbonds(F)}else if(0==o.indexOf("color")){var A=o.substr(o.indexOf(" ")+1);t.icn3d.opts.color=A,t.icn3d.setColorByOptions(t.icn3d.opts,t.icn3d.hAtoms),t.updateHlAll()}else if(0==o.indexOf("style")){var j=o.substr(o.indexOf(" ")+1),U=j.substr(0,j.indexOf(" ")),k=j.substr(j.indexOf(" ")+1);t.setStyle(U,k)}else if(0==o.indexOf("select")&&o.indexOf("name")!==-1){for(var m=n.split(" | "),f="",g="",B="",b=0,y=m.length;b<y;++b){var S=m[b];S.indexOf("select")!==-1?f=S.substr(S.indexOf(" ")+1):S.indexOf("name")!==-1&&(g=S.substr(S.indexOf(" ")+1))}B=g,t.selectByCommand(f,g,B)}else if(o.indexOf("select $")!==-1||o.indexOf("select .")!==-1||o.indexOf("select :")!==-1||o.indexOf("select @")!==-1){var m=n.split(" | "),f=m[0].substr(m[0].indexOf(" ")+1),g="",B="";m.length>1&&(g=m[1].substr(m[1].indexOf(" ")+1)),m.length>2&&(B=m[2].substr(m[2].indexOf(" ")+1)),f.indexOf(" or ")!==-1?t.selectByCommand(f,g,B):t.selectBySpec(f,g,B)}r&&t.setLogCmd(n,!1),t.bAddCommands=!0},iCn3DUI.prototype.selectResidues=function(e,t){var i=this;if(void 0!==e&&""!==e){e=e.substr(e.indexOf("_")+1),i.bSelectResidue=!0,$(t).toggleClass("icn3d-highlightSeq");var n=e.substr(e.indexOf("_")+1);if(i.icn3d.residues.hasOwnProperty(n))if($(t).hasClass("icn3d-highlightSeq")){for(var o in i.icn3d.residues[n])i.icn3d.hAtoms[o]=1;if(i.selectedResidues[n]=1,i.bAnnotations&&void 0!==$(t).attr("disease")){var r=$(t).attr("disease"),s=i.icn3d.centerAtoms(i.icn3d.hash2Atoms(i.icn3d.residues[n])),a=15;r.length>a&&(r=r.substr(0,a)+"...");var c=i.icn3d.LABELSIZE,d=i.GREYD;i.addLabel(r,s.center.x,s.center.y,s.center.z,c,d,void 0,"custom")}}else{for(var l in i.icn3d.residues[n])delete i.icn3d.hAtoms[l];delete i.selectedResidues[n],i.icn3d.removeHlObjects()}}},iCn3DUI.prototype.selectTitle=function(e){var t=this;if($(e).hasClass("icn3d-seqTitle")){var i=$(e).attr("chain");t.bAlignSeq?t.bSelectAlignResidue=!1:t.bSelectResidue=!1,t.bAnnotations||t.removeSeqChainBkgd(i),t.icn3d.bCtrl||t.icn3d.bShift||(t.removeSeqResidueBkgd(),t.removeSeqChainBkgd()),$(e).toggleClass("icn3d-highlightSeq");var n,o,r;if(t.bAnnotations?(n=$(e).attr("setname"),o=$(e).attr("title")):n=t.bAlignSeq?"align_"+i:i,$(e).hasClass("icn3d-highlightSeq"))if(t.bAnnotations){if($(e).hasClass("icn3d-highlightSeq"))if(t.removeHl2D(),void 0!==$(e).attr("gi"))t.icn3d.bCtrl||t.icn3d.bShift?t.selectAChain(i,i,!1,!0):t.selectAChain(i,i,!1),t.setLogCmd("select chain "+i,!0);else{var s={};if(void 0!==$(e).attr("domain")||void 0!==$(e).attr("3ddomain")){t.hlSummaryDomain3ddomain(e);for(var a,c=$(e).attr("from").split(","),d=$(e).attr("to").split(","),l=0,p=c.length;l<p;++l)for(var h=parseInt(c[l]),u=parseInt(d[l]),m=h;m<=u;++m)a=i+"_"+(m+1).toString(),s[a]=1;t.icn3d.bCtrl||t.icn3d.bShift?t.selectResidueList(s,n,o,!0):t.selectResidueList(s,n,o,!1),a=i+"_"+parseInt((h+u)/2).toString(),r=t.icn3d.centerAtoms(t.icn3d.hash2Atoms(t.icn3d.residues[a]))}else{for(var a,f=$(e).attr("posarray").split(","),l=0,p=f.length;l<p;++l)a=void 0!==$(e).attr("site")?i+"_"+(parseInt(f[l])+1).toString():i+"_"+f[l],s[a]=1;t.icn3d.bCtrl||t.icn3d.bShift?t.selectResidueList(s,n,o,!0):t.selectResidueList(s,n,o,!1),a=i+"_"+f[parseInt((0+f.length)/2)].toString(),r=t.icn3d.centerAtoms(t.icn3d.hash2Atoms(t.icn3d.residues[a]))}for(var v in t.icn3d.labels)"schematic"!==v&&"distance"!==v&&(t.icn3d.labels[v]=[]);var g=t.icn3d.LABELSIZE,b="FFFF00";t.addLabel(o,r.center.x,r.center.y,r.center.z,g,b,void 0,"custom"),t.icn3d.draw(),t.setLogCmd("select "+t.residueids2spec(Object.keys(s))+" | name "+n,!0)}}else t.bAlignSeq?(t.icn3d.bCtrl||t.icn3d.bShift?t.selectAChain(i,n,!0,!0):t.selectAChain(i,n,!0),t.setLogCmd("select alignChain "+i,!0)):(t.icn3d.bCtrl||t.icn3d.bShift?t.selectAChain(i,n,!1,!0):t.selectAChain(i,n,!1),t.setLogCmd("select chain "+i,!0));else t.icn3d.removeHlObjects(),t.removeHl2D(),$("#"+t.pre+"atomsCustom").val("")}},iCn3DUI.prototype.selectSequenceNonMobile=function(){var e=this;$("#"+e.pre+"dl_sequence2").add("[id^="+e.pre+"dt_giseq]").add("[id^="+e.pre+"dt_site]").add("[id^="+e.pre+"dt_snp]").add("[id^="+e.pre+"dt_clinvar]").add("[id^="+e.pre+"dt_cdd]").add("[id^="+e.pre+"dt_domain]").add("[id^="+e.pre+"dt_interaction]").add("[id^="+e.pre+"dt_ssbond]").add("[id^="+e.pre+"tt_giseq]").add("[id^="+e.pre+"tt_site]").add("[id^="+e.pre+"tt_snp]").add("[id^="+e.pre+"tt_clinvar]").add("[id^="+e.pre+"tt_cdd]").add("[id^="+e.pre+"tt_domain]").add("[id^="+e.pre+"tt_interaction]").add("[id^="+e.pre+"tt_ssbond]").selectable({stop:function(){$(this).attr("id")===e.pre+"dl_sequence2"?(e.bAlignSeq=!0,e.bAnnotations=!1):(e.bAlignSeq=!1,e.bAnnotations=!0),e.bSelectResidue!==!1||e.icn3d.bShift||e.icn3d.bCtrl||e.removeSelection(),$("span.ui-selected",this).each(function(){var t=$(this).attr("id");void 0!==t&&e.selectResidues(t,this)}),e.icn3d.addHlObjects();var t={};for(var i in e.selectedResidues){var n=i.lastIndexOf("_"),o=i.substr(0,n);t[o]=1}var r=Object.keys(t);e.updateHl2D(r),$("div.ui-selected",this).each(function(){void 0!==$(this).attr("chain")&&e.selectTitle(this)})}}),$("[id^="+e.pre+"ov_giseq]").add("[id^="+e.pre+"ov_site]").add("[id^="+e.pre+"ov_snp]").add("[id^="+e.pre+"ov_clinvar]").add("[id^="+e.pre+"ov_cdd]").add("[id^="+e.pre+"ov_domain]").add("[id^="+e.pre+"ov_interaction]").add("[id^="+e.pre+"ov_ssbond]").add("[id^="+e.pre+"tt_giseq]").add("[id^="+e.pre+"tt_site]").add("[id^="+e.pre+"tt_snp]").add("[id^="+e.pre+"tt_clinvar]").add("[id^="+e.pre+"tt_cdd]").add("[id^="+e.pre+"tt_domain]").add("[id^="+e.pre+"tt_interaction]").add("[id^="+e.pre+"tt_ssbond]").on("click",".icn3d-seqTitle",function(t){t.stopImmediatePropagation(),e.bAlignSeq=!1,e.bAnnotations=!0,e.selectTitle(this),e.hlSummaryDomain3ddomain(this)})},iCn3DUI.prototype.hlSummaryDomain3ddomain=function(e){if(void 0!==$(e).attr("domain")){var t=$(e).attr("index"),i=$(e).attr("chain");0!==$("[id^="+i+"_domain_"+t+"]").length&&$("[id^="+i+"_domain_"+t+"]").addClass("icn3d-highlightSeqBox")}if(void 0!==$(e).attr("3ddomain")){var t=$(e).attr("index"),i=$(e).attr("chain");0!==$("[id^="+i+"_3d_domain_"+t+"]").length&&$("[id^="+i+"_3d_domain_"+t+"]").addClass("icn3d-highlightSeqBox")}},iCn3DUI.prototype.selectSequenceMobile=function(){var e=this;$("#"+e.pre+"dl_sequence2").add("[id^="+e.pre+"giseq]").add("[id^="+e.pre+"site]").add("[id^="+e.pre+"clinvar]").add("[id^="+e.pre+"snp]").add("[id^="+e.pre+"cdd]").add("[id^="+e.pre+"domain]").add("[id^="+e.pre+"interaction]").add("[id^="+e.pre+"ssbond]").on("click",".icn3d-residue",function(t){t.stopImmediatePropagation(),$(this).attr("id")===e.pre+"dl_sequence2"?(e.bAlignSeq=!0,e.bAnnotations=!1):(e.bAlignSeq=!1,e.bAnnotations=!0);var i=$(this).attr("id");void 0!==i&&e.selectResidues(i,this),e.icn3d.addHlObjects();var n={};for(var o in e.selectedResidues){var r=o.lastIndexOf("_"),s=o.substr(0,r);n[s]=1}e.removeHl2D();var a=Object.keys(n);e.updateHl2D(a)})},iCn3DUI.prototype.selectChainMobile=function(){var e=this;$("#"+e.pre+"dl_sequence2").add("[id^="+e.pre+"giseq]").add("[id^="+e.pre+"site]").add("[id^="+e.pre+"clinvar]").add("[id^="+e.pre+"snp]").add("[id^="+e.pre+"cdd]").add("[id^="+e.pre+"domain]").add("[id^="+e.pre+"interaction]").add("[id^="+e.pre+"ssbond]").on("click",".icn3d-seqTitle",function(t){t.stopImmediatePropagation(),$(this).attr("id")===e.pre+"dl_sequence2"?(e.bAlignSeq=!0,e.bAnnotations=!1):(e.bAlignSeq=!1,e.bAnnotations=!0),e.selectTitle(this),e.hlSummaryDomain3ddomain(this)})},iCn3DUI.prototype.removeSeqChainBkgd=function(e){void 0===e?$(".icn3d-seqTitle").each(function(e){$(this).removeClass("icn3d-highlightSeq"),$(this).removeClass("icn3d-highlightSeqBox")}):$(".icn3d-seqTitle").each(function(t){$(this).attr("chain")!==e&&($(this).removeClass("icn3d-highlightSeq"),$(this).removeClass("icn3d-highlightSeqBox"))})},iCn3DUI.prototype.removeSeqResidueBkgd=function(){$(".icn3d-residue").each(function(e){$(this).removeClass("icn3d-highlightSeq")})},iCn3DUI.prototype.update2DdgmContent=function(){var e=this,t="";void 0!==e.cfg.mmdbid||void 0!==e.cfg.gi?(t+=e.draw2Ddgm(e.interactionData,e.inputid,void 0,!0),t+=e.set2DdgmNote(),$("#"+e.pre+"dl_2ddgm").html(t)):void 0!==e.cfg.align&&(t+=e.draw2Ddgm(e.interactionData1,e.mmdbidArray[0].toUpperCase(),0,!0),t+=e.draw2Ddgm(e.interactionData2,e.mmdbidArray[1].toUpperCase(),1,!0),t+=e.set2DdgmNote(!0),$("#"+e.pre+"dl_2ddgm").html(t))},iCn3DUI.prototype.changeSeqColor=function(e){for(var t=this,i=0,n=e.length;i<n;++i){var o=e[i];if(0!==$("[id$="+t.pre+o+"]").length){var r=t.icn3d.getFirstCalphaAtomObj(t.icn3d.residues[o]),s=void 0!==r.color?"#"+r.color.getHexString():t.icn3d.defaultAtomColor;$("[id=giseq_"+t.pre+o+"]").attr("style","color:"+s),void 0!==t.cfg.align&&$("[id=align_"+t.pre+o+"]").attr("style","color:"+s)}}},iCn3DUI.prototype.removeHlAll=function(){var e=this;e.removeHlObjects(),e.removeHlSeq(),e.removeHl2D(),e.removeHlMenus()},iCn3DUI.prototype.removeHlObjects=function(){var e=this;e.icn3d.removeHlObjects()},iCn3DUI.prototype.removeHlSeq=function(){var e=this;e.removeSeqResidueBkgd()},iCn3DUI.prototype.removeHl2D=function(){var e=this;$("#"+e.pre+"dl_2ddgm rect").attr("stroke","#000000"),$("#"+e.pre+"dl_2ddgm circle").attr("stroke","#000000"),$("#"+e.pre+"dl_2ddgm polygon").attr("stroke","#000000"),$("#"+e.pre+"dl_2ddgm svg line").attr("stroke","#000000"),$("#"+e.pre+"dl_2ddgm rect").attr("stroke-width",1),$("#"+e.pre+"dl_2ddgm circle").attr("stroke-width",1),$("#"+e.pre+"dl_2ddgm polygon").attr("stroke-width",1),$("#"+e.pre+"dl_2ddgm line").attr("stroke-width",1)},iCn3DUI.prototype.removeHlMenus=function(){var e=this;$("#"+e.pre+"atomsCustom").val("")},iCn3DUI.prototype.updateHlAll=function(e,t,i,n){var o=this;o.updateHlObjects(n),void 0!==e?o.updateHlSeqInChain(e,i):o.updateHlSeq(void 0,void 0,i),o.updateHl2D(),(void 0===t||t)&&o.updateHlMenus(e)},iCn3DUI.prototype.updateHlObjects=function(e){var t=this;t.icn3d.removeHlObjects(),(Object.keys(t.icn3d.hAtoms).length<Object.keys(t.icn3d.atoms).length||e)&&t.icn3d.addHlObjects()},iCn3DUI.prototype.updateHlSeq=function(e,t,i){var n=this;void 0!==i&&i||n.removeHlSeq(),void 0===t&&(t=n.icn3d.getResiduesFromCalphaAtoms(n.icn3d.hAtoms)),Object.keys(n.icn3d.hAtoms).length<Object.keys(n.icn3d.atoms).length&&n.hlSeq(Object.keys(t)),n.changeSeqColor(Object.keys(t))},iCn3DUI.prototype.updateHlSeqInChain=function(e,t){var i=this;if(void 0!==t&&t||i.removeHlSeq(),Object.keys(i.icn3d.hAtoms).length!=Object.keys(i.icn3d.atoms).length)for(var n=0,o=e.length;n<o;++n){var r=e[n];if(Object.keys(i.icn3d.chains).indexOf(r)!==-1)i.hlSeqInChain(r);else{var s=[];void 0!==i.icn3d.defNames2Residues[r]&&i.icn3d.defNames2Residues[r].length>0&&(s=i.icn3d.defNames2Residues[r]);var a={};if(void 0!==i.icn3d.defNames2Atoms[r]&&i.icn3d.defNames2Atoms[r].length>0){for(var c=0,d=i.icn3d.defNames2Atoms[r].length;c<d;++c){var l=i.icn3d.defNames2Atoms[r][c],p=i.icn3d.atoms[l],h=p.structure+"_"+p.chain+"_"+p.resi;a[h]=1}s=s.concat(Object.keys(a))}i.hlSeq(s)}}},iCn3DUI.prototype.updateHl2D=function(e){var t=this;if(t.removeHl2D(),Object.keys(t.icn3d.hAtoms).length!=Object.keys(t.icn3d.atoms).length){if(void 0===e){var i=t.icn3d.getChainsFromAtoms(t.icn3d.hAtoms);e=Object.keys(i)}if(void 0!==e)for(var n=0,o=e.length;n<o;++n){var r=t.icn3d.intHash(t.icn3d.chains[e[n]],t.icn3d.hAtoms),s=1*Object.keys(r).length/Object.keys(t.icn3d.chains[e[n]]).length,a=t.icn3d.getFirstCalphaAtomObj(r);if(void 0!==t.icn3d.alnChains[e[n]]){var c=t.icn3d.intHash(t.icn3d.alnChains[e[n]],r);Object.keys(c).length>0&&(a=t.icn3d.getFirstCalphaAtomObj(c))}var d=void 0!==a&&void 0!==a.color?"#"+a.color.getHexString():"#FFFFFF",l=$("#"+t.pre+"dl_2ddgm g[chainid="+e[n]+"] rect[class='icn3d-hlnode']"),p=$("#"+t.pre+"dl_2ddgm g[chainid="+e[n]+"] rect[class='icn3d-basenode']");void 0!==l&&(t.highlightNode("rect",l,p,s),$(l).attr("fill",d)),l=$("#"+t.pre+"dl_2ddgm g[chainid="+e[n]+"] circle[class='icn3d-hlnode']"),p=$("#"+t.pre+"dl_2ddgm g[chainid="+e[n]+"] circle[class='icn3d-basenode']"),void 0!==l&&(t.highlightNode("circle",l,p,s),$(l).attr("fill",d)),l=$("#"+t.pre+"dl_2ddgm g[chainid="+e[n]+"] polygon[class='icn3d-hlnode']"),p=$("#"+t.pre+"dl_2ddgm g[chainid="+e[n]+"] polygon[class='icn3d-basenode']"),void 0!==l&&(t.highlightNode("polygon",l,p,s),$(l).attr("fill",d))}if(void 0!==t.lineArray2d)for(var n=0,o=t.lineArray2d.length;n<o;n+=2)$("#"+t.pre+"dl_2ddgm g[chainid1="+t.lineArray2d[n]+"][chainid2="+t.lineArray2d[n+1]+"] line").attr("stroke",t.ORANGE);t.icn3d.prevHighlightAtoms=t.icn3d.cloneHash(t.icn3d.hAtoms),t.setMode("selection")}},iCn3DUI.prototype.updateHlMenus=function(e){var t=this;void 0===e&&(e=[]);var i=t.setAtomMenu(e);$("#"+t.pre+"atomsCustom").length&&$("#"+t.pre+"atomsCustom").html(i)},iCn3DUI.prototype.setAtomMenu=function(e){for(var t=this,i="",n=void 0!==t.icn3d.defNames2Residues?Object.keys(t.icn3d.defNames2Residues):[],o=void 0!==t.icn3d.defNames2Atoms?Object.keys(t.icn3d.defNames2Atoms):[],r=n.concat(o).sort(),s=0,a=r.length;s<a;++s){var c,d,l=r[s];if(void 0!==t.icn3d.defNames2Atoms&&t.icn3d.defNames2Atoms.hasOwnProperty(l)){var p=t.icn3d.defNames2Atoms[l];p.length>0&&(c=t.icn3d.atoms[p[0]])}else if(void 0!==t.icn3d.defNames2Residues&&t.icn3d.defNames2Residues.hasOwnProperty(l)){var h=t.icn3d.defNames2Residues[l];h.length>0&&(d=t.icn3d.residues[h[0]],d&&(c=t.icn3d.atoms[Object.keys(d)[0]]))}var u=void 0!==c?c.color.getHexString():"000000";i+=e.indexOf(l)!=-1?"<option value='"+l+"' style='color:#"+u+"' selected='selected'>"+l+"</option>":"<option value='"+l+"' style='color:#"+u+"'>"+l+"</option>"}return i},iCn3DUI.prototype.setPredefinedInMenu=function(){var e=this;if(e.setChainsInMenu(),e.setProtNuclLigInMenu(),void 0!==e.cfg.align&&e.bFullUi){e.selectResidueList(e.consHash1,e.conservedName1,e.conservedName1,!1,!1),e.selectResidueList(e.consHash2,e.conservedName2,e.conservedName2,!1,!1),e.selectResidueList(e.nconsHash1,e.nonConservedName1,e.nonConservedName1,!1,!1),e.selectResidueList(e.nconsHash2,e.nonConservedName2,e.nonConservedName2,!1,!1),e.selectResidueList(e.nalignHash1,e.notAlignedName1,e.notAlignedName1,!1,!1),e.selectResidueList(e.nalignHash2,e.notAlignedName2,e.notAlignedName2,!1,!1);var t={};for(var i in e.icn3d.alnChains)t=e.icn3d.unionHash(t,e.icn3d.alnChains[i]);var n={},o={};for(var r in t){var s=e.icn3d.atoms[r],a=s.structure+"_"+s.chain,c=a+"_"+s.resi;n[c]=1,o[a]=1}var d="aligned_protein",l="aligned protein and nucleotides",p="select "+e.residueids2spec(Object.keys(n));e.addCustomSelection(Object.keys(n),d,l,p,!0)}},iCn3DUI.prototype.hlSeq=function(e){for(var t=this,i={},n=0,o=e.length;n<o;++n){var r=e[n];0!==$("[id$="+t.pre+r+"]").length&&$("[id$="+t.pre+r+"]").addClass("icn3d-highlightSeq");var s=r.lastIndexOf("_"),a=r.substr(0,s);i[a]=1}for(var a in i)0!==$("#giseq_summary_"+t.pre+a).length&&$("#giseq_summary_"+t.pre+a).addClass("icn3d-highlightSeqBox")},iCn3DUI.prototype.hlSeqInChain=function(e){for(var t=this,i=0,n=t.icn3d.chainsSeq[e].length;i<n;++i){var o=t.icn3d.chainsSeq[e][i].resi,r=e+"_"+o;0!==$("#giseq_"+t.pre+r).length&&$("#giseq_"+t.pre+r).addClass("icn3d-highlightSeq")}0!==$("#giseq_summary_"+t.pre+e).length&&$("#giseq_summary_"+t.pre+e).addClass("icn3d-highlightSeqBox")},iCn3DUI.prototype.toggleHighlight=function(){var e=this;e.icn3d.prevHighlightObjects.length>0||e.icn3d.prevHighlightObjects_ghost.length>0?e.clearHighlight():e.showHighlight(),e.setLogCmd("toggle highlight",!0)},iCn3DUI.prototype.clearHighlight=function(){var e=this;e.icn3d.labels.picking=[],e.icn3d.draw(),e.icn3d.removeHlObjects(),e.removeHl2D(),e.icn3d.render(),e.removeSeqChainBkgd(),e.removeSeqResidueBkgd(),e.bSelectResidue=!1},iCn3DUI.prototype.showHighlight=function(){var e=this;e.icn3d.addHlObjects(),e.updateHlAll()},iCn3DUI.prototype.highlightChains=function(e){var t=this;t.icn3d.removeHlObjects(),t.removeHl2D(),t.icn3d.addHlObjects(),t.updateHl2D(e);for(var i={},n=0,o=e.length;n<o;++n){var r=e[n];for(var s in t.icn3d.chainsSeq[r]){var a=t.icn3d.chainsSeq[r][s],c=r+"_"+a.resi;""!==a.name&&"-"!==a.name&&(i[c]=1)}}t.hlSeq(Object.keys(i))},iCn3DUI.prototype.setTools=function(){var e=this,t="";return t+="  <div id='"+e.pre+"selection' style='display:none;'><div style='position:absolute; z-index:555; float:left; display:table-row; margin: 32px 0px 0px 3px;'>",t+="    <table style='margin-top: 3px; width:100px;'><tr valign='center'>",t+=e.setTools_base(),t+="    </tr></table>",t+="  </div></div>"},iCn3DUI.prototype.setButton=function(e,t,i,n){var o=this,r=o.isMobile()?" background-color:#DDDDDD;":"";return"<div style='margin:3px 0px 0px 10px;'><button style='-webkit-appearance:"+e+"; height:36px;"+r+"' id='"+o.pre+t+"'><span style='white-space:nowrap' class='icn3d-commandTitle' title='"+i+"'>"+n+"</span></button></div>"},iCn3DUI.prototype.setTools_base=function(){var e=this,t="",i=e.isMobile()?"none":"button";return t+="      <td valign='top'>"+e.setButton(i,"saveimage","Save iCn3D PNG Image","Save iCn3D<br/>PNG Image")+"</td>",void 0===e.cfg.cid&&(t+="      <td valign='top'>"+e.setButton(i,"definedsets","Defined Sets","Defined<br/>Sets")+"</td>",t+="      <td valign='top'>"+e.setButton(i,"show_annotations","View sequences and annotations for each chain","View Sequences<br/>& Annotations")+"</td>",void 0!==e.cfg.align&&(t+="      <td valign='top'>"+e.setButton(i,"show_alignsequences","View the sequences of the aligned structures","Aligned<br/>Sequences")+"</td>"),void 0===e.cfg.mmdbid&&void 0===e.cfg.gi&&void 0===e.cfg.blast_rep_id&&void 0===e.cfg.align||(t+="      <td valign='top'>"+e.setButton(i,"show_2ddgm","View the interactions of the structure","View<br/>Interactions")+"</td>"),t+="      <td valign='top'>"+e.setButton(i,"chemicalbindingshow","View Chemical Binding","View Chemical<br/>Binding")+"</td>",t+="      <td valign='top'>"+e.setButton(i,"alternate","Alternate the structures",'Alternate<br/>(Key "a")')+"</td>"),t+="      <td valign='top'>"+e.setButton(i,"show_selected","View ONLY the selected atoms","View Only<br/>Selection")+"</td>",t+="      <td valign='top'>"+e.setButton(i,"toggleHighlight","Turn on and off the 3D highlight in the viewer","Toggle<br/>Highlight")+"</td>",void 0===e.cfg.cid&&(t+="      <td valign='top'>"+e.setButton(i,"removeLabels","Remove Labels","Remove<br/>Labels")+"</td>"),t},iCn3DUI.prototype.setTopMenusHtml=function(e){var t=this,i="";i+="<div style='position:relative;'>",i+="<div id='"+t.pre+"popup' class='icn3d-text icn3d-popup'></div>",i+="  <!--https://forum.jquery.com/topic/looking-for-a-jquery-horizontal-menu-bar-->",i+="  <div id='"+t.pre+"mnlist' style='position:absolute; z-index:999; float:left; display:table-row; margin-top: -2px;'>",i+="    <table border='0' cellpadding='0' cellspacing='0' width='100'><tr>",i+="    <td valign='top'>"+t.setMenu1()+"</td>",i+="    <td valign='top'>"+t.setMenu2()+"</td>",i+="    <td valign='top'>"+t.setMenu2b()+"</td>",i+="    <td valign='top'>"+t.setMenu3()+"</td>",i+="    <td valign='top'>"+t.setMenu4()+"</td>",i+="    <td valign='top'>"+t.setMenu5()+"</td>",i+="    <td valign='top'>"+t.setMenu6()+"</td>",i+="    <td valign='top'><div style='position:relative; margin-left:6px;'><label class='icn3d-switch'><input id='"+t.pre+"modeswitch' type='checkbox'><div class='icn3d-slider icn3d-round' style='width:34px; height:18px; margin: 6px 0px 0px 3px;' title='Left (\"All atoms\"): Style and color menu options will be applied to all atoms in the structure&#13;Right (\"Selection\"): Style and color menu options will be applied only to selected atoms'></div></label>",i+="    <div class='icn3d-commandTitle' style='min-width:40px; margin-top: 3px; white-space: nowrap;'><span id='"+t.pre+"modeall' title='Style and color menu options will be applied to all atoms in the structure'>All atoms&nbsp;&nbsp;</span><span id='"+t.pre+"modeselection' class='icn3d-modeselection' style='display:none;' title='Style and color menu options will be applied only to selected atoms'>Selection&nbsp;&nbsp;</span></div></div></td>",i+='    <td valign="top"><div class="icn3d-commandTitle" style="white-space:nowrap; margin-top:10px; border-left:solid 1px #888888"><span id="'+t.pre+'selection_expand" class="icn3d-expand icn3d-link" title="Expand">&nbsp;&nbsp;Show Toolbar&nbsp;&nbsp;</span><span id="'+t.pre+'selection_shrink" class="icn3d-shrink icn3d-link" style="display:none;" title="Shrink">&nbsp;&nbsp;Hide Toolbar&nbsp;&nbsp;</span></div></td>',i+='    <td valign="top"><div class="icn3d-commandTitle" style="white-space:nowrap; margin-top:8px; border-left:solid 1px #888888">&nbsp;&nbsp;<input type="text" id="'+t.pre+'search_seq" size="10" placeholder="one-letter seq."> <button style="white-space:nowrap;" id="'+t.pre+'search_seq_button">Search Seq.</button> <a href="https://www.ncbi.nlm.nih.gov/Structure/icn3d/icn3d.html#selectb" target="_blank" title="Specification tips">?</a></div></td>',i+="  </tr>",i+="  </table>",i+="  </div>",i+=t.setTools(),i+="  <div id='"+t.pre+"title' class='icn3d-commandTitle' style='font-size:1.2em; font-weight:normal; position:absolute; z-index:1; float:left; display:table-row; margin: 85px 0px 0px 5px; color: "+t.GREYD+"'></div>",i+="  <div id='"+t.pre+"viewer' style='position:relative; width:100%; height:100%; background-color: "+t.GREYD+";'>",i+="   <div id='"+t.pre+"mnLogSection'>",i+="    <div style='height: "+t.MENU_HEIGHT+"px;'></div>",i+="   </div>",void 0===t.cfg.mmtfid&&(i+=t.realHeight<300?"    <div id='"+t.pre+"wait' style='position:absolute; top:100px; left:50px; font-size: 1.2em; color: #444444;'>Loading data...</div>":"    <div id='"+t.pre+"wait' style='position:absolute; top:180px; left:50px; font-size: 1.8em; color: #444444;'>Loading data...</div>"),i+="    <canvas id='"+t.pre+"canvas' style='width:100%; height: 100%; background-color: #000;'>Your browser does not support WebGL.</canvas>",(void 0===t.cfg.showcommand||t.cfg.showcommand)&&(i+=t.setLogWindow()),i+="  </div>",i+="</div>",i+=t.setDialogs(),i+=t.setCustomDialogs(),$("#"+e).html(i),$("accordion").accordion({collapsible:!0,active:!1,heightStyle:"content"}),$("accordion div").removeClass("ui-accordion-content ui-corner-all ui-corner-bottom ui-widget-content"),$(".icn3d-mn").menu({position:{my:"left top",at:"right top"}}),$(".icn3d-mn").hover(function(){},function(){$("accordion").accordion("option","active","none")}),$("#"+t.pre+"accordion1").hover(function(){$("#"+t.pre+"accordion1 div").css("display","block")},function(){$("#"+t.pre+"accordion1 div").css("display","none")}),$("#"+t.pre+"accordion2").hover(function(){$("#"+t.pre+"accordion2 div").css("display","block")},function(){$("#"+t.pre+"accordion2 div").css("display","none")}),$("#"+t.pre+"accordion2b").hover(function(){$("#"+t.pre+"accordion2b div").css("display","block")},function(){$("#"+t.pre+"accordion2b div").css("display","none")}),$("#"+t.pre+"accordion3").hover(function(){$("#"+t.pre+"accordion3 div").css("display","block")},function(){$("#"+t.pre+"accordion3 div").css("display","none")}),$("#"+t.pre+"accordion4").hover(function(){$("#"+t.pre+"accordion4 div").css("display","block")},function(){$("#"+t.pre+"accordion4 div").css("display","none")}),$("#"+t.pre+"accordion5").hover(function(){$("#"+t.pre+"accordion5 div").css("display","block")},function(){$("#"+t.pre+"accordion5 div").css("display","none")}),$("#"+t.pre+"accordion6").hover(function(){$("#"+t.pre+"accordion6 div").css("display","block")},function(){$("#"+t.pre+"accordion6 div").css("display","none")})},iCn3DUI.prototype.getLink=function(e,t){var i=this;return"<li><span id='"+i.pre+e+"' class='icn3d-link'>"+t+"</span></li>"},iCn3DUI.prototype.getLinkWrapper=function(e,t,i){var n=this;return"<li id='"+n.pre+i+"'><span id='"+n.pre+e+"' class='icn3d-link'>"+t+"</span></li>"},iCn3DUI.prototype.getRadio=function(e,t,i,n){var o=this,r=void 0!==n&&n?" checked":"";return"<li><label for='"+o.pre+t+"' class='icn3d-rad'><input type='radio' name='"+o.pre+e+"' id='"+o.pre+t+"'"+r+"><span class='ui-icon ui-icon-blank'></span> <span class='icn3d-rad-text'>"+i+"</span></label></li>"},iCn3DUI.prototype.setMenu1=function(){var e=this,t="";return t+="    <div class='icn3d-menu'>",t+="          <accordion id='"+e.pre+"accordion1'>",t+="<h3>File</h3>",t+="<div>",t+="<ul class='icn3d-mn'>",t+="  <li><span>Retrieve by ID</span>",t+="    <ul>",t+=e.getLink("mn1_mmdbid","MMDB ID"),t+=e.getLink("mn1_mmtfid","MMTF ID"),t+=e.getLink("mn1_pdbid","PDB ID"),t+=e.getLink("mn1_mmcifid","mmCIF ID"),t+=e.getLink("mn1_gi","NCBI gi"),t+=e.getLink("mn1_cid","PubChem CID"),t+="    </ul>",t+="  </li>",t+="  <li><span>Open File</span>",t+="    <ul>",t+=e.getLink("mn1_pdbfile","PDB File"),t+=e.getLink("mn1_mmciffile","mmCIF File"),t+=e.getLink("mn1_mol2file","Mol2 File"),t+=e.getLink("mn1_sdffile","SDF File"),t+=e.getLink("mn1_xyzfile","XYZ File"),t+=e.getLink("mn1_urlfile","Url (Same Host) "),t+="      <li>-</li>",t+=e.getLink("mn1_pngimage","iCn3D PNG Image"),t+=e.getLink("mn1_state","State/Script File"),t+=e.getLink("mn1_selection","Selection File"),t+="    </ul>",t+="  </li>",t+="  <li><span>Align</span>",t+="    <ul>",t+=e.getLink("mn1_blast_rep_id","Sequence to Structure"),t+=e.getLink("mn1_align","Structure to Structure"),t+="    </ul>",t+="  </li>",t+="  <li><span>3D Printing</span>",
t+="    <ul>",void 0===e.cfg.cid?(t+=e.getLink("mn1_exportVrmlStab","VRML (Color, W/  Stabilizers)"),t+=e.getLink("mn1_exportStlStab","STL (W/  Stabilizers)"),t+="      <li>-</li>",t+=e.getLink("mn1_exportVrml","VRML (Color)"),t+=e.getLink("mn1_exportStl","STL"),t+="      <li>-</li>",t+=e.getLink("mn1_stabilizerYes","Add All  Stabilizers"),t+=e.getLink("mn1_stabilizerNo","Remove All  Stabilizers"),t+="      <li>-</li>",t+=e.getLink("mn1_stabilizerOne","Add One  Stabilizer"),t+=e.getLink("mn1_stabilizerRmOne","Remove One  Stabilizer"),t+="      <li>-</li>",t+=e.getLink("mn1_thicknessSet","Set Thickness"),t+=e.getLink("mn1_thicknessReset","Reset Thickness")):(t+=e.getLink("mn1_exportVrml","VRML (Color)"),t+=e.getLink("mn1_exportStl","STL")),t+="    </ul>",t+="  </li>",t+="  <li><span>Save Files</span>",t+="    <ul>",t+=e.getLink("mn1_exportCanvas","iCn3D PNG Image"),t+=e.getLink("mn1_exportState","State File"),t+=e.getLink("mn1_exportSelections","Selection File"),t+=e.getLink("mn1_exportCounts","Residue Counts"),void 0!==e.cfg.mmdbid&&(t+=e.getLink("mn6_exportInteraction","Interaction List")),t+="    </ul>",t+="  </li>",t+=e.getLink("mn1_sharelink","Share Link"),t+="</ul>",t+="</div>",t+="          </accordion>",t+="    </div>"},iCn3DUI.prototype.setMenu2=function(){var e=this,t="";return t+="    <div class='icn3d-menu'>",t+="          <accordion id='"+e.pre+"accordion2'>",t+="<h3>Select</h3>",t+="<div>",t+="<ul class='icn3d-mn'>",t+=e.getLink("mn2_definedsets","Defined Sets"),t+=e.getLink("mn2_selectall","All"),t+=e.getLink("mn2_aroundsphere","by Distance"),t+=e.getLink("mn2_selectcomplement","Inverse"),t+=e.getLink("mn2_selectsidechains","Side Chains"),t+=e.getLink("mn2_command","Advanced"),void 0===e.cfg.cid?(t+="  <li><span>Select on 3D</span>",t+="    <ul>",t+='  <li>"Alt"+Click: start selection</li>',t+='  <li>"Ctrl"+Click: union selection</li>',t+='  <li>"Shift"+Click: range Selection</li>',t+="  <li>-</li>",t+=e.getRadio("mn2_pk","mn2_pkChain","Chain"),t+=e.getRadio("mn2_pk","mn2_pkStrand","Strand/Helix"),t+=e.getRadio("mn2_pk","mn2_pkResidue","Residue",!0),t+=e.getRadio("mn2_pk","mn2_pkYes","Atom"),t+="    </ul>",t+="  </li>"):t+=e.isMobile()?"  <li><span>Touch to pick</span>":'  <li><span>Picking with<br>"Alt" + Click</span>',t+="  <li>-</li>",t+=e.getLink("mn2_saveselection","Save Selection"),t+=e.getLink("clearall","Clear Selection"),t+="  <li>-</li>",t+="      <li><span>Highlight Color</span>",t+="        <ul>",t+=e.getRadio("mn2_hl_clr","mn2_hl_clrYellow","Yellow",!0),t+=e.getRadio("mn2_hl_clr","mn2_hl_clrGreen","Green"),t+=e.getRadio("mn2_hl_clr","mn2_hl_clrRed","Red"),t+="        </ul>",t+="      </li>",t+="      <li><span>Highlight Style</span>",t+="        <ul>",t+=e.getRadio("mn2_hl_style","mn2_hl_styleOutline","Outline",!0),t+=e.getRadio("mn2_hl_style","mn2_hl_styleObject","3D Objects"),t+=e.getRadio("mn2_hl_style","mn2_hl_styleNone","No Highlight"),t+="        </ul>",t+="      </li>",t+="  <li><br/></li>",t+="</ul>",t+="</div>",t+="          </accordion>",t+="    </div>"},iCn3DUI.prototype.setMenu2b=function(){var e=this,t="";return t+="    <div class='icn3d-menu'>",t+="          <accordion id='"+e.pre+"accordion2b'>",t+="<h3>View</h3>",t+="<div>",t+="<ul class='icn3d-mn'>",t+=e.getLink("mn2_show_selected","View Only <br>Selection"),t+=e.getLink("mn2_selectedcenter","Zoom in <br>Selection"),t+=e.getLink("mn6_center","Center on <br>Selection"),void 0!==e.cfg.align&&(t+=e.getLink("mn2_alternate",'Alternate (Key "a")')),t+="  <li>-</li>",void 0===e.cfg.cid&&(t+="  <li><span>Chem. Binding</span>",t+="    <ul>",t+=e.getRadio("mn6_chemicalbinding","mn6_chemicalbindingshow","Show"),t+=e.getRadio("mn6_chemicalbinding","mn6_chemicalbindinghide","Hide",!0),t+="    </ul>",t+="  </li>",t+="  <li><span>H-Bonds to</span><br/><span>Selection</span>",t+="    <ul>",t+=e.getRadio("mn6_hbonds","mn6_hbondsYes","Show"),t+=e.getRadio("mn6_hbonds","mn6_hbondsNo","Hide",!0),t+="    </ul>",t+="  </li>",t+="  <li><span>Disulfide Bonds</span>",t+="    <ul>",t+=e.getRadio("mn6_ssbonds","mn6_ssbondsYes","Show",!0),t+=e.getRadio("mn6_ssbonds","mn6_ssbondsNo","Hide"),t+="    </ul>",t+="  </li>",t+="  <li><span>Cross-Linkages</span>",t+="    <ul>",t+=e.getRadio("mn6_clbonds","mn6_clbondsYes","Show"),t+=e.getRadio("mn6_clbonds","mn6_clbondsNo","Hide",!0),t+="    </ul>",t+="  </li>",void 0===e.cfg.mmtfid&&void 0===e.cfg.pdbid&&void 0===e.cfg.mmcifid&&void 0===e.cfg.mmdbid&&void 0===e.cfg.gi&&void 0===e.cfg.blast_rep_id||(t+="  <li id='"+e.pre+"assemblyWrapper'><span>Assembly</span>",t+="    <ul>",t+=e.getRadio("mn6_assembly","mn6_assemblyYes","Biological Assembly",!0),t+=e.getRadio("mn6_assembly","mn6_assemblyNo","Asymmetric Unit"),t+="    </ul>",t+="  </li>")),t+="  <li><span>Distance</span>",t+="    <ul>",t+=e.getRadio("mn6_distance","mn6_distanceYes","Measure"),t+=e.getRadio("mn6_distance","mn6_distanceNo","Hide",!0),t+="    </ul>",t+="  </li>",t+="  <li><span>Label</span>",t+="    <ul>",t+=e.getRadio("mn6_addlabel","mn6_addlabelYes","by Picking Atoms"),t+=e.getRadio("mn6_addlabel","mn6_addlabelSelection","per Selection"),void 0===e.cfg.cid&&(t+=e.getRadio("mn6_addlabel","mn6_addlabelResidues","per Residue"),t+=e.getRadio("mn6_addlabel","mn6_addlabelChains","per Chain"),t+=e.getRadio("mn6_addlabel","mn6_addlabelTermini","N- & C-Termini")),t+=e.getRadio("mn6_addlabel","mn6_addlabelNo","Remove",!0),t+="    </ul>",t+="  </li>",t+="  <li>-</li>",t+="  <li><span>Reset</span>",t+="    <ul>",t+=e.getRadio("mn6_reset","reset","All"),t+=e.getRadio("mn6_reset","mn6_resetOrientation","Orientation"),t+="    </ul>",t+="  </li>",t+="  <li><span>Transform Hints</span>",t+="    <ul>",t+="      <li><span>Rotate</span>",t+="          <ul>",t+="<li>Left Mouse</li>",t+="<li>Key L: Left</li>",t+="<li>Key J: Right</li>",t+="<li>Key I: Up</li>",t+="<li>Key M: Down</li>",t+="          </ul>",t+="      </li>",t+="      <li><span>Zoom</span>",t+="          <ul>",t+="<li>Middle Mouse</li>",t+="<li>Key Z: Zoom in</li>",t+="<li>Key X: Zoom out</li>",t+="          </ul>",t+="      </li>",t+="      <li><span>Translate</span>",t+="          <ul>",t+="<li>Right Mouse</li>",t+="          </ul>",t+="      </li>",t+="    </ul>",t+="  </li>",t+="  <li><span>Auto Rotation</span>",t+="    <ul>",t+=e.getRadio("mn6_rotate","mn6_rotateleft","Rotate Left"),t+=e.getRadio("mn6_rotate","mn6_rotateright","Rotate Right"),t+=e.getRadio("mn6_rotate","mn6_rotateup","Rotate Up"),t+=e.getRadio("mn6_rotate","mn6_rotatedown","Rotate Down"),t+="    </ul>",t+="  </li>",t+="  <li><span>Camera</span>",t+="    <ul>",t+=e.getRadio("mn6_camera","mn6_cameraPers","Perspective",!0),t+=e.getRadio("mn6_camera","mn6_cameraOrth","Orthographic"),t+="    </ul>",t+="  </li>",t+="  <li><span>Fog</span>",t+="    <ul>",t+=e.getRadio("mn6_showfog","mn6_showfogYes","On"),t+=e.getRadio("mn6_showfog","mn6_showfogNo","Off",!0),t+="    </ul>",t+="  </li>",t+="  <li><span>Slab</span>",t+="    <ul>",t+=e.getRadio("mn6_showslab","mn6_showslabYes","On"),t+=e.getRadio("mn6_showslab","mn6_showslabNo","Off",!0),t+="    </ul>",t+="  </li>",t+="  <li><span>XYZ-axes</span>",t+="    <ul>",t+=e.getRadio("mn6_showaxis","mn6_showaxisYes","Show"),t+=e.getRadio("mn6_showaxis","mn6_showaxisNo","Hide",!0),t+="    </ul>",t+="  </li>",t+=e.getLink("mn6_back","Undo"),t+=e.getLink("mn6_forward","Redo"),t+="  <li><br/></li>",t+="</ul>",t+="</div>",t+="          </accordion>",t+="    </div>"},iCn3DUI.prototype.setMenu3=function(){var e=this,t="";return t+="    <div class='icn3d-menu'>",t+="          <accordion id='"+e.pre+"accordion3'>",t+="<h3 id='"+e.pre+"style'>Style</h3>",t+="<div>",t+="<ul class='icn3d-mn'>",void 0===e.cfg.cid&&(t+="  <li><span>Proteins</span>",t+="    <ul>",t+=void 0!==e.cfg.align?e.getRadio("mn3_proteins","mn3_proteinsRibbon","Ribbon"):e.getRadio("mn3_proteins","mn3_proteinsRibbon","Ribbon",!0),t+=e.getRadio("mn3_proteins","mn3_proteinsStrand","Strand"),t+=e.getRadio("mn3_proteins","mn3_proteinsCylinder","Cylinder and Plate"),t+=e.getRadio("mn3_proteins","mn3_proteinsSchematic","Schematic"),t+=void 0!==e.cfg.align?e.getRadio("mn3_proteins","mn3_proteinsCalpha","C Alpha Trace",!0):e.getRadio("mn3_proteins","mn3_proteinsCalpha","C Alpha Trace"),t+=e.getRadio("mn3_proteins","mn3_proteinsBfactor","B-factor Tube"),t+=e.getRadio("mn3_proteins","mn3_proteinsLines","Lines"),t+=e.getRadio("mn3_proteins","mn3_proteinsStick","Stick"),t+=e.getRadio("mn3_proteins","mn3_proteinsBallstick","Ball and Stick"),t+=e.getRadio("mn3_proteins","mn3_proteinsSphere","Sphere"),t+=e.getRadio("mn3_proteins","mn3_proteinsNo","Hide"),t+="    </ul>",t+="  </li>",t+="  <li><span>Side Chains</span>",t+="    <ul>",t+=e.getRadio("mn3_sidec","mn3_sidecLines","Lines"),t+=e.getRadio("mn3_sidec","mn3_sidecStick","Stick"),t+=e.getRadio("mn3_sidec","mn3_sidecBallstick","Ball and Stick"),t+=e.getRadio("mn3_sidec","mn3_sidecSphere","Sphere"),t+=e.getRadio("mn3_sidec","mn3_sidecNo","Hide",!0),t+="    </ul>",t+="  </li>",t+="  <li><span>Nucleotides</span>",t+="    <ul>",t+=e.getRadio("mn3_nucl","mn3_nuclCartoon","Cartoon",!0),t+=e.getRadio("mn3_nucl","mn3_nuclPhos","O3' Trace"),t+=e.getRadio("mn3_nucl","mn3_nuclSchematic","Schematic"),t+=e.getRadio("mn3_nucl","mn3_nuclLines","Lines"),t+=e.getRadio("mn3_nucl","mn3_nuclStick","Stick"),t+=e.getRadio("mn3_nucl","mn3_nuclBallstick","Ball and Stick"),t+=e.getRadio("mn3_nucl","mn3_nuclSphere","Sphere"),t+=e.getRadio("mn3_nucl","mn3_nuclNo","Hide"),t+="    </ul>",t+="  </li>"),t+="  <li><span>Chemicals</span>",t+="    <ul>",t+=e.getRadio("mn3_lig","mn3_ligLines","Lines"),void 0===e.cfg.cid?(t+=e.getRadio("mn3_lig","mn3_ligStick","Stick",!0),t+=e.getRadio("mn3_lig","mn3_ligBallstick","Ball and Stick")):(t+=e.getRadio("mn3_lig","mn3_ligStick","Stick"),t+=e.getRadio("mn3_lig","mn3_ligBallstick","Ball and Stick",!0)),t+=e.getRadio("mn3_lig","mn3_ligSchematic","Schematic"),t+=e.getRadio("mn3_lig","mn3_ligSphere","Sphere"),t+=e.getRadio("mn3_lig","mn3_ligNo","Hide"),t+="    </ul>",t+="  </li>",t+="  <li><span>Ions</span>",t+="    <ul>",t+=e.getRadio("mn3_ions","mn3_ionsSphere","Sphere",!0),t+=e.getRadio("mn3_ions","mn3_ionsDot","Dot"),t+=e.getRadio("mn3_ions","mn3_ionsNo","Hide"),t+="    </ul>",t+="  </li>",t+="  <li><span>Water</span>",t+="    <ul>",t+=e.getRadio("mn3_water","mn3_waterSphere","Sphere"),t+=e.getRadio("mn3_water","mn3_waterDot","Dot"),t+=e.getRadio("mn3_water","mn3_waterNo","Hide",!0),t+="    </ul>",t+="  </li>",t+=e.getLink("mn3_setThickness","Set Thickness"),t+="  <li>-</li>",t+=e.getLink("mn3_styleSave","Save Style"),t+=e.getLink("mn3_styleApplySave","Apply Saved Style"),t+="  <li>-</li>",t+="  <li><span>Surface Type</span>",t+="    <ul>",t+=e.getRadio("mn5_surface","mn5_surfaceVDW","Van der Waals"),t+=e.getRadio("mn5_surface","mn5_surfaceVDWContext","VDW with Context"),t+=e.getRadio("mn5_surface","mn5_surfaceMolecular","Molecular Surface"),t+=e.getRadio("mn5_surface","mn5_surfaceMolecularContext","MS with Context"),t+=e.getRadio("mn5_surface","mn5_surfaceSAS","Solvent Accessible"),t+=e.getRadio("mn5_surface","mn5_surfaceSASContext","SA with Context"),t+="    </ul>",t+="  </li>",t+=e.getLink("mn5_surfaceNo","Remove Surface"),t+="  <li><span>Surface Opacity</span>",t+="    <ul>",t+=e.getRadio("mn5_opacity","mn5_opacity10","1.0",!0),t+=e.getRadio("mn5_opacity","mn5_opacity09","0.9"),t+=e.getRadio("mn5_opacity","mn5_opacity08","0.8"),t+=e.getRadio("mn5_opacity","mn5_opacity07","0.7"),t+=e.getRadio("mn5_opacity","mn5_opacity06","0.6"),t+=e.getRadio("mn5_opacity","mn5_opacity05","0.5"),t+=e.getRadio("mn5_opacity","mn5_opacity04","0.4"),t+=e.getRadio("mn5_opacity","mn5_opacity03","0.3"),t+=e.getRadio("mn5_opacity","mn5_opacity02","0.2"),t+=e.getRadio("mn5_opacity","mn5_opacity01","0.1"),t+="    </ul>",t+="  </li>",t+="  <li><span>Surface <br>Wireframe</span>",t+="    <ul>",t+=e.getRadio("mn5_wireframe","mn5_wireframeYes","Yes"),t+=e.getRadio("mn5_wireframe","mn5_wireframeNo","No",!0),t+="    </ul>",t+="  </li>",void 0===e.cfg.cid&&(t+="  <li>-</li>",t+="  <li id='"+e.pre+"mapWrapper1'><span>Electron Density</span>",t+="    <ul>",t+=e.getRadio("mn5_elecmap","mn5_elecmap2fofc","2Fo-Fc Map"),t+=e.getRadio("mn5_elecmap","mn5_elecmapfofc","Fo-Fc Map"),t+="    </ul>",t+="  </li>",t+=e.getLinkWrapper("mn5_elecmapNo","Remove Map","mapWrapper2"),t+="  <li id='"+e.pre+"mapWrapper3'><span>Map <br>Wireframe</span>",t+="    <ul>",t+=e.getRadio("mn5_mapwireframe","mn5_mapwireframeYes","Yes",!0),t+=e.getRadio("mn5_mapwireframe","mn5_mapwireframeNo","No"),t+="    </ul>",t+="  </li>",void 0===e.cfg.mmtfid&&(t+=e.getLinkWrapper("mn5_emmap","EM Density Map","emmapWrapper1"),t+=e.getLinkWrapper("mn5_emmapNo","Remove EM Map","emmapWrapper2"),t+="  <li id='"+e.pre+"emmapWrapper3'><span>EM Map <br>Wireframe</span>",t+="    <ul>",t+=e.getRadio("mn5_emmapwireframe","mn5_emmapwireframeYes","Yes",!0),t+=e.getRadio("mn5_emmapwireframe","mn5_emmapwireframeNo","No"),t+="    </ul>",t+="  </li>")),t+="  <li>-</li>",t+="  <li><span>Background</span>",t+="    <ul>",t+=e.getRadio("mn6_bkgd","mn6_bkgdTransparent","Transparent",!0),t+=e.getRadio("mn6_bkgd","mn6_bkgdBlack","Black"),t+=e.getRadio("mn6_bkgd","mn6_bkgdGrey","Grey"),t+=e.getRadio("mn6_bkgd","mn6_bkgdWhite","White"),t+="    </ul>",t+="  </li>",t+="  <li><br/></li>",t+="</ul>",t+="</div>",t+="          </accordion>",t+="    </div>"},iCn3DUI.prototype.setMenu4=function(){var e=this,t="";return t+="    <div class='icn3d-menu'>",t+="          <accordion id='"+e.pre+"accordion4'>",t+="<h3 id='"+e.pre+"color'>Color</h3>",t+="<div>",t+="<ul class='icn3d-mn'>",void 0===e.cfg.cid?(t+=e.getRadio("mn4_clr","mn4_clrSpectrum","Spectrum"),t+="  <li><span style='padding-left:2em;'>Secondary</span>",t+="    <ul>",t+=e.getRadio("mn4_clr","mn4_clrSSGreen","Sheet in Green"),t+=e.getRadio("mn4_clr","mn4_clrSSYellow","Sheet in Yellow"),t+="    </ul>",t+=e.getRadio("mn4_clr","mn4_clrCharge","Charge"),t+=e.getRadio("mn4_clr","mn4_clrHydrophobic","Hydrophobic"),t+=void 0!==e.cfg.align||void 0!==e.cfg.blast_rep_id?e.getRadio("mn4_clr","mn4_clrChain","Chain"):e.getRadio("mn4_clr","mn4_clrChain","Chain",!0),t+=e.getRadio("mn4_clr","mn4_clrResidue","Residue"),t+=e.getRadio("mn4_clr","mn4_clrAtom","Atom"),t+="  <li><span style='padding-left:2em;'>B-factor</span>",t+="    <ul>",t+=e.getRadio("mn4_clr","mn4_clrBfactor","Original"),t+=e.getRadio("mn4_clr","mn4_clrBfactorNorm","Percentile"),t+="    </ul>",void 0!==e.cfg.align?(t+=e.getRadio("mn4_clr","mn4_clrIdentity","Identity",!0),t+=e.getRadio("mn4_clr","mn4_clrConserved","Conservation")):void 0!==e.cfg.blast_rep_id&&(t+=e.getRadio("mn4_clr","mn4_clrIdentity","Identity"),t+=e.getRadio("mn4_clr","mn4_clrConserved","Conservation",!0))):t+=e.getRadio("mn4_clr","mn4_clrAtom","Atom",!0),t+="  <li>-</li>",t+="  <li><span style='padding-left:2em;'>Unicolor</span>",t+="    <ul>",t+=e.getRadio("mn4_clr","mn4_clrRed","Red"),t+=e.getRadio("mn4_clr","mn4_clrGreen","Green"),t+=e.getRadio("mn4_clr","mn4_clrBlue","Blue"),t+=e.getRadio("mn4_clr","mn4_clrMagenta","Magenta"),t+=e.getRadio("mn4_clr","mn4_clrYellow","Yellow"),t+=e.getRadio("mn4_clr","mn4_clrCyan","Cyan"),t+=e.getRadio("mn4_clr","mn4_clrWhite","White"),t+=e.getRadio("mn4_clr","mn4_clrGrey","Grey"),t+="    </ul>",t+=e.getRadio("mn4_clr","mn4_clrCustom","Color Picker"),t+="  <li>-</li>",t+=e.getLink("mn4_clrSave","Save Color"),t+=e.getLink("mn4_clrApplySave","Apply Saved Color"),t+="  <li><br/></li>",t+="</ul>",t+="</div>",t+="          </accordion>",t+="    </div>"},iCn3DUI.prototype.setMenu5=function(){var e=this,t="";return t+="    <div class='icn3d-menu'>",t+="          <accordion id='"+e.pre+"accordion5'>",t+="<h3 id='"+e.pre+"windows' style='font-size:1.2em'>&nbsp;Windows</h3>",t+="<div>",t+="<ul class='icn3d-mn'>",void 0===e.cfg.cid&&(t+=e.getLink("mn6_selectannotations","View Sequences<br>& Annotations"),void 0!==e.cfg.align&&(t+=e.getLink("mn2_alignment","View Aligned<br>Sequences")),void 0===e.cfg.mmdbid&&void 0===e.cfg.gi&&void 0===e.cfg.blast_rep_id&&void 0===e.cfg.align||(t+=e.getLink("mn2_2ddgm","View Interactions"))),void 0!==e.cfg.cid?(t+="  <li><span>Links</span>",t+="    <ul>",t+=e.getLink("mn1_link_structure","Compound Summary"),t+=e.getLink("mn1_link_vast","Similar Compounds"),t+=e.getLink("mn1_link_bind","Structures Bound"),t+="    </ul>",t+="  </li>"):(t+="  <li><span>Links</span>",t+="    <ul>",t+=e.getLink("mn1_link_structure","Structure Summary"),t+=e.getLink("mn1_link_vast","Similar Structures"),t+=e.getLink("mn1_link_pubmed","Literature"),t+=e.getLink("mn1_link_protein","Protein"),t+="    </ul>",t+="  </li>"),t+="  <li><br/></li>",t+="</ul>",t+="</div>",t+="          </accordion>",t+="    </div>"},iCn3DUI.prototype.setMenu6=function(){var e=this,t="";return t+="    <div class='icn3d-menu'>",t+="          <accordion id='"+e.pre+"accordion6'>",t+="<h3>Help</h3>",t+="<div>",t+="<ul class='icn3d-mn'>",t+="  <li><a href='https://www.ncbi.nlm.nih.gov/Structure/icn3d/docs/icn3d_about.html' target='_blank'>About iCn3D<span style='font-size:0.9em'> "+e.REVISION+"</span></a></li>",t+="  <li><a href='https://www.ncbi.nlm.nih.gov/Structure/icn3d/docs/icn3d_help.html' target='_blank'>Help Doc</a></li>",t+="  <li><span>Web APIs</span>",t+="    <ul>",t+="<li><a href='https://www.ncbi.nlm.nih.gov/Structure/icn3d/icn3d.html#HowToUse' target='_blank'>How to Use</a></li>",t+="<li><a href='https://www.ncbi.nlm.nih.gov/Structure/icn3d/icn3d.html#parameters' target='_blank'>URL Parameters</a></li>",t+="<li><a href='https://www.ncbi.nlm.nih.gov/Structure/icn3d/icn3d.html#commands' target='_blank'>Commands</a></li>",t+="    </ul>",t+="  </li>",t+="  <li><a href='https://github.com/ncbi/icn3d' target='_blank'>Source Code</a></li>",t+="  <li>-</li>",t+="  <li><span>Transform Hints</span>",t+="    <ul>",t+="      <li><span>Rotate</span>",t+="          <ul>",t+="<li>Left Mouse</li>",t+="<li>Key L: Left</li>",t+="<li>Key J: Right</li>",t+="<li>Key I: Up</li>",t+="<li>Key M: Down</li>",t+="          </ul>",t+="      </li>",t+="      <li><span>Zoom</span>",t+="          <ul>",t+="<li>Middle Mouse</li>",t+="<li>Key Z: Zoom in</li>",t+="<li>Key X: Zoom out</li>",t+="          </ul>",t+="      </li>",t+="      <li><span>Translate</span>",t+="          <ul>",t+="<li>Right Mouse</li>",t+="          </ul>",t+="      </li>",t+="    </ul>",t+="  </li>",t+="  <li><a href='https://www.ncbi.nlm.nih.gov/Structure/icn3d/icn3d.html#HowToUseStep5' target='_blank'>Selection Hints</a></li>",t+="  <li><br/></li>",t+="</ul>",t+="</div>",t+="          </accordion>",t+="    </div>"},iCn3DUI.prototype.setLogWindow=function(){var e=this,t="";return t+="  <div id='"+e.pre+"cmdlog' style='float:left; margin-top: -5px; width: 100%;'>",t+="    <textarea id='"+e.pre+"logtext' rows='2' style='width: 100%; height: "+e.CMD_HEIGHT+"px; padding: 0px; border: 0px; background-color: "+e.GREYD+";'></textarea>",t+="  </div>"},iCn3DUI.prototype.setAdvanced=function(e){var t=this,i=void 0===e?"":e,n="<div id='"+t.pre+"dl_advanced"+i+"'>";return n+="      <table width='500'><tr><td valign='top'><table cellspacing='0'>",n+="    <tr><td><b>Select:</b></td><td><input type='text' id='"+t.pre+"command"+i+"' placeholder='$[structures].[chains]:[residues]@[atoms]' size='60'></td></tr>",n+="    <tr><td><b>Name:</b></td><td><input type='text' id='"+t.pre+"command_name"+i+"' placeholder='my_selection' size='60'></td></tr>",n+="    <tr><td colspan='2' align='left'>&nbsp;&nbsp;&nbsp;<button id='"+t.pre+"command_apply"+i+"'><b>Save Selection</b></button></td></tr>",n+="      </table></td>",n+="      </tr>",n+="      <tr><td>",n+='Specification Tips: <div style="width:20px; margin-top:6px; display:inline-block;"><span id="'+t.pre+"specguide"+i+'_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+t.pre+"specguide"+i+'_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div><br>',n+="<div id='"+t.pre+"specguide"+i+"' style='display:none; width:500px' class='icn3d-box'>",n+='  <b>Specification:</b> In the selection "$1HHO,4N7N.A,B,C:5-10,KRDE,chemicals@CA,C":',n+='  <ul><li>"$1HHO,4N7N" uses "$" to indicate structure selection.<br/>',n+='  <li>".A,B,C" uses "." to indicate chain selection.<br/>',n+='  <li>":5-10,KRDE,chemicals" uses ":" to indicate residue selection. Residue selection could be residue number (5-10), one-letter sequence (KRDE), or predefined names: "proteins", "nucleotides", "chemicals", "ions", and "water".<br/>',n+='  <li>"@CA,C" uses "@" to indicate atom selection.<br/>',n+='  <li>Partial definition is allowed, e.g., ":1-10" selects all residue IDs 1-10 in all chains.<br/>',n+='  <li>Different selections can be unioned (with "<b>or</b>", default), intersected (with "<b>and</b>"), or negated (with "<b>not</b>"). For example, ":1-10 or :K" selects all residues 1-10 and all Lys residues. ":1-10 and :K" selects all Lys residues in the range of residue number 1-10. ":1-10 or not :K" selects all residues 1-10, which are not Lys residues.</ul>',n+="  <b>Set Operation:</b>",n+='  <ul><li>Users can select multiple sets in the menu "Select > Defined Sets".<br/>',n+='  <li>Different sets can be unioned (with "<b>or</b>", default), intersected (with "<b>and</b>"), or negated (with "<b>not</b>"). For example, if the "Defined Sets" menu has four sets ":1-10", ":11-20", ":5-15", and ":7-8", the command "saved atoms :1-10 or :11-20 and :5-15 not :7-8" unions all residues 1-10 and 11-20 to get the residues 1-20, then intersects with the residues 5-15 to get the residues 5-15, then exclude the residues 7-8 to get the final residues 5-6 and 9-15.</ul>',n+="  <b>Full commands in url or command window:</b>",n+="  <ul><li>Select without saving the set: select $1HHO,4N7N.A,B,C:5-10,KRDE,chemicals@CA,C<br/>",n+="  <li>Select and save: select $1HHO,4N7N.A,B,C:5-10,KRDE,chemicals@CA,C | name my_name</ul>",n+="</div>",n+="      </td></tr></table>",n+="</div>"},iCn3DUI.prototype.setDialogs=function(){var e=this,t="";t+="<!-- dialog will not be part of the form -->",t+="<div id='"+e.pre+"alldialogs' class='icn3d-hidden icn3d-dialog'>",t+="<div id='"+e.pre+"dl_2ddgm' class='icn3d-dl_2ddgm'>",t+="</div>",void 0!==e.cfg.align&&(t+="<div id='"+e.pre+"dl_alignment' style='background-color:white;'>",t+="  <div id='"+e.pre+"dl_sequence2' class='icn3d-dl_sequence'>",t+="  </div>",t+="</div>"),t+="<div id='"+e.pre+"dl_definedsets'>",t+="    <div id='"+e.pre+"dl_setsmenu'>",t+="        <b>Defined Sets:</b> <br/>",t+="        <select id='"+e.pre+"atomsCustom' multiple size='6' style='min-width:130px;'>",t+="        </select>",t+="        <div style='margin: 6px 0 6px 0;'><button id='"+e.pre+"deletesets'><b>Delete Selected Sets</b></button></div>",t+='        <b>Set Operations</b>: <div style="width:20px; margin-top:6px; display:inline-block;"><span id="'+e.pre+'dl_command_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+e.pre+'dl_command_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div><br>',t+="    </div>",t+="    <div id='"+e.pre+"dl_command' style='display:none;'>",t+="      <div id='"+e.pre+"dl_setoperations'>",t+="        <label for='"+e.pre+"setOr'><input type='radio' name='"+e.pre+"setOperation' id='"+e.pre+"setOr' checked> Union (or) </label><br/>",t+="        <label for='"+e.pre+"setAnd'><input type='radio' name='"+e.pre+"setOperation' id='"+e.pre+"setAnd'> Intersection (and) </label><br/>",t+="        <label for='"+e.pre+"setNot'><input type='radio' name='"+e.pre+"setOperation' id='"+e.pre+"setNot'> Exclusion (not) </label>",t+="      </div><br>",t+=e.setAdvanced(),t+="    </div>",t+="</div>",t+=e.setAdvanced(2),t+="<div id='"+e.pre+"dl_mmtfid'>",t+="MMTF ID: <input type='text' id='"+e.pre+"mmtfid' value='1TUP' size=8> ",t+="<button id='"+e.pre+"reload_mmtf'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_pdbid'>",t+="PDB ID: <input type='text' id='"+e.pre+"pdbid' value='1TUP' size=8> ",t+="<button id='"+e.pre+"reload_pdb'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_pdbfile'>",t+="PDB File: <input type='file' id='"+e.pre+"pdbfile' size=8> ",t+="<button id='"+e.pre+"reload_pdbfile'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_align'>",t+="Enter the PDB IDs or MMDB IDs of two structures that have been found to be similar by <A HREF=' https://www.ncbi.nlm.nih.gov/Structure/vastplus/vastplus.cgi'>VAST+</A> : <br/><br/>ID1: <input type='text' id='"+e.pre+"alignid1' value='1HHO' size=8>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ID2: <input type='text' id='"+e.pre+"alignid2' value='4N7N' size=8><br/><br/>",t+="<button id='"+e.pre+"reload_align_ori'>All Matching Molecules Superposed</button>&nbsp;&nbsp;&nbsp;<button id='"+e.pre+"reload_align_refined'>Invariant Substructure Superposed</button>",t+="</div>",t+="<div id='"+e.pre+"dl_mol2file'>",t+="Mol2 File: <input type='file' id='"+e.pre+"mol2file' size=8> ",t+="<button id='"+e.pre+"reload_mol2file'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_sdffile'>",t+="SDF File: <input type='file' id='"+e.pre+"sdffile' size=8> ",t+="<button id='"+e.pre+"reload_sdffile'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_xyzfile'>",t+="XYZ File: <input type='file' id='"+e.pre+"xyzfile' size=8> ",t+="<button id='"+e.pre+"reload_xyzfile'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_urlfile'>",t+="File type: ",t+="<select id='"+e.pre+"filetype'>",t+="<option value='pdb' selected>pdb</option>",t+="<option value='mol2'>mol2</option>",t+="<option value='sdf'>sdf</option>",t+="<option value='xyz'>xyz</option>",t+="</select><br/>",t+="URL in the same host: <input type='text' id='"+e.pre+"urlfile' size=20><br/> ",t+="<button id='"+e.pre+"reload_urlfile'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_mmciffile'>",t+="mmCIF File: <input type='file' id='"+e.pre+"mmciffile' value='1TUP' size=8> ",t+="<button id='"+e.pre+"reload_mmciffile'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_mmcifid'>",t+="mmCIF ID: <input type='text' id='"+e.pre+"mmcifid' value='1TUP' size=8> ",t+="<button id='"+e.pre+"reload_mmcif'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_mmdbid'>",t+="MMDB ID: <input type='text' id='"+e.pre+"mmdbid' value='1TUP' size=8> ",t+="<button id='"+e.pre+"reload_mmdb'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_blast_rep_id' style='max-width:500px;'>",t+="Enter a Sequence ID (or FASTA sequence) and the aligned Structure ID, which can be found using the <a href='https://blast.ncbi.nlm.nih.gov/Blast.cgi?PROGRAM=blastp&PAGE_TYPE=BlastSearch&DATABASE=pdb' target='_blank'>BLAST</a> search against the pdb database with the Sequence ID or FASTA sequence as input.<br><br> ",t+="<b>Sequence ID</b> (NCBI protein accession of a sequence): <input type='text' id='"+e.pre+"query_id' value='NP_001108451.1' size=8><br> ",t+="or FASTA sequence: <br><textarea id='"+e.pre+"query_fasta' rows='5' style='width: 100%; height: "+e.MENU_HEIGHT+"px; padding: 0px; border: 0px;'></textarea><br><br>",t+="<b>Structure ID</b> (NCBI protein accession of a chain of a 3D structure): <input type='text' id='"+e.pre+"blast_rep_id' value='1TSR_A' size=8><br> ",t+="<button id='"+e.pre+"reload_blast_rep_id'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_gi'>",t+="Protein gi: <input type='text' id='"+e.pre+"gi' value='1310960' size=8> ",t+="<button id='"+e.pre+"reload_gi'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_cid'>",t+="PubChem CID: <input type='text' id='"+e.pre+"cid' value='2244' size=8> ",t+="<button id='"+e.pre+"reload_cid'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_pngimage'>",t+="iCn3D PNG image: <input type='file' id='"+e.pre+"pngimage'><br/>",t+="<button id='"+e.pre+"reload_pngimage' style='margin-top: 6px;'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_state'>",t+="State file: <input type='file' id='"+e.pre+"state'><br/>",t+="<button id='"+e.pre+"reload_state' style='margin-top: 6px;'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_selection'>",t+="Selection file: <input type='file' id='"+e.pre+"selectionfile'><br/>",t+="<button id='"+e.pre+"reload_selectionfile' style='margin-top: 6px;'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_clr'>",t+="Click in the input box to use the color picker:<br><br> ",t+="Custom Color: <input type='text' id='"+e.pre+"colorcustom' value='FF0000' size=8> ",t+="<button id='"+e.pre+"applycustomcolor'>Apply</button>",t+="</div>",t+="<div id='"+e.pre+"dl_hbonds'>",t+="<div style='width:400px;'>To show hydrogen bonds between other residues and the current selection, please select the threshold of H-bonds.</div><br/>",t+="  <span style='white-space:nowrap;font-weight:bold;'>Threshold: <select id='"+e.pre+"hbondthreshold'>",t+="  <option value='3.2'>3.2</option>",t+="  <option value='3.3'>3.3</option>",t+="  <option value='3.4'>3.4</option>",t+="  <option value='3.5' selected>3.5</option>",t+="  <option value='3.6'>3.6</option>",t+="  <option value='3.7'>3.7</option>",t+="  <option value='3.8'>3.8</option>",t+="  <option value='3.9'>3.9</option>",t+="  <option value='4.0'>4.0</option>",t+="  </select> &#197;</span> <span style='white-space:nowrap; margin-left:30px;'><button id='"+e.pre+"applyhbonds'>Display</button></span>",t+="</div>",t+="<div id='"+e.pre+"dl_elecmap2fofc'>",t+="  <span style='white-space:nowrap;font-weight:bold;'>Contour at: <select id='"+e.pre+"sigma2fofc'>",t+="  <option value='0'>0</option>",t+="  <option value='0.5'>0.5</option>",t+="  <option value='1'>1</option>",t+="  <option value='1.5' selected>1.5</option>",t+="  <option value='2'>2</option>",t+="  <option value='3'>3</option>",t+="  <option value='4'>4</option>",t+="  <option value='5'>5</option>",t+="  <option value='6'>6</option>",t+="  <option value='7'>7</option>",t+="  <option value='8'>8</option>",t+="  <option value='9'>9</option>",t+="  <option value='10'>10</option>",t+="  </select> &sigma;</span> <span style='white-space:nowrap; margin-left:30px;'><button id='"+e.pre+"applymap2fofc'>Display</button></span> <span style='white-space:nowrap; margin-left:30px;'><button id='"+e.pre+"elecmapNo2'>Remove Map</button></span>",t+="</div>",t+="<div id='"+e.pre+"dl_elecmapfofc'>",t+="  <span style='white-space:nowrap;font-weight:bold;'>Contour at: <select id='"+e.pre+"sigmafofc'>",t+="  <option value='0'>0</option>",t+="  <option value='0.5'>0.5</option>",t+="  <option value='1'>1</option>",t+="  <option value='1.5'>1.5</option>",t+="  <option value='2'>2</option>",t+="  <option value='3' selected>3</option>",t+="  <option value='4'>4</option>",t+="  <option value='5'>5</option>",t+="  <option value='6'>6</option>",t+="  <option value='7'>7</option>",t+="  <option value='8'>8</option>",t+="  <option value='9'>9</option>",t+="  <option value='10'>10</option>",t+="  </select> &sigma;</span> <span style='white-space:nowrap; margin-left:30px;'><button id='"+e.pre+"applymapfofc'>Display</button></span> <span style='white-space:nowrap; margin-left:30px;'><button id='"+e.pre+"elecmapNo3'>Remove Map</button></span>",t+="</div>",t+="<div id='"+e.pre+"dl_emmap'>",t+="  <span style='white-space:nowrap;font-weight:bold;'>Contour at: <select id='"+e.pre+"empercentage'>",t+="  <option value='0'>0</option>",t+="  <option value='10'>10</option>",t+="  <option value='20'>20</option>",t+="  <option value='30' selected>30</option>",t+="  <option value='40'>40</option>",t+="  <option value='50'>50</option>",t+="  <option value='60'>60</option>",t+="  <option value='70'>70</option>",t+="  <option value='80'>80</option>",t+="  <option value='90'>90</option>",t+="  <option value='100'>100</option>",t+="  </select> % of maximum EM values</span><br><span style='white-space:nowrap; margin-left:30px;'><button id='"+e.pre+"applyemmap'>Display</button></span> <span style='white-space:nowrap; margin-left:30px;'><button id='"+e.pre+"emmapNo2'>Remove EM Map</button></span>",t+="</div>",t+="<div id='"+e.pre+"dl_aroundsphere'>",
t+="  <span style='white-space:nowrap'>1. Sphere with a radius: <input type='text' id='"+e.pre+"radius_aroundsphere' value='4' size='2'> &#197;</span><br/>",t+="  <span style='white-space:nowrap'>2. <button id='"+e.pre+"applypick_aroundsphere'>Display</button> the sphere around currently selected atoms</span>",t+="</div>",t+="<div id='"+e.pre+"dl_addlabel'>",t+="1. Text: <input type='text' id='"+e.pre+"labeltext' value='Text' size=4><br/>",t+="2. Size: <input type='text' id='"+e.pre+"labelsize' value='18' size=4 maxlength=2><br/>",t+="3. Color: <input type='text' id='"+e.pre+"labelcolor' value='ffff00' size=4><br/>",t+="4. Background: <input type='text' id='"+e.pre+"labelbkgd' value='cccccc' size=4><br/>",t+=e.isMobile()?"  <span style='white-space:nowrap'>5. Touch TWO atoms</span><br/>":"  <span style='white-space:nowrap'>5. Pick TWO atoms while holding \"Alt\" key</span><br/>",t+="<span style='white-space:nowrap'>6. <button id='"+e.pre+"applypick_labels'>Display</button></span>",t+="</div>",t+="<div id='"+e.pre+"dl_addlabelselection'>",t+="1. Text: <input type='text' id='"+e.pre+"labeltext2' value='Text' size=4><br/>",t+="2. Size: <input type='text' id='"+e.pre+"labelsize2' value='18' size=4 maxlength=2><br/>",t+="3. Color: <input type='text' id='"+e.pre+"labelcolor2' value='ffff00' size=4><br/>",t+="4. Background: <input type='text' id='"+e.pre+"labelbkgd2' value='cccccc' size=4><br/>",t+="<span style='white-space:nowrap'>5. <button id='"+e.pre+"applyselection_labels'>Display</button></span>",t+="</div>",t+="<div id='"+e.pre+"dl_distance'>",t+=e.isMobile()?"  <span style='white-space:nowrap'>1. Touch TWO atoms</span><br/>":"  <span style='white-space:nowrap'>1. Pick TWO atoms while holding \"Alt\" key</span><br/>",t+="  <span style='white-space:nowrap'>2. Color: <input type='text' id='"+e.pre+"distancecolor' value='ffff00' size=4><br/>",t+="  <span style='white-space:nowrap'>3. <button id='"+e.pre+"applypick_measuredistance'>Display</button></span>",t+="</div>",t+="<div id='"+e.pre+"dl_stabilizer'>",t+=e.isMobile()?"  <span style='white-space:nowrap'>1. Touch TWO atoms</span><br/>":"  <span style='white-space:nowrap'>1. Pick TWO atoms while holding \"Alt\" key</span><br/>",t+="  <span style='white-space:nowrap'>2. Color: <input type='text' id='"+e.pre+"stabilizercolor' value='ffffff' size=4><br/>",t+="  <span style='white-space:nowrap'>3. <button id='"+e.pre+"applypick_stabilizer'>Add</button></span>",t+="</div>",t+="<div id='"+e.pre+"dl_stabilizer_rm'>",t+=e.isMobile()?"  <span style='white-space:nowrap'>1. Touch TWO atoms</span><br/>":"  <span style='white-space:nowrap'>1. Pick TWO atoms while holding \"Alt\" key</span><br/>",t+="  <span style='white-space:nowrap'>2. <button id='"+e.pre+"applypick_stabilizer_rm'>Remove</button></span>",t+="</div>",t+="<div id='"+e.pre+"dl_thickness'>",t+=e.setThicknessHtml("3dprint"),t+="</div>",t+="<div id='"+e.pre+"dl_thickness2'>",t+=e.setThicknessHtml("style"),t+="</div>",t+="<div id='"+e.pre+"dl_addtrack'>",t+="     <input type='hidden' id='"+e.pre+"track_chainid' value=''>",t+="    <div id='"+e.pre+"dl_addtrack_tabs' style='border:0px;'>",t+="      <ul>",t+="        <li><a href='#"+e.pre+"tracktab1'>NCBI gi/Accession</a></li>",t+="        <li><a href='#"+e.pre+"tracktab2'>FASTA</a></li>",t+="        <li><a href='#"+e.pre+"tracktab3'>BED File</a></li>",t+="        <li><a href='#"+e.pre+"tracktab4'>Custom</a></li>",t+="        <li><a href='#"+e.pre+"tracktab5'>Current Selection</a></li>",t+="      </ul>",t+="      <div id='"+e.pre+"tracktab1'>",t+="NCBI gi/Accession: <input type='text' id='"+e.pre+"track_gi' placeholder='gi' size=16> <br><br>",t+="<button id='"+e.pre+"addtrack_button1'>Add Track</button>",t+="      </div>",t+="      <div id='"+e.pre+"tracktab2'>",t+="FASTA sequence: <br><textarea id='"+e.pre+"track_fasta' rows='5' style='width: 100%; height: "+2*e.MENU_HEIGHT+"px; padding: 0px; border: 0px;'></textarea><br><br>",t+="<button id='"+e.pre+"addtrack_button2'>Add Track</button>",t+="      </div>",t+="      <div id='"+e.pre+"tracktab3'>",t+="BED file: <input type='file' id='"+e.pre+"track_bed' size=16> <br><br>",t+="<button id='"+e.pre+"addtrack_button3'>Add Track</button>",t+="      </div>",t+="      <div id='"+e.pre+"tracktab4'>",t+="Track Title: <input type='text' id='"+e.pre+"track_title' placeholder='track title' size=16> <br><br>",t+='Track Text (e.g., "152 G, 155-156 RR" defines a character "G" at the position 152 and two continuous characters "RR" at positions from 155 to 156. The starting position is 1): <br>',t+="<textarea id='"+e.pre+"track_text' rows='5' style='width: 100%; height: "+2*e.MENU_HEIGHT+"px; padding: 0px; border: 0px;'></textarea><br><br>",t+="<button id='"+e.pre+"addtrack_button4'>Add Track</button>",t+="      </div>",t+="      <div id='"+e.pre+"tracktab5'>",t+="Track Title: <input type='text' id='"+e.pre+"track_selection' placeholder='track title' size=16> <br><br>",t+="<button id='"+e.pre+"addtrack_button5'>Add Track</button>",t+="      </div>",t+="    </div>",t+="</div>",t+="<div id='"+e.pre+"dl_saveselection'>";var i=e.icn3d?Object.keys(e.icn3d.defNames2Atoms).length:1,n="";return t+="Name: <input type='text' id='"+e.pre+"seq_command_name"+n+"' value='seq_"+i+"' size='5'> <br>",t+="<button style='white-space:nowrap;' id='"+e.pre+"seq_saveselection"+n+"'>Save</button> <button style='white-space:nowrap; margin-left:20px;' id='"+e.pre+"seq_clearselection"+n+"'>Clear</button><br/><br/>",t+="</div>",t+="<div id='"+e.pre+"dl_copyurl'>",t+="Please copy one of the URLs below. They work the same way.<br><br>",t+="Original URL with commands: <br><textarea id='"+e.pre+"ori_url' rows='4' style='width:100%'></textarea><br><br>",t+="Short URL: <br><input type='text' id='"+e.pre+"short_url' value='' style='width:100%'><br><br>",t+="</div>",t+="<div id='"+e.pre+"dl_selectannotations' class='icn3d-annotation' style='background-color:white;'>",t+="    <div id='"+e.pre+"dl_annotations_tabs'>",t+="<div id='"+e.pre+"dl_anno_view_tabs' style='border:0px; height:33px;'>",t+="      <ul>",t+="        <li><a href='#"+e.pre+"anno_tmp1' id='"+e.pre+"anno_summary'>Summary</a></li>",t+="        <li><a href='#"+e.pre+"anno_tmp2' id='"+e.pre+"anno_details'>Details</a></li>",t+="      </ul>",t+="      <div id='"+e.pre+"anno_tmp1'>",t+="      </div>",t+="      <div id='"+e.pre+"anno_tmp2'>",t+="      </div>",t+="</div>",t+="      <div class='icn3d-box' style='width:520px;'><b>Annotations:&nbsp;</b><br><table border=0><tr>",t+="        <td style='min-width:60px;'><input type='checkbox' id='"+e.pre+"anno_all'>All&nbsp;&nbsp;</td>",t+="        <td style='min-width:130px;'><input type='checkbox' id='"+e.pre+"anno_cdd' checked>Conserved Domains&nbsp;&nbsp;</td>",t+="        <td style='min-width:60px;'><input type='checkbox' id='"+e.pre+"anno_clinvar'>ClinVar&nbsp;&nbsp;</td>",t+="        <td style='min-width:110px;'><input type='checkbox' id='"+e.pre+"anno_binding'>Functional Sites&nbsp;&nbsp;</td>",t+="        <td style='min-width:110px;'><input type='checkbox' id='"+e.pre+"anno_ssbond'>Disulfide Bonds&nbsp;&nbsp;</td>",t+="      </tr><tr>",t+="        <td style='min-width:60px;'><input type='checkbox' id='"+e.pre+"anno_custom'>Custom&nbsp;&nbsp;</td>",t+="        <td style='min-width:130px;'><input type='checkbox' id='"+e.pre+"anno_3dd'>3D Domains&nbsp;&nbsp;</td>",t+="        <td style='min-width:60px;'><input type='checkbox' id='"+e.pre+"anno_snp'>SNPs&nbsp;&nbsp;</td>",t+="        <td style='min-width:110px;'><input type='checkbox' id='"+e.pre+"anno_interact'>Interactions&nbsp;&nbsp;</td>",t+="        <td></td>",t+="      </tr></table></div>",t+="<button style='white-space:nowrap; margin-left:5px;' id='"+e.pre+"showallchains'>Show All Chains</button><br>",t+="    <div id='"+e.pre+"seqguide_wrapper' style='display:none'><br>"+e.setSequenceGuide("2")+"</div>",t+="    </div><br/><hr><br>",t+="    <div id='"+e.pre+"dl_annotations'>",t+="    </div>",t+="</div>",t+="</div>",t+="<!--/form-->"},iCn3DUI.prototype.setThicknessHtml=function(e){var t=this,i="",n="3dprint"==e?"1":"0.1",o="3dprint"==e?"1.2":"0.3",r="3dprint"==e?"0.8":"0.4",s="3dprint"==e?"1":"0.2",a="3dprint"==e?"1":"0.2",c="3dprint"==e?"2":"1.3",d="3dprint"==e?"1.4":"0.8",l="3dprint"==e?"0.6":"0.3";return i+="<b>Line Radius</b>: <input type='text' id='"+t.pre+"linerad_"+e+"' value='"+n+"' size=4>&nbsp;&nbsp;&nbsp;(for stabilizers, hydrogen bonds, distance lines, default 0.1)<br/>",i+="<b>Coil Radius</b>: <input type='text' id='"+t.pre+"coilrad_"+e+"' value='"+o+"' size=4>&nbsp;&nbsp;&nbsp;(for coils, default 0.3)<br/>",i+="<b>Stick Radius</b>: <input type='text' id='"+t.pre+"stickrad_"+e+"' value='"+r+"' size=4>&nbsp;&nbsp;&nbsp;(for sticks, default 0.4)<br/>",i+="<b>Trace Radius</b>: <input type='text' id='"+t.pre+"tracerad_"+e+"' value='"+s+"' size=4>&nbsp;&nbsp;&nbsp;(for C alpha trace, O3' trace, default 0.2)<br/>",i+="<b>Ribbon Thickness</b>: <input type='text' id='"+t.pre+"ribbonthick_"+e+"' value='"+a+"' size=4>&nbsp;&nbsp;&nbsp;(for helix and sheet ribbons, nucleotide ribbons, default 0.2)<br/>",i+="<b>Protein Ribbon Width</b>: <input type='text' id='"+t.pre+"prtribbonwidth_"+e+"' value='"+c+"' size=4>&nbsp;&nbsp;&nbsp;(for helix and sheet ribbons, default 1.3)<br/>",i+="<b>Nucleotide Ribbon Width</b>: <input type='text' id='"+t.pre+"nucleotideribbonwidth_"+e+"' value='"+d+"' size=4>&nbsp;&nbsp;&nbsp;(for nucleotide ribbons, default 0.8)<br/>",i+="<b>Ball Scale</b>: <input type='text' id='"+t.pre+"ballscale_"+e+"' value='"+l+"' size=4>&nbsp;&nbsp;&nbsp;(for styles 'Ball and Stick' and 'Dot', default 0.3)<br/>",i+="<span style='white-space:nowrap'><button id='"+t.pre+"apply_thickness_"+e+"'>Preview</button></span>"},iCn3DUI.prototype.setSequenceGuide=function(e,t){var i=this,n="",o=i.icn3d?Object.keys(i.icn3d.defNames2Atoms).length:1;if(t?n+="<div id='"+i.pre+"seqguide"+e+"'>":(n+='<div style="width:20px; margin-left:3px; display:inline-block;"><span id="'+i.pre+"seqguide"+e+'_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+i.pre+"seqguide"+e+'_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div> ',n+="<div style='min-width:200px; display:inline-block;'><b>Selection:</b> Name: <input type='text' id='"+i.pre+"seq_command_name"+e+"' value='seq_"+o+"' size='5'> &nbsp;&nbsp;<button style='white-space:nowrap;' id='"+i.pre+"seq_saveselection"+e+"'>Save</button> <button style='white-space:nowrap; margin-left:20px;' id='"+i.pre+"seq_clearselection"+e+"'>Clear</button></div><br/>",n+="<div id='"+i.pre+"seqguide"+e+"' style='display:none; white-space:normal;' class='icn3d-box'>"),i.isMobile())n+='<b>Select Sequences:</b> touch to select, touch again to deselect, multiple selection is allowed without Ctrl key, click "Save Selection" to save the current selection.<br/><br/>';else{n+='<b>Select on 1D sequences:</b> drag to select, drag again to deselect, multiple selection is allowed without Ctrl key, click "Save Selection" to save the current selection.<br/><br/>',n+='<b>Select on 2D interaction diagram:</b> click on the nodes or lines. The nodes are chains and can be united with the Ctrl key. The lines are interactions and can NOT be united. Each click on the lines selects half of the lines, i.e., select the interacting residues in one of the two chains. The selected residues are saved in the "Select -> Advanced" menu.<br/><br/>';var r=i.isMobile()?"use finger to pick":'hold "Alt" and use mouse to pick';n+="<b>Select on 3D structures:</b> "+r+', click the second time to deselect, hold "Ctrl" to union selection, hold "Shift" to select a range, press the up/down arrow to switch among atom/residue/strand/chain/structure, click "Save Selection" to save the current selection.<br/><br/>',n+='<b>Save the current selection</b> (either on 3D structure, 2D interactions, or 1D sequence): open the menu "Select -> Save Selection", specify the name and description for the selection, and click "Save".<br/><br/>'}var s="<b>Residue labeling:</b> standard residue with coordinates: UPPER case letter; nonstandard residue with coordinates: the first UPPER case letter plus a period except that water residue uses the letter 'O'; residue missing coordinates: lower case letter.",a=i.isMac()&&!i.isMobile()?"<br/><br/><b>Turn on scroll bar:</b> System preferences -> General -> show scroll bars -> check Always":"";return n+=s+a+"<br/></div>"},iCn3DUI.prototype.getAlignSequencesAnnotations=function(e,t,i,n){var o,r=this,s="<b>Residue labeling:</b> aligned residue with coordinates: UPPER case letter; non-aligned residue with coordinates: lower case letter which can be highlighted; residue missing coordinates: lower case letter which can NOT be highlighted.",a=r.isMac()&&!r.isMobile()?"<br/><b>Turn on scroll bar:</b> System preferences -> General -> show scroll bars -> check Always":"";if(r.isMobile())o='<b>Select Aligned Sequences:</b> touch to select, touch again to deselect, multiple selection is allowed without Ctrl key, click "Save Selection" to save the current selection.<br/>';else{o='<b>Select on 1D sequences:</b> drag to select, drag again to deselect, multiple selection is allowed without Ctrl key, click "Save Selection" to save the current selection.<br/>',o+='<b>Select on 2D interaction diagram:</b> click on the nodes or lines. The nodes are chains and can be united with the Ctrl key. The lines are interactions and can NOT be united. Each click on the lines selects half of the lines, i.e., select the interacting residues in one of the two chains. The selected residues are saved in the "Select -> Advanced" menu.<br/><br/>';var c=r.isMobile()?"use finger to pick":'hold "Alt" and use mouse to pick';o+="<b>Select on 3D structures:</b> "+c+', click the second time to deselect, hold "Ctrl" to union selection, hold "Shift" to select a range, press the up/down arrow to switch among atom/residue/strand/chain/structure, click "Save Selection" to save the current selection.<br/>',o+='<b>Save the current selection</b> (either on 3D structure, 2D interactions, or 1D sequence): open the menu "Select -> Save Selection", specify the name and description for the selection, and click "Save".<br/><br/>'}o+="<div style='min-width:200px;'><b>Selection:</b> Name: <input type='text' id='"+r.pre+"alignseq_command_name' value='alseq_"+Object.keys(r.icn3d.defNames2Atoms).length+"' size='10'> &nbsp;&nbsp;<button style='white-space:nowrap;' id='"+r.pre+"alignseq_saveselection'>Save</button> <button style='white-space:nowrap; margin-left:20px;' id='"+r.pre+"alignseq_clearselection'>Clear</button></div><br/>",o+=s+a+"<br/>";var d=0,l={};if(void 0!==e)for(var p=0,h=e.length;p<h;++p)l[e[p]]=1;var u=Object.keys(r.icn3d.hAtoms).length==Object.keys(r.icn3d.atoms).length&&m&&(void 0===t||t);u&&(r.icn3d.hAtoms={});for(var p in r.icn3d.alnChains){var m=!(void 0===e||!l.hasOwnProperty(p));u&&(r.icn3d.hAtoms=r.icn3d.unionHash(r.icn3d.hAtoms,r.icn3d.alnChains[p]));var f=[],v="",g=void 0!==r.icn3d.alnChainsSeq[p]?r.icn3d.alnChainsSeq[p].length:0;g>d&&(d=g);var b=p.indexOf("_"),y=p.substr(0,b),_=p.substr(b+1);v+="<span class='icn3d-residueNum' title='starting residue number'>"+r.icn3d.alnChainsSeq[p][0].resi+"</span>";for(var m=!(void 0===e||!l.hasOwnProperty(p)),w=0,C=g;w<C;++w){var S="N/A",A="",k="#000";""===r.icn3d.alnChainsSeq[p][w].resi||isNaN(r.icn3d.alnChainsSeq[p][w].resi)||(S=r.icn3d.alnChainsSeq[p][w].resi,A=y+"_"+_+"_"+S,k=r.icn3d.alnChainsSeq[p][w].color);var E="class='icn3d-residue";(void 0===n||n)&&(m||void 0!==i&&""!==A&&i.indexOf(A)!==-1)&&(E="class='icn3d-residue icn3d-highlightSeq"),E+=""===A?"'":" "+r.icn3d.alnChainsSeq[p][w]["class"]+"'";var x;if(r.icn3d.residues.hasOwnProperty(A)){var R=r.icn3d.getFirstCalphaAtomObj(r.icn3d.residues[A]);x=void 0!==R.color?"#"+R.color.getHexString()+";":"#000000;"}else x="#000000;";"#FFFFFF;"===x.toUpperCase()&&(x=r.GREYD);var T=""!==A;v+=T?r.icn3d.alnChainsSeq[p][w].resi!=-1?"<span id='align_"+r.pre+A+"' "+E+" style='color:"+x+"' title='"+r.icn3d.alnChainsSeq[p][w].resn+r.icn3d.alnChainsSeq[p][w].resi+"'>"+r.icn3d.alnChainsSeq[p][w].resn+"</span>":"<span>"+r.icn3d.alnChainsSeq[p][w].resn+"</span>":"<span title='"+r.icn3d.alnChainsSeq[p][w].resn+r.icn3d.alnChainsSeq[p][w].resi+"'>"+r.icn3d.alnChainsSeq[p][w].resn+"</span>"}v+="<span class='icn3d-residueNum' title='ending residue number'>"+r.icn3d.alnChainsSeq[p][g-1].resi+"</span>";for(var H=void 0!==r.icn3d.alnChainsAnno[p]?r.icn3d.alnChainsAnno[p].length:0,D=0,I=H;D<I;++D){f[D]="";var O=0==D?r.icn3d.alnChainsAnTtl[p][4][0]:p;f[D]+="<span class='icn3d-residueNum'></span>";for(var w=0,C=r.icn3d.alnChainsAnno[p][D].length;w<C;++w){var M=r.icn3d.alnChainsAnno[p][D][w];if("H"==M||"E"==M||"c"==M||"o"==M)if("H"==M)w%2==0?f[D]+='<span class="icn3d-helix">&nbsp;</span>':f[D]+='<span class="icn3d-helix2">&nbsp;</span>';else if("E"==M){if(void 0!==r.icn3d.alnChainsSeq[O][w]){var S=r.icn3d.alnChainsSeq[O][w].resi,A=O+"_"+S;if(r.icn3d.residues.hasOwnProperty(A)){var L=r.icn3d.getFirstCalphaAtomObj(r.icn3d.residues[A]);L.ssend?f[D]+='<span class="icn3d-sheet2">&nbsp;</span>':f[D]+='<span class="icn3d-sheet">&nbsp;</span>'}}}else"c"==M?f[D]+='<span class="icn3d-coil">&nbsp;</span>':"o"==M?f[D]+='<span class="icn3d-other">&nbsp;</span>':f[D]+="<span></span>";else f[D]+="<span>"+M+"</span>"}f[D]+="<span class='icn3d-residueNum'></span>"}for(var $=p,P=void 0!==r.icn3d.pdbid_chain2title?r.icn3d.pdbid_chain2title[p]:"",D=H-1;D>=0;--D){var N=r.icn3d.alnChainsAnTtl[p][D][0];"SS"==N&&(N=""),o+="<div class='icn3d-residueLine' style='white-space:nowrap;'><div class='icn3d-seqTitle' anno='"+D+"'>"+N+"</div>"+f[D]+"<br/></div>"}o+='<div class="icn3d-seqTitle icn3d-link icn3d-blue" chain="'+p+'" anno="sequence" title="'+P+'">'+$+' </div><span class="icn3d-seqLine">'+v+"</span><br/>"}return{sequencesHtml:o,maxSeqCnt:d}},iCn3DUI.prototype.openDialogHalfWindow=function(e,t,i,n){var o=this,r=170;o.resizeCanvas(o.WIDTH-i-o.LESSWIDTH,o.HEIGHT-o.LESSHEIGHT-o.EXTRAHEIGHT,n),height=o.HEIGHT-o.LESSHEIGHT-o.EXTRAHEIGHT,width=i;var s;s=o.cfg.showmenu?{my:"left top",at:"right top+40",of:"#"+o.pre+"viewer",collision:"none"}:{my:"left top",at:"right top",of:"#"+o.pre+"viewer",collision:"none"},o.cfg.resize=!1,window.dialog=$("#"+e).dialog({autoOpen:!0,title:t,height:height,width:width,modal:!1,position:s,close:function(t){var i=$("#"+o.pre+"dl_selectannotations").hasClass("ui-dialog-content"),n=$("#"+o.pre+"dl_alignment").hasClass("ui-dialog-content"),s=$("#"+o.pre+"dl_2ddgm").hasClass("ui-dialog-content"),a=$("#"+o.pre+"dl_definedsets").hasClass("ui-dialog-content"),c=!1,d=!1,l=!1,p=!1;i&&(c=$("#"+o.pre+"dl_selectannotations").dialog("isOpen")),n&&(d=$("#"+o.pre+"dl_alignment").dialog("isOpen")),s&&(l=$("#"+o.pre+"dl_2ddgm").dialog("isOpen")),a&&(p=$("#"+o.pre+"dl_definedsets").dialog("isOpen")),(e===o.pre+"dl_selectannotations"&&!d||e===o.pre+"dl_alignment"&&!c)&&(l||p?(o.resizeCanvas(o.WIDTH-o.LESSWIDTH-r,o.HEIGHT-o.LESSHEIGHT-o.EXTRAHEIGHT,!0),l&&o.openDialog2Ddgm(o.pre+"dl_2ddgm",void 0,p),p&&o.openDialog2Ddgm(o.pre+"dl_definedsets")):o.resizeCanvas(o.WIDTH-o.LESSWIDTH,o.HEIGHT-o.LESSHEIGHT-o.EXTRAHEIGHT,!0))},resize:function(t){e==o.pre+"dl_selectannotations"&&o.hideFixedTitle()}})},iCn3DUI.prototype.openDialog2Ddgm=function(e,t,i){var n,o,r=this,s=170;e===r.pre+"dl_definedsets"?(n="right top",o="Select sets"):e===r.pre+"dl_2ddgm"&&(n=void 0!==i&&i?"right top+240":"right top",o="Interactions");var a={my:"left top+"+r.MENU_HEIGHT,at:n,of:"#"+r.pre+"viewer",collision:"none"},c="auto";window.dialog=$("#"+e).dialog({autoOpen:!0,title:o,height:c,width:s,modal:!1,position:a,close:function(e){var t=$("#"+r.pre+"dl_selectannotations").hasClass("ui-dialog-content"),i=$("#"+r.pre+"dl_alignment").hasClass("ui-dialog-content"),n=$("#"+r.pre+"dl_2ddgm").hasClass("ui-dialog-content"),o=$("#"+r.pre+"dl_definedsets").hasClass("ui-dialog-content"),s=!1,a=!1,c=!1,d=!1;t&&(s=$("#"+r.pre+"dl_selectannotations").dialog("isOpen")),i&&(a=$("#"+r.pre+"dl_alignment").dialog("isOpen")),n&&(c=$("#"+r.pre+"dl_2ddgm").dialog("isOpen")),o&&(d=$("#"+r.pre+"dl_definedsets").dialog("isOpen")),s||a||r.resizeCanvas(r.WIDTH-r.LESSWIDTH,r.HEIGHT-r.LESSHEIGHT-r.EXTRAHEIGHT,!0)}})},iCn3DUI.prototype.openDialog=function(e,t){var i=this,n=400,o=150,r=170,s=$("#"+i.pre+"dl_selectannotations").hasClass("ui-dialog-content"),a=$("#"+i.pre+"dl_alignment").hasClass("ui-dialog-content"),c=$("#"+i.pre+"dl_2ddgm").hasClass("ui-dialog-content"),d=$("#"+i.pre+"dl_definedsets").hasClass("ui-dialog-content"),l=!1,p=!1,h=!1,u=!1;if(s&&(l=$("#"+i.pre+"dl_selectannotations").dialog("isOpen")),a&&(p=$("#"+i.pre+"dl_alignment").dialog("isOpen")),c&&(h=$("#"+i.pre+"dl_2ddgm").dialog("isOpen")),d&&(u=$("#"+i.pre+"dl_definedsets").dialog("isOpen")),e===i.pre+"dl_selectannotations"||e===i.pre+"dl_alignment"){var m=.5*(i.WIDTH-i.LESSWIDTH)-.5*r;if(i.WIDTH-i.LESSWIDTH>=i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT)i.openDialogHalfWindow(e,t,m,!0),(h||u)&&(i.resizeCanvas(i.WIDTH-i.LESSWIDTH-m-r,i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT,!0),h&&i.openDialog2Ddgm(i.pre+"dl_2ddgm",void 0,u),u&&i.openDialog2Ddgm(i.pre+"dl_definedsets"));else{i.resizeCanvas(i.WIDTH-i.LESSWIDTH,.5*(i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT),!0),o=.5*(i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT),n=i.WIDTH-i.LESSWIDTH;var f={my:"left top",at:"left bottom+32",of:"#"+i.pre+"canvas",collision:"none"};window.dialog=$("#"+e).dialog({autoOpen:!0,title:t,height:o,width:n,modal:!1,position:f,close:function(t){(e===i.pre+"dl_selectannotations"&&!p||e===i.pre+"dl_alignment"&&!l)&&(h||u?(i.resizeCanvas(i.WIDTH-i.LESSWIDTH-r,i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT,!0),h&&i.openDialog2Ddgm(i.pre+"dl_2ddgm",void 0,u),u&&i.openDialog2Ddgm(i.pre+"dl_definedsets")):i.resizeCanvas(i.WIDTH-i.LESSWIDTH,i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT,!0))},resize:function(t){e==i.pre+"dl_selectannotations"&&i.hideFixedTitle()}})}}else if(e===i.pre+"dl_2ddgm"){var v=0;i.WIDTH-i.LESSWIDTH>=i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT?((l||p)&&(v=.5*(i.WIDTH-i.LESSWIDTH)-.5*r),i.resizeCanvas(i.WIDTH-i.LESSWIDTH-v-r,i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT,!0),i.openDialog2Ddgm(e,void 0,u)):(i.resizeCanvas(i.WIDTH-i.LESSWIDTH-v-r,.5*(i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT),!0),i.openDialog2Ddgm(e,.5*(i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT)),i.openDialog2Ddgm(e,.5*(i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT),u))}else{o="auto",n="auto",e===i.pre+"dl_addtrack"&&(n="50%");var f;if(e===i.pre+"dl_definedsets"){var v=0;i.WIDTH-i.LESSWIDTH>=i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT?((l||p)&&(v=.5*(i.WIDTH-i.LESSWIDTH)-.5*r),i.resizeCanvas(i.WIDTH-i.LESSWIDTH-v-r,i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT,!0),i.openDialog2Ddgm(e),h&&i.openDialog2Ddgm(i.pre+"dl_2ddgm",void 0,!0)):(i.resizeCanvas(i.WIDTH-i.LESSWIDTH-v-r,.5*(i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT),!0),i.openDialog2Ddgm(e,.5*(i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT)),h&&i.openDialog2Ddgm(i.pre+"dl_2ddgm",.5*(i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT),!0))}else f=i.isMobile()?{my:"left top",at:"left bottom-50",of:"#"+i.pre+"canvas",collision:"none"}:{my:"left top",at:"left top+50",of:"#"+i.pre+"canvas",collision:"none"},window.dialog=$("#"+e).dialog({autoOpen:!0,title:t,height:o,width:n,modal:!1,position:f})}$(".ui-dialog .ui-button span").removeClass("ui-icon-closethick").addClass("ui-icon-close")},iCn3DUI.prototype.draw2Ddgm=function(e,t,i,n){var o=this,r=.5,s={},a={},c={},d={},l={};if(void 0===e)return"";for(var p in e.moleculeInfor){var h="#"+("000000"+e.moleculeInfor[p].color.toString(16)).slice(-6),u=e.moleculeInfor[p].chain.trim();void 0===l[u]?l[u]=1:++l[u];var m=1===l[u]?u:u+l[u].toString(),f=t+"_"+m;s[p]=f,a[p]=h,c[p]=e.moleculeInfor[p].name,d[f]=p}if(void 0===n||!n)for(var v=0,g=e.intracResidues.length;v<g;++v){var b,y,_=e.intracResidues[v],w=0;for(var p in _){var f;f=s[p],0===w?b=f:y=f,++w}if(void 0!==b&&void 0!==y){w=0;for(var p in _){var C,S,A=_[p];0===w?(C=b,S=y):(C=y,S=b),void 0===o.chainids2resids[C]&&(o.chainids2resids[C]={}),void 0===o.chainids2resids[C][S]&&(o.chainids2resids[C][S]=[]);for(var k=0,E=A.length;k<E;++k){var x=A[k],R=o.mmdbMolidResid2mmdbChainResi[t.toUpperCase()+"_"+p+"_"+x];o.chainids2resids[C][S].push(R)}void 0===o.chainname2residues&&(o.chainname2residues={});var T,y=S,H=o.icn3d.getFirstCalphaAtomObj(o.icn3d.chains[y]);o.icn3d.chemicals.hasOwnProperty(H.serial)?T="chemical":o.icn3d.nucleotides.hasOwnProperty(H.serial)?T="nucleotide":o.icn3d.ions.hasOwnProperty(H.serial)?T="ion":o.icn3d.proteins.hasOwnProperty(H.serial)?T="protein":o.icn3d.water.hasOwnProperty(H.serial)&&(T="water");var D=y.substr(y.indexOf("_")+1)+" ("+T+")";void 0===o.chainname2residues[C]&&(o.chainname2residues[C]={}),o.chainname2residues[C][D]=o.chainids2resids[C][S],++w}}}var I="<div id='#"+o.pre+t+"'>";I+="<b>"+t.toUpperCase()+"</b><br/>",I+="<svg viewBox='0,0,150,150'>";var O="#000000",M="2",L={},P=[],N="",z="",q={};if(void 0!==n&&n)for(var v in o.icn3d.dAtoms){var F=o.icn3d.atoms[v],f=F.structure+"_"+F.chain,p=d[f];q[p]=1}for(var j=Object.keys(e.moleculeInfor),U=Object.keys(e.intrac),B=[],v=0,g=j.length;v<g;++v)U.indexOf(j[v])===-1&&B.push(j[v]);var G={};if(B.length>0)for(var p in e.intrac){for(var V=e.intrac[p],v=0,g=V.intrac.length;v<g;++v){var W=V.intrac[v].toString();B.indexOf(W)!==-1&&(void 0===G[W]&&(G[W]=[]),G[W].push(p),P.push([W,p]))}if("rect"===V.shape){var Y=V.coords[0]*r,X=V.coords[1]*r,Z=V.coords[2]*r-Y,K=V.coords[3]*r-X;L[p]=[Y+Z/2,X+K/2]}else if("circle"===V.shape){var Y=V.coords[0]*r,X=V.coords[1]*r;V.coords[2]*r;L[p]=[Y,X]}else if("poly"===V.shape){var Q=V.coords[0]*r,J=(V.coords[1]*r,V.coords[2]*r),ee=V.coords[3]*r,te=V.coords[4]*r,ie=V.coords[5]*r,Y=(V.coords[6]*r,V.coords[7]*r,Q),X=ee;L[p]=[Q,ee]}}for(var ne=0,w=0,oe=j.length;w<oe;++w){var p=j[w];if(void 0===n||!n||q.hasOwnProperty(p)){var V=e.intrac[p],h="#FFFFFF",re=a[p],se="";void 0!==i&&0===i?void 0!==o.alignmolid2color&&o.alignmolid2color[0].hasOwnProperty(p)?(se=o.alignmolid2color[0][p],re="#FF0000"):re="#FFFFFF":void 0!==i&&1===i&&(void 0!==o.alignmolid2color&&o.alignmolid2color[1].hasOwnProperty(p)?(se=o.alignmolid2color[1][p],re="#FF0000"):re="#FFFFFF");var f;f=s[p];var ae=c[p],ce=" ",de=" ";if(void 0!==f){var le=f.indexOf("_");de=f.substr(le+1),ce=de.length>1?de.substr(0,1)+"..":de}else f="Misc";void 0===re&&(re="#FFFFFF");var pe=1;if(void 0!==o.icn3d.alnChains[f]){var he=0;for(var v in o.icn3d.alnChains[f]){var ue=o.icn3d.atoms[v].color.getHexString().toUpperCase();"FF0000"!==ue&&"00FF00"!==ue||++he}pe=1*he/Object.keys(o.icn3d.chains[f]).length}if(pe<.2&&(pe=.2),B.indexOf(p)===-1){for(var v=0,g=V.intrac.length;v<g;++v)parseInt(p)<parseInt(V.intrac[v])&&P.push([p,V.intrac[v]]);if("rect"===V.shape){var Y=V.coords[0]*r,X=V.coords[1]*r,Z=V.coords[2]*r-Y,K=V.coords[3]*r-X;N+=o.draw2DNucleotide(Y+.5*Z,X+.5*K,f,de,ce,ae,se,h,re,r,pe),L[p]=[Y+Z/2,X+K/2]}else if("circle"===V.shape){var Y=V.coords[0]*r,X=V.coords[1]*r;N+=o.draw2DProtein(Y,X,f,de,ce,ae,se,h,re,r,pe),L[p]=[Y,X]}else if("poly"===V.shape){var Q=V.coords[0]*r,J=(V.coords[1]*r,V.coords[2]*r),ee=V.coords[3]*r,te=V.coords[4]*r,ie=V.coords[5]*r,Y=(V.coords[6]*r,V.coords[7]*r,Q),X=ee,F=o.icn3d.getFirstAtomObj(o.icn3d.chains[f]);z+=o.draw2DChemical(Y,X,f,de,ce,ae,se,h,re,r,pe),L[p]=[Q,ee]}}else{var me,fe,ve=300,ge=50;if(void 0!==G[p]&&G[p].length>1){for(var be=0,ye=0,k=0,E=G[p].length;k<E;++k){var W=G[p][k];if(L.hasOwnProperty(W)){var _e=L[W];be+=_e[0],ye+=_e[1]}}me=be/G[p].length,fe=ye/G[p].length}else{var we=ve/ge;ne<we-1?(me=(ne+1)*ge*r,fe=.1*ve*r):ne-(we-1)<we-1?(me=.1*ve*r,fe=(ne-(we-1)+1)*ge*r):(me=.25*ve*r,fe=me),++ne}var Y=me,X=fe,F=o.icn3d.getFirstAtomObj(o.icn3d.chains[f]),Ce=!0;z+=o.draw2DChemical(Y,X,f,de,ce,ae,se,h,re,r,pe,Ce),L[p]=[Y,X]}}}for(var v=0,g=P.length;v<g;++v){var _=P[v];if(void 0===n||!n||q.hasOwnProperty(_[0])&&q.hasOwnProperty(_[1])){var Se=L[parseInt(_[0])],Ae=L[parseInt(_[1])];if(void 0!==Se&&void 0!==Ae){var b,y;b=s[_[0]],y=s[_[1]];var ke=b.indexOf("_"),Ee=y.indexOf("_"),xe=b.substr(ke+1),Re=y.substr(Ee+1),J=Se[0],ee=Se[1],te=Ae[0],ie=Ae[1],Te=.5*(J+te),He=.5*(ee+ie);I+="<g class='icn3d-interaction' chainid1='"+b+"' chainid2='"+y+"' >",I+="<title>Interaction of chain "+xe+" with chain "+Re+"</title>",I+="<line x1='"+J+"' y1='"+ee+"' x2='"+Te+"' y2='"+He+"' stroke='"+O+"' stroke-width='"+M+"' /></g>",I+="<g class='icn3d-interaction' chainid1='"+y+"' chainid2='"+b+"' >",I+="<title>Interaction of chain "+Re+" with chain "+xe+"</title>",I+="<line x1='"+Te+"' y1='"+He+"' x2='"+te+"' y2='"+ie+"' stroke='"+O+"' stroke-width='"+M+"' /></g>"}}}return I+=z+N,I+="</svg>",I+="</div>",o.html2ddgm+=I,$("#"+o.pre+"dl_2ddgm").html(o.html2ddgm),I},iCn3DUI.prototype.set2DdgmNote=function(e){var t=this,i="<div style='width:150px'><b>Nodes</b>:<br>";return t.isMac()?(i+="<span style='margin-right:18px;'>&#9711;</span>Protein<br>",i+="<span style='margin-right:18px;'>&#9634;</span>Nucleotide<br>",i+="<span style='margin-right:18px;'>&#9826;</span>Chemical<br>",i+="<span style='margin-right:18px;display: inline-block;transform: skew(-25deg);'>&#9634;</span>Biopolymer<br>"):(i+="<span style='margin-right:18px;'>O</span>Protein<br>",i+="<span style='margin-right:18px;'>&#9634;</span>Nucleotide<br>",i+="<span style='margin-right:18px;'>&#9671;</span>Chemical<br>",i+="<span style='margin-right:18px;display: inline-block;transform: skew(-25deg);'>&#9634;</span>Biopolymer<br>"),i+="<br><b>Lines</b>:<br> Interactions at 4 &#197;<br>",void 0!==e&&e&&(i+="<b>Numbers in red</b>:<br> Aligned chains"),i+="</div><br/>"},iCn3DUI.prototype.highlightNode=function(e,t,i,n){var o=this;n<.2&&(n=.2);var r=3;if("rect"===e){$(t).attr("stroke",o.ORANGE),$(t).attr("stroke-width",r);var s=Number($(i).attr("x")),a=Number($(i).attr("y")),c=Number($(i).attr("width")),d=Number($(i).attr("height"));$(t).attr("x",s+c/2*(1-n)),$(t).attr("y",a+d/2*(1-n)),$(t).attr("width",c*n),$(t).attr("height",d*n)}else if("circle"===e)$(t).attr("stroke",o.ORANGE),$(t).attr("stroke-width",r),$(t).attr("r",Number($(i).attr("r"))*n);else if("polygon"===e){$(t).attr("stroke",o.ORANGE),$(t).attr("stroke-width",r);var s=Number($(i).attr("x")),a=Number($(i).attr("y")),l=Number($(i).attr("x0d")),p=Number($(i).attr("y0d")),h=Number($(i).attr("x1d")),u=Number($(i).attr("y1d")),m=Number($(i).attr("x2d")),f=Number($(i).attr("y2d")),v=Number($(i).attr("x3d")),g=Number($(i).attr("y3d"));$(t).attr("points",(s+l*n).toString()+", "+(a+p*n).toString()+", "+(s+h*n).toString()+", "+(a+u*n).toString()+", "+(s+m*n).toString()+", "+(a+f*n).toString()+", "+(s+v*n).toString()+", "+(a+g*n).toString())}},iCn3DUI.prototype.click2Ddgm=function(){var e=this;$("#"+e.pre+"dl_2ddgm").on("click",".icn3d-node",function(t){t.stopImmediatePropagation(),Object.keys(e.icn3d.hAtoms).length<Object.keys(e.icn3d.atoms).length&&e.setMode("selection"),e.bClickInteraction=!1;var i=$(this).attr("chainid");e.icn3d.bCtrl||e.icn3d.bShift||(e.removeSelection(),e.lineArray2d=[]);var n=1;void 0!==e.icn3d.alnChains[i]&&(n=1*Object.keys(e.icn3d.alnChains[i]).length/Object.keys(e.icn3d.chains[i]).length);var o=$(this).find("rect[class='icn3d-hlnode']"),r=$(this).find("rect[class='icn3d-basenode']");e.highlightNode("rect",o,r,n),o=$(this).find("circle[class='icn3d-hlnode']"),r=$(this).find("circle[class='icn3d-basenode']"),e.highlightNode("circle",o,r,n),o=$(this).find("polygon[class='icn3d-hlnode']"),r=$(this).find("polygon[class='icn3d-basenode']"),e.highlightNode("polygon",o,r,n),e.icn3d.bCtrl||e.icn3d.bShift?e.icn3d.hAtoms=e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.chains[i]):e.icn3d.hAtoms=e.icn3d.cloneHash(e.icn3d.chains[i]),e.icn3d.bCtrl||e.icn3d.bShift?(void 0===e.chainArray2d&&(e.chainArray2d=[]),e.chainArray2d.push(i)):e.chainArray2d=[i],e.updateHlAll(e.chainArray2d),e.showAnnoSelectedChains();var s="select chain "+i;e.setLogCmd(s,!0),e.bSelectResidue=!1}),$("#"+e.pre+"dl_2ddgm").on("click",".icn3d-interaction",function(t){t.stopImmediatePropagation(),Object.keys(e.icn3d.hAtoms).length<Object.keys(e.icn3d.atoms).length&&e.setMode("selection"),e.bClickInteraction=!0;
var i=$(this).attr("chainid1"),n=$(this).attr("chainid2");$(this).find("line").attr("stroke",e.ORANGE),e.selectInteraction(i,n),e.showAnnoSelectedChains();var o="select interaction "+i+","+n;e.setLogCmd(o,!0),e.bClickInteraction=!1})},iCn3DUI.prototype.selectInteraction=function(e,t){var i=this;i.removeHl2D(),i.icn3d.removeHlObjects(),i.icn3d.bCtrl||i.icn3d.bShift?(void 0===i.lineArray2d&&(i.lineArray2d=[]),i.lineArray2d.push(e),i.lineArray2d.push(t)):i.lineArray2d=[e,t],i.selectInteractionAtoms(e,t),i.icn3d.addHlObjects(),i.updateHlAll()},iCn3DUI.prototype.selectInteractionAtoms=function(e,t){var i=this,n=4,o=i.chainids2resids[e][t];i.icn3d.bCtrl||i.icn3d.bShift||(i.icn3d.hAtoms={});for(var r=0,s=o.length;r<s;++r)i.icn3d.hAtoms=i.icn3d.unionHash(i.icn3d.hAtoms,i.icn3d.residues[o[r]]);var a,c;if(Object.keys(i.icn3d.structures).length>1)a="inter_"+e+"_"+t;else{var d=e.indexOf("_"),l=t.indexOf("_");a="inter_"+e.substr(d+1)+"_"+t.substr(l+1)}c="select the atoms in chain "+e+" interacting with chain "+t+" in a distance of "+n+" angstrom";var p="select interaction "+e+","+t;i.addCustomSelection(o,a,c,p,!0)},iCn3DUI.prototype.draw2DProtein=function(e,t,i,n,o,r,s,a,c,d,l){var p="#000000",h="1",u="#000000",m="10",f="8",v=0,g=4,b=6,y=20*d;return html="<g class='icn3d-node' chainid='"+i+"' >",html+="<title>Chain "+n+": "+r+"</title>",html+="<circle class='icn3d-basenode' cx='"+e+"' cy='"+t+"' r='"+y+"' fill='"+a+"' stroke-width='"+h+"' stroke='"+p+"' class='icn3d-node' chainid='"+i+"' />",html+="<circle class='icn3d-hlnode' cx='"+e+"' cy='"+t+"' r='"+(y*l).toString()+"' fill='"+c+"' stroke-width='"+h+"' stroke='"+p+"' />",html+="<text x='"+(e-v).toString()+"' y='"+(t+g).toString()+"' style='fill:"+u+"; font-size:"+m+"; text-anchor:middle' >"+o+"</text>",""!==s&&(html+="<text x='"+(e-v).toString()+"' y='"+(t+y+g+b).toString()+"' style='fill:"+c+"; font-size:"+f+"; font-weight:bold; text-anchor:middle' >"+s+"</text>"),html+="</g>",html},iCn3DUI.prototype.draw2DNucleotide=function(e,t,i,n,o,r,s,a,c,d,l){var p="#000000",h="1",u="#000000",m="10",f="8",v=0,g=4,b=6,y=30*d,_=30*d;return e-=.5*y,t-=.5*_,html="<g class='icn3d-node' chainid='"+i+"' >",html+="<title>Chain "+n+": "+r+"</title>",html+="<rect class='icn3d-basenode' x='"+e+"' y='"+t+"' width='"+y+"' height='"+_+"' fill='"+a+"' stroke-width='"+h+"' stroke='"+p+"' />",html+="<rect class='icn3d-hlnode' x='"+(e+y/2*(1-l)).toString()+"' y='"+(t+_/2*(1-l)).toString()+"' width='"+(y*l).toString()+"' height='"+(_*l).toString()+"' fill='"+c+"' stroke-width='"+h+"' stroke='"+p+"' />",html+="<text x='"+(e+y/2-v).toString()+"' y='"+(t+_/2+g).toString()+"' style='fill:"+u+"; font-size:"+m+"; text-anchor:middle' >"+o+"</text>",""!==s&&(html+="<text x='"+(e+y/2-v).toString()+"' y='"+(t+_+g+b).toString()+"' style='fill:"+c+"; font-size:"+f+"; font-weight:bold; text-anchor:middle' >"+s+"</text>"),html+="</g>",html},iCn3DUI.prototype.draw2DChemical=function(e,t,i,n,o,r,s,a,c,d,l,p){var h="#000000",u="1",m="#000000",f="8",v=1,g=2,b=6,y=30*d;if(void 0!==p&&p)var _=.5*y/Math.sqrt(3),w=.5*y,C=e-_,S=t-w,A=e+3*_,k=t-w,E=e+_,x=t+w,R=e-3*_,T=t+w;else var _=.5*y,w=.5*y,C=e-_,S=t,A=e,k=t+w,E=e+_,x=t,R=e,T=t-w;var H=C-e,D=S-t,I=A-e,O=k-t,M=E-e,L=x-t,$=R-e,P=T-t,N="<g class='icn3d-node' chainid='"+i+"' >";return N+="<title>Chain "+n+": "+r+"</title>",N+="<polygon class='icn3d-basenode' points='"+C+", "+S+","+A+", "+k+","+E+", "+x+","+R+", "+T+"' x='"+e+"' y='"+t+"' x0d='"+H+"' y0d='"+D+"' x1d='"+I+"' y1d='"+O+"' x2d='"+M+"' y2d='"+L+"' x3d='"+$+"' y3d='"+P+"' fill='"+a+"' stroke-width='"+u+"' stroke='"+h+"' />",N+="<polygon class='icn3d-hlnode' points='"+(e+H*l).toString()+", "+(t+D*l).toString()+","+(e+I*l).toString()+", "+(t+O*l).toString()+","+(e+M*l).toString()+", "+(t+L*l).toString()+","+(e+$*l).toString()+", "+(t+P*l).toString()+"' fill='"+c+"' stroke-width='"+u+"' stroke='"+h+"' />",N+="<text x='"+(e+v).toString()+"' y='"+(t+g).toString()+"' style='fill:"+m+"; font-size:"+f+"; text-anchor:middle' >"+o+"</text>",""!==s&&(N+="<text x='"+(e+v).toString()+"' y='"+(t+g+b).toString()+"' style='fill:"+c+"; font-size:"+f+"; font-weight:bold; text-anchor:middle' >"+s+"</text>"),N+="</g>"},function(e,t,i){function n(e){return"undefined"!=typeof e}function o(e){return"string"==typeof e}function r(e){return"object"==typeof e}function s(e){return Object.keys(e).length}function a(e,t,i){return e<t?t:e>i?i:e}function c(e,t){return parseInt(e,t||10)}function d(e){return Math.round(e)}function l(e){var t,i,n,o,r,s,a,c,l=+e[0],p=+e[1],h=+e[2];switch(o=Math.floor(6*l),r=6*l-o,s=h*(1-p),a=h*(1-r*p),c=h*(1-(1-r)*p),o=o||0,a=a||0,c=c||0,o%6){case 0:t=h,i=c,n=s;break;case 1:t=a,i=h,n=s;break;case 2:t=s,i=h,n=c;break;case 3:t=s,i=a,n=h;break;case 4:t=c,i=s,n=h;break;case 5:t=h,i=s,n=a}return[d(255*t),d(255*i),d(255*n)]}function p(e){return u(l(e))}function h(e){var t,i=+e[0],n=+e[1],o=+e[2],r=Math.max(i,n,o),s=Math.min(i,n,o),a=r-s,c=0===r?0:a/r,d=r/255;switch(r){case s:t=0;break;case i:t=n-o+a*(n<o?6:0),t/=6*a;break;case n:t=o-i+2*a,t/=6*a;break;case o:t=i-n+4*a,t/=6*a}return[t,c,d]}function u(e){var t=+e[2]|+e[1]<<8|+e[0]<<16;return t="000000"+t.toString(16),t.slice(-6)}function m(e){return h(f(e))}function f(e){return 3===e.length&&(e=e.replace(/./g,"$&$&")),[c(e[0]+e[1],16),c(e[2]+e[3],16),c(e[4]+e[5],16)]}function v(e){return[+e[0]/360,+e[1]/100,+e[2]/100]}function g(e){return[d(360*+e[0]),d(100*+e[1]),d(100*+e[2])]}function b(e){return[+e[0]/255,+e[1]/255,+e[2]/255]}function y(e){if(r(e))return e;var t=/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*$/i.exec(e),i=/\s*hsv\s*\(\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*\)\s*$/i.exec(e),n="#"===e[0]&&e.match(/^#([\da-f]{3}|[\da-f]{6})$/i);return n?m(e.slice(1)):i?v([+i[1],+i[2],+i[3]]):t?h([+t[1],+t[2],+t[3]]):[0,1,1]}var _="__instance__",w="firstChild",C=setTimeout;!function(e){e.version="1.3.9",e[_]={},e.each=function(t,i){return C(function(){var i,n=e[_];for(i in n)t(n[i],i,n)},0===i?0:i||1),e},e.parse=y,e._HSV2RGB=l,e._HSV2HEX=p,e._RGB2HSV=h,e._HEX2HSV=m,e._HEX2RGB=function(e){return b(f(e))},e.HSV2RGB=function(e){return l(v(e))},e.HSV2HEX=function(e){return p(v(e))},e.RGB2HSV=function(e){return g(h(e))},e.RGB2HEX=u,e.HEX2HSV=function(e){return g(m(e))},e.HEX2RGB=f}(e[i]=function(c,d,h){function u(e,t,i){e=e.split(/\s+/);for(var n=0,o=e.length;n<o;++n)t.addEventListener(e[n],i,!1)}function m(e,t,i){e=e.split(/\s+/);for(var n=0,o=e.length;n<o;++n)t.removeEventListener(e[n],i)}function f(e,t){var i="touches",n="clientX",o="clientY",r=t[i]?t[i][0][n]:t[n],s=t[i]?t[i][0][o]:t[o],a=v(e);return{x:r-a.l,y:s-a.t}}function v(t){var i,n,o;return t===e?(i=e.pageXOffset||O.scrollLeft,n=e.pageYOffset||O.scrollTop):(o=t.getBoundingClientRect(),i=o.left,n=o.top),{l:i,t:n}}function g(e,t){for(;(e=e.parentElement)&&e!==t;);return e}function b(e){e&&e.preventDefault()}function y(t){return t===e?{w:e.innerWidth,h:e.innerHeight}:{w:t.offsetWidth,h:t.offsetHeight}}function S(e){return $||!!n(e)&&e}function A(e){$=e}function k(e,t,i){return n(e)?n(t)?(n(P[e])||(P[e]={}),n(i)||(i=s(P[e])),P[e][i]=t,M):P[e]:P}function E(e,t){return n(e)?n(t)?(delete P[e][t],M):(P[e]={},M):(P={},M)}function x(e,t,i){if(!n(P[e]))return M;if(n(i))n(P[e][i])&&P[e][i].apply(M,t);else for(var o in P[e])P[e][o].apply(M,t);return M}function R(e,t){e&&"h"!==e||x("change:h",t),e&&"sv"!==e||x("change:sv",t),x("change",t)}function T(){return N.parentNode}function H(i,n){function o(e){var t=e.target,i=t===c||g(t,c)===c;i?H():M.exit(),x(i?"enter":"exit",[M])}function r(e){var t=(l(G),l([G[0],1,1]));W.style.backgroundColor="rgb("+t.join(",")+")",A(G),b(e)}function s(e){var t=a(f(V,e).y,0,L);G[0]=(L-t)/L,Y.style.top=t-B/2+"px",r(e)}function v(e){var t=f(W,e),i=a(t.x,0,$),n=a(t.y,0,P);G[1]=1-($-i)/$,G[2]=(P-n)/P,X.style.right=$-i-ee/2+"px",X.style.top=n-te/2+"px",r(e)}function _(e){Q&&(s(e),oe=p(G),Z||(x("drag:h",[oe,M]),x("drag",[oe,M]),R("h",[oe,M]))),J&&(v(e),oe=p(G),K||(x("drag:sv",[oe,M]),x("drag",[oe,M]),R("sv",[oe,M]))),Z=0,K=0}function w(e){var t=e.target,i=Q?"h":"sv",n=[p(G),M],o=t===c||g(t,c)===c,r=t===N||g(t,N)===N;o||r?r&&(x("stop:"+i,n),x("stop",n),R(i,n)):T()&&d!==!1&&(M.exit(),x("exit",[M]),R(0,n)),Q=0,J=0}function C(e){Z=1,Q=1,_(e),b(e),x("start:h",[oe,M]),x("start",[oe,M]),R("h",[oe,M])}function k(e){K=1,J=1,_(e),b(e),x("start:sv",[oe,M]),x("start",[oe,M]),R("sv",[oe,M])}i||((h||n||I).appendChild(N),M.visible=!0),ie=y(N).w,ne=y(N).h;var E=y(W),O=y(X),L=y(V).h,$=E.w,P=E.h,B=y(Y).h,ee=O.w,te=O.h;i?(N.style.left=N.style.top="-9999px",d!==!1&&u(d,c,o),M.create=function(){return H(1),x("create",[M]),M},M.destroy=function(){return d!==!1&&m(d,c,o),M.exit(),A(!1),x("destroy",[M]),M}):D(),U=function(){G=S(G),r(),Y.style.top=L-B/2-L*+G[0]+"px",X.style.right=$-ee/2-$*+G[1]+"px",X.style.top=P-te/2-P*+G[2]+"px"},M.exit=function(i){return T()&&(T().removeChild(N),M.visible=!1),m(z,V,C),m(z,W,k),m(q,t,_),m(F,t,w),m(j,e,D),M},U(),i||(u(z,V,C),u(z,W,k),u(q,t,_),u(F,t,w),u(j,e,D))}function D(){return M.fit()}var I=t.body,O=t.documentElement,M=this,L=e[i],$=!1,P={},N=t.createElement("div"),z="touchstart mousedown",q="touchmove mousemove",F="touchend mouseup",j="orientationchange resize";if(!(M instanceof L))return new L(c,d);L[_][c.id||c.name||s(L[_])]=M,n(d)&&d!==!0||(d=z),A(L.parse(c.getAttribute("data-color")||c.value||[0,1,1])),N.className="color-picker",N.innerHTML='<div class="color-picker-control"><span class="color-picker-h"><i></i></span><span class="color-picker-sv"><i></i></span></div>';var U,B=N[w].children,G=S([0,1,1]),V=B[0],W=B[1],Y=V[w],X=W[w],Z=0,K=0,Q=0,J=0,ee=0,te=0,ie=0,ne=0,oe=p(G);return H(1),C(function(){var e=[p(G),M];x("create",e),R(0,e)},0),M.fit=function(t){var i=y(e),o=y(O),s=i.w-o.w,d=i.h-O.clientHeight,l=v(e),p=v(c);if(ee=p.l+l.l,te=p.t+l.t+y(c).h,r(t))n(t[0])&&(ee=t[0]),n(t[1])&&(te=t[1]);else{var h=l.l,u=l.t,m=l.l+i.w-ie-s,f=l.t+i.h-ne-d;ee=a(ee,h,m)>>0,te=a(te,u,f)>>0}return N.style.left=ee+"px",N.style.top=te+"px",x("fit",[M]),M},M.set=function(e){return n(e)?(o(e)&&(e=L.parse(e)),A(e),U(),M):S()},M.get=function(e){return S(e)},M.target=c,M.picker=N,M.visible=!1,M.on=k,M.off=E,M.fire=x,M.hooks=P,M.enter=function(e){return H(0,e)},M})}(window,document,"CP");