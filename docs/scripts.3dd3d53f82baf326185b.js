!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.THREE={})}(this,function(e){function t(){}function i(e,t){this.x=e||0,this.y=t||0}function n(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function r(e,t,i,n){this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==n?n:1}function o(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0}function s(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function a(e,t,n,r,o,c,l,d,h,u){Object.defineProperty(this,"id",{value:ro++}),this.uuid=to.generateUUID(),this.name="",this.image=void 0!==e?e:a.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:a.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:1001,this.wrapT=void 0!==r?r:1001,this.magFilter=void 0!==o?o:1006,this.minFilter=void 0!==c?c:1008,this.anisotropy=void 0!==h?h:1,this.format=void 0!==l?l:1023,this.type=void 0!==d?d:1009,this.offset=new i(0,0),this.repeat=new i(1,1),this.center=new i(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new s,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==u?u:3e3,this.version=0,this.onUpdate=null}function c(e,t,i,n){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1}function l(e,t,i){this.width=e,this.height=t,this.scissor=new c(0,0,e,t),this.scissorTest=!1,this.viewport=new c(0,0,e,t),this.texture=new a(void 0,void 0,(i=i||{}).wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:1006,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function d(e,t,i){l.call(this,e,t,i),this.activeMipMapLevel=this.activeCubeFace=0}function h(e,t,i,n,r,o,s,c,l,d,h,u){a.call(this,null,o,s,c,l,d,n,r,h,u),this.image={data:e,width:t,height:i},this.magFilter=void 0!==l?l:1003,this.minFilter=void 0!==d?d:1003,this.flipY=this.generateMipmaps=!1,this.unpackAlignment=1}function u(e,t){this.min=void 0!==e?e:new o(1/0,1/0,1/0),this.max=void 0!==t?t:new o(-1/0,-1/0,-1/0)}function p(e,t){this.center=void 0!==e?e:new o,this.radius=void 0!==t?t:0}function m(e,t){this.normal=void 0!==e?e:new o(1,0,0),this.constant=void 0!==t?t:0}function f(e,t,i,n,r,o){this.planes=[void 0!==e?e:new m,void 0!==t?t:new m,void 0!==i?i:new m,void 0!==n?n:new m,void 0!==r?r:new m,void 0!==o?o:new m]}function g(e){var t,i={};for(t in e)for(var n in i[t]={},e[t]){var r=e[t][n];i[t][n]=r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?r.clone():Array.isArray(r)?r.slice():r}return i}function v(e){for(var t={},i=0;i<e.length;i++){var n,r=g(e[i]);for(n in r)t[n]=r[n]}return t}function y(e,t,i){return void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}function b(){function e(r,o){!1!==i&&(n(r,o),t.requestAnimationFrame(e))}var t=null,i=!1,n=null;return{start:function(){!0!==i&&null!==n&&(t.requestAnimationFrame(e),i=!0)},stop:function(){i=!1},setAnimationLoop:function(e){n=e},setContext:function(e){t=e}}}function _(e){var t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(i){i.isInterleavedBufferAttribute&&(i=i.data);var n=t.get(i);n&&(e.deleteBuffer(n.buffer),t.delete(i))},update:function(i,n){i.isInterleavedBufferAttribute&&(i=i.data);var r=t.get(i);if(void 0===r)t.set(i,function(t,i){var n=t.array,r=t.dynamic?35048:35044,o=e.createBuffer();return e.bindBuffer(i,o),e.bufferData(i,n,r),t.onUploadCallback(),i=5126,n instanceof Float32Array?i=5126:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?i=5123:n instanceof Int16Array?i=5122:n instanceof Uint32Array?i=5125:n instanceof Int32Array?i=5124:n instanceof Int8Array?i=5120:n instanceof Uint8Array&&(i=5121),{buffer:o,type:i,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version}}(i,n));else if(r.version<i.version){var o=i,s=o.array,a=o.updateRange;e.bindBuffer(n,r.buffer),!1===o.dynamic?e.bufferData(n,s,35044):-1===a.count?e.bufferSubData(n,0,s):0===a.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(n,a.offset*s.BYTES_PER_ELEMENT,s.subarray(a.offset,a.offset+a.count)),a.count=-1),r.version=i.version}}}}function w(e,t,i,n,r,s){this.a=e,this.b=t,this.c=i,this.normal=n&&n.isVector3?n:new o,this.vertexNormals=Array.isArray(n)?n:[],this.color=r&&r.isColor?r:new y,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==s?s:0}function x(e,t,i,n){this._x=e||0,this._y=t||0,this._z=i||0,this._order=n||x.DefaultOrder}function C(){this.mask=1}function S(){Object.defineProperty(this,"id",{value:ho++}),this.uuid=to.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=S.DefaultUp.clone();var e=new o,t=new x,i=new r,a=new o(1,1,1);t.onChange(function(){i.setFromEuler(t,!1)}),i.onChange(function(){t.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:a},modelViewMatrix:{value:new n},normalMatrix:{value:new s}}),this.matrix=new n,this.matrixWorld=new n,this.matrixAutoUpdate=S.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new C,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function E(){Object.defineProperty(this,"id",{value:uo+=2}),this.uuid=to.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=!1}function M(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function T(e,t,i){M.call(this,new Int8Array(e),t,i)}function A(e,t,i){M.call(this,new Uint8Array(e),t,i)}function R(e,t,i){M.call(this,new Uint8ClampedArray(e),t,i)}function D(e,t,i){M.call(this,new Int16Array(e),t,i)}function L(e,t,i){M.call(this,new Uint16Array(e),t,i)}function I(e,t,i){M.call(this,new Int32Array(e),t,i)}function O(e,t,i){M.call(this,new Uint32Array(e),t,i)}function P(e,t,i){M.call(this,new Float32Array(e),t,i)}function H(e,t,i){M.call(this,new Float64Array(e),t,i)}function N(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingSphere=this.boundingBox=null,this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1}function z(e){if(0===e.length)return-1/0;for(var t=e[0],i=1,n=e.length;i<n;++i)e[i]>t&&(t=e[i]);return t}function F(){Object.defineProperty(this,"id",{value:po+=2}),this.uuid=to.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingSphere=this.boundingBox=null,this.drawRange={start:0,count:1/0},this.userData={}}function U(e,t,i,n,r,o){E.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:o},this.fromBufferGeometry(new B(e,t,i,n,r,o)),this.mergeVertices()}function B(e,t,i,n,r,s){function a(e,t,i,n,r,s,a,f,g,v,y){var b=s/g,_=a/v,w=s/2,x=a/2,C=f/2;a=g+1;var S,E,M=v+1,T=s=0,A=new o;for(E=0;E<M;E++){var k=E*_-x;for(S=0;S<a;S++)A[e]=(S*b-w)*n,A[t]=k*r,A[i]=C,d.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[i]=0<f?1:-1,h.push(A.x,A.y,A.z),u.push(S/g),u.push(1-E/v),s+=1}for(E=0;E<v;E++)for(S=0;S<g;S++)t=p+(S+1)+a*(E+1),l.push(p+S+a*E,e=p+S+a*(E+1),i=p+(S+1)+a*E),l.push(e,t,i),T+=6;c.addGroup(m,T,y),m+=T,p+=s}F.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:s};var c=this;e=e||1,t=t||1,i=i||1,n=Math.floor(n)||1,r=Math.floor(r)||1,s=Math.floor(s)||1;var l=[],d=[],h=[],u=[],p=0,m=0;a("z","y","x",-1,-1,i,t,e,s,r,0),a("z","y","x",1,-1,i,t,-e,s,r,1),a("x","z","y",1,1,e,i,t,n,s,2),a("x","z","y",1,-1,e,i,-t,n,s,3),a("x","y","z",1,-1,e,t,i,n,r,4),a("x","y","z",-1,-1,e,t,-i,n,r,5),this.setIndex(l),this.addAttribute("position",new P(d,3)),this.addAttribute("normal",new P(h,3)),this.addAttribute("uv",new P(u,2))}function j(e,t,i,n){E.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n},this.fromBufferGeometry(new G(e,t,i,n)),this.mergeVertices()}function G(e,t,i,n){F.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};var r=(e=e||1)/2,o=(t=t||1)/2,s=(i=Math.floor(i)||1)+1,a=(n=Math.floor(n)||1)+1,c=e/i,l=t/n,d=[],h=[],u=[],p=[];for(e=0;e<a;e++){var m=e*l-o;for(t=0;t<s;t++)h.push(t*c-r,-m,0),u.push(0,0,1),p.push(t/i),p.push(1-e/n)}for(e=0;e<n;e++)for(t=0;t<i;t++)o=t+1+s*(e+1),d.push(t+s*e,r=t+s*(e+1),a=t+1+s*e),d.push(r,o,a);this.setIndex(d),this.addAttribute("position",new P(h,3)),this.addAttribute("normal",new P(u,3)),this.addAttribute("uv",new P(p,2))}function V(){Object.defineProperty(this,"id",{value:mo++}),this.uuid=to.generateUUID(),this.name="",this.type="Material",this.lights=this.fog=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexColors=0,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null,this.depthFunc=3,this.depthWrite=this.depthTest=!0,this.clippingPlanes=null,this.clipShadows=this.clipIntersection=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetUnits=this.polygonOffsetFactor=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.userData={},this.needsUpdate=!0}function $(e){V.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function W(e,t){this.origin=void 0!==e?e:new o,this.direction=void 0!==t?t:new o}function q(e,t,i){this.a=void 0!==e?e:new o,this.b=void 0!==t?t:new o,this.c=void 0!==i?i:new o}function Y(e){V.call(this),this.type="MeshBasicMaterial",this.color=new y(16777215),this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.envMap=this.alphaMap=this.specularMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.lights=this.morphTargets=this.skinning=!1,this.setValues(e)}function X(e,t){S.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new F,this.material=void 0!==t?t:new Y({color:16777215*Math.random()}),this.drawMode=0,this.updateMorphTargets()}function Z(e,t,i,n){function r(e,i){t.buffers.color.setClear(e.r,e.g,e.b,i,n)}var o,s,a=new y(0),c=0,l=null,d=0;return{getClearColor:function(){return a},setClearColor:function(e,t){a.set(e),r(a,c=void 0!==t?t:1)},getClearAlpha:function(){return c},setClearAlpha:function(e){r(a,c=e)},render:function(t,n,h,u){null===(n=n.background)?(r(a,c),l=null,d=0):n&&n.isColor&&(r(n,1),u=!0,l=null,d=0),(e.autoClear||u)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),n&&(n.isCubeTexture||n.isWebGLRenderTargetCube)?(void 0===s&&((s=new X(new B(1,1,1),new $({type:"BackgroundCubeMaterial",uniforms:g(lo.cube.uniforms),vertexShader:lo.cube.vertexShader,fragmentShader:lo.cube.fragmentShader,side:1,depthTest:!0,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),s.geometry.removeAttribute("uv"),s.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.tCube.value}}),i.update(s)),s.material.uniforms.tCube.value=u=n.isWebGLRenderTargetCube?n.texture:n,s.material.uniforms.tFlip.value=n.isWebGLRenderTargetCube?1:-1,l===n&&d===u.version||(s.material.needsUpdate=!0,l=n,d=u.version),t.unshift(s,s.geometry,s.material,0,null)):n&&n.isTexture&&(void 0===o&&((o=new X(new G(2,2),new $({type:"BackgroundMaterial",uniforms:g(lo.background.uniforms),vertexShader:lo.background.vertexShader,fragmentShader:lo.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(o)),o.material.uniforms.t2D.value=n,!0===n.matrixAutoUpdate&&n.updateMatrix(),o.material.uniforms.uvTransform.value.copy(n.matrix),l===n&&d===n.version||(o.material.needsUpdate=!0,l=n,d=n.version),t.unshift(o,o.geometry,o.material,0,null))}}}function K(e,t,i,n){var r;this.setMode=function(e){r=e},this.render=function(t,n){e.drawArrays(r,t,n),i.update(n,r)},this.renderInstances=function(o,s,a){if(n.isWebGL2)var c=e;else if(null===(c=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[n.isWebGL2?"drawArraysInstanced":"drawArraysInstancedANGLE"](r,s,a,o.maxInstancedCount),i.update(a,r,o.maxInstancedCount)}}function J(e,t,i){function n(t){if("highp"===t){if(0<e.getShaderPrecisionFormat(35633,36338).precision&&0<e.getShaderPrecisionFormat(35632,36338).precision)return"highp";t="mediump"}return"mediump"===t&&0<e.getShaderPrecisionFormat(35633,36337).precision&&0<e.getShaderPrecisionFormat(35632,36337).precision?"mediump":"lowp"}var r,o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,s=void 0!==i.precision?i.precision:"highp",a=n(s);a!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",a,"instead."),s=a),i=!0===i.logarithmicDepthBuffer,a=e.getParameter(34930);var c=e.getParameter(35660),l=e.getParameter(3379),d=e.getParameter(34076),h=e.getParameter(34921),u=e.getParameter(36347),p=e.getParameter(36348),m=e.getParameter(36349),f=0<c,g=o||!!t.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==r)return r;var i=t.get("EXT_texture_filter_anisotropic");return r=null!==i?e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:n,precision:s,logarithmicDepthBuffer:i,maxTextures:a,maxVertexTextures:c,maxTextureSize:l,maxCubemapSize:d,maxAttributes:h,maxVertexUniforms:u,maxVaryings:p,maxFragmentUniforms:m,vertexTextures:f,floatFragmentTextures:g,floatVertexTextures:f&&g}}function Q(){function e(){d.value!==n&&(d.value=n,d.needsUpdate=0<r),i.numPlanes=r,i.numIntersection=0}function t(e,t,n,r){var o=null!==e?e.length:0,s=null;if(0!==o){if(s=d.value,!0!==r||null===s)for(r=n+4*o,l.getNormalMatrix(t=t.matrixWorldInverse),(null===s||s.length<r)&&(s=new Float32Array(r)),r=0;r!==o;++r,n+=4)c.copy(e[r]).applyMatrix4(t,l),c.normal.toArray(s,n),s[n+3]=c.constant;d.value=s,d.needsUpdate=!0}return i.numPlanes=o,s}var i=this,n=null,r=0,o=!1,a=!1,c=new m,l=new s,d={value:null,needsUpdate:!1};this.uniform=d,this.numIntersection=this.numPlanes=0,this.init=function(e,i,s){var a=0!==e.length||i||0!==r||o;return o=i,n=t(e,s,0),r=e.length,a},this.beginShadows=function(){a=!0,t(null)},this.endShadows=function(){a=!1,e()},this.setState=function(i,s,c,l,h,u){if(!o||null===i||0===i.length||a&&!c)a?t(null):e();else{var p=4*(c=a?0:r),m=h.clippingState||null;for(d.value=m,m=t(i,l,p,u),i=0;i!==p;++i)m[i]=n[i];h.clippingState=m,this.numIntersection=s?this.numPlanes:0,this.numPlanes+=c}}}function ee(e){var t={};return{get:function(i){if(void 0!==t[i])return t[i];switch(i){case"WEBGL_depth_texture":var n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(i)}return null===n&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),t[i]=n}}}function te(e,t,i){function n(e){var s=e.target;for(var a in null!==(e=r[s.id]).index&&t.remove(e.index),e.attributes)t.remove(e.attributes[a]);s.removeEventListener("dispose",n),delete r[s.id],(a=o[e.id])&&(t.remove(a),delete o[e.id]),i.memory.geometries--}var r={},o={};return{get:function(e,t){var o=r[t.id];return o||(t.addEventListener("dispose",n),t.isBufferGeometry?o=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new F).setFromObject(e)),o=t._bufferGeometry),r[t.id]=o,i.memory.geometries++,o)},update:function(e){var i=e.index,n=e.attributes;for(var r in null!==i&&t.update(i,34963),n)t.update(n[r],34962);for(r in e=e.morphAttributes){n=0;for(var o=(i=e[r]).length;n<o;n++)t.update(i[n],34962)}},getWireframeAttribute:function(e){var i=o[e.id];if(i)return i;i=[];var n=e.index,r=e.attributes;if(null!==n){r=0;for(var s=(n=n.array).length;r<s;r+=3){var a=n[r+0],c=n[r+1],l=n[r+2];i.push(a,c,c,l,l,a)}}else for(n=r.position.array,r=0,s=n.length/3-1;r<s;r+=3)i.push(a=r+0,c=r+1,c,l=r+2,l,a);return i=new(65535<z(i)?O:L)(i,1),t.update(i,34963),o[e.id]=i}}}function ie(e,t,i,n){var r,o,s;this.setMode=function(e){r=e},this.setIndex=function(e){o=e.type,s=e.bytesPerElement},this.render=function(t,n){e.drawElements(r,n,o,t*s),i.update(n,r)},this.renderInstances=function(a,c,l){if(n.isWebGL2)var d=e;else if(null===(d=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");d[n.isWebGL2?"drawElementsInstanced":"drawElementsInstancedANGLE"](r,l,o,c*s,a.maxInstancedCount),i.update(l,r,a.maxInstancedCount)}}function ne(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,i,n){switch(n=n||1,t.calls++,i){case 4:t.triangles+=e/3*n;break;case 5:case 6:t.triangles+=n*(e-2);break;case 1:t.lines+=e/2*n;break;case 3:t.lines+=n*(e-1);break;case 2:t.lines+=n*e;break;case 0:t.points+=n*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function re(e,t){return Math.abs(t[1])-Math.abs(e[1])}function oe(e){var t={},i=new Float32Array(8);return{update:function(n,r,o,s){var a=n.morphTargetInfluences,c=a.length;if(void 0===(n=t[r.id])){n=[];for(var l=0;l<c;l++)n[l]=[l,0];t[r.id]=n}var d=o.morphTargets&&r.morphAttributes.position;for(o=o.morphNormals&&r.morphAttributes.normal,l=0;l<c;l++){var h=n[l];0!==h[1]&&(d&&r.removeAttribute("morphTarget"+l),o&&r.removeAttribute("morphNormal"+l))}for(l=0;l<c;l++)(h=n[l])[0]=l,h[1]=a[l];for(n.sort(re),l=0;8>l;l++)(h=n[l])&&(a=h[0],c=h[1])?(d&&r.addAttribute("morphTarget"+l,d[a]),o&&r.addAttribute("morphNormal"+l,o[a]),i[l]=c):i[l]=0;s.getUniforms().setValue(e,"morphTargetInfluences",i)}}}function se(e,t){var i={};return{update:function(n){var r=t.render.frame,o=n.geometry,s=e.get(n,o);return i[s.id]!==r&&(o.isGeometry&&s.updateFromObject(n),e.update(s),i[s.id]=r),s},dispose:function(){i={}}}}function ae(e,t,i,n,r,o,s,c,l,d){a.call(this,e=void 0!==e?e:[],void 0!==t?t:301,i,n,r,o,s,c,l,d),this.flipY=!1}function ce(e,t,i,n){a.call(this,null),this.image={data:e,width:t,height:i,depth:n},this.minFilter=this.magFilter=1003,this.flipY=this.generateMipmaps=!1}function le(e,t,i){var n=e[0];if(0>=n||0<n)return e;var r=t*i,o=yo[r];if(void 0===o&&(o=new Float32Array(r),yo[r]=o),0!==t)for(n.toArray(o,0),n=1,r=0;n!==t;++n)e[n].toArray(o,r+=i);return o}function de(e,t){if(e.length!==t.length)return!1;for(var i=0,n=e.length;i<n;i++)if(e[i]!==t[i])return!1;return!0}function he(e,t){for(var i=0,n=t.length;i<n;i++)e[i]=t[i]}function ue(e,t){var i=bo[t];void 0===i&&(i=new Int32Array(t),bo[t]=i);for(var n=0;n!==t;++n)i[n]=e.allocTextureUnit();return i}function pe(e,t){var i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function me(e,t){var i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function fe(e,t){var i=this.cache;void 0!==t.x?i[0]===t.x&&i[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y):de(i,t)||(e.uniform2fv(this.addr,t),he(i,t))}function ge(e,t){var i=this.cache;void 0!==t.x?i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z):void 0!==t.r?i[0]===t.r&&i[1]===t.g&&i[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b):de(i,t)||(e.uniform3fv(this.addr,t),he(i,t))}function ve(e,t){var i=this.cache;void 0!==t.x?i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w):de(i,t)||(e.uniform4fv(this.addr,t),he(i,t))}function ye(e,t){var i=this.cache,n=t.elements;void 0===n?de(i,t)||(e.uniformMatrix2fv(this.addr,!1,t),he(i,t)):de(i,n)||(xo.set(n),e.uniformMatrix2fv(this.addr,!1,xo),he(i,n))}function be(e,t){var i=this.cache,n=t.elements;void 0===n?de(i,t)||(e.uniformMatrix3fv(this.addr,!1,t),he(i,t)):de(i,n)||(wo.set(n),e.uniformMatrix3fv(this.addr,!1,wo),he(i,n))}function _e(e,t){var i=this.cache,n=t.elements;void 0===n?de(i,t)||(e.uniformMatrix4fv(this.addr,!1,t),he(i,t)):de(i,n)||(_o.set(n),e.uniformMatrix4fv(this.addr,!1,_o),he(i,n))}function we(e,t,i){var n=this.cache,r=i.allocTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2D(t||fo,r)}function xe(e,t,i){var n=this.cache,r=i.allocTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(t||go,r)}function Ce(e,t,i){var n=this.cache,r=i.allocTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(t||vo,r)}function Se(e,t){var i=this.cache;de(i,t)||(e.uniform2iv(this.addr,t),he(i,t))}function Ee(e,t){var i=this.cache;de(i,t)||(e.uniform3iv(this.addr,t),he(i,t))}function Me(e,t){var i=this.cache;de(i,t)||(e.uniform4iv(this.addr,t),he(i,t))}function Te(e,t){var i=this.cache;de(i,t)||(e.uniform1fv(this.addr,t),he(i,t))}function Ae(e,t){var i=this.cache;de(i,t)||(e.uniform1iv(this.addr,t),he(i,t))}function ke(e,t){de(this.cache,t=le(t,this.size,2))||(e.uniform2fv(this.addr,t),this.updateCache(t))}function Re(e,t){de(this.cache,t=le(t,this.size,3))||(e.uniform3fv(this.addr,t),this.updateCache(t))}function De(e,t){de(this.cache,t=le(t,this.size,4))||(e.uniform4fv(this.addr,t),this.updateCache(t))}function Le(e,t){de(this.cache,t=le(t,this.size,4))||(e.uniformMatrix2fv(this.addr,!1,t),this.updateCache(t))}function Ie(e,t){de(this.cache,t=le(t,this.size,9))||(e.uniformMatrix3fv(this.addr,!1,t),this.updateCache(t))}function Oe(e,t){de(this.cache,t=le(t,this.size,16))||(e.uniformMatrix4fv(this.addr,!1,t),this.updateCache(t))}function Pe(e,t,i){var n=this.cache,r=t.length,o=ue(i,r);for(!1===de(n,o)&&(e.uniform1iv(this.addr,o),he(n,o)),e=0;e!==r;++e)i.setTexture2D(t[e]||fo,o[e])}function He(e,t,i){var n=this.cache,r=t.length,o=ue(i,r);for(!1===de(n,o)&&(e.uniform1iv(this.addr,o),he(n,o)),e=0;e!==r;++e)i.setTextureCube(t[e]||vo,o[e])}function Ne(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function(e){switch(t.type){case 5126:return pe;case 35664:return fe;case 35665:return ge;case 35666:return ve;case 35674:return ye;case 35675:return be;case 35676:return _e;case 35678:case 36198:return we;case 35679:return xe;case 35680:return Ce;case 5124:case 35670:return me;case 35667:case 35671:return Se;case 35668:case 35672:return Ee;case 35669:case 35673:return Me}}()}function ze(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function(e){switch(t.type){case 5126:return Te;case 35664:return ke;case 35665:return Re;case 35666:return De;case 35674:return Le;case 35675:return Ie;case 35676:return Oe;case 35678:return Pe;case 35680:return He;case 5124:case 35670:return Ae;case 35667:case 35671:return Se;case 35668:case 35672:return Ee;case 35669:case 35673:return Me}}()}function Fe(e){this.id=e,this.seq=[],this.map={}}function Ue(e,t,i){this.seq=[],this.map={},this.renderer=i,i=e.getProgramParameter(t,35718);for(var n=0;n<i;++n){var r=e.getActiveUniform(t,n),o=e.getUniformLocation(t,r.name),s=this,a=r.name,c=a.length;for(Co.lastIndex=0;;){var l=Co.exec(a),d=l[1],h=l[3];if("]"===l[2]&&(d|=0),void 0===h||"["===h&&Co.lastIndex+2===c){a=s,r=void 0===h?new Ne(d,r,o):new ze(d,r,o),a.seq.push(r),a.map[r.id]=r;break}void 0===(h=s.map[d])&&(h=new Fe(d),(d=s).seq.push(s=h),d.map[s.id]=s),s=h}}}function Be(e,t,i){var n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),!1===e.getShaderParameter(n,35713)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(n)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",35633===t?"vertex":"fragment",e.getShaderInfoLog(n),function(e){e=e.split("\n");for(var t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(i)),n}function je(e){switch(e){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw Error("unsupported encoding: "+e)}}function Ge(e,t){return"vec4 "+e+"( vec4 value ) { return "+(t=je(t))[0]+"ToLinear"+t[1]+"; }"}function Ve(e,t){return"vec4 "+e+"( vec4 value ) { return LinearTo"+(t=je(t))[0]+t[1]+"; }"}function $e(e,t){switch(t){case 1:t="Linear";break;case 2:t="Reinhard";break;case 3:t="Uncharted2";break;case 4:t="OptimizedCineon";break;case 5:t="ACESFilmic";break;default:throw Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function We(e){return""!==e}function qe(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function Ye(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function Xe(e){return e.replace(/^[ \t]*#include +<([\w\d.\/]+)>/gm,function(e,t){if(void 0===(e=oo[t]))throw Error("Can not resolve #include <"+t+">");return Xe(e)})}function Ze(e){return e.replace(/#pragma unroll_loop[\s]+?for \( int i = (\d+); i < (\d+); i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(e,t,i,n){for(e="",t=parseInt(t);t<parseInt(i);t++)e+=n.replace(/\[ i \]/g,"[ "+t+" ]");return e})}function Ke(e,t,i,n,r,o,s){var a=e.context,c=n.defines,l=r.vertexShader,d=r.fragmentShader,h="SHADOWMAP_TYPE_BASIC";1===o.shadowMapType?h="SHADOWMAP_TYPE_PCF":2===o.shadowMapType&&(h="SHADOWMAP_TYPE_PCF_SOFT");var u="ENVMAP_TYPE_CUBE",p="ENVMAP_MODE_REFLECTION",m="ENVMAP_BLENDING_MULTIPLY";if(o.envMap){switch(n.envMap.mapping){case 301:case 302:u="ENVMAP_TYPE_CUBE";break;case 306:case 307:u="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:u="ENVMAP_TYPE_EQUIREC";break;case 305:u="ENVMAP_TYPE_SPHERE"}switch(n.envMap.mapping){case 302:case 304:p="ENVMAP_MODE_REFRACTION"}switch(n.combine){case 0:m="ENVMAP_BLENDING_MULTIPLY";break;case 1:m="ENVMAP_BLENDING_MIX";break;case 2:m="ENVMAP_BLENDING_ADD"}}var f,g,v=0<e.gammaFactor?e.gammaFactor:1,y=s.isWebGL2?"":function(e,t,i){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap&&!t.objectSpaceNormalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&i.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&i.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&i.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(We).join("\n")}(n.extensions,o,t),b=function(e){var t,i=[];for(t in e){var n=e[t];!1!==n&&i.push("#define "+t+" "+n)}return i.join("\n")}(c),_=a.createProgram();return n.isRawShaderMaterial?(0<(c=[b].filter(We).join("\n")).length&&(c+="\n"),0<(t=[y,b].filter(We).join("\n")).length&&(t+="\n")):(c=["precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+r.name,b,o.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+v,"#define MAX_BONES "+o.maxBones,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+p:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.displacementMap&&o.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&!1===o.flatShading?"#define USE_MORPHNORMALS":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+h:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(s.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(We).join("\n"),t=[y,"precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+r.name,b,o.alphaTest?"#define ALPHATEST "+o.alphaTest+(o.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+v,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.matcap?"#define USE_MATCAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+u:"",o.envMap?"#define "+p:"",o.envMap?"#define "+m:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.normalMap&&o.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+h:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&(s.isWebGL2||t.get("EXT_frag_depth"))?"#define USE_LOGDEPTHBUF_EXT":"",o.envMap&&(s.isWebGL2||t.get("EXT_shader_texture_lod"))?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",0!==o.toneMapping?"#define TONE_MAPPING":"",0!==o.toneMapping?oo.tonemapping_pars_fragment:"",0!==o.toneMapping?$e("toneMapping",o.toneMapping):"",o.dithering?"#define DITHERING":"",o.outputEncoding||o.mapEncoding||o.matcapEncoding||o.envMapEncoding||o.emissiveMapEncoding?oo.encodings_pars_fragment:"",o.mapEncoding?Ge("mapTexelToLinear",o.mapEncoding):"",o.matcapEncoding?Ge("matcapTexelToLinear",o.matcapEncoding):"",o.envMapEncoding?Ge("envMapTexelToLinear",o.envMapEncoding):"",o.emissiveMapEncoding?Ge("emissiveMapTexelToLinear",o.emissiveMapEncoding):"",o.outputEncoding?Ve("linearToOutputTexel",o.outputEncoding):"",o.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(We).join("\n")),l=Ye(l=qe(l=Xe(l),o),o),d=Ye(d=qe(d=Xe(d),o),o),l=Ze(l),d=Ze(d),s.isWebGL2&&!n.isRawShaderMaterial&&(s=!1,h=/^\s*#version\s+300\s+es\s*\n/,n.isShaderMaterial&&null!==l.match(h)&&null!==d.match(h)&&(s=!0,l=l.replace(h,""),d=d.replace(h,"")),c="#version 300 es\n\n#define attribute in\n#define varying out\n#define texture2D texture\n"+c,t=["#version 300 es\n\n#define varying in",s?"":"out highp vec4 pc_fragColor;",s?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth\n#define texture2D texture\n#define textureCube texture\n#define texture2DProj textureProj\n#define texture2DLodEXT textureLod\n#define texture2DProjLodEXT textureProjLod\n#define textureCubeLodEXT textureLod\n#define texture2DGradEXT textureGrad\n#define texture2DProjGradEXT textureProjGrad\n#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+t),d=t+d,l=Be(a,35633,c+l),d=Be(a,35632,d),a.attachShader(_,l),a.attachShader(_,d),void 0!==n.index0AttributeName?a.bindAttribLocation(_,0,n.index0AttributeName):!0===o.morphTargets&&a.bindAttribLocation(_,0,"position"),a.linkProgram(_),o=a.getProgramInfoLog(_).trim(),s=a.getShaderInfoLog(l).trim(),h=a.getShaderInfoLog(d).trim(),p=u=!0,!1===a.getProgramParameter(_,35714)?(u=!1,console.error("THREE.WebGLProgram: shader error: ",a.getError(),"35715",a.getProgramParameter(_,35715),"gl.getProgramInfoLog",o,s,h)):""!==o?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",o):""!==s&&""!==h||(p=!1),p&&(this.diagnostics={runnable:u,material:n,programLog:o,vertexShader:{log:s,prefix:c},fragmentShader:{log:h,prefix:t}}),a.deleteShader(l),a.deleteShader(d),this.getUniforms=function(){return void 0===f&&(f=new Ue(a,_,e)),f},this.getAttributes=function(){if(void 0===g){for(var e={},t=a.getProgramParameter(_,35721),i=0;i<t;i++){var n=a.getActiveAttrib(_,i).name;e[n]=a.getAttribLocation(_,n)}g=e}return g},this.destroy=function(){a.deleteProgram(_),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.name=r.name,this.id=So++,this.code=i,this.usedTimes=1,this.program=_,this.vertexShader=l,this.fragmentShader=d,this}function Je(e,t,i){function n(e,t){if(e)e.isTexture?i=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=e.texture.encoding);else var i=3e3;return 3e3===i&&t&&(i=3007),i}var r=[],o={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},s="precision supportsVertexTextures map mapEncoding matcap matcapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap objectSpaceNormalMap displacementMap specularMap roughnessMap metalnessMap gradientMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights numRectAreaLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes numClipIntersection depthPacking dithering".split(" ");this.getParameters=function(t,r,s,a,c,l,d){var h=o[t.type];if(d.isSkinnedMesh){var u=d.skeleton.bones;if(i.floatVertexTextures)u=1024;else{var p=Math.min(Math.floor((i.maxVertexUniforms-20)/4),u.length);p<u.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+u.length+" bones. This GPU supports "+p+"."),u=0):u=p}}else u=0;p=i.precision,null!==t.precision&&(p=i.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",p,"instead.");var m=e.getRenderTarget();return{shaderID:h,precision:p,supportsVertexTextures:i.vertexTextures,outputEncoding:n(m?m.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:n(t.map,e.gammaInput),matcap:!!t.matcap,matcapEncoding:n(t.matcap,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:n(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(306===t.envMap.mapping||307===t.envMap.mapping),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:n(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,objectSpaceNormalMap:1===t.normalMapType,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexColors:t.vertexColors,fog:!!a,useFog:t.fog,fogExp:a&&a.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:i.logarithmicDepthBuffer,skinning:t.skinning&&0<u,maxBones:u,useVertexTexture:i.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:r.directional.length,numPointLights:r.point.length,numSpotLights:r.spot.length,numRectAreaLights:r.rectArea.length,numHemiLights:r.hemi.length,numClippingPlanes:c,numClipIntersection:l,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&d.receiveShadow&&0<s.length,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:2===t.side,flipSided:1===t.side,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCode=function(t,i){var n=[];if(i.shaderID?n.push(i.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(var r in t.defines)n.push(r),n.push(t.defines[r]);for(r=0;r<s.length;r++)n.push(i[s[r]]);return n.push(t.onBeforeCompile.toString()),n.push(e.gammaOutput),n.push(e.gammaFactor),n.join()},this.acquireProgram=function(n,o,s,a){for(var c,l=0,d=r.length;l<d;l++){var h=r[l];if(h.code===a){++(c=h).usedTimes;break}}return void 0===c&&(c=new Ke(e,t,a,n,o,s,i),r.push(c)),c},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=r.indexOf(e);r[t]=r[r.length-1],r.pop(),e.destroy()}},this.programs=r}function Qe(){var e=new WeakMap;return{get:function(t){var i=e.get(t);return void 0===i&&e.set(t,i={}),i},remove:function(t){e.delete(t)},update:function(t,i,n){e.get(t)[i]=n},dispose:function(){e=new WeakMap}}}function et(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program&&t.program&&e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function tt(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function it(){function e(e,n,r,o,s){var a=t[i];return void 0===a?t[i]=a={id:e.id,object:e,geometry:n,material:r,program:r.program,renderOrder:e.renderOrder,z:o,group:s}:(a.id=e.id,a.object=e,a.geometry=n,a.material=r,a.program=r.program,a.renderOrder=e.renderOrder,a.z=o,a.group=s),i++,a}var t=[],i=0,n=[],r=[];return{opaque:n,transparent:r,init:function(){i=0,n.length=0,r.length=0},push:function(t,i,o,s,a){t=e(t,i,o,s,a),(!0===o.transparent?r:n).push(t)},unshift:function(t,i,o,s,a){t=e(t,i,o,s,a),(!0===o.transparent?r:n).unshift(t)},sort:function(){1<n.length&&n.sort(et),1<r.length&&r.sort(tt)}}}function nt(){var e={};return{get:function(t,i){var n=e[t.id];if(void 0===n){var r=new it;e[t.id]={},e[t.id][i.id]=r}else void 0===(r=n[i.id])&&(r=new it,n[i.id]=r);return r},dispose:function(){e={}}}}function rt(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];switch(t.type){case"DirectionalLight":var n={direction:new o,color:new y,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new i};break;case"SpotLight":n={position:new o,direction:new o,color:new y,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new i};break;case"PointLight":n={position:new o,color:new y,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new i,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":n={direction:new o,skyColor:new y,groundColor:new y};break;case"RectAreaLight":n={color:new y,position:new o,halfWidth:new o,halfHeight:new o}}return e[t.id]=n}}}function ot(){var e=new rt,t={id:Eo++,hash:{stateID:-1,directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,shadowsLength:-1},ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},i=new o,r=new n,s=new n;return{setup:function(n,o,a){var c=0,l=0,d=0,h=0,u=0,p=0,m=0,f=0;a=a.matrixWorldInverse;for(var g=0,v=n.length;g<v;g++){var y=n[g],b=y.color,_=y.intensity,w=y.distance,x=y.shadow&&y.shadow.map?y.shadow.map.texture:null;if(y.isAmbientLight)c+=b.r*_,l+=b.g*_,d+=b.b*_;else if(y.isDirectionalLight){var C=e.get(y);C.color.copy(y.color).multiplyScalar(y.intensity),C.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),C.direction.sub(i),C.direction.transformDirection(a),(C.shadow=y.castShadow)&&(C.shadowBias=(b=y.shadow).bias,C.shadowRadius=b.radius,C.shadowMapSize=b.mapSize),t.directionalShadowMap[h]=x,t.directionalShadowMatrix[h]=y.shadow.matrix,t.directional[h]=C,h++}else y.isSpotLight?((C=e.get(y)).position.setFromMatrixPosition(y.matrixWorld),C.position.applyMatrix4(a),C.color.copy(b).multiplyScalar(_),C.distance=w,C.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),C.direction.sub(i),C.direction.transformDirection(a),C.coneCos=Math.cos(y.angle),C.penumbraCos=Math.cos(y.angle*(1-y.penumbra)),C.decay=y.decay,(C.shadow=y.castShadow)&&(C.shadowBias=(b=y.shadow).bias,C.shadowRadius=b.radius,C.shadowMapSize=b.mapSize),t.spotShadowMap[p]=x,t.spotShadowMatrix[p]=y.shadow.matrix,t.spot[p]=C,p++):y.isRectAreaLight?((C=e.get(y)).color.copy(b).multiplyScalar(_),C.position.setFromMatrixPosition(y.matrixWorld),C.position.applyMatrix4(a),s.identity(),r.copy(y.matrixWorld),r.premultiply(a),s.extractRotation(r),C.halfWidth.set(.5*y.width,0,0),C.halfHeight.set(0,.5*y.height,0),C.halfWidth.applyMatrix4(s),C.halfHeight.applyMatrix4(s),t.rectArea[m]=C,m++):y.isPointLight?((C=e.get(y)).position.setFromMatrixPosition(y.matrixWorld),C.position.applyMatrix4(a),C.color.copy(y.color).multiplyScalar(y.intensity),C.distance=y.distance,C.decay=y.decay,(C.shadow=y.castShadow)&&(C.shadowBias=(b=y.shadow).bias,C.shadowRadius=b.radius,C.shadowMapSize=b.mapSize,C.shadowCameraNear=b.camera.near,C.shadowCameraFar=b.camera.far),t.pointShadowMap[u]=x,t.pointShadowMatrix[u]=y.shadow.matrix,t.point[u]=C,u++):y.isHemisphereLight&&((C=e.get(y)).direction.setFromMatrixPosition(y.matrixWorld),C.direction.transformDirection(a),C.direction.normalize(),C.skyColor.copy(y.color).multiplyScalar(_),C.groundColor.copy(y.groundColor).multiplyScalar(_),t.hemi[f]=C,f++)}t.ambient[0]=c,t.ambient[1]=l,t.ambient[2]=d,t.directional.length=h,t.spot.length=p,t.rectArea.length=m,t.point.length=u,t.hemi.length=f,t.hash.stateID=t.id,t.hash.directionalLength=h,t.hash.pointLength=u,t.hash.spotLength=p,t.hash.rectAreaLength=m,t.hash.hemiLength=f,t.hash.shadowsLength=o.length},state:t}}function st(){var e=new ot,t=[],i=[];return{init:function(){t.length=0,i.length=0},state:{lightsArray:t,shadowsArray:i,lights:e},setupLights:function(n){e.setup(t,i,n)},pushLight:function(e){t.push(e)},pushShadow:function(e){i.push(e)}}}function at(){var e={};return{get:function(t,i){if(void 0===e[t.id]){var n=new st;e[t.id]={},e[t.id][i.id]=n}else void 0===e[t.id][i.id]?(n=new st,e[t.id][i.id]=n):n=e[t.id][i.id];return n},dispose:function(){e={}}}}function ct(e){V.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.morphTargets=this.skinning=!1,this.displacementMap=this.alphaMap=this.map=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.lights=this.fog=!1,this.setValues(e)}function lt(e){V.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new o,this.nearDistance=1,this.farDistance=1e3,this.morphTargets=this.skinning=!1,this.displacementMap=this.alphaMap=this.map=null,this.displacementScale=1,this.displacementBias=0,this.lights=this.fog=!1,this.setValues(e)}function dt(e,t,r){function s(t,i,n,r,o,s){var a=t.geometry,c=v,l=t.customDepthMaterial;return n&&(c=y,l=t.customDistanceMaterial),l?c=l:(l=!1,i.morphTargets&&(a&&a.isBufferGeometry?l=a.morphAttributes&&a.morphAttributes.position&&0<a.morphAttributes.position.length:a&&a.isGeometry&&(l=a.morphTargets&&0<a.morphTargets.length)),t.isSkinnedMesh&&!1===i.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t),a=0,l&&(a|=1),(t=t.isSkinnedMesh&&i.skinning)&&(a|=2),c=c[a]),e.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length&&(l=i.uuid,void 0===(t=b[a=c.uuid])&&(b[a]=t={}),void 0===(a=t[l])&&(a=c.clone(),t[l]=a),c=a),c.visible=i.visible,c.wireframe=i.wireframe,c.side=null!=i.shadowSide?i.shadowSide:_[i.side],c.clipShadows=i.clipShadows,c.clippingPlanes=i.clippingPlanes,c.clipIntersection=i.clipIntersection,c.wireframeLinewidth=i.wireframeLinewidth,c.linewidth=i.linewidth,n&&c.isMeshDistanceMaterial&&(c.referencePosition.copy(r),c.nearDistance=o,c.farDistance=s),c}function a(i,n,r,o){if(!1!==i.visible){if(i.layers.test(n.layers)&&(i.isMesh||i.isLine||i.isPoints)&&i.castShadow&&(!i.frustumCulled||d.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,i.matrixWorld);var c=t.update(i),l=i.material;if(Array.isArray(l))for(var h=c.groups,u=0,p=h.length;u<p;u++){var m=h[u],f=l[m.materialIndex];f&&f.visible&&(f=s(i,f,o,g,r.near,r.far),e.renderBufferDirect(r,null,c,f,i,m))}else l.visible&&(f=s(i,l,o,g,r.near,r.far),e.renderBufferDirect(r,null,c,f,i,null))}for(c=0,l=(i=i.children).length;c<l;c++)a(i[c],n,r,o)}}var d=new f,h=new n,u=new i,p=new i(r,r),m=new o,g=new o,v=Array(4),y=Array(4),b={},_={0:1,1:0,2:2},w=[new o(1,0,0),new o(-1,0,0),new o(0,0,1),new o(0,0,-1),new o(0,1,0),new o(0,-1,0)],x=[new o(0,1,0),new o(0,1,0),new o(0,1,0),new o(0,1,0),new o(0,0,1),new o(0,0,-1)],C=[new c,new c,new c,new c,new c,new c];for(r=0;4!==r;++r){var S=0!=(1&r),E=0!=(2&r),M=new ct({depthPacking:3201,morphTargets:S,skinning:E});v[r]=M,S=new lt({morphTargets:S,skinning:E}),y[r]=S}var T=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,i,n){if(!1!==T.enabled&&(!1!==T.autoUpdate||!1!==T.needsUpdate)&&0!==t.length){var r=e.state;r.disable(3042),r.buffers.color.setClear(1,1,1,1),r.buffers.depth.setTest(!0),r.setScissorTest(!1);for(var o,s=0,c=t.length;s<c;s++){var f=t[s],v=f&&f.isPointLight;if(void 0===(o=f.shadow))console.warn("THREE.WebGLShadowMap:",f,"has no shadow.");else{var y=o.camera;if(u.copy(o.mapSize),u.min(p),v){var b=u.x,_=u.y;C[0].set(2*b,_,b,_),C[1].set(0,_,b,_),C[2].set(3*b,_,b,_),C[3].set(b,_,b,_),C[4].set(3*b,0,b,_),C[5].set(b,0,b,_),u.x*=4,u.y*=2}for(null===o.map&&(o.map=new l(u.x,u.y,{minFilter:1003,magFilter:1003,format:1023}),o.map.texture.name=f.name+".shadowMap",y.updateProjectionMatrix()),o.isSpotLightShadow&&o.update(f),b=o.map,_=o.matrix,g.setFromMatrixPosition(f.matrixWorld),y.position.copy(g),v?(o=6,_.makeTranslation(-g.x,-g.y,-g.z)):(o=1,m.setFromMatrixPosition(f.target.matrixWorld),y.lookAt(m),y.updateMatrixWorld(),_.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),_.multiply(y.projectionMatrix),_.multiply(y.matrixWorldInverse)),e.setRenderTarget(b),e.clear(),f=0;f<o;f++)v&&(m.copy(y.position),m.add(w[f]),y.up.copy(x[f]),y.lookAt(m),y.updateMatrixWorld(),r.viewport(C[f])),h.multiplyMatrices(y.projectionMatrix,y.matrixWorldInverse),d.setFromMatrix(h),a(i,n,y,v)}}T.needsUpdate=!1}}}function ht(e,t,i,n){function r(t,i,n){var r=new Uint8Array(4),o=e.createTexture();for(e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728),t=0;t<n;t++)e.texImage2D(i+t,0,6408,1,1,0,6408,5121,r);return o}function o(i,r){y[i]=1,0===b[i]&&(e.enableVertexAttribArray(i),b[i]=1),_[i]!==r&&((n.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),_[i]=r)}function s(t){!0!==w[t]&&(e.enable(t),w[t]=!0)}function a(t){!1!==w[t]&&(e.disable(t),w[t]=!1)}function l(t,n,r,o,c,l,d,h){if(0===t)S&&(a(3042),S=!1);else if(S||(s(3042),S=!0),5!==t){if(t!==E||h!==L){if(100===M&&100===k||(e.blendEquation(32774),k=M=100),h)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,0,769,771);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFunc(0,769);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}D=R=A=T=null,E=t,L=h}}else c=c||n,l=l||r,d=d||o,n===M&&c===k||(e.blendEquationSeparate(i.convert(n),i.convert(c)),M=n,k=c),r===T&&o===A&&l===R&&d===D||(e.blendFuncSeparate(i.convert(r),i.convert(o),i.convert(l),i.convert(d)),T=r,A=o,R=l,D=d),E=t,L=null}function d(t){I!==t&&(e.frontFace(t?2304:2305),I=t)}function h(t){0!==t?(s(2884),t!==O&&e.cullFace(1===t?1029:2===t?1028:1032)):a(2884),O=t}function u(t,i,n){t?(s(32823),(H!==i||N!==n)&&(e.polygonOffset(i,n),H=i,N=n)):a(32823)}function p(t){void 0===t&&(t=33984+z-1),U!==t&&(e.activeTexture(t),U=t)}var m=new function(){var t=!1,i=new c,n=null,r=new c(0,0,0,0);return{setMask:function(i){n===i||t||(e.colorMask(i,i,i,i),n=i)},setLocked:function(e){t=e},setClear:function(t,n,o,s,a){!0===a&&(t*=s,n*=s,o*=s),i.set(t,n,o,s),!1===r.equals(i)&&(e.clearColor(t,n,o,s),r.copy(i))},reset:function(){t=!1,n=null,r.set(-1,0,0,0)}}},f=new function(){var t=!1,i=null,n=null,r=null;return{setTest:function(e){e?s(2929):a(2929)},setMask:function(n){i===n||t||(e.depthMask(n),i=n)},setFunc:function(t){if(n!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);n=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,r=n=i=null}}},g=new function(){var t=!1,i=null,n=null,r=null,o=null,c=null,l=null,d=null,h=null;return{setTest:function(e){e?s(2960):a(2960)},setMask:function(n){i===n||t||(e.stencilMask(n),i=n)},setFunc:function(t,i,s){n===t&&r===i&&o===s||(e.stencilFunc(t,i,s),n=t,r=i,o=s)},setOp:function(t,i,n){c===t&&l===i&&d===n||(e.stencilOp(t,i,n),c=t,l=i,d=n)},setLocked:function(e){t=e},setClear:function(t){h!==t&&(e.clearStencil(t),h=t)},reset:function(){t=!1,h=d=l=c=o=r=n=i=null}}},v=e.getParameter(34921),y=new Uint8Array(v),b=new Uint8Array(v),_=new Uint8Array(v),w={},x=null,C=null,S=null,E=null,M=null,T=null,A=null,k=null,R=null,D=null,L=!1,I=null,O=null,P=null,H=null,N=null,z=e.getParameter(35661),F=!1;v=0,-1!==(v=e.getParameter(7938)).indexOf("WebGL")?(v=parseFloat(/^WebGL ([0-9])/.exec(v)[1]),F=1<=v):-1!==v.indexOf("OpenGL ES")&&(v=parseFloat(/^OpenGL ES ([0-9])/.exec(v)[1]),F=2<=v);var U=null,B={},j=new c,G=new c,V={};return V[3553]=r(3553,3553,1),V[34067]=r(34067,34069,6),m.setClear(0,0,0,1),f.setClear(1),g.setClear(0),s(2929),f.setFunc(3),d(!1),h(1),s(2884),l(0),{buffers:{color:m,depth:f,stencil:g},initAttributes:function(){for(var e=0,t=y.length;e<t;e++)y[e]=0},enableAttribute:function(e){o(e,0)},enableAttributeAndDivisor:o,disableUnusedAttributes:function(){for(var t=0,i=b.length;t!==i;++t)b[t]!==y[t]&&(e.disableVertexAttribArray(t),b[t]=0)},enable:s,disable:a,getCompressedTextureFormats:function(){if(null===x&&(x=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")||t.get("WEBGL_compressed_texture_astc")))for(var i=e.getParameter(34467),n=0;n<i.length;n++)x.push(i[n]);return x},useProgram:function(t){return C!==t&&(e.useProgram(t),C=t,!0)},setBlending:l,setMaterial:function(e,t){2===e.side?a(2884):s(2884);var i=1===e.side;t&&(i=!i),d(i),1===e.blending&&!1===e.transparent?l(0):l(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),f.setFunc(e.depthFunc),f.setTest(e.depthTest),f.setMask(e.depthWrite),m.setMask(e.colorWrite),u(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:d,setCullFace:h,setLineWidth:function(t){t!==P&&(F&&e.lineWidth(t),P=t)},setPolygonOffset:u,setScissorTest:function(e){e?s(3089):a(3089)},activeTexture:p,bindTexture:function(t,i){null===U&&p();var n=B[U];void 0===n&&(B[U]=n={type:void 0,texture:void 0}),n.type===t&&n.texture===i||(e.bindTexture(t,i||V[t]),n.type=t,n.texture=i)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===j.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),j.copy(t))},viewport:function(t){!1===G.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),G.copy(t))},reset:function(){for(var t=0;t<b.length;t++)1===b[t]&&(e.disableVertexAttribArray(t),b[t]=0);w={},U=x=null,B={},O=I=E=C=null,m.reset(),f.reset(),g.reset()}}}function ut(e,t,i,n,r,o,s){function a(e,t){if(e.width>t||e.height>t){if("data"in e)return void console.warn("THREE.WebGLRenderer: image in DataTexture is too big ("+e.width+"x"+e.height+").");t/=Math.max(e.width,e.height);var i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return i.width=Math.floor(e.width*t),i.height=Math.floor(e.height*t),i.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+i.width+"x"+i.height),i}return e}function c(e){return to.isPowerOfTwo(e.width)&&to.isPowerOfTwo(e.height)}function l(e,t){return e.generateMipmaps&&t&&1003!==e.minFilter&&1006!==e.minFilter}function d(t,i,r,o){e.generateMipmap(t),n.get(i).__maxMipLevel=Math.log(Math.max(r,o))*Math.LOG2E}function h(e,t){if(!r.isWebGL2)return e;if(6403===e){if(5126===t)return 33326;if(5131===t)return 33325;if(5121===t)return 33321}if(6407===e){if(5126===t)return 34837;if(5131===t)return 34843;if(5121===t)return 32849}if(6408===e){if(5126===t)return 34836;if(5131===t)return 34842;if(5121===t)return 32856}return e}function u(e){return 1003===e||1004===e||1005===e?9728:9729}function p(t){(t=t.target).removeEventListener("dispose",p);e:{var i=n.get(t);if(t.image&&i.__image__webglTextureCube)e.deleteTexture(i.__image__webglTextureCube);else{if(void 0===i.__webglInit)break e;e.deleteTexture(i.__webglTexture)}n.remove(t)}t.isVideoTexture&&delete w[t.id],s.memory.textures--}function m(t){(t=t.target).removeEventListener("dispose",m);var i=n.get(t),r=n.get(t.texture);if(t){if(void 0!==r.__webglTexture&&e.deleteTexture(r.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLRenderTargetCube)for(r=0;6>r;r++)e.deleteFramebuffer(i.__webglFramebuffer[r]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[r]);else e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer);n.remove(t.texture),n.remove(t)}s.memory.textures--}function f(e,t){var r=n.get(e);if(e.isVideoTexture){var o=e.id,a=s.render.frame;w[o]!==a&&(w[o]=a,e.update())}if(0<e.version&&r.__version!==e.version)if(void 0===(o=e.image))console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==o.complete)return void v(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}i.activeTexture(33984+t),i.bindTexture(3553,r.__webglTexture)}function g(i,s,a){a?(e.texParameteri(i,10242,o.convert(s.wrapS)),e.texParameteri(i,10243,o.convert(s.wrapT)),e.texParameteri(i,10240,o.convert(s.magFilter)),e.texParameteri(i,10241,o.convert(s.minFilter))):(e.texParameteri(i,10242,33071),e.texParameteri(i,10243,33071),1001===s.wrapS&&1001===s.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(i,10240,u(s.magFilter)),e.texParameteri(i,10241,u(s.minFilter)),1003!==s.minFilter&&1006!==s.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!(a=t.get("EXT_texture_filter_anisotropic"))||1015===s.type&&null===t.get("OES_texture_float_linear")||1016===s.type&&null===(r.isWebGL2||t.get("OES_texture_half_float_linear"))||!(1<s.anisotropy||n.get(s).__currentAnisotropy)||(e.texParameterf(i,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}function v(t,n,u){var m=n.isDataTexture3D?32879:3553;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",p),t.__webglTexture=e.createTexture(),s.memory.textures++),i.activeTexture(33984+u),i.bindTexture(m,t.__webglTexture),e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(3317,n.unpackAlignment),u=a(n.image,r.maxTextureSize);var f=!r.isWebGL2&&(1001!==n.wrapS||1001!==n.wrapT||1003!==n.minFilter&&1006!==n.minFilter);f&&!1===c(u)&&(u instanceof HTMLImageElement||u instanceof HTMLCanvasElement||u instanceof ImageBitmap)&&(void 0===_&&(_=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),_.width=to.floorPowerOfTwo(u.width),_.height=to.floorPowerOfTwo(u.height),_.getContext("2d").drawImage(u,0,0,_.width,_.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+u.width+"x"+u.height+"). Resized to "+_.width+"x"+_.height),u=_),f=c(u);var v=o.convert(n.format),y=o.convert(n.type),b=h(v,y);g(m,n,f);var w=n.mipmaps;if(n.isDepthTexture){if(b=6402,1015===n.type){if(!r.isWebGL2)throw Error("Float Depth Texture only supported in WebGL2.0");b=36012}else r.isWebGL2&&(b=33189);1026===n.format&&6402===b&&1012!==n.type&&1014!==n.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=1012,y=o.convert(n.type)),1027===n.format&&(b=34041,1020!==n.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=1020,y=o.convert(n.type))),i.texImage2D(3553,0,b,u.width,u.height,0,v,y,null)}else if(n.isDataTexture)if(0<w.length&&f){for(var x=0,C=w.length;x<C;x++)i.texImage2D(3553,x,b,(m=w[x]).width,m.height,0,v,y,m.data);n.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else i.texImage2D(3553,0,b,u.width,u.height,0,v,y,u.data),t.__maxMipLevel=0;else if(n.isCompressedTexture){for(x=0,C=w.length;x<C;x++)m=w[x],1023!==n.format&&1022!==n.format?-1<i.getCompressedTextureFormats().indexOf(v)?i.compressedTexImage2D(3553,x,b,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,x,b,m.width,m.height,0,v,y,m.data);t.__maxMipLevel=w.length-1}else if(n.isDataTexture3D)i.texImage3D(32879,0,b,u.width,u.height,u.depth,0,v,y,u.data),t.__maxMipLevel=0;else if(0<w.length&&f){for(x=0,C=w.length;x<C;x++)i.texImage2D(3553,x,b,v,y,m=w[x]);n.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else i.texImage2D(3553,0,b,v,y,u),t.__maxMipLevel=0;l(n,f)&&d(3553,n,u.width,u.height),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}function y(t,r,s,a){var c=o.convert(r.texture.format),l=o.convert(r.texture.type),d=h(c,l);i.texImage2D(a,0,d,r.width,r.height,0,c,l,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,s,a,n.get(r.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function b(t,i){e.bindRenderbuffer(36161,t),i.depthBuffer&&!i.stencilBuffer?(e.renderbufferStorage(36161,33189,i.width,i.height),e.framebufferRenderbuffer(36160,36096,36161,t)):i.depthBuffer&&i.stencilBuffer?(e.renderbufferStorage(36161,34041,i.width,i.height),e.framebufferRenderbuffer(36160,33306,36161,t)):e.renderbufferStorage(36161,32854,i.width,i.height),e.bindRenderbuffer(36161,null)}var _,w={};this.setTexture2D=f,this.setTexture3D=function(e,t){var r=n.get(e);0<e.version&&r.__version!==e.version?v(r,e,t):(i.activeTexture(33984+t),i.bindTexture(32879,r.__webglTexture))},this.setTextureCube=function(t,u){var m=n.get(t);if(6===t.image.length)if(0<t.version&&m.__version!==t.version){m.__image__webglTextureCube||(t.addEventListener("dispose",p),m.__image__webglTextureCube=e.createTexture(),s.memory.textures++),i.activeTexture(33984+u),i.bindTexture(34067,m.__image__webglTextureCube),e.pixelStorei(37440,t.flipY),u=t&&t.isCompressedTexture;for(var f=t.image[0]&&t.image[0].isDataTexture,v=[],y=0;6>y;y++)v[y]=u||f?f?t.image[y].image:t.image[y]:a(t.image[y],r.maxCubemapSize);var b=v[0],_=c(b),w=o.convert(t.format),x=o.convert(t.type),C=h(w,x);for(g(34067,t,_),y=0;6>y;y++)if(u)for(var S,E=v[y].mipmaps,M=0,T=E.length;M<T;M++)S=E[M],1023!==t.format&&1022!==t.format?-1<i.getCompressedTextureFormats().indexOf(w)?i.compressedTexImage2D(34069+y,M,C,S.width,S.height,0,S.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+y,M,C,S.width,S.height,0,w,x,S.data);else f?i.texImage2D(34069+y,0,C,v[y].width,v[y].height,0,w,x,v[y].data):i.texImage2D(34069+y,0,C,w,x,v[y]);m.__maxMipLevel=u?E.length-1:0,l(t,_)&&d(34067,t,b.width,b.height),m.__version=t.version,t.onUpdate&&t.onUpdate(t)}else i.activeTexture(33984+u),i.bindTexture(34067,m.__image__webglTextureCube)},this.setTextureCubeDynamic=function(e,t){i.activeTexture(33984+t),i.bindTexture(34067,n.get(e).__webglTexture)},this.setupRenderTarget=function(t){var r=n.get(t),o=n.get(t.texture);t.addEventListener("dispose",m),o.__webglTexture=e.createTexture(),s.memory.textures++;var a=!0===t.isWebGLRenderTargetCube,h=c(t);if(a){r.__webglFramebuffer=[];for(var u=0;6>u;u++)r.__webglFramebuffer[u]=e.createFramebuffer()}else r.__webglFramebuffer=e.createFramebuffer();if(a){for(i.bindTexture(34067,o.__webglTexture),g(34067,t.texture,h),u=0;6>u;u++)y(r.__webglFramebuffer[u],t,36064,34069+u);l(t.texture,h)&&d(34067,t.texture,t.width,t.height),i.bindTexture(34067,null)}else i.bindTexture(3553,o.__webglTexture),g(3553,t.texture,h),y(r.__webglFramebuffer,t,36064,3553),l(t.texture,h)&&d(3553,t.texture,t.width,t.height),i.bindTexture(3553,null);if(t.depthBuffer){if(r=n.get(t),o=!0===t.isWebGLRenderTargetCube,t.depthTexture){if(o)throw Error("target.depthTexture not supported in Cube render targets");if(t&&t.isWebGLRenderTargetCube)throw Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,r.__webglFramebuffer),!t.depthTexture||!t.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");if(n.get(t.depthTexture).__webglTexture&&t.depthTexture.image.width===t.width&&t.depthTexture.image.height===t.height||(t.depthTexture.image.width=t.width,t.depthTexture.image.height=t.height,t.depthTexture.needsUpdate=!0),f(t.depthTexture,0),r=n.get(t.depthTexture).__webglTexture,1026===t.depthTexture.format)e.framebufferTexture2D(36160,36096,3553,r,0);else{if(1027!==t.depthTexture.format)throw Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,r,0)}}else if(o)for(r.__webglDepthbuffer=[],o=0;6>o;o++)e.bindFramebuffer(36160,r.__webglFramebuffer[o]),r.__webglDepthbuffer[o]=e.createRenderbuffer(),b(r.__webglDepthbuffer[o],t);else e.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),b(r.__webglDepthbuffer,t);e.bindFramebuffer(36160,null)}},this.updateRenderTargetMipmap=function(e){var t=e.texture,r=c(e);if(l(t,r)){r=e.isWebGLRenderTargetCube?34067:3553;var o=n.get(t).__webglTexture;i.bindTexture(r,o),d(r,t,e.width,e.height),i.bindTexture(r,null)}}}function pt(e,t,i){return{convert:function(e){if(1e3===e)return 10497;if(1001===e)return 33071;if(1002===e)return 33648;if(1003===e)return 9728;if(1004===e)return 9984;if(1005===e)return 9986;if(1006===e)return 9729;if(1007===e)return 9985;if(1008===e)return 9987;if(1009===e)return 5121;if(1017===e)return 32819;if(1018===e)return 32820;if(1019===e)return 33635;if(1010===e)return 5120;if(1011===e)return 5122;if(1012===e)return 5123;if(1013===e)return 5124;if(1014===e)return 5125;if(1015===e)return 5126;if(1016===e){if(i.isWebGL2)return 5131;var n=t.get("OES_texture_half_float");if(null!==n)return n.HALF_FLOAT_OES}if(1021===e)return 6406;if(1022===e)return 6407;if(1023===e)return 6408;if(1024===e)return 6409;if(1025===e)return 6410;if(1026===e)return 6402;if(1027===e)return 34041;if(1028===e)return 6403;if(100===e)return 32774;if(101===e)return 32778;if(102===e)return 32779;if(200===e)return 0;if(201===e)return 1;if(202===e)return 768;if(203===e)return 769;if(204===e)return 770;if(205===e)return 771;if(206===e)return 772;if(207===e)return 773;if(208===e)return 774;if(209===e)return 775;if(210===e)return 776;if((33776===e||33777===e||33778===e||33779===e)&&null!==(n=t.get("WEBGL_compressed_texture_s3tc"))){if(33776===e)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===e)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===e)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===e)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((35840===e||35841===e||35842===e||35843===e)&&null!==(n=t.get("WEBGL_compressed_texture_pvrtc"))){if(35840===e)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===e)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===e)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===e)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===e&&null!==(n=t.get("WEBGL_compressed_texture_etc1")))return n.COMPRESSED_RGB_ETC1_WEBGL;if((37808===e||37809===e||37810===e||37811===e||37812===e||37813===e||37814===e||37815===e||37816===e||37817===e||37818===e||37819===e||37820===e||37821===e)&&null!==(n=t.get("WEBGL_compressed_texture_astc")))return e;if(103===e||104===e){if(i.isWebGL2){if(103===e)return 32775;if(104===e)return 32776}if(null!==(n=t.get("EXT_blend_minmax"))){if(103===e)return n.MIN_EXT;if(104===e)return n.MAX_EXT}}if(1020===e){if(i.isWebGL2)return 34042;if(null!==(n=t.get("WEBGL_depth_texture")))return n.UNSIGNED_INT_24_8_WEBGL}return 0}}}function mt(){S.call(this),this.type="Group"}function ft(){S.call(this),this.type="Camera",this.matrixWorldInverse=new n,this.projectionMatrix=new n,this.projectionMatrixInverse=new n}function gt(e,t,i,n){ft.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function vt(e){gt.call(this),this.cameras=e||[]}function yt(e,t,i){To.setFromMatrixPosition(t.matrixWorld),Ao.setFromMatrixPosition(i.matrixWorld);var n=To.distanceTo(Ao),r=t.projectionMatrix.elements,o=i.projectionMatrix.elements,s=r[14]/(r[10]-1);i=r[14]/(r[10]+1);var a=(r[9]+1)/r[5],c=(r[9]-1)/r[5],l=(r[8]-1)/r[0],d=(o[8]+1)/o[0];r=s*l,o=s*d,l=(d=n/(-l+d))*-l,t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(l),e.translateZ(d),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld),t=s+d,e.projectionMatrix.makePerspective(r-l,o+(n-l),a*i/(s=i+d)*t,c*i/s*t,t,s)}function bt(e){function t(){return null!==a&&!0===a.isPresenting}function i(){if(t()){var i=a.getEyeParameters("left"),n=i.renderWidth*m;i=i.renderHeight*m,S=e.getPixelRatio(),C=e.getSize(),e.setDrawingBufferSize(2*n,i,1),M.start()}else s.enabled&&e.setDrawingBufferSize(C.width,C.height,S),M.stop()}var s=this,a=null,l=null,d=null,h=[],u=new n,p=new n,m=1,f="stage";"undefined"!=typeof window&&"VRFrameData"in window&&(l=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",i,!1));var g=new n,v=new r,y=new o,_=new gt;_.bounds=new c(0,0,.5,1),_.layers.enable(1);var w=new gt;w.bounds=new c(.5,0,.5,1),w.layers.enable(2);var x=new vt([_,w]);x.layers.enable(1),x.layers.enable(2);var C,S,E=[];this.enabled=!1,this.getController=function(e){var t=h[e];return void 0===t&&((t=new mt).matrixAutoUpdate=!1,t.visible=!1,h[e]=t),t},this.getDevice=function(){return a},this.setDevice=function(e){void 0!==e&&(a=e),M.setContext(e)},this.setFramebufferScaleFactor=function(e){m=e},this.setFrameOfReferenceType=function(e){f=e},this.setPoseTarget=function(e){void 0!==e&&(d=e)},this.getCamera=function(e){var t="stage"===f?1.6:0;if(null===a)return e.position.set(0,t,0),e;if(a.depthNear=e.near,a.depthFar=e.far,a.getFrameData(l),"stage"===f){var i=a.stageParameters;i?u.fromArray(i.sittingToStandingTransform):u.makeTranslation(0,t,0)}if(t=l.pose,(i=null!==d?d:e).matrix.copy(u),i.matrix.decompose(i.position,i.quaternion,i.scale),null!==t.orientation&&(v.fromArray(t.orientation),i.quaternion.multiply(v)),null!==t.position&&(v.setFromRotationMatrix(u),y.fromArray(t.position),y.applyQuaternion(v),i.position.add(y)),i.updateMatrixWorld(),!1===a.isPresenting)return e;_.near=e.near,w.near=e.near,_.far=e.far,w.far=e.far,_.matrixWorldInverse.fromArray(l.leftViewMatrix),w.matrixWorldInverse.fromArray(l.rightViewMatrix),p.getInverse(u),"stage"===f&&(_.matrixWorldInverse.multiply(p),w.matrixWorldInverse.multiply(p)),null!==(e=i.parent)&&(g.getInverse(e.matrixWorld),_.matrixWorldInverse.multiply(g),w.matrixWorldInverse.multiply(g)),_.matrixWorld.getInverse(_.matrixWorldInverse),w.matrixWorld.getInverse(w.matrixWorldInverse),_.projectionMatrix.fromArray(l.leftProjectionMatrix),w.projectionMatrix.fromArray(l.rightProjectionMatrix),yt(x,_,w),(e=a.getLayers()).length&&(null!==(e=e[0]).leftBounds&&4===e.leftBounds.length&&_.bounds.fromArray(e.leftBounds),null!==e.rightBounds&&4===e.rightBounds.length&&w.bounds.fromArray(e.rightBounds));e:for(e=0;e<h.length;e++){t=h[e];t:{i=e;for(var n=navigator.getGamepads&&navigator.getGamepads(),r=0,o=0,s=n.length;r<s;r++){var c=n[r];if(c&&("Daydream Controller"===c.id||"Gear VR Controller"===c.id||"Oculus Go Controller"===c.id||"OpenVR Gamepad"===c.id||c.id.startsWith("Oculus Touch")||c.id.startsWith("Spatial Controller"))){if(o===i){i=c;break t}o++}}i=void 0}if(void 0!==i&&void 0!==i.pose){if(null===i.pose)break e;!1===(n=i.pose).hasPosition&&t.position.set(.2,-.6,-.05),null!==n.position&&t.position.fromArray(n.position),null!==n.orientation&&t.quaternion.fromArray(n.orientation),t.matrix.compose(t.position,t.quaternion,t.scale),t.matrix.premultiply(u),t.matrix.decompose(t.position,t.quaternion,t.scale),t.matrixWorldNeedsUpdate=!0,t.visible=!0,E[e]!==i.buttons[n="Daydream Controller"===i.id?0:1].pressed&&(E[e]=i.buttons[n].pressed,!0===E[e]?t.dispatchEvent({type:"selectstart"}):(t.dispatchEvent({type:"selectend"}),t.dispatchEvent({type:"select"})))}else t.visible=!1}return x},this.getStandingMatrix=function(){return u},this.isPresenting=t;var M=new b;this.setAnimationLoop=function(e){M.setAnimationLoop(e)},this.submitFrame=function(){t()&&a.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",i)}}function _t(e){function t(){return null!==a&&null!==d}function i(e){var t=p[m.indexOf(e.inputSource)];t&&t.dispatchEvent({type:e.type})}function n(){e.setFramebuffer(null),_.stop()}function r(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}var o=e.context,s=null,a=null,l=1,d=null,h="stage",u=null,p=[],m=[],f=new gt;f.layers.enable(1),f.viewport=new c;var g=new gt;g.layers.enable(2),g.viewport=new c;var v=new vt([f,g]);v.layers.enable(1),v.layers.enable(2),this.enabled=!1,this.getController=function(e){var t=p[e];return void 0===t&&((t=new mt).matrixAutoUpdate=!1,t.visible=!1,p[e]=t),t},this.getDevice=function(){return s},this.setDevice=function(e){void 0!==e&&(s=e),e instanceof XRDevice&&o.setCompatibleXRDevice(e)},this.setFramebufferScaleFactor=function(e){l=e},this.setFrameOfReferenceType=function(e){h=e},this.setSession=function(t){null!==(a=t)&&(a.addEventListener("select",i),a.addEventListener("selectstart",i),a.addEventListener("selectend",i),a.addEventListener("end",n),a.baseLayer=new XRWebGLLayer(a,o,{framebufferScaleFactor:l}),a.requestFrameOfReference(h).then(function(t){d=t,e.setFramebuffer(a.baseLayer.framebuffer),_.setContext(a),_.start()}),m=a.getInputSources(),a.addEventListener("inputsourceschange",function(){m=a.getInputSources(),console.log(m);for(var e=0;e<p.length;e++)p[e].userData.inputSource=m[e]}))},this.getCamera=function(e){if(t()){var i=e.parent,n=v.cameras;r(v,i);for(var o=0;o<n.length;o++)r(n[o],i);for(e.matrixWorld.copy(v.matrixWorld),o=0,i=(e=e.children).length;o<i;o++)e[o].updateMatrixWorld(!0);return yt(v,f,g),v}return e},this.isPresenting=t;var y=null,_=new b;_.setAnimationLoop(function(e,t){if(null!==(u=t.getDevicePose(d)))for(var i=a.baseLayer,n=t.views,r=0;r<n.length;r++){var o=n[r],s=i.getViewport(o),c=u.getViewMatrix(o),l=v.cameras[r];l.matrix.fromArray(c).getInverse(l.matrix),l.projectionMatrix.fromArray(o.projectionMatrix),l.viewport.set(s.x,s.y,s.width,s.height),0===r&&v.matrix.copy(l.matrix)}for(r=0;r<p.length;r++)i=p[r],(n=m[r])&&null!==(n=t.getInputPose(n,d))?("targetRay"in n?i.matrix.elements=n.targetRay.transformMatrix:"pointerMatrix"in n&&(i.matrix.elements=n.pointerMatrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.visible=!0):i.visible=!1;y&&y(e)}),this.setAnimationLoop=function(e){y=e},this.dispose=function(){},this.getStandingMatrix=function(){return console.warn("THREE.WebXRManager: getStandingMatrix() is no longer needed."),new THREE.Matrix4},this.submitFrame=function(){}}function wt(e){var t;function i(){I=new ee(Le),(O=new J(Le,I,e)).isWebGL2||(I.get("WEBGL_depth_texture"),I.get("OES_texture_float"),I.get("OES_texture_half_float"),I.get("OES_texture_half_float_linear"),I.get("OES_standard_derivatives"),I.get("OES_element_index_uint"),I.get("ANGLE_instanced_arrays")),I.get("OES_texture_float_linear"),X=new pt(Le,I,O),(P=new ht(Le,I,X,O)).scissor(ve.copy(Se).multiplyScalar(xe)),P.viewport(ge.copy(Ce).multiplyScalar(xe)),H=new ne(Le),N=new Qe,z=new ut(Le,I,P,N,O,X,H),F=new _(Le),U=new te(Le,F,H),B=new se(U,H),W=new oe(Le),j=new Je(re,I,O),G=new nt,V=new at,$=new Z(re,P,B,A),q=new K(Le,I,H,O),Y=new ie(Le,I,H,O),H.programs=j.programs,re.context=Le,re.capabilities=O,re.extensions=I,re.properties=N,re.renderLists=G,re.state=P,re.info=H}function r(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),ae=!0}function s(){console.log("THREE.WebGLRenderer: Context Restored."),ae=!1,i()}function a(e){(e=e.target).removeEventListener("dispose",a),l(e),N.remove(e)}function l(e){var t=N.get(e).program;e.program=void 0,void 0!==t&&j.releaseProgram(t)}function d(e,t,i,n){for(var r=0,o=e.length;r<o;r++){var s=e[r],a=s.object,c=s.geometry,l=void 0===n?s.material:n;if(s=s.group,i.isArrayCamera){fe=i;for(var d=i.cameras,h=0,p=d.length;h<p;h++){var m=d[h];if(a.layers.test(m.layers)){if("viewport"in m)P.viewport(ge.copy(m.viewport));else{var f=m.bounds;P.viewport(ge.set(f.x*_e,f.y*we,f.z*_e,f.w*we).multiplyScalar(xe))}L.setupLights(m),u(a,t,m,c,l,s)}}}else fe=null,u(a,t,i,c,l,s)}}function u(e,i,n,r,o,s){if(e.onBeforeRender(re,i,n,r,o,s),L=V.get(i,fe||n),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){P.setMaterial(o);var a=m(n,i.fog,o,e);ue=t=null,pe=!1,function(e,t){e.render(function(e){re.renderBufferImmediate(e,t)})}(e,a)}else re.renderBufferDirect(n,i.fog,r,o,e,s);e.onAfterRender(re,i,n,r,o,s),L=V.get(i,fe||n)}function p(e,t,i){var n=N.get(e),r=L.state.lights,o=n.lightsHash,s=r.state.hash;i=j.getParameters(e,r.state,L.state.shadowsArray,t,Te.numPlanes,Te.numIntersection,i);var c=j.getProgramCode(e,i),d=n.program,h=!0;if(void 0===d)e.addEventListener("dispose",a);else if(d.code!==c)l(e);else{if(o.stateID!==s.stateID||o.directionalLength!==s.directionalLength||o.pointLength!==s.pointLength||o.spotLength!==s.spotLength||o.rectAreaLength!==s.rectAreaLength||o.hemiLength!==s.hemiLength||o.shadowsLength!==s.shadowsLength)o.stateID=s.stateID,o.directionalLength=s.directionalLength,o.pointLength=s.pointLength,o.spotLength=s.spotLength,o.rectAreaLength=s.rectAreaLength,o.hemiLength=s.hemiLength,o.shadowsLength=s.shadowsLength;else if(void 0!==i.shaderID)return;h=!1}if(h&&(n.shader=i.shaderID?{name:e.type,uniforms:g((c=lo[i.shaderID]).uniforms),vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}:{name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader},e.onBeforeCompile(n.shader,re),c=j.getProgramCode(e,i),d=j.acquireProgram(e,n.shader,i,c),n.program=d,e.program=d),i=d.getAttributes(),e.morphTargets)for(c=e.numSupportedMorphTargets=0;c<re.maxMorphTargets;c++)0<=i["morphTarget"+c]&&e.numSupportedMorphTargets++;if(e.morphNormals)for(c=e.numSupportedMorphNormals=0;c<re.maxMorphNormals;c++)0<=i["morphNormal"+c]&&e.numSupportedMorphNormals++;i=n.shader.uniforms,(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(n.numClippingPlanes=Te.numPlanes,n.numIntersection=Te.numIntersection,i.clippingPlanes=Te.uniform),n.fog=t,void 0===o&&(n.lightsHash=o={}),o.stateID=s.stateID,o.directionalLength=s.directionalLength,o.pointLength=s.pointLength,o.spotLength=s.spotLength,o.rectAreaLength=s.rectAreaLength,o.hemiLength=s.hemiLength,o.shadowsLength=s.shadowsLength,e.lights&&(i.ambientLightColor.value=r.state.ambient,i.directionalLights.value=r.state.directional,i.spotLights.value=r.state.spot,i.rectAreaLights.value=r.state.rectArea,i.pointLights.value=r.state.point,i.hemisphereLights.value=r.state.hemi,i.directionalShadowMap.value=r.state.directionalShadowMap,i.directionalShadowMatrix.value=r.state.directionalShadowMatrix,i.spotShadowMap.value=r.state.spotShadowMap,i.spotShadowMatrix.value=r.state.spotShadowMatrix,i.pointShadowMap.value=r.state.pointShadowMap,i.pointShadowMatrix.value=r.state.pointShadowMatrix),e=n.program.getUniforms(),e=Ue.seqWithValue(e.seq,i),n.uniformsList=e}function m(e,t,i,n){be=0;var r=N.get(i),o=r.lightsHash,s=L.state.lights.state.hash;Ae&&(ke||e!==me)&&Te.setState(i.clippingPlanes,i.clipIntersection,i.clipShadows,e,r,e===me&&i.id===he),!1===i.needsUpdate&&(void 0===r.program?i.needsUpdate=!0:i.fog&&r.fog!==t?i.needsUpdate=!0:(!i.lights||o.stateID===s.stateID&&o.directionalLength===s.directionalLength&&o.pointLength===s.pointLength&&o.spotLength===s.spotLength&&o.rectAreaLength===s.rectAreaLength&&o.hemiLength===s.hemiLength&&o.shadowsLength===s.shadowsLength)&&(void 0===r.numClippingPlanes||r.numClippingPlanes===Te.numPlanes&&r.numIntersection===Te.numIntersection)||(i.needsUpdate=!0)),i.needsUpdate&&(p(i,t,n),i.needsUpdate=!1);var a=!1,c=!1,l=!1;s=(o=r.program).getUniforms();var d=r.shader.uniforms;if(P.useProgram(o.program)&&(l=c=a=!0),i.id!==he&&(he=i.id,c=!0),(a||me!==e)&&(s.setValue(Le,"projectionMatrix",e.projectionMatrix),O.logarithmicDepthBuffer&&s.setValue(Le,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),me!==e&&(me=e,l=c=!0),(i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.envMap)&&void 0!==(a=s.map.cameraPosition)&&a.setValue(Le,De.setFromMatrixPosition(e.matrixWorld)),(i.isMeshPhongMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.skinning)&&s.setValue(Le,"viewMatrix",e.matrixWorldInverse)),i.skinning&&(s.setOptional(Le,n,"bindMatrix"),s.setOptional(Le,n,"bindMatrixInverse"),e=n.skeleton))if(a=e.bones,O.floatVertexTextures){if(void 0===e.boneTexture){a=Math.sqrt(4*a.length),a=to.ceilPowerOfTwo(a),a=Math.max(a,4);var u=new Float32Array(a*a*4);u.set(e.boneMatrices);var m=new h(u,a,a,1023,1015);m.needsUpdate=!0,e.boneMatrices=u,e.boneTexture=m,e.boneTextureSize=a}s.setValue(Le,"boneTexture",e.boneTexture),s.setValue(Le,"boneTextureSize",e.boneTextureSize)}else s.setOptional(Le,e,"boneMatrices");return c&&(s.setValue(Le,"toneMappingExposure",re.toneMappingExposure),s.setValue(Le,"toneMappingWhitePoint",re.toneMappingWhitePoint),i.lights&&(d.ambientLightColor.needsUpdate=c=l,d.directionalLights.needsUpdate=c,d.pointLights.needsUpdate=c,d.spotLights.needsUpdate=c,d.rectAreaLights.needsUpdate=c,d.hemisphereLights.needsUpdate=c),t&&i.fog&&(d.fogColor.value=t.color,t.isFog?(d.fogNear.value=t.near,d.fogFar.value=t.far):t.isFogExp2&&(d.fogDensity.value=t.density)),i.isMeshBasicMaterial?v(d,i):i.isMeshLambertMaterial?(v(d,i),i.emissiveMap&&(d.emissiveMap.value=i.emissiveMap)):i.isMeshPhongMaterial?(v(d,i),i.isMeshToonMaterial?(y(d,i),i.gradientMap&&(d.gradientMap.value=i.gradientMap)):y(d,i)):i.isMeshStandardMaterial?(v(d,i),i.isMeshPhysicalMaterial?(w(d,i),d.reflectivity.value=i.reflectivity,d.clearCoat.value=i.clearCoat,d.clearCoatRoughness.value=i.clearCoatRoughness):w(d,i)):i.isMeshMatcapMaterial?(v(d,i),i.matcap&&(d.matcap.value=i.matcap),i.bumpMap&&(d.bumpMap.value=i.bumpMap,d.bumpScale.value=i.bumpScale,1===i.side&&(d.bumpScale.value*=-1)),i.normalMap&&(d.normalMap.value=i.normalMap,d.normalScale.value.copy(i.normalScale),1===i.side&&d.normalScale.value.negate()),i.displacementMap&&(d.displacementMap.value=i.displacementMap,d.displacementScale.value=i.displacementScale,d.displacementBias.value=i.displacementBias)):i.isMeshDepthMaterial?(v(d,i),i.displacementMap&&(d.displacementMap.value=i.displacementMap,d.displacementScale.value=i.displacementScale,d.displacementBias.value=i.displacementBias)):i.isMeshDistanceMaterial?(v(d,i),i.displacementMap&&(d.displacementMap.value=i.displacementMap,d.displacementScale.value=i.displacementScale,d.displacementBias.value=i.displacementBias),d.referencePosition.value.copy(i.referencePosition),d.nearDistance.value=i.nearDistance,d.farDistance.value=i.farDistance):i.isMeshNormalMaterial?(v(d,i),i.bumpMap&&(d.bumpMap.value=i.bumpMap,d.bumpScale.value=i.bumpScale,1===i.side&&(d.bumpScale.value*=-1)),i.normalMap&&(d.normalMap.value=i.normalMap,d.normalScale.value.copy(i.normalScale),1===i.side&&d.normalScale.value.negate()),i.displacementMap&&(d.displacementMap.value=i.displacementMap,d.displacementScale.value=i.displacementScale,d.displacementBias.value=i.displacementBias)):i.isLineBasicMaterial?(d.diffuse.value=i.color,d.opacity.value=i.opacity,i.isLineDashedMaterial&&(d.dashSize.value=i.dashSize,d.totalSize.value=i.dashSize+i.gapSize,d.scale.value=i.scale)):i.isPointsMaterial?(d.diffuse.value=i.color,d.opacity.value=i.opacity,d.size.value=i.size*xe,d.scale.value=.5*we,d.map.value=i.map,null!==i.map&&(!0===i.map.matrixAutoUpdate&&i.map.updateMatrix(),d.uvTransform.value.copy(i.map.matrix))):i.isSpriteMaterial?(d.diffuse.value=i.color,d.opacity.value=i.opacity,d.rotation.value=i.rotation,d.map.value=i.map,null!==i.map&&(!0===i.map.matrixAutoUpdate&&i.map.updateMatrix(),d.uvTransform.value.copy(i.map.matrix))):i.isShadowMaterial&&(d.color.value=i.color,d.opacity.value=i.opacity),void 0!==d.ltc_1&&(d.ltc_1.value=co.LTC_1),void 0!==d.ltc_2&&(d.ltc_2.value=co.LTC_2),Ue.upload(Le,r.uniformsList,d,re)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(Ue.upload(Le,r.uniformsList,d,re),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&s.setValue(Le,"center",n.center),s.setValue(Le,"modelViewMatrix",n.modelViewMatrix),s.setValue(Le,"normalMatrix",n.normalMatrix),s.setValue(Le,"modelMatrix",n.matrixWorld),o}function v(e,t){if(e.opacity.value=t.opacity,t.color&&(e.diffuse.value=t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=N.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map)var i=t.map;else t.specularMap?i=t.specularMap:t.displacementMap?i=t.displacementMap:t.normalMap?i=t.normalMap:t.bumpMap?i=t.bumpMap:t.roughnessMap?i=t.roughnessMap:t.metalnessMap?i=t.metalnessMap:t.alphaMap?i=t.alphaMap:t.emissiveMap&&(i=t.emissiveMap);void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}function y(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function w(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}console.log("THREE.WebGLRenderer","99");var x=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),C=void 0!==e.context?e.context:null,S=void 0!==e.alpha&&e.alpha,E=void 0===e.depth||e.depth,M=void 0===e.stencil||e.stencil,T=void 0!==e.antialias&&e.antialias,A=void 0===e.premultipliedAlpha||e.premultipliedAlpha,k=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,R=void 0!==e.powerPreference?e.powerPreference:"default",D=null,L=null;this.domElement=x,this.context=null,this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=!1,this.toneMappingWhitePoint=this.toneMappingExposure=this.toneMapping=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var I,O,P,H,N,z,F,U,B,j,G,V,$,W,q,Y,X,re=this,ae=!1,ce=null,le=null,de=null,he=-1,ue=t=null,pe=!1,me=null,fe=null,ge=new c,ve=new c,ye=null,be=0,_e=x.width,we=x.height,xe=1,Ce=new c(0,0,_e,we),Se=new c(0,0,_e,we),Ee=!1,Me=new f,Te=new Q,Ae=!1,ke=!1,Re=new n,De=new o;try{S={alpha:S,depth:E,stencil:M,antialias:T,premultipliedAlpha:A,preserveDrawingBuffer:k,powerPreference:R},x.addEventListener("webglcontextlost",r,!1),x.addEventListener("webglcontextrestored",s,!1);var Le=C||x.getContext("webgl",S)||x.getContext("experimental-webgl",S);if(null===Le){if(null!==x.getContext("webgl"))throw Error("Error creating WebGL context with your selected attributes.");throw Error("Error creating WebGL context.")}void 0===Le.getShaderPrecisionFormat&&(Le.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Ne){console.error("THREE.WebGLRenderer: "+Ne.message)}i();var Ie=null;"undefined"!=typeof navigator&&(Ie="xr"in navigator?new _t(re):new bt(re)),this.vr=Ie;var Oe=new dt(re,B,O.maxTextureSize);this.shadowMap=Oe,this.getContext=function(){return Le},this.getContextAttributes=function(){return Le.getContextAttributes()},this.forceContextLoss=function(){var e=I.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=I.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return xe},this.setPixelRatio=function(e){void 0!==e&&(xe=e,this.setSize(_e,we,!1))},this.getSize=function(){return{width:_e,height:we}},this.setSize=function(e,t,i){Ie.isPresenting()?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(_e=e,we=t,x.width=e*xe,x.height=t*xe,!1!==i&&(x.style.width=e+"px",x.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(){return{width:_e*xe,height:we*xe}},this.setDrawingBufferSize=function(e,t,i){_e=e,we=t,xe=i,x.width=e*i,x.height=t*i,this.setViewport(0,0,e,t)},this.getCurrentViewport=function(){return ge},this.setViewport=function(e,t,i,n){Ce.set(e,we-t-n,i,n),P.viewport(ge.copy(Ce).multiplyScalar(xe))},this.setScissor=function(e,t,i,n){Se.set(e,we-t-n,i,n),P.scissor(ve.copy(Se).multiplyScalar(xe))},this.setScissorTest=function(e){P.setScissorTest(Ee=e)},this.getClearColor=function(){return $.getClearColor()},this.setClearColor=function(){$.setClearColor.apply($,arguments)},this.getClearAlpha=function(){return $.getClearAlpha()},this.setClearAlpha=function(){$.setClearAlpha.apply($,arguments)},this.clear=function(e,t,i){var n=0;(void 0===e||e)&&(n|=16384),(void 0===t||t)&&(n|=256),(void 0===i||i)&&(n|=1024),Le.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){x.removeEventListener("webglcontextlost",r,!1),x.removeEventListener("webglcontextrestored",s,!1),G.dispose(),V.dispose(),N.dispose(),B.dispose(),Ie.dispose(),He.stop()},this.renderBufferImmediate=function(e,t){P.initAttributes();var i=N.get(e);e.hasPositions&&!i.position&&(i.position=Le.createBuffer()),e.hasNormals&&!i.normal&&(i.normal=Le.createBuffer()),e.hasUvs&&!i.uv&&(i.uv=Le.createBuffer()),e.hasColors&&!i.color&&(i.color=Le.createBuffer()),t=t.getAttributes(),e.hasPositions&&(Le.bindBuffer(34962,i.position),Le.bufferData(34962,e.positionArray,35048),P.enableAttribute(t.position),Le.vertexAttribPointer(t.position,3,5126,!1,0,0)),e.hasNormals&&(Le.bindBuffer(34962,i.normal),Le.bufferData(34962,e.normalArray,35048),P.enableAttribute(t.normal),Le.vertexAttribPointer(t.normal,3,5126,!1,0,0)),e.hasUvs&&(Le.bindBuffer(34962,i.uv),Le.bufferData(34962,e.uvArray,35048),P.enableAttribute(t.uv),Le.vertexAttribPointer(t.uv,2,5126,!1,0,0)),e.hasColors&&(Le.bindBuffer(34962,i.color),Le.bufferData(34962,e.colorArray,35048),P.enableAttribute(t.color),Le.vertexAttribPointer(t.color,3,5126,!1,0,0)),P.disableUnusedAttributes(),Le.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,i,n,r,o,s){var a=o.isMesh&&0>o.normalMatrix.determinant();P.setMaterial(r,a);var c=m(e,i,r,o),l=!1;t===n.id&&ue===c.id&&pe===(!0===r.wireframe)||(t=n.id,ue=c.id,pe=!0===r.wireframe,l=!0),o.morphTargetInfluences&&(W.update(o,n,r,c),l=!0),a=n.index;var d=n.attributes.position;if(i=1,!0===r.wireframe&&(a=U.getWireframeAttribute(n),i=2),e=q,null!==a){var h=F.get(a);(e=Y).setIndex(h)}if(l){if(n&&n.isInstancedBufferGeometry&!O.isWebGL2&&null===I.get("ANGLE_instanced_arrays"))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{P.initAttributes(),l=n.attributes,c=c.getAttributes();var u=r.defaultAttributeValues;for(C in c){var p=c[C];if(0<=p){var f=l[C];if(void 0!==f){var g=f.normalized,v=f.itemSize,y=F.get(f);if(void 0!==y){var b=y.buffer,_=y.type;if(y=y.bytesPerElement,f.isInterleavedBufferAttribute){var w=f.data,x=w.stride;f=f.offset,w&&w.isInstancedInterleavedBuffer?(P.enableAttributeAndDivisor(p,w.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=w.meshPerAttribute*w.count)):P.enableAttribute(p),Le.bindBuffer(34962,b),Le.vertexAttribPointer(p,v,_,g,x*y,f*y)}else f.isInstancedBufferAttribute?(P.enableAttributeAndDivisor(p,f.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=f.meshPerAttribute*f.count)):P.enableAttribute(p),Le.bindBuffer(34962,b),Le.vertexAttribPointer(p,v,_,g,0,0)}}else if(void 0!==u&&void 0!==(g=u[C]))switch(g.length){case 2:Le.vertexAttrib2fv(p,g);break;case 3:Le.vertexAttrib3fv(p,g);break;case 4:Le.vertexAttrib4fv(p,g);break;default:Le.vertexAttrib1fv(p,g)}}}P.disableUnusedAttributes()}null!==a&&Le.bindBuffer(34963,h.buffer)}h=1/0,null!==a?h=a.count:void 0!==d&&(h=d.count),a=n.drawRange.start*i,d=null!==s?s.start*i:0;var C=Math.max(a,d);if(0!==(s=Math.max(0,Math.min(h,a+n.drawRange.count*i,d+(null!==s?s.count*i:1/0))-1-C+1))){if(o.isMesh)if(!0===r.wireframe)P.setLineWidth(r.wireframeLinewidth*(null===le?xe:1)),e.setMode(1);else switch(o.drawMode){case 0:e.setMode(4);break;case 1:e.setMode(5);break;case 2:e.setMode(6)}else o.isLine?(void 0===(r=r.linewidth)&&(r=1),P.setLineWidth(r*(null===le?xe:1)),e.setMode(o.isLineSegments?1:o.isLineLoop?2:3)):o.isPoints?e.setMode(0):o.isSprite&&e.setMode(4);n&&n.isInstancedBufferGeometry?0<n.maxInstancedCount&&e.renderInstances(n,C,s):e.render(C,s)}},this.compile=function(e,t){(L=V.get(e,t)).init(),e.traverse(function(e){e.isLight&&(L.pushLight(e),e.castShadow&&L.pushShadow(e))}),L.setupLights(t),e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var i=0;i<t.material.length;i++)p(t.material[i],e.fog,t);else p(t.material,e.fog,t)})};var Pe=null,He=new b;He.setAnimationLoop(function(e){Ie.isPresenting()||Pe&&Pe(e)}),"undefined"!=typeof window&&He.setContext(window),this.setAnimationLoop=function(e){Pe=e,Ie.setAnimationLoop(e),He.start()},this.render=function(e,i,n,r){if(i&&i.isCamera){if(!ae){ue=t=null,pe=!1,he=-1,me=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===i.parent&&i.updateMatrixWorld(),Ie.enabled&&(i=Ie.getCamera(i)),(L=V.get(e,i)).init(),e.onBeforeRender(re,e,i,n),Re.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),Me.setFromMatrix(Re),Ae=Te.init(this.clippingPlanes,ke=this.localClippingEnabled,i),(D=G.get(e,i)).init(),function e(t,i,n){if(!1!==t.visible){if(t.layers.test(i.layers))if(t.isLight)L.pushLight(t),t.castShadow&&L.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||Me.intersectsSprite(t)){n&&De.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Re);var r=B.update(t),o=t.material;D.push(t,r,o,De.z,null)}}else if(t.isImmediateRenderObject)n&&De.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Re),D.push(t,null,t.material,De.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.update(),!t.frustumCulled||Me.intersectsObject(t)))if(n&&De.setFromMatrixPosition(t.matrixWorld).applyMatrix4(Re),r=B.update(t),o=t.material,Array.isArray(o))for(var s=r.groups,a=0,c=s.length;a<c;a++){var l=s[a],d=o[l.materialIndex];d&&d.visible&&D.push(t,r,d,De.z,l)}else o.visible&&D.push(t,r,o,De.z,null);for(a=0,c=(t=t.children).length;a<c;a++)e(t[a],i,n)}}(e,i,re.sortObjects),!0===re.sortObjects&&D.sort(),Ae&&Te.beginShadows(),Oe.render(L.state.shadowsArray,e,i),L.setupLights(i),Ae&&Te.endShadows(),this.info.autoReset&&this.info.reset(),void 0===n&&(n=null),this.setRenderTarget(n),$.render(D,e,i,r),r=D.opaque;var o=D.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;r.length&&d(r,e,i,s),o.length&&d(o,e,i,s)}else r.length&&d(r,e,i),o.length&&d(o,e,i);n&&z.updateRenderTargetMipmap(n),P.buffers.depth.setTest(!0),P.buffers.depth.setMask(!0),P.buffers.color.setMask(!0),P.setPolygonOffset(!1),e.onAfterRender(re,e,i),Ie.enabled&&Ie.submitFrame(),L=D=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.allocTextureUnit=function(){var e=be;return e>=O.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+e+" texture units while this GPU supports only "+O.maxTextures),be+=1,e},this.setTexture2D=function(){var e=!1;return function(t,i){t&&t.isWebGLRenderTarget&&(e||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),z.setTexture2D(t,i)}}(),this.setTexture3D=function(e,t){z.setTexture3D(e,t)},this.setTexture=function(){var e=!1;return function(t,i){e||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),e=!0),z.setTexture2D(t,i)}}(),this.setTextureCube=function(){var e=!1;return function(t,i){t&&t.isWebGLRenderTargetCube&&(e||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?z.setTextureCube(t,i):z.setTextureCubeDynamic(t,i)}}(),this.setFramebuffer=function(e){ce=e},this.getRenderTarget=function(){return le},this.setRenderTarget=function(e){(le=e)&&void 0===N.get(e).__webglFramebuffer&&z.setupRenderTarget(e);var t=ce,i=!1;e?(t=N.get(e).__webglFramebuffer,e.isWebGLRenderTargetCube&&(t=t[e.activeCubeFace],i=!0),ge.copy(e.viewport),ve.copy(e.scissor),ye=e.scissorTest):(ge.copy(Ce).multiplyScalar(xe),ve.copy(Se).multiplyScalar(xe),ye=Ee),de!==t&&(Le.bindFramebuffer(36160,t),de=t),P.viewport(ge),P.scissor(ve),P.setScissorTest(ye),i&&(i=N.get(e.texture),Le.framebufferTexture2D(36160,36064,34069+e.activeCubeFace,i.__webglTexture,e.activeMipMapLevel))},this.readRenderTargetPixels=function(e,t,i,n,r,o){if(e&&e.isWebGLRenderTarget){var s=N.get(e).__webglFramebuffer;if(s){var a=!1;s!==de&&(Le.bindFramebuffer(36160,s),a=!0);try{var c=e.texture,l=c.format,d=c.type;1023!==l&&X.convert(l)!==Le.getParameter(35739)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):1009===d||X.convert(d)===Le.getParameter(35738)||1015===d&&(O.isWebGL2||I.get("OES_texture_float")||I.get("WEBGL_color_buffer_float"))||1016===d&&I.get(O.isWebGL2?"EXT_color_buffer_float":"EXT_color_buffer_half_float")?36053===Le.checkFramebufferStatus(36160)?0<=t&&t<=e.width-n&&0<=i&&i<=e.height-r&&Le.readPixels(t,i,n,r,X.convert(l),X.convert(d),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{a&&Le.bindFramebuffer(36160,de)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,i){var n=t.image.width,r=t.image.height,o=X.convert(t.format);this.setTexture2D(t,0),Le.copyTexImage2D(3553,i||0,o,e.x,e.y,n,r,0)},this.copyTextureToTexture=function(e,t,i,n){var r=t.image.width,o=t.image.height,s=X.convert(i.format),a=X.convert(i.type);this.setTexture2D(i,0),t.isDataTexture?Le.texSubImage2D(3553,n||0,e.x,e.y,r,o,s,a,t.image.data):Le.texSubImage2D(3553,n||0,e.x,e.y,s,a,t.image)}}function xt(e,t){this.name="",this.color=new y(e),this.density=void 0!==t?t:25e-5}function Ct(e,t,i){this.name="",this.color=new y(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3}function St(){S.call(this),this.type="Scene",this.overrideMaterial=this.fog=this.background=null,this.autoUpdate=!0}function Et(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function Mt(e,t,i,n){this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===n}function Tt(e){V.call(this),this.type="SpriteMaterial",this.color=new y(16777215),this.map=null,this.rotation=0,this.sizeAttenuation=!0,this.lights=!1,this.transparent=!0,this.setValues(e)}function At(e){if(S.call(this),this.type="Sprite",void 0===Mo){Mo=new F;var t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]);t=new Et(t,5),Mo.setIndex([0,1,2,0,2,3]),Mo.addAttribute("position",new Mt(t,3,0,!1)),Mo.addAttribute("uv",new Mt(t,2,3,!1))}this.geometry=Mo,this.material=void 0!==e?e:new Tt,this.center=new i(.5,.5)}function kt(){S.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function Rt(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),X.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new n,this.bindMatrixInverse=new n}function Dt(e,t){if(this.bones=(e=e||[]).slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else for(console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[],e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new n)}function Lt(){S.call(this),this.type="Bone"}function It(e){V.call(this),this.type="LineBasicMaterial",this.color=new y(16777215),this.linewidth=1,this.linejoin=this.linecap="round",this.lights=!1,this.setValues(e)}function Ot(e,t,i){1===i&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),S.call(this),this.type="Line",this.geometry=void 0!==e?e:new F,this.material=void 0!==t?t:new It({color:16777215*Math.random()})}function Pt(e,t){Ot.call(this,e,t),this.type="LineSegments"}function Ht(e,t){Ot.call(this,e,t),this.type="LineLoop"}function Nt(e){V.call(this),this.type="PointsMaterial",this.color=new y(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=this.morphTargets=!1,this.setValues(e)}function zt(e,t){S.call(this),this.type="Points",this.geometry=void 0!==e?e:new F,this.material=void 0!==t?t:new Nt({color:16777215*Math.random()})}function Ft(e,t,i,n,r,o,s,c,l){a.call(this,e,t,i,n,r,o,s,c,l),this.format=void 0!==s?s:1022,this.minFilter=void 0!==o?o:1006,this.magFilter=void 0!==r?r:1006,this.generateMipmaps=!1}function Ut(e,t,i,n,r,o,s,c,l,d,h,u){a.call(this,null,o,s,c,l,d,n,r,h,u),this.image={width:t,height:i},this.mipmaps=e,this.generateMipmaps=this.flipY=!1}function Bt(e,t,i,n,r,o,s,c,l){a.call(this,e,t,i,n,r,o,s,c,l),this.needsUpdate=!0}function jt(e,t,i,n,r,o,s,c,l,d){if(1026!==(d=void 0!==d?d:1026)&&1027!==d)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&1026===d&&(i=1012),void 0===i&&1027===d&&(i=1020),a.call(this,null,n,r,o,s,c,d,i,l),this.image={width:e,height:t},this.magFilter=void 0!==s?s:1003,this.minFilter=void 0!==c?c:1003,this.generateMipmaps=this.flipY=!1}function Gt(e){F.call(this),this.type="WireframeGeometry";var t,i,n,r=[],s=[0,0],a={},c=["a","b","c"];if(e&&e.isGeometry){var l=e.faces,d=0;for(i=l.length;d<i;d++){var h=l[d];for(t=0;3>t;t++){var u=h[c[t]],p=h[c[(t+1)%3]];s[0]=Math.min(u,p),s[1]=Math.max(u,p),void 0===a[u=s[0]+","+s[1]]&&(a[u]={index1:s[0],index2:s[1]})}}for(u in a)r.push((c=e.vertices[(d=a[u]).index1]).x,c.y,c.z),r.push((c=e.vertices[d.index2]).x,c.y,c.z)}else if(e&&e.isBufferGeometry)if(c=new o,null!==e.index){l=e.attributes.position,h=e.index;var m=e.groups;for(0===m.length&&(m=[{start:0,count:h.count,materialIndex:0}]),e=0,n=m.length;e<n;++e)for(i=(d=m[e]).count,d=t=d.start,i=t+i;d<i;d+=3)for(t=0;3>t;t++)u=h.getX(d+t),p=h.getX(d+(t+1)%3),s[0]=Math.min(u,p),s[1]=Math.max(u,p),void 0===a[u=s[0]+","+s[1]]&&(a[u]={index1:s[0],index2:s[1]});for(u in a)c.fromBufferAttribute(l,(d=a[u]).index1),r.push(c.x,c.y,c.z),c.fromBufferAttribute(l,d.index2),r.push(c.x,c.y,c.z)}else for(d=0,i=(l=e.attributes.position).count/3;d<i;d++)for(t=0;3>t;t++)c.fromBufferAttribute(l,a=3*d+t),r.push(c.x,c.y,c.z),c.fromBufferAttribute(l,a=3*d+(t+1)%3),r.push(c.x,c.y,c.z);this.addAttribute("position",new P(r,3))}function Vt(e,t,i){E.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i},this.fromBufferGeometry(new $t(e,t,i)),this.mergeVertices()}function $t(e,t,i){F.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:i};var n,r,s=[],a=[],c=[],l=[],d=new o,h=new o,u=new o,p=new o,m=new o;3>e.length&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var f=t+1;for(n=0;n<=i;n++){var g=n/i;for(r=0;r<=t;r++){var v=r/t;e(v,g,h),a.push(h.x,h.y,h.z),0<=v-1e-5?(e(v-1e-5,g,u),p.subVectors(h,u)):(e(v+1e-5,g,u),p.subVectors(u,h)),0<=g-1e-5?(e(v,g-1e-5,u),m.subVectors(h,u)):(e(v,g+1e-5,u),m.subVectors(u,h)),d.crossVectors(p,m).normalize(),c.push(d.x,d.y,d.z),l.push(v,g)}}for(n=0;n<i;n++)for(r=0;r<t;r++)d=(n+1)*f+r+1,s.push(n*f+r,e=n*f+r+1,h=(n+1)*f+r),s.push(e,d,h);this.setIndex(s),this.addAttribute("position",new P(a,3)),this.addAttribute("normal",new P(c,3)),this.addAttribute("uv",new P(l,2))}function Wt(e,t,i,n){E.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n},this.fromBufferGeometry(new qt(e,t,i,n)),this.mergeVertices()}function qt(e,t,n,r){function s(e){l.push(e.x,e.y,e.z)}function a(t,i){i.x=e[0+(t*=3)],i.y=e[t+1],i.z=e[t+2]}function c(e,t,i,n){0>n&&1===e.x&&(d[t]=e.x-1),0===i.x&&0===i.z&&(d[t]=n/2/Math.PI+.5)}F.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r},n=n||1;var l=[],d=[];!function(e){for(var i=new o,n=new o,r=new o,c=0;c<t.length;c+=3){a(t[c+0],i),a(t[c+1],n),a(t[c+2],r);var l,d,h=i,u=n,p=r,m=Math.pow(2,e),f=[];for(d=0;d<=m;d++){f[d]=[];var g=h.clone().lerp(p,d/m),v=u.clone().lerp(p,d/m),y=m-d;for(l=0;l<=y;l++)f[d][l]=0===l&&d===m?g:g.clone().lerp(v,l/y)}for(d=0;d<m;d++)for(l=0;l<2*(m-d)-1;l++)h=Math.floor(l/2),0==l%2?(s(f[d][h+1]),s(f[d+1][h]),s(f[d][h])):(s(f[d][h+1]),s(f[d+1][h+1]),s(f[d+1][h]))}}(r=r||0),function(e){for(var t=new o,i=0;i<l.length;i+=3)t.x=l[i+0],t.y=l[i+1],t.z=l[i+2],t.normalize().multiplyScalar(e),l[i+0]=t.x,l[i+1]=t.y,l[i+2]=t.z}(n),function(){for(var e=new o,t=0;t<l.length;t+=3)e.x=l[t+0],e.y=l[t+1],e.z=l[t+2],d.push(Math.atan2(e.z,-e.x)/2/Math.PI+.5,1-(Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5));e=new o,t=new o;for(var n=new o,r=new o,s=new i,a=new i,h=new i,u=0,p=0;u<l.length;u+=9,p+=6){e.set(l[u+0],l[u+1],l[u+2]),t.set(l[u+3],l[u+4],l[u+5]),n.set(l[u+6],l[u+7],l[u+8]),s.set(d[p+0],d[p+1]),a.set(d[p+2],d[p+3]),h.set(d[p+4],d[p+5]),r.copy(e).add(t).add(n).divideScalar(3);var m=Math.atan2(r.z,-r.x);c(s,p+0,e,m),c(a,p+2,t,m),c(h,p+4,n,m)}for(e=0;e<d.length;e+=6)t=d[e+0],n=d[e+2],r=d[e+4],s=Math.min(t,n,r),.9<Math.max(t,n,r)&&.1>s&&(.2>t&&(d[e+0]+=1),.2>n&&(d[e+2]+=1),.2>r&&(d[e+4]+=1))}(),this.addAttribute("position",new P(l,3)),this.addAttribute("normal",new P(l.slice(),3)),this.addAttribute("uv",new P(d,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}function Yt(e,t){E.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Xt(e,t)),this.mergeVertices()}function Xt(e,t){qt.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Zt(e,t){E.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Kt(e,t)),this.mergeVertices()}function Kt(e,t){qt.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Jt(e,t){E.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Qt(e,t)),this.mergeVertices()}function Qt(e,t){var i=(1+Math.sqrt(5))/2;qt.call(this,[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function ei(e,t){E.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new ti(e,t)),this.mergeVertices()}function ti(e,t){var i=(1+Math.sqrt(5))/2,n=1/i;qt.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function ii(e,t,i,n,r,o){E.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:n,closed:r},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed."),e=new ni(e,t,i,n,r),this.tangents=e.tangents,this.normals=e.normals,this.binormals=e.binormals,this.fromBufferGeometry(e),this.mergeVertices()}function ni(e,t,n,r,s){function a(i){m=e.getPointAt(i/t,m);var o=c.normals[i];for(i=c.binormals[i],d=0;d<=r;d++){var s=d/r*Math.PI*2,a=Math.sin(s);s=-Math.cos(s),u.x=s*o.x+a*i.x,u.y=s*o.y+a*i.y,u.z=s*o.z+a*i.z,u.normalize(),g.push(u.x,u.y,u.z),h.x=m.x+n*u.x,h.y=m.y+n*u.y,h.z=m.z+n*u.z,f.push(h.x,h.y,h.z)}}F.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:s},n=n||1,r=r||8;var c=e.computeFrenetFrames(t=t||64,s=s||!1);this.tangents=c.tangents,this.normals=c.normals,this.binormals=c.binormals;var l,d,h=new o,u=new o,p=new i,m=new o,f=[],g=[],v=[],y=[];for(l=0;l<t;l++)a(l);for(a(!1===s?t:0),l=0;l<=t;l++)for(d=0;d<=r;d++)p.x=l/t,p.y=d/r,v.push(p.x,p.y);!function(){for(d=1;d<=t;d++)for(l=1;l<=r;l++){var e=(r+1)*d+(l-1),i=(r+1)*d+l,n=(r+1)*(d-1)+l;y.push((r+1)*(d-1)+(l-1),e,n),y.push(e,i,n)}}(),this.setIndex(y),this.addAttribute("position",new P(f,3)),this.addAttribute("normal",new P(g,3)),this.addAttribute("uv",new P(v,2))}function ri(e,t,i,n,r,o,s){E.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:r,q:o},void 0!==s&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new oi(e,t,i,n,r,o)),this.mergeVertices()}function oi(e,t,i,n,r,s){function a(e,t,i,n,r){var o=Math.sin(e);t=i/t*e,i=Math.cos(t),r.x=n*(2+i)*.5*Math.cos(e),r.y=n*(2+i)*o*.5,r.z=n*Math.sin(t)*.5}F.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:r,q:s},e=e||1,t=t||.4,i=Math.floor(i)||64,n=Math.floor(n)||8,r=r||2,s=s||3;var c,l=[],d=[],h=[],u=[],p=new o,m=new o,f=new o,g=new o,v=new o,y=new o,b=new o;for(c=0;c<=i;++c){var _=c/i*r*Math.PI*2;for(a(_,r,s,e,f),a(_+.01,r,s,e,g),y.subVectors(g,f),b.addVectors(g,f),v.crossVectors(y,b),b.crossVectors(v,y),v.normalize(),b.normalize(),_=0;_<=n;++_){var w=_/n*Math.PI*2,x=-t*Math.cos(w);w=t*Math.sin(w),p.x=f.x+(x*b.x+w*v.x),p.y=f.y+(x*b.y+w*v.y),p.z=f.z+(x*b.z+w*v.z),d.push(p.x,p.y,p.z),m.subVectors(p,f).normalize(),h.push(m.x,m.y,m.z),u.push(c/i),u.push(_/n)}}for(_=1;_<=i;_++)for(c=1;c<=n;c++)t=(n+1)*_+c,l.push((n+1)*(_-1)+(c-1),e=(n+1)*_+(c-1),r=(n+1)*(_-1)+c),l.push(e,t,r);this.setIndex(l),this.addAttribute("position",new P(d,3)),this.addAttribute("normal",new P(h,3)),this.addAttribute("uv",new P(u,2))}function si(e,t,i,n,r){E.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:r},this.fromBufferGeometry(new ai(e,t,i,n,r)),this.mergeVertices()}function ai(e,t,i,n,r){F.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:r},e=e||1,t=t||.4,i=Math.floor(i)||8,n=Math.floor(n)||6,r=r||2*Math.PI;var s,a,c=[],l=[],d=[],h=[],u=new o,p=new o,m=new o;for(s=0;s<=i;s++)for(a=0;a<=n;a++){var f=a/n*r,g=s/i*Math.PI*2;p.x=(e+t*Math.cos(g))*Math.cos(f),p.y=(e+t*Math.cos(g))*Math.sin(f),p.z=t*Math.sin(g),l.push(p.x,p.y,p.z),u.x=e*Math.cos(f),u.y=e*Math.sin(f),m.subVectors(p,u).normalize(),d.push(m.x,m.y,m.z),h.push(a/n),h.push(s/i)}for(s=1;s<=i;s++)for(a=1;a<=n;a++)t=(n+1)*(s-1)+a,c.push((n+1)*s+a-1,e=(n+1)*(s-1)+a-1,r=(n+1)*s+a),c.push(e,t,r);this.setIndex(c),this.addAttribute("position",new P(l,3)),this.addAttribute("normal",new P(d,3)),this.addAttribute("uv",new P(h,2))}function ci(e,t,i,n,r){for(var o,s=0,a=t,c=i-n;a<i;a+=n)s+=(e[c]-e[a])*(e[a+1]+e[c+1]),c=a;if(r===0<s)for(r=t;r<i;r+=n)o=_i(r,e[r],e[r+1],o);else for(r=i-n;r>=t;r-=n)o=_i(r,e[r],e[r+1],o);return o&&gi(o,o.next)&&(wi(o),o=o.next),o}function li(e,t){if(!e)return e;t||(t=e);do{var i=!1;if(e.steiner||!gi(e,e.next)&&0!==fi(e.prev,e,e.next))e=e.next;else{if(wi(e),(e=t=e.prev)===e.next)break;i=!0}}while(i||e!==t);return t}function di(e,t){return e.x-t.x}function hi(e,t){var i=t,n=e.x,r=e.y,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){var s=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=n&&s>o){if(o=s,s===n){if(r===i.y)return i;if(r===i.next.y)return i.next}var a=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!a)return null;if(n===o)return a.prev;t=a,s=a.x;var c=a.y,l=1/0;for(i=a.next;i!==t;){if(n>=i.x&&i.x>=s&&n!==i.x&&mi(r<c?n:o,r,s,c,r<c?o:n,r,i.x,i.y)){var d=Math.abs(r-i.y)/(n-i.x);(d<l||d===l&&i.x>a.x)&&yi(i,e)&&(a=i,l=d)}i=i.next}return a}function ui(e,t,i,n,r){return 1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1)|(1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function pi(e){var t=e,i=e;do{t.x<i.x&&(i=t),t=t.next}while(t!==e);return i}function mi(e,t,i,n,r,o,s,a){return 0<=(r-s)*(t-a)-(e-s)*(o-a)&&0<=(e-s)*(n-a)-(i-s)*(t-a)&&0<=(i-s)*(o-a)-(r-s)*(n-a)}function fi(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function gi(e,t){return e.x===t.x&&e.y===t.y}function vi(e,t,i,n){return!!(gi(e,t)&&gi(i,n)||gi(e,n)&&gi(i,t))||0<fi(e,t,i)!=0<fi(e,t,n)&&0<fi(i,n,e)!=0<fi(i,n,t)}function yi(e,t){return 0>fi(e.prev,e,e.next)?0<=fi(e,t,e.next)&&0<=fi(e,e.prev,t):0>fi(e,t,e.prev)||0>fi(e,e.next,t)}function bi(e,t){var i=new xi(e.i,e.x,e.y),n=new xi(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,o.next=n,n.prev=o,n}function _i(e,t,i,n){return e=new xi(e,t,i),n?(e.next=n.next,e.prev=n,n.next.prev=e,n.next=e):(e.prev=e,e.next=e),e}function wi(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function xi(e,t,i){this.i=e,this.x=t,this.y=i,this.nextZ=this.prevZ=this.z=this.next=this.prev=null,this.steiner=!1}function Ci(e){var t=e.length;2<t&&e[t-1].equals(e[0])&&e.pop()}function Si(e,t){for(var i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}function Ei(e,t){E.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new Mi(e,t)),this.mergeVertices()}function Mi(e,t){function n(e){function n(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}function c(e,t,n){var r=e.x-t.x,o=e.y-t.y,s=n.x-e.x,a=n.y-e.y,c=r*r+o*o;if(Math.abs(r*a-o*s)>Number.EPSILON){var l=Math.sqrt(c),d=Math.sqrt(s*s+a*a);if(2>=(o=(s=(c=t.x-o/l)+r*(a=((n.x-a/d-c)*a-(n.y+s/d-(t=t.y+r/l))*s)/(r*a-o*s))-e.x)*s+(r=t+o*a-e.y)*r))return new i(s,r);o=Math.sqrt(o/2)}else e=!1,r>Number.EPSILON?s>Number.EPSILON&&(e=!0):r<-Number.EPSILON?s<-Number.EPSILON&&(e=!0):Math.sign(o)===Math.sign(a)&&(e=!0),e?(s=-o,o=Math.sqrt(c)):(s=r,r=o,o=Math.sqrt(c/2));return new i(s/o,r/o)}function l(e,t){for(U=e.length;0<=--U;){var i=U,n=U-1;0>n&&(n=e.length-1);var o,a=g+2*w;for(o=0;o<a;o++){var c=z*o,l=z*(o+1),d=t+n+c,h=t+n+l;l=t+i+l,u(t+i+c),u(d),u(l),u(d),u(h),u(l),p((c=C.generateSideWallUV(r,s,(c=s.length/3)-6,c-3,c-2,c-1))[0]),p(c[1]),p(c[3]),p(c[1]),p(c[2]),p(c[3])}}}function d(e,t,i){m.push(e),m.push(t),m.push(i)}function h(e,t,i){u(e),u(t),u(i),p((e=C.generateTopUV(r,s,(e=s.length/3)-3,e-2,e-1))[0]),p(e[1]),p(e[2])}function u(e){s.push(m[3*e]),s.push(m[3*e+1]),s.push(m[3*e+2])}function p(e){a.push(e.x),a.push(e.y)}var m=[],f=void 0!==t.curveSegments?t.curveSegments:12,g=void 0!==t.steps?t.steps:1,v=void 0!==t.depth?t.depth:100,y=void 0===t.bevelEnabled||t.bevelEnabled,b=void 0!==t.bevelThickness?t.bevelThickness:6,_=void 0!==t.bevelSize?t.bevelSize:b-2,w=void 0!==t.bevelSegments?t.bevelSegments:3,x=t.extrudePath,C=void 0!==t.UVGenerator?t.UVGenerator:Ro;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),v=t.amount);var S,E=!1;if(x){var M=x.getSpacedPoints(g);E=!0,y=!1;var T=x.computeFrenetFrames(g,!1),A=new o,k=new o,R=new o}y||(_=b=w=0);var D=(f=e.extractPoints(f)).holes;if(!ko.isClockWise(e=f.shape)){e=e.reverse();var L=0;for(S=D.length;L<S;L++){var I=D[L];ko.isClockWise(I)&&(D[L]=I.reverse())}}var O=ko.triangulateShape(e,D),P=e;for(L=0,S=D.length;L<S;L++)e=e.concat(I=D[L]);var H,N,z=e.length,F=O.length;f=[];var U=0,B=P.length,j=B-1;for(H=U+1;U<B;U++,j++,H++)j===B&&(j=0),H===B&&(H=0),f[U]=c(P[U],P[j],P[H]);x=[];var G=f.concat();for(L=0,S=D.length;L<S;L++){var V=[];for(j=(B=(I=D[L]).length)-1,H=1+(U=0);U<B;U++,j++,H++)j===B&&(j=0),H===B&&(H=0),V[U]=c(I[U],I[j],I[H]);x.push(V),G=G.concat(V)}for(j=0;j<w;j++){B=j/w;var $=b*Math.cos(B*Math.PI/2);for(H=_*Math.sin(B*Math.PI/2),U=0,B=P.length;U<B;U++){var W=n(P[U],f[U],H);d(W.x,W.y,-$)}for(L=0,S=D.length;L<S;L++)for(V=x[L],U=0,B=(I=D[L]).length;U<B;U++)d((W=n(I[U],V[U],H)).x,W.y,-$)}for(H=_,U=0;U<z;U++)W=y?n(e[U],G[U],H):e[U],E?(k.copy(T.normals[0]).multiplyScalar(W.x),A.copy(T.binormals[0]).multiplyScalar(W.y),R.copy(M[0]).add(k).add(A),d(R.x,R.y,R.z)):d(W.x,W.y,0);for(B=1;B<=g;B++)for(U=0;U<z;U++)W=y?n(e[U],G[U],H):e[U],E?(k.copy(T.normals[B]).multiplyScalar(W.x),A.copy(T.binormals[B]).multiplyScalar(W.y),R.copy(M[B]).add(k).add(A),d(R.x,R.y,R.z)):d(W.x,W.y,v/g*B);for(j=w-1;0<=j;j--){for(B=j/w,$=b*Math.cos(B*Math.PI/2),H=_*Math.sin(B*Math.PI/2),U=0,B=P.length;U<B;U++)d((W=n(P[U],f[U],H)).x,W.y,v+$);for(L=0,S=D.length;L<S;L++)for(V=x[L],U=0,B=(I=D[L]).length;U<B;U++)W=n(I[U],V[U],H),E?d(W.x,W.y+M[g-1].y,M[g-1].x+$):d(W.x,W.y,v+$)}!function(){var e=s.length/3;if(y){var t=0*z;for(U=0;U<F;U++)h((N=O[U])[2]+t,N[1]+t,N[0]+t);for(t=z*(g+2*w),U=0;U<F;U++)h((N=O[U])[0]+t,N[1]+t,N[2]+t)}else{for(U=0;U<F;U++)h((N=O[U])[2],N[1],N[0]);for(U=0;U<F;U++)h((N=O[U])[0]+z*g,N[1]+z*g,N[2]+z*g)}r.addGroup(e,s.length/3-e,0)}(),function(){var e=s.length/3,t=0;for(l(P,t),t+=P.length,L=0,S=D.length;L<S;L++)l(I=D[L],t),t+=I.length;r.addGroup(e,s.length/3-e,1)}()}F.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var r=this,s=[],a=[],c=0,l=e.length;c<l;c++)n(e[c]);this.addAttribute("position",new P(s,3)),this.addAttribute("uv",new P(a,2)),this.computeVertexNormals()}function Ti(e,t,i){if(i.shapes=[],Array.isArray(e))for(var n=0,r=e.length;n<r;n++)i.shapes.push(e[n].uuid);else i.shapes.push(e.uuid);return void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON()),i}function Ai(e,t){E.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new ki(e,t)),this.mergeVertices()}function ki(e,t){var i=(t=t||{}).font;if(!i||!i.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new E;e=i.generateShapes(e,t.size),t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),Mi.call(this,e,t),this.type="TextBufferGeometry"}function Ri(e,t,i,n,r,o,s){E.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new Di(e,t,i,n,r,o,s)),this.mergeVertices()}function Di(e,t,i,n,r,s,a){F.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:s,thetaLength:a},e=e||1,t=Math.max(3,Math.floor(t)||8),i=Math.max(2,Math.floor(i)||6),n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var c,l,d=(s=void 0!==s?s:0)+(a=void 0!==a?a:Math.PI),h=0,u=[],p=new o,m=new o,f=[],g=[],v=[],y=[];for(l=0;l<=i;l++){var b=[],_=l/i;for(c=0;c<=t;c++){var w=c/t;p.x=-e*Math.cos(n+w*r)*Math.sin(s+_*a),p.y=e*Math.cos(s+_*a),p.z=e*Math.sin(n+w*r)*Math.sin(s+_*a),g.push(p.x,p.y,p.z),m.set(p.x,p.y,p.z).normalize(),v.push(m.x,m.y,m.z),y.push(w,1-_),b.push(h++)}u.push(b)}for(l=0;l<i;l++)for(c=0;c<t;c++)e=u[l][c+1],n=u[l][c],r=u[l+1][c],a=u[l+1][c+1],(0!==l||0<s)&&f.push(e,n,a),(l!==i-1||d<Math.PI)&&f.push(n,r,a);this.setIndex(f),this.addAttribute("position",new P(g,3)),this.addAttribute("normal",new P(v,3)),this.addAttribute("uv",new P(y,2))}function Li(e,t,i,n,r,o){E.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:o},this.fromBufferGeometry(new Ii(e,t,i,n,r,o)),this.mergeVertices()}function Ii(e,t,n,r,s,a){F.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:s,thetaLength:a},e=e||.5,t=t||1,s=void 0!==s?s:0,a=void 0!==a?a:2*Math.PI,n=void 0!==n?Math.max(3,n):8;var c,l,d=[],h=[],u=[],p=[],m=e,f=(t-e)/(r=void 0!==r?Math.max(1,r):1),g=new o,v=new i;for(c=0;c<=r;c++){for(l=0;l<=n;l++)e=s+l/n*a,g.x=m*Math.cos(e),g.y=m*Math.sin(e),h.push(g.x,g.y,g.z),u.push(0,0,1),v.x=(g.x/t+1)/2,v.y=(g.y/t+1)/2,p.push(v.x,v.y);m+=f}for(c=0;c<r;c++)for(t=c*(n+1),l=0;l<n;l++)a=(e=l+t)+n+2,d.push(e,s=e+n+1,m=e+1),d.push(s,a,m);this.setIndex(d),this.addAttribute("position",new P(h,3)),this.addAttribute("normal",new P(u,3)),this.addAttribute("uv",new P(p,2))}function Oi(e,t,i,n){E.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},this.fromBufferGeometry(new Pi(e,t,i,n)),this.mergeVertices()}function Pi(e,t,n,r){F.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t)||12,n=n||0,r=r||2*Math.PI,r=to.clamp(r,0,2*Math.PI);var s,a=[],c=[],l=[],d=1/t,h=new o,u=new i;for(s=0;s<=t;s++){var p=n+s*d*r,m=Math.sin(p),f=Math.cos(p);for(p=0;p<=e.length-1;p++)h.x=e[p].x*m,h.y=e[p].y,h.z=e[p].x*f,c.push(h.x,h.y,h.z),u.x=s/t,u.y=p/(e.length-1),l.push(u.x,u.y)}for(s=0;s<t;s++)for(p=0;p<e.length-1;p++)h=(n=p+s*e.length)+e.length+1,a.push(n,d=n+e.length,u=n+1),a.push(d,h,u);if(this.setIndex(a),this.addAttribute("position",new P(c,3)),this.addAttribute("uv",new P(l,2)),this.computeVertexNormals(),r===2*Math.PI)for(r=this.attributes.normal.array,a=new o,c=new o,l=new o,n=t*e.length*3,p=s=0;s<e.length;s++,p+=3)a.x=r[p+0],a.y=r[p+1],a.z=r[p+2],c.x=r[n+p+0],c.y=r[n+p+1],c.z=r[n+p+2],l.addVectors(a,c).normalize(),r[p+0]=r[n+p+0]=l.x,r[p+1]=r[n+p+1]=l.y,r[p+2]=r[n+p+2]=l.z}function Hi(e,t){E.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Ni(e,t)),this.mergeVertices()}function Ni(e,t){function i(e){var i,a=r.length/3,l=(e=e.extractPoints(t)).shape,d=e.holes;if(!1===ko.isClockWise(l))for(l=l.reverse(),e=0,i=d.length;e<i;e++){var h=d[e];!0===ko.isClockWise(h)&&(d[e]=h.reverse())}var u=ko.triangulateShape(l,d);for(e=0,i=d.length;e<i;e++)l=l.concat(h=d[e]);for(e=0,i=l.length;e<i;e++)r.push((h=l[e]).x,h.y,0),o.push(0,0,1),s.push(h.x,h.y);for(e=0,i=u.length;e<i;e++)n.push((l=u[e])[0]+a,l[1]+a,l[2]+a),c+=3}F.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var n=[],r=[],o=[],s=[],a=0,c=0;if(!1===Array.isArray(e))i(e);else for(var l=0;l<e.length;l++)i(e[l]),this.addGroup(a,c,l),a+=c,c=0;this.setIndex(n),this.addAttribute("position",new P(r,3)),this.addAttribute("normal",new P(o,3)),this.addAttribute("uv",new P(s,2))}function zi(e,t){if(t.shapes=[],Array.isArray(e))for(var i=0,n=e.length;i<n;i++)t.shapes.push(e[i].uuid);else t.shapes.push(e.uuid);return t}function Fi(e,t){F.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t};var i=[];t=Math.cos(to.DEG2RAD*(void 0!==t?t:1));var n=[0,0],r={},o=["a","b","c"];if(e.isBufferGeometry){var s=new E;s.fromBufferGeometry(e)}else s=e.clone();s.mergeVertices(),s.computeFaceNormals(),e=s.vertices;for(var a=0,c=(s=s.faces).length;a<c;a++)for(var l=s[a],d=0;3>d;d++){var h=l[o[d]],u=l[o[(d+1)%3]];n[0]=Math.min(h,u),n[1]=Math.max(h,u),void 0===r[h=n[0]+","+n[1]]?r[h]={index1:n[0],index2:n[1],face1:a,face2:void 0}:r[h].face2=a}for(h in r)(void 0===(n=r[h]).face2||s[n.face1].normal.dot(s[n.face2].normal)<=t)&&(i.push((o=e[n.index1]).x,o.y,o.z),i.push((o=e[n.index2]).x,o.y,o.z));this.addAttribute("position",new P(i,3))}function Ui(e,t,i,n,r,o,s,a){E.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:r,openEnded:o,thetaStart:s,thetaLength:a},this.fromBufferGeometry(new Bi(e,t,i,n,r,o,s,a)),this.mergeVertices()}function Bi(e,t,n,r,s,a,c,l){function d(n){var s,a=new i,d=new o,v=0,_=!0===n?e:t,w=!0===n?1:-1,x=g;for(s=1;s<=r;s++)p.push(0,y*w,0),m.push(0,w,0),f.push(.5,.5),g++;var C=g;for(s=0;s<=r;s++){var S=s/r*l+c,E=Math.cos(S);S=Math.sin(S),d.x=_*S,d.y=y*w,d.z=_*E,p.push(d.x,d.y,d.z),m.push(0,w,0),a.x=.5*E+.5,a.y=.5*S*w+.5,f.push(a.x,a.y),g++}for(s=0;s<r;s++)a=x+s,d=C+s,!0===n?u.push(d,d+1,a):u.push(d+1,d,a),v+=3;h.addGroup(b,v,!0===n?1:2),b+=v}F.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:s,openEnded:a,thetaStart:c,thetaLength:l};var h=this;e=void 0!==e?e:1,t=void 0!==t?t:1,n=n||1,r=Math.floor(r)||8,s=Math.floor(s)||1,a=void 0!==a&&a,c=void 0!==c?c:0,l=void 0!==l?l:2*Math.PI;var u=[],p=[],m=[],f=[],g=0,v=[],y=n/2,b=0;!function(){var i,a,d=new o,_=new o,w=0,x=(t-e)/n;for(a=0;a<=s;a++){var C=[],S=a/s,E=S*(t-e)+e;for(i=0;i<=r;i++){var M=i/r,T=M*l+c,A=Math.sin(T);T=Math.cos(T),_.x=E*A,_.y=-S*n+y,_.z=E*T,p.push(_.x,_.y,_.z),d.set(A,x,T).normalize(),m.push(d.x,d.y,d.z),f.push(M,1-S),C.push(g++)}v.push(C)}for(i=0;i<r;i++)for(a=0;a<s;a++)_=v[a+1][i+1],u.push(v[a][i],d=v[a+1][i],x=v[a][i+1]),u.push(d,_,x),w+=6;h.addGroup(b,w,0),b+=w}(),!1===a&&(0<e&&d(!0),0<t&&d(!1)),this.setIndex(u),this.addAttribute("position",new P(p,3)),this.addAttribute("normal",new P(m,3)),this.addAttribute("uv",new P(f,2))}function ji(e,t,i,n,r,o,s){Ui.call(this,0,e,t,i,n,r,o,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:o,thetaLength:s}}function Gi(e,t,i,n,r,o,s){Bi.call(this,0,e,t,i,n,r,o,s),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:o,thetaLength:s}}function Vi(e,t,i,n){E.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:n},this.fromBufferGeometry(new $i(e,t,i,n)),this.mergeVertices()}function $i(e,t,n,r){F.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},e=e||1,t=void 0!==t?Math.max(3,t):8,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var s,a=[],c=[],l=[],d=[],h=new o,u=new i;c.push(0,0,0),l.push(0,0,1),d.push(.5,.5);var p=0;for(s=3;p<=t;p++,s+=3){var m=n+p/t*r;h.x=e*Math.cos(m),h.y=e*Math.sin(m),c.push(h.x,h.y,h.z),l.push(0,0,1),u.x=(c[s]/e+1)/2,u.y=(c[s+1]/e+1)/2,d.push(u.x,u.y)}for(s=1;s<=t;s++)a.push(s,s+1,0);this.setIndex(a),this.addAttribute("position",new P(c,3)),this.addAttribute("normal",new P(l,3)),this.addAttribute("uv",new P(d,2))}function Wi(e){V.call(this),this.type="ShadowMaterial",this.color=new y(0),this.transparent=!0,this.setValues(e)}function qi(e){$.call(this,e),this.type="RawShaderMaterial"}function Yi(e){V.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new y(16777215),this.metalness=this.roughness=.5,this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new y(0),this.emissiveIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)}function Xi(e){Yi.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoatRoughness=this.clearCoat=0,this.setValues(e)}function Zi(e){V.call(this),this.type="MeshPhongMaterial",this.color=new y(16777215),this.specular=new y(1118481),this.shininess=30,this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new y(0),this.emissiveIntensity=1,this.bumpMap=this.emissiveMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.envMap=this.alphaMap=this.specularMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)}function Ki(e){Zi.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function Ji(e){V.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.morphNormals=this.morphTargets=this.skinning=this.lights=this.fog=!1,this.setValues(e)}function Qi(e){V.call(this),this.type="MeshLambertMaterial",this.color=new y(16777215),this.lightMap=this.map=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new y(0),this.emissiveIntensity=1,this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)}function en(e){V.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new y(16777215),this.bumpMap=this.map=this.matcap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new i(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.lights=this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)}function tn(e){It.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}function nn(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i}function rn(e,t,i,n){nn.call(this,e,t,i,n),this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0}function on(e,t,i,n){nn.call(this,e,t,i,n)}function sn(e,t,i,n){nn.call(this,e,t,i,n)}function an(e,t,i,n){if(void 0===e)throw Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Io.convertArray(t,this.TimeBufferType),this.values=Io.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}function cn(e,t,i){an.call(this,e,t,i)}function ln(e,t,i,n){an.call(this,e,t,i,n)}function dn(e,t,i,n){an.call(this,e,t,i,n)}function hn(e,t,i,n){nn.call(this,e,t,i,n)}function un(e,t,i,n){an.call(this,e,t,i,n)}function pn(e,t,i,n){an.call(this,e,t,i,n)}function mn(e,t,i,n){an.call(this,e,t,i,n)}function fn(e,t,i){this.name=e,this.tracks=i,this.duration=void 0!==t?t:-1,this.uuid=to.generateUUID(),0>this.duration&&this.resetDuration()}function gn(e){if(void 0===e.type)throw Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return dn;case"vector":case"vector2":case"vector3":case"vector4":return mn;case"color":return ln;case"quaternion":return un;case"bool":case"boolean":return cn;case"string":return pn}throw Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var i=[],n=[];Io.flattenJSON(e.keys,i,n,"value"),e.times=i,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}function vn(e,t,i){var n=this,r=!1,o=0,s=0,a=void 0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){s++,!1===r&&void 0!==n.onStart&&n.onStart(e,o,s),r=!0},this.itemEnd=function(e){o++,void 0!==n.onProgress&&n.onProgress(e,o,s),o===s&&(r=!1,void 0!==n.onLoad)&&n.onLoad()},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return a?a(e):e},this.setURLModifier=function(e){return a=e,this}}function yn(e){this.manager=void 0!==e?e:Po}function bn(e){this.manager=void 0!==e?e:Po}function _n(e){this.manager=void 0!==e?e:Po,this._parser=null}function wn(e){this.manager=void 0!==e?e:Po,this._parser=null}function xn(e){this.manager=void 0!==e?e:Po}function Cn(e){this.manager=void 0!==e?e:Po}function Sn(e){this.manager=void 0!==e?e:Po}function En(){this.type="Curve",this.arcLengthDivisions=200}function Mn(e,t,i,n,r,o,s,a){En.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=i||1,this.yRadius=n||1,this.aStartAngle=r||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=s||!1,this.aRotation=a||0}function Tn(e,t,i,n,r,o){Mn.call(this,e,t,i,i,n,r,o),this.type="ArcCurve"}function An(){var e=0,t=0,i=0,n=0;return{initCatmullRom:function(r,o,s,a,c){e=o,t=r=c*(s-r),i=-3*o+3*s-2*r-(a=c*(a-o)),n=2*o-2*s+r+a},initNonuniformCatmullRom:function(r,o,s,a,c,l,d){e=o,t=r=((o-r)/c-(s-r)/(c+l)+(s-o)/l)*l,i=-3*o+3*s-2*r-(a=((s-o)/l-(a-o)/(l+d)+(a-s)/d)*l),n=2*o-2*s+r+a},calc:function(r){var o=r*r;return e+t*r+i*o+n*o*r}}}function kn(e,t,i,n){En.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=i||"centripetal",this.tension=n||.5}function Rn(e,t,i,n,r){var o=e*e;return(2*i-2*n+(t=.5*(n-t))+(r=.5*(r-i)))*e*o+(-3*i+3*n-2*t-r)*o+t*e+i}function Dn(e,t,i,n){var r=1-e;return r*r*t+2*(1-e)*e*i+e*e*n}function Ln(e,t,i,n,r){var o=1-e,s=1-e;return o*o*o*t+3*s*s*e*i+3*(1-e)*e*e*n+e*e*e*r}function In(e,t,n,r){En.call(this),this.type="CubicBezierCurve",this.v0=e||new i,this.v1=t||new i,this.v2=n||new i,this.v3=r||new i}function On(e,t,i,n){En.call(this),this.type="CubicBezierCurve3",this.v0=e||new o,this.v1=t||new o,this.v2=i||new o,this.v3=n||new o}function Pn(e,t){En.call(this),this.type="LineCurve",this.v1=e||new i,this.v2=t||new i}function Hn(e,t){En.call(this),this.type="LineCurve3",this.v1=e||new o,this.v2=t||new o}function Nn(e,t,n){En.call(this),this.type="QuadraticBezierCurve",this.v0=e||new i,this.v1=t||new i,this.v2=n||new i}function zn(e,t,i){En.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new o,this.v1=t||new o,this.v2=i||new o}function Fn(e){En.call(this),this.type="SplineCurve",this.points=e||[]}function Un(){En.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Bn(e){Un.call(this),this.type="Path",this.currentPoint=new i,e&&this.setFromPoints(e)}function jn(e){Bn.call(this,e),this.uuid=to.generateUUID(),this.type="Shape",this.holes=[]}function Gn(e,t){S.call(this),this.type="Light",this.color=new y(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function Vn(e,t,i){Gn.call(this,e,i),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(S.DefaultUp),this.updateMatrix(),this.groundColor=new y(t)}function $n(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new i(512,512),this.map=null,this.matrix=new n}function Wn(){$n.call(this,new gt(50,1,.5,500))}function qn(e,t,i,n,r,o){Gn.call(this,e,t),this.type="SpotLight",this.position.copy(S.DefaultUp),this.updateMatrix(),this.target=new S,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==o?o:1,this.shadow=new Wn}function Yn(e,t,i,n){Gn.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==n?n:1,this.shadow=new $n(new gt(90,1,.5,500))}function Xn(e,t,i,n,r,o){ft.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==i?i:1,this.bottom=void 0!==n?n:-1,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function Zn(){$n.call(this,new Xn(-5,5,5,-5,.5,500))}function Kn(e,t){Gn.call(this,e,t),this.type="DirectionalLight",this.position.copy(S.DefaultUp),this.updateMatrix(),this.target=new S,this.shadow=new Zn}function Jn(e,t){Gn.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function Qn(e,t,i,n){Gn.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==i?i:10,this.height=void 0!==n?n:10}function er(e){this.manager=void 0!==e?e:Po,this.textures={}}function tr(e){this.manager=void 0!==e?e:Po}function ir(e){this.manager=void 0!==e?e:Po,this.resourcePath=""}function nr(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==e?e:Po,this.options=void 0}function rr(){this.type="ShapePath",this.color=new y,this.subPaths=[],this.currentPath=null}function or(e){this.type="Font",this.data=e}function sr(e){this.manager=void 0!==e?e:Po}function ar(){}function cr(e){this.manager=void 0!==e?e:Po}function lr(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new gt,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new gt,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function dr(e,t,i,n){S.call(this),this.type="CubeCamera";var r=new gt(90,1,e,t);r.up.set(0,-1,0),r.lookAt(new o(1,0,0)),this.add(r);var s=new gt(90,1,e,t);s.up.set(0,-1,0),s.lookAt(new o(-1,0,0)),this.add(s);var a=new gt(90,1,e,t);a.up.set(0,0,1),a.lookAt(new o(0,1,0)),this.add(a);var c=new gt(90,1,e,t);c.up.set(0,0,-1),c.lookAt(new o(0,-1,0)),this.add(c);var l=new gt(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new o(0,0,1)),this.add(l);var h=new gt(90,1,e,t);h.up.set(0,-1,0),h.lookAt(new o(0,0,-1)),this.add(h),this.renderTarget=new d(i,i,n=n||{format:1022,magFilter:1006,minFilter:1006}),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var i=this.renderTarget,n=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,i.activeCubeFace=0,e.render(t,r,i),i.activeCubeFace=1,e.render(t,s,i),i.activeCubeFace=2,e.render(t,a,i),i.activeCubeFace=3,e.render(t,c,i),i.activeCubeFace=4,e.render(t,l,i),i.texture.generateMipmaps=n,i.activeCubeFace=5,e.render(t,h,i),e.setRenderTarget(null)},this.clear=function(e,t,i,n){for(var r=this.renderTarget,o=0;6>o;o++)r.activeCubeFace=o,e.setRenderTarget(r),e.clear(t,i,n);e.setRenderTarget(null)}}function hr(e){this.autoStart=void 0===e||e,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1}function ur(){S.call(this),this.type="AudioListener",this.context=Zo.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0}function pr(e){S.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.offset=this.startTime=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function mr(e){pr.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function fr(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function gr(e,t,i){switch(this.binding=e,this.valueSize=i,e=Float64Array,t){case"quaternion":t=this._slerp;break;case"string":case"bool":e=Array,t=this._select;break;default:t=this._lerp}this.buffer=new e(4*i),this._mixBufferRegion=t,this.referenceCount=this.useCount=this.cumulativeWeight=0}function vr(e,t,i){i=i||yr.parseTrackName(t),this._targetGroup=e,this._bindings=e.subscribe_(t,i)}function yr(e,t,i){this.path=t,this.parsedPath=i||yr.parseTrackName(t),this.node=yr.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function br(){this.uuid=to.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,i=arguments.length;t!==i;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}function _r(e,t,i){this._mixer=e,this._clip=t,this._localRoot=i||null,t=(e=t.tracks).length,i=Array(t);for(var n={endingStart:2400,endingEnd:2400},r=0;r!==t;++r){var o=e[r].createInterpolant(null);i[r]=o,o.settings=n}this._interpolantSettings=n,this._interpolants=i,this._propertyBindings=Array(t),this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0}function wr(e){this._root=e,this._initMemoryManager(),this.time=this._accuIndex=0,this.timeScale=1}function xr(e,t){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=t),this.value=e}function Cr(){F.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function Sr(e,t,i){Et.call(this,e,t),this.meshPerAttribute=i||1}function Er(e,t,i,n){"number"==typeof i&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),M.call(this,e,t,i),this.meshPerAttribute=n||1}function Mr(e,t,i,n){this.ray=new W(e,t),this.near=i||0,this.far=n||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Tr(e,t){return e.distance-t.distance}function Ar(e,t,i,n){if(!1!==e.visible&&(e.raycast(t,i),!0===n)){n=0;for(var r=(e=e.children).length;n<r;n++)Ar(e[n],t,i,!0)}}function kr(e,t,i){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==i?i:0,this}function Rr(e,t,i){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==i?i:0,this}function Dr(e,t){this.min=void 0!==e?e:new i(1/0,1/0),this.max=void 0!==t?t:new i(-1/0,-1/0)}function Lr(e,t){this.start=void 0!==e?e:new o,this.end=void 0!==t?t:new o}function Ir(e){S.call(this),this.material=e,this.render=function(){}}function Or(e,t,i,n){this.object=e,this.size=void 0!==t?t:1,e=void 0!==i?i:16711680,n=void 0!==n?n:1,t=0,(i=this.object.geometry)&&i.isGeometry?t=3*i.faces.length:i&&i.isBufferGeometry&&(t=i.attributes.normal.count),i=new F,t=new P(6*t,3),i.addAttribute("position",t),Pt.call(this,i,new It({color:e,linewidth:n})),this.matrixAutoUpdate=!1,this.update()}function Pr(e,t){S.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,e=new F,t=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(var i=0,n=1;32>i;i++,n++){var r=i/32*Math.PI*2,o=n/32*Math.PI*2;t.push(Math.cos(r),Math.sin(r),1,Math.cos(o),Math.sin(o),1)}e.addAttribute("position",new P(t,3)),t=new It({fog:!1}),this.cone=new Pt(e,t),this.add(this.cone),this.update()}function Hr(e){for(var t=function e(t){var i=[];t&&t.isBone&&i.push(t);for(var n=0;n<t.children.length;n++)i.push.apply(i,e(t.children[n]));return i}(e),i=new F,n=[],r=[],o=new y(0,0,1),s=new y(0,1,0),a=0;a<t.length;a++){var c=t[a];c.parent&&c.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(o.r,o.g,o.b),r.push(s.r,s.g,s.b))}i.addAttribute("position",new P(n,3)),i.addAttribute("color",new P(r,3)),n=new It({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0}),Pt.call(this,i,n),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function Nr(e,t,i){this.light=e,this.light.updateMatrixWorld(),this.color=i,e=new Di(t,4,2),t=new Y({wireframe:!0,fog:!1}),X.call(this,e,t),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function zr(e,t){S.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,e=new It({fog:!1}),(t=new F).addAttribute("position",new M(new Float32Array(15),3)),this.line=new Ot(t,e),this.add(this.line),this.update()}function Fr(e,t,i){S.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,(e=new Kt(t)).rotateY(.5*Math.PI),this.material=new Y({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=2),t=e.getAttribute("position"),t=new Float32Array(3*t.count),e.addAttribute("color",new M(t,3)),this.add(new X(e,this.material)),this.update()}function Ur(e,t,i,n){e=e||10,t=t||10,i=new y(void 0!==i?i:4473924),n=new y(void 0!==n?n:8947848);var r=t/2,o=e/t,s=e/2;e=[];for(var a=[],c=0,l=0,d=-s;c<=t;c++,d+=o){e.push(-s,0,d,s,0,d),e.push(d,0,-s,d,0,s);var h=c===r?i:n;h.toArray(a,l),h.toArray(a,l+=3),h.toArray(a,l+=3),h.toArray(a,l+=3),l+=3}(t=new F).addAttribute("position",new P(e,3)),t.addAttribute("color",new P(a,3)),i=new It({vertexColors:2}),Pt.call(this,t,i)}function Br(e,t,i,n,r,o){e=e||10,t=t||16,i=i||8,n=n||64,r=new y(void 0!==r?r:4473924),o=new y(void 0!==o?o:8947848);var s,a=[],c=[];for(s=0;s<=t;s++){var l=s/t*2*Math.PI,d=Math.sin(l)*e;l=Math.cos(l)*e,a.push(0,0,0),a.push(d,0,l);var h=1&s?r:o;c.push(h.r,h.g,h.b),c.push(h.r,h.g,h.b)}for(s=0;s<=i;s++){h=1&s?r:o;var u=e-e/i*s;for(t=0;t<n;t++)l=t/n*2*Math.PI,d=Math.sin(l)*u,l=Math.cos(l)*u,a.push(d,0,l),c.push(h.r,h.g,h.b),l=(t+1)/n*2*Math.PI,d=Math.sin(l)*u,l=Math.cos(l)*u,a.push(d,0,l),c.push(h.r,h.g,h.b)}(e=new F).addAttribute("position",new P(a,3)),e.addAttribute("color",new P(c,3)),a=new It({vertexColors:2}),Pt.call(this,e,a)}function jr(e,t,i,n){this.object=e,this.size=void 0!==t?t:1,e=void 0!==i?i:16776960,n=void 0!==n?n:1,t=0,(i=this.object.geometry)&&i.isGeometry?t=i.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead."),i=new F,t=new P(6*t,3),i.addAttribute("position",t),Pt.call(this,i,new It({color:e,linewidth:n})),this.matrixAutoUpdate=!1,this.update()}function Gr(e,t,i){S.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===t&&(t=1),(e=new F).addAttribute("position",new P([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3)),t=new It({fog:!1}),this.lightPlane=new Ot(e,t),this.add(this.lightPlane),(e=new F).addAttribute("position",new P([0,0,0,0,0,1],3)),this.targetLine=new Ot(e,t),this.add(this.targetLine),this.update()}function Vr(e){function t(e,t,n){i(e,n),i(t,n)}function i(e,t){o.push(0,0,0),s.push(t.r,t.g,t.b),void 0===a[e]&&(a[e]=[]),a[e].push(o.length/3-1)}var n=new F,r=new It({color:16777215,vertexColors:1}),o=[],s=[],a={},c=new y(16755200),l=new y(16711680),d=new y(43775),h=new y(16777215),u=new y(3355443);t("n1","n2",c),t("n2","n4",c),t("n4","n3",c),t("n3","n1",c),t("f1","f2",c),t("f2","f4",c),t("f4","f3",c),t("f3","f1",c),t("n1","f1",c),t("n2","f2",c),t("n3","f3",c),t("n4","f4",c),t("p","n1",l),t("p","n2",l),t("p","n3",l),t("p","n4",l),t("u1","u2",d),t("u2","u3",d),t("u3","u1",d),t("c","t",h),t("p","c",u),t("cn1","cn2",u),t("cn3","cn4",u),t("cf1","cf2",u),t("cf3","cf4",u),n.addAttribute("position",new P(o,3)),n.addAttribute("color",new P(s,3)),Pt.call(this,n,r),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}function $r(e,t){this.object=e,void 0===t&&(t=16776960),e=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var i=new Float32Array(24),n=new F;n.setIndex(new M(e,1)),n.addAttribute("position",new M(i,3)),Pt.call(this,n,new It({color:t})),this.matrixAutoUpdate=!1,this.update()}function Wr(e,t){this.type="Box3Helper",this.box=e,e=void 0!==t?t:16776960,t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]);var i=new F;i.setIndex(new M(t,1)),i.addAttribute("position",new P([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Pt.call(this,i,new It({color:e})),this.geometry.computeBoundingSphere()}function qr(e,t,i){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t,e=void 0!==i?i:16776960,(t=new F).addAttribute("position",new P([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),t.computeBoundingSphere(),Ot.call(this,t,new It({color:e})),(t=new F).addAttribute("position",new P([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),t.computeBoundingSphere(),this.add(new X(t,new Y({color:e,opacity:.2,transparent:!0,depthWrite:!1})))}function Yr(e,t,i,n,r,o){S.call(this),void 0===e&&(e=new THREE.Vector3(0,0,1)),void 0===t&&(t=new THREE.Vector3(0,0,0)),void 0===i&&(i=1),void 0===n&&(n=16776960),void 0===r&&(r=.2*i),void 0===o&&(o=.2*r),void 0===Yo&&((Yo=new F).addAttribute("position",new P([0,0,0,0,1,0],3)),(Xo=new Bi(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Ot(Yo,new It({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new X(Xo,new Y({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,r,o)}function Xr(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e];(e=new F).addAttribute("position",new P(t,3)),e.addAttribute("color",new P([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),t=new It({vertexColors:2}),Pt.call(this,e,t)}function Zr(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),kn.call(this,e),this.type="catmullrom",this.closed=!0}function Kr(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),kn.call(this,e),this.type="catmullrom"}function Jr(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),kn.call(this,e),this.type="catmullrom"}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return 0>e?-1:0<e?1:+e}),0=="name"in Function.prototype&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var n=arguments[i];if(null!=n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}),Object.assign(t.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){void 0!==this._listeners&&void 0!==(e=this._listeners[e])&&-1!==(t=e.indexOf(t))&&e.splice(t,1)},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var i=0,n=(t=t.slice(0)).length;i<n;i++)t[i].call(this,e)}}}});var Qr,eo,to={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var e=[],t=0;256>t;t++)e[t]=(16>t?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&i]+e[i>>8&255]+"-"+e[i>>16&15|64]+e[i>>24&255]+"-"+e[63&n|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[255&r]+e[r>>8&255]+e[r>>16&255]+e[r>>24&255]).toUpperCase()}}(),clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*to.DEG2RAD},radToDeg:function(e){return e*to.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};Object.defineProperties(i.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(i.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.y=this.x=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,i=this.y;return this.x=(e=e.elements)[0]*t+e[3]*i+e[6],this.y=e[1]*t+e[4]*i+e[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:(Qr=new i,eo=new i,function(e,t){return Qr.set(e,e),eo.set(t,t),this.clamp(Qr,eo)}),clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return 0>e&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x;return t*t+(e=this.y-e.y)*e},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var i=Math.cos(t);t=Math.sin(t);var n=this.x-e.x,r=this.y-e.y;return this.x=n*i-r*t+e.x,this.y=n*t+r*i+e.y,this}}),Object.assign(n.prototype,{isMatrix4:!0,set:function(e,t,i,n,r,o,s,a,c,l,d,h,u,p,m,f){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=o,g[9]=s,g[13]=a,g[2]=c,g[6]=l,g[10]=d,g[14]=h,g[3]=u,g[7]=p,g[11]=m,g[15]=f,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new n).fromArray(this.elements)},copy:function(e){var t=this.elements;return t[0]=(e=e.elements)[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],this},copyPosition:function(e){var t=this.elements;return t[12]=(e=e.elements)[12],t[13]=e[13],t[14]=e[14],this},extractBasis:function(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:function(){var e=new o;return function(t){var i=this.elements,n=t.elements,r=1/e.setFromMatrixColumn(t,0).length(),o=1/e.setFromMatrixColumn(t,1).length();return t=1/e.setFromMatrixColumn(t,2).length(),i[0]=n[0]*r,i[1]=n[1]*r,i[2]=n[2]*r,i[3]=0,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[7]=0,i[8]=n[8]*t,i[9]=n[9]*t,i[10]=n[10]*t,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,i=e.x,n=e.y,r=e.z,o=Math.cos(i);i=Math.sin(i);var s=Math.cos(n);n=Math.sin(n);var a=Math.cos(r);if(r=Math.sin(r),"XYZ"===e.order){e=o*a;var c=o*r,l=i*a,d=i*r;t[0]=s*a,t[4]=-s*r,t[8]=n,t[1]=c+l*n,t[5]=e-d*n,t[9]=-i*s,t[2]=d-e*n,t[6]=l+c*n,t[10]=o*s}else"YXZ"===e.order?(c=s*r,l=n*a,t[0]=(e=s*a)+(d=n*r)*i,t[4]=l*i-c,t[8]=o*n,t[1]=o*r,t[5]=o*a,t[9]=-i,t[2]=c*i-l,t[6]=d+e*i,t[10]=o*s):"ZXY"===e.order?(c=s*r,l=n*a,t[0]=(e=s*a)-(d=n*r)*i,t[4]=-o*r,t[8]=l+c*i,t[1]=c+l*i,t[5]=o*a,t[9]=d-e*i,t[2]=-o*n,t[6]=i,t[10]=o*s):"ZYX"===e.order?(e=o*a,c=o*r,l=i*a,d=i*r,t[0]=s*a,t[4]=l*n-c,t[8]=e*n+d,t[1]=s*r,t[5]=d*n+e,t[9]=c*n-l,t[2]=-n,t[6]=i*s,t[10]=o*s):"YZX"===e.order?(e=o*s,c=o*n,l=i*s,d=i*n,t[0]=s*a,t[4]=d-e*r,t[8]=l*r+c,t[1]=r,t[5]=o*a,t[9]=-i*a,t[2]=-n*a,t[6]=c*r+l,t[10]=e-d*r):"XZY"===e.order&&(e=o*s,c=o*n,l=i*s,d=i*n,t[0]=s*a,t[4]=-r,t[8]=n*a,t[1]=e*r+d,t[5]=o*a,t[9]=c*r-l,t[2]=l*r-c,t[6]=i*a,t[10]=d*r+e);return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(){var e=new o(0,0,0),t=new o(1,1,1);return function(i){return this.compose(e,i,t)}}(),lookAt:function(){var e=new o,t=new o,i=new o;return function(n,r,o){var s=this.elements;return i.subVectors(n,r),0===i.lengthSq()&&(i.z=1),i.normalize(),e.crossVectors(o,i),0===e.lengthSq()&&(1===Math.abs(o.z)?i.x+=1e-4:i.z+=1e-4,i.normalize(),e.crossVectors(o,i)),e.normalize(),t.crossVectors(i,e),s[0]=e.x,s[4]=t.x,s[8]=i.x,s[1]=e.y,s[5]=t.y,s[9]=i.y,s[2]=e.z,s[6]=t.z,s[10]=i.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,n=t.elements;e=i[0];var r=i[4],o=i[8],s=i[12],a=i[1],c=i[5],l=i[9],d=i[13],h=i[2],u=i[6],p=i[10],m=i[14],f=i[3],g=i[7],v=i[11];i=i[15];var y=n[0],b=n[4],_=n[8],w=n[12],x=n[1],C=n[5],S=n[9],E=n[13],M=n[2],T=n[6],A=n[10],k=n[14],R=n[3],D=n[7],L=n[11];return n=n[15],(t=this.elements)[0]=e*y+r*x+o*M+s*R,t[4]=e*b+r*C+o*T+s*D,t[8]=e*_+r*S+o*A+s*L,t[12]=e*w+r*E+o*k+s*n,t[1]=a*y+c*x+l*M+d*R,t[5]=a*b+c*C+l*T+d*D,t[9]=a*_+c*S+l*A+d*L,t[13]=a*w+c*E+l*k+d*n,t[2]=h*y+u*x+p*M+m*R,t[6]=h*b+u*C+p*T+m*D,t[10]=h*_+u*S+p*A+m*L,t[14]=h*w+u*E+p*k+m*n,t[3]=f*y+g*x+v*M+i*R,t[7]=f*b+g*C+v*T+i*D,t[11]=f*_+g*S+v*A+i*L,t[15]=f*w+g*E+v*k+i*n,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new o;return function(t){for(var i=0,n=t.count;i<n;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.applyMatrix4(this),t.setXYZ(i,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],o=e[1],s=e[5],a=e[9],c=e[13],l=e[2],d=e[6],h=e[10],u=e[14];return e[3]*(+r*a*d-n*c*d-r*s*h+i*c*h+n*s*u-i*a*u)+e[7]*(+t*a*u-t*c*h+r*o*h-n*o*u+n*c*l-r*a*l)+e[11]*(+t*c*d-t*s*u-r*o*d+i*o*u+r*s*l-i*c*l)+e[15]*(-n*s*l-t*a*d+t*s*h+n*o*d-i*o*h+i*a*l)},transpose:function(){var e=this.elements,t=e[1];return e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,n=e.elements;e=n[0];var r=n[1],o=n[2],s=n[3],a=n[4],c=n[5],l=n[6],d=n[7],h=n[8],u=n[9],p=n[10],m=n[11],f=n[12],g=n[13],v=n[14],y=u*v*d-g*p*d+g*l*m-c*v*m-u*l*(n=n[15])+c*p*n,b=f*p*d-h*v*d-f*l*m+a*v*m+h*l*n-a*p*n,_=h*g*d-f*u*d+f*c*m-a*g*m-h*c*n+a*u*n,w=f*u*l-h*g*l-f*c*p+a*g*p+h*c*v-a*u*v,x=e*y+r*b+o*_+s*w;if(0===x){if(!0===t)throw Error("THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0");return console.warn("THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0"),this.identity()}return i[0]=y*(t=1/x),i[1]=(g*p*s-u*v*s-g*o*m+r*v*m+u*o*n-r*p*n)*t,i[2]=(c*v*s-g*l*s+g*o*d-r*v*d-c*o*n+r*l*n)*t,i[3]=(u*l*s-c*p*s-u*o*d+r*p*d+c*o*m-r*l*m)*t,i[4]=b*t,i[5]=(h*v*s-f*p*s+f*o*m-e*v*m-h*o*n+e*p*n)*t,i[6]=(f*l*s-a*v*s-f*o*d+e*v*d+a*o*n-e*l*n)*t,i[7]=(a*p*s-h*l*s+h*o*d-e*p*d-a*o*m+e*l*m)*t,i[8]=_*t,i[9]=(f*u*s-h*g*s-f*r*m+e*g*m+h*r*n-e*u*n)*t,i[10]=(a*g*s-f*c*s+f*r*d-e*g*d-a*r*n+e*c*n)*t,i[11]=(h*c*s-a*u*s-h*r*d+e*u*d+a*r*m-e*c*m)*t,i[12]=w*t,i[13]=(h*g*o-f*u*o+f*r*p-e*g*p-h*r*v+e*u*v)*t,i[14]=(f*c*o-a*g*o-f*r*l+e*g*l+a*r*v-e*c*v)*t,i[15]=(a*u*o-h*c*o+h*r*l-e*u*l-a*r*p+e*c*p)*t,this},scale:function(e){var t=this.elements,i=e.x,n=e.y;return e=e.z,t[0]*=i,t[4]*=n,t[8]*=e,t[1]*=i,t[5]*=n,t[9]*=e,t[2]*=i,t[6]*=n,t[10]*=e,t[3]*=i,t[7]*=n,t[11]*=e,this},getMaxScaleOnAxis:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t);t=Math.sin(t);var n=1-i,r=e.x,o=e.y,s=n*r,a=n*o;return this.set(s*r+i,s*o-t*(e=e.z),s*e+t*o,0,s*o+t*e,a*o+i,a*e-t*r,0,s*e-t*o,a*e+t*r,n*e*e+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,i){var n=this.elements,r=t._x,o=t._y,s=t._z,a=t._w,c=r+r,l=o+o,d=s+s;t=r*c;var h=r*l;r*=d;var u=o*l;o*=d,s*=d,c*=a,l*=a,a*=d,d=i.x;var p=i.y;return i=i.z,n[0]=(1-(u+s))*d,n[1]=(h+a)*d,n[2]=(r-l)*d,n[3]=0,n[4]=(h-a)*p,n[5]=(1-(t+s))*p,n[6]=(o+c)*p,n[7]=0,n[8]=(r+l)*i,n[9]=(o-c)*i,n[10]=(1-(t+u))*i,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this},decompose:function(){var e=new o,t=new n;return function(i,n,r){var o=this.elements,s=e.set(o[0],o[1],o[2]).length(),a=e.set(o[4],o[5],o[6]).length(),c=e.set(o[8],o[9],o[10]).length();0>this.determinant()&&(s=-s),i.x=o[12],i.y=o[13],i.z=o[14],t.copy(this),o=1/a;var l=1/c;return t.elements[0]*=i=1/s,t.elements[1]*=i,t.elements[2]*=i,t.elements[4]*=o,t.elements[5]*=o,t.elements[6]*=o,t.elements[8]*=l,t.elements[9]*=l,t.elements[10]*=l,n.setFromRotationMatrix(t),r.x=s,r.y=a,r.z=c,this}}(),makePerspective:function(e,t,i,n,r,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var s=this.elements;return s[0]=2*r/(t-e),s[4]=0,s[8]=(t+e)/(t-e),s[12]=0,s[1]=0,s[5]=2*r/(i-n),s[9]=(i+n)/(i-n),s[13]=0,s[2]=0,s[6]=0,s[10]=-(o+r)/(o-r),s[14]=-2*o*r/(o-r),s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makeOrthographic:function(e,t,i,n,r,o){var s=this.elements,a=1/(t-e),c=1/(i-n),l=1/(o-r);return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-(t+e)*a,s[1]=0,s[5]=2*c,s[9]=0,s[13]=-(i+n)*c,s[2]=0,s[6]=0,s[10]=-2*l,s[14]=-(o+r)*l,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(e){var t=this.elements;e=e.elements;for(var i=0;16>i;i++)if(t[i]!==e[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;16>i;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}),Object.assign(r,{slerp:function(e,t,i,n){return i.copy(e).slerp(t,n)},slerpFlat:function(e,t,i,n,r,o,s){var a=i[n+0],c=i[n+1],l=i[n+2];i=i[n+3],n=r[o+0];var d=r[o+1],h=r[o+2];if(i!==(r=r[o+3])||a!==n||c!==d||l!==h){o=1-s;var u=a*n+c*d+l*h+i*r,p=0<=u?1:-1,m=1-u*u;m>Number.EPSILON&&(m=Math.sqrt(m),u=Math.atan2(m,u*p),o=Math.sin(o*u)/m,s=Math.sin(s*u)/m),a=a*o+n*(p*=s),c=c*o+d*p,l=l*o+h*p,i=i*o+r*p,o===1-s&&(a*=s=1/Math.sqrt(a*a+c*c+l*l+i*i),c*=s,l*=s,i*=s)}e[t]=a,e[t+1]=c,e[t+2]=l,e[t+3]=i}}),Object.defineProperties(r.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),Object.assign(r.prototype,{isQuaternion:!0,set:function(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=e._x,n=e._y,r=e._z;e=e.order;var o=Math.cos,s=Math.sin,a=o(i/2),c=o(n/2);return o=o(r/2),i=s(i/2),n=s(n/2),r=s(r/2),"XYZ"===e?(this._x=i*c*o+a*n*r,this._y=a*n*o-i*c*r,this._z=a*c*r+i*n*o,this._w=a*c*o-i*n*r):"YXZ"===e?(this._x=i*c*o+a*n*r,this._y=a*n*o-i*c*r,this._z=a*c*r-i*n*o,this._w=a*c*o+i*n*r):"ZXY"===e?(this._x=i*c*o-a*n*r,this._y=a*n*o+i*c*r,this._z=a*c*r+i*n*o,this._w=a*c*o-i*n*r):"ZYX"===e?(this._x=i*c*o-a*n*r,this._y=a*n*o+i*c*r,this._z=a*c*r-i*n*o,this._w=a*c*o+i*n*r):"YZX"===e?(this._x=i*c*o+a*n*r,this._y=a*n*o+i*c*r,this._z=a*c*r-i*n*o,this._w=a*c*o-i*n*r):"XZY"===e&&(this._x=i*c*o-a*n*r,this._y=a*n*o-i*c*r,this._z=a*c*r+i*n*o,this._w=a*c*o+i*n*r),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){t/=2;var i=Math.sin(t);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(t),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t=e.elements,i=t[0];e=t[4];var n=t[8],r=t[1],o=t[5],s=t[9],a=t[2],c=t[6],l=i+o+(t=t[10]);return 0<l?(i=.5/Math.sqrt(l+1),this._w=.25/i,this._x=(c-s)*i,this._y=(n-a)*i,this._z=(r-e)*i):i>o&&i>t?(i=2*Math.sqrt(1+i-o-t),this._w=(c-s)/i,this._x=.25*i,this._y=(e+r)/i,this._z=(n+a)/i):o>t?(i=2*Math.sqrt(1+o-i-t),this._w=(n-a)/i,this._x=(e+r)/i,this._y=.25*i,this._z=(s+c)/i):(i=2*Math.sqrt(1+t-i-o),this._w=(r-e)/i,this._x=(n+a)/i,this._y=(s+c)/i,this._z=.25*i),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t=new o;return function(i,n){return void 0===t&&(t=new o),1e-6>(e=i.dot(n)+1)?(e=0,Math.abs(i.x)>Math.abs(i.z)?t.set(-i.y,i.x,0):t.set(0,-i.z,i.y)):t.crossVectors(i,n),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize()}}(),angleTo:function(e){return 2*Math.acos(Math.abs(to.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var i=this.angleTo(e);return 0===i?this:(this.slerp(e,Math.min(1,t/i)),this)},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._z=this._y=this._x=0,this._w=1):(this._x*=e=1/e,this._y*=e,this._z*=e,this._w*=e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var i=e._x,n=e._y,r=e._z,o=t._x,s=t._y,a=t._z;return this._x=i*(t=t._w)+(e=e._w)*o+n*a-r*s,this._y=n*t+e*s+r*o-i*a,this._z=r*t+e*a+i*s-n*o,this._w=e*t-i*o-n*s-r*a,this.onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,n=this._y,r=this._z,o=this._w,s=o*e._w+i*e._x+n*e._y+r*e._z;if(0>s?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),1<=s)return this._w=o,this._x=i,this._y=n,this._z=r,this;if((e=1-s*s)<=Number.EPSILON)return this._w=(s=1-t)*o+t*this._w,this._x=s*i+t*this._x,this._y=s*n+t*this._y,this._z=s*r+t*this._z,this.normalize();e=Math.sqrt(e);var a=Math.atan2(e,s);return s=Math.sin((1-t)*a)/e,t=Math.sin(t*a)/e,this._w=o*s+this._w*t,this._x=i*s+this._x*t,this._y=n*s+this._y*t,this._z=r*s+this._z*t,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(o.prototype,{isVector3:!0,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setScalar:function(e){return this.z=this.y=this.x=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e=new r;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}}(),applyAxisAngle:function(){var e=new r;return function(t,i){return this.applyQuaternion(e.setFromAxisAngle(t,i))}}(),applyMatrix3:function(e){var t=this.x,i=this.y,n=this.z;return this.x=(e=e.elements)[0]*t+e[3]*i+e[6]*n,this.y=e[1]*t+e[4]*i+e[7]*n,this.z=e[2]*t+e[5]*i+e[8]*n,this},applyMatrix4:function(e){var t=this.x,i=this.y,n=this.z,r=1/((e=e.elements)[3]*t+e[7]*i+e[11]*n+e[15]);return this.x=(e[0]*t+e[4]*i+e[8]*n+e[12])*r,this.y=(e[1]*t+e[5]*i+e[9]*n+e[13])*r,this.z=(e[2]*t+e[6]*i+e[10]*n+e[14])*r,this},applyQuaternion:function(e){var t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,s=e.z,a=(e=e.w)*t+o*n-s*i,c=e*i+s*t-r*n,l=e*n+r*i-o*t;return this.x=a*e+(t=-r*t-o*i-s*n)*-r+c*-s-l*-o,this.y=c*e+t*-o+l*-r-a*-s,this.z=l*e+t*-s+a*-o-c*-r,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(){var e=new n;return function(t){return this.applyMatrix4(e.getInverse(t.projectionMatrix)).applyMatrix4(t.matrixWorld)}}(),transformDirection:function(e){var t=this.x,i=this.y,n=this.z;return this.x=(e=e.elements)[0]*t+e[4]*i+e[8]*n,this.y=e[1]*t+e[5]*i+e[9]*n,this.z=e[2]*t+e[6]*i+e[10]*n,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e=new o,t=new o;return function(i,n){return e.set(i,i,i),t.set(n,n,n),this.clamp(e,t)}}(),clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var i=e.x,n=e.y,r=t.x,o=t.y;return this.x=n*(t=t.z)-(e=e.z)*o,this.y=e*r-i*t,this.z=i*o-n*r,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e=new o;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new o;return function(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){return e=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq()),Math.acos(to.clamp(e,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i+(e=this.z-e.z)*e},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,i){var n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){return this.x=(e=e.elements)[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length();return e=this.setFromMatrixColumn(e,2).length(),this.x=t,this.y=i,this.z=e,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),Object.assign(s.prototype,{isMatrix3:!0,set:function(e,t,i,n,r,o,s,a,c){var l=this.elements;return l[0]=e,l[1]=n,l[2]=s,l[3]=t,l[4]=r,l[5]=a,l[6]=i,l[7]=o,l[8]=c,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements;return t[0]=(e=e.elements)[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],this},setFromMatrix4:function(e){return this.set((e=e.elements)[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(){var e=new o;return function(t){for(var i=0,n=t.count;i<n;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.applyMatrix3(this),t.setXYZ(i,e.x,e.y,e.z);return t}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,n=t.elements;e=i[0];var r=i[3],o=i[6],s=i[1],a=i[4],c=i[7],l=i[2],d=i[5];i=i[8];var h=n[0],u=n[3],p=n[6],m=n[1],f=n[4],g=n[7],v=n[2],y=n[5];return n=n[8],(t=this.elements)[0]=e*h+r*m+o*v,t[3]=e*u+r*f+o*y,t[6]=e*p+r*g+o*n,t[1]=s*h+a*m+c*v,t[4]=s*u+a*f+c*y,t[7]=s*p+a*g+c*n,t[2]=l*h+d*m+i*v,t[5]=l*u+d*f+i*y,t[8]=l*p+d*g+i*n,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],s=e[5],a=e[6],c=e[7];return t*o*(e=e[8])-t*s*c-i*r*e+i*s*a+n*r*c-n*o*a},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var i=e.elements;e=this.elements;var n=i[0],r=i[1],o=i[2],s=i[3],a=i[4],c=i[5],l=i[6],d=i[7],h=(i=i[8])*a-c*d,u=c*l-i*s,p=d*s-a*l,m=n*h+r*u+o*p;if(0===m){if(!0===t)throw Error("THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0");return console.warn("THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0"),this.identity()}return e[0]=h*(t=1/m),e[1]=(o*d-i*r)*t,e[2]=(c*r-o*a)*t,e[3]=u*t,e[4]=(i*n-o*l)*t,e[5]=(o*s-c*n)*t,e[6]=p*t,e[7]=(r*l-d*n)*t,e[8]=(a*n-r*s)*t,this},transpose:function(){var e=this.elements,t=e[1];return e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,i,n,r,o,s){var a=Math.cos(r);r=Math.sin(r),this.set(i*a,i*r,-i*(a*o+r*s)+o+e,-n*r,n*a,-n*(-r*o+a*s)+s+t,0,0,1)},scale:function(e,t){var i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this},rotate:function(e){var t=Math.cos(e);e=Math.sin(e);var i=this.elements,n=i[0],r=i[3],o=i[6],s=i[1],a=i[4],c=i[7];return i[0]=t*n+e*s,i[3]=t*r+e*a,i[6]=t*o+e*c,i[1]=-e*n+t*s,i[4]=-e*r+t*a,i[7]=-e*o+t*c,this},translate:function(e,t){var i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this},equals:function(e){var t=this.elements;e=e.elements;for(var i=0;9>i;i++)if(t[i]!==e[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;9>i;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}});var io,no={getDataURL:function(e){if("undefined"==typeof HTMLCanvasElement)return e.src;if(!(e instanceof HTMLCanvasElement)){void 0===io&&(io=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),io.width=e.width,io.height=e.height;var t=io.getContext("2d");e instanceof ImageData?t.putImageData(e,0,0):t.drawImage(e,0,0,e.width,e.height),e=io}return 2048<e.width||2048<e.height?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}},ro=0;a.DEFAULT_IMAGE=void 0,a.DEFAULT_MAPPING=300,a.prototype=Object.assign(Object.create(t.prototype),{constructor:a,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var n=this.image;if(void 0===n.uuid&&(n.uuid=to.generateUUID()),!t&&void 0===e.images[n.uuid]){if(Array.isArray(n))for(var r=[],o=0,s=n.length;o<s;o++)r.push(no.getDataURL(n[o]));else r=no.getDataURL(n);e.images[n.uuid]={uuid:n.uuid,url:r}}i.image=n.uuid}return t||(e.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),0>e.x||1<e.x)switch(this.wrapS){case 1e3:e.x-=Math.floor(e.x);break;case 1001:e.x=0>e.x?0:1;break;case 1002:e.x=1===Math.abs(Math.floor(e.x)%2)?Math.ceil(e.x)-e.x:e.x-Math.floor(e.x)}if(0>e.y||1<e.y)switch(this.wrapT){case 1e3:e.y-=Math.floor(e.y);break;case 1001:e.y=0>e.y?0:1;break;case 1002:e.y=1===Math.abs(Math.floor(e.y)%2)?Math.ceil(e.y)-e.y:e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(a.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(c.prototype,{isVector4:!0,set:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},setScalar:function(e){return this.w=this.z=this.y=this.x=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,i=this.y,n=this.z,r=this.w;return this.x=(e=e.elements)[0]*t+e[4]*i+e[8]*n+e[12]*r,this.y=e[1]*t+e[5]*i+e[9]*n+e[13]*r,this.z=e[2]*t+e[6]*i+e[10]*n+e[14]*r,this.w=e[3]*t+e[7]*i+e[11]*n+e[15]*r,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.z=this.y=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t=(e=e.elements)[0],i=e[4],n=e[8],r=e[1],o=e[5],s=e[9],a=e[2],c=e[6],l=e[10];return.01>Math.abs(i-r)&&.01>Math.abs(n-a)&&.01>Math.abs(s-c)?.1>Math.abs(i+r)&&.1>Math.abs(n+a)&&.1>Math.abs(s+c)&&.1>Math.abs(t+o+l-3)?(this.set(1,0,0,0),this):(e=Math.PI,l=(l+1)/2,i=(i+r)/4,n=(n+a)/4,s=(s+c)/4,(t=(t+1)/2)>(o=(o+1)/2)&&t>l?.01>t?(c=0,i=a=.707106781):(a=i/(c=Math.sqrt(t)),i=n/c):o>l?.01>o?(c=.707106781,a=0,i=.707106781):(c=i/(a=Math.sqrt(o)),i=s/a):.01>l?(a=c=.707106781,i=0):(c=n/(i=Math.sqrt(l)),a=s/i),this.set(c,a,i,e),this):(e=Math.sqrt((c-s)*(c-s)+(n-a)*(n-a)+(r-i)*(r-i)),.001>Math.abs(e)&&(e=1),this.x=(c-s)/e,this.y=(n-a)/e,this.z=(r-i)/e,this.w=Math.acos((t+o+l-1)/2),this)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function(i,n){return void 0===e&&(e=new c,t=new c),e.set(i,i,i,i),t.set(n,n,n,n),this.clamp(e,t)}}(),clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),l.prototype=Object.assign(Object.create(t.prototype),{constructor:l,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(d.prototype=Object.create(l.prototype)).constructor=d,d.prototype.isWebGLRenderTargetCube=!0,(h.prototype=Object.create(a.prototype)).constructor=h,h.prototype.isDataTexture=!0,Object.assign(u.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,i=1/0,n=1/0,r=-1/0,o=-1/0,s=-1/0,a=0,c=e.length;a<c;a+=3){var l=e[a],d=e[a+1],h=e[a+2];l<t&&(t=l),d<i&&(i=d),h<n&&(n=h),l>r&&(r=l),d>o&&(o=d),h>s&&(s=h)}return this.min.set(t,i,n),this.max.set(r,o,s),this},setFromBufferAttribute:function(e){for(var t=1/0,i=1/0,n=1/0,r=-1/0,o=-1/0,s=-1/0,a=0,c=e.count;a<c;a++){var l=e.getX(a),d=e.getY(a),h=e.getZ(a);l<t&&(t=l),d<i&&(i=d),h<n&&(n=h),l>r&&(r=l),d>o&&(o=d),h>s&&(s=h)}return this.min.set(t,i,n),this.max.set(r,o,s),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new o;return function(t,i){return i=e.copy(i).multiplyScalar(.5),this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new o),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new o),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){function e(e){var o=e.geometry;if(void 0!==o)if(o.isGeometry)for(i=0,n=(o=o.vertices).length;i<n;i++)r.copy(o[i]),r.applyMatrix4(e.matrixWorld),t.expandByPoint(r);else if(o.isBufferGeometry&&void 0!==(o=o.attributes.position))for(i=0,n=o.count;i<n;i++)r.fromBufferAttribute(o,i).applyMatrix4(e.matrixWorld),t.expandByPoint(r)}var t,i,n,r=new o;return function(i){return t=this,i.updateMatrixWorld(!0),i.traverse(e),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new o),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(){var e=new o;return function(t){return this.clampPoint(t.center,e),e.distanceToSquared(t.center)<=t.radius*t.radius}}(),intersectsPlane:function(e){if(0<e.normal.x)var t=e.normal.x*this.min.x,i=e.normal.x*this.max.x;else t=e.normal.x*this.max.x,i=e.normal.x*this.min.x;return 0<e.normal.y?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant},intersectsTriangle:function(){function e(e){var r,o=0;for(r=e.length-3;o<=r;o+=3){c.fromArray(e,o);var s=d.x*Math.abs(c.x)+d.y*Math.abs(c.y)+d.z*Math.abs(c.z),a=t.dot(c),l=i.dot(c),h=n.dot(c);if(Math.max(-Math.max(a,l,h),Math.min(a,l,h))>s)return!1}return!0}var t=new o,i=new o,n=new o,r=new o,s=new o,a=new o,c=new o,l=new o,d=new o,h=new o;return function(o){return!this.isEmpty()&&(this.getCenter(l),d.subVectors(this.max,l),t.subVectors(o.a,l),i.subVectors(o.b,l),n.subVectors(o.c,l),r.subVectors(i,t),s.subVectors(n,i),a.subVectors(t,n),!!e(o=[0,-r.z,r.y,0,-s.z,s.y,0,-a.z,a.y,r.z,0,-r.x,s.z,0,-s.x,a.z,0,-a.x,-r.y,r.x,0,-s.y,s.x,0,-a.y,a.x,0])&&!!e(o=[1,0,0,0,1,0,0,0,1])&&(h.crossVectors(r,s),e(o=[h.x,h.y,h.z])))}}(),clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new o),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new o;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new o;return function(t){return void 0===t&&(console.warn("THREE.Box3: .getBoundingSphere() target is now required"),t=new p),this.getCenter(t.center),t.radius=.5*this.getSize(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new o,new o,new o,new o,new o,new o,new o,new o];return function(t){return this.isEmpty()?this:(e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(e),this)}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(p.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new u;return function(t,i){var n=this.center;void 0!==i?n.copy(i):e.setFromPoints(t).getCenter(n);for(var r=i=0,o=t.length;r<o;r++)i=Math.max(i,n.distanceToSquared(t[r]));return this.radius=Math.sqrt(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var i=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new o),t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new u),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius*=e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign(m.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new o,t=new o;return function(i,n,r){return n=e.subVectors(r,n).cross(t.subVectors(i,n)).normalize(),this.setFromNormalAndCoplanarPoint(n,i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new o),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var e=new o;return function(t,i){void 0===i&&(console.warn("THREE.Plane: .intersectLine() target is now required"),i=new o);var n=t.delta(e),r=this.normal.dot(n);if(0===r){if(0===this.distanceToPoint(t.start))return i.copy(t.start)}else if(!(0>(r=-(t.start.dot(this.normal)+this.constant)/r)||1<r))return i.copy(n).multiplyScalar(r).add(t.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start);return e=this.distanceToPoint(e.end),0>t&&0<e||0>e&&0<t},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new o),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new o,t=new s;return function(i,n){return n=n||t.getNormalMatrix(i),i=this.coplanarPoint(e).applyMatrix4(i),n=this.normal.applyMatrix3(n).normalize(),this.constant=-i.dot(n),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(f.prototype,{set:function(e,t,i,n,r,o){var s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(i),s[3].copy(n),s[4].copy(r),s[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,i=0;6>i;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,n=i[1],r=i[2],o=i[3],s=i[4],a=i[5],c=i[6],l=i[7],d=i[8],h=i[9],u=i[10],p=i[11],m=i[12],f=i[13],g=i[14];return t[0].setComponents(o-(e=i[0]),l-s,p-d,(i=i[15])-m).normalize(),t[1].setComponents(o+e,l+s,p+d,i+m).normalize(),t[2].setComponents(o+n,l+a,p+h,i+f).normalize(),t[3].setComponents(o-n,l-a,p-h,i-f).normalize(),t[4].setComponents(o-r,l-c,p-u,i-g).normalize(),t[5].setComponents(o+r,l+c,p+u,i+g).normalize(),this},intersectsObject:function(){var e=new p;return function(t){var i=t.geometry;return null===i.boundingSphere&&i.computeBoundingSphere(),e.copy(i.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSprite:function(){var e=new p;return function(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){var t=this.planes,i=e.center;e=-e.radius;for(var n=0;6>n;n++)if(t[n].distanceToPoint(i)<e)return!1;return!0},intersectsBox:function(){var e=new o;return function(t){for(var i=this.planes,n=0;6>n;n++){var r=i[n];if(e.x=0<r.normal.x?t.max.x:t.min.x,e.y=0<r.normal.y?t.max.y:t.min.y,e.z=0<r.normal.z?t.max.z:t.min.z,0>r.distanceToPoint(e))return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,i=0;6>i;i++)if(0>t[i].distanceToPoint(e))return!1;return!0}});var oo={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV( sampler2D envMap, vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent ));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif",normal_fragment_maps:"#ifdef USE_NORMALMAP\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t#ifdef FLIP_SIDED\n\t\t\tnormal = - normal;\n\t\t#endif\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\tnormal = normalize( normalMatrix * normal );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\t#ifdef OBJECTSPACE_NORMALMAP\n\t\tuniform mat3 normalMatrix;\n\t#else\n\t\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\t\tvec2 st0 = dFdx( vUv.st );\n\t\t\tvec2 st1 = dFdy( vUv.st );\n\t\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\t\tvec3 N = normalize( surf_norm );\n\t\t\tmat3 tsn = mat3( S, T, N );\n\t\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\t\tmapN.xy *= normalScale;\n\t\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\treturn normalize( tsn * mapN );\n\t\t}\n\t#endif\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || ( defined( USE_NORMALMAP ) && ! defined( OBJECTSPACE_NORMALMAP ) )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},so={clone:g,merge:v},ao={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Object.assign(y.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.b=this.g=this.r=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSL:function(){function e(e,t,i){return 0>i&&(i+=1),1<i&&--i,i<1/6?e+6*(t-e)*i:.5>i?t:i<2/3?e+6*(t-e)*(2/3-i):e}return function(t,i,n){return t=to.euclideanModulo(t,1),i=to.clamp(i,0,1),n=to.clamp(n,0,1),0===i?this.r=this.g=this.b=n:(this.r=e(n=2*n-(i=.5>=n?n*(1+i):n+i-n*i),i,t+1/3),this.g=e(n,i,t),this.b=e(n,i,t-1/3)),this}}(),setStyle:function(e){function t(t){void 0!==t&&1>parseFloat(t)&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var n=i[2];switch(i[1]){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[5]),this;if(i=/^(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(n)){n=parseFloat(i[1])/360;var r=parseInt(i[2],10)/100,o=parseInt(i[3],10)/100;return t(i[5]),this.setHSL(n,r,o)}}}else if(i=/^#([A-Fa-f0-9]+)$/.exec(e)){if(3===(n=(i=i[1]).length))return this.r=parseInt(i.charAt(0)+i.charAt(0),16)/255,this.g=parseInt(i.charAt(1)+i.charAt(1),16)/255,this.b=parseInt(i.charAt(2)+i.charAt(2),16)/255,this;if(6===n)return this.r=parseInt(i.charAt(0)+i.charAt(1),16)/255,this.g=parseInt(i.charAt(2)+i.charAt(3),16)/255,this.b=parseInt(i.charAt(4)+i.charAt(5),16)/255,this}return e&&0<e.length&&(void 0!==(i=ao[e])?this.setHex(i):console.warn("THREE.Color: Unknown color "+e)),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){return void 0===t&&(t=2),t=0<t?1/t:1,this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(){function e(e){return.04045>e?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}return function(t){return this.r=e(t.r),this.g=e(t.g),this.b=e(t.b),this}}(),copyLinearToSRGB:function(){function e(e){return.0031308>e?12.92*e:1.055*Math.pow(e,.41666)-.055}return function(t){return this.r=e(t.r),this.g=e(t.g),this.b=e(t.b),this}}(),convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,i=this.r,n=this.g,r=this.b,o=Math.max(i,n,r),s=Math.min(i,n,r),a=(s+o)/2;if(s===o)s=t=0;else{var c=o-s;switch(s=.5>=a?c/(o+s):c/(2-o-s),o){case i:t=(n-r)/c+(n<r?6:0);break;case n:t=(r-i)/c+2;break;case r:t=(i-n)/c+4}t/=6}return e.h=t,e.s=s,e.l=a,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(){var e={};return function(t,i,n){return this.getHSL(e),e.h+=t,e.s+=i,e.l+=n,this.setHSL(e.h,e.s,e.l),this}}(),add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(){var e={h:0,s:0,l:0},t={h:0,s:0,l:0};return function(i,n){this.getHSL(e),i.getHSL(t),i=to.lerp(e.h,t.h,n);var r=to.lerp(e.s,t.s,n);return n=to.lerp(e.l,t.l,n),this.setHSL(i,r,n),this}}(),equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}});var co={common:{diffuse:{value:new y(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new s},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new i(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new y(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new y(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new s}},sprite:{diffuse:{value:new y(15658734)},opacity:{value:1},center:{value:new i(.5,.5)},rotation:{value:0},map:{value:null},uvTransform:{value:new s}}},lo={basic:{uniforms:v([co.common,co.specularmap,co.envmap,co.aomap,co.lightmap,co.fog]),vertexShader:oo.meshbasic_vert,fragmentShader:oo.meshbasic_frag},lambert:{uniforms:v([co.common,co.specularmap,co.envmap,co.aomap,co.lightmap,co.emissivemap,co.fog,co.lights,{emissive:{value:new y(0)}}]),vertexShader:oo.meshlambert_vert,fragmentShader:oo.meshlambert_frag},phong:{uniforms:v([co.common,co.specularmap,co.envmap,co.aomap,co.lightmap,co.emissivemap,co.bumpmap,co.normalmap,co.displacementmap,co.gradientmap,co.fog,co.lights,{emissive:{value:new y(0)},specular:{value:new y(1118481)},shininess:{value:30}}]),vertexShader:oo.meshphong_vert,fragmentShader:oo.meshphong_frag},standard:{uniforms:v([co.common,co.envmap,co.aomap,co.lightmap,co.emissivemap,co.bumpmap,co.normalmap,co.displacementmap,co.roughnessmap,co.metalnessmap,co.fog,co.lights,{emissive:{value:new y(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:oo.meshphysical_vert,fragmentShader:oo.meshphysical_frag},matcap:{uniforms:v([co.common,co.bumpmap,co.normalmap,co.displacementmap,co.fog,{matcap:{value:null}}]),vertexShader:oo.meshmatcap_vert,fragmentShader:oo.meshmatcap_frag},points:{uniforms:v([co.points,co.fog]),vertexShader:oo.points_vert,fragmentShader:oo.points_frag},dashed:{uniforms:v([co.common,co.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:oo.linedashed_vert,fragmentShader:oo.linedashed_frag},depth:{uniforms:v([co.common,co.displacementmap]),vertexShader:oo.depth_vert,fragmentShader:oo.depth_frag},normal:{uniforms:v([co.common,co.bumpmap,co.normalmap,co.displacementmap,{opacity:{value:1}}]),vertexShader:oo.normal_vert,fragmentShader:oo.normal_frag},sprite:{uniforms:v([co.sprite,co.fog]),vertexShader:oo.sprite_vert,fragmentShader:oo.sprite_frag},background:{uniforms:{uvTransform:{value:new s},t2D:{value:null}},vertexShader:oo.background_vert,fragmentShader:oo.background_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:oo.cube_vert,fragmentShader:oo.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:oo.equirect_vert,fragmentShader:oo.equirect_frag},distanceRGBA:{uniforms:v([co.common,co.displacementmap,{referencePosition:{value:new o},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:oo.distanceRGBA_vert,fragmentShader:oo.distanceRGBA_frag},shadow:{uniforms:v([co.lights,co.fog,{color:{value:new y(0)},opacity:{value:1}}]),vertexShader:oo.shadow_vert,fragmentShader:oo.shadow_frag}};lo.physical={uniforms:v([lo.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:oo.meshphysical_vert,fragmentShader:oo.meshphysical_frag},Object.assign(w.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}),x.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" "),x.DefaultOrder="XYZ",Object.defineProperties(x.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}}),Object.assign(x.prototype,{isEuler:!0,set:function(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._order=n||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,i){var n=to.clamp,r=e.elements;e=r[0];var o=r[4],s=r[8],a=r[1],c=r[5],l=r[9],d=r[2],h=r[6];return r=r[10],"XYZ"===(t=t||this._order)?(this._y=Math.asin(n(s,-1,1)),.99999>Math.abs(s)?(this._x=Math.atan2(-l,r),this._z=Math.atan2(-o,e)):(this._x=Math.atan2(h,c),this._z=0)):"YXZ"===t?(this._x=Math.asin(-n(l,-1,1)),.99999>Math.abs(l)?(this._y=Math.atan2(s,r),this._z=Math.atan2(a,c)):(this._y=Math.atan2(-d,e),this._z=0)):"ZXY"===t?(this._x=Math.asin(n(h,-1,1)),.99999>Math.abs(h)?(this._y=Math.atan2(-d,r),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(a,e))):"ZYX"===t?(this._y=Math.asin(-n(d,-1,1)),.99999>Math.abs(d)?(this._x=Math.atan2(h,r),this._z=Math.atan2(a,e)):(this._x=0,this._z=Math.atan2(-o,c))):"YZX"===t?(this._z=Math.asin(n(a,-1,1)),.99999>Math.abs(a)?(this._x=Math.atan2(-l,c),this._y=Math.atan2(-d,e)):(this._x=0,this._y=Math.atan2(s,r))):"XZY"===t?(this._z=Math.asin(-n(o,-1,1)),.99999>Math.abs(o)?(this._x=Math.atan2(h,c),this._y=Math.atan2(s,e)):(this._x=Math.atan2(-l,r),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==i&&this.onChangeCallback(),this},setFromQuaternion:function(){var e=new n;return function(t,i,n){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,i,n)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new r;return function(t){return e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new o(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(C.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask=this.mask|1<<e|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},test:function(e){return 0!=(this.mask&e.mask)}});var ho=0;S.DefaultUp=new o(0,1,0),S.DefaultMatrixAutoUpdate=!0,S.prototype=Object.assign(Object.create(t.prototype),{constructor:S,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new r;return function(t,i){return e.setFromAxisAngle(t,i),this.quaternion.multiply(e),this}}(),rotateOnWorldAxis:function(){var e=new r;return function(t,i){return e.setFromAxisAngle(t,i),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new o(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new o(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new o(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new o;return function(t,i){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(i)),this}}(),translateX:function(){var e=new o(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new o(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new o(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new n;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new r,t=new n,i=new o,s=new o;return function(n,r,o){n.isVector3?i.copy(n):i.set(n,r,o),n=this.parent,this.updateWorldMatrix(!0,!1),s.setFromMatrixPosition(this.matrixWorld),this.isCamera?t.lookAt(s,i,this.up):t.lookAt(i,s,this.up),this.quaternion.setFromRotationMatrix(t),n&&(t.extractRotation(n.matrixWorld),e.setFromRotationMatrix(t),this.quaternion.premultiply(e.inverse()))}}(),add:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}return-1!==(t=this.children.indexOf(e))&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(t,1)),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var i=0,n=this.children.length;i<n;i++){var r=this.children[i].getObjectByProperty(e,t);if(void 0!==r)return r}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new o),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new o,t=new o;return function(i){return void 0===i&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),i=new r),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,i,t),i}}(),getWorldScale:function(){var e=new o,t=new r;return function(i){return void 0===i&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),i=new o),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,i),i}}(),getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new o),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,i=0,n=t.length;i<n;i++)t[i].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,i=0,n=t.length;i<n;i++)t[i].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(t=0,i=(e=this.children).length;t<i;t++)e[t].updateWorldMatrix(!1,!0)},toJSON:function(e){function t(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}function i(e){var t,i=[];for(t in e){var n=e[t];delete n.metadata,i.push(n)}return i}var n=void 0===e||"string"==typeof e,r={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var o={};if(o.uuid=this.uuid,o.type=this.type,""!==this.name&&(o.name=this.name),!0===this.castShadow&&(o.castShadow=!0),!0===this.receiveShadow&&(o.receiveShadow=!0),!1===this.visible&&(o.visible=!1),!1===this.frustumCulled&&(o.frustumCulled=!1),0!==this.renderOrder&&(o.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(o.matrixAutoUpdate=!1),this.isMesh||this.isLine||this.isPoints){o.geometry=t(e.geometries,this.geometry);var s=this.geometry.parameters;if(void 0!==s&&void 0!==s.shapes)if(s=s.shapes,Array.isArray(s))for(var a=0,c=s.length;a<c;a++)t(e.shapes,s[a]);else t(e.shapes,s)}if(void 0!==this.material)if(Array.isArray(this.material)){for(s=[],a=0,c=this.material.length;a<c;a++)s.push(t(e.materials,this.material[a]));o.material=s}else o.material=t(e.materials,this.material);if(0<this.children.length)for(o.children=[],a=0;a<this.children.length;a++)o.children.push(this.children[a].toJSON(e).object);if(n){n=i(e.geometries),a=i(e.materials),c=i(e.textures);var l=i(e.images);s=i(e.shapes),0<n.length&&(r.geometries=n),0<a.length&&(r.materials=a),0<c.length&&(r.textures=c),0<l.length&&(r.images=l),0<s.length&&(r.shapes=s)}return r.object=o,r},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(t=0;t<e.children.length;t++)this.add(e.children[t].clone());return this}});var uo=0;E.prototype=Object.assign(Object.create(t.prototype),{constructor:E,isGeometry:!0,applyMatrix:function(e){for(var t=(new s).getNormalMatrix(e),i=0,n=this.vertices.length;i<n;i++)this.vertices[i].applyMatrix4(e);for(i=0,n=this.faces.length;i<n;i++){(e=this.faces[i]).normal.applyMatrix3(t).normalize();for(var r=0,o=e.vertexNormals.length;r<o;r++)e.vertexNormals[r].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.normalsNeedUpdate=this.verticesNeedUpdate=!0,this},rotateX:function(){var e=new n;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new n;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new n;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new n;return function(t,i,n){return e.makeTranslation(t,i,n),this.applyMatrix(e),this}}(),scale:function(){var e=new n;return function(t,i,n){return e.makeScale(t,i,n),this.applyMatrix(e),this}}(),lookAt:function(){var e=new S;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){function t(e,t,r,s){var a=void 0===l?[]:[n.colors[e].clone(),n.colors[t].clone(),n.colors[r].clone()];s=new w(e,t,r,void 0===c?[]:[(new o).fromArray(c,3*e),(new o).fromArray(c,3*t),(new o).fromArray(c,3*r)],a,s),n.faces.push(s),void 0!==d&&n.faceVertexUvs[0].push([(new i).fromArray(d,2*e),(new i).fromArray(d,2*t),(new i).fromArray(d,2*r)]),void 0!==h&&n.faceVertexUvs[1].push([(new i).fromArray(h,2*e),(new i).fromArray(h,2*t),(new i).fromArray(h,2*r)])}var n=this,r=null!==e.index?e.index.array:void 0,s=e.attributes,a=s.position.array,c=void 0!==s.normal?s.normal.array:void 0,l=void 0!==s.color?s.color.array:void 0,d=void 0!==s.uv?s.uv.array:void 0,h=void 0!==s.uv2?s.uv2.array:void 0;void 0!==h&&(this.faceVertexUvs[1]=[]);for(var u=s=0;s<a.length;s+=3,u+=2)n.vertices.push((new o).fromArray(a,s)),void 0!==l&&n.colors.push((new y).fromArray(l,s));var p=e.groups;if(0<p.length)for(s=0;s<p.length;s++){var m=(a=p[s]).start;for(u=m,m+=a.count;u<m;u+=3)void 0!==r?t(r[u],r[u+1],r[u+2],a.materialIndex):t(u,u+1,u+2,a.materialIndex)}else if(void 0!==r)for(s=0;s<r.length;s+=3)t(r[s],r[s+1],r[s+2]);else for(s=0;s<a.length/3;s+=3)t(s,s+1,s+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){var e=new o;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius;t=0===t?1:1/t;var i=new n;return i.set(t,0,0,-t*e.x,0,t,0,-t*e.y,0,0,t,-t*e.z,0,0,0,1),this.applyMatrix(i),this},computeFaceNormals:function(){for(var e=new o,t=new o,i=0,n=this.faces.length;i<n;i++){var r=this.faces[i],s=this.vertices[r.a],a=this.vertices[r.b];e.subVectors(this.vertices[r.c],a),t.subVectors(s,a),e.cross(t),e.normalize(),r.normal.copy(e)}},computeVertexNormals:function(e){var t;void 0===e&&(e=!0);var i=Array(this.vertices.length),n=0;for(t=this.vertices.length;n<t;n++)i[n]=new o;if(e){var r=new o,s=new o;for(e=0,n=this.faces.length;e<n;e++){var a=this.vertices[(t=this.faces[e]).a],c=this.vertices[t.b];r.subVectors(this.vertices[t.c],c),s.subVectors(a,c),r.cross(s),i[t.a].add(r),i[t.b].add(r),i[t.c].add(r)}}else for(this.computeFaceNormals(),e=0,n=this.faces.length;e<n;e++)i[(t=this.faces[e]).a].add(t.normal),i[t.b].add(t.normal),i[t.c].add(t.normal);for(n=0,t=this.vertices.length;n<t;n++)i[n].normalize();for(e=0,n=this.faces.length;e<n;e++)3===(a=(t=this.faces[e]).vertexNormals).length?(a[0].copy(i[t.a]),a[1].copy(i[t.b]),a[2].copy(i[t.c])):(a[0]=i[t.a].clone(),a[1]=i[t.b].clone(),a[2]=i[t.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e;this.computeFaceNormals();var t=0;for(e=this.faces.length;t<e;t++){var i=this.faces[t],n=i.vertexNormals;3===n.length?(n[0].copy(i.normal),n[1].copy(i.normal),n[2].copy(i.normal)):(n[0]=i.normal.clone(),n[1]=i.normal.clone(),n[2]=i.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,i=0;for(t=this.faces.length;i<t;i++){var n=this.faces[i];n.__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]);var r=0;for(e=n.vertexNormals.length;r<e;r++)n.__originalVertexNormals[r]?n.__originalVertexNormals[r].copy(n.vertexNormals[r]):n.__originalVertexNormals[r]=n.vertexNormals[r].clone()}var s=new E;for(s.faces=this.faces,r=0,e=this.morphTargets.length;r<e;r++){if(!this.morphNormals[r]){this.morphNormals[r]={},this.morphNormals[r].faceNormals=[],this.morphNormals[r].vertexNormals=[],n=this.morphNormals[r].faceNormals;var a=this.morphNormals[r].vertexNormals;for(i=0,t=this.faces.length;i<t;i++){var c=new o,l={a:new o,b:new o,c:new o};n.push(c),a.push(l)}}for(a=this.morphNormals[r],s.vertices=this.morphTargets[r].vertices,s.computeFaceNormals(),s.computeVertexNormals(),i=0,t=this.faces.length;i<t;i++)l=a.vertexNormals[i],(c=a.faceNormals[i]).copy((n=this.faces[i]).normal),l.a.copy(n.vertexNormals[0]),l.b.copy(n.vertexNormals[1]),l.c.copy(n.vertexNormals[2])}for(i=0,t=this.faces.length;i<t;i++)(n=this.faces[i]).normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new u),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new p),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,i){if(e&&e.isGeometry){var n,r=this.vertices.length,o=this.vertices,a=e.vertices,c=this.faces,l=e.faces,d=this.faceVertexUvs[0],h=e.faceVertexUvs[0],u=this.colors,p=e.colors;void 0===i&&(i=0),void 0!==t&&(n=(new s).getNormalMatrix(t)),e=0;for(var m=a.length;e<m;e++){var f=a[e].clone();void 0!==t&&f.applyMatrix4(t),o.push(f)}for(e=0,m=p.length;e<m;e++)u.push(p[e].clone());for(e=0,m=l.length;e<m;e++){var g=(a=l[e]).vertexNormals;for(p=a.vertexColors,(u=new w(a.a+r,a.b+r,a.c+r)).normal.copy(a.normal),void 0!==n&&u.normal.applyMatrix3(n).normalize(),t=0,o=g.length;t<o;t++)f=g[t].clone(),void 0!==n&&f.applyMatrix3(n).normalize(),u.vertexNormals.push(f);for(u.color.copy(a.color),t=0,o=p.length;t<o;t++)u.vertexColors.push((f=p[t]).clone());u.materialIndex=a.materialIndex+i,c.push(u)}for(e=0,m=h.length;e<m;e++)if(n=[],void 0!==(i=h[e])){for(t=0,o=i.length;t<o;t++)n.push(i[t].clone());d.push(n)}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t={},i=[],n=[],r=Math.pow(10,4),o=0;for(e=this.vertices.length;o<e;o++){var s=this.vertices[o];void 0===t[s=Math.round(s.x*r)+"_"+Math.round(s.y*r)+"_"+Math.round(s.z*r)]?(t[s]=o,i.push(this.vertices[o]),n[o]=i.length-1):n[o]=n[t[s]]}for(t=[],o=0,e=this.faces.length;o<e;o++)for((r=this.faces[o]).a=n[r.a],r.b=n[r.b],r.c=n[r.c],r=[r.a,r.b,r.c],s=0;3>s;s++)if(r[s]===r[(s+1)%3]){t.push(o);break}for(o=t.length-1;0<=o;o--)for(this.faces.splice(r=t[o],1),n=0,e=this.faceVertexUvs.length;n<e;n++)this.faceVertexUvs[n].splice(r,1);return o=this.vertices.length-i.length,this.vertices=i,o},setFromPoints:function(e){this.vertices=[];for(var t=0,i=e.length;t<i;t++){var n=e[t];this.vertices.push(new o(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,i=0;i<t;i++)e[i]._id=i;e.sort(function(e,t){return e.materialIndex-t.materialIndex});var n,r,o=this.faceVertexUvs[0],s=this.faceVertexUvs[1];for(o&&o.length===t&&(n=[]),s&&s.length===t&&(r=[]),i=0;i<t;i++){var a=e[i]._id;n&&n.push(o[a]),r&&r.push(s[a])}n&&(this.faceVertexUvs[0]=n),r&&(this.faceVertexUvs[1]=r)},toJSON:function(){function e(e,t,i){return i?e|1<<t:e&~(1<<t)}function t(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]?l[t]:(l[t]=c.length/3,c.push(e.x,e.y,e.z),l[t])}function i(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==h[t]?h[t]:(h[t]=d.length,d.push(e.getHex()),h[t])}function n(e){var t=e.x.toString()+e.y.toString();return void 0!==p[t]?p[t]:(p[t]=u.length/2,u.push(e.x,e.y),p[t])}var r={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),void 0!==this.parameters){var o,s=this.parameters;for(o in s)void 0!==s[o]&&(r[o]=s[o]);return r}for(s=[],o=0;o<this.vertices.length;o++){var a=this.vertices[o];s.push(a.x,a.y,a.z)}a=[];var c=[],l={},d=[],h={},u=[],p={};for(o=0;o<this.faces.length;o++){var m=this.faces[o],f=void 0!==this.faceVertexUvs[0][o],g=0<m.normal.length(),v=0<m.vertexNormals.length,y=1!==m.color.r||1!==m.color.g||1!==m.color.b,b=0<m.vertexColors.length,_=0;_=e(_,0,0),_=e(_,1,!0),_=e(_,2,!1),_=e(_,3,f),_=e(_,4,g),_=e(_,5,v),_=e(_,6,y),_=e(_,7,b),a.push(_),a.push(m.a,m.b,m.c),a.push(m.materialIndex),f&&a.push(n((f=this.faceVertexUvs[0][o])[0]),n(f[1]),n(f[2])),g&&a.push(t(m.normal)),v&&a.push(t((g=m.vertexNormals)[0]),t(g[1]),t(g[2])),y&&a.push(i(m.color)),b&&a.push(i((m=m.vertexColors)[0]),i(m[1]),i(m[2]))}return r.data={},r.data.vertices=s,r.data.normals=c,0<d.length&&(r.data.colors=d),0<u.length&&(r.data.uvs=[u]),r.data.faces=a,r},clone:function(){return(new E).copy(this)},copy:function(e){var t,i,n;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.name=e.name;var r=e.vertices,o=0;for(t=r.length;o<t;o++)this.vertices.push(r[o].clone());for(o=0,t=(r=e.colors).length;o<t;o++)this.colors.push(r[o].clone());for(o=0,t=(r=e.faces).length;o<t;o++)this.faces.push(r[o].clone());for(o=0,t=e.faceVertexUvs.length;o<t;o++){var s=e.faceVertexUvs[o];for(void 0===this.faceVertexUvs[o]&&(this.faceVertexUvs[o]=[]),r=0,i=s.length;r<i;r++){var a=s[r],c=[],l=0;for(n=a.length;l<n;l++)c.push(a[l].clone());this.faceVertexUvs[o].push(c)}}for(o=0,t=(l=e.morphTargets).length;o<t;o++){if((n={}).name=l[o].name,void 0!==l[o].vertices)for(n.vertices=[],r=0,i=l[o].vertices.length;r<i;r++)n.vertices.push(l[o].vertices[r].clone());if(void 0!==l[o].normals)for(n.normals=[],r=0,i=l[o].normals.length;r<i;r++)n.normals.push(l[o].normals[r].clone());this.morphTargets.push(n)}for(o=0,t=(l=e.morphNormals).length;o<t;o++){if(n={},void 0!==l[o].vertexNormals)for(n.vertexNormals=[],r=0,i=l[o].vertexNormals.length;r<i;r++)(a={}).a=(s=l[o].vertexNormals[r]).a.clone(),a.b=s.b.clone(),a.c=s.c.clone(),n.vertexNormals.push(a);if(void 0!==l[o].faceNormals)for(n.faceNormals=[],r=0,i=l[o].faceNormals.length;r<i;r++)n.faceNormals.push(l[o].faceNormals[r].clone());this.morphNormals.push(n)}for(o=0,t=(r=e.skinWeights).length;o<t;o++)this.skinWeights.push(r[o].clone());for(o=0,t=(r=e.skinIndices).length;o<t;o++)this.skinIndices.push(r[o].clone());for(o=0,t=(r=e.lineDistances).length;o<t;o++)this.lineDistances.push(r[o]);return null!==(o=e.boundingBox)&&(this.boundingBox=o.clone()),null!==(o=e.boundingSphere)&&(this.boundingSphere=o.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(M.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(M.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.itemSize:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,i){e*=this.itemSize,i*=t.itemSize;for(var n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,i=0,n=0,r=e.length;n<r;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),o=new y),t[i++]=o.r,t[i++]=o.g,t[i++]=o.b}return this},copyVector2sArray:function(e){for(var t=this.array,n=0,r=0,o=e.length;r<o;r++){var s=e[r];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),s=new i),t[n++]=s.x,t[n++]=s.y}return this},copyVector3sArray:function(e){for(var t=this.array,i=0,n=0,r=e.length;n<r;n++){var s=e[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),s=new o),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z}return this},copyVector4sArray:function(e){for(var t=this.array,i=0,n=0,r=e.length;n<r;n++){var o=e[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),o=new c),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z,t[i++]=o.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,i){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=i,this},setXYZ:function(e,t,i,n){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=i,this.array[e+2]=n,this},setXYZW:function(e,t,i,n,r){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),(T.prototype=Object.create(M.prototype)).constructor=T,(A.prototype=Object.create(M.prototype)).constructor=A,(R.prototype=Object.create(M.prototype)).constructor=R,(D.prototype=Object.create(M.prototype)).constructor=D,(L.prototype=Object.create(M.prototype)).constructor=L,(I.prototype=Object.create(M.prototype)).constructor=I,(O.prototype=Object.create(M.prototype)).constructor=O,(P.prototype=Object.create(M.prototype)).constructor=P,(H.prototype=Object.create(M.prototype)).constructor=H,Object.assign(N.prototype,{computeGroups:function(e){var t=[],i=void 0;e=e.faces;for(var n=0;n<e.length;n++){var r=e[n];if(r.materialIndex!==i){i=r.materialIndex,void 0!==o&&(o.count=3*n-o.start,t.push(o));var o={start:3*n,materialIndex:i}}}void 0!==o&&(o.count=3*n-o.start,t.push(o)),this.groups=t},fromGeometry:function(e){var t=e.faces,n=e.vertices,r=e.faceVertexUvs,o=r[0]&&0<r[0].length,s=r[1]&&0<r[1].length,a=e.morphTargets,c=a.length;if(0<c){for(var l=[],d=0;d<c;d++)l[d]={name:a[d].name,data:[]};this.morphTargets.position=l}var h=e.morphNormals,u=h.length;if(0<u){var p=[];for(d=0;d<u;d++)p[d]={name:h[d].name,data:[]};this.morphTargets.normal=p}var m=e.skinIndices,f=e.skinWeights,g=m.length===n.length,v=f.length===n.length;for(0<n.length&&0===t.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported."),d=0;d<t.length;d++){var y=t[d];this.vertices.push(n[y.a],n[y.b],n[y.c]);var b=y.vertexNormals;for(3===b.length?this.normals.push(b[0],b[1],b[2]):this.normals.push(b=y.normal,b,b),3===(b=y.vertexColors).length?this.colors.push(b[0],b[1],b[2]):this.colors.push(b=y.color,b,b),!0===o&&(void 0!==(b=r[0][d])?this.uvs.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",d),this.uvs.push(new i,new i,new i))),!0===s&&(void 0!==(b=r[1][d])?this.uvs2.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",d),this.uvs2.push(new i,new i,new i))),b=0;b<c;b++){var _=a[b].vertices;l[b].data.push(_[y.a],_[y.b],_[y.c])}for(b=0;b<u;b++)p[b].data.push((_=h[b].vertexNormals[d]).a,_.b,_.c);g&&this.skinIndices.push(m[y.a],m[y.b],m[y.c]),v&&this.skinWeights.push(f[y.a],f[y.b],f[y.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}});var po=1;F.prototype=Object.assign(Object.create(t.prototype),{constructor:F,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){this.index=Array.isArray(e)?new(65535<z(e)?O:L)(e,1):e},addAttribute:function(e,t,i){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):(this.attributes[e]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(e,new M(t,i)))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,i){this.groups.push({start:e,count:t,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;return void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0),void 0!==(t=this.attributes.normal)&&((new s).getNormalMatrix(e).applyToBufferAttribute(t),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e=new n;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new n;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new n;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new n;return function(t,i,n){return e.makeTranslation(t,i,n),this.applyMatrix(e),this}}(),scale:function(){var e=new n;return function(t,i,n){return e.makeScale(t,i,n),this.applyMatrix(e),this}}(),lookAt:function(){var e=new S;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){var e=new o;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){e=new P(3*t.vertices.length,3);var i=new P(3*t.colors.length,3);this.addAttribute("position",e.copyVector3sArray(t.vertices)),this.addAttribute("color",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length&&(e=new P(t.lineDistances.length,1),this.addAttribute("lineDistance",e.copyArray(t.lineDistances))),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],i=0,n=e.length;i<n;i++){var r=e[i];t.push(r.x,r.y,r.z||0)}return this.addAttribute("position",new P(t,3)),this},updateFromObject:function(e){var t=e.geometry;if(e.isMesh){var i=t.__directGeometry;if(!0===t.elementsNeedUpdate&&(i=void 0,t.elementsNeedUpdate=!1),void 0===i)return this.fromGeometry(t);i.verticesNeedUpdate=t.verticesNeedUpdate,i.normalsNeedUpdate=t.normalsNeedUpdate,i.colorsNeedUpdate=t.colorsNeedUpdate,i.uvsNeedUpdate=t.uvsNeedUpdate,i.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=i}return!0===t.verticesNeedUpdate&&(void 0!==(i=this.attributes.position)&&(i.copyVector3sArray(t.vertices),i.needsUpdate=!0),t.verticesNeedUpdate=!1),!0===t.normalsNeedUpdate&&(void 0!==(i=this.attributes.normal)&&(i.copyVector3sArray(t.normals),i.needsUpdate=!0),t.normalsNeedUpdate=!1),!0===t.colorsNeedUpdate&&(void 0!==(i=this.attributes.color)&&(i.copyColorsArray(t.colors),i.needsUpdate=!0),t.colorsNeedUpdate=!1),t.uvsNeedUpdate&&(void 0!==(i=this.attributes.uv)&&(i.copyVector2sArray(t.uvs),i.needsUpdate=!0),t.uvsNeedUpdate=!1),t.lineDistancesNeedUpdate&&(void 0!==(i=this.attributes.lineDistance)&&(i.copyArray(t.lineDistances),i.needsUpdate=!0),t.lineDistancesNeedUpdate=!1),t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new N).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);for(var i in this.addAttribute("position",new M(t,3).copyVector3sArray(e.vertices)),0<e.normals.length&&(t=new Float32Array(3*e.normals.length),this.addAttribute("normal",new M(t,3).copyVector3sArray(e.normals))),0<e.colors.length&&(t=new Float32Array(3*e.colors.length),this.addAttribute("color",new M(t,3).copyColorsArray(e.colors))),0<e.uvs.length&&(t=new Float32Array(2*e.uvs.length),this.addAttribute("uv",new M(t,2).copyVector2sArray(e.uvs))),0<e.uvs2.length&&(t=new Float32Array(2*e.uvs2.length),this.addAttribute("uv2",new M(t,2).copyVector2sArray(e.uvs2))),this.groups=e.groups,e.morphTargets){t=[];for(var n=e.morphTargets[i],r=0,o=n.length;r<o;r++){var s=n[r],a=new P(3*s.data.length,3);a.name=s.name,t.push(a.copyVector3sArray(s.data))}this.morphAttributes[i]=t}return 0<e.skinIndices.length&&(i=new P(4*e.skinIndices.length,4),this.addAttribute("skinIndex",i.copyVector4sArray(e.skinIndices))),0<e.skinWeights.length&&(i=new P(4*e.skinWeights.length,4),this.addAttribute("skinWeight",i.copyVector4sArray(e.skinWeights))),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new u);var e=this.attributes.position;void 0!==e?this.boundingBox.setFromBufferAttribute(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var e=new u,t=new o;return function(){null===this.boundingSphere&&(this.boundingSphere=new p);var i=this.attributes.position;if(i){var n=this.boundingSphere.center;e.setFromBufferAttribute(i),e.getCenter(n);for(var r=0,o=0,s=i.count;o<s;o++)t.x=i.getX(o),t.y=i.getY(o),t.z=i.getZ(o),r=Math.max(r,n.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var i=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new M(new Float32Array(i.length),3));else for(var n=t.normal.array,r=0,s=n.length;r<s;r++)n[r]=0;n=t.normal.array;var a=new o,c=new o,l=new o,d=new o,h=new o;if(e){var u=e.array;for(r=0,s=e.count;r<s;r+=3){var p=3*u[r+1],m=3*u[r+2];a.fromArray(i,e=3*u[r+0]),c.fromArray(i,p),l.fromArray(i,m),d.subVectors(l,c),h.subVectors(a,c),d.cross(h),n[e]+=d.x,n[e+1]+=d.y,n[e+2]+=d.z,n[p]+=d.x,n[p+1]+=d.y,n[p+2]+=d.z,n[m]+=d.x,n[m+1]+=d.y,n[m+2]+=d.z}}else for(r=0,s=i.length;r<s;r+=9)a.fromArray(i,r),c.fromArray(i,r+3),l.fromArray(i,r+6),d.subVectors(l,c),h.subVectors(a,c),d.cross(h),n[r]=d.x,n[r+1]=d.y,n[r+2]=d.z,n[r+3]=d.x,n[r+4]=d.y,n[r+5]=d.z,n[r+6]=d.x,n[r+7]=d.y,n[r+8]=d.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var i,n=this.attributes;for(i in n)if(void 0!==e.attributes[i]){var r=n[i].array,o=e.attributes[i],s=o.array,a=0;for(o=o.itemSize*t;a<s.length;a++,o++)r[o]=s[a]}return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){var e=new o;return function(){for(var t=this.attributes.normal,i=0,n=t.count;i<n;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.normalize(),t.setXYZ(i,e.x,e.y,e.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e,t=new F,i=this.index.array,n=this.attributes;for(e in n){var r=n[e],o=r.array,s=r.itemSize,a=new o.constructor(i.length*s),c=0;r=0;for(var l=i.length;r<l;r++)for(var d=i[r]*s,h=0;h<s;h++)a[c++]=o[d++];t.addAttribute(e,new M(a,s))}for(r=0,l=(i=this.groups).length;r<l;r++)t.addGroup((n=i[r]).start,n.count,n.materialIndex);return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),0<Object.keys(this.userData).length&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(r in t)void 0!==t[r]&&(e[r]=t[r]);return e}e.data={attributes:{}};var i=this.index;for(r in null!==i&&(t=Array.prototype.slice.call(i.array),e.data.index={type:i.array.constructor.name,array:t}),i=this.attributes){var n=i[r];t=Array.prototype.slice.call(n.array),e.data.attributes[r]={itemSize:n.itemSize,type:n.array.constructor.name,array:t,normalized:n.normalized}}var r=this.groups;return 0<r.length&&(e.data.groups=JSON.parse(JSON.stringify(r))),null!==(r=this.boundingSphere)&&(e.data.boundingSphere={center:r.center.toArray(),radius:r.radius}),e},clone:function(){return(new F).copy(this)},copy:function(e){var t;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingSphere=this.boundingBox=null,this.name=e.name;var i=e.index;for(s in null!==i&&this.setIndex(i.clone()),i=e.attributes)this.addAttribute(s,i[s].clone());var n=e.morphAttributes;for(s in n){var r=[],o=n[s];for(i=0,t=o.length;i<t;i++)r.push(o[i].clone());this.morphAttributes[s]=r}var s=e.groups;for(i=0,t=s.length;i<t;i++)this.addGroup((n=s[i]).start,n.count,n.materialIndex);return null!==(s=e.boundingBox)&&(this.boundingBox=s.clone()),null!==(s=e.boundingSphere)&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),(U.prototype=Object.create(E.prototype)).constructor=U,(B.prototype=Object.create(F.prototype)).constructor=B,(j.prototype=Object.create(E.prototype)).constructor=j,(G.prototype=Object.create(F.prototype)).constructor=G;var mo=0;V.prototype=Object.assign(Object.create(t.prototype),{constructor:V,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0===i)console.warn("THREE.Material: '"+t+"' parameter is undefined.");else if("shading"===t)console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i;else{var n=this[t];void 0===n?console.warn("THREE."+this.type+": '"+t+"' is not a property of this material."):n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i}}},toJSON:function(e){function t(e){var t,i=[];for(t in e){var n=e[t];delete n.metadata,i.push(n)}return i}var i=void 0===e||"string"==typeof e;i&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};return n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearCoat&&(n.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(n.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),0!==this.side&&(n.side=this.side),0!==this.vertexColors&&(n.vertexColors=this.vertexColors),1>this.opacity&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),0<this.alphaTest&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),1<this.wireframeLinewidth&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),i&&(i=t(e.textures),e=t(e.images),0<i.length&&(n.textures=i),0<e.length&&(n.images=e)),n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,i=null;if(null!==t){var n=t.length;i=Array(n);for(var r=0;r!==n;++r)i[r]=t[r].clone()}return this.clippingPlanes=i,this.shadowSide=e.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),($.prototype=Object.create(V.prototype)).constructor=$,$.prototype.isShaderMaterial=!0,$.prototype.copy=function(e){return V.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=g(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},$.prototype.toJSON=function(e){var t=V.prototype.toJSON.call(this,e);for(var i in t.uniforms={},this.uniforms){var n=this.uniforms[i].value;t.uniforms[i]=n.isTexture?{type:"t",value:n.toJSON(e).uuid}:n.isColor?{type:"c",value:n.getHex()}:n.isVector2?{type:"v2",value:n.toArray()}:n.isVector3?{type:"v3",value:n.toArray()}:n.isVector4?{type:"v4",value:n.toArray()}:n.isMatrix4?{type:"m4",value:n.toArray()}:{value:n}}return 0<Object.keys(this.defines).length&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},Object.assign(W.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new o),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new o;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new o),t.subVectors(e,this.origin),0>(e=t.dot(this.direction))?t.copy(this.origin):t.copy(this.direction).multiplyScalar(e).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new o;return function(t){var i=e.subVectors(t,this.origin).dot(this.direction);return 0>i?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(i).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new o,t=new o,i=new o;return function(n,r,o,s){e.copy(n).add(r).multiplyScalar(.5),t.copy(r).sub(n).normalize(),i.copy(this.origin).sub(e);var a=.5*n.distanceTo(r),c=-this.direction.dot(t),l=i.dot(this.direction),d=-i.dot(t),h=i.lengthSq(),u=Math.abs(1-c*c);if(0<u){r=c*l-d;var p=a*u;0<=(n=c*d-l)?r>=-p?r<=p?c=(n*=a=1/u)*(n+c*(r*=a)+2*l)+r*(c*n+r+2*d)+h:(r=a,c=-(n=Math.max(0,-(c*r+l)))*n+r*(r+2*d)+h):(r=-a,c=-(n=Math.max(0,-(c*r+l)))*n+r*(r+2*d)+h):r<=-p?c=-(n=Math.max(0,-(-c*a+l)))*n+(r=0<n?-a:Math.min(Math.max(-a,-d),a))*(r+2*d)+h:r<=p?(n=0,c=(r=Math.min(Math.max(-a,-d),a))*(r+2*d)+h):c=-(n=Math.max(0,-(c*a+l)))*n+(r=0<n?a:Math.min(Math.max(-a,-d),a))*(r+2*d)+h}else r=0<c?-a:a,c=-(n=Math.max(0,-(c*r+l)))*n+r*(r+2*d)+h;return o&&o.copy(this.direction).multiplyScalar(n).add(this.origin),s&&s.copy(t).multiplyScalar(r).add(e),c}}(),intersectSphere:function(){var e=new o;return function(t,i){e.subVectors(t.center,this.origin);var n=e.dot(this.direction),r=e.dot(e)-n*n;return r>(t=t.radius*t.radius)?null:(r=n-(t=Math.sqrt(t-r)),n+=t,0>r&&0>n?null:this.at(0>r?n:r,i))}}(),intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);return 0===t?0===e.distanceToPoint(this.origin)?0:null:0<=(e=-(this.origin.dot(e.normal)+e.constant)/t)?e:null},intersectPlane:function(e,t){return null===(e=this.distanceToPlane(e))?null:this.at(e,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t},intersectBox:function(e,t){var i=1/this.direction.x,n=1/this.direction.y,r=1/this.direction.z,o=this.origin;if(0<=i){var s=(e.min.x-o.x)*i;i*=e.max.x-o.x}else s=(e.max.x-o.x)*i,i*=e.min.x-o.x;if(0<=n){var a=(e.min.y-o.y)*n;n*=e.max.y-o.y}else a=(e.max.y-o.y)*n,n*=e.min.y-o.y;return s>n||a>i?null:((a>s||s!=s)&&(s=a),(n<i||i!=i)&&(i=n),0<=r?(a=(e.min.z-o.z)*r,e=(e.max.z-o.z)*r):(a=(e.max.z-o.z)*r,e=(e.min.z-o.z)*r),s>e||a>i?null:((a>s||s!=s)&&(s=a),(e<i||i!=i)&&(i=e),0>i?null:this.at(0<=s?s:i,t)))},intersectsBox:function(){var e=new o;return function(t){return null!==this.intersectBox(t,e)}}(),intersectTriangle:function(){var e=new o,t=new o,i=new o,n=new o;return function(r,o,s,a,c){if(t.subVectors(o,r),i.subVectors(s,r),n.crossVectors(t,i),0<(o=this.direction.dot(n))){if(a)return null;a=1}else{if(!(0>o))return null;a=-1,o=-o}return e.subVectors(this.origin,r),0>(r=a*this.direction.dot(i.crossVectors(e,i)))?null:0>(s=a*this.direction.dot(t.cross(e)))||r+s>o?null:0>(r=-a*e.dot(n))?null:this.at(r/o,c)}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(q,{getNormal:function(){var e=new o;return function(t,i,n,r){return void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new o),r.subVectors(n,i),e.subVectors(t,i),r.cross(e),0<(t=r.lengthSq())?r.multiplyScalar(1/Math.sqrt(t)):r.set(0,0,0)}}(),getBarycoord:function(){var e=new o,t=new o,i=new o;return function(n,r,s,a,c){e.subVectors(a,r),t.subVectors(s,r),i.subVectors(n,r),n=e.dot(e),r=e.dot(t),s=e.dot(i);var l=t.dot(t);a=t.dot(i);var d=n*l-r*r;return void 0===c&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),c=new o),0===d?c.set(-2,-1,-1):c.set(1-(l=(l*s-r*a)*(d=1/d))-(n=(n*a-r*s)*d),n,l)}}(),containsPoint:function(){var e=new o;return function(t,i,n,r){return q.getBarycoord(t,i,n,r,e),0<=e.x&&0<=e.y&&1>=e.x+e.y}}(),getUV:function(){var e=new o;return function(t,i,n,r,o,s,a,c){return this.getBarycoord(t,i,n,r,e),c.set(0,0),c.addScaledVector(o,e.x),c.addScaledVector(s,e.y),c.addScaledVector(a,e.z),c}}()}),Object.assign(q.prototype,{set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){var e=new o,t=new o;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new o),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return q.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new o),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return q.getBarycoord(e,this.a,this.b,this.c,t)},containsPoint:function(e){return q.containsPoint(e,this.a,this.b,this.c)},getUV:function(e,t,i,n,r){return q.getUV(e,this.a,this.b,this.c,t,i,n,r)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(){var e=new o,t=new o,i=new o,n=new o,r=new o,s=new o;return function(a,c){void 0===c&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),c=new o);var l=this.a,d=this.b,h=this.c;e.subVectors(d,l),t.subVectors(h,l),n.subVectors(a,l);var u=e.dot(n),p=t.dot(n);if(0>=u&&0>=p)return c.copy(l);r.subVectors(a,d);var m=e.dot(r),f=t.dot(r);if(0<=m&&f<=m)return c.copy(d);var g=u*f-m*p;if(0>=g&&0<=u&&0>=m)return d=u/(u-m),c.copy(l).addScaledVector(e,d);s.subVectors(a,h),a=e.dot(s);var v=t.dot(s);return 0<=v&&a<=v?c.copy(h):0>=(u=a*p-u*v)&&0<=p&&0>=v?(g=p/(p-v),c.copy(l).addScaledVector(t,g)):0>=(p=m*v-a*f)&&0<=f-m&&0<=a-v?(i.subVectors(h,d),g=(f-m)/(f-m+(a-v)),c.copy(d).addScaledVector(i,g)):(d=u*(h=1/(p+u+g)),g*=h,c.copy(l).addScaledVector(e,d).addScaledVector(t,g))}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}),(Y.prototype=Object.create(V.prototype)).constructor=Y,Y.prototype.isMeshBasicMaterial=!0,Y.prototype.copy=function(e){return V.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},X.prototype=Object.assign(Object.create(S.prototype),{constructor:X,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return S.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){e=e.morphAttributes;var t=Object.keys(e);if(0<t.length){var i=e[t[0]];if(void 0!==i)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=i.length;e<t;e++){var n=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}else if(void 0!==(i=e.morphTargets)&&0<i.length)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=i.length;e<t;e++)n=i[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e},raycast:function(){function e(e,t,i,n,r,o,s,a){return null===(1===t.side?n.intersectTriangle(s,o,r,!0,a):n.intersectTriangle(r,o,s,2!==t.side,a))?null:(b.copy(a),b.applyMatrix4(e.matrixWorld),(t=i.ray.origin.distanceTo(b))<i.near||t>i.far?null:{distance:t,point:b.clone(),object:e})}function t(t,n,r,o,s,a,h,u,p){return c.fromBufferAttribute(s,h),l.fromBufferAttribute(s,u),d.fromBufferAttribute(s,p),(t=e(t,n,r,o,c,l,d,y))&&(a&&(f.fromBufferAttribute(a,h),g.fromBufferAttribute(a,u),v.fromBufferAttribute(a,p),t.uv=q.getUV(y,c,l,d,f,g,v,new i)),a=new w(h,u,p),q.getNormal(c,l,d,a.normal),t.face=a),t}var r=new n,s=new W,a=new p,c=new o,l=new o,d=new o,h=new o,u=new o,m=new o,f=new i,g=new i,v=new i,y=new o,b=new o;return function(n,o){var p=this.geometry,b=this.material,_=this.matrixWorld;if(void 0!==b&&(null===p.boundingSphere&&p.computeBoundingSphere(),a.copy(p.boundingSphere),a.applyMatrix4(_),!1!==n.ray.intersectsSphere(a)&&(r.getInverse(_),s.copy(n.ray).applyMatrix4(r),null===p.boundingBox||!1!==s.intersectsBox(p.boundingBox))))if(p.isBufferGeometry){var w,x=p.index,C=p.attributes.position,S=p.attributes.uv,E=p.groups;if(p=p.drawRange,null!==x)if(Array.isArray(b)){var M=0;for(w=E.length;M<w;M++){var T=E[M],A=b[T.materialIndex];_=Math.max(T.start,p.start);var k=Math.min(T.start+T.count,p.start+p.count);for(T=_;T<k;T+=3){_=x.getX(T);var R=x.getX(T+1),D=x.getX(T+2);(_=t(this,A,n,s,C,S,_,R,D))&&(_.faceIndex=Math.floor(T/3),o.push(_))}}}else for(M=_=Math.max(0,p.start),w=k=Math.min(x.count,p.start+p.count);M<w;M+=3)_=x.getX(M),R=x.getX(M+1),D=x.getX(M+2),(_=t(this,b,n,s,C,S,_,R,D))&&(_.faceIndex=Math.floor(M/3),o.push(_));else if(void 0!==C)if(Array.isArray(b))for(M=0,w=E.length;M<w;M++)for(A=b[(T=E[M]).materialIndex],_=Math.max(T.start,p.start),k=Math.min(T.start+T.count,p.start+p.count),T=_;T<k;T+=3)(_=t(this,A,n,s,C,S,_=T,R=T+1,D=T+2))&&(_.faceIndex=Math.floor(T/3),o.push(_));else for(M=_=Math.max(0,p.start),w=k=Math.min(C.count,p.start+p.count);M<w;M+=3)(_=t(this,b,n,s,C,S,_=M,R=M+1,D=M+2))&&(_.faceIndex=Math.floor(M/3),o.push(_))}else if(p.isGeometry)for(C=Array.isArray(b),S=p.vertices,0<(_=p.faceVertexUvs[0]).length&&(x=_),T=0,k=(E=p.faces).length;T<k;T++)if(R=E[T],void 0!==(_=C?b[R.materialIndex]:b)){if(M=S[R.a],w=S[R.b],A=S[R.c],!0===_.morphTargets){D=p.morphTargets;var L=this.morphTargetInfluences;c.set(0,0,0),l.set(0,0,0),d.set(0,0,0);for(var I=0,O=D.length;I<O;I++){var P=L[I];if(0!==P){var H=D[I].vertices;c.addScaledVector(h.subVectors(H[R.a],M),P),l.addScaledVector(u.subVectors(H[R.b],w),P),d.addScaledVector(m.subVectors(H[R.c],A),P)}}c.add(M),l.add(w),d.add(A),M=c,w=l,A=d}(_=e(this,_,n,s,M,w,A,y))&&(x&&x[T]&&(f.copy((D=x[T])[0]),g.copy(D[1]),v.copy(D[2]),_.uv=q.getUV(y,M,w,A,f,g,v,new i)),_.face=R,_.faceIndex=T,o.push(_))}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),(ae.prototype=Object.create(a.prototype)).constructor=ae,ae.prototype.isCubeTexture=!0,Object.defineProperty(ae.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),(ce.prototype=Object.create(a.prototype)).constructor=ce,ce.prototype.isDataTexture3D=!0;var fo=new a,go=new ce,vo=new ae,yo=[],bo=[],_o=new Float32Array(16),wo=new Float32Array(9),xo=new Float32Array(4);ze.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),he(t,e)},Fe.prototype.setValue=function(e,t,i){for(var n=this.seq,r=0,o=n.length;r!==o;++r){var s=n[r];s.setValue(e,t[s.id],i)}};var Co=/([\w\d_]+)(\])?(\[|\.)?/g;Ue.prototype.setValue=function(e,t,i){void 0!==(t=this.map[t])&&t.setValue(e,i,this.renderer)},Ue.prototype.setOptional=function(e,t,i){void 0!==(t=t[i])&&this.setValue(e,i,t)},Ue.upload=function(e,t,i,n){for(var r=0,o=t.length;r!==o;++r){var s=t[r],a=i[s.id];!1!==a.needsUpdate&&s.setValue(e,a.value,n)}},Ue.seqWithValue=function(e,t){for(var i=[],n=0,r=e.length;n!==r;++n){var o=e[n];o.id in t&&i.push(o)}return i};var So=0,Eo=0;(ct.prototype=Object.create(V.prototype)).constructor=ct,ct.prototype.isMeshDepthMaterial=!0,ct.prototype.copy=function(e){return V.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},(lt.prototype=Object.create(V.prototype)).constructor=lt,lt.prototype.isMeshDistanceMaterial=!0,lt.prototype.copy=function(e){return V.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},mt.prototype=Object.assign(Object.create(S.prototype),{constructor:mt,isGroup:!0}),ft.prototype=Object.assign(Object.create(S.prototype),{constructor:ft,isCamera:!0,copy:function(e,t){return S.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new o),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){S.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),gt.prototype=Object.assign(Object.create(ft.prototype),{constructor:gt,isPerspectiveCamera:!0,copy:function(e,t){return ft.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){e=.5*this.getFilmHeight()/e,this.fov=2*to.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*to.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*to.RAD2DEG*Math.atan(Math.tan(.5*to.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,i,n,r,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*to.DEG2RAD*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n,o=this.view;if(null!==this.view&&this.view.enabled){var s=o.fullWidth,a=o.fullHeight;r+=o.offsetX*n/s,t-=o.offsetY*i/a,n*=o.width/s,i*=o.height/a}0!==(o=this.filmOffset)&&(r+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,t,t-i,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){return(e=S.prototype.toJSON.call(this,e)).object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}),vt.prototype=Object.assign(Object.create(gt.prototype),{constructor:vt,isArrayCamera:!0});var Mo,To=new o,Ao=new o;xt.prototype.isFogExp2=!0,xt.prototype.clone=function(){return new xt(this.color,this.density)},xt.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},Ct.prototype.isFog=!0,Ct.prototype.clone=function(){return new Ct(this.color,this.near,this.far)},Ct.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},St.prototype=Object.assign(Object.create(S.prototype),{constructor:St,copy:function(e,t){return S.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=S.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}),Object.defineProperty(Et.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Et.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.stride:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,i){e*=this.stride,i*=t.stride;for(var n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Object.defineProperties(Mt.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Mt.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,i){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=i,this},setXYZ:function(e,t,i,n){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this},setXYZW:function(e,t,i,n,r){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}}),(Tt.prototype=Object.create(V.prototype)).constructor=Tt,Tt.prototype.isSpriteMaterial=!0,Tt.prototype.copy=function(e){return V.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this},At.prototype=Object.assign(Object.create(S.prototype),{constructor:At,isSprite:!0,raycast:function(){function e(e,t,i,n,r,o){a.subVectors(e,i).addScalar(.5).multiply(n),void 0!==r?(c.x=o*a.x-r*a.y,c.y=r*a.x+o*a.y):c.copy(a),e.copy(t),e.x+=c.x,e.y+=c.y,e.applyMatrix4(l)}var t=new o,r=new o,s=new o,a=new i,c=new i,l=new n,d=new o,h=new o,u=new o,p=new i,m=new i,f=new i;return function(n,o){r.setFromMatrixScale(this.matrixWorld),l.getInverse(this.modelViewMatrix).premultiply(this.matrixWorld),s.setFromMatrixPosition(this.modelViewMatrix);var a=this.material.rotation;if(0!==a)var c=Math.cos(a),g=Math.sin(a);a=this.center,e(d.set(-.5,-.5,0),s,a,r,g,c),e(h.set(.5,-.5,0),s,a,r,g,c),e(u.set(.5,.5,0),s,a,r,g,c),p.set(0,0),m.set(1,0),f.set(1,1);var v=n.ray.intersectTriangle(d,h,u,!1,t);null===v&&(e(h.set(-.5,.5,0),s,a,r,g,c),m.set(0,1),null===(v=n.ray.intersectTriangle(d,u,h,!1,t)))||(g=n.ray.origin.distanceTo(t))<n.near||g>n.far||o.push({distance:g,point:t.clone(),uv:q.getUV(t,d,h,u,p,m,f,new i),face:null,object:this})}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return S.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}}),kt.prototype=Object.assign(Object.create(S.prototype),{constructor:kt,copy:function(e){S.prototype.copy.call(this,e,!1);for(var t=0,i=(e=e.levels).length;t<i;t++){var n=e[t];this.addLevel(n.object.clone(),n.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var i=this.levels,n=0;n<i.length&&!(t<i[n].distance);n++);i.splice(n,0,{distance:t,object:e}),this.add(e)},getObjectForDistance:function(e){for(var t=this.levels,i=1,n=t.length;i<n&&!(e<t[i].distance);i++);return t[i-1].object},raycast:function(){var e=new o;return function(t,i){e.setFromMatrixPosition(this.matrixWorld);var n=t.ray.origin.distanceTo(e);this.getObjectForDistance(n).raycast(t,i)}}(),update:function(){var e=new o,t=new o;return function(i){var n=this.levels;if(1<n.length){e.setFromMatrixPosition(i.matrixWorld),t.setFromMatrixPosition(this.matrixWorld),i=e.distanceTo(t),n[0].object.visible=!0;for(var r=1,o=n.length;r<o&&i>=n[r].distance;r++)n[r-1].object.visible=!1,n[r].object.visible=!0;for(;r<o;r++)n[r].object.visible=!1}}}(),toJSON:function(e){(e=S.prototype.toJSON.call(this,e)).object.levels=[];for(var t=this.levels,i=0,n=t.length;i<n;i++){var r=t[i];e.object.levels.push({object:r.object.uuid,distance:r.distance})}return e}}),Rt.prototype=Object.assign(Object.create(X.prototype),{constructor:Rt,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new c,t=this.geometry.attributes.skinWeight,i=0,n=t.count;i<n;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);var r=1/e.manhattanLength();1/0!==r?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){X.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Object.assign(Dt.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var i=new n;this.bones[e]&&i.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(i)}},pose:function(){var e,t,i=0;for(t=this.bones.length;i<t;i++)(e=this.bones[i])&&e.matrixWorld.getInverse(this.boneInverses[i]);for(i=0,t=this.bones.length;i<t;i++)(e=this.bones[i])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){var e=new n,t=new n;return function(){for(var i=this.bones,n=this.boneInverses,r=this.boneMatrices,o=this.boneTexture,s=0,a=i.length;s<a;s++)e.multiplyMatrices(i[s]?i[s].matrixWorld:t,n[s]),e.toArray(r,16*s);void 0!==o&&(o.needsUpdate=!0)}}(),clone:function(){return new Dt(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,i=this.bones.length;t<i;t++){var n=this.bones[t];if(n.name===e)return n}}}),Lt.prototype=Object.assign(Object.create(S.prototype),{constructor:Lt,isBone:!0}),(It.prototype=Object.create(V.prototype)).constructor=It,It.prototype.isLineBasicMaterial=!0,It.prototype.copy=function(e){return V.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},Ot.prototype=Object.assign(Object.create(S.prototype),{constructor:Ot,isLine:!0,computeLineDistances:function(){var e=new o,t=new o;return function(){var i=this.geometry;if(i.isBufferGeometry)if(null===i.index){for(var n=i.attributes.position,r=[0],o=1,s=n.count;o<s;o++)e.fromBufferAttribute(n,o-1),t.fromBufferAttribute(n,o),r[o]=r[o-1],r[o]+=e.distanceTo(t);i.addAttribute("lineDistance",new P(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(i.isGeometry)for(n=i.vertices,(r=i.lineDistances)[0]=0,o=1,s=n.length;o<s;o++)r[o]=r[o-1],r[o]+=n[o-1].distanceTo(n[o]);return this}}(),raycast:function(){var e=new n,t=new W,i=new p;return function(n,r){var s=n.linePrecision,a=this.geometry,c=this.matrixWorld;if(null===a.boundingSphere&&a.computeBoundingSphere(),i.copy(a.boundingSphere),i.applyMatrix4(c),i.radius+=s,!1!==n.ray.intersectsSphere(i)){e.getInverse(c),t.copy(n.ray).applyMatrix4(e),s/=(this.scale.x+this.scale.y+this.scale.z)/3,s*=s;var l=new o,d=new o;c=new o;var h=new o,u=this&&this.isLineSegments?2:1;if(a.isBufferGeometry){var p=a.index,m=a.attributes.position.array;if(null!==p){a=0;for(var f=(p=p.array).length-1;a<f;a+=u){var g=p[a+1];l.fromArray(m,3*p[a]),d.fromArray(m,3*g),(g=t.distanceSqToSegment(l,d,h,c))>s||(h.applyMatrix4(this.matrixWorld),(g=n.ray.origin.distanceTo(h))<n.near||g>n.far||r.push({distance:g,point:c.clone().applyMatrix4(this.matrixWorld),index:a,face:null,faceIndex:null,object:this}))}}else for(a=0,f=m.length/3-1;a<f;a+=u)l.fromArray(m,3*a),d.fromArray(m,3*a+3),(g=t.distanceSqToSegment(l,d,h,c))>s||(h.applyMatrix4(this.matrixWorld),(g=n.ray.origin.distanceTo(h))<n.near||g>n.far||r.push({distance:g,point:c.clone().applyMatrix4(this.matrixWorld),index:a,face:null,faceIndex:null,object:this}))}else if(a.isGeometry)for(d=(l=a.vertices).length,a=0;a<d-1;a+=u)(g=t.distanceSqToSegment(l[a],l[a+1],h,c))>s||(h.applyMatrix4(this.matrixWorld),(g=n.ray.origin.distanceTo(h))<n.near||g>n.far||r.push({distance:g,point:c.clone().applyMatrix4(this.matrixWorld),index:a,face:null,faceIndex:null,object:this}))}}}(),copy:function(e){return S.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}}),Pt.prototype=Object.assign(Object.create(Ot.prototype),{constructor:Pt,isLineSegments:!0,computeLineDistances:function(){var e=new o,t=new o;return function(){var i=this.geometry;if(i.isBufferGeometry)if(null===i.index){for(var n=i.attributes.position,r=[],o=0,s=n.count;o<s;o+=2)e.fromBufferAttribute(n,o),t.fromBufferAttribute(n,o+1),r[o]=0===o?0:r[o-1],r[o+1]=r[o]+e.distanceTo(t);i.addAttribute("lineDistance",new P(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(i.isGeometry)for(r=i.lineDistances,o=0,s=(n=i.vertices).length;o<s;o+=2)e.copy(n[o]),t.copy(n[o+1]),r[o]=0===o?0:r[o-1],r[o+1]=r[o]+e.distanceTo(t);return this}}()}),Ht.prototype=Object.assign(Object.create(Ot.prototype),{constructor:Ht,isLineLoop:!0}),(Nt.prototype=Object.create(V.prototype)).constructor=Nt,Nt.prototype.isPointsMaterial=!0,Nt.prototype.copy=function(e){return V.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this},zt.prototype=Object.assign(Object.create(S.prototype),{constructor:zt,isPoints:!0,raycast:function(){var e=new n,t=new W,i=new p;return function(n,r){function s(e,i){var o=t.distanceSqToPoint(e);o<h&&(t.closestPointToPoint(e,u),u.applyMatrix4(l),(e=n.ray.origin.distanceTo(u))<n.near||e>n.far||r.push({distance:e,distanceToRay:Math.sqrt(o),point:u.clone(),index:i,face:null,object:a}))}var a=this,c=this.geometry,l=this.matrixWorld,d=n.params.Points.threshold;if(null===c.boundingSphere&&c.computeBoundingSphere(),i.copy(c.boundingSphere),i.applyMatrix4(l),i.radius+=d,!1!==n.ray.intersectsSphere(i)){e.getInverse(l),t.copy(n.ray).applyMatrix4(e);var h=(d/=(this.scale.x+this.scale.y+this.scale.z)/3)*d;d=new o;var u=new o;if(c.isBufferGeometry){var p=c.index;if(c=c.attributes.position.array,null!==p){var m=p.array;p=0;for(var f=m.length;p<f;p++){var g=m[p];d.fromArray(c,3*g),s(d,g)}}else for(p=0,m=c.length/3;p<m;p++)d.fromArray(c,3*p),s(d,p)}else for(p=0,m=(d=c.vertices).length;p<m;p++)s(d[p],p)}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Ft.prototype=Object.assign(Object.create(a.prototype),{constructor:Ft,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),(Ut.prototype=Object.create(a.prototype)).constructor=Ut,Ut.prototype.isCompressedTexture=!0,(Bt.prototype=Object.create(a.prototype)).constructor=Bt,Bt.prototype.isCanvasTexture=!0,(jt.prototype=Object.create(a.prototype)).constructor=jt,jt.prototype.isDepthTexture=!0,(Gt.prototype=Object.create(F.prototype)).constructor=Gt,(Vt.prototype=Object.create(E.prototype)).constructor=Vt,($t.prototype=Object.create(F.prototype)).constructor=$t,(Wt.prototype=Object.create(E.prototype)).constructor=Wt,(qt.prototype=Object.create(F.prototype)).constructor=qt,(Yt.prototype=Object.create(E.prototype)).constructor=Yt,(Xt.prototype=Object.create(qt.prototype)).constructor=Xt,(Zt.prototype=Object.create(E.prototype)).constructor=Zt,(Kt.prototype=Object.create(qt.prototype)).constructor=Kt,(Jt.prototype=Object.create(E.prototype)).constructor=Jt,(Qt.prototype=Object.create(qt.prototype)).constructor=Qt,(ei.prototype=Object.create(E.prototype)).constructor=ei,(ti.prototype=Object.create(qt.prototype)).constructor=ti,(ii.prototype=Object.create(E.prototype)).constructor=ii,(ni.prototype=Object.create(F.prototype)).constructor=ni,(ri.prototype=Object.create(E.prototype)).constructor=ri,(oi.prototype=Object.create(F.prototype)).constructor=oi,(si.prototype=Object.create(E.prototype)).constructor=si,(ai.prototype=Object.create(F.prototype)).constructor=ai;var ko={area:function(e){for(var t=e.length,i=0,n=t-1,r=0;r<t;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return.5*i},isClockWise:function(e){return 0>ko.area(e)},triangulateShape:function(e,t){var i=[],n=[],r=[];Ci(e),Si(i,e);var o=e.length;for(t.forEach(Ci),e=0;e<t.length;e++)n.push(o),o+=t[e].length,Si(i,t[e]);for(t=function(e,t,i){i=i||2;var n,r=t&&t.length,o=r?t[0]*i:e.length,s=ci(e,0,o,i,!0),a=[];if(!s)return a;if(r){var c,l=i;r=[];var d=0;for(c=t.length;d<c;d++){var h=t[d]*l;(h=ci(e,h,d<c-1?t[d+1]*l:e.length,l,!1))===h.next&&(h.steiner=!0),r.push(pi(h))}for(r.sort(di),d=0;d<r.length;d++)(l=hi(t=r[d],l=s))&&li(t=bi(l,t),t.next),s=li(s,s.next)}if(e.length>80*i){var u=n=e[0],p=r=e[1];for(l=i;l<o;l+=i)(d=e[l])<u&&(u=d),(t=e[l+1])<p&&(p=t),d>n&&(n=d),t>r&&(r=t);n=0!==(n=Math.max(n-u,r-p))?1/n:0}return function e(t,i,n,r,o,s,a){if(t){if(!a&&s){var c=t,l=c;do{null===l.z&&(l.z=ui(l.x,l.y,r,o,s)),l.prevZ=l.prev,l=l.nextZ=l.next}while(l!==c);l.prevZ.nextZ=null,l.prevZ=null,c=l;var d,h,u,p,m=1;do{l=c;var f=c=null;for(h=0;l;){h++;var g=l;for(d=u=0;d<m&&(u++,g=g.nextZ);d++);for(p=m;0<u||0<p&&g;)0!==u&&(0===p||!g||l.z<=g.z)?(d=l,l=l.nextZ,u--):(d=g,g=g.nextZ,p--),f?f.nextZ=d:c=d,d.prevZ=f,f=d;l=g}f.nextZ=null,m*=2}while(1<h)}for(c=t;t.prev!==t.next;){if(l=t.prev,g=t.next,s)e:{p=r;var v=o,y=s;if(0<=fi(h=(f=t).prev,u=f,m=f.next))f=!1;else{var b=h.x>u.x?h.x>m.x?h.x:m.x:u.x>m.x?u.x:m.x,_=h.y>u.y?h.y>m.y?h.y:m.y:u.y>m.y?u.y:m.y;for(d=ui(h.x<u.x?h.x<m.x?h.x:m.x:u.x<m.x?u.x:m.x,h.y<u.y?h.y<m.y?h.y:m.y:u.y<m.y?u.y:m.y,p,v,y),p=ui(b,_,p,v,y),v=f.nextZ;v&&v.z<=p;){if(v!==f.prev&&v!==f.next&&mi(h.x,h.y,u.x,u.y,m.x,m.y,v.x,v.y)&&0<=fi(v.prev,v,v.next)){f=!1;break e}v=v.nextZ}for(v=f.prevZ;v&&v.z>=d;){if(v!==f.prev&&v!==f.next&&mi(h.x,h.y,u.x,u.y,m.x,m.y,v.x,v.y)&&0<=fi(v.prev,v,v.next)){f=!1;break e}v=v.prevZ}f=!0}}else e:if(f=t,h=f.prev,u=f,m=f.next,0<=fi(h,u,m))f=!1;else{for(d=f.next.next;d!==f.prev;){if(mi(h.x,h.y,u.x,u.y,m.x,m.y,d.x,d.y)&&0<=fi(d.prev,d,d.next)){f=!1;break e}d=d.next}f=!0}if(f)i.push(l.i/n),i.push(t.i/n),i.push(g.i/n),wi(t),c=t=g.next;else if((t=g)===c){if(a){if(1===a){a=i,c=n,l=t;do{!gi(g=l.prev,f=l.next.next)&&vi(g,l,l.next,f)&&yi(g,f)&&yi(f,g)&&(a.push(g.i/c),a.push(l.i/c),a.push(f.i/c),wi(l),wi(l.next),l=t=f),l=l.next}while(l!==t);e(t=l,i,n,r,o,s,2)}else if(2===a)e:{a=t;do{for(c=a.next.next;c!==a.prev;){if(l=a.i!==c.i){if(f=(l=a).next.i!==(g=c).i&&l.prev.i!==g.i){t:{f=l;do{if(f.i!==l.i&&f.next.i!==l.i&&f.i!==g.i&&f.next.i!==g.i&&vi(f,f.next,l,g)){f=!0;break t}f=f.next}while(f!==l);f=!1}f=!f}if(f=f&&yi(l,g)&&yi(g,l)){f=l,h=!1,u=(l.x+g.x)/2,g=(l.y+g.y)/2;do{f.y>g!=f.next.y>g&&f.next.y!==f.y&&u<(f.next.x-f.x)*(g-f.y)/(f.next.y-f.y)+f.x&&(h=!h),f=f.next}while(f!==l);f=h}l=f}if(l){t=bi(a,c),a=li(a,a.next),t=li(t,t.next),e(a,i,n,r,o,s),e(t,i,n,r,o,s);break e}c=c.next}a=a.next}while(a!==t)}}else e(li(t),i,n,r,o,s,1);break}}}}(s,a,i,u,p,n),a}(i,n),e=0;e<t.length;e+=3)r.push(t.slice(e,e+3));return r}};(Ei.prototype=Object.create(E.prototype)).constructor=Ei,Ei.prototype.toJSON=function(){var e=E.prototype.toJSON.call(this);return Ti(this.parameters.shapes,this.parameters.options,e)},(Mi.prototype=Object.create(F.prototype)).constructor=Mi,Mi.prototype.toJSON=function(){var e=F.prototype.toJSON.call(this);return Ti(this.parameters.shapes,this.parameters.options,e)};var Ro={generateTopUV:function(e,t,n,r,o){e=t[3*r],r=t[3*r+1];var s=t[3*o];return o=t[3*o+1],[new i(t[3*n],t[3*n+1]),new i(e,r),new i(s,o)]},generateSideWallUV:function(e,t,n,r,o,s){e=t[3*n];var a=t[3*n+1];n=t[3*n+2];var c=t[3*r],l=t[3*r+1];r=t[3*r+2];var d=t[3*o],h=t[3*o+1];o=t[3*o+2];var u=t[3*s],p=t[3*s+1];return t=t[3*s+2],.01>Math.abs(a-l)?[new i(e,1-n),new i(c,1-r),new i(d,1-o),new i(u,1-t)]:[new i(a,1-n),new i(l,1-r),new i(h,1-o),new i(p,1-t)]}};(Ai.prototype=Object.create(E.prototype)).constructor=Ai,(ki.prototype=Object.create(Mi.prototype)).constructor=ki,(Ri.prototype=Object.create(E.prototype)).constructor=Ri,(Di.prototype=Object.create(F.prototype)).constructor=Di,(Li.prototype=Object.create(E.prototype)).constructor=Li,(Ii.prototype=Object.create(F.prototype)).constructor=Ii,(Oi.prototype=Object.create(E.prototype)).constructor=Oi,(Pi.prototype=Object.create(F.prototype)).constructor=Pi,(Hi.prototype=Object.create(E.prototype)).constructor=Hi,Hi.prototype.toJSON=function(){var e=E.prototype.toJSON.call(this);return zi(this.parameters.shapes,e)},(Ni.prototype=Object.create(F.prototype)).constructor=Ni,Ni.prototype.toJSON=function(){var e=F.prototype.toJSON.call(this);return zi(this.parameters.shapes,e)},(Fi.prototype=Object.create(F.prototype)).constructor=Fi,(Ui.prototype=Object.create(E.prototype)).constructor=Ui,(Bi.prototype=Object.create(F.prototype)).constructor=Bi,(ji.prototype=Object.create(Ui.prototype)).constructor=ji,(Gi.prototype=Object.create(Bi.prototype)).constructor=Gi,(Vi.prototype=Object.create(E.prototype)).constructor=Vi,($i.prototype=Object.create(F.prototype)).constructor=$i;var Do=Object.freeze({WireframeGeometry:Gt,ParametricGeometry:Vt,ParametricBufferGeometry:$t,TetrahedronGeometry:Yt,TetrahedronBufferGeometry:Xt,OctahedronGeometry:Zt,OctahedronBufferGeometry:Kt,IcosahedronGeometry:Jt,IcosahedronBufferGeometry:Qt,DodecahedronGeometry:ei,DodecahedronBufferGeometry:ti,PolyhedronGeometry:Wt,PolyhedronBufferGeometry:qt,TubeGeometry:ii,TubeBufferGeometry:ni,TorusKnotGeometry:ri,TorusKnotBufferGeometry:oi,TorusGeometry:si,TorusBufferGeometry:ai,TextGeometry:Ai,TextBufferGeometry:ki,SphereGeometry:Ri,SphereBufferGeometry:Di,RingGeometry:Li,RingBufferGeometry:Ii,PlaneGeometry:j,PlaneBufferGeometry:G,LatheGeometry:Oi,LatheBufferGeometry:Pi,ShapeGeometry:Hi,ShapeBufferGeometry:Ni,ExtrudeGeometry:Ei,ExtrudeBufferGeometry:Mi,EdgesGeometry:Fi,ConeGeometry:ji,ConeBufferGeometry:Gi,CylinderGeometry:Ui,CylinderBufferGeometry:Bi,CircleGeometry:Vi,CircleBufferGeometry:$i,BoxGeometry:U,BoxBufferGeometry:B});(Wi.prototype=Object.create(V.prototype)).constructor=Wi,Wi.prototype.isShadowMaterial=!0,Wi.prototype.copy=function(e){return V.prototype.copy.call(this,e),this.color.copy(e.color),this},(qi.prototype=Object.create($.prototype)).constructor=qi,qi.prototype.isRawShaderMaterial=!0,(Yi.prototype=Object.create(V.prototype)).constructor=Yi,Yi.prototype.isMeshStandardMaterial=!0,Yi.prototype.copy=function(e){return V.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},(Xi.prototype=Object.create(Yi.prototype)).constructor=Xi,Xi.prototype.isMeshPhysicalMaterial=!0,Xi.prototype.copy=function(e){return Yi.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},(Zi.prototype=Object.create(V.prototype)).constructor=Zi,Zi.prototype.isMeshPhongMaterial=!0,Zi.prototype.copy=function(e){return V.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},(Ki.prototype=Object.create(Zi.prototype)).constructor=Ki,Ki.prototype.isMeshToonMaterial=!0,Ki.prototype.copy=function(e){return Zi.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},(Ji.prototype=Object.create(V.prototype)).constructor=Ji,Ji.prototype.isMeshNormalMaterial=!0,Ji.prototype.copy=function(e){return V.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},(Qi.prototype=Object.create(V.prototype)).constructor=Qi,Qi.prototype.isMeshLambertMaterial=!0,Qi.prototype.copy=function(e){return V.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},(en.prototype=Object.create(V.prototype)).constructor=en,en.prototype.isMeshMatcapMaterial=!0,en.prototype.copy=function(e){return V.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},(tn.prototype=Object.create(It.prototype)).constructor=tn,tn.prototype.isLineDashedMaterial=!0,tn.prototype.copy=function(e){return It.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Lo=Object.freeze({ShadowMaterial:Wi,SpriteMaterial:Tt,RawShaderMaterial:qi,ShaderMaterial:$,PointsMaterial:Nt,MeshPhysicalMaterial:Xi,MeshStandardMaterial:Yi,MeshPhongMaterial:Zi,MeshToonMaterial:Ki,MeshNormalMaterial:Ji,MeshLambertMaterial:Qi,MeshDepthMaterial:ct,MeshDistanceMaterial:lt,MeshBasicMaterial:Y,MeshMatcapMaterial:en,LineDashedMaterial:tn,LineBasicMaterial:It,Material:V}),Io={arraySlice:function(e,t,i){return Io.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,i=Array(t),n=0;n!==t;++n)i[n]=n;return i.sort(function(t,i){return e[t]-e[i]}),i},sortedArray:function(e,t,i){for(var n=e.length,r=new e.constructor(n),o=0,s=0;s!==n;++o)for(var a=i[o]*t,c=0;c!==t;++c)r[s++]=e[a+c];return r},flattenJSON:function(e,t,i,n){for(var r=1,o=e[0];void 0!==o&&void 0===o[n];)o=e[r++];if(void 0!==o){var s=o[n];if(void 0!==s)if(Array.isArray(s))do{void 0!==(s=o[n])&&(t.push(o.time),i.push.apply(i,s)),o=e[r++]}while(void 0!==o);else if(void 0!==s.toArray)do{void 0!==(s=o[n])&&(t.push(o.time),s.toArray(i,i.length)),o=e[r++]}while(void 0!==o);else do{void 0!==(s=o[n])&&(t.push(o.time),i.push(s)),o=e[r++]}while(void 0!==o)}}};Object.assign(nn.prototype,{evaluate:function(e){var t=this.parameterPositions,i=this._cachedIndex,n=t[i],r=t[i-1];e:{t:{i:{n:if(!(e<n)){for(var o=i+2;;){if(void 0===n){if(e<r)break n;return this._cachedIndex=i=t.length,this.afterEnd_(i-1,e,r)}if(i===o)break;if(r=n,e<(n=t[++i]))break t}n=t.length;break i}if(e>=r)break e;for(e<(o=t[1])&&(i=2,r=o),o=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(i===o)break;if(n=r,e>=(r=t[--i-1]))break t}n=i,i=0}for(;i<n;)e<t[r=i+n>>>1]?n=r:i=r+1;if(n=t[i],void 0===(r=t[i-1]))return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return this._cachedIndex=i=t.length,this.afterEnd_(i-1,r,e)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){var t=this.resultBuffer,i=this.sampleValues,n=this.valueSize;e*=n;for(var r=0;r!==n;++r)t[r]=i[e+r];return t},interpolate_:function(){throw Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(nn.prototype,{beforeStart_:nn.prototype.copySampleValue_,afterEnd_:nn.prototype.copySampleValue_}),rn.prototype=Object.assign(Object.create(nn.prototype),{constructor:rn,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(e,t,i){var n=this.parameterPositions,r=e-2,o=e+1,s=n[r],a=n[o];if(void 0===s)switch(this.getSettings_().endingStart){case 2401:r=e,s=2*t-i;break;case 2402:s=t+n[r=n.length-2]-n[r+1];break;default:r=e,s=i}if(void 0===a)switch(this.getSettings_().endingEnd){case 2401:o=e,a=2*i-t;break;case 2402:o=1,a=i+n[1]-n[0];break;default:o=e-1,a=t}n=this.valueSize,this._weightPrev=(e=.5*(i-t))/(t-s),this._weightNext=e/(a-i),this._offsetPrev=r*n,this._offsetNext=o*n},interpolate_:function(e,t,i,n){var r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(e*=s)-s,c=this._offsetPrev,l=this._offsetNext,d=this._weightPrev,h=this._weightNext,u=(i-t)/(n-t);for(t=-d*(n=(i=u*u)*u)+2*d*i-d*u,d=(1+d)*n+(-1.5-2*d)*i+(-.5+d)*u+1,u=(-1-h)*n+(1.5+h)*i+.5*u,h=h*n-h*i,i=0;i!==s;++i)r[i]=t*o[c+i]+d*o[a+i]+u*o[e+i]+h*o[l+i];return r}}),on.prototype=Object.assign(Object.create(nn.prototype),{constructor:on,interpolate_:function(e,t,i,n){var r=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(e*=s)-s;for(i=1-(t=(i-t)/(n-t)),n=0;n!==s;++n)r[n]=o[a+n]*i+o[e+n]*t;return r}}),sn.prototype=Object.assign(Object.create(nn.prototype),{constructor:sn,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(an,{toJSON:function(e){var t=e.constructor;if(void 0!==t.toJSON)t=t.toJSON(e);else{t={name:e.name,times:Io.convertArray(e.times,Array),values:Io.convertArray(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}}),Object.assign(an.prototype,{constructor:an,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(e){return new sn(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new on(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new rn(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){switch(e){case 2300:var t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){if(t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name,void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,i=0,n=t.length;i!==n;++i)t[i]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,i=0,n=t.length;i!==n;++i)t[i]*=e;return this},trim:function(e,t){for(var i=this.times,n=i.length,r=0,o=n-1;r!==n&&i[r]<e;)++r;for(;-1!==o&&i[o]>t;)--o;return++o,0===r&&o===n||(r>=o&&(r=(o=Math.max(o,1))-1),e=this.getValueSize(),this.times=Io.arraySlice(i,r,o),this.values=Io.arraySlice(this.values,r*e,o*e)),this},validate:function(){var e=!0,t=this.getValueSize();0!=t-Math.floor(t)&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var i=this.times;t=this.values;var n=i.length;0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var r=null,o=0;o!==n;o++){var s=i[o];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==r&&r>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,r),e=!1;break}r=s}if(void 0!==t&&Io.isTypedArray(t))for(o=0,i=t.length;o!==i;++o)if(n=t[o],isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,n),e=!1;break}return e},optimize:function(){for(var e=this.times,t=this.values,i=this.getValueSize(),n=2302===this.getInterpolation(),r=1,o=e.length-1,s=1;s<o;++s){var a=!1,c=e[s];if(c!==e[s+1]&&(1!==s||c!==c[0]))if(n)a=!0;else{var l=s*i,d=l-i,h=l+i;for(c=0;c!==i;++c){var u=t[l+c];if(u!==t[d+c]||u!==t[h+c]){a=!0;break}}}if(a){if(s!==r)for(e[r]=e[s],a=s*i,l=r*i,c=0;c!==i;++c)t[l+c]=t[a+c];++r}}if(0<o){for(e[r]=e[o],a=o*i,l=r*i,c=0;c!==i;++c)t[l+c]=t[a+c];++r}return r!==e.length&&(this.times=Io.arraySlice(e,0,r),this.values=Io.arraySlice(t,0,r*i)),this}}),cn.prototype=Object.assign(Object.create(an.prototype),{constructor:cn,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ln.prototype=Object.assign(Object.create(an.prototype),{constructor:ln,ValueTypeName:"color"}),dn.prototype=Object.assign(Object.create(an.prototype),{constructor:dn,ValueTypeName:"number"}),hn.prototype=Object.assign(Object.create(nn.prototype),{constructor:hn,interpolate_:function(e,t,i,n){var o=this.resultBuffer,s=this.sampleValues,a=this.valueSize;for(t=(i-t)/(n-t),i=(e*=a)+a;e!==i;e+=4)r.slerpFlat(o,0,s,e-a,s,e,t);return o}}),un.prototype=Object.assign(Object.create(an.prototype),{constructor:un,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(e){return new hn(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),pn.prototype=Object.assign(Object.create(an.prototype),{constructor:pn,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),mn.prototype=Object.assign(Object.create(an.prototype),{constructor:mn,ValueTypeName:"vector"}),Object.assign(fn,{parse:function(e){for(var t=[],i=e.tracks,n=1/(e.fps||1),r=0,o=i.length;r!==o;++r)t.push(gn(i[r]).scale(n));return new fn(e.name,e.duration,t)},toJSON:function(e){var t=[],i=e.tracks;e={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid};for(var n=0,r=i.length;n!==r;++n)t.push(an.toJSON(i[n]));return e},CreateFromMorphTargetSequence:function(e,t,i,n){for(var r=t.length,o=[],s=0;s<r;s++){var a=[],c=[];a.push((s+r-1)%r,s,(s+1)%r),c.push(0,1,0);var l=Io.getKeyframeOrder(a);a=Io.sortedArray(a,1,l),c=Io.sortedArray(c,1,l),n||0!==a[0]||(a.push(r),c.push(c[0])),o.push(new dn(".morphTargetInfluences["+t[s].name+"]",a,c).scale(1/i))}return new fn(e,-1,o)},findByName:function(e,t){var i=e;for(Array.isArray(e)||(i=e.geometry&&e.geometry.animations||e.animations),e=0;e<i.length;e++)if(i[e].name===t)return i[e];return null},CreateClipsFromMorphTargetSequences:function(e,t,i){for(var n={},r=/^([\w-]*?)([\d]+)$/,o=0,s=e.length;o<s;o++){var a=e[o],c=a.name.match(r);if(c&&1<c.length){var l=c[1];(c=n[l])||(n[l]=c=[]),c.push(a)}}for(l in e=[],n)e.push(fn.CreateFromMorphTargetSequence(l,n[l],t,i));return e},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;var i=function(e,t,i,n,r){if(0!==i.length){var o=[],s=[];Io.flattenJSON(i,o,s,n),0!==o.length&&r.push(new e(t,o,s))}},n=[],r=e.name||"default",o=e.length||-1,s=e.fps||30;e=e.hierarchy||[];for(var a=0;a<e.length;a++){var c=e[a].keys;if(c&&0!==c.length)if(c[0].morphTargets){o={};for(var l=0;l<c.length;l++)if(c[l].morphTargets)for(var d=0;d<c[l].morphTargets.length;d++)o[c[l].morphTargets[d]]=-1;for(var h in o){var u=[],p=[];for(d=0;d!==c[l].morphTargets.length;++d){var m=c[l];u.push(m.time),p.push(m.morphTarget===h?1:0)}n.push(new dn(".morphTargetInfluence["+h+"]",u,p))}o=o.length*(s||1)}else i(mn,(l=".bones["+t[a].name+"]")+".position",c,"pos",n),i(un,l+".quaternion",c,"rot",n),i(mn,l+".scale",c,"scl",n)}return 0===n.length?null:new fn(r,o,n)}}),Object.assign(fn.prototype,{resetDuration:function(){for(var e=0,t=0,i=this.tracks.length;t!==i;++t){var n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}});var Oo={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Po=new vn,Ho={};Object.assign(yn.prototype,{load:function(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,o=Oo.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;if(void 0===Ho[e]){var s=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(s){i=s[1];var a=!!s[2];s=s[3],s=decodeURIComponent(s),a&&(s=atob(s));try{var c=(this.responseType||"").toLowerCase();switch(c){case"arraybuffer":case"blob":var l=new Uint8Array(s.length);for(a=0;a<s.length;a++)l[a]=s.charCodeAt(a);var d="blob"===c?new Blob([l.buffer],{type:i}):l.buffer;break;case"document":d=(new DOMParser).parseFromString(s,i);break;case"json":d=JSON.parse(s);break;default:d=s}setTimeout(function(){t&&t(d),r.manager.itemEnd(e)},0)}catch(u){setTimeout(function(){n&&n(u),r.manager.itemError(e),r.manager.itemEnd(e)},0)}}else{Ho[e]=[],Ho[e].push({onLoad:t,onProgress:i,onError:n});var h=new XMLHttpRequest;for(a in h.open("GET",e,!0),h.addEventListener("load",function(t){var i=this.response;Oo.add(e,i);var n=Ho[e];if(delete Ho[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var o=0,s=n.length;o<s;o++){var a=n[o];a.onLoad&&a.onLoad(i)}}else{for(o=0,s=n.length;o<s;o++)(a=n[o]).onError&&a.onError(t);r.manager.itemError(e)}r.manager.itemEnd(e)},!1),h.addEventListener("progress",function(t){for(var i=Ho[e],n=0,r=i.length;n<r;n++){var o=i[n];o.onProgress&&o.onProgress(t)}},!1),h.addEventListener("error",function(t){var i=Ho[e];delete Ho[e];for(var n=0,o=i.length;n<o;n++){var s=i[n];s.onError&&s.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),h.addEventListener("abort",function(t){var i=Ho[e];delete Ho[e];for(var n=0,o=i.length;n<o;n++){var s=i[n];s.onError&&s.onError(t)}r.manager.itemError(e),r.manager.itemEnd(e)},!1),void 0!==this.responseType&&(h.responseType=this.responseType),void 0!==this.withCredentials&&(h.withCredentials=this.withCredentials),h.overrideMimeType&&h.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)h.setRequestHeader(a,this.requestHeader[a]);h.send(null)}return r.manager.itemStart(e),h}Ho[e].push({onLoad:t,onProgress:i,onError:n})},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Object.assign(bn.prototype,{load:function(e,t,i,n){var r=this,o=new yn(r.manager);o.setPath(r.path),o.load(e,function(e){t(r.parse(JSON.parse(e)))},i,n)},parse:function(e,t){for(var i=[],n=0;n<e.length;n++){var r=fn.parse(e[n]);i.push(r)}t(i)},setPath:function(e){return this.path=e,this}}),Object.assign(_n.prototype,{load:function(e,t,i,n){function r(r){c.load(e[r],function(e){e=o._parser(e,!0),s[r]={width:e.width,height:e.height,format:e.format,mipmaps:e.mipmaps},6===(l+=1)&&(1===e.mipmapCount&&(a.minFilter=1006),a.format=e.format,a.needsUpdate=!0,t&&t(a))},i,n)}var o=this,s=[],a=new Ut;a.image=s;var c=new yn(this.manager);if(c.setPath(this.path),c.setResponseType("arraybuffer"),Array.isArray(e))for(var l=0,d=0,h=e.length;d<h;++d)r(d);else c.load(e,function(e){if((e=o._parser(e,!0)).isCubemap)for(var i=e.mipmaps.length/e.mipmapCount,n=0;n<i;n++){s[n]={mipmaps:[]};for(var r=0;r<e.mipmapCount;r++)s[n].mipmaps.push(e.mipmaps[n*e.mipmapCount+r]),s[n].format=e.format,s[n].width=e.width,s[n].height=e.height}else a.image.width=e.width,a.image.height=e.height,a.mipmaps=e.mipmaps;1===e.mipmapCount&&(a.minFilter=1006),a.format=e.format,a.needsUpdate=!0,t&&t(a)},i,n);return a},setPath:function(e){return this.path=e,this}}),Object.assign(wn.prototype,{load:function(e,t,i,n){var r=this,o=new h,s=new yn(this.manager);return s.setResponseType("arraybuffer"),s.setPath(this.path),s.load(e,function(e){(e=r._parser(e))&&(void 0!==e.image?o.image=e.image:void 0!==e.data&&(o.image.width=e.width,o.image.height=e.height,o.image.data=e.data),o.wrapS=void 0!==e.wrapS?e.wrapS:1001,o.wrapT=void 0!==e.wrapT?e.wrapT:1001,o.magFilter=void 0!==e.magFilter?e.magFilter:1006,o.minFilter=void 0!==e.minFilter?e.minFilter:1008,o.anisotropy=void 0!==e.anisotropy?e.anisotropy:1,void 0!==e.format&&(o.format=e.format),void 0!==e.type&&(o.type=e.type),void 0!==e.mipmaps&&(o.mipmaps=e.mipmaps),1===e.mipmapCount&&(o.minFilter=1006),o.needsUpdate=!0,t&&t(o,e))},i,n),o},setPath:function(e){return this.path=e,this}}),Object.assign(xn.prototype,{crossOrigin:"anonymous",load:function(e,t,i,n){function r(){c.removeEventListener("load",r,!1),c.removeEventListener("error",o,!1),Oo.add(e,this),t&&t(this),s.manager.itemEnd(e)}function o(t){c.removeEventListener("load",r,!1),c.removeEventListener("error",o,!1),n&&n(t),s.manager.itemError(e),s.manager.itemEnd(e)}void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var s=this,a=Oo.get(e);if(void 0!==a)return s.manager.itemStart(e),setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0),a;var c=document.createElementNS("http://www.w3.org/1999/xhtml","img");return c.addEventListener("load",r,!1),c.addEventListener("error",o,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(c.crossOrigin=this.crossOrigin),s.manager.itemStart(e),c.src=e,c},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Cn.prototype,{crossOrigin:"anonymous",load:function(e,t,i,n){function r(i){s.load(e[i],function(e){o.images[i]=e,6==++a&&(o.needsUpdate=!0,t&&t(o))},void 0,n)}var o=new ae,s=new xn(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);var a=0;for(i=0;i<e.length;++i)r(i);return o},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Sn.prototype,{crossOrigin:"anonymous",load:function(e,t,i,n){var r=new a,o=new xn(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(i){r.image=i,i=0<e.search(/\.jpe?g($|\?)/i)||0===e.search(/^data:image\/jpeg/),r.format=i?1022:1023,r.needsUpdate=!0,void 0!==t&&t(r)},i,n),r},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(En.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){return e=this.getUtoTmapping(e),this.getPoint(e,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i=[],n=this.getPoint(0),r=0;for(i.push(0),t=1;t<=e;t++){var o=this.getPoint(t/e);r+=o.distanceTo(n),i.push(r),n=o}return this.cacheArcLengths=i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var i=this.getLengths(),n=i.length;t=t||e*i[n-1];for(var r,o=0,s=n-1;o<=s;)if(0>(r=i[e=Math.floor(o+(s-o)/2)]-t))o=e+1;else{if(!(0<r)){s=e;break}s=e-1}return i[e=s]===t?e/(n-1):(e+(t-(o=i[e]))/(i[e+1]-o))/(n-1)},getTangent:function(e){var t=e-1e-4;return 0>t&&(t=0),1<(e+=1e-4)&&(e=1),t=this.getPoint(t),this.getPoint(e).clone().sub(t).normalize()},getTangentAt:function(e){return e=this.getUtoTmapping(e),this.getTangent(e)},computeFrenetFrames:function(e,t){var i,r=new o,s=[],a=[],c=[],l=new o,d=new n;for(i=0;i<=e;i++){var h=i/e;s[i]=this.getTangentAt(h),s[i].normalize()}a[0]=new o,c[0]=new o,i=Number.MAX_VALUE,h=Math.abs(s[0].x);var u=Math.abs(s[0].y),p=Math.abs(s[0].z);for(h<=i&&(i=h,r.set(1,0,0)),u<=i&&(i=u,r.set(0,1,0)),p<=i&&r.set(0,0,1),l.crossVectors(s[0],r).normalize(),a[0].crossVectors(s[0],l),c[0].crossVectors(s[0],a[0]),i=1;i<=e;i++)a[i]=a[i-1].clone(),c[i]=c[i-1].clone(),l.crossVectors(s[i-1],s[i]),l.length()>Number.EPSILON&&(l.normalize(),r=Math.acos(to.clamp(s[i-1].dot(s[i]),-1,1)),a[i].applyMatrix4(d.makeRotationAxis(l,r))),c[i].crossVectors(s[i],a[i]);if(!0===t)for(r=Math.acos(to.clamp(a[0].dot(a[e]),-1,1)),r/=e,0<s[0].dot(l.crossVectors(a[0],a[e]))&&(r=-r),i=1;i<=e;i++)a[i].applyMatrix4(d.makeRotationAxis(s[i],r*i)),c[i].crossVectors(s[i],a[i]);return{tangents:s,normals:a,binormals:c}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),(Mn.prototype=Object.create(En.prototype)).constructor=Mn,Mn.prototype.isEllipseCurve=!0,Mn.prototype.getPoint=function(e,t){t=t||new i;for(var n=2*Math.PI,r=this.aEndAngle-this.aStartAngle,o=Math.abs(r)<Number.EPSILON;0>r;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=o?0:n),!0!==this.aClockwise||o||(r=r===n?-n:r-n),n=this.aStartAngle+e*r,e=this.aX+this.xRadius*Math.cos(n);var s=this.aY+this.yRadius*Math.sin(n);return 0!==this.aRotation&&(n=Math.cos(this.aRotation),r=Math.sin(this.aRotation),e=(o=e-this.aX)*n-(s-=this.aY)*r+this.aX,s=o*r+s*n+this.aY),t.set(e,s)},Mn.prototype.copy=function(e){return En.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Mn.prototype.toJSON=function(){var e=En.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},Mn.prototype.fromJSON=function(e){return En.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},(Tn.prototype=Object.create(Mn.prototype)).constructor=Tn,Tn.prototype.isArcCurve=!0;var No=new o,zo=new An,Fo=new An,Uo=new An;(kn.prototype=Object.create(En.prototype)).constructor=kn,kn.prototype.isCatmullRomCurve3=!0,kn.prototype.getPoint=function(e,t){t=t||new o;var i=this.points,n=i.length;e*=n-(this.closed?0:1);var r=Math.floor(e);if(e-=r,this.closed?r+=0<r?0:(Math.floor(Math.abs(r)/n)+1)*n:0===e&&r===n-1&&(r=n-2,e=1),this.closed||0<r)var s=i[(r-1)%n];else No.subVectors(i[0],i[1]).add(i[0]),s=No;var a=i[r%n],c=i[(r+1)%n];if(this.closed||r+2<n?i=i[(r+2)%n]:(No.subVectors(i[n-1],i[n-2]).add(i[n-1]),i=No),"centripetal"===this.curveType||"chordal"===this.curveType){var l="chordal"===this.curveType?.5:.25;n=Math.pow(s.distanceToSquared(a),l),1e-4>(r=Math.pow(a.distanceToSquared(c),l))&&(r=1),1e-4>n&&(n=r),1e-4>(l=Math.pow(c.distanceToSquared(i),l))&&(l=r),zo.initNonuniformCatmullRom(s.x,a.x,c.x,i.x,n,r,l),Fo.initNonuniformCatmullRom(s.y,a.y,c.y,i.y,n,r,l),Uo.initNonuniformCatmullRom(s.z,a.z,c.z,i.z,n,r,l)}else"catmullrom"===this.curveType&&(zo.initCatmullRom(s.x,a.x,c.x,i.x,this.tension),Fo.initCatmullRom(s.y,a.y,c.y,i.y,this.tension),Uo.initCatmullRom(s.z,a.z,c.z,i.z,this.tension));return t.set(zo.calc(e),Fo.calc(e),Uo.calc(e)),t},kn.prototype.copy=function(e){En.prototype.copy.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++)this.points.push(e.points[t].clone());return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},kn.prototype.toJSON=function(){var e=En.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++)e.points.push(this.points[t].toArray());return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},kn.prototype.fromJSON=function(e){En.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var n=e.points[t];this.points.push((new o).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},(In.prototype=Object.create(En.prototype)).constructor=In,In.prototype.isCubicBezierCurve=!0,In.prototype.getPoint=function(e,t){t=t||new i;var n=this.v0,r=this.v1,o=this.v2,s=this.v3;return t.set(Ln(e,n.x,r.x,o.x,s.x),Ln(e,n.y,r.y,o.y,s.y)),t},In.prototype.copy=function(e){return En.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},In.prototype.toJSON=function(){var e=En.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},In.prototype.fromJSON=function(e){return En.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},(On.prototype=Object.create(En.prototype)).constructor=On,On.prototype.isCubicBezierCurve3=!0,On.prototype.getPoint=function(e,t){t=t||new o;var i=this.v0,n=this.v1,r=this.v2,s=this.v3;return t.set(Ln(e,i.x,n.x,r.x,s.x),Ln(e,i.y,n.y,r.y,s.y),Ln(e,i.z,n.z,r.z,s.z)),t},On.prototype.copy=function(e){return En.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},On.prototype.toJSON=function(){var e=En.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},On.prototype.fromJSON=function(e){return En.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},(Pn.prototype=Object.create(En.prototype)).constructor=Pn,Pn.prototype.isLineCurve=!0,Pn.prototype.getPoint=function(e,t){return t=t||new i,1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t},Pn.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Pn.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},Pn.prototype.copy=function(e){return En.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Pn.prototype.toJSON=function(){var e=En.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Pn.prototype.fromJSON=function(e){return En.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},(Hn.prototype=Object.create(En.prototype)).constructor=Hn,Hn.prototype.isLineCurve3=!0,Hn.prototype.getPoint=function(e,t){return t=t||new o,1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t},Hn.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Hn.prototype.copy=function(e){return En.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Hn.prototype.toJSON=function(){var e=En.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Hn.prototype.fromJSON=function(e){return En.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},(Nn.prototype=Object.create(En.prototype)).constructor=Nn,Nn.prototype.isQuadraticBezierCurve=!0,Nn.prototype.getPoint=function(e,t){t=t||new i;var n=this.v0,r=this.v1,o=this.v2;return t.set(Dn(e,n.x,r.x,o.x),Dn(e,n.y,r.y,o.y)),t},Nn.prototype.copy=function(e){return En.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Nn.prototype.toJSON=function(){var e=En.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Nn.prototype.fromJSON=function(e){return En.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},(zn.prototype=Object.create(En.prototype)).constructor=zn,zn.prototype.isQuadraticBezierCurve3=!0,zn.prototype.getPoint=function(e,t){t=t||new o;var i=this.v0,n=this.v1,r=this.v2;return t.set(Dn(e,i.x,n.x,r.x),Dn(e,i.y,n.y,r.y),Dn(e,i.z,n.z,r.z)),t},zn.prototype.copy=function(e){return En.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},zn.prototype.toJSON=function(){var e=En.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},zn.prototype.fromJSON=function(e){return En.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},(Fn.prototype=Object.create(En.prototype)).constructor=Fn,Fn.prototype.isSplineCurve=!0,Fn.prototype.getPoint=function(e,t){t=t||new i;var n=this.points,r=(n.length-1)*e,o=n[0===(e=Math.floor(r))?e:e-1],s=n[e],a=n[e>n.length-2?n.length-1:e+1];return t.set(Rn(r-=e,o.x,s.x,a.x,(n=n[e>n.length-3?n.length-1:e+2]).x),Rn(r,o.y,s.y,a.y,n.y)),t},Fn.prototype.copy=function(e){En.prototype.copy.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++)this.points.push(e.points[t].clone());return this},Fn.prototype.toJSON=function(){var e=En.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++)e.points.push(this.points[t].toArray());return e},Fn.prototype.fromJSON=function(e){En.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new i).fromArray(r))}return this};var Bo=Object.freeze({ArcCurve:Tn,CatmullRomCurve3:kn,CubicBezierCurve:In,CubicBezierCurve3:On,EllipseCurve:Mn,LineCurve:Pn,LineCurve3:Hn,QuadraticBezierCurve:Nn,QuadraticBezierCurve3:zn,SplineCurve:Fn});Un.prototype=Object.assign(Object.create(En.prototype),{constructor:Un,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Pn(t,e))},getPoint:function(e){var t=e*this.getLength(),i=this.getCurveLengths();for(e=0;e<i.length;){if(i[e]>=t)return t=i[e]-t,i=(e=this.curves[e]).getLength(),e.getPointAt(0===i?0:1-t/i);e++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,i=[],n=0,r=this.curves;n<r.length;n++){var o=r[n];o=o.getPoints(o&&o.isEllipseCurve?2*e:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?e*o.points.length:e);for(var s=0;s<o.length;s++){var a=o[s];t&&t.equals(a)||(i.push(a),t=a)}}return this.autoClose&&1<i.length&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i},copy:function(e){En.prototype.copy.call(this,e),this.curves=[];for(var t=0,i=e.curves.length;t<i;t++)this.curves.push(e.curves[t].clone());return this.autoClose=e.autoClose,this},toJSON:function(){var e=En.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,i=this.curves.length;t<i;t++)e.curves.push(this.curves[t].toJSON());return e},fromJSON:function(e){En.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var n=e.curves[t];this.curves.push((new Bo[n.type]).fromJSON(n))}return this}}),Bn.prototype=Object.assign(Object.create(Un.prototype),{constructor:Bn,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var n=new Pn(this.currentPoint.clone(),new i(e,t));this.curves.push(n),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,n,r){e=new Nn(this.currentPoint.clone(),new i(e,t),new i(n,r)),this.curves.push(e),this.currentPoint.set(n,r)},bezierCurveTo:function(e,t,n,r,o,s){e=new In(this.currentPoint.clone(),new i(e,t),new i(n,r),new i(o,s)),this.curves.push(e),this.currentPoint.set(o,s)},splineThru:function(e){var t=[this.currentPoint.clone()].concat(e);t=new Fn(t),this.curves.push(t),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,i,n,r,o){this.absarc(e+this.currentPoint.x,t+this.currentPoint.y,i,n,r,o)},absarc:function(e,t,i,n,r,o){this.absellipse(e,t,i,i,n,r,o)},ellipse:function(e,t,i,n,r,o,s,a){this.absellipse(e+this.currentPoint.x,t+this.currentPoint.y,i,n,r,o,s,a)},absellipse:function(e,t,i,n,r,o,s,a){e=new Mn(e,t,i,n,r,o,s,a),0<this.curves.length&&((t=e.getPoint(0)).equals(this.currentPoint)||this.lineTo(t.x,t.y)),this.curves.push(e),e=e.getPoint(1),this.currentPoint.copy(e)},copy:function(e){return Un.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=Un.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return Un.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),jn.prototype=Object.assign(Object.create(Bn.prototype),{constructor:jn,getPointsHoles:function(e){for(var t=[],i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Bn.prototype.copy.call(this,e),this.holes=[];for(var t=0,i=e.holes.length;t<i;t++)this.holes.push(e.holes[t].clone());return this},toJSON:function(){var e=Bn.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,i=this.holes.length;t<i;t++)e.holes.push(this.holes[t].toJSON());return e},fromJSON:function(e){Bn.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var n=e.holes[t];this.holes.push((new Bn).fromJSON(n))}return this}}),Gn.prototype=Object.assign(Object.create(S.prototype),{constructor:Gn,isLight:!0,copy:function(e){return S.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){return(e=S.prototype.toJSON.call(this,e)).object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),Vn.prototype=Object.assign(Object.create(Gn.prototype),{constructor:Vn,isHemisphereLight:!0,copy:function(e){return Gn.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign($n.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),Wn.prototype=Object.assign(Object.create($n.prototype),{constructor:Wn,isSpotLightShadow:!0,update:function(e){var t=this.camera,i=2*to.RAD2DEG*e.angle,n=this.mapSize.width/this.mapSize.height;e=e.distance||t.far,i===t.fov&&n===t.aspect&&e===t.far||(t.fov=i,t.aspect=n,t.far=e,t.updateProjectionMatrix())}}),qn.prototype=Object.assign(Object.create(Gn.prototype),{constructor:qn,isSpotLight:!0,copy:function(e){return Gn.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Yn.prototype=Object.assign(Object.create(Gn.prototype),{constructor:Yn,isPointLight:!0,copy:function(e){return Gn.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),Xn.prototype=Object.assign(Object.create(ft.prototype),{constructor:Xn,isOrthographicCamera:!0,copy:function(e,t){return ft.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,i,n,r,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2,r=i-e;if(i+=e,e=n+t,t=n-t,null!==this.view&&this.view.enabled){var o=(this.right-this.left)/this.view.width;i=(r+=this.view.offsetX/(i=this.zoom/(this.view.width/this.view.fullWidth))*o)+this.view.width/i*o,t=(e-=this.view.offsetY/(t=this.zoom/(this.view.height/this.view.fullHeight))*(n=(this.top-this.bottom)/this.view.height))-this.view.height/t*n}this.projectionMatrix.makeOrthographic(r,i,e,t,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){return(e=S.prototype.toJSON.call(this,e)).object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),Zn.prototype=Object.assign(Object.create($n.prototype),{constructor:Zn}),Kn.prototype=Object.assign(Object.create(Gn.prototype),{constructor:Kn,isDirectionalLight:!0,copy:function(e){return Gn.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Jn.prototype=Object.assign(Object.create(Gn.prototype),{constructor:Jn,isAmbientLight:!0}),Qn.prototype=Object.assign(Object.create(Gn.prototype),{constructor:Qn,isRectAreaLight:!0,copy:function(e){return Gn.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){return(e=Gn.prototype.toJSON.call(this,e)).object.width=this.width,e.object.height=this.height,e}}),Object.assign(er.prototype,{load:function(e,t,i,n){var r=this,o=new yn(r.manager);o.setPath(r.path),o.load(e,function(e){t(r.parse(JSON.parse(e)))},i,n)},parse:function(e){function t(e){return void 0===r[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),r[e]}var r=this.textures,s=new Lo[e.type];if(void 0!==e.uuid&&(s.uuid=e.uuid),void 0!==e.name&&(s.name=e.name),void 0!==e.color&&s.color.setHex(e.color),void 0!==e.roughness&&(s.roughness=e.roughness),void 0!==e.metalness&&(s.metalness=e.metalness),void 0!==e.emissive&&s.emissive.setHex(e.emissive),void 0!==e.specular&&s.specular.setHex(e.specular),void 0!==e.shininess&&(s.shininess=e.shininess),void 0!==e.clearCoat&&(s.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(s.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.vertexColors&&(s.vertexColors=e.vertexColors),void 0!==e.fog&&(s.fog=e.fog),void 0!==e.flatShading&&(s.flatShading=e.flatShading),void 0!==e.blending&&(s.blending=e.blending),void 0!==e.combine&&(s.combine=e.combine),void 0!==e.side&&(s.side=e.side),void 0!==e.opacity&&(s.opacity=e.opacity),void 0!==e.transparent&&(s.transparent=e.transparent),void 0!==e.alphaTest&&(s.alphaTest=e.alphaTest),void 0!==e.depthTest&&(s.depthTest=e.depthTest),void 0!==e.depthWrite&&(s.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(s.colorWrite=e.colorWrite),void 0!==e.wireframe&&(s.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(s.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(s.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(s.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(s.rotation=e.rotation),1!==e.linewidth&&(s.linewidth=e.linewidth),void 0!==e.dashSize&&(s.dashSize=e.dashSize),void 0!==e.gapSize&&(s.gapSize=e.gapSize),void 0!==e.scale&&(s.scale=e.scale),void 0!==e.polygonOffset&&(s.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(s.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(s.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(s.skinning=e.skinning),void 0!==e.morphTargets&&(s.morphTargets=e.morphTargets),void 0!==e.dithering&&(s.dithering=e.dithering),void 0!==e.visible&&(s.visible=e.visible),void 0!==e.userData&&(s.userData=e.userData),void 0!==e.uniforms)for(var a in e.uniforms){var l=e.uniforms[a];switch(s.uniforms[a]={},l.type){case"t":s.uniforms[a].value=t(l.value);break;case"c":s.uniforms[a].value=(new y).setHex(l.value);break;case"v2":s.uniforms[a].value=(new i).fromArray(l.value);break;case"v3":s.uniforms[a].value=(new o).fromArray(l.value);break;case"v4":s.uniforms[a].value=(new c).fromArray(l.value);break;case"m4":s.uniforms[a].value=(new n).fromArray(l.value);break;default:s.uniforms[a].value=l.value}}return void 0!==e.defines&&(s.defines=e.defines),void 0!==e.vertexShader&&(s.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(s.fragmentShader=e.fragmentShader),void 0!==e.shading&&(s.flatShading=1===e.shading),void 0!==e.size&&(s.size=e.size),void 0!==e.sizeAttenuation&&(s.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(s.map=t(e.map)),void 0!==e.alphaMap&&(s.alphaMap=t(e.alphaMap),s.transparent=!0),void 0!==e.bumpMap&&(s.bumpMap=t(e.bumpMap)),void 0!==e.bumpScale&&(s.bumpScale=e.bumpScale),void 0!==e.normalMap&&(s.normalMap=t(e.normalMap)),void 0!==e.normalMapType&&(s.normalMapType=e.normalMapType),void 0!==e.normalScale&&(a=e.normalScale,!1===Array.isArray(a)&&(a=[a,a]),s.normalScale=(new i).fromArray(a)),void 0!==e.displacementMap&&(s.displacementMap=t(e.displacementMap)),void 0!==e.displacementScale&&(s.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(s.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(s.roughnessMap=t(e.roughnessMap)),void 0!==e.metalnessMap&&(s.metalnessMap=t(e.metalnessMap)),void 0!==e.emissiveMap&&(s.emissiveMap=t(e.emissiveMap)),void 0!==e.emissiveIntensity&&(s.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(s.specularMap=t(e.specularMap)),void 0!==e.envMap&&(s.envMap=t(e.envMap)),void 0!==e.envMapIntensity&&(s.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(s.reflectivity=e.reflectivity),void 0!==e.lightMap&&(s.lightMap=t(e.lightMap)),void 0!==e.lightMapIntensity&&(s.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(s.aoMap=t(e.aoMap)),void 0!==e.aoMapIntensity&&(s.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(s.gradientMap=t(e.gradientMap)),s},setPath:function(e){return this.path=e,this},setTextures:function(e){return this.textures=e,this}});var jo={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",i=0,n=e.length;i<n;i++)t+=String.fromCharCode(e[i]);return decodeURIComponent(escape(t))},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};Object.assign(tr.prototype,{load:function(e,t,i,n){var r=this,o=new yn(r.manager);o.setPath(r.path),o.load(e,function(e){t(r.parse(JSON.parse(e)))},i,n)},parse:function(e){var t=new F,i=e.data.index;void 0!==i&&(i=new Go[i.type](i.array),t.setIndex(new M(i,1)));var n=e.data.attributes;for(s in n){var r=n[s];i=new Go[r.type](r.array),t.addAttribute(s,new M(i,r.itemSize,r.normalized))}var s=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==s)for(i=0,n=s.length;i!==n;++i)t.addGroup((r=s[i]).start,r.count,r.materialIndex);return void 0!==(s=e.data.boundingSphere)&&(i=new o,void 0!==s.center&&i.fromArray(s.center),t.boundingSphere=new p(i,s.radius)),e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t},setPath:function(e){return this.path=e,this}});var Go={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};Object.assign(ir.prototype,{crossOrigin:"anonymous",load:function(e,t,i,n){var r=this,o=void 0===this.path?jo.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o,(o=new yn(r.manager)).setPath(this.path),o.load(e,function(i){var o=null;try{o=JSON.parse(i)}catch(k){return void 0!==n&&n(k),void console.error("THREE:ObjectLoader: Can't parse "+e+".",k.message)}void 0===(i=o.metadata)||void 0===i.type||"geometry"===i.type.toLowerCase()?console.error("THREE.ObjectLoader: Can't load "+e):r.parse(o,t)},i,n)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(e,t){var i=this.parseShape(e.shapes);i=this.parseGeometries(e.geometries,i);var n=this.parseImages(e.images,function(){void 0!==t&&t(r)});n=this.parseTextures(e.textures,n),n=this.parseMaterials(e.materials,n);var r=this.parseObject(e.object,i,n);return e.animations&&(r.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0===t||t(r),r},parseShape:function(e){var t={};if(void 0!==e)for(var i=0,n=e.length;i<n;i++){var r=(new jn).fromJSON(e[i]);t[r.uuid]=r}return t},parseGeometries:function(e,t){var i={};if(void 0!==e)for(var n=new tr,r=0,o=e.length;r<o;r++){var s=e[r];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":var a=new Do[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new Do[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new Do[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new Do[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new Do[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new Do[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new Do[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new Do[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new Do[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new Do[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"LatheGeometry":case"LatheBufferGeometry":a=new Do[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new Do[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":a=[];for(var c=0,l=s.shapes.length;c<l;c++){var d=t[s.shapes[c]];a.push(d)}a=new Do[s.type](a,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(a=[],c=0,l=s.shapes.length;c<l;c++)a.push(d=t[s.shapes[c]]);void 0!==(c=s.options.extrudePath)&&(s.options.extrudePath=(new Bo[c.type]).fromJSON(c)),a=new Do[s.type](a,s.options);break;case"BufferGeometry":a=n.parse(s);break;case"Geometry":"THREE"in window&&"LegacyJSONLoader"in THREE?a=(new THREE.LegacyJSONLoader).parse(s,this.resourcePath).geometry:console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),!0===a.isBufferGeometry&&void 0!==s.userData&&(a.userData=s.userData),i[s.uuid]=a}return i},parseMaterials:function(e,t){var i={},n={};if(void 0!==e){var r=new er;r.setTextures(t),t=0;for(var o=e.length;t<o;t++){var s=e[t];if("MultiMaterial"===s.type){for(var a=[],c=0;c<s.materials.length;c++){var l=s.materials[c];void 0===i[l.uuid]&&(i[l.uuid]=r.parse(l)),a.push(i[l.uuid])}n[s.uuid]=a}else n[s.uuid]=r.parse(s),i[s.uuid]=n[s.uuid]}}return n},parseAnimations:function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i],r=fn.parse(n);void 0!==n.uuid&&(r.uuid=n.uuid),t.push(r)}return t},parseImages:function(e,t){function i(e){return n.manager.itemStart(e),o.load(e,function(){n.manager.itemEnd(e)},void 0,function(){n.manager.itemError(e),n.manager.itemEnd(e)})}var n=this,r={};if(void 0!==e&&0<e.length){var o=new xn(t=new vn(t));o.setCrossOrigin(this.crossOrigin),t=0;for(var s=e.length;t<s;t++){var a=e[t],c=a.url;if(Array.isArray(c)){r[a.uuid]=[];for(var l=0,d=c.length;l<d;l++){var h=c[l];h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h)?h:n.resourcePath+h,r[a.uuid].push(i(h))}}else h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a.url)?a.url:n.resourcePath+a.url,r[a.uuid]=i(h)}}return r},parseTextures:function(e,t){function i(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var n={};if(void 0!==e)for(var r=0,o=e.length;r<o;r++){var s=e[r];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);var c=Array.isArray(t[s.image])?new ae(t[s.image]):new a(t[s.image]);c.needsUpdate=!0,c.uuid=s.uuid,void 0!==s.name&&(c.name=s.name),void 0!==s.mapping&&(c.mapping=i(s.mapping,Vo)),void 0!==s.offset&&c.offset.fromArray(s.offset),void 0!==s.repeat&&c.repeat.fromArray(s.repeat),void 0!==s.center&&c.center.fromArray(s.center),void 0!==s.rotation&&(c.rotation=s.rotation),void 0!==s.wrap&&(c.wrapS=i(s.wrap[0],$o),c.wrapT=i(s.wrap[1],$o)),void 0!==s.format&&(c.format=s.format),void 0!==s.minFilter&&(c.minFilter=i(s.minFilter,Wo)),void 0!==s.magFilter&&(c.magFilter=i(s.magFilter,Wo)),void 0!==s.anisotropy&&(c.anisotropy=s.anisotropy),void 0!==s.flipY&&(c.flipY=s.flipY),n[s.uuid]=c}return n},parseObject:function(e,t,i){function n(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function r(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],n=0,r=e.length;n<r;n++){var o=e[n];void 0===i[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),t.push(i[o])}return t}return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),i[e]}}switch(e.type){case"Scene":var o=new St;void 0!==e.background&&Number.isInteger(e.background)&&(o.background=new y(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?o.fog=new Ct(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(o.fog=new xt(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":o=new gt(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(o.focus=e.focus),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.filmGauge&&(o.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(o.filmOffset=e.filmOffset),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new Xn(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new Jn(e.color,e.intensity);break;case"DirectionalLight":o=new Kn(e.color,e.intensity);break;case"PointLight":o=new Yn(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new Qn(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new qn(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new Vn(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":o=n(e.geometry);var s=r(e.material);o=o.bones&&0<o.bones.length?new Rt(o,s):new X(o,s);break;case"LOD":o=new kt;break;case"Line":o=new Ot(n(e.geometry),r(e.material),e.mode);break;case"LineLoop":o=new Ht(n(e.geometry),r(e.material));break;case"LineSegments":o=new Pt(n(e.geometry),r(e.material));break;case"PointCloud":case"Points":o=new zt(n(e.geometry),r(e.material));break;case"Sprite":o=new At(r(e.material));break;case"Group":o=new mt;break;default:o=new S}if(o.uuid=e.uuid,void 0!==e.name&&(o.name=e.name),void 0!==e.matrix?(o.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==e.position&&o.position.fromArray(e.position),void 0!==e.rotation&&o.rotation.fromArray(e.rotation),void 0!==e.quaternion&&o.quaternion.fromArray(e.quaternion),void 0!==e.scale&&o.scale.fromArray(e.scale)),void 0!==e.castShadow&&(o.castShadow=e.castShadow),void 0!==e.receiveShadow&&(o.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(o.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(o.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&o.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(o.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(o.visible=e.visible),void 0!==e.frustumCulled&&(o.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(o.renderOrder=e.renderOrder),void 0!==e.userData&&(o.userData=e.userData),void 0!==e.layers&&(o.layers.mask=e.layers),void 0!==e.children){s=e.children;for(var a=0;a<s.length;a++)o.add(this.parseObject(s[a],t,i))}if("LOD"===e.type)for(e=e.levels,s=0;s<e.length;s++){var c=o.getObjectByProperty("uuid",(a=e[s]).object);void 0!==c&&o.addLevel(c,a.distance)}return o}});var Vo={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},$o={RepeatWrapping:1e3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},Wo={NearestFilter:1003,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008};nr.prototype={constructor:nr,setOptions:function(e){return this.options=e,this},load:function(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var r=this,o=Oo.get(e);if(void 0!==o)return r.manager.itemStart(e),setTimeout(function(){t&&t(o),r.manager.itemEnd(e)},0),o;fetch(e).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,r.options)}).then(function(i){Oo.add(e,i),t&&t(i),r.manager.itemEnd(e)}).catch(function(t){n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)})},setCrossOrigin:function(){return this},setPath:function(e){return this.path=e,this}},Object.assign(rr.prototype,{moveTo:function(e,t){this.currentPath=new Bn,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,i,n){this.currentPath.quadraticCurveTo(e,t,i,n)},bezierCurveTo:function(e,t,i,n,r,o){this.currentPath.bezierCurveTo(e,t,i,n,r,o)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function i(e){for(var t=[],i=0,n=e.length;i<n;i++){var r=e[i],o=new jn;o.curves=r.curves,t.push(o)}return t}function n(e,t){for(var i=t.length,n=!1,r=i-1,o=0;o<i;r=o++){var s=t[r],a=t[o],c=a.x-s.x,l=a.y-s.y;if(Math.abs(l)>Number.EPSILON){if(0>l&&(s=t[o],c=-c,a=t[r],l=-l),!(e.y<s.y||e.y>a.y))if(e.y===s.y){if(e.x===s.x)return!0}else{if(0==(r=l*(e.x-s.x)-c*(e.y-s.y)))return!0;0>r||(n=!n)}}else if(e.y===s.y&&(a.x<=e.x&&e.x<=s.x||s.x<=e.x&&e.x<=a.x))return!0}return n}var r=ko.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return i(o);if(t=[],1===o.length){var s=o[0],a=new jn;return a.curves=s.curves,t.push(a),t}var c=!r(o[0].getPoints());c=e?!c:c,a=[];var l=[],d=[],h=0;l[h]=void 0,d[h]=[];for(var u=0,p=o.length;u<p;u++){var m=(s=o[u]).getPoints(),f=r(m);(f=e?!f:f)?(!c&&l[h]&&h++,l[h]={s:new jn,p:m},l[h].s.curves=s.curves,c&&h++,d[h]=[]):d[h].push({h:s,p:m[0]})}if(!l[0])return i(o);if(1<l.length){for(u=!1,e=[],r=0,o=l.length;r<o;r++)a[r]=[];for(r=0,o=l.length;r<o;r++)for(s=d[r],f=0;f<s.length;f++){for(c=s[f],h=!0,m=0;m<l.length;m++)n(c.p,l[m].p)&&(r!==m&&e.push({froms:r,tos:m,hole:f}),h?(h=!1,a[m].push(c)):u=!0);h&&a[r].push(c)}0<e.length&&(u||(d=a))}for(u=0,r=l.length;u<r;u++)for(t.push(a=l[u].s),o=0,s=(e=d[u]).length;o<s;o++)a.holes.push(e[o].h);return t}}),Object.assign(or.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);var i=[],n=t;t=this.data;var r=Array.from?Array.from(e):String(e).split(""),o=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*(n/=t.resolution);e=[];for(var s=0,a=0,c=0;c<r.length;c++){var l=r[c];if("\n"===l)s=0,a-=o;else{var d=n,h=s,u=a;if(l=t.glyphs[l]||t.glyphs["?"]){var p=new rr;if(l.o)for(var m=l._cachedOutline||(l._cachedOutline=l.o.split(" ")),f=0,g=m.length;f<g;)switch(m[f++]){case"m":var v=m[f++]*d+h,y=m[f++]*d+u;p.moveTo(v,y);break;case"l":v=m[f++]*d+h,y=m[f++]*d+u,p.lineTo(v,y);break;case"q":var b=m[f++]*d+h,_=m[f++]*d+u,w=m[f++]*d+h,x=m[f++]*d+u;p.quadraticCurveTo(w,x,b,_);break;case"b":b=m[f++]*d+h,_=m[f++]*d+u,w=m[f++]*d+h,x=m[f++]*d+u,v=m[f++]*d+h,y=m[f++]*d+u,p.bezierCurveTo(w,x,v,y,b,_)}d={offsetX:l.ha*d,path:p}}else d=void 0;s+=d.offsetX,e.push(d.path)}}for(t=0,r=e.length;t<r;t++)Array.prototype.push.apply(i,e[t].toShapes());return i}}),Object.assign(sr.prototype,{load:function(e,t,i,n){var r=this,o=new yn(this.manager);o.setPath(this.path),o.load(e,function(e){try{var i=JSON.parse(e)}catch(k){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(e.substring(65,e.length-2))}e=r.parse(i),t&&t(e)},i,n)},parse:function(e){return new or(e)},setPath:function(e){return this.path=e,this}}),ar.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,i=0,n=t.length;i<n;i+=2){var r=t[i+1];if(t[i].test(e))return r}return null}},Object.assign(ar.prototype,{crossOrigin:"anonymous",onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(e,t,i){for(var n=[],r=0;r<e.length;++r)n[r]=this.createMaterial(e[r],t,i);return n},createMaterial:function(){var e={NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},t=new y,i=new Sn,n=new er;return function(r,o,s){function a(e,t,n,r,a){var c=ar.Handlers.get(e=o+e);return null!==c?e=c.load(e):(i.setCrossOrigin(s),e=i.load(e)),void 0!==t&&(e.repeat.fromArray(t),1!==t[0]&&(e.wrapS=1e3),1!==t[1]&&(e.wrapT=1e3)),void 0!==n&&e.offset.fromArray(n),void 0!==r&&("repeat"===r[0]&&(e.wrapS=1e3),"mirror"===r[0]&&(e.wrapS=1002),"repeat"===r[1]&&(e.wrapT=1e3),"mirror"===r[1]&&(e.wrapT=1002)),void 0!==a&&(e.anisotropy=a),t=to.generateUUID(),l[t]=e,t}var c,l={},d={uuid:to.generateUUID(),type:"MeshLambertMaterial"};for(c in r){var h=r[c];switch(c){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":d.name=h;break;case"blending":d.blending=e[h];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",c,"is no longer supported.");break;case"colorDiffuse":d.color=t.fromArray(h).getHex();break;case"colorSpecular":d.specular=t.fromArray(h).getHex();break;case"colorEmissive":d.emissive=t.fromArray(h).getHex();break;case"specularCoef":d.shininess=h;break;case"shading":"basic"===h.toLowerCase()&&(d.type="MeshBasicMaterial"),"phong"===h.toLowerCase()&&(d.type="MeshPhongMaterial"),"standard"===h.toLowerCase()&&(d.type="MeshStandardMaterial");break;case"mapDiffuse":d.map=a(h,r.mapDiffuseRepeat,r.mapDiffuseOffset,r.mapDiffuseWrap,r.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":d.emissiveMap=a(h,r.mapEmissiveRepeat,r.mapEmissiveOffset,r.mapEmissiveWrap,r.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":d.lightMap=a(h,r.mapLightRepeat,r.mapLightOffset,r.mapLightWrap,r.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":d.aoMap=a(h,r.mapAORepeat,r.mapAOOffset,r.mapAOWrap,r.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":d.bumpMap=a(h,r.mapBumpRepeat,r.mapBumpOffset,r.mapBumpWrap,r.mapBumpAnisotropy);break;case"mapBumpScale":d.bumpScale=h;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":d.normalMap=a(h,r.mapNormalRepeat,r.mapNormalOffset,r.mapNormalWrap,r.mapNormalAnisotropy);break;case"mapNormalFactor":d.normalScale=h;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":d.specularMap=a(h,r.mapSpecularRepeat,r.mapSpecularOffset,r.mapSpecularWrap,r.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":d.metalnessMap=a(h,r.mapMetalnessRepeat,r.mapMetalnessOffset,r.mapMetalnessWrap,r.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":d.roughnessMap=a(h,r.mapRoughnessRepeat,r.mapRoughnessOffset,r.mapRoughnessWrap,r.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":d.alphaMap=a(h,r.mapAlphaRepeat,r.mapAlphaOffset,r.mapAlphaWrap,r.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":d.side=1;break;case"doubleSided":d.side=2;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),d.opacity=h;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":d[c]=h;break;case"vertexColors":!0===h&&(d.vertexColors=2),"face"===h&&(d.vertexColors=1);break;default:console.error("THREE.Loader.createMaterial: Unsupported",c,h)}}return"MeshBasicMaterial"===d.type&&delete d.emissive,"MeshPhongMaterial"!==d.type&&delete d.specular,1>d.opacity&&(d.transparent=!0),n.setTextures(l),n.parse(d)}}()});var qo,Yo,Xo,Zo={getContext:function(){return void 0===qo&&(qo=new(window.AudioContext||window.webkitAudioContext)),qo},setContext:function(e){qo=e}};Object.assign(cr.prototype,{load:function(e,t,i,n){var r=new yn(this.manager);r.setResponseType("arraybuffer"),r.setPath(this.path),r.load(e,function(e){e=e.slice(0),Zo.getContext().decodeAudioData(e,function(e){t(e)})},i,n)},setPath:function(e){return this.path=e,this}}),Object.assign(lr.prototype,{update:function(){var e,t,i,r,o,s,a,c,l=new n,d=new n;return function(n){if(e!==this||t!==n.focus||i!==n.fov||r!==n.aspect*this.aspect||o!==n.near||s!==n.far||a!==n.zoom||c!==this.eyeSep){e=this,t=n.focus,i=n.fov,r=n.aspect*this.aspect,o=n.near,s=n.far,a=n.zoom;var h=n.projectionMatrix.clone(),u=(c=this.eyeSep/2)*o/t,p=o*Math.tan(to.DEG2RAD*i*.5)/a;d.elements[12]=-c,l.elements[12]=c;var m=-p*r+u,f=p*r+u;h.elements[0]=2*o/(f-m),h.elements[8]=(f+m)/(f-m),this.cameraL.projectionMatrix.copy(h),h.elements[0]=2*o/((f=p*r-u)-(m=-p*r-u)),h.elements[8]=(f+m)/(f-m),this.cameraR.projectionMatrix.copy(h)}this.cameraL.matrixWorld.copy(n.matrixWorld).multiply(d),this.cameraR.matrixWorld.copy(n.matrixWorld).multiply(l)}}()}),(dr.prototype=Object.create(S.prototype)).constructor=dr,Object.assign(hr.prototype,{start:function(){this.oldTime=this.startTime=("undefined"==typeof performance?Date:performance).now(),this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.autoStart=this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}),ur.prototype=Object.assign(Object.create(S.prototype),{constructor:ur,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(){var e=new o,t=new r,i=new o,n=new o,s=new hr;return function(r){S.prototype.updateMatrixWorld.call(this,r),r=this.context.listener;var o=this.up;if(this.timeDelta=s.getDelta(),this.matrixWorld.decompose(e,t,i),n.set(0,0,-1).applyQuaternion(t),r.positionX){var a=this.context.currentTime+this.timeDelta;r.positionX.linearRampToValueAtTime(e.x,a),r.positionY.linearRampToValueAtTime(e.y,a),r.positionZ.linearRampToValueAtTime(e.z,a),r.forwardX.linearRampToValueAtTime(n.x,a),r.forwardY.linearRampToValueAtTime(n.y,a),r.forwardZ.linearRampToValueAtTime(n.z,a),r.upX.linearRampToValueAtTime(o.x,a),r.upY.linearRampToValueAtTime(o.y,a),r.upZ.linearRampToValueAtTime(o.z,a)}else r.setPosition(e.x,e.y,e.z),r.setOrientation(n.x,n.y,n.z,o.x,o.y,o.z)}}()}),pr.prototype=Object.assign(Object.create(S.prototype),{constructor:pr,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else{if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.detune.value=this.detune,e.loop=this.loop,e.onended=this.onEnded.bind(this),e.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset),this.isPlaying=!0,this.source=e,this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.source.onended=null,this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.source.onended=null,this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){return this.detune=e,!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}),mr.prototype=Object.assign(Object.create(pr.prototype),{constructor:mr,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this},updateMatrixWorld:function(){var e=new o,t=new r,i=new o,n=new o;return function(r){if(S.prototype.updateMatrixWorld.call(this,r),r=this.panner,this.matrixWorld.decompose(e,t,i),n.set(0,0,1).applyQuaternion(t),r.positionX){var o=this.context.currentTime+this.listener.timeDelta;r.positionX.linearRampToValueAtTime(e.x,o),r.positionY.linearRampToValueAtTime(e.y,o),r.positionZ.linearRampToValueAtTime(e.z,o),r.orientationX.linearRampToValueAtTime(n.x,o),r.orientationY.linearRampToValueAtTime(n.y,o),r.orientationZ.linearRampToValueAtTime(n.z,o)}else r.setPosition(e.x,e.y,e.z),r.setOrientation(n.x,n.y,n.z)}}()}),Object.assign(fr.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),i=0;i<t.length;i++)e+=t[i];return e/t.length}}),Object.assign(gr.prototype,{accumulate:function(e,t){var i=this.buffer,n=this.valueSize;e=e*n+n;var r=this.cumulativeWeight;if(0===r){for(r=0;r!==n;++r)i[e+r]=i[r];r=t}else this._mixBufferRegion(i,e,0,t/(r+=t),n);this.cumulativeWeight=r},apply:function(e){var t=this.valueSize,i=this.buffer;e=e*t+t;var n=this.cumulativeWeight,r=this.binding;this.cumulativeWeight=0,1>n&&this._mixBufferRegion(i,e,3*t,1-n,t),n=t;for(var o=t+t;n!==o;++n)if(i[n]!==i[n+t]){r.setValue(i,e);break}},saveOriginalState:function(){var e=this.buffer,t=this.valueSize,i=3*t;this.binding.getValue(e,i);for(var n=t;n!==i;++n)e[n]=e[i+n%t];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(e,t,i,n,r){if(.5<=n)for(n=0;n!==r;++n)e[t+n]=e[i+n]},_slerp:function(e,t,i,n){r.slerpFlat(e,t,e,t,e,i,n)},_lerp:function(e,t,i,n,r){for(var o=1-n,s=0;s!==r;++s){var a=t+s;e[a]=e[a]*o+e[i+s]*n}}}),Object.assign(vr.prototype,{getValue:function(e,t){this.bind();var i=this._bindings[this._targetGroup.nCachedObjects_];void 0!==i&&i.getValue(e,t)},setValue:function(e,t){for(var i=this._bindings,n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}),Object.assign(yr,{Composite:vr,create:function(e,t,i){return e&&e.isAnimationObjectGroup?new yr.Composite(e,t,i):new yr(e,t,i)},sanitizeNodeName:function(){var e=/[\[\]\.:\/]/g;return function(t){return t.replace(/\s/g,"_").replace(e,"")}}(),parseTrackName:function(){var e="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",t=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]");e=/(WCOD+)?/.source.replace("WCOD",e);var i=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),n=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),r=new RegExp("^"+t+e+i+n+"$"),o=["material","materials","bones"];return function(e){var t=r.exec(e);if(!t)throw Error("PropertyBinding: Cannot parse trackName: "+e);var i=(t={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]}).nodeName&&t.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){var n=t.nodeName.substring(i+1);-1!==o.indexOf(n)&&(t.nodeName=t.nodeName.substring(0,i),t.objectName=n)}if(null===t.propertyName||0===t.propertyName.length)throw Error("PropertyBinding: can not parse propertyName from trackName: "+e);return t}}(),findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){var n=function(e){for(var i=0;i<e.length;i++){var r=e[i];if(r.name===t||r.uuid===t||(r=n(r.children)))return r}return null};if(e=n(e.children))return e}return null}}),Object.assign(yr.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)e[t++]=i[n]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=e[t++]},function(e,t){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var i=this.resolvedProperty,n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,i=t.objectName,n=t.propertyName,r=t.propertyIndex;if(e||(this.node=e=yr.findNode(this.rootNode,t.nodeName)||this.rootNode),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(i){var o=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);for(e=e.skeleton.bones,i=0;i<e.length;i++)if(e[i].name===o){o=i;break}break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==o){if(void 0===e[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[o]}}if(void 0===(o=e[n]))console.error("THREE.PropertyBinding: Trying to update property for track: "+t.nodeName+"."+n+" but it wasn't found.",e);else{if(t=this.Versioning.None,this.targetObject=e,void 0!==e.needsUpdate?t=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(t=this.Versioning.MatrixWorldNeedsUpdate),i=this.BindingType.Direct,void 0!==r){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(i=0;i<this.node.geometry.morphAttributes.position.length;i++)if(e.geometry.morphAttributes.position[i].name===r){r=i;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(i=0;i<this.node.geometry.morphTargets.length;i++)if(e.geometry.morphTargets[i].name===r){r=i;break}}}i=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else void 0!==o.fromArray&&void 0!==o.toArray?(i=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(i=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=n;this.getValue=this.GetterByBindingType[i],this.setValue=this.SetterByBindingTypeAndVersioning[i][t]}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(yr.prototype,{_getValue_unbound:yr.prototype.getValue,_setValue_unbound:yr.prototype.setValue}),Object.assign(br.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,i=this.nCachedObjects_,n=this._indicesByUUID,r=this._paths,o=this._parsedPaths,s=this._bindings,a=s.length,c=void 0,l=0,d=arguments.length;l!==d;++l){var h=arguments[l],u=h.uuid,p=n[u];if(void 0===p){p=t++,n[u]=p,e.push(h),u=0;for(var m=a;u!==m;++u)s[u].push(new yr(h,r[u],o[u]))}else if(p<i){c=e[p];var f=--i;for(n[(m=e[f]).uuid]=p,e[p]=m,n[u]=f,e[f]=h,u=0,m=a;u!==m;++u){var g=s[u],v=g[p];g[p]=g[f],void 0===v&&(v=new yr(h,r[u],o[u])),g[f]=v}}else e[p]!==c&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=i},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,i=this._indicesByUUID,n=this._bindings,r=n.length,o=0,s=arguments.length;o!==s;++o){var a=arguments[o],c=a.uuid,l=i[c];if(void 0!==l&&l>=t){var d=t++,h=e[d];for(i[h.uuid]=l,e[l]=h,i[c]=d,e[d]=a,a=0,c=r;a!==c;++a){var u=(h=n[a])[l];h[l]=h[d],h[d]=u}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,i=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,o=r.length,s=0,a=arguments.length;s!==a;++s){var c=arguments[s].uuid,l=n[c];if(void 0!==l)if(delete n[c],l<i){var d=e[c=--i],h=--t,u=e[h];for(n[d.uuid]=l,e[l]=d,n[u.uuid]=c,e[c]=u,e.pop(),d=0,u=o;d!==u;++d){var p=r[d],m=p[h];p[l]=p[c],p[c]=m,p.pop()}}else for(n[(u=e[h=--t]).uuid]=l,e[l]=u,e.pop(),d=0,u=o;d!==u;++d)(p=r[d])[l]=p[h],p.pop()}this.nCachedObjects_=i},subscribe_:function(e,t){var i=this._bindingsIndicesByPath,n=i[e],r=this._bindings;if(void 0!==n)return r[n];var o=this._paths,s=this._parsedPaths,a=this._objects,c=this.nCachedObjects_,l=Array(a.length);for(i[e]=n=r.length,o.push(e),s.push(t),r.push(l),i=c,n=a.length;i!==n;++i)l[i]=new yr(a[i],e,t);return l},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){var n=this._paths,r=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s];t[e[s]]=i,o[i]=a,o.pop(),r[i]=r[s],r.pop(),n[i]=n[s],n.pop()}}}),Object.assign(_r.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){var n=e._clip.duration,r=(i=this._clip.duration)/n;e.warp(1,n/i,t),this.warp(r,1,t)}return this},crossFadeTo:function(e,t,i){return e.crossFadeFrom(this,t,i)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,i){var n=this._mixer,r=n.time,o=this._timeScaleInterpolant,s=this.timeScale;return null===o&&(this._timeScaleInterpolant=o=n._lendControlInterpolant()),n=o.parameterPositions,o=o.sampleValues,n[0]=r,n[1]=r+i,o[0]=e/s,o[1]=t/s,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,i,n){if(this.enabled){var r=this._startTime;if(null!==r){if(0>(t=(e-r)*i)||0===i)return;this._startTime=null,t*=i}if(t*=this._updateTimeScale(e),i=this._updateTime(t),0<(e=this._updateWeight(e))){r=this._propertyBindings;for(var o=0,s=(t=this._interpolants).length;o!==s;++o)t[o].evaluate(i),r[o].accumulate(n,e)}}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var i=this._weightInterpolant;if(null!==i){var n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var i=this._timeScaleInterpolant;null!==i&&(t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t},_updateTime:function(e){var t=this.time+e,i=this._clip.duration,n=this.loop,r=this._loopCount,o=2202===n;if(0===e)return-1===r?t:o&&1==(1&r)?i-t:t;if(2200===n)e:{if(-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1)),t>=i)t=i;else{if(!(0>t))break e;t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:0>e?-1:1})}else{if(-1===r&&(0<=e?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),t>=i||0>t){t-=i*(n=Math.floor(t/i)),r+=Math.abs(n);var s=this.repetitions-r;0>=s?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=0<e?i:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<e?1:-1})):(1===s?this._setEndings(e=0>e,!e,o):this._setEndings(!1,!1,o),this._loopCount=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n}))}if(o&&1==(1&r))return this.time=t,i-t}return this.time=t},_setEndings:function(e,t,i){var n=this._interpolantSettings;i?(n.endingStart=2401,n.endingEnd=2401):(n.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,n.endingEnd=t?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(e,t,i){var n=this._mixer,r=n.time,o=this._weightInterpolant;return null===o&&(this._weightInterpolant=o=n._lendControlInterpolant()),n=o.parameterPositions,o=o.sampleValues,n[0]=r,o[0]=t,n[1]=r+e,o[1]=i,this}}),wr.prototype=Object.assign(Object.create(t.prototype),{constructor:wr,_bindAction:function(e,t){var i=e._localRoot||this._root,n=e._clip.tracks,r=n.length,o=e._propertyBindings;e=e._interpolants;var s=i.uuid,a=this._bindingsByRootAndName,c=a[s];for(void 0===c&&(a[s]=c={}),a=0;a!==r;++a){var l=n[a],d=l.name,h=c[d];if(void 0===h){if(void 0!==(h=o[a])){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,s,d));continue}++(h=new gr(yr.create(i,d,t&&t._propertyBindings[a].binding.parsedPath),l.ValueTypeName,l.getValueSize())).referenceCount,this._addInactiveBinding(h,s,d)}o[a]=h,e[a].resultBuffer=h.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,i=e._clip.uuid,n=this._actionsByClip[i];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,i,t)}for(i=0,n=(t=e._propertyBindings).length;i!==n;++i){var r=t[i];0==r.useCount++&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,i=0,n=t.length;i!==n;++i){var r=t[i];0==--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){return null!==(e=e._cacheIndex)&&e<this._nActiveActions},_addInactiveAction:function(e,t,i){var n=this._actions,r=this._actionsByClip,o=r[t];void 0===o?(o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=o):(e._byClipCacheIndex=(t=o.knownActions).length,t.push(e)),e._cacheIndex=n.length,n.push(e),o.actionByRoot[i]=e},_removeInactiveAction:function(e){var t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;var r=(n=(i=this._actionsByClip)[t=e._clip.uuid]).knownActions,o=r[r.length-1],s=e._byClipCacheIndex;o._byClipCacheIndex=s,r[s]=o,r.pop(),e._byClipCacheIndex=null,delete n.actionByRoot[(e._localRoot||this._root).uuid],0===r.length&&delete i[t],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=0,i=(e=e._propertyBindings).length;t!==i;++t){var n=e[t];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(e){var t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_takeBackAction:function(e){var t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_addInactiveBinding:function(e,t,i){var n=this._bindingsByRootAndName,r=n[t],o=this._bindings;void 0===r&&(n[t]=r={}),r[i]=e,e._cacheIndex=o.length,o.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,i=e.binding,n=i.rootNode.uuid;i=i.path;var r=this._bindingsByRootAndName,o=r[n],s=t[t.length-1];s._cacheIndex=e=e._cacheIndex,t[e]=s,t.pop(),delete o[i];e:{for(var a in o)break e;delete r[n]}},_lendBinding:function(e){var t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_takeBackBinding:function(e){var t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return void 0===i&&((i=new on(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=i),i},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,r=t[n];e.__cacheIndex=n,t[n]=e,r.__cacheIndex=i,t[i]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var i=t||this._root,n=i.uuid;i="string"==typeof e?fn.findByName(i,e):e;var r=this._actionsByClip[e=null!==i?i.uuid:e],o=null;if(void 0!==r){if(void 0!==(o=r.actionByRoot[n]))return o;o=r.knownActions[0],null===i&&(i=o._clip)}return null===i?null:(t=new _r(this,i,t),this._bindAction(t,o),this._addInactiveAction(t,e,n),t)},existingAction:function(e,t){var i=t||this._root;return t=i.uuid,i="string"==typeof e?fn.findByName(i,e):e,void 0!==(e=this._actionsByClip[i?i.uuid:e])&&e.actionByRoot[t]||null},stopAllAction:function(){for(var e=this._actions,t=this._nActiveActions,i=this._bindings,n=this._nActiveBindings,r=this._nActiveBindings=this._nActiveActions=0;r!==t;++r)e[r].reset();for(r=0;r!==n;++r)i[r].useCount=0;return this},update:function(e){for(var t=this._actions,i=this._nActiveActions,n=this.time+=e*=this.timeScale,r=Math.sign(e),o=this._accuIndex^=1,s=0;s!==i;++s)t[s]._update(n,e,r,o);for(e=this._bindings,t=this._nActiveBindings,s=0;s!==t;++s)e[s].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,i=this._actionsByClip,n=i[e=e.uuid];if(void 0!==n){for(var r=0,o=(n=n.knownActions).length;r!==o;++r){var s=n[r];this._deactivateAction(s);var a=s._cacheIndex,c=t[t.length-1];s._cacheIndex=null,s._byClipCacheIndex=null,c._cacheIndex=a,t[a]=c,t.pop(),this._removeInactiveBindingsForAction(s)}delete i[e]}},uncacheRoot:function(e){e=e.uuid;var t=this._actionsByClip;for(n in t){var i=t[n].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var n=this._bindingsByRootAndName[e];if(void 0!==n)for(var r in n)(e=n[r]).restoreOriginalState(),this._removeInactiveBinding(e)},uncacheAction:function(e,t){null!==(e=this.existingAction(e,t))&&(this._deactivateAction(e),this._removeInactiveAction(e))}}),xr.prototype.clone=function(){return new xr(void 0===this.value.clone?this.value:this.value.clone())},Cr.prototype=Object.assign(Object.create(F.prototype),{constructor:Cr,isInstancedBufferGeometry:!0,copy:function(e){return F.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),Sr.prototype=Object.assign(Object.create(Et.prototype),{constructor:Sr,isInstancedInterleavedBuffer:!0,copy:function(e){return Et.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Er.prototype=Object.assign(Object.create(M.prototype),{constructor:Er,isInstancedBufferAttribute:!0,copy:function(e){return M.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(Mr.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,i){return Ar(e,this,i=i||[],t),i.sort(Tr),i},intersectObjects:function(e,t,i){if(i=i||[],!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var n=0,r=e.length;n<r;n++)Ar(e[n],this,i,t);return i.sort(Tr),i}}),Object.assign(kr.prototype,{set:function(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(e,i),this.phi=Math.acos(to.clamp(t/this.radius,-1,1))),this}}),Object.assign(Rr.prototype,{set:function(e,t,i){return this.radius=e,this.theta=t,this.y=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}}),Object.assign(Dr.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new i;return function(t,i){return i=e.copy(i).multiplyScalar(.5),this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new i),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new i),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new i),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new i),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new i;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(Lr.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new o),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new o),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new o),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new o,t=new o;return function(i,n){return e.subVectors(i,this.start),t.subVectors(this.end,this.start),i=t.dot(t),i=t.dot(e)/i,n&&(i=to.clamp(i,0,1)),i}}(),closestPointToPoint:function(e,t,i){return e=this.closestPointToPointParameter(e,t),void 0===i&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),i=new o),this.delta(i).multiplyScalar(e).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),(Ir.prototype=Object.create(S.prototype)).constructor=Ir,Ir.prototype.isImmediateRenderObject=!0,(Or.prototype=Object.create(Pt.prototype)).constructor=Or,Or.prototype.update=function(){var e=new o,t=new o,i=new s;return function(){var n=["a","b","c"];this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);var r=this.object.matrixWorld,o=this.geometry.attributes.position,s=this.object.geometry;if(s&&s.isGeometry)for(var a=s.vertices,c=s.faces,l=s=0,d=c.length;l<d;l++)for(var h=c[l],u=0,p=h.vertexNormals.length;u<p;u++){var m=h.vertexNormals[u];e.copy(a[h[n[u]]]).applyMatrix4(r),t.copy(m).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),o.setXYZ(s,e.x,e.y,e.z),o.setXYZ(s+=1,t.x,t.y,t.z),s+=1}else if(s&&s.isBufferGeometry)for(n=s.attributes.position,a=s.attributes.normal,u=s=0,p=n.count;u<p;u++)e.set(n.getX(u),n.getY(u),n.getZ(u)).applyMatrix4(r),t.set(a.getX(u),a.getY(u),a.getZ(u)),t.applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),o.setXYZ(s,e.x,e.y,e.z),o.setXYZ(s+=1,t.x,t.y,t.z),s+=1;o.needsUpdate=!0}}(),(Pr.prototype=Object.create(S.prototype)).constructor=Pr,Pr.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Pr.prototype.update=function(){var e=new o;return function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,i=t*Math.tan(this.light.angle);this.cone.scale.set(i,i,t),e.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(e),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),(Hr.prototype=Object.create(Pt.prototype)).constructor=Hr,Hr.prototype.updateMatrixWorld=function(){var e=new o,t=new n,i=new n;return function(n){var r=this.bones,o=this.geometry,s=o.getAttribute("position");i.getInverse(this.root.matrixWorld);for(var a=0,c=0;a<r.length;a++){var l=r[a];l.parent&&l.parent.isBone&&(t.multiplyMatrices(i,l.matrixWorld),e.setFromMatrixPosition(t),s.setXYZ(c,e.x,e.y,e.z),t.multiplyMatrices(i,l.parent.matrixWorld),e.setFromMatrixPosition(t),s.setXYZ(c+1,e.x,e.y,e.z),c+=2)}o.getAttribute("position").needsUpdate=!0,S.prototype.updateMatrixWorld.call(this,n)}}(),(Nr.prototype=Object.create(X.prototype)).constructor=Nr,Nr.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Nr.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},(zr.prototype=Object.create(S.prototype)).constructor=zr,zr.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},zr.prototype.update=function(){var e=.5*this.light.width,t=.5*this.light.height,i=this.line.geometry.attributes.position,n=i.array;n[0]=e,n[1]=-t,n[2]=0,n[3]=e,n[4]=t,n[5]=0,n[6]=-e,n[7]=t,n[8]=0,n[9]=-e,n[10]=-t,n[11]=0,n[12]=e,n[13]=-t,n[14]=0,i.needsUpdate=!0,void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)},(Fr.prototype=Object.create(S.prototype)).constructor=Fr,Fr.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Fr.prototype.update=function(){var e=new o,t=new y,i=new y;return function(){var n=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var r=n.geometry.getAttribute("color");t.copy(this.light.color),i.copy(this.light.groundColor);for(var o=0,s=r.count;o<s;o++){var a=o<s/2?t:i;r.setXYZ(o,a.r,a.g,a.b)}r.needsUpdate=!0}n.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),(Ur.prototype=Object.create(Pt.prototype)).constructor=Ur,(Br.prototype=Object.create(Pt.prototype)).constructor=Br,(jr.prototype=Object.create(Pt.prototype)).constructor=jr,jr.prototype.update=function(){var e=new o,t=new o,i=new s;return function(){this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);for(var n=this.object.matrixWorld,r=this.geometry.attributes.position,o=this.object.geometry,s=o.vertices,a=0,c=0,l=(o=o.faces).length;c<l;c++){var d=o[c],h=d.normal;e.copy(s[d.a]).add(s[d.b]).add(s[d.c]).divideScalar(3).applyMatrix4(n),t.copy(h).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),r.setXYZ(a,e.x,e.y,e.z),r.setXYZ(a+=1,t.x,t.y,t.z),a+=1}r.needsUpdate=!0}}(),(Gr.prototype=Object.create(S.prototype)).constructor=Gr,Gr.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Gr.prototype.update=function(){var e=new o,t=new o,i=new o;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),i.subVectors(t,e),this.lightPlane.lookAt(t),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(t),this.targetLine.scale.z=i.length()}}(),(Vr.prototype=Object.create(Pt.prototype)).constructor=Vr,Vr.prototype.update=function(){function e(e,o,s,a){if(n.set(o,s,a).unproject(r),void 0!==(e=i[e]))for(o=t.getAttribute("position"),s=0,a=e.length;s<a;s++)o.setXYZ(e[s],n.x,n.y,n.z)}var t,i,n=new o,r=new ft;return function(){t=this.geometry,i=this.pointMap,r.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-1,-1,-1),e("n2",1,-1,-1),e("n3",-1,1,-1),e("n4",1,1,-1),e("f1",-1,-1,1),e("f2",1,-1,1),e("f3",-1,1,1),e("f4",1,1,1),e("u1",.7,1.1,-1),e("u2",-.7,1.1,-1),e("u3",0,2,-1),e("cf1",-1,0,1),e("cf2",1,0,1),e("cf3",0,-1,1),e("cf4",0,1,1),e("cn1",-1,0,-1),e("cn2",1,0,-1),e("cn3",0,-1,-1),e("cn4",0,1,-1),t.getAttribute("position").needsUpdate=!0}}(),($r.prototype=Object.create(Pt.prototype)).constructor=$r,$r.prototype.update=function(){var e=new u;return function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&e.setFromObject(this.object),!e.isEmpty()){t=e.min;var i=e.max,n=this.geometry.attributes.position,r=n.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=t.x,r[4]=i.y,r[5]=i.z,r[6]=t.x,r[7]=t.y,r[8]=i.z,r[9]=i.x,r[10]=t.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=t.z,r[15]=t.x,r[16]=i.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=i.x,r[22]=t.y,r[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),$r.prototype.setFromObject=function(e){return this.object=e,this.update(),this},$r.prototype.copy=function(e){return Pt.prototype.copy.call(this,e),this.object=e.object,this},$r.prototype.clone=function(){return(new this.constructor).copy(this)},(Wr.prototype=Object.create(Pt.prototype)).constructor=Wr,Wr.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),S.prototype.updateMatrixWorld.call(this,e))},(qr.prototype=Object.create(Ot.prototype)).constructor=qr,qr.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;1e-8>Math.abs(t)&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=0>t?1:0,this.lookAt(this.plane.normal),S.prototype.updateMatrixWorld.call(this,e)},(Yr.prototype=Object.create(S.prototype)).constructor=Yr,Yr.prototype.setDirection=function(){var e,t=new o;return function(i){.99999<i.y?this.quaternion.set(0,0,0,1):-.99999>i.y?this.quaternion.set(1,0,0,0):(t.set(i.z,0,-i.x).normalize(),e=Math.acos(i.y),this.quaternion.setFromAxisAngle(t,e))}}(),Yr.prototype.setLength=function(e,t,i){void 0===t&&(t=.2*e),void 0===i&&(i=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()},Yr.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},Yr.prototype.copy=function(e){return S.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},Yr.prototype.clone=function(){return(new this.constructor).copy(this)},(Xr.prototype=Object.create(Pt.prototype)).constructor=Xr,En.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(En.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(Un.prototype,{createPointsGeometry:function(e){return console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead."),e=this.getPoints(e),this.createGeometry(e)},createSpacedPointsGeometry:function(e){return console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead."),e=this.getSpacedPoints(e),this.createGeometry(e)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new E,i=0,n=e.length;i<n;i++){var r=e[i];t.vertices.push(new o(r.x,r.y,r.z||0))}return t}}),Object.assign(Bn.prototype,{fromPoints:function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Zr.prototype=Object.create(kn.prototype),Kr.prototype=Object.create(kn.prototype),Jr.prototype=Object.create(kn.prototype),Object.assign(Jr.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Ur.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Hr.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(ar.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),jo.extractUrlBase(e)}}),Object.assign(ir.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(Dr.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(u.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Lr.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(to,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),to.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),to.ceilPowerOfTwo(e)}}),Object.assign(s.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(n.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){var e;return function(){return void 0===e&&(e=new o),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,i,n,r,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,n,i,r,o)}}),m.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},r.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(W.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(q.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(q,{barycoordFromPoint:function(e,t,i,n,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),q.getBarycoord(e,t,i,n,r)},normal:function(e,t,i,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),q.getNormal(e,t,i,n)}}),Object.assign(jn.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Ei(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Hi(this,e)}}),Object.assign(i.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(o.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(c.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(E.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(S.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(S.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(kt.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Dt.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Rt.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(En.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),gt.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Gn.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(M.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(F.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(F.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.assign(Mi.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(xr.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(V.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new y}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}}}),Object.defineProperties(Zi.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties($.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(wt.prototype,{clearTarget:function(e,t,i,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,i,n)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")}}),Object.defineProperties(wt.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(dt.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(l.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(bt.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}},userHeight:{set:function(){console.warn("THREE.WebVRManager: .userHeight has been removed.")}}}),pr.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new cr).load(e,function(e){t.setBuffer(e)}),this},fr.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},dr.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},no.crossOrigin=void 0,no.loadTexture=function(e,t,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var r=new Sn;return r.setCrossOrigin(this.crossOrigin),e=r.load(e,i,void 0,n),t&&(e.mapping=t),e},no.loadTextureCube=function(e,t,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var r=new Cn;return r.setCrossOrigin(this.crossOrigin),e=r.load(e,i,void 0,n),t&&(e.mapping=t),e},no.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},no.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},e.WebGLRenderTargetCube=d,e.WebGLRenderTarget=l,e.WebGLRenderer=wt,e.ShaderLib=lo,e.UniformsLib=co,e.UniformsUtils=so,e.ShaderChunk=oo,e.FogExp2=xt,e.Fog=Ct,e.Scene=St,e.Sprite=At,e.LOD=kt,e.SkinnedMesh=Rt,e.Skeleton=Dt,e.Bone=Lt,e.Mesh=X,e.LineSegments=Pt,e.LineLoop=Ht,e.Line=Ot,e.Points=zt,e.Group=mt,e.VideoTexture=Ft,e.DataTexture=h,e.DataTexture3D=ce,e.CompressedTexture=Ut,e.CubeTexture=ae,e.CanvasTexture=Bt,e.DepthTexture=jt,e.Texture=a,e.AnimationLoader=bn,e.CompressedTextureLoader=_n,e.DataTextureLoader=wn,e.CubeTextureLoader=Cn,e.TextureLoader=Sn,e.ObjectLoader=ir,e.MaterialLoader=er,e.BufferGeometryLoader=tr,e.DefaultLoadingManager=Po,e.LoadingManager=vn,e.ImageLoader=xn,e.ImageBitmapLoader=nr,e.FontLoader=sr,e.FileLoader=yn,e.Loader=ar,e.LoaderUtils=jo,e.Cache=Oo,e.AudioLoader=cr,e.SpotLightShadow=Wn,e.SpotLight=qn,e.PointLight=Yn,e.RectAreaLight=Qn,e.HemisphereLight=Vn,e.DirectionalLightShadow=Zn,e.DirectionalLight=Kn,e.AmbientLight=Jn,e.LightShadow=$n,e.Light=Gn,e.StereoCamera=lr,e.PerspectiveCamera=gt,e.OrthographicCamera=Xn,e.CubeCamera=dr,e.ArrayCamera=vt,e.Camera=ft,e.AudioListener=ur,e.PositionalAudio=mr,e.AudioContext=Zo,e.AudioAnalyser=fr,e.Audio=pr,e.VectorKeyframeTrack=mn,e.StringKeyframeTrack=pn,e.QuaternionKeyframeTrack=un,e.NumberKeyframeTrack=dn,e.ColorKeyframeTrack=ln,e.BooleanKeyframeTrack=cn,e.PropertyMixer=gr,e.PropertyBinding=yr,e.KeyframeTrack=an,e.AnimationUtils=Io,e.AnimationObjectGroup=br,e.AnimationMixer=wr,e.AnimationClip=fn,e.Uniform=xr,e.InstancedBufferGeometry=Cr,e.BufferGeometry=F,e.Geometry=E,e.InterleavedBufferAttribute=Mt,e.InstancedInterleavedBuffer=Sr,e.InterleavedBuffer=Et,e.InstancedBufferAttribute=Er,e.Face3=w,e.Object3D=S,e.Raycaster=Mr,e.Layers=C,e.EventDispatcher=t,e.Clock=hr,e.QuaternionLinearInterpolant=hn,e.LinearInterpolant=on,e.DiscreteInterpolant=sn,e.CubicInterpolant=rn,e.Interpolant=nn,e.Triangle=q,e.Math=to,e.Spherical=kr,e.Cylindrical=Rr,e.Plane=m,e.Frustum=f,e.Sphere=p,e.Ray=W,e.Matrix4=n,e.Matrix3=s,e.Box3=u,e.Box2=Dr,e.Line3=Lr,e.Euler=x,e.Vector4=c,e.Vector3=o,e.Vector2=i,e.Quaternion=r,e.Color=y,e.ImmediateRenderObject=Ir,e.VertexNormalsHelper=Or,e.SpotLightHelper=Pr,e.SkeletonHelper=Hr,e.PointLightHelper=Nr,e.RectAreaLightHelper=zr,e.HemisphereLightHelper=Fr,e.GridHelper=Ur,e.PolarGridHelper=Br,e.FaceNormalsHelper=jr,e.DirectionalLightHelper=Gr,e.CameraHelper=Vr,e.BoxHelper=$r,e.Box3Helper=Wr,e.PlaneHelper=qr,e.ArrowHelper=Yr,e.AxesHelper=Xr,e.Shape=jn,e.Path=Bn,e.ShapePath=rr,e.Font=or,e.CurvePath=Un,e.Curve=En,e.ImageUtils=no,e.ShapeUtils=ko,e.WebGLUtils=pt,e.WireframeGeometry=Gt,e.ParametricGeometry=Vt,e.ParametricBufferGeometry=$t,e.TetrahedronGeometry=Yt,e.TetrahedronBufferGeometry=Xt,e.OctahedronGeometry=Zt,e.OctahedronBufferGeometry=Kt,e.IcosahedronGeometry=Jt,e.IcosahedronBufferGeometry=Qt,e.DodecahedronGeometry=ei,e.DodecahedronBufferGeometry=ti,e.PolyhedronGeometry=Wt,e.PolyhedronBufferGeometry=qt,e.TubeGeometry=ii,e.TubeBufferGeometry=ni,e.TorusKnotGeometry=ri,e.TorusKnotBufferGeometry=oi,e.TorusGeometry=si,e.TorusBufferGeometry=ai,e.TextGeometry=Ai,e.TextBufferGeometry=ki,e.SphereGeometry=Ri,e.SphereBufferGeometry=Di,e.RingGeometry=Li,e.RingBufferGeometry=Ii,e.PlaneGeometry=j,e.PlaneBufferGeometry=G,e.LatheGeometry=Oi,e.LatheBufferGeometry=Pi,e.ShapeGeometry=Hi,e.ShapeBufferGeometry=Ni,e.ExtrudeGeometry=Ei,e.ExtrudeBufferGeometry=Mi,e.EdgesGeometry=Fi,e.ConeGeometry=ji,e.ConeBufferGeometry=Gi,e.CylinderGeometry=Ui,e.CylinderBufferGeometry=Bi,e.CircleGeometry=Vi,e.CircleBufferGeometry=$i,e.BoxGeometry=U,e.BoxBufferGeometry=B,e.ShadowMaterial=Wi,e.SpriteMaterial=Tt,e.RawShaderMaterial=qi,e.ShaderMaterial=$,e.PointsMaterial=Nt,e.MeshPhysicalMaterial=Xi,e.MeshStandardMaterial=Yi,e.MeshPhongMaterial=Zi,e.MeshToonMaterial=Ki,e.MeshNormalMaterial=Ji,e.MeshLambertMaterial=Qi,e.MeshDepthMaterial=ct,e.MeshDistanceMaterial=lt,e.MeshBasicMaterial=Y,e.MeshMatcapMaterial=en,e.LineDashedMaterial=tn,e.LineBasicMaterial=It,e.Material=V,e.Float64BufferAttribute=H,e.Float32BufferAttribute=P,e.Uint32BufferAttribute=O,e.Int32BufferAttribute=I,e.Uint16BufferAttribute=L,e.Int16BufferAttribute=D,e.Uint8ClampedBufferAttribute=R,e.Uint8BufferAttribute=A,e.Int8BufferAttribute=T,e.BufferAttribute=M,e.ArcCurve=Tn,e.CatmullRomCurve3=kn,e.CubicBezierCurve=In,e.CubicBezierCurve3=On,e.EllipseCurve=Mn,e.LineCurve=Pn,e.LineCurve3=Hn,e.QuadraticBezierCurve=Nn,e.QuadraticBezierCurve3=zn,e.SplineCurve=Fn,e.REVISION="99",e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},e.CullFaceNone=0,e.CullFaceBack=1,e.CullFaceFront=2,e.CullFaceFrontBack=3,e.FrontFaceDirectionCW=0,e.FrontFaceDirectionCCW=1,e.BasicShadowMap=0,e.PCFShadowMap=1,e.PCFSoftShadowMap=2,e.FrontSide=0,e.BackSide=1,e.DoubleSide=2,e.FlatShading=1,e.SmoothShading=2,e.NoColors=0,e.FaceColors=1,e.VertexColors=2,e.NoBlending=0,e.NormalBlending=1,e.AdditiveBlending=2,e.SubtractiveBlending=3,e.MultiplyBlending=4,e.CustomBlending=5,e.AddEquation=100,e.SubtractEquation=101,e.ReverseSubtractEquation=102,e.MinEquation=103,e.MaxEquation=104,e.ZeroFactor=200,e.OneFactor=201,e.SrcColorFactor=202,e.OneMinusSrcColorFactor=203,e.SrcAlphaFactor=204,e.OneMinusSrcAlphaFactor=205,e.DstAlphaFactor=206,e.OneMinusDstAlphaFactor=207,e.DstColorFactor=208,e.OneMinusDstColorFactor=209,e.SrcAlphaSaturateFactor=210,e.NeverDepth=0,e.AlwaysDepth=1,e.LessDepth=2,e.LessEqualDepth=3,e.EqualDepth=4,e.GreaterEqualDepth=5,e.GreaterDepth=6,e.NotEqualDepth=7,e.MultiplyOperation=0,e.MixOperation=1,e.AddOperation=2,e.NoToneMapping=0,e.LinearToneMapping=1,e.ReinhardToneMapping=2,e.Uncharted2ToneMapping=3,e.CineonToneMapping=4,e.ACESFilmicToneMapping=5,e.UVMapping=300,e.CubeReflectionMapping=301,e.CubeRefractionMapping=302,e.EquirectangularReflectionMapping=303,e.EquirectangularRefractionMapping=304,e.SphericalReflectionMapping=305,e.CubeUVReflectionMapping=306,e.CubeUVRefractionMapping=307,e.RepeatWrapping=1e3,e.ClampToEdgeWrapping=1001,e.MirroredRepeatWrapping=1002,e.NearestFilter=1003,e.NearestMipMapNearestFilter=1004,e.NearestMipMapLinearFilter=1005,e.LinearFilter=1006,e.LinearMipMapNearestFilter=1007,e.LinearMipMapLinearFilter=1008,e.UnsignedByteType=1009,e.ByteType=1010,e.ShortType=1011,e.UnsignedShortType=1012,e.IntType=1013,e.UnsignedIntType=1014,e.FloatType=1015,e.HalfFloatType=1016,e.UnsignedShort4444Type=1017,e.UnsignedShort5551Type=1018,e.UnsignedShort565Type=1019,e.UnsignedInt248Type=1020,e.AlphaFormat=1021,e.RGBFormat=1022,e.RGBAFormat=1023,e.LuminanceFormat=1024,e.LuminanceAlphaFormat=1025,e.RGBEFormat=1023,e.DepthFormat=1026,e.DepthStencilFormat=1027,e.RedFormat=1028,e.RGB_S3TC_DXT1_Format=33776,e.RGBA_S3TC_DXT1_Format=33777,e.RGBA_S3TC_DXT3_Format=33778,e.RGBA_S3TC_DXT5_Format=33779,e.RGB_PVRTC_4BPPV1_Format=35840,e.RGB_PVRTC_2BPPV1_Format=35841,e.RGBA_PVRTC_4BPPV1_Format=35842,e.RGBA_PVRTC_2BPPV1_Format=35843,e.RGB_ETC1_Format=36196,e.RGBA_ASTC_4x4_Format=37808,e.RGBA_ASTC_5x4_Format=37809,e.RGBA_ASTC_5x5_Format=37810,e.RGBA_ASTC_6x5_Format=37811,e.RGBA_ASTC_6x6_Format=37812,e.RGBA_ASTC_8x5_Format=37813,e.RGBA_ASTC_8x6_Format=37814,e.RGBA_ASTC_8x8_Format=37815,e.RGBA_ASTC_10x5_Format=37816,e.RGBA_ASTC_10x6_Format=37817,e.RGBA_ASTC_10x8_Format=37818,e.RGBA_ASTC_10x10_Format=37819,e.RGBA_ASTC_12x10_Format=37820,e.RGBA_ASTC_12x12_Format=37821,e.LoopOnce=2200,e.LoopRepeat=2201,e.LoopPingPong=2202,e.InterpolateDiscrete=2300,e.InterpolateLinear=2301,e.InterpolateSmooth=2302,e.ZeroCurvatureEnding=2400,e.ZeroSlopeEnding=2401,e.WrapAroundEnding=2402,e.TrianglesDrawMode=0,e.TriangleStripDrawMode=1,e.TriangleFanDrawMode=2,e.LinearEncoding=3e3,e.sRGBEncoding=3001,e.GammaEncoding=3007,e.RGBEEncoding=3002,e.LogLuvEncoding=3003,e.RGBM7Encoding=3004,e.RGBM16Encoding=3005,e.RGBDEncoding=3006,e.BasicDepthPacking=3200,e.RGBADepthPacking=3201,e.TangentSpaceNormalMap=0,e.ObjectSpaceNormalMap=1,e.CubeGeometry=U,e.Face4=function(e,t,i,n,r,o,s){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new w(e,t,i,r,o,s)},e.LineStrip=0,e.LinePieces=1,e.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MultiMaterial=function(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},e.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new zt(e,t)},e.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new At(e)},e.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new zt(e,t)},e.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Nt(e)},e.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Nt(e)},e.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Nt(e)},e.Vertex=function(e,t,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new o(e,t,i)},e.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new M(e,t).setDynamic(!0)},e.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new T(e,t)},e.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new A(e,t)},e.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new R(e,t)},e.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new D(e,t)},e.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new L(e,t)},e.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new I(e,t)},e.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new O(e,t)},e.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new P(e,t)},e.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new H(e,t)},e.ClosedSplineCurve3=Zr,e.SplineCurve3=Kr,e.Spline=Jr,e.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Xr(e)},e.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new $r(e,t)},e.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Pt(new Fi(e.geometry),new It({color:void 0!==t?t:16777215}))},e.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Pt(new Gt(e.geometry),new It({color:void 0!==t?t:16777215}))},e.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new yn(e)},e.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new wn(e)},e.GeometryUtils={merge:function(e,t,i){if(console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh){t.matrixAutoUpdate&&t.updateMatrix();var n=t.matrix;t=t.geometry}e.merge(t,n,i)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},e.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},e.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},e.SceneUtils={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}},e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")},Object.defineProperty(e,"__esModule",{value:!0})});var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(t){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var e=document.createElement("div");return e.id="webgl-error-message",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.color="#000",e.style.padding="1.5em",e.style.width="400px",e.style.margin="5em auto 0",this.webgl||(e.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),e},addGetWebGLMessage:function(e){var t,i,n;t=void 0!==(e=e||{}).parent?e.parent:document.body,i=void 0!==e.id?e.id:"oldie",(n=Detector.getWebGLErrorMessage()).id=i,t.appendChild(n)}};"object"==typeof module&&(module.exports=Detector),THREE.TrackballControls=function(e,t,i){var n=this;this.STATE={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var r=new THREE.Vector3;this._state=this.STATE.NONE;var o=this.STATE.NONE,s=new THREE.Vector3;this._rotateStart=new THREE.Vector3,this._rotateEnd=new THREE.Vector3,this._zoomStart=new THREE.Vector2,this._zoomEnd=new THREE.Vector2;var a=0,c=0;this._panStart=new THREE.Vector2,this._panEnd=new THREE.Vector2,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var l={type:"change"},d={type:"start"},h={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var u,p,m,f,g,v,y=(u=new THREE.Vector2,function(e,t){return u.set((e-n.screen.left)/n.screen.width,(t-n.screen.top)/n.screen.height),u}),b=function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3;return function(r,o){i.set((r-.5*n.screen.width-n.screen.left)/(.5*n.screen.width),(.5*n.screen.height+n.screen.top-o)/(.5*n.screen.height),0);var a=i.length();return n.noRoll?i.z=a<Math.SQRT1_2?Math.sqrt(1-a*a):.5/a:a>1?i.normalize():i.z=Math.sqrt(1-a*a),s.copy(n.object.position).sub(n.target),e.copy(n.object.up).setLength(i.y),e.add(t.copy(n.object.up).cross(s).setLength(i.x)),e.add(s.setLength(i.z)),e}}();function _(e){!1!==n.enabled&&(window.removeEventListener("keydown",_),o=n._state,n._state===n.STATE.NONE&&(e.keyCode!==n.keys[n.STATE.ROTATE]||n.noRotate?e.keyCode!==n.keys[n.STATE.ZOOM]||n.noZoom?e.keyCode!==n.keys[n.STATE.PAN]||n.noPan||(n._state=n.STATE.PAN):n._state=n.STATE.ZOOM:n._state=n.STATE.ROTATE))}function w(e){!1!==n.enabled&&(e.preventDefault(),e.stopPropagation(),n._state!==n.STATE.ROTATE||n.noRotate?n._state!==n.STATE.ZOOM||n.noZoom?n._state!==n.STATE.PAN||n.noPan||n._panEnd.copy(y(e.pageX,e.pageY)):n._zoomEnd.copy(y(e.pageX,e.pageY)):n._rotateEnd.copy(b(e.pageX,e.pageY)))}function x(e){!1!==n.enabled&&(e.preventDefault(),e.stopPropagation(),n._state=n.STATE.NONE,document.removeEventListener("mousemove",w),document.removeEventListener("mouseup",x),n.dispatchEvent(h))}function C(e){if(!1!==n.enabled){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),n._zoomStart.y=.005*t,n.dispatchEvent(d),n.dispatchEvent(h)}}this.rotateCamera=(p=new THREE.Vector3,m=new THREE.Quaternion,function(e,t){var r;void 0===e&&(r=Math.acos(n._rotateStart.dot(n._rotateEnd)/n._rotateStart.length()/n._rotateEnd.length())),(r||void 0!==e)&&(void 0===e?(p.crossVectors(n._rotateStart,n._rotateEnd).normalize(),m.setFromAxisAngle(p,-(r*=n.rotateSpeed))):m.copy(e),void 0!==t&&!0!==t||i.quaternion.multiplyQuaternions(m,i.quaternion),s.applyQuaternion(m),n.object.up.applyQuaternion(m),n._rotateEnd.applyQuaternion(m),n.staticMoving?n._rotateStart.copy(n._rotateEnd):(m.setFromAxisAngle(p,r*(n.dynamicDampingFactor-1)),n._rotateStart.applyQuaternion(m)))}),this.zoomCamera=function(e,t){var r;n._state===n.STATE.TOUCH_ZOOM_PAN?(void 0!==e?r=e:(r=a/c,a=c),s.multiplyScalar(r),void 0!==t&&!0!==t||(i._zoomFactor*=r)):(r=void 0!==e?e:1+(n._zoomEnd.y-n._zoomStart.y)*n.zoomSpeed,void 0!==t&&!0!==t||(i._zoomFactor*=r),1!==r&&(s.multiplyScalar(r),n.staticMoving?n._zoomStart.copy(n._zoomEnd):n._zoomStart.y+=(n._zoomEnd.y-n._zoomStart.y)*this.dynamicDampingFactor))},this.panCamera=(f=new THREE.Vector2,g=new THREE.Vector3,v=new THREE.Vector3,function(e,t){void 0!==e?(f=e,void 0!==t&&!0!==t||i.mouseChange.add(e)):(f.copy(n._panEnd).sub(n._panStart),void 0!==t&&!0!==t||i.mouseChange.add(n._panEnd).sub(n._panStart)),f.lengthSq()&&(f.multiplyScalar(s.length()*n.panSpeed),v.copy(s).cross(n.object.up).setLength(f.x),v.add(g.copy(n.object.up).setLength(f.y)),n.object.position.add(v),n.target.add(v),n.staticMoving?n._panStart.copy(n._panEnd):n._panStart.add(f.subVectors(n._panEnd,n._panStart).multiplyScalar(n.dynamicDampingFactor)))}),this.checkDistances=function(){n.noZoom&&n.noPan||(s.lengthSq()>n.maxDistance*n.maxDistance&&n.object.position.addVectors(n.target,s.setLength(n.maxDistance)),s.lengthSq()<n.minDistance*n.minDistance&&n.object.position.addVectors(n.target,s.setLength(n.minDistance)))},this.update=function(e){s.subVectors(n.object.position,n.target),n.noRotate||(void 0!==e&&void 0!==e.quaternion?n.rotateCamera(e.quaternion,e.update):n.rotateCamera()),n.noZoom||(void 0!==e&&void 0!==e._zoomFactor?n.zoomCamera(e._zoomFactor,e.update):n.zoomCamera()),n.noPan||(void 0!==e&&void 0!==e.mouseChange?n.panCamera(e.mouseChange,e.update):n.panCamera()),n.object.position.addVectors(n.target,s),n.checkDistances(),n.object.lookAt(n.target),r.distanceToSquared(n.object.position)>1e-6&&(n.dispatchEvent(l),r.copy(n.object.position))},this.reset=function(){n._state=n.STATE.NONE,o=n.STATE.NONE,n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.up.copy(n.up0),s.subVectors(n.object.position,n.target),n.object.lookAt(n.target),n.dispatchEvent(l),r.copy(n.object.position)},this.domElement.addEventListener("contextmn",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",function(e){!1!==n.enabled&&(e.preventDefault(),e.stopPropagation(),n._state===n.STATE.NONE&&(n._state=e.button),n._state!==n.STATE.ROTATE||n.noRotate?n._state!==n.STATE.ZOOM||n.noZoom?n._state!==n.STATE.PAN||n.noPan||(n._panStart.copy(y(e.pageX,e.pageY)),n._panEnd.copy(n._panStart)):(n._zoomStart.copy(y(e.pageX,e.pageY)),n._zoomEnd.copy(n._zoomStart)):(n._rotateStart.copy(b(e.pageX,e.pageY)),n._rotateEnd.copy(n._rotateStart)),document.addEventListener("mousemove",w,!1),document.addEventListener("mouseup",x,!1),n.dispatchEvent(d))},!1),this.domElement.addEventListener("mousewheel",C,!1),this.domElement.addEventListener("DOMMouseScroll",C,!1),this.domElement.addEventListener("touchstart",function(e){if(!1!==n.enabled){switch(e.touches.length){case 1:n._state=n.STATE.TOUCH_ROTATE,n._rotateStart.copy(b(e.touches[0].pageX,e.touches[0].pageY)),n._rotateEnd.copy(n._rotateStart);break;case 2:n._state=n.STATE.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;c=a=Math.sqrt(t*t+i*i),n._panStart.copy(y((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2)),n._panEnd.copy(n._panStart);break;default:n._state=n.STATE.NONE}n.dispatchEvent(d)}},!1),this.domElement.addEventListener("touchend",function(e){if(!1!==n.enabled){switch(e.touches.length){case 1:n._rotateEnd.copy(b(e.touches[0].pageX,e.touches[0].pageY)),n._rotateStart.copy(n._rotateEnd);break;case 2:a=c=0,n._panEnd.copy(y((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2)),n._panStart.copy(n._panEnd)}n._state=n.STATE.NONE,n.dispatchEvent(h)}},!1),this.domElement.addEventListener("touchmove",function(e){if(!1!==n.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:n._rotateEnd.copy(b(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;c=Math.sqrt(t*t+i*i),n._panEnd.copy(y((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2));break;default:n._state=n.STATE.NONE}},!1),window.addEventListener("keydown",_,!1),window.addEventListener("keyup",function(e){!1!==n.enabled&&(n._state=o,window.addEventListener("keydown",_,!1))},!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls,THREE.OrthographicTrackballControls=function(e,t,i){var n=this,r={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=.5,this.zoomSpeed=1.2,this.zoomSpeed*=.01,this.panSpeed=.03,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.keys=[65,83,68],this.target=new THREE.Vector3;var o=new THREE.Vector3;this._state=r.NONE;var s=r.NONE,a=new THREE.Vector3;this._rotateStart=new THREE.Vector3,this._rotateEnd=new THREE.Vector3,this._zoomStart=new THREE.Vector2,this._zoomEnd=new THREE.Vector2;var c=1,l=0,d=0;this._panStart=new THREE.Vector2,this._panEnd=new THREE.Vector2,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom,this.center0=new THREE.Vector2((this.left0+this.right0)/2,(this.top0+this.bottom0)/2);var h={type:"change"},u={type:"start"},p={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}this.left0=this.object.left,this.right0=this.object.right,this.top0=this.object.top,this.bottom0=this.object.bottom,this.center0.set((this.left0+this.right0)/2,(this.top0+this.bottom0)/2)},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var m,f,g,v,y,b,_=(m=new THREE.Vector2,function(e,t){return m.set((e-n.screen.left)/n.screen.width,(t-n.screen.top)/n.screen.height),m}),w=function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3;return function(r,o){i.set((r-.5*n.screen.width-n.screen.left)/(.5*n.screen.width),(.5*n.screen.height+n.screen.top-o)/(.5*n.screen.height),0);var s=i.length();return n.noRoll?i.z=s<Math.SQRT1_2?Math.sqrt(1-s*s):.5/s:s>1?i.normalize():i.z=Math.sqrt(1-s*s),a.copy(n.object.position).sub(n.target),e.copy(n.object.up).setLength(i.y),e.add(t.copy(n.object.up).cross(a).setLength(i.x)),e.add(a.setLength(i.z)),e}}();function x(e){!1!==n.enabled&&(window.removeEventListener("keydown",x),s=n._state,n._state===r.NONE&&(e.keyCode!==n.keys[r.ROTATE]||n.noRotate?e.keyCode!==n.keys[r.ZOOM]||n.noZoom?e.keyCode!==n.keys[r.PAN]||n.noPan||(n._state=r.PAN):n._state=r.ZOOM:n._state=r.ROTATE))}function C(e){!1!==n.enabled&&(e.preventDefault(),e.stopPropagation(),n._state!==r.ROTATE||n.noRotate?n._state!==r.ZOOM||n.noZoom?n._state!==r.PAN||n.noPan||n._panEnd.copy(_(e.pageX,e.pageY)):n._zoomEnd.copy(_(e.pageX,e.pageY)):n._rotateEnd.copy(w(e.pageX,e.pageY)))}function S(e){!1!==n.enabled&&(e.preventDefault(),e.stopPropagation(),n._state=r.NONE,document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",S),n.dispatchEvent(p))}function E(e){if(!1!==n.enabled){e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta?t=e.wheelDelta/40:e.detail&&(t=-e.detail/3),n._zoomStart.y=.01*t,n.dispatchEvent(u),n.dispatchEvent(p)}}this.rotateCamera=(f=new THREE.Vector3,g=new THREE.Quaternion,function(e,t){var r;void 0===e&&(r=Math.acos(n._rotateStart.dot(n._rotateEnd)/n._rotateStart.length()/n._rotateEnd.length())),(r||void 0!==e)&&(void 0===e?(f.crossVectors(n._rotateStart,n._rotateEnd).normalize(),g.setFromAxisAngle(f,-(r*=n.rotateSpeed))):g.copy(e),void 0!==t&&!0!==t||i.quaternion.multiplyQuaternions(g,i.quaternion),a.applyQuaternion(g),n.object.up.applyQuaternion(g),n._rotateEnd.applyQuaternion(g),n.staticMoving?n._rotateStart.copy(n._rotateEnd):(g.setFromAxisAngle(f,r*(n.dynamicDampingFactor-1)),n._rotateStart.applyQuaternion(g)))}),this.zoomCamera=function(e,t){var o;n._state===r.TOUCH_ZOOM_PAN?void 0!==e?o=e:(o=l/d,l=d):o=void 0!==e?e:1+(n._zoomEnd.y-n._zoomStart.y)*n.zoomSpeed/.01,void 0!==t&&!0!==t||(i._zoomFactor*=o),1!==o&&(n.object.left=(c=o)*n.left0+(1-c)*n.center0.x,n.object.right=c*n.right0+(1-c)*n.center0.x,n.object.top=c*n.top0+(1-c)*n.center0.y,n.object.bottom=c*n.bottom0+(1-c)*n.center0.y,n.staticMoving?n._zoomStart.copy(n._zoomEnd):n._zoomStart.y+=(n._zoomEnd.y-n._zoomStart.y)*this.dynamicDampingFactor)},this.panCamera=(v=new THREE.Vector2,y=new THREE.Vector3,b=new THREE.Vector3,function(e,t){void 0!==e?(v=e,void 0!==t&&!0!==t||i.mouseChange.add(e)):(v.copy(n._panEnd).sub(n._panStart),void 0!==t&&!0!==t||i.mouseChange.add(n._panEnd).sub(n._panStart)),v.lengthSq()&&(v.multiplyScalar(a.length()*n.panSpeed),b.copy(a).cross(n.object.up).setLength(v.x),b.add(y.copy(n.object.up).setLength(v.y)),n.object.position.add(b),n.target.add(b),n.staticMoving?n._panStart.copy(n._panEnd):n._panStart.add(v.subVectors(n._panEnd,n._panStart).multiplyScalar(n.dynamicDampingFactor)))}),this.update=function(e){a.subVectors(n.object.position,n.target),n.noRotate||(void 0!==e&&void 0!==e.quaternion?n.rotateCamera(e.quaternion,e.update):n.rotateCamera()),n.noZoom||(void 0!==e&&void 0!==e._zoomFactor?n.zoomCamera(e._zoomFactor,e.update):n.zoomCamera(),n.object.updateProjectionMatrix()),n.noPan||(void 0!==e&&void 0!==e.mouseChange?n.panCamera(e.mouseChange,e.update):n.panCamera()),n.object.position.addVectors(n.target,a),n.object.lookAt(n.target),o.distanceToSquared(n.object.position)>1e-6&&(n.dispatchEvent(h),o.copy(n.object.position))},this.reset=function(){n._state=r.NONE,s=r.NONE,n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.up.copy(n.up0),a.subVectors(n.object.position,n.target),n.object.left=n.left0,n.object.right=n.right0,n.object.top=n.top0,n.object.bottom=n.bottom0,n.object.lookAt(n.target),n.dispatchEvent(h),o.copy(n.object.position)},this.domElement.addEventListener("contextmn",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",function(e){!1!==n.enabled&&(e.preventDefault(),e.stopPropagation(),n._state===r.NONE&&(n._state=e.button),n._state!==r.ROTATE||n.noRotate?n._state!==r.ZOOM||n.noZoom?n._state!==r.PAN||n.noPan||(n._panStart.copy(_(e.pageX,e.pageY)),n._panEnd.copy(n._panStart)):(n._zoomStart.copy(_(e.pageX,e.pageY)),n._zoomEnd.copy(n._zoomStart)):(n._rotateStart.copy(w(e.pageX,e.pageY)),n._rotateEnd.copy(n._rotateStart)),document.addEventListener("mousemove",C,!1),document.addEventListener("mouseup",S,!1),n.dispatchEvent(u))},!1),this.domElement.addEventListener("mousewheel",E,!1),this.domElement.addEventListener("DOMMouseScroll",E,!1),this.domElement.addEventListener("touchstart",function(e){if(!1!==n.enabled){switch(e.touches.length){case 1:n._state=r.TOUCH_ROTATE,n._rotateStart.copy(w(e.touches[0].pageX,e.touches[0].pageY)),n._rotateEnd.copy(n._rotateStart);break;case 2:n._state=r.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;d=l=Math.sqrt(t*t+i*i),n._panStart.copy(_((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2)),n._panEnd.copy(n._panStart);break;default:n._state=r.NONE}n.dispatchEvent(u)}},!1),this.domElement.addEventListener("touchend",function(e){if(!1!==n.enabled){switch(e.touches.length){case 1:n._rotateEnd.copy(w(e.touches[0].pageX,e.touches[0].pageY)),n._rotateStart.copy(n._rotateEnd);break;case 2:l=d=0,n._panEnd.copy(_((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2)),n._panStart.copy(n._panEnd)}n._state=r.NONE,n.dispatchEvent(p)}},!1),this.domElement.addEventListener("touchmove",function(e){if(!1!==n.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:n._rotateEnd.copy(w(e.touches[0].pageX,e.touches[0].pageY));break;case 2:var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY;d=Math.sqrt(t*t+i*i),n._panEnd.copy(_((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2));break;default:n._state=r.NONE}},!1),window.addEventListener("keydown",x,!1),window.addEventListener("keyup",function(e){!1!==n.enabled&&(n._state=s,window.addEventListener("keydown",x,!1))},!1),this.handleResize(),this.update()},THREE.OrthographicTrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrthographicTrackballControls.prototype.constructor=THREE.OrthographicTrackballControls,THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0},THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null},THREE.Projector=function(){var e,t,i,n,r,o,s,a,c,l,d,h=[],u=0,p=[],m=0,f=[],g=0,v=[],y=0,b=[],_=0,w={objects:[],lights:[],elements:[]},x=new THREE.Vector3,C=new THREE.Vector3,S=new THREE.Vector3,E=new THREE.Vector3,M=new THREE.Vector4,T=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),A=new THREE.Box3,k=new Array(3),R=(new Array(4),new THREE.Matrix4),D=new THREE.Matrix4,L=new THREE.Matrix4,I=new THREE.Matrix3,O=new THREE.Frustum,P=new THREE.Vector4,H=new THREE.Vector4;this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pkRay=function(e,t){console.error("THREE.Projector: .pkRay() is now raycaster.setFromCamera().")};var N=new function(){var e=[],t=[],n=null,o=null,a=new THREE.Matrix3,c=function(e){var t=e.positionWorld,i=e.positionScreen;t.copy(e.position).applyMatrix4(d),i.copy(t).applyMatrix4(D);var n=1/i.w;i.x*=n,i.y*=n,i.z*=n,e.visible=i.x>=-1&&i.x<=1&&i.y>=-1&&i.y<=1&&i.z>=-1&&i.z<=1},l=function(e,t,i){return!0===e.visible||!0===t.visible||!0===i.visible||(k[0]=e.positionScreen,k[1]=t.positionScreen,k[2]=i.positionScreen,T.isIntersectionBox(A.setFromPoints(k)))},h=function(e,t,i){return(i.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(i.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0};return{setObject:function(i){o=(n=i).material,a.getNormalMatrix(n.matrixWorld),e.length=0,t.length=0},projectVertex:c,checkTriangleVisibility:l,checkBackfaceCulling:h,pushVertex:function(e,t,n){(i=z()).position.set(e,t,n),c(i)},pushNormal:function(t,i,n){e.push(t,i,n)},pushUv:function(e,i){t.push(e,i)},pushLine:function(e,t){var i=p[e],r=p[t];(s=U()).id=n.id,s.v1.copy(i),s.v2.copy(r),s.z=(i.positionScreen.z+r.positionScreen.z)/2,s.material=n.material,w.elements.push(s)},pushTriangle:function(i,s,c){var d=p[i],u=p[s],m=p[c];if(!1!==l(d,u,m)&&(o.side===THREE.DoubleSide||!0===h(d,u,m))){(r=F()).id=n.id,r.v1.copy(d),r.v2.copy(u),r.v3.copy(m),r.z=(d.positionScreen.z+u.positionScreen.z+m.positionScreen.z)/3;for(var f=0;f<3;f++){var g=3*arguments[f],v=r.vertexNormalsModel[f];v.set(e[g],e[g+1],e[g+2]),v.applyMatrix3(a).normalize();var y=2*arguments[f];r.uvs[f].set(t[y],t[y+1])}r.vertexNormalsLength=3,r.material=n.material,w.elements.push(r)}}}};function z(){if(n===m){var e=new THREE.RenderableVertex;return p.push(e),m++,n++,e}return p[n++]}function F(){if(o===g){var e=new THREE.RenderableFace;return f.push(e),g++,o++,e}return f[o++]}function U(){if(a===y){var e=new THREE.RenderableLine;return v.push(e),y++,a++,e}return v[a++]}function B(){if(l===_){var e=new THREE.RenderableSprite;return b.push(e),_++,l++,e}return b[l++]}function j(e,t){return e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}this.projectScene=function(i,m,f,g){o=0,a=0,l=0,w.elements.length=0,!0===i.autoUpdate&&i.updateMatrixWorld(),void 0===m.parent&&m.updateMatrixWorld(),R.copy(m.matrixWorldInverse.getInverse(m.matrixWorld)),D.multiplyMatrices(m.projectionMatrix,R),O.setFromMatrix(D),t=0,w.objects.length=0,w.lights.length=0,i.traverseVisible(function(i){if(i instanceof THREE.Light)w.lights.push(i);else if(i instanceof THREE.Mesh||i instanceof THREE.Line||i instanceof THREE.Sprite){if(!1===i.material.visible)return;!1!==i.frustumCulled&&!0!==O.intersectsObject(i)||((e=function(){if(t===u){var e=new THREE.RenderableObject;return h.push(e),u++,t++,e}return h[t++]}()).id=i.id,e.object=i,E.setFromMatrixPosition(i.matrixWorld),E.applyProjection(D),e.z=E.z,w.objects.push(e))}}),!0===f&&w.objects.sort(j);for(var v=0,y=w.objects.length;v<y;v++){var b=w.objects[v].object,_=b.geometry;if(N.setObject(b),d=b.matrixWorld,n=0,b instanceof THREE.Mesh){if(_ instanceof THREE.BufferGeometry){var T=_.offsets;if(void 0===(Me=_.attributes).position)continue;for(var A=0,k=(Te=Me.position.array).length;A<k;A+=3)N.pushVertex(Te[A],Te[A+1],Te[A+2]);if(void 0!==Me.normal){var G=Me.normal.array;for(A=0,k=G.length;A<k;A+=3)N.pushNormal(G[A],G[A+1],G[A+2])}if(void 0!==Me.uv){var V=Me.uv.array;for(A=0,k=V.length;A<k;A+=2)N.pushUv(V[A],V[A+1])}if(void 0!==Me.index){var $=Me.index.array;if(T.length>0)for(v=0;v<T.length;v++){var W=T[v],q=W.index;for(A=W.start,k=W.start+W.count;A<k;A+=3)N.pushTriangle($[A]+q,$[A+1]+q,$[A+2]+q)}else for(A=0,k=$.length;A<k;A+=3)N.pushTriangle($[A],$[A+1],$[A+2])}else for(A=0,k=Te.length/3;A<k;A+=3)N.pushTriangle(A,A+1,A+2)}else if(_ instanceof THREE.Geometry){var Y=_.vertices,X=_.faces,Z=_.faceVertexUvs[0];I.getNormalMatrix(d);for(var K=b.material instanceof THREE.MeshFaceMaterial,J=!0===K?b.material:null,Q=0,ee=Y.length;Q<ee;Q++){var te=Y[Q];N.pushVertex(te.x,te.y,te.z)}for(var ie=0,ne=X.length;ie<ne;ie++){var re=X[ie],oe=!0===K?J.materials[re.materialIndex]:b.material;if(void 0!==oe){var se=oe.side,ae=p[re.a],ce=p[re.b],le=p[re.c];if(!0===oe.morphTargets){var de=_.morphTargets,he=b.morphTargetInfluences,ue=ae.position,pe=ce.position,me=le.position;x.set(0,0,0),C.set(0,0,0),S.set(0,0,0);for(var fe=0,ge=de.length;fe<ge;fe++){var ve=he[fe];if(0!==ve){var ye=de[fe].vertices;x.x+=(ye[re.a].x-ue.x)*ve,x.y+=(ye[re.a].y-ue.y)*ve,x.z+=(ye[re.a].z-ue.z)*ve,C.x+=(ye[re.b].x-pe.x)*ve,C.y+=(ye[re.b].y-pe.y)*ve,C.z+=(ye[re.b].z-pe.z)*ve,S.x+=(ye[re.c].x-me.x)*ve,S.y+=(ye[re.c].y-me.y)*ve,S.z+=(ye[re.c].z-me.z)*ve}}ae.position.add(x),ce.position.add(C),le.position.add(S),N.projectVertex(ae),N.projectVertex(ce),N.projectVertex(le)}if(!1!==N.checkTriangleVisibility(ae,ce,le)){var be=N.checkBackfaceCulling(ae,ce,le);if(se!==THREE.DoubleSide){if(se===THREE.FrontSide&&!1===be)continue;if(se===THREE.BackSide&&!0===be)continue}(r=F()).id=b.id,r.v1.copy(ae),r.v2.copy(ce),r.v3.copy(le),r.normalModel.copy(re.normal),!1!==be||se!==THREE.BackSide&&se!==THREE.DoubleSide||r.normalModel.negate(),r.normalModel.applyMatrix3(I).normalize();for(var _e=re.vertexNormals,we=0,xe=Math.min(_e.length,3);we<xe;we++){var Ce=r.vertexNormalsModel[we];Ce.copy(_e[we]),!1!==be||se!==THREE.BackSide&&se!==THREE.DoubleSide||Ce.negate(),Ce.applyMatrix3(I).normalize()}r.vertexNormalsLength=_e.length;var Se=Z[ie];if(void 0!==Se)for(var Ee=0;Ee<3;Ee++)r.uvs[Ee].copy(Se[Ee]);r.color=re.color,r.material=oe,r.z=(ae.positionScreen.z+ce.positionScreen.z+le.positionScreen.z)/3,w.elements.push(r)}}}}}else if(b instanceof THREE.Line){var Me;if(_ instanceof THREE.BufferGeometry){if(void 0!==(Me=_.attributes).position){var Te;for(A=0,k=(Te=Me.position.array).length;A<k;A+=3)N.pushVertex(Te[A],Te[A+1],Te[A+2]);if(void 0!==Me.index)for(A=0,k=($=Me.index.array).length;A<k;A+=2)N.pushLine($[A],$[A+1]);else{var Ae=b.mode===THREE.LinePieces?2:1;for(A=0,k=Te.length/3-1;A<k;A+=Ae)N.pushLine(A,A+1)}}}else if(_ instanceof THREE.Geometry){if(L.multiplyMatrices(D,d),0===(Y=b.geometry.vertices).length)continue;for((ae=z()).positionScreen.copy(Y[0]).applyMatrix4(L),Ae=b.mode===THREE.LinePieces?2:1,Q=1,ee=Y.length;Q<ee;Q++)(ae=z()).positionScreen.copy(Y[Q]).applyMatrix4(L),(Q+1)%Ae>0||(ce=p[n-2],P.copy(ae.positionScreen),H.copy(ce.positionScreen),1==(Le=void 0,Ie=void 0,void 0,void 0,void 0,void 0,Le=0,Ie=1,Pe=(De=H).z+De.w,He=-(Re=P).z+Re.w,Ne=-De.z+De.w,(Oe=Re.z+Re.w)>=0&&Pe>=0&&He>=0&&Ne>=0||!(Oe<0&&Pe<0||He<0&&Ne<0)&&(Oe<0?Le=Math.max(Le,Oe/(Oe-Pe)):Pe<0&&(Ie=Math.min(Ie,Oe/(Oe-Pe))),He<0?Le=Math.max(Le,He/(He-Ne)):Ne<0&&(Ie=Math.min(Ie,He/(He-Ne))),!(Ie<Le||(Re.lerp(De,Le),De.lerp(Re,1-Ie),0))))&&(P.multiplyScalar(1/P.w),H.multiplyScalar(1/H.w),(s=U()).id=b.id,s.v1.positionScreen.copy(P),s.v2.positionScreen.copy(H),s.z=Math.max(P.z,H.z),s.material=b.material,b.material.vertexColors===THREE.VertexColors&&(s.vertexColors[0].copy(b.geometry.colors[Q]),s.vertexColors[1].copy(b.geometry.colors[Q-1])),w.elements.push(s)))}}else if(b instanceof THREE.Sprite){M.set(d.elements[12],d.elements[13],d.elements[14],1),M.applyMatrix4(D);var ke=1/M.w;M.z*=ke,M.z>=-1&&M.z<=1&&((c=B()).id=b.id,c.x=M.x*ke,c.y=M.y*ke,c.z=M.z,c.object=b,c.rotation=b.rotation,c.scale.x=b.scale.x*Math.abs(c.x-(M.x+m.projectionMatrix.elements[0])/(M.w+m.projectionMatrix.elements[12])),c.scale.y=b.scale.y*Math.abs(c.y-(M.y+m.projectionMatrix.elements[5])/(M.w+m.projectionMatrix.elements[13])),c.material=b.material,w.elements.push(c))}}var Re,De,Le,Ie,Oe,Pe,He,Ne;return!0===g&&w.elements.sort(j),w}},function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.MMTF=e.MMTF||{})}(this,function(e){"use strict";function t(e,t,i){for(var n=0,r=i.length;r>n;n++){var o=i.charCodeAt(n);if(128>o)e.setUint8(t++,o>>>0&127|0);else if(2048>o)e.setUint8(t++,o>>>6&31|192),e.setUint8(t++,o>>>0&63|128);else if(65536>o)e.setUint8(t++,o>>>12&15|224),e.setUint8(t++,o>>>6&63|128),e.setUint8(t++,o>>>0&63|128);else{if(!(1114112>o))throw new Error("bad codepoint "+o);e.setUint8(t++,o>>>18&7|240),e.setUint8(t++,o>>>12&63|128),e.setUint8(t++,o>>>6&63|128),e.setUint8(t++,o>>>0&63|128)}}}function i(e){for(var t=0,i=0,n=e.length;n>i;i++){var r=e.charCodeAt(i);if(128>r)t+=1;else if(2048>r)t+=2;else if(65536>r)t+=3;else{if(!(1114112>r))throw new Error("bad codepoint "+r);t+=4}}return t}function n(e,r,o){var s=typeof e;if("string"===s){if(32>(a=i(e)))return r.setUint8(o,160|a),t(r,o+1,e),1+a;if(256>a)return r.setUint8(o,217),r.setUint8(o+1,a),t(r,o+2,e),2+a;if(65536>a)return r.setUint8(o,218),r.setUint16(o+1,a),t(r,o+3,e),3+a;if(4294967296>a)return r.setUint8(o,219),r.setUint32(o+1,a),t(r,o+5,e),5+a}if(e instanceof Uint8Array){var a=e.byteLength,c=new Uint8Array(r.buffer);if(256>a)return r.setUint8(o,196),r.setUint8(o+1,a),c.set(e,o+2),2+a;if(65536>a)return r.setUint8(o,197),r.setUint16(o+1,a),c.set(e,o+3),3+a;if(4294967296>a)return r.setUint8(o,198),r.setUint32(o+1,a),c.set(e,o+5),5+a}if("number"===s){if(!isFinite(e))throw new Error("Number not finite: "+e);if(Math.floor(e)!==e)return r.setUint8(o,203),r.setFloat64(o+1,e),9;if(e>=0){if(128>e)return r.setUint8(o,e),1;if(256>e)return r.setUint8(o,204),r.setUint8(o+1,e),2;if(65536>e)return r.setUint8(o,205),r.setUint16(o+1,e),3;if(4294967296>e)return r.setUint8(o,206),r.setUint32(o+1,e),5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return r.setInt8(o,e),1;if(e>=-128)return r.setUint8(o,208),r.setInt8(o+1,e),2;if(e>=-32768)return r.setUint8(o,209),r.setInt16(o+1,e),3;if(e>=-2147483648)return r.setUint8(o,210),r.setInt32(o+1,e),5;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(null===e)return r.setUint8(o,192),1;if("boolean"===s)return r.setUint8(o,e?195:194),1;if("object"===s){var l=0,d=Array.isArray(e);if(d)a=e.length;else{var h=Object.keys(e);a=h.length}if(16>a?(r.setUint8(o,a|(d?144:128)),l=1):65536>a?(r.setUint8(o,d?220:222),r.setUint16(o+1,a),l=3):4294967296>a&&(r.setUint8(o,d?221:223),r.setUint32(o+1,a),l=5),d)for(var u=0;a>u;u++)l+=n(e[u],r,o+l);else for(u=0;a>u;u++){var p=h[u];l+=n(p,r,o+l),l+=n(e[p],r,o+l)}return l}throw new Error("Unknown type "+s)}function r(e){var t=new ArrayBuffer(function e(t){var n=typeof t;if("string"===n){if(32>(r=i(t)))return 1+r;if(256>r)return 2+r;if(65536>r)return 3+r;if(4294967296>r)return 5+r}if(t instanceof Uint8Array){if(256>(r=t.byteLength))return 2+r;if(65536>r)return 3+r;if(4294967296>r)return 5+r}if("number"===n){if(Math.floor(t)!==t)return 9;if(t>=0){if(128>t)return 1;if(256>t)return 2;if(65536>t)return 3;if(4294967296>t)return 5;throw new Error("Number too big 0x"+t.toString(16))}if(t>=-32)return 1;if(t>=-128)return 2;if(t>=-32768)return 3;if(t>=-2147483648)return 5;throw new Error("Number too small -0x"+t.toString(16).substr(1))}if("boolean"===n||null===t)return 1;if("object"===n){var r,o=0;if(Array.isArray(t)){r=t.length;for(var s=0;r>s;s++)o+=e(t[s])}else{var a=Object.keys(t);for(r=a.length,s=0;r>s;s++){var c=a[s];o+=e(c)+e(t[c])}}if(16>r)return 1+o;if(65536>r)return 3+o;if(4294967296>r)return 5+o;throw new Error("Array or object too long 0x"+r.toString(16))}throw new Error("Unknown type "+n)}(e));return n(e,new DataView(t),0),new Uint8Array(t)}function o(e,t,i){return t?new e(t.buffer,t.byteOffset,t.byteLength/(i||1)):void 0}function s(e){return o(DataView,e)}function a(e){return o(Uint8Array,e)}function c(e){return o(Int8Array,e)}function l(e){return o(Int32Array,e,4)}function d(e,t){var i=e.length/2;t||(t=new Int16Array(i));for(var n=0,r=0;i>n;++n,r+=2)t[n]=e[r]<<8^e[r+1]<<0;return t}function h(e,t){var i=e.length/4;t||(t=new Int32Array(i));for(var n=0,r=0;i>n;++n,r+=4)t[n]=e[r]<<24^e[r+1]<<16^e[r+2]<<8^e[r+3]<<0;return t}function u(e,t){var i=e.length;t||(t=new Uint8Array(4*i));for(var n=s(t),r=0;i>r;++r)n.setInt32(4*r,e[r]);return a(t)}function p(e,t,i){var n=e.length,r=1/t;i||(i=new Float32Array(n));for(var o=0;n>o;++o)i[o]=e[o]*r;return i}function m(e,t,i){var n=e.length;i||(i=new Int32Array(n));for(var r=0;n>r;++r)i[r]=Math.round(e[r]*t);return i}function f(e,t){var i,n;if(!t){var r=0;for(i=0,n=e.length;n>i;i+=2)r+=e[i+1];t=new e.constructor(r)}var o=0;for(i=0,n=e.length;n>i;i+=2)for(var s=e[i],a=e[i+1],c=0;a>c;++c)t[o]=s,++o;return t}function g(e){if(0===e.length)return new Int32Array;var t,i,n=2;for(t=1,i=e.length;i>t;++t)e[t-1]!==e[t]&&(n+=2);var r=new Int32Array(n),o=0,s=1;for(t=1,i=e.length;i>t;++t)e[t-1]!==e[t]?(r[o]=e[t-1],r[o+1]=s,s=1,o+=2):++s;return r[o]=e[e.length-1],r[o+1]=s,r}function v(e,t){var i=e.length;t||(t=new e.constructor(i)),i&&(t[0]=e[0]);for(var n=1;i>n;++n)t[n]=e[n]+t[n-1];return t}function y(e,t){var i=e.length;t||(t=new e.constructor(i)),t[0]=e[0];for(var n=1;i>n;++n)t[n]=e[n]-e[n-1];return t}function b(e,t){var i,n,r=e instanceof Int8Array?127:32767,o=-r-1,s=e.length;if(!t){var a=0;for(i=0;s>i;++i)e[i]<r&&e[i]>o&&++a;t=new Int32Array(a)}for(i=0,n=0;s>i;){for(var c=0;e[i]===r||e[i]===o;)c+=e[i],++i;c+=e[i],++i,t[n]=c,++n}return t}function _(e,t,i){return p(b(e,l(i)),t,i)}function w(e,t,i,n){var r=new ArrayBuffer(12+n.byteLength),o=new Uint8Array(r),s=new DataView(r);return s.setInt32(0,e),s.setInt32(4,t),i&&o.set(i,8),o.set(n,12),o}function x(e){return w(2,e.length,void 0,a(e))}function C(e){return w(4,e.length,void 0,u(e))}function S(e,t){return w(5,e.length/t,u([t]),a(e))}function E(e){return w(6,e.length,void 0,u(g(e)))}function M(e){return w(8,e.length,void 0,u(function(e){return g(y(e))}(e)))}function T(e,t){var i=e.length,n=u([t]),r=function(e,t){var i=e.length;t||(t=new Uint8Array(2*i));for(var n=s(t),r=0;i>r;++r)n.setInt16(2*r,e[r]);return a(t)}(function(e,t,i){return function(e,t){var i,n=32767,r=-n-1,o=e.length,s=0;for(i=0;o>i;++i)0===(l=e[i])?++s:l>0?(s+=Math.ceil(l/n),l%n==0&&(s+=1)):(s+=Math.ceil(l/r),l%r==0&&(s+=1));var a=new Int16Array(s),c=0;for(i=0;o>i;++i){var l;if((l=e[i])>=0)for(;l>=n;)a[c]=n,++c,l-=n;else for(;r>=l;)a[c]=r,++c,l-=r;a[c]=l,++c}return a}(function(e,t,i){return y(m(e,t),void 0)}(e,t))}(e,t));return w(10,i,n,r)}function A(e){var t={};return O.forEach(function(i){void 0!==e[i]&&(t[i]=e[i])}),e.bondAtomList&&(t.bondAtomList=C(e.bondAtomList)),e.bondOrderList&&(t.bondOrderList=x(e.bondOrderList)),t.xCoordList=T(e.xCoordList,1e3),t.yCoordList=T(e.yCoordList,1e3),t.zCoordList=T(e.zCoordList,1e3),e.bFactorList&&(t.bFactorList=T(e.bFactorList,100)),e.atomIdList&&(t.atomIdList=M(e.atomIdList)),e.altLocList&&(t.altLocList=E(e.altLocList)),e.occupancyList&&(t.occupancyList=function(e,t){return w(9,e.length,u([100]),u(function(e,t){return g(m(e,100))}(e)))}(e.occupancyList)),t.groupIdList=M(e.groupIdList),t.groupTypeList=C(e.groupTypeList),e.secStructList&&(t.secStructList=x(e.secStructList)),e.insCodeList&&(t.insCodeList=E(e.insCodeList)),e.sequenceIndexList&&(t.sequenceIndexList=M(e.sequenceIndexList)),t.chainIdList=S(e.chainIdList,4),e.chainNameList&&(t.chainNameList=S(e.chainNameList,4)),t}function k(e){function t(e){for(var t={},i=0;e>i;i++)t[o()]=o();return t}function i(t){var i=e.subarray(s,s+t);return s+=t,i}function n(t){var i=e.subarray(s,s+t);s+=t;var n=65535;if(t>n){for(var r=[],o=0;o<i.length;o+=n)r.push(String.fromCharCode.apply(null,i.subarray(o,o+n)));return r.join("")}return String.fromCharCode.apply(null,i)}function r(e){for(var t=new Array(e),i=0;e>i;i++)t[i]=o();return t}function o(){var o,c,l=e[s];if(0==(128&l))return s++,l;if(128==(240&l))return s++,t(c=15&l);if(144==(240&l))return s++,r(c=15&l);if(160==(224&l))return s++,n(c=31&l);if(224==(224&l))return o=a.getInt8(s),s++,o;switch(l){case 192:return s++,null;case 194:return s++,!1;case 195:return s++,!0;case 196:return c=a.getUint8(s+1),s+=2,i(c);case 197:return c=a.getUint16(s+1),s+=3,i(c);case 198:return c=a.getUint32(s+1),s+=5,i(c);case 202:return o=a.getFloat32(s+1),s+=5,o;case 203:return o=a.getFloat64(s+1),s+=9,o;case 204:return o=e[s+1],s+=2,o;case 205:return o=a.getUint16(s+1),s+=3,o;case 206:return o=a.getUint32(s+1),s+=5,o;case 208:return o=a.getInt8(s+1),s+=2,o;case 209:return o=a.getInt16(s+1),s+=3,o;case 210:return o=a.getInt32(s+1),s+=5,o;case 217:return c=a.getUint8(s+1),s+=2,n(c);case 218:return c=a.getUint16(s+1),s+=3,n(c);case 219:return c=a.getUint32(s+1),s+=5,n(c);case 220:return c=a.getUint16(s+1),s+=3,r(c);case 221:return c=a.getUint32(s+1),s+=5,r(c);case 222:return c=a.getUint16(s+1),s+=3,t(c);case 223:return c=a.getUint32(s+1),s+=5,t(c)}throw new Error("Unknown type 0x"+l.toString(16))}var s=0,a=new DataView(e.buffer);return o()}function R(e,t){var i=(t=t||{}).ignoreFields,n={};return P.forEach(function(t){var r=!!i&&-1!==i.indexOf(t),u=e[t];r||void 0===u||(n[t]=u instanceof Uint8Array?(function(e,t,i,n){switch(e){case 1:return function(e,t){var i=e.length;t||(t=new Float32Array(i/4));for(var n=s(t),r=s(e),o=0,a=0,c=i/4;c>o;++o,a+=4)n.setFloat32(a,r.getFloat32(a),!0);return t}(t);case 2:return c(t);case 3:return d(t);case 4:return h(t);case 5:return a(t);case 6:return f(h(t),new Uint8Array(i));case 7:return f(h(t));case 8:return function(e,t){return v(f(e),void 0)}(h(t));case 9:return function(e,t,i){return p(f(e,l(i)),t,i)}(h(t),h(n)[0]);case 10:return function(e,t,i){var n=b(e,l(void 0));return function(e,t,i){return p(v(e,l(i)),t,i)}(n,t,o(Float32Array,n,4))}(d(t),h(n)[0]);case 11:return p(d(t),h(n)[0]);case 12:return _(d(t),h(n)[0]);case 13:return _(c(t),h(n)[0]);case 14:return b(d(t));case 15:return b(c(t))}}).apply(null,function(e){var t=s(e),i=t.getInt32(0),n=t.getInt32(4),r=e.subarray(8,12);return[i,e=e.subarray(12),n,r]}(u)):u)}),n}function D(e){return String.fromCharCode.apply(null,e).replace(/\0/g,"")}function L(e,t){return e instanceof ArrayBuffer&&(e=new Uint8Array(e)),R(e instanceof Uint8Array?k(e):e,t)}function I(e,t,i,n){var r=new XMLHttpRequest;r.addEventListener("load",function(){try{var e=L(r.response);i(e)}catch(t){n(t)}},!0),r.addEventListener("error",n,!0),r.responseType="arraybuffer",r.open("GET",t+e.toUpperCase()),r.send()}var O=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"],P=O.concat(["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"]),H="//mmtf.rcsb.org/v1.0/",N=H+"full/",z=H+"reduced/";e.encode=function(e){return r(A(e))},e.decode=L,e.traverse=function(e,t,i){var n,r,o,s,a,c,l=(i=i||{}).firstModelOnly,d=t.onModel,h=t.onChain,u=t.onGroup,p=t.onAtom,m=t.onBond,f=0,g=0,v=0,y=0,b=0,_=-1,w=e.chainNameList,x=e.secStructList,C=e.insCodeList,S=e.sequenceIndexList,E=e.atomIdList,M=e.bFactorList,T=e.altLocList,A=e.occupancyList,k=e.bondAtomList,R=e.bondOrderList;for(n=0,r=e.chainsPerModel.length;r>n&&!(l&&f>0);++n){var L=e.chainsPerModel[f];for(d&&d({chainCount:L,modelIndex:f}),o=0;L>o;++o){var I=e.groupsPerChain[g];if(h){var O=D(e.chainIdList.subarray(4*g,4*g+4)),P=null;w&&(P=D(w.subarray(4*g,4*g+4))),h({groupCount:I,chainIndex:g,modelIndex:f,chainId:O,chainName:P})}for(s=0;I>s;++s){var H=e.groupList[e.groupTypeList[v]],N=H.atomNameList.length;if(u){var z=null;x&&(z=x[v]);var F=null;e.insCodeList&&(F=String.fromCharCode(C[v]));var U=null;S&&(U=S[v]),u({atomCount:N,groupIndex:v,chainIndex:g,modelIndex:f,groupId:e.groupIdList[v],groupType:e.groupTypeList[v],groupName:H.groupName,singleLetterCode:H.singleLetterCode,chemCompType:H.chemCompType,secStruct:z,insCode:F,sequenceIndex:U})}for(a=0;N>a;++a){if(p){var B=null;E&&(B=E[y]);var j=null;M&&(j=M[y]);var G=null;T&&(G=String.fromCharCode(T[y]));var V=null;A&&(V=A[y]),p({atomIndex:y,groupIndex:v,chainIndex:g,modelIndex:f,atomId:B,element:H.elementList[a],atomName:H.atomNameList[a],formalCharge:H.formalChargeList[a],xCoord:e.xCoordList[y],yCoord:e.yCoordList[y],zCoord:e.zCoordList[y],bFactor:j,altLoc:G,occupancy:V})}y+=1}if(m){var $=H.bondAtomList;for(a=0,c=H.bondOrderList.length;c>a;++a)m({atomIndex1:y-N+$[2*a],atomIndex2:y-N+$[2*a+1],bondOrder:H.bondOrderList[a]})}v+=1}g+=1}if(b=_+1,_=y-1,m&&k)for(a=0,c=k.length;c>a;a+=2){var W=k[a],q=k[a+1];(W>=b&&_>=W||q>=b&&_>=q)&&m({atomIndex1:W,atomIndex2:q,bondOrder:R?R[a/2]:null})}f+=1}},e.fetch=function(e,t,i){I(e,N,t,i)},e.fetchReduced=function(e,t,i){I(e,z,t,i)},e.version="v1.0.1",e.fetchUrl=N,e.fetchReducedUrl=z,e.encodeMsgpack=r,e.encodeMmtf=A,e.decodeMsgpack=k,e.decodeMmtf=R});var $NGL_shaderTextHash={};if($NGL_shaderTextHash["SphereImpostor.frag"]=["#define STANDARD","#define IMPOSTOR","","uniform vec3 diffuse;","uniform vec3 emissive;","uniform float roughness;","uniform float metalness;","uniform float opacity;","uniform float nearClip;","uniform mat4 projectionMatrix;","uniform float ortho;","","varying float vRadius;","varying float vRadiusSq;","varying vec3 vPoint;","varying vec3 vPointViewPosition;","","#ifdef PICKING","    uniform float objectId;","    varying vec3 vPickingColor;","#else","    #include common","    #include color_pars_fragment","    #include fog_pars_fragment","    #include bsdfs","    #include lights_pars_begin","    #include lights_physical_pars_fragment","#endif","","bool flag2 = false;","bool interior = false;","vec3 cameraPos;","vec3 cameraNormal;","","// Calculate depth based on the given camera position.","float calcDepth( in vec3 cameraPos ){","    vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;","    return 0.5 + 0.5 * clipZW.x / clipZW.y;","}","","float calcClip( vec3 cameraPos ){","    return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, nearClip - 0.5 ) );","}","","bool Impostor( out vec3 cameraPos, out vec3 cameraNormal ){","","    vec3 cameraSpherePos = -vPointViewPosition;","    cameraSpherePos.z += vRadius;","","    vec3 rayOrigin = mix( vec3( 0.0, 0.0, 0.0 ), vPoint, ortho );","    vec3 rayDirection = mix( normalize( vPoint ), vec3( 0.0, 0.0, 1.0 ), ortho );","    vec3 cameraSphereDir = mix( cameraSpherePos, rayOrigin - cameraSpherePos, ortho );","","    float B = dot( rayDirection, cameraSphereDir );","    float det = B * B + vRadiusSq - dot( cameraSphereDir, cameraSphereDir );","","    if( det < 0.0 ){","        discard;","        return false;","    }","        float sqrtDet = sqrt( det );","        float posT = mix( B + sqrtDet, B + sqrtDet, ortho );","        float negT = mix( B - sqrtDet, sqrtDet - B, ortho );","","        cameraPos = rayDirection * negT + rayOrigin;","","        #ifdef NEAR_CLIP","if( calcDepth( cameraPos ) <= 0.0 ){","    cameraPos = rayDirection * posT + rayOrigin;","    interior = true;","    return false;","}else if( calcClip( cameraPos ) > 0.0 ){","    cameraPos = rayDirection * posT + rayOrigin;","    interior = true;","    flag2 = true;","    return false;","}else{","    cameraNormal = normalize( cameraPos - cameraSpherePos );","}","        #else","if( calcDepth( cameraPos ) <= 0.0 ){","    cameraPos = rayDirection * posT + rayOrigin;","    interior = true;","    return false;","}else{","    cameraNormal = normalize( cameraPos - cameraSpherePos );","}","        #endif","","        cameraNormal = normalize( cameraPos - cameraSpherePos );","        cameraNormal *= float(!interior) * 2.0 - 1.0;","         return !interior;","","}","","void main(void){","","    bool flag = Impostor( cameraPos, cameraNormal );","","    #ifdef NEAR_CLIP","        if( calcClip( cameraPos ) > 0.0 )","            discard;","    #endif","","    // FIXME not compatible with custom clipping plane","    //Set the depth based on the new cameraPos.","    gl_FragDepthEXT = calcDepth( cameraPos );","    if( !flag ){","","        // clamp to near clipping plane and add a tiny value to","        // make spheres with a greater radius occlude smaller ones","        #ifdef NEAR_CLIP","if( flag2 ){","    gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( nearClip - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );","}else if( gl_FragDepthEXT >= 0.0 ){","    gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );","}","        #else","if( gl_FragDepthEXT >= 0.0 ){","    gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );","}","        #endif","","    }","","    // bugfix (mac only?)","    if (gl_FragDepthEXT < 0.0)","        discard;","    if (gl_FragDepthEXT > 1.0)","        discard;","","    #ifdef PICKING","","        gl_FragColor = vec4( vPickingColor, objectId );","","    #else","","        vec3 vNormal = cameraNormal;","        vec3 vViewPosition = -cameraPos;","","        vec4 diffuseColor = vec4( diffuse, opacity );","        ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","        vec3 totalEmissiveLight = emissive;","","        #include color_fragment","        #include roughnessmap_fragment","        #include metalnessmap_fragment","","        // don't use include normal_fragment","        vec3 normal = normalize( vNormal );","","        #include lights_physical_fragment","        //include lights_template","        #include lights_fragment_begin","        #include lights_fragment_end","","        vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;","","        gl_FragColor = vec4( outgoingLight, diffuseColor.a );","        //gl_FragColor = vec4( reflectedLight.directSpecular, diffuseColor.a );","","        #include premultiplied_alpha_fragment","        #include tonemapping_fragment","        #include encodings_fragment","        #include fog_fragment","","    #endif","","}"].join("\n"),$NGL_shaderTextHash["SphereImpostor.vert"]=["uniform mat4 projectionMatrixInverse;","uniform float nearClip;","","varying float vRadius;","varying float vRadiusSq;","varying vec3 vPoint;","varying vec3 vPointViewPosition;","varying float fogDepth;","","attribute vec2 mapping;","//attribute vec3 position;","attribute float radius;","","#ifdef PICKING","    #include unpack_clr","    attribute float primitiveId;","    varying vec3 vPickingColor;","#else","    #include color_pars_vertex","#endif","","//include matrix_scale","float matrixScale( in mat4 m ){","    vec4 r = m[ 0 ];","    return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );","}","","const mat4 D = mat4(","    1.0, 0.0, 0.0, 0.0,","    0.0, 1.0, 0.0, 0.0,","    0.0, 0.0, 1.0, 0.0,","    0.0, 0.0, 0.0, -1.0",");","","mat4 transpose( in mat4 inMatrix ) {","    vec4 i0 = inMatrix[0];","    vec4 i1 = inMatrix[1];","    vec4 i2 = inMatrix[2];","    vec4 i3 = inMatrix[3];","","    mat4 outMatrix = mat4(","        vec4(i0.x, i1.x, i2.x, i3.x),","        vec4(i0.y, i1.y, i2.y, i3.y),","        vec4(i0.z, i1.z, i2.z, i3.z),","        vec4(i0.w, i1.w, i2.w, i3.w)","    );","    return outMatrix;","}","","//------------------------------------------------------------------------------","// Compute point size and center using the technique described in:","// 'GPU-Based Ray-Casting of Quadratic Surfaces'","// by Christian Sigg, Tim Weyrich, Mario Botsch, Markus Gross.","//","// Code based on","/*=========================================================================",""," Program:   Visualization Toolkit"," Module:    Quadrics_fs.glsl and Quadrics_vs.glsl",""," Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen"," All rights reserved."," See Copyright.txt or http://www.kitware.com/Copyright.htm for details.",""," This software is distributed WITHOUT ANY WARRANTY; without even"," the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR"," PURPOSE.  See the above copyright notice for more information.",""," =========================================================================*/","","// .NAME Quadrics_fs.glsl and Quadrics_vs.glsl","// .SECTION Thanks","// <verbatim>","//","//  This file is part of the PointSprites plugin developed and contributed by","//","//  Copyright (c) CSCS - Swiss National Supercomputing Centre","//                EDF - Electricite de France","//","//  John Biddiscombe, Ugo Varetto (CSCS)","//  Stephane Ploix (EDF)","//","// </verbatim>","//","// Contributions by Alexander Rose","// - ported to WebGL","// - adapted to work with quads","void ComputePointSizeAndPositionInClipCoordSphere(){","","    vec2 xbc;","    vec2 ybc;","","    mat4 T = mat4(","        radius, 0.0, 0.0, 0.0,","        0.0, radius, 0.0, 0.0,","        0.0, 0.0, radius, 0.0,","        position.x, position.y, position.z, 1.0","    );","","    mat4 R = transpose( projectionMatrix * modelViewMatrix * T );","    float A = dot( R[ 3 ], D * R[ 3 ] );","    float B = -2.0 * dot( R[ 0 ], D * R[ 3 ] );","    float C = dot( R[ 0 ], D * R[ 0 ] );","    xbc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    xbc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    float sx = abs( xbc[ 0 ] - xbc[ 1 ] ) * 0.5;","","    A = dot( R[ 3 ], D * R[ 3 ] );","    B = -2.0 * dot( R[ 1 ], D * R[ 3 ] );","    C = dot( R[ 1 ], D * R[ 1 ] );","    ybc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    ybc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    float sy = abs( ybc[ 0 ] - ybc[ 1 ]  ) * 0.5;","","    gl_Position.xy = vec2( 0.5 * ( xbc.x + xbc.y ), 0.5 * ( ybc.x + ybc.y ) );","    gl_Position.xy -= mapping * vec2( sx, sy );","    gl_Position.xy *= gl_Position.w;","","}","","void main(void){","","    #ifdef PICKING","        vPickingColor = unpackColor( primitiveId );","    #else","        #include color_vertex","    #endif","","    vRadius = radius * matrixScale( modelViewMatrix );","","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    // avoid clipping, added again in fragment shader","    mvPosition.z -= vRadius;","","    gl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );","    ComputePointSizeAndPositionInClipCoordSphere();","","","    vRadiusSq = vRadius * vRadius;","    vec4 vPoint4 = projectionMatrixInverse * gl_Position;","    vPoint = vPoint4.xyz / vPoint4.w;","    vPointViewPosition = -mvPosition.xyz / mvPosition.w;","","}"].join("\n"),$NGL_shaderTextHash["CylinderImpostor.frag"]=["#define STANDARD","#define IMPOSTOR","","// Open-Source PyMOL is Copyright (C) Schrodinger, LLC.","//","//  All Rights Reserved","//","//  Permission to use, copy, modify, distribute, and distribute modified","//  versions of this software and its built-in documentation for any","//  purpose and without fee is hereby granted, provided that the above","//  copyright notice appears in all copies and that both the copyright","//  notice and this permission notice appear in supporting documentation,","//  and that the name of Schrodinger, LLC not be used in advertising or","//  publicity pertaining to distribution of the software without specific,","//  written prior permission.","//","//  SCHRODINGER, LLC DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE,","//  INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN","//  NO EVENT SHALL SCHRODINGER, LLC BE LIABLE FOR ANY SPECIAL, INDIRECT OR","//  CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS","//  OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE","//  OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE","//  USE OR PERFORMANCE OF THIS SOFTWARE.","","// Contributions by Alexander Rose","// - ported to WebGL","// - dual color","// - pk color","// - custom clipping","// - three.js lighting","","uniform vec3 diffuse;","uniform vec3 emissive;","uniform float roughness;","uniform float metalness;","uniform float opacity;","uniform float nearClip;","uniform mat4 projectionMatrix;","uniform float ortho;","","varying vec3 axis;","varying vec4 base_radius;","varying vec4 end_b;","varying vec3 U;","varying vec3 V;","varying vec4 w;","","#ifdef PICKING","    uniform float objectId;","    varying vec3 vPickingColor;","#else","    varying vec3 vColor1;","    varying vec3 vColor2;","    #include common","    #include fog_pars_fragment","    #include bsdfs","    #include lights_pars_begin","    #include lights_physical_pars_fragment","#endif","","bool interior = false;","","float distSq3( vec3 v3a, vec3 v3b ){","    return (","        ( v3a.x - v3b.x ) * ( v3a.x - v3b.x ) +","        ( v3a.y - v3b.y ) * ( v3a.y - v3b.y ) +","        ( v3a.z - v3b.z ) * ( v3a.z - v3b.z )","    );","}","","// Calculate depth based on the given camera position.","float calcDepth( in vec3 cameraPos ){","    vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;","    return 0.5 + 0.5 * clipZW.x / clipZW.y;","}","","float calcClip( vec3 cameraPos ){","    return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, nearClip - 0.5 ) );","}","","void main(){","","    vec3 point = w.xyz / w.w;","","    // unpacking","    vec3 base = base_radius.xyz;","    float vRadius = base_radius.w;","    vec3 end = end_b.xyz;","    float b = end_b.w;","","    vec3 end_cyl = end;","    vec3 surface_point = point;","","    vec3 ray_target = surface_point;","    vec3 ray_origin = vec3(0.0);","    vec3 ray_direction = mix(normalize(ray_origin - ray_target), vec3(0.0, 0.0, 1.0), ortho);","    mat3 basis = mat3( U, V, axis );","","    vec3 diff = ray_target - 0.5 * (base + end_cyl);","    vec3 P = diff * basis;","","    // angle (cos) between cylinder cylinder_axis and ray direction","    float dz = dot( axis, ray_direction );","","    float radius2 = vRadius*vRadius;","","    // calculate distance to the cylinder from ray origin","    vec3 D = vec3(dot(U, ray_direction),","                dot(V, ray_direction),","                dz);","    float a0 = P.x*P.x + P.y*P.y - radius2;","    float a1 = P.x*D.x + P.y*D.y;","    float a2 = D.x*D.x + D.y*D.y;","","    // calculate a dicriminant of the above quadratic equation","    float d = a1*a1 - a0*a2;","    if (d < 0.0)","        // outside of the cylinder","        discard;","","    float dist = (-a1 + sqrt(d)) / a2;","","    // point of intersection on cylinder surface","    vec3 new_point = ray_target + dist * ray_direction;","","    vec3 tmp_point = new_point - base;","    vec3 _normal = normalize( tmp_point - axis * dot(tmp_point, axis) );","","    ray_origin = mix( ray_origin, surface_point, ortho );","","    // test caps","    float front_cap_test = dot( tmp_point, axis );","    float end_cap_test = dot((new_point - end_cyl), axis);","","    // to calculate caps, simply check the angle between","    // the point of intersection - cylinder end vector","    // and a cap plane normal (which is the cylinder cylinder_axis)","    // if the angle < 0, the point is outside of cylinder","    // test front cap","","    #ifndef CAP","        vec3 new_point2 = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;","        vec3 tmp_point2 = new_point2 - base;","    #endif","","    // flat","    if (front_cap_test < 0.0)","    {","        // ray-plane intersection","        float dNV = dot(-axis, ray_direction);","        if (dNV < 0.0)","            discard;","        float near = dot(-axis, (base)) / dNV;","        vec3 front_point = ray_direction * near + ray_origin;","        // within the cap radius?","        if (dot(front_point - base, front_point-base) > radius2)","            discard;","","        #ifdef CAP","            new_point = front_point;","            _normal = axis;","        #else","            new_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;","            dNV = dot(-axis, ray_direction);","            near = dot(axis, end_cyl) / dNV;","            new_point2 = ray_direction * near + ray_origin;","            if (dot(new_point2 - end_cyl, new_point2-base) < radius2)","                discard;","            interior = true;","        #endif","    }","","    // test end cap","","","    // flat","    if( end_cap_test > 0.0 )","    {","        // ray-plane intersection","        float dNV = dot(axis, ray_direction);","        if (dNV < 0.0)","            discard;","        float near = dot(axis, end_cyl) / dNV;","        vec3 end_point = ray_direction * near + ray_origin;","        // within the cap radius?","        if( dot(end_point - end_cyl, end_point-base) > radius2 )","            discard;","","        #ifdef CAP","            new_point = end_point;","            _normal = axis;","        #else","            new_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;","            dNV = dot(-axis, ray_direction);","            near = dot(-axis, (base)) / dNV;","            new_point2 = ray_direction * near + ray_origin;","            if (dot(new_point2 - base, new_point2-base) < radius2)","                discard;","            interior = true;","        #endif","    }","","    gl_FragDepthEXT = calcDepth( new_point );","","    #ifdef NEAR_CLIP","        if( calcClip( new_point ) > 0.0 ){","            dist = (-a1 - sqrt(d)) / a2;","            new_point = ray_target + dist * ray_direction;","            if( calcClip( new_point ) > 0.0 )","                discard;","            interior = true;","            gl_FragDepthEXT = calcDepth( new_point );","            if( gl_FragDepthEXT >= 0.0 ){","                gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( nearClip - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );","            }","        }else if( gl_FragDepthEXT <= 0.0 ){","            dist = (-a1 - sqrt(d)) / a2;","            new_point = ray_target + dist * ray_direction;","            interior = true;","            gl_FragDepthEXT = calcDepth( new_point );","            if( gl_FragDepthEXT >= 0.0 ){","                gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );","            }","        }","    #else","        if( gl_FragDepthEXT <= 0.0 ){","            dist = (-a1 - sqrt(d)) / a2;","            new_point = ray_target + dist * ray_direction;","            interior = true;","            gl_FragDepthEXT = calcDepth( new_point );","            if( gl_FragDepthEXT >= 0.0 ){","                gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );","            }","        }","    #endif","","    // this is a workaround necessary for Mac","    // otherwise the modified fragment won't clip properly","    if (gl_FragDepthEXT < 0.0)","        discard;","    if (gl_FragDepthEXT > 1.0)","        discard;","","    #ifdef PICKING","","        gl_FragColor = vec4( vPickingColor, objectId );","","    #else","","        vec3 vViewPosition = -new_point;","        vec3 vNormal = _normal;","        vec3 vColor;","","        if( distSq3( new_point, end_cyl ) < distSq3( new_point, base ) ){","            if( b < 0.0 ){","                vColor = vColor1;","            }else{","                vColor = vColor2;","            }","        }else{","            if( b > 0.0 ){","                vColor = vColor1;","            }else{","                vColor = vColor2;","            }","        }","","        vec4 diffuseColor = vec4( diffuse, opacity );","        ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","        vec3 totalEmissiveLight = emissive;","","        #include color_fragment","     //ifdef USE_COLOR","     //diffuseColor.r *= vColor[0];","     //diffuseColor.g *= vColor[1];","     //diffuseColor.b *= vColor[2];","     //endif","        #include roughnessmap_fragment","        #include metalnessmap_fragment","","        // don't use include normal_fragment","        vec3 normal = normalize( vNormal );","","        #include lights_physical_fragment","        //include lights_template","        #include lights_fragment_begin","        #include lights_fragment_end","","        vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;","","        gl_FragColor = vec4( outgoingLight, diffuseColor.a );","        //gl_FragColor = vec4( reflectedLight.directSpecular, diffuseColor.a );","","        #include premultiplied_alpha_fragment","        #include tonemapping_fragment","        #include encodings_fragment","        #include fog_fragment","    #endif","","}"].join("\n"),$NGL_shaderTextHash["CylinderImpostor.vert"]=["// Open-Source PyMOL is Copyright (C) Schrodinger, LLC.","//","//  All Rights Reserved","//","//  Permission to use, copy, modify, distribute, and distribute modified","//  versions of this software and its built-in documentation for any","//  purpose and without fee is hereby granted, provided that the above","//  copyright notice appears in all copies and that both the copyright","//  notice and this permission notice appear in supporting documentation,","//  and that the name of Schrodinger, LLC not be used in advertising or","//  publicity pertaining to distribution of the software without specific,","//  written prior permission.","//","//  SCHRODINGER, LLC DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE,","//  INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN","//  NO EVENT SHALL SCHRODINGER, LLC BE LIABLE FOR ANY SPECIAL, INDIRECT OR","//  CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS","//  OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE","//  OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE","//  USE OR PERFORMANCE OF THIS SOFTWARE.","","// Contributions by Alexander Rose","// - ported to WebGL","// - dual color","// - pk color","// - shift","","attribute vec3 mapping;","attribute vec3 position1;","attribute vec3 position2;","attribute float radius;","","varying vec3 axis;","varying vec4 base_radius;","varying vec4 end_b;","varying vec3 U;","varying vec3 V;","varying vec4 w;","varying float fogDepth;","","#ifdef PICKING","    #include unpack_clr","    attribute float primitiveId;","    varying vec3 vPickingColor;","#else","    //attribute vec3 color;","    attribute vec3 color2;","    varying vec3 vColor1;","    varying vec3 vColor2;","#endif","","uniform mat4 modelViewMatrixInverse;","uniform float ortho;","","//include matrix_scale","float matrixScale( in mat4 m ){","    vec4 r = m[ 0 ];","    return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );","}","","void main(){","","    #ifdef PICKING","        vPickingColor = unpackColor( primitiveId );","    #else","        vColor1 = color;","        vColor2 = color2;","    #endif","","    // vRadius = radius;","    base_radius.w = radius * matrixScale( modelViewMatrix );","","    //vec3 center = position;","    vec3 center = ( position2 + position1 ) / 2.0;","    vec3 dir = normalize( position2 - position1 );","    float ext = length( position2 - position1 ) / 2.0;","","    // using cameraPosition fails on some machines, not sure why","    // vec3 cam_dir = normalize( cameraPosition - mix( center, vec3( 0.0 ), ortho ) );","    vec3 cam_dir;","    if( ortho == 0.0 ){","        cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 0, 1 ) ).xyz - center;","    }else{","        cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 1, 0 ) ).xyz;","    }","    cam_dir = normalize( cam_dir );","","    vec3 ldir;","","    float b = dot( cam_dir, dir );","    end_b.w = b;","    // direction vector looks away, so flip","    if( b < 0.0 )","        ldir = -ext * dir;","    // direction vector already looks in my direction","    else","        ldir = ext * dir;","","    vec3 left = normalize( cross( cam_dir, ldir ) );","    left = radius * left;","    vec3 up = radius * normalize( cross( left, ldir ) );","","    // transform to modelview coordinates","    axis = normalize( normalMatrix * ldir );","    U = normalize( normalMatrix * up );","    V = normalize( normalMatrix * left );","","    vec4 base4 = modelViewMatrix * vec4( center - ldir, 1.0 );","    base_radius.xyz = base4.xyz / base4.w;","","    vec4 top_position = modelViewMatrix * vec4( center + ldir, 1.0 );","    vec4 end4 = top_position;","    end_b.xyz = end4.xyz / end4.w;","","    w = modelViewMatrix * vec4(","        center + mapping.x*ldir + mapping.y*left + mapping.z*up, 1.0","    );","","    gl_Position = projectionMatrix * w;","","    // avoid clipping (1.0 seems to induce flickering with some drivers)","    gl_Position.z = 0.99;","","}"].join("\n"),$NGL_shaderTextHash["SphereInstancing.frag"]=$NGL_shaderTextHash["SphereImpostor.frag"],$NGL_shaderTextHash["SphereInstancing.vert"]=["uniform mat4 projectionMatrixInverse;","uniform float nearClip;","","varying float vRadius;","varying float vRadiusSq;","varying vec3 vPoint;","varying vec3 vPointViewPosition;","varying float fogDepth;","","attribute vec2 mapping;","//attribute vec3 position;","attribute float radius;","attribute vec4 matrix1;","attribute vec4 matrix2;","attribute vec4 matrix3;","attribute vec4 matrix4;","","#ifdef PICKING","    #include unpack_clr","    attribute float primitiveId;","    varying vec3 vPickingColor;","#else","    #include color_pars_vertex","#endif","","//include matrix_scale","float matrixScale( in mat4 m ){","    vec4 r = m[ 0 ];","    return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );","}","","const mat4 D = mat4(","    1.0, 0.0, 0.0, 0.0,","    0.0, 1.0, 0.0, 0.0,","    0.0, 0.0, 1.0, 0.0,","    0.0, 0.0, 0.0, -1.0",");","","mat4 transpose( in mat4 inMatrix ) {","    vec4 i0 = inMatrix[0];","    vec4 i1 = inMatrix[1];","    vec4 i2 = inMatrix[2];","    vec4 i3 = inMatrix[3];","","    mat4 outMatrix = mat4(","        vec4(i0.x, i1.x, i2.x, i3.x),","        vec4(i0.y, i1.y, i2.y, i3.y),","        vec4(i0.z, i1.z, i2.z, i3.z),","        vec4(i0.w, i1.w, i2.w, i3.w)","    );","    return outMatrix;","}","","//------------------------------------------------------------------------------","// Compute point size and center using the technique described in:","// 'GPU-Based Ray-Casting of Quadratic Surfaces'","// by Christian Sigg, Tim Weyrich, Mario Botsch, Markus Gross.","//","// Code based on","/*=========================================================================",""," Program:   Visualization Toolkit"," Module:    Quadrics_fs.glsl and Quadrics_vs.glsl",""," Copyright (c) Ken Martin, Will Schroeder, Bill Lorensen"," All rights reserved."," See Copyright.txt or http://www.kitware.com/Copyright.htm for details.",""," This software is distributed WITHOUT ANY WARRANTY; without even"," the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR"," PURPOSE.  See the above copyright notice for more information.",""," =========================================================================*/","","// .NAME Quadrics_fs.glsl and Quadrics_vs.glsl","// .SECTION Thanks","// <verbatim>","//","//  This file is part of the PointSprites plugin developed and contributed by","//","//  Copyright (c) CSCS - Swiss National Supercomputing Centre","//                EDF - Electricite de France","//","//  John Biddiscombe, Ugo Varetto (CSCS)","//  Stephane Ploix (EDF)","//","// </verbatim>","//","// Contributions by Alexander Rose","// - ported to WebGL","// - adapted to work with quads","void ComputePointSizeAndPositionInClipCoordSphere(vec4 updatePosition){","","    vec2 xbc;","    vec2 ybc;","","    mat4 T = mat4(","        radius, 0.0, 0.0, 0.0,","        0.0, radius, 0.0, 0.0,","        0.0, 0.0, radius, 0.0,","        updatePosition.x, updatePosition.y, updatePosition.z, 1.0","    );","","    mat4 R = transpose( projectionMatrix * modelViewMatrix * T );","    float A = dot( R[ 3 ], D * R[ 3 ] );","    float B = -2.0 * dot( R[ 0 ], D * R[ 3 ] );","    float C = dot( R[ 0 ], D * R[ 0 ] );","    xbc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    xbc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    float sx = abs( xbc[ 0 ] - xbc[ 1 ] ) * 0.5;","","    A = dot( R[ 3 ], D * R[ 3 ] );","    B = -2.0 * dot( R[ 1 ], D * R[ 3 ] );","    C = dot( R[ 1 ], D * R[ 1 ] );","    ybc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    ybc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );","    float sy = abs( ybc[ 0 ] - ybc[ 1 ]  ) * 0.5;","","    gl_Position.xy = vec2( 0.5 * ( xbc.x + xbc.y ), 0.5 * ( ybc.x + ybc.y ) );","    gl_Position.xy -= mapping * vec2( sx, sy );","    gl_Position.xy *= gl_Position.w;","","}","","  mat4 computeMat(vec4 v1, vec4 v2, vec4 v3, vec4 v4) {","    return mat4(","      v1.x, v1.y, v1.z, v1.w,","      v2.x, v2.y, v2.z, v2.w,","      v3.x, v3.y, v3.z, v3.w,","      v4.x, v4.y, v4.z, v4.w","    );","  }","","void main(void){","","    #ifdef PICKING","        vPickingColor = unpackColor( primitiveId );","    #else","        #include color_vertex","    #endif","","    vRadius = radius * matrixScale( modelViewMatrix );","","    mat4 matrix = computeMat(matrix1, matrix2, matrix3, matrix4);","    vec4 updatePosition = matrix * vec4(position, 1.0);","","//    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    vec4 mvPosition = modelViewMatrix * vec4( updatePosition.xyz, 1.0 );","    // avoid clipping, added again in fragment shader","    mvPosition.z -= vRadius;","","//    gl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );","    gl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );","    ComputePointSizeAndPositionInClipCoordSphere(updatePosition);","","","    vRadiusSq = vRadius * vRadius;","    vec4 vPoint4 = projectionMatrixInverse * gl_Position;","    vPoint = vPoint4.xyz / vPoint4.w;","    vPointViewPosition = -mvPosition.xyz / mvPosition.w;","","}"].join("\n"),$NGL_shaderTextHash["CylinderInstancing.frag"]=$NGL_shaderTextHash["CylinderImpostor.frag"],$NGL_shaderTextHash["CylinderInstancing.vert"]=["// Open-Source PyMOL is Copyright (C) Schrodinger, LLC.","//","//  All Rights Reserved","//","//  Permission to use, copy, modify, distribute, and distribute modified","//  versions of this software and its built-in documentation for any","//  purpose and without fee is hereby granted, provided that the above","//  copyright notice appears in all copies and that both the copyright","//  notice and this permission notice appear in supporting documentation,","//  and that the name of Schrodinger, LLC not be used in advertising or","//  publicity pertaining to distribution of the software without specific,","//  written prior permission.","//","//  SCHRODINGER, LLC DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE,","//  INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN","//  NO EVENT SHALL SCHRODINGER, LLC BE LIABLE FOR ANY SPECIAL, INDIRECT OR","//  CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS","//  OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE","//  OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE","//  USE OR PERFORMANCE OF THIS SOFTWARE.","","// Contributions by Alexander Rose","// - ported to WebGL","// - dual color","// - pk color","// - shift","","attribute vec3 mapping;","attribute vec3 position1;","attribute vec3 position2;","attribute float radius;","attribute vec4 matrix1;","attribute vec4 matrix2;","attribute vec4 matrix3;","attribute vec4 matrix4;","","varying vec3 axis;","varying vec4 base_radius;","varying vec4 end_b;","varying vec3 U;","varying vec3 V;","varying vec4 w;","varying float fogDepth;","","#ifdef PICKING","    #include unpack_clr","    attribute float primitiveId;","    varying vec3 vPickingColor;","#else","    //attribute vec3 color;","    attribute vec3 color2;","    varying vec3 vColor1;","    varying vec3 vColor2;","#endif","","uniform mat4 modelViewMatrixInverse;","uniform float ortho;","","//include matrix_scale","float matrixScale( in mat4 m ){","    vec4 r = m[ 0 ];","    return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );","}","","  mat4 computeMat(vec4 v1, vec4 v2, vec4 v3, vec4 v4) {","    return mat4(","      v1.x, v1.y, v1.z, v1.w,","      v2.x, v2.y, v2.z, v2.w,","      v3.x, v3.y, v3.z, v3.w,","      v4.x, v4.y, v4.z, v4.w","    );","  }","","void main(){","","    #ifdef PICKING","        vPickingColor = unpackColor( primitiveId );","    #else","        vColor1 = color;","        vColor2 = color2;","    #endif","","    // vRadius = radius;","    base_radius.w = radius * matrixScale( modelViewMatrix );","","    //vec3 center = ( position2 + position1 ) / 2.0;","","    mat4 matrix = computeMat(matrix1, matrix2, matrix3, matrix4);","    vec4 updatePosition1 = matrix * vec4(position1, 1.0);","    vec4 updatePosition2 = matrix * vec4(position2, 1.0);","    vec3 center = ( updatePosition2.xyz + updatePosition1.xyz ) / 2.0;","","    //vec3 dir = normalize( position2 - position1 );","    vec3 dir = normalize( updatePosition2.xyz - updatePosition1.xyz );","    float ext = length( position2 - position1 ) / 2.0;","","    // using cameraPosition fails on some machines, not sure why","    // vec3 cam_dir = normalize( cameraPosition - mix( center, vec3( 0.0 ), ortho ) );","    vec3 cam_dir;","    if( ortho == 0.0 ){","        cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 0, 1 ) ).xyz - center;","    }else{","        cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 1, 0 ) ).xyz;","    }","    cam_dir = normalize( cam_dir );","","    vec3 ldir;","","    float b = dot( cam_dir, dir );","    end_b.w = b;","    // direction vector looks away, so flip","    if( b < 0.0 )","        ldir = -ext * dir;","    // direction vector already looks in my direction","    else","        ldir = ext * dir;","","    vec3 left = normalize( cross( cam_dir, ldir ) );","    left = radius * left;","    vec3 up = radius * normalize( cross( left, ldir ) );","","    // transform to modelview coordinates","    axis = normalize( normalMatrix * ldir );","    U = normalize( normalMatrix * up );","    V = normalize( normalMatrix * left );","","    vec4 base4 = modelViewMatrix * vec4( center - ldir, 1.0 );","    base_radius.xyz = base4.xyz / base4.w;","","    vec4 top_position = modelViewMatrix * vec4( center + ldir, 1.0 );","    vec4 end4 = top_position;","    end_b.xyz = end4.xyz / end4.w;","","    w = modelViewMatrix * vec4(","        center + mapping.x*ldir + mapping.y*left + mapping.z*up, 1.0","    );","","    gl_Position = projectionMatrix * w;","","    // avoid clipping (1.0 seems to induce flickering with some drivers)","    gl_Position.z = 0.99;","","}"].join("\n"),$NGL_shaderTextHash["Instancing.frag"]=["#define STANDARD","uniform vec3 diffuse;","uniform vec3 emissive;","uniform float roughness;","uniform float metalness;","uniform float opacity;","uniform float nearClip;","uniform float clipRadius;","uniform mat4 projectionMatrix;","uniform float ortho;","varying float bCylinder;","","#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )","    varying vec3 vViewPosition;","#endif","","#if defined( RADIUS_CLIP )","    varying vec3 vClipCenter;","#endif","","#if defined( PICKING )","    uniform float objectId;","    varying vec3 vPickingColor;","#elif defined( NOLIGHT )","    varying vec3 vColor;","#else","    #ifndef FLAT_SHADED","        varying vec3 vNormal;","    #endif","    #include common","    #include color_pars_fragment","    #include fog_pars_fragment","    #include bsdfs","    #include lights_pars_begin","    #include lights_physical_pars_fragment","#endif","","void main(){","    #include nearclip_fragment","    #include radiusclip_fragment","","    #if defined( PICKING )","","        gl_FragColor = vec4( vPickingColor, objectId );","","    #elif defined( NOLIGHT )","","        gl_FragColor = vec4( vColor, opacity );","","    #else","","        vec4 diffuseColor = vec4( diffuse, opacity );","        ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","        vec3 totalEmissiveLight = emissive;","","        #include color_fragment","        #include roughnessmap_fragment","        #include metalnessmap_fragment","        #include normal_flip","        #include normal_fragment_begin","","        //include dull_interior_fragment","","        #include lights_physical_fragment","        //include lights_template","        #include lights_fragment_begin","        #include lights_fragment_end","","        vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;","","        #include interior_fragment","","        gl_FragColor = vec4( outgoingLight, diffuseColor.a );","","        #include premultiplied_alpha_fragment","        #include tonemapping_fragment","        #include encodings_fragment","        #include fog_fragment","","        #include opaque_back_fragment","","    #endif","","}"].join("\n"),$NGL_shaderTextHash["Instancing.vert"]=["#define STANDARD","","uniform mat4 projectionMatrixInverse;","uniform float nearClip;","uniform vec3 clipCenter;","attribute vec4 matrix1;","attribute vec4 matrix2;","attribute vec4 matrix3;","attribute vec4 matrix4;","attribute float cylinder;","varying float bCylinder;","","#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )","    varying vec3 vViewPosition;","#endif","","#if defined( RADIUS_CLIP )","    varying vec3 vClipCenter;","#endif","","#if defined( PICKING )","    #include unpack_color","    attribute float primitiveId;","    varying vec3 vPickingColor;","#elif defined( NOLIGHT )","    varying vec3 vColor;","#else","    #include color_pars_vertex","    #ifndef FLAT_SHADED","        varying vec3 vNormal;","    #endif","#endif","","#include common","","  mat4 computeMat(vec4 v1, vec4 v2, vec4 v3, vec4 v4) {","    return mat4(","      v1.x, v1.y, v1.z, v1.w,","      v2.x, v2.y, v2.z, v2.w,","      v3.x, v3.y, v3.z, v3.w,","      v4.x, v4.y, v4.z, v4.w","    );","  }","","void main(){","    bCylinder = cylinder;","","    mat4 matrix = computeMat(matrix1, matrix2, matrix3, matrix4);","    vec4 updatePosition = matrix * vec4(position, 1.0);","","    #if defined( PICKING )","        vPickingColor = unpackColor( primitiveId );","    #elif defined( NOLIGHT )","        vColor = color;","    #else","        #include color_vertex","        //include beginnormal_vertex","        //vec3 objectNormal = vec3( normal );","        vec3 objectNormal = vec3(matrix * vec4(normal,0.0));","        #include defaultnormal_vertex","        // Normal computed with derivatives when FLAT_SHADED","        #ifndef FLAT_SHADED","            vNormal = normalize( transformedNormal );","        #endif","    #endif","","    //include begin_vertex","    vec3 transformed = updatePosition.xyz;","    //include project_vertex","    vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );","    gl_Position = projectionMatrix * mvPosition;","","    #if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )","        vViewPosition = -mvPosition.xyz;","    #endif","","    #if defined( RADIUS_CLIP )","        vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;","    #endif","","    #include nearclip_vertex","","}"].join("\n"),"undefined"==typeof jQuery)throw new Error("iCn3D requires jQuery");var iCn3D=function(e){this.id=e,this.container=$("#"+e),this.maxatomcnt=1e5,this.overdraw=0,this.bDrawn=!1,this.bSecondaryStructure=!1,this.bHighlight=1,this.renderOrderPicking=-1,this.ALTERNATE_STRUCTURE=-1,Detector.webgl?(this.renderer=new THREE.WebGLRenderer({canvas:this.container.get(0),antialias:!0,preserveDrawingBuffer:!0,sortObjects:!1,alpha:!0}),this.overdraw=0):alert("Currently your web browser has a problem on WebGL. If you are using Chrome, open a new tab for the same URL and WebGL may work again."),this.matShader=this.setOutlineColor("yellow"),this.frac=new THREE.Color(.1,.1,.1),this.scaleFactor=1.5,this.bImpo=!0,this.bExtFragDepth=this.renderer.extensions.get("EXT_frag_depth"),this.bExtFragDepth?console.log("EXT_frag_depth is supported. All spheres and cylinders are drawn using shaders."):(this.bImpo=!1,console.log("EXT_frag_depth is NOT supported. All spheres and cylinders are drawn using geometry.")),this.bInstanced=this.renderer.extensions.get("ANGLE_instanced_arrays"),this.bInstanced?console.log("ANGLE_instanced_arrays is supported. Assembly is drawn with one copy of the asymmetric unit using hardware instancing."):console.log("ANGLE_instanced_arrays is NOT supported. Assembly is drawn by making copies of the asymmetric unit."),this.posArray=new Array,this.colorArray=new Array,this.pos2Array=new Array,this.color2Array=new Array,this.radiusArray=new Array,this.posArraySphere=new Array,this.colorArraySphere=new Array,this.radiusArraySphere=new Array,this.WIDTH=this.container.width(),this.HEIGHT=this.container.height(),this.setWidthHeight(this.WIDTH,this.HEIGHT),this.axis=!1,this.pk=1,this.highlightlevel=1,this.pickpair=!1,this.pAtomNum=0,this.pAtom=void 0,this.pAtom2=void 0,this.bCtrl=!1,this.bShift=!1,this.bStopRotate=!1,this.bCalphaOnly=!1,this.bAllAtoms=!0,this.bConsiderNeighbors=!1,this.bShowCrossResidueBond=!1,this.effects={none:this.renderer},this.maxD=500,this.oriMaxD=this.maxD,this.cam_z=2*this.maxD,this.commands=[],this.optsHistory=[],this.logs=[],this.bRender=!0,this.hColor=new THREE.Color(16776960),this.sphereGeometry=new THREE.SphereGeometry(1,32,32),this.boxGeometry=new THREE.BoxGeometry(1,1,1),this.cylinderGeometry=new THREE.CylinderGeometry(1,1,1,32,1),this.cylinderGeometryOutline=new THREE.CylinderGeometry(1,1,1,32,1,!0),this.axisDIV=5,this.strandDIV=6,this.tubeDIV=8,this.nucleicAcidStrandDIV=6,this.linewidth=1,this.hlLineRadius=.1,this.lineRadius=.1,this.coilWidth=.3,this.cylinderRadius=.4,this.traceRadius=.4,this.dotSphereScale=.3,this.sphereRadius=1.5,this.cylinderHelixRadius=1.6,this.ribbonthickness=.2,this.helixSheetWidth=1.3,this.nucleicAcidWidth=.8,this.threshbox=180,this.maxAtoms3DMultiFile=4e4,this.LABELSIZE=30,this.opts={camera:"perspective",background:"transparent",color:"chain",sidec:"nothing",proteins:"ribbon",nucleotides:"nucleotide cartoon",surface:"nothing",wireframe:"no",map:"nothing",mapwireframe:"yes",emmap:"nothing",emmapwireframe:"yes",opacity:"1.0",chemicals:"stick",water:"nothing",ions:"sphere",hbonds:"no",ssbonds:"no",labels:"no",lines:"no",rotationcenter:"molecule center",axis:"no",fog:"no",slab:"no",pk:"residue",nucleotides:"nucleotide cartoon",chemicalbinding:"hide"},this._zoomFactor=1,this.mouseChange=new THREE.Vector2(0,0),this.quaternion=new THREE.Quaternion(0,0,0,1);var t=this;this.container.bind("contextmn",function(e){e.preventDefault()}),t.typetext=!1,$(document).bind("keyup",function(e){16===e.keyCode&&(t.bShift=!1),17!==e.keyCode&&224!==e.keyCode&&91!==e.keyCode||(t.bCtrl=!1)}),$("input[type=text], textarea").focus(function(){t.typetext=!0}),$("input[type=text], textarea").blur(function(){t.typetext=!1}),$(document).bind("keydown",function(e){if((e.shiftKey||16===e.keyCode)&&(t.bShift=!0),(e.ctrlKey||17===e.keyCode||224===e.keyCode||91===e.keyCode)&&(t.bCtrl=!0),t.controls&&(t.bStopRotate=!0,!t.typetext))if(90===e.keyCode){var i={};t.cam===t.perspectiveCamera?i._zoomFactor=.9:t.cam===t.orthographicCamera&&(t._zoomFactor<.1?t._zoomFactor=.1:t._zoomFactor>1&&(t._zoomFactor=1),i._zoomFactor=.8*t._zoomFactor,i._zoomFactor<.1&&(i._zoomFactor=.1)),i.update=!0,t.controls.update(i),t.render()}else if(88===e.keyCode)i={},t.cam===t.perspectiveCamera?i._zoomFactor=1.03:t.cam===t.orthographicCamera&&(t._zoomFactor>10?t._zoomFactor=10:t._zoomFactor<1&&(t._zoomFactor=1),i._zoomFactor=1.01*t._zoomFactor,i._zoomFactor>10&&(i._zoomFactor=10)),i.update=!0,t.controls.update(i),t.render();else if(76===e.keyCode){var n=new THREE.Vector3(0,1,0),r=-5/180*Math.PI;t.setRotation(n,r)}else 74===e.keyCode?(n=new THREE.Vector3(0,1,0),r=5/180*Math.PI,t.setRotation(n,r)):73===e.keyCode?(n=new THREE.Vector3(1,0,0),r=-5/180*Math.PI,t.setRotation(n,r)):77===e.keyCode?(n=new THREE.Vector3(1,0,0),r=5/180*Math.PI,t.setRotation(n,r)):65===e.keyCode&&Object.keys(t.structures).length>1&&t.alternateStructures()}),this.container.bind("mouseup touchend",function(e){t.isDragging=!1}),this.container.bind("mousedown",function(e){e.preventDefault(),t.isDragging=!0,t.scene&&(t.bStopRotate=!0,t.pk&&(e.altKey||e.ctrlKey||e.shiftKey||18===e.keyCode||16===e.keyCode||17===e.keyCode||224===e.keyCode||91===e.keyCode)&&(t.highlightlevel=t.pk,t.rayCaster(e,!0)),t.controls.handleResize(),t.controls.update(),t.render())}),this.container.bind("touchstart",function(e){e.preventDefault(),t.isDragging=!0,t.scene&&(t.bStopRotate=!0,$("[id$=popup]").hide(),t.rayCaster(e,!0),t.controls.handleResize(),t.controls.update(),t.render())}),this.container.bind("mousemove touchmove",function(e){e.preventDefault(),t.scene&&($("[id$=popup]").hide(),t.rayCaster(e,!1),t.isDragging&&(t.controls.handleResize(),t.controls.update(),t.render()))}),this.container.bind("mousewheel",function(e){e.preventDefault(),t.scene&&(t.bStopRotate=!0,t.controls.handleResize(),t.controls.update(),t.render())}),this.container.bind("DOMMouseScroll",function(e){e.preventDefault(),t.scene&&(t.bStopRotate=!0,t.controls.handleResize(),t.controls.update(),t.render())})};iCn3D.prototype={constructor:iCn3D,rayCaster:function(e,t){var i=this,n=e.pageX,r=e.pageY;e.originalEvent.targetTouches&&e.originalEvent.targetTouches[0]&&(n=e.originalEvent.targetTouches[0].pageX,r=e.originalEvent.targetTouches[0].pageY);var o=n-i.container.offset().left,s=r-i.container.offset().top;i.mouse.x=(n-i.container.offset().left)/i.container.width()*2-1,i.mouse.y=-(r-i.container.offset().top)/i.container.height()*2+1;var a=new THREE.Vector3;a.x=i.mouse.x,a.y=i.mouse.y,a.z=this.cam_z>0?-1:1,i.cam===i.perspectiveCamera?(a.z=this.cam_z>0?-1:1,a.unproject(i.cam),i.raycaster.set(i.cam.position,a.sub(i.cam.position).normalize())):i.cam===i.orthographicCamera&&(a.z=this.cam_z>0?1:-1,a.unproject(i.cam),i.raycaster.set(a,new THREE.Vector3(0,0,-1).transformDirection(i.cam.matrixWorld)));var c=i.raycaster.intersectObjects(i.objects),l=!1,d=i.mdl.position;if(c.length>0){c[0].point.sub(d);for(var h=i.getAtomsFromPosition(c[0].point,u=.5);!h&&u<10;)h=i.getAtomsFromPosition(c[0].point,u+=.5);h?(l=!0,i.pickpair?t&&(i.pAtomNum%2==0?i.pAtom=h:i.pAtom2=h,++i.pAtomNum):i.pAtom=h,t?i.showPicking(h):i.showPicking(h,o,s)):console.log("No atoms were found in 10 andstrom range")}if(!l&&(c=i.raycaster.intersectObjects(i.objects_ghost),d=i.mdl_ghost.position,c.length>0)){var u;for(c[0].point.sub(d),h=i.getAtomsFromPosition(c[0].point,u=.5);!h&&u<10;)h=i.getAtomsFromPosition(c[0].point,u+=.5);h?(i.pickpair?t&&(i.pAtomNum%2==0?i.pAtom=h:i.pAtom2=h,++i.pAtomNum):i.pAtom=h,t?i.showPicking(h):i.showPicking(h,o,s)):console.log("No atoms were found in 10 andstrom range")}},setRotation:function(e,t){e.applyQuaternion(this.cam.quaternion).normalize();var i=new THREE.Quaternion;i.setFromAxisAngle(e,-t);var n={};n.quaternion=i,n.update=!0,this.controls.update(n),this.render()},setOutlineColor:function(e){var t={outline:{vertex_shader:["uniform float offset;","void main() {","vec4 pos = modelViewMatrix * vec4( position + normal * offset, 1.0 );","gl_Position = projectionMatrix * pos;","}"].join("\n"),fragment_shader:["void main(){","gl_FragColor = vec4( 1.0, 1.0, 0.0, 1.0 );","}"].join("\n")}};"yellow"===e?t.outline.fragment_shader=["void main(){","gl_FragColor = vec4( 1.0, 1.0, 0.0, 1.0 );","}"].join("\n"):"green"===e?t.outline.fragment_shader=["void main(){","gl_FragColor = vec4( 0.0, 1.0, 0.0, 1.0 );","}"].join("\n"):"red"===e&&(t.outline.fragment_shader=["void main(){","gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );","}"].join("\n"));var i=t.outline;return new THREE.ShaderMaterial({uniforms:{offset:{type:"f",value:.5}},vertexShader:i.vertex_shader,fragmentShader:i.fragment_shader,depthTest:!1,depthWrite:!1,needsUpdate:!0})},setWidthHeight:function(e,t){this.renderer.setSize(e*this.scaleFactor,t*this.scaleFactor),this.renderer.domElement.style.width=e+"px",this.renderer.domElement.style.height=t+"px",this.renderer.domElement.width=e*this.scaleFactor,this.renderer.domElement.height=t*this.scaleFactor,this.container.widthInv=1/(this.scaleFactor*e),this.container.heightInv=1/(this.scaleFactor*t),this.container.whratio=e/t},nucleotidesArray:["  G","  A","  T","  C","  U"," DG"," DA"," DT"," DC"," DU"],ionsArray:["  K"," NA"," MG"," AL"," CA"," TI"," MN"," FE"," NI"," CU"," ZN"," AG"," BA","  F"," CL"," BR","  I"],vdwRadii:{H:1.08,HE:1.34,LI:1.75,BE:2.05,B:1.47,C:1.49,N:1.41,O:1.4,F:1.39,NE:1.68,NA:1.84,MG:2.05,AL:2.11,SI:2.07,P:1.92,S:1.82,CL:1.83,AR:1.93,K:2.05,CA:2.21,SC:2.16,TI:1.87,V:1.79,CR:1.89,MN:1.97,FE:1.94,CO:1.92,NI:1.84,CU:1.86,ZN:2.1,GA:2.08,GE:2.15,AS:2.06,SE:1.93,BR:1.98,KR:2.12,RB:2.16,SR:2.24,Y:2.19,ZR:1.86,NB:2.07,MO:2.09,TC:2.09,RU:2.07,RH:1.95,PD:2.02,AG:2.03,CD:2.3,IN:2.36,SN:2.33,SB:2.25,TE:2.23,I:2.23,XE:2.21,CS:2.22,BA:2.51,LA:2.4,CE:2.35,PR:2.39,ND:2.29,PM:2.36,SM:2.29,EU:2.33,GD:2.37,TB:2.21,DY:2.29,HO:2.16,ER:2.35,TM:2.27,YB:2.42,LU:2.21,HF:2.12,TA:2.17,W:2.1,RE:2.17,OS:2.16,IR:2.02,PT:2.09,AU:2.17,HG:2.09,TL:2.35,PB:2.32,BI:2.43,PO:2.29,AT:2.36,RN:2.43,FR:2.56,RA:2.43,AC:2.6,TH:2.37,PA:2.43,U:2.4,NP:2.21,PU:2.56,AM:2.56,CM:2.56,BK:2.56,CF:2.56,ES:2.56,FM:2.56},covalentRadii:{H:.31,HE:.28,LI:1.28,BE:.96,B:.84,C:.76,N:.71,O:.66,F:.57,NE:.58,NA:1.66,MG:1.41,AL:1.21,SI:1.11,P:1.07,S:1.05,CL:1.02,AR:1.06,K:2.03,CA:1.76,SC:1.7,TI:1.6,V:1.53,CR:1.39,MN:1.39,FE:1.32,CO:1.26,NI:1.24,CU:1.32,ZN:1.22,GA:1.22,GE:1.2,AS:1.19,SE:1.2,BR:1.2,KR:1.16,RB:2.2,SR:1.95,Y:1.9,ZR:1.75,NB:1.64,MO:1.54,TC:1.47,RU:1.46,RH:1.42,PD:1.39,AG:1.45,CD:1.44,IN:1.42,SN:1.39,SB:1.39,TE:1.38,I:1.39,XE:1.4,CS:2.44,BA:2.15,LA:2.07,CE:2.04,PR:2.03,ND:2.01,PM:1.99,SM:1.98,EU:1.98,GD:1.96,TB:1.94,DY:1.92,HO:1.92,ER:1.89,TM:1.9,YB:1.87,LU:1.87,HF:1.75,TA:1.7,W:1.62,RE:1.51,OS:1.44,IR:1.41,PT:1.36,AU:1.36,HG:1.32,TL:1.45,PB:1.46,BI:1.48,PO:1.4,AT:1.5,RN:1.5,FR:2.6,RA:2.21,AC:2.15,TH:2.06,PA:2,U:1.96,NP:1.9,PU:1.87,AM:1.8,CM:1.69},atomColors:{H:new THREE.Color(16777215),He:new THREE.Color(16761035),HE:new THREE.Color(16761035),Li:new THREE.Color(11674146),LI:new THREE.Color(11674146),B:new THREE.Color(65280),C:new THREE.Color(13158600),N:new THREE.Color(9408511),O:new THREE.Color(15728640),F:new THREE.Color(14329120),Na:new THREE.Color(255),NA:new THREE.Color(255),Mg:new THREE.Color(2263842),MG:new THREE.Color(2263842),Al:new THREE.Color(8421520),AL:new THREE.Color(8421520),Si:new THREE.Color(14329120),SI:new THREE.Color(14329120),P:new THREE.Color(16753920),S:new THREE.Color(16762930),Cl:new THREE.Color(65280),CL:new THREE.Color(65280),Ca:new THREE.Color(8421520),CA:new THREE.Color(8421520),Ti:new THREE.Color(8421520),TI:new THREE.Color(8421520),Cr:new THREE.Color(8421520),CR:new THREE.Color(8421520),Mn:new THREE.Color(8421520),MN:new THREE.Color(8421520),Fe:new THREE.Color(16753920),FE:new THREE.Color(16753920),Ni:new THREE.Color(10824234),NI:new THREE.Color(10824234),Cu:new THREE.Color(10824234),CU:new THREE.Color(10824234),Zn:new THREE.Color(10824234),ZN:new THREE.Color(10824234),Br:new THREE.Color(10824234),BR:new THREE.Color(10824234),Ag:new THREE.Color(8421520),AG:new THREE.Color(8421520),I:new THREE.Color(10494192),Ba:new THREE.Color(16753920),BA:new THREE.Color(16753920),Au:new THREE.Color(14329120),AU:new THREE.Color(14329120)},defaultAtomColor:new THREE.Color(13421772),stdChainColors:[new THREE.Color(16711935),new THREE.Color(255),new THREE.Color(10053171),new THREE.Color(65433),new THREE.Color(16750848),new THREE.Color(16737894),new THREE.Color(3329330),new THREE.Color(2003199),new THREE.Color(16416882),new THREE.Color(16753920),new THREE.Color(52945),new THREE.Color(16738740),new THREE.Color(65280),new THREE.Color(255),new THREE.Color(16711680),new THREE.Color(16776960),new THREE.Color(65535),new THREE.Color(16711935),new THREE.Color(3978097),new THREE.Color(4620980),new THREE.Color(13458524),new THREE.Color(16770229),new THREE.Color(11529966),new THREE.Color(15631086),new THREE.Color(25600),new THREE.Color(139),new THREE.Color(9109504),new THREE.Color(13468991),new THREE.Color(35723),new THREE.Color(9699539)],backgroundColors:{black:new THREE.Color(0),grey:new THREE.Color(13421772),white:new THREE.Color(16777215),transparent:new THREE.Color(0)},residueColors:{ALA:new THREE.Color(13158600),ARG:new THREE.Color(1334015),ASN:new THREE.Color(56540),ASP:new THREE.Color(15075850),CYS:new THREE.Color(15132160),GLN:new THREE.Color(56540),GLU:new THREE.Color(15075850),GLY:new THREE.Color(15461355),HIS:new THREE.Color(8553170),ILE:new THREE.Color(1016335),LEU:new THREE.Color(1016335),LYS:new THREE.Color(1334015),MET:new THREE.Color(15132160),PHE:new THREE.Color(3289770),PRO:new THREE.Color(14456450),SER:new THREE.Color(16422400),THR:new THREE.Color(16422400),TRP:new THREE.Color(11819700),TYR:new THREE.Color(3289770),VAL:new THREE.Color(1016335),ASX:new THREE.Color(16738740),GLX:new THREE.Color(16738740),G:new THREE.Color(32768),A:new THREE.Color(6324479),T:new THREE.Color(16744448),C:new THREE.Color(16711680),U:new THREE.Color(16744448),DG:new THREE.Color(32768),DA:new THREE.Color(6324479),DT:new THREE.Color(16744448),DC:new THREE.Color(16711680),DU:new THREE.Color(16744448)},defaultResidueColor:new THREE.Color(12492910),chargeColors:{"  G":new THREE.Color(16711680),"  A":new THREE.Color(16711680),"  T":new THREE.Color(16711680),"  C":new THREE.Color(16711680),"  U":new THREE.Color(16711680)," DG":new THREE.Color(16711680)," DA":new THREE.Color(16711680)," DT":new THREE.Color(16711680)," DC":new THREE.Color(16711680)," DU":new THREE.Color(16711680),G:new THREE.Color(16711680),A:new THREE.Color(16711680),T:new THREE.Color(16711680),C:new THREE.Color(16711680),U:new THREE.Color(16711680),DG:new THREE.Color(16711680),DA:new THREE.Color(16711680),DT:new THREE.Color(16711680),DC:new THREE.Color(16711680),DU:new THREE.Color(16711680),ARG:new THREE.Color(255),LYS:new THREE.Color(255),ASP:new THREE.Color(16711680),GLU:new THREE.Color(16711680),GLY:new THREE.Color(8947848),PRO:new THREE.Color(8947848),ALA:new THREE.Color(8947848),VAL:new THREE.Color(8947848),LEU:new THREE.Color(8947848),ILE:new THREE.Color(8947848),PHE:new THREE.Color(8947848),HIS:new THREE.Color(8947848),SER:new THREE.Color(8947848),THR:new THREE.Color(8947848),ASN:new THREE.Color(8947848),GLN:new THREE.Color(8947848),TYR:new THREE.Color(8947848),MET:new THREE.Color(8947848),CYS:new THREE.Color(8947848),TRP:new THREE.Color(8947848)},hydrophobicColors:{"  G":new THREE.Color(8947848),"  A":new THREE.Color(8947848),"  T":new THREE.Color(8947848),"  C":new THREE.Color(8947848),"  U":new THREE.Color(8947848)," DG":new THREE.Color(8947848)," DA":new THREE.Color(8947848)," DT":new THREE.Color(8947848)," DC":new THREE.Color(8947848)," DU":new THREE.Color(8947848),G:new THREE.Color(8947848),A:new THREE.Color(8947848),T:new THREE.Color(8947848),C:new THREE.Color(8947848),U:new THREE.Color(8947848),DG:new THREE.Color(8947848),DA:new THREE.Color(8947848),DT:new THREE.Color(8947848),DC:new THREE.Color(8947848),DU:new THREE.Color(8947848),ARG:new THREE.Color(8947848),LYS:new THREE.Color(8947848),ASP:new THREE.Color(8947848),GLU:new THREE.Color(8947848),GLY:new THREE.Color(65280),PRO:new THREE.Color(65280),ALA:new THREE.Color(65280),VAL:new THREE.Color(65280),LEU:new THREE.Color(65280),ILE:new THREE.Color(65280),PHE:new THREE.Color(65280),HIS:new THREE.Color(8947848),SER:new THREE.Color(8947848),THR:new THREE.Color(8947848),ASN:new THREE.Color(8947848),GLN:new THREE.Color(8947848),TYR:new THREE.Color(8947848),MET:new THREE.Color(8947848),CYS:new THREE.Color(8947848),TRP:new THREE.Color(8947848)},sheetcolor:"green",ssColors:{helix:new THREE.Color(16711680),sheet:new THREE.Color(32768),coil:new THREE.Color(6324479)},ssColors2:{helix:new THREE.Color(16711680),sheet:new THREE.Color(16762880),coil:new THREE.Color(6324479)},defaultBondColor:new THREE.Color(12303291),surfaces:{1:void 0,2:void 0,3:void 0,4:void 0},mapData:{},hasCovalentBond:function(e,t){var i=this.covalentRadii[e.elem]+this.covalentRadii[t.elem];return e.coord.distanceToSquared(t.coord)<1.3*i*i},init_base:function(){this.structures={},this.chains={},this.residues={},this.secondaries={},this.alnChains={},this.chainsSeq={},this.chainsColor={},this.chainsGene={},this.chainsAn={},this.chainsAnTitle={},this.alnChainsSeq={},this.alnChainsAnno={},this.alnChainsAnTtl={},this.dAtoms={},this.hAtoms={},this.pickedAtomList={},this.prevHighlightObjects=[],this.prevHighlightObjects_ghost=[],this.prevSurfaces=[],this.prevMaps=[],this.prevEmmaps=[],this.defNames2Residues={},this.defNames2Atoms={},this.defNames2Descr={},this.defNames2Command={},this.residueId2Name={},this.atoms={},this.dAtoms={},this.hAtoms={},this.proteins={},this.sidec={},this.nucleotides={},this.nucleotidesO3={},this.chemicals={},this.ions={},this.water={},this.calphas={},this.hbondpnts=[],this.stabilizerpnts=[],this.doublebonds={},this.triplebonds={},this.aromaticbonds={},this.atomPrevColors={},this.style2atoms={},this.labels={},this.lines={},this.rotateCount=0,this.rotateCountMax=20},init:function(){this.init_base(),this.molTitle="",this.ssbondpnts={},this.inputid={idtype:void 0,id:void 0},this.biomtMatrices=[],this.bAssembly=!0,this.bDrawn=!1,this.bSecondaryStructure=!1,this.bHighlight=1},reinitAfterLoad:function(){this.dAtoms=this.cloneHash(this.atoms),this.hAtoms=this.cloneHash(this.atoms),this.prevHighlightObjects=[],this.prevHighlightObjects_ghost=[],this.prevSurfaces=[],this.prevMaps=[],this.prevEmmaps=[],this.labels={},this.lines={},this.bAssembly=!0}},iCn3D.prototype.loadPDB=function(e){var t=[],i=[],n=e.split("\n"),r={},o={};this.init();var s,a,c=[],l=[],d=[],h=[],u=[],p=[],m=0,f=1,g="",v="",y="",b=!1,_={},w={},x="stru",C=0,S="";for(var E in n){var M=n[E],T=M.substr(0,6);if("HEADER"===T)x=M.substr(62,4),this.molTitle="";else if("TITLE "===T){var A=M.substr(10);this.molTitle+=A.trim()+" "}else if("HELIX "===T){this.bSecondaryStructure=!0;for(var k=M.substr(19,1),R=parseInt(M.substr(21,4)),D=parseInt(M.substr(33,4)),L=R;L<=D;++L)h.push(X=k+"_"+L),L===R&&u.push(X),L===D&&p.push(X);t.push({chain:k,initialResidue:R,initialInscode:M.substr(25,1),terminalResidue:D,terminalInscode:M.substr(37,1)})}else if("SHEET "===T){for(this.bSecondaryStructure=!0,k=M.substr(21,1),R=parseInt(M.substr(22,4)),D=parseInt(M.substr(33,4)),L=R;L<=D;++L)c.push(X=k+"_"+L),L===R&&l.push(X),L===D&&d.push(X);i.push({chain:k,initialResidue:R,initialInscode:M.substr(26,1),terminalResidue:D,terminalInscode:M.substr(37,1)})}else if("HBOND "===T);else if("SSBOND"===T){var I=x+"_"+M.substr(15,1)+"_"+M.substr(17,4).replace(/ /g,""),O=x+"_"+M.substr(29,1)+"_"+M.substr(31,4).replace(/ /g,"");void 0===this.ssbondpnts[x]&&(this.ssbondpnts[x]=[]),this.ssbondpnts[x].push(I),this.ssbondpnts[x].push(O)}else if("REMARK"===T){var P=parseInt(M.substr(7,3));if(350==P&&"BIOMT"==M.substr(13,5)){var H=parseInt(M[18])-1,N=parseInt(M.substr(21,2))-1;null==this.biomtMatrices[N]&&(this.biomtMatrices[N]=(new THREE.Matrix4).identity()),this.biomtMatrices[N].elements[H]=parseFloat(M.substr(24,9)),this.biomtMatrices[N].elements[H+4]=parseFloat(M.substr(34,9)),this.biomtMatrices[N].elements[H+8]=parseFloat(M.substr(44,9)),this.biomtMatrices[N].elements[H+12]=parseFloat(M.substr(54,10))}else if(465==P&&" "==M.substr(18,1)&&" "==M.substr(20,1)&&"S"!=M.substr(21,1)){var z,F=M.substr(15,3),U=M.substr(19,1),B=parseInt(M.substr(21,5));void 0===w[z=x+"_"+U]&&(w[z]=[]),(te={}).resi=B,te.name=this.residueName2Abbr(F).toLowerCase(),U!=S&&(C=0),!isNaN(B)&&(""==S||U!=S||U==S&&B>C)&&(w[z].push(te),C=B,S=U)}else 900==P&&void 0===this.emd&&"RELATED DB: EMDB"==M.substr(34).trim()&&(this.emd=M.substr(23,11).trim())}else if("ENDMDL"===T)++f;else if("JRNL  "===T)"PMID"===M.substr(12,4)&&(this.pmid=M.substr(19).trim());else if("ATOM  "===T||"HETATM"===T){var j=1===f?x:x+f.toString(),G=M.substr(16,1);++m,_[parseInt(M.substr(6,5))]=m;var V=M.substr(76,2).replace(/ /g,"");""===V&&(V=M.substr(12,2).replace(/ /g,"")),""===(U=M.substr(21,1))&&(U=1),(z=j+"_"+U)!==g&&(b=!1);var W=M.substr(22,5).trim();a=z+"_"+W,(W!=(B=parseInt(W))||b)&&(b=!0),s=z+"_"+B;var q,Y=M.substr(12,4).replace(/ /g,""),X=U+"_"+B,Z=parseFloat(M.substr(30,8)),K=parseFloat(M.substr(38,8)),J=parseFloat(M.substr(46,8)),Q=(F=M.substr(17,3),new THREE.Vector3(Z,K,J)),ee={het:"H"===T[0],serial:m,name:Y,alt:G,resn:F,structure:j,chain:U,resi:B,coord:Q,b:parseFloat(M.substr(60,8)),elem:V,bonds:[],ss:"coil",ssbegin:!1,ssend:!1};if(this.atoms[m]=ee,this.dAtoms[m]=1,this.hAtoms[m]=1,-1!==$.inArray(X,c)?(this.atoms[m].ss="sheet",-1!==$.inArray(X,l)&&(this.atoms[m].ssbegin=!0),-1!==$.inArray(X,d)&&(this.atoms[m].ssend=!0)):-1!==$.inArray(X,h)&&(this.atoms[m].ss="helix",-1!==$.inArray(X,u)&&(this.atoms[m].ssbegin=!0),-1!==$.inArray(X,p)&&(this.atoms[m].ssend=!0)),q="helix"===this.atoms[m].ss?"H":"sheet"===this.atoms[m].ss?"E":!this.atoms[m].het&&this.residueColors.hasOwnProperty(this.atoms[m].resn.toUpperCase())?"c":"o",this.secondaries[s]=q,a!==y){var te,ie=this.residueName2Abbr(F);this.residueId2Name[s]=ie,1!==m&&(this.residues[v]=o),s!==v&&(o={}),z!==g?(1!==m&&(this.chains[g]=this.unionHash(this.chains[g],r)),r={},void 0===this.structures[j.toString()]&&(this.structures[j.toString()]=[]),this.structures[j.toString()].push(z),void 0===this.chainsSeq[z]&&(this.chainsSeq[z]=[]),(te={}).resi=B,te.name=ie,this.chainsSeq[z].push(te)):((te={}).resi=B,te.name=ie,this.chainsSeq[z].push(te))}r[m]=1,o[m]=1,g=z,v=s,y=a}else if("CONECT"===T){var ne=parseInt(M.substr(6,5));for(L=0;L<4;++L){var re=parseInt(M.substr([11,16,21,26][L],5));isNaN(re)||void 0!==this.atoms[_[ne]]&&this.atoms[_[ne]].bonds.push(_[re])}}else"TER"===T.substr(0,3)&&++m}for(var oe=Object.keys(this.structures),se=0,ae=oe.length;se<ae;++se)if((j=oe[se])!=x&&(void 0===this.ssbondpnts[j]&&(this.ssbondpnts[j]=[]),void 0!==this.ssbondpnts[x])){L=0;for(var ce=this.ssbondpnts[x].length;L<ce;++L){var le=this.ssbondpnts[x][L],de=le.indexOf("_"),he=j+le.substr(de);this.ssbondpnts[j].push(he)}}this.adjustSeq(w),n=null,this.residues[s]=o,this.chains[z]=this.unionHash2Atoms(this.chains[z],r);var ue,pe,me=[],fe=this,ge=function(e){for(var t=me.length,i=0;i<t;++i){for(var n=me[i],r=i+1;r<t;++r){var o=me[r];n.alt===o.alt&&fe.hasCovalentBond(n,o)&&(n.bonds.push(o.serial),o.bonds.push(n.serial))}e&&e(n)}},ve=new THREE.Vector3(9999,9999,9999),ye=new THREE.Vector3(-9999,-9999,-9999),be=new THREE.Vector3,_e=0,we={};for(var E in this.atoms)be.add(Q=(Y=this.atoms[E]).coord),ve.min(Q),ye.max(Q),++_e,Y.het?Y.het&&("HOH"===Y.resn||"WAT"===Y.resn||"SOL"===Y.resn?this.water[Y.serial]=1:-1!==$.inArray(Y.resn,this.ionsArray)||Y.elem.trim()===Y.resn.trim()?this.ions[Y.serial]=1:this.chemicals[Y.serial]=1):-1!==$.inArray(Y.resn,this.nucleotidesArray)?(this.nucleotides[Y.serial]=1,"O3'"!==Y.name&&"O3*"!==Y.name||(this.nucleotidesO3[Y.serial]=1,this.secondaries[Y.structure+"_"+Y.chain+"_"+Y.resi]="o")):("P"===Y.elem&&(we[Y.structure+"_"+Y.chain+"_"+Y.resi]=1),this.proteins[Y.serial]=1,"CA"===Y.name&&(this.calphas[Y.serial]=1),"N"!==Y.name&&"CA"!==Y.name&&"C"!==Y.name&&"O"!==Y.name&&(this.sidec[Y.serial]=1)),ue===Y.chain&&pe===Y.resi||(ge(function(e){("C"===e.name&&"N"===Y.name||"O3'"===e.name&&"P"===Y.name)&&fe.hasCovalentBond(e,Y)&&(e.bonds.push(Y.serial),Y.bonds.push(e.serial))}),ue=Y.chain,pe=Y.resi,me.length=0),me.push(Y);for(he in we){var xe=this.residues[he];for(m in xe)(Y=this.atoms[m]).het=!0,this.chemicals[Y.serial]=1,this.secondaries[he]="o",delete this.proteins[Y.serial],"CA"===Y.name&&delete this.calphas[Y.serial],"N"!==Y.name&&"CA"!==Y.name&&"C"!==Y.name&&"O"!==Y.name&&delete this.sidec[Y.serial]}ge(),this.pmin=ve,this.pmax=ye,this.cnt=_e,this.maxD=this.pmax.distanceTo(this.pmin),this.center=be.multiplyScalar(1/this.cnt),this.maxD<5&&(this.maxD=5),this.oriMaxD=this.maxD,this.oriCenter=this.center.clone()},iCn3D.prototype.adjustSeq=function(e){for(var t in this.chainsSeq)if(void 0!==e[t]){var i,n,r,o=this.chainsSeq[t],s=e[t],a=o.length,c=s.length,l=new Array(a+c);for(i=0,n=0,r=0;i<a&&n<c;)o[i].resi<=s[n].resi?(l[r]=o[i],i++):(l[r]=s[n],n++),r++;if(i<a)for(var d=i;d<a;d++)l[r]=o[d],r++;else for(d=n;d<c;d++)l[r]=s[d],r++;this.chainsSeq[t]=l}},iCn3D.prototype.createSphere=function(e,t,i,n,r){var o;void 0===t&&(t=.8),void 0===i&&(i=!1),void 0===n&&(n=1);var s=this.vdwRadii[e.elem]||t;if(2===r){n*=1.5;var a=this.hColor;(o=new THREE.Mesh(this.sphereGeometry,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:this.frac,shininess:30,emissive:0,color:a}))).scale.x=o.scale.y=o.scale.z=i?t:s*(n||1),o.position.copy(e.coord),this.mdl.add(o)}else 1===r?((o=new THREE.Mesh(this.sphereGeometry,this.matShader)).scale.x=o.scale.y=o.scale.z=i?t:s*(n||1),o.position.copy(e.coord),o.renderOrder=this.renderOrderPicking,this.mdl.add(o)):(void 0===e.color&&(e.color=this.defaultAtomColor),a=e.color,(o=new THREE.Mesh(this.sphereGeometry,new THREE.MeshPhongMaterial({specular:this.frac,shininess:30,emissive:0,color:a}))).scale.x=o.scale.y=o.scale.z=i?t:s*(n||1),o.position.copy(e.coord),this.bImpo?(this.posArraySphere.push(e.coord.x),this.posArraySphere.push(e.coord.y),this.posArraySphere.push(e.coord.z),this.colorArraySphere.push(e.color.r),this.colorArraySphere.push(e.color.g),this.colorArraySphere.push(e.color.b),this.radiusArraySphere.push(i?t:s*(n||1)),this.cnt<=this.maxatomcnt&&this.mdl_ghost.add(o)):this.mdl.add(o));1===r||2===r?this.bImpo?this.cnt<=this.maxatomcnt&&this.prevHighlightObjects_ghost.push(o):this.prevHighlightObjects.push(o):this.bImpo?this.cnt<=this.maxatomcnt&&this.objects_ghost.push(o):this.objects.push(o)},iCn3D.prototype.createCylinder=function(e,t,i,n,r,o,s){var a;1===r?((a=new THREE.Mesh(this.cylinderGeometryOutline,this.matShader)).position.copy(e).add(t).multiplyScalar(.5),a.matrixAutoUpdate=!1,a.lookAt(t.clone().sub(e)),a.updateMatrix(),a.matrix.multiply((new THREE.Matrix4).makeScale(i,i,e.distanceTo(t))).multiply((new THREE.Matrix4).makeRotationX(.5*Math.PI)),a.renderOrder=this.renderOrderPicking,this.mdl.add(a),this.prevHighlightObjects.push(a)):(2===r?(a=new THREE.Mesh(this.cylinderGeometry,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:this.frac,shininess:30,emissive:0,color:n})),i*=1.5):a=new THREE.Mesh(this.cylinderGeometry,new THREE.MeshPhongMaterial({specular:this.frac,shininess:30,emissive:0,color:n})),a.position.copy(e).add(t).multiplyScalar(.5),a.matrixAutoUpdate=!1,a.lookAt(t.clone().sub(e)),a.updateMatrix(),a.matrix.multiply((new THREE.Matrix4).makeScale(i,i,e.distanceTo(t))).multiply((new THREE.Matrix4).makeRotationX(.5*Math.PI)),this.bImpo?(this.posArray.push(e.x),this.posArray.push(e.y),this.posArray.push(e.z),this.colorArray.push(n.r),this.colorArray.push(n.g),this.colorArray.push(n.b),this.pos2Array.push(t.x),this.pos2Array.push(t.y),this.pos2Array.push(t.z),void 0!==o?(this.color2Array.push(o.r),this.color2Array.push(o.g),this.color2Array.push(o.b)):(this.color2Array.push(n.r),this.color2Array.push(n.g),this.color2Array.push(n.b)),this.radiusArray.push(i),this.cnt<=this.maxatomcnt&&this.mdl_ghost.add(a)):this.mdl.add(a),2===r?this.bImpo?this.cnt<=this.maxatomcnt&&this.prevHighlightObjects_ghost.push(a):this.prevHighlightObjects.push(a):this.bImpo?this.cnt<=this.maxatomcnt&&this.objects_ghost.push(a):(void 0===s||s)&&this.objects.push(a))},iCn3D.prototype.createRepresentationSub=function(e,t,i){var n=[];for(var r in e){var o=e[r];for(var s in t&&t(o),o.bonds){var a=this.atoms[o.bonds[s]];void 0===a||a.serial<o.serial||(a.chain===o.chain&&(a.resi===o.resi||"C"===o.name&&"N"===a.name||"O3'"===o.name&&"P"===a.name||"O3*"===o.name&&"P"===a.name||"SG"===o.name&&"SG"===a.name)?i&&i(o,a):n.push([o.coord,a.coord]))}}if(n.length>0&&this.bShowCrossResidueBond)for(var c=new THREE.Color(65280),l=(r=0,n.length);r<l;++r)this.createCylinder(n[r][0],n[r][1],this.cylinderRadius,c,0)},iCn3D.prototype.createSphereRepresentation=function(e,t,i,n,r){var o=this;this.createRepresentationSub(e,function(e){o.createSphere(e,t,i,n,r)})},iCn3D.prototype.createBoxRepresentation_P_CA=function(e,t,i){var n=this;this.createRepresentationSub(e,function(e){"CA"!==e.name&&"O3'"!==e.name&&"O3*"!==e.name||n.createBox(e,void 0,void 0,t,void 0,i)})},iCn3D.prototype.createStickRepresentation=function(e,t,i,n,r,o){var s=this,a=void 0!==o&&o?t/s.cylinderRadius:1;this.createRepresentationSub(e,function(e){s.createSphere(e,t,!n,n,r)},function(e,t){var n=e.coord.clone().add(t.coord).multiplyScalar(.5),o=e.serial+"_"+t.serial;if(s.doublebonds.hasOwnProperty(o)){var c=new THREE.Vector3(Math.random(),Math.random(),Math.random());if(1==e.bonds.length&&1==t.bonds.length){(f=t.coord.clone()).sub(e.coord);var l=c.clone();f.cross(l).normalize().multiplyScalar(.2*a)}else{if(e.bonds.length>=t.bonds.length&&e.bonds.length>1)d=e.serial,h=e.bonds[0],u=e.bonds[1];else{if(!(t.bonds.length>=e.bonds.length&&t.bonds.length>1))return void console.log("Double bond was not drawn due to the undefined cross plane");d=t.serial,h=t.bonds[0],u=t.bonds[1]}(p=s.atoms[d].coord.clone()).sub(s.atoms[h].coord),(m=s.atoms[d].coord.clone()).sub(s.atoms[u].coord),p.cross(m),0==parseInt(1e4*p.length())&&(p=new THREE.Vector3(.2,.3,.5)),(f=t.coord.clone()).sub(e.coord),f.cross(p).normalize().multiplyScalar(.2*a),0==parseInt(1e4*f.length())&&(p=new THREE.Vector3(.5,.3,.2),f.cross(p).normalize().multiplyScalar(.2*a))}e.color===t.color?(s.createCylinder(e.coord.clone().add(f),t.coord.clone().add(f),s.cylinderRadius*a*.3,e.color,r),s.createCylinder(e.coord.clone().sub(f),t.coord.clone().sub(f),s.cylinderRadius*a*.3,e.color,r)):s.bImpo?(s.createCylinder(e.coord.clone().add(f),t.coord.clone().add(f),s.cylinderRadius*a*.3,e.color,r,t.color),s.createCylinder(e.coord.clone().sub(f),t.coord.clone().sub(f),s.cylinderRadius*a*.3,e.color,r,t.color)):(s.createCylinder(e.coord.clone().add(f),n.clone().add(f),s.cylinderRadius*a*.3,e.color,r),s.createCylinder(t.coord.clone().add(f),n.clone().add(f),s.cylinderRadius*a*.3,t.color,r),s.createCylinder(e.coord.clone().sub(f),n.clone().sub(f),s.cylinderRadius*a*.3,e.color,r),s.createCylinder(t.coord.clone().sub(f),n.clone().sub(f),s.cylinderRadius*a*.3,t.color,r))}else if(s.aromaticbonds.hasOwnProperty(o)){var d,h,u,p,m,f;if(e.bonds.length>t.bonds.length&&e.bonds.length>1)d=e.serial,h=e.bonds[0],u=e.bonds[1];else{if(!(t.bonds.length>1))return;d=t.serial,h=t.bonds[0],u=t.bonds[1]}(p=s.atoms[d].coord.clone()).sub(s.atoms[h].coord),(m=s.atoms[d].coord.clone()).sub(s.atoms[u].coord),p.cross(m),(f=t.coord.clone()).sub(e.coord),f.cross(p).normalize().multiplyScalar(.2*a);for(var g=0,v=0,y=e.bondOrder.length;v<y;++v)"1.5"===e.bondOrder[v]&&e.bonds[v]!==t.serial&&(g=e.bonds[v]);var b,_,w="add";if(0===g)w="add";else{var x=e.coord.clone().add(f),C=e.coord.clone().sub(f),S=t.coord.clone().sub(x).normalize(),E=s.atoms[g].coord.clone().sub(x).normalize(),M=t.coord.clone().sub(C).normalize(),T=s.atoms[g].coord.clone().sub(C).normalize();w=Math.acos(S.dot(E))<Math.acos(M.dot(T))?"sub":"add"}if(e.color===t.color){for("add"===w?(s.createCylinder(e.coord.clone().sub(f),t.coord.clone().sub(f),s.cylinderRadius*a*.3,e.color,r),b=e.coord.clone().add(f),_=t.coord.clone().add(f).sub(b).multiplyScalar(1/11)):(s.createCylinder(e.coord.clone().add(f),t.coord.clone().add(f),s.cylinderRadius*a*.3,e.color,r),b=e.coord.clone().sub(f),_=t.coord.clone().sub(f).sub(b).multiplyScalar(1/11)),v=0;v<=10;++v)if(v%2==0){var A=b.clone().add(_.clone().multiplyScalar(v)),k=b.clone().add(_.clone().multiplyScalar(v+1));s.createCylinder(A,k,s.cylinderRadius*a*.3,e.color,r)}}else for("add"===w?(s.createCylinder(e.coord.clone().sub(f),n.clone().sub(f),s.cylinderRadius*a*.3,e.color,r),s.createCylinder(t.coord.clone().sub(f),n.clone().sub(f),s.cylinderRadius*a*.3,t.color,r),b=e.coord.clone().add(f),_=t.coord.clone().add(f).sub(b).multiplyScalar(1/11)):(s.createCylinder(e.coord.clone().add(f),n.clone().add(f),s.cylinderRadius*a*.3,e.color,r),s.createCylinder(t.coord.clone().add(f),n.clone().add(f),s.cylinderRadius*a*.3,t.color,r),b=e.coord.clone().sub(f),_=t.coord.clone().sub(f).sub(b).multiplyScalar(1/11)),v=0;v<=10;++v)v%2==0&&(A=b.clone().add(_.clone().multiplyScalar(v)),k=b.clone().add(_.clone().multiplyScalar(v+1)),s.createCylinder(A,k,s.cylinderRadius*a*.3,v<5?e.color:t.color,r))}else s.triplebonds.hasOwnProperty(o)?(c=new THREE.Vector3(Math.random(),Math.random(),Math.random()),(l=t.coord.clone()).sub(e.coord),(M=c.clone()).cross(l).normalize().multiplyScalar(.3*a),e.color===t.color?(s.createCylinder(e.coord,t.coord,s.cylinderRadius*a*.2,e.color,r),s.createCylinder(e.coord.clone().add(M),t.coord.clone().add(M),s.cylinderRadius*a*.2,e.color,r),s.createCylinder(e.coord.clone().sub(M),t.coord.clone().sub(M),s.cylinderRadius*a*.2,e.color,r)):s.bImpo?(s.createCylinder(e.coord,t.coord,s.cylinderRadius*a*.2,e.color,r,t.color),s.createCylinder(e.coord.clone().add(M),t.coord.clone().add(M),s.cylinderRadius*a*.2,e.color,r,t.color),s.createCylinder(e.coord.clone().sub(M),t.coord.clone().sub(M),s.cylinderRadius*a*.2,e.color,r,t.color)):(s.createCylinder(e.coord,n,s.cylinderRadius*a*.2,e.color,r),s.createCylinder(t.coord,n,s.cylinderRadius*a*.2,t.color,r),s.createCylinder(e.coord.clone().add(M),n.clone().add(M),s.cylinderRadius*a*.2,e.color,r),s.createCylinder(t.coord.clone().add(M),n.clone().add(M),s.cylinderRadius*a*.2,t.color,r),s.createCylinder(e.coord.clone().sub(M),n.clone().sub(M),s.cylinderRadius*a*.2,e.color,r),s.createCylinder(t.coord.clone().sub(M),n.clone().sub(M),s.cylinderRadius*a*.2,t.color,r))):e.color===t.color?s.createCylinder(e.coord,t.coord,i,e.color,r):s.bImpo?s.createCylinder(e.coord,t.coord,i,e.color,r,t.color):(s.createCylinder(e.coord,n,i,e.color,r),s.createCylinder(t.coord,n,i,t.color,r))})},iCn3D.prototype.createLineRepresentation=function(e,t){var i,n=new THREE.Geometry;this.createRepresentationSub(e,void 0,function(e,t){if(e.color===t.color)n.vertices.push(e.coord),n.vertices.push(t.coord),n.colors.push(e.color),n.colors.push(t.color);else{var i=e.coord.clone().add(t.coord).multiplyScalar(.5);n.vertices.push(e.coord),n.vertices.push(i),n.vertices.push(t.coord),n.vertices.push(i),n.colors.push(e.color),n.colors.push(e.color),n.colors.push(t.color),n.colors.push(t.color)}}),2!==t?(1===t||(i=new THREE.LineSegments(n,new THREE.LineBasicMaterial({linewidth:this.linewidth,vertexColors:!0})),this.mdl.add(i)),1===t?this.prevHighlightObjects.push(i):this.objects.push(i)):2===t&&this.createBoxRepresentation_P_CA(e,.8,t)},iCn3D.prototype.getKnot=function(e,t,i,n){return i.distanceTo(n)+t},iCn3D.prototype.getValueFromKnot=function(e,t,i,n,r,o,s,a,c){var l,d,h=(s-o)/(i-t),u=(a-s)/(n-i),p=(c-a)/(r-n),m=(i+n)*(i+n)-4*(t*i+n*r-t*r);return 0==m?(l=9999,d=9999):(l=6*(3*u*i+2*h*r+p*i-2*h*i-2*u*r-u*n-p*i)/m,d=6*(3*u*n+2*p*t+h*i-2*u*t-2*p*n-h*n-u*i)/m),u*(e-i)+s+((2*l+d)/6/(i-n)*(e-i)*(e-n)*(e-n)+(2*d+l)/6/(n-i)*(e-i)*(e-i)*(e-n))},iCn3D.prototype.subdivide=function(e,t,i,n,r,o,s,a){var c=[],l=[],d=[],h=new Array,u=void 0!==o?o.length:0,p=void 0!==s?s.length:0;u>0&&h.push(o[0]),h.push(e[0]);for(var m=1,f=e.length-1;m<f;++m){var g=e[m+1];h.push((C=e[m]).smoothen?C.clone().add(g).multiplyScalar(.5):C)}h.push(e[e.length-1]),p>0&&h.push(s[0]),p>1&&h.push(s[1]);var v=[],y=[],b=[],_=p;a&&(_=p>0?p-1:0),m=-1;for(var w=h.length,x=1/i;m<=w-3;++m){var C,S=m-u,E=h[m+2],M=h[m===w-3?w-1:m+3],T=this.getKnot(1,0,C=h[-1===m?0:m],g=h[m+1]),A=this.getKnot(1,T,g,E),k=this.getKnot(1,A,E,M);T-0<1e-4&&(T=1),A-T<1e-4&&(A=T+1),k-A<1e-4&&(k=A+1),m>-1&&(void 0===n||n[S+1])&&m>=-1+u&&m<=w-3-_+1&&(c=c.concat(v),l=l.concat(y),d=d.concat(b)),v=[],y=[],b=[];for(var R=(A-T)*x,D=0;D<i;++D){var L=T+R*D,I=this.getValueFromKnot(L,0,T,A,k,C.x,g.x,E.x,M.x),O=this.getValueFromKnot(L,0,T,A,k,C.y,g.y,E.y,M.y),P=this.getValueFromKnot(L,0,T,A,k,C.z,g.z,E.z,M.z);n?(m>=-1+u&&m<=w-3-_&&n[S+1]&&D<=parseInt(i/2)&&(c.push(new THREE.Vector3(I,O,P)),l.push(n[S+1]),d.push(t[S+1])),m>=-1+u&&m<=w-3-_+1&&n[S+2]&&D>parseInt(i/2)&&(v.push(new THREE.Vector3(I,O,P)),y.push(n[S+2]),b.push(t[S+2]))):m>=-1+u&&m<=w-3-_&&(c.push(new THREE.Vector3(I,O,P)),l.push(S+1),d.push(t[S+1]))}}n&&!n[S+1]||(c=c.concat(v),l=l.concat(y),d=d.concat(b),c.push(h[h.length-1-_]),l.push(h.length-1-_),d.push(t[h.length-1-_])),v=[],y=[],b=[],h=[];var H=[];return H.push(c),H.push(l),H.push(d),H},iCn3D.prototype.createCurveSubArrow=function(e,t,i,n,r,o,s,a,c,l,d,h,u,p,m){var f=[],g=[];f.push(e),g.push(a),this.prepareStrand(f,g,t,i,n,void 0,r,o,s,c,l,!1,d,h,u,p,m),f=[],g=[]},iCn3D.prototype.setCalphaDrawnCoord=function(e,t,i){var n=0;if(void 0!==i)for(var r=0,o=e.length;r<o;r+=t){var s=i[n];this.atoms.hasOwnProperty(s)&&(this.atoms[s].coord2=e[r].clone()),++n}},iCn3D.prototype.createCurveSub=function(e,t,i,n,r,o,s,a,c,l,d,h){if(0!==e.length){var u;if(n=n||5,s)u=e;else{var p=this.subdivide(e,i,n,a,r,d,h,!0);u=p[0],i=p[2]}if(0!==u.length){if(this.setCalphaDrawnCoord(u,n,c),1===r){var m=this.coilWidth/2;if(u.length>1)if(void 0!==l){for(var f,g,v=[],y=0,b=u.length;y<b;++y){if((f=l[y])!==g&&f!==g+1&&void 0!==g||y===b-1){var _=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(v),v.length,m,4,!1);mesh=new THREE.Mesh(_,this.matShader),mesh.renderOrder=this.renderOrderPicking,this.mdl.add(mesh),this.prevHighlightObjects.push(mesh),_=null,v=[]}v.push(u[y]),g=f}v=[]}else _=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(u),u.length,m,4,!1),mesh=new THREE.Mesh(_,this.matShader),mesh.renderOrder=this.renderOrderPicking,this.mdl.add(mesh),this.prevHighlightObjects.push(mesh),_=null}else{var w=new THREE.Geometry;if(2===r&&o)for(y=0;y<u.length;++y)u[y].addScalar(.6),w.vertices.push(u[y]),w.colors.push(new THREE.Color(i[y]));else for(y=0;y<u.length;++y)w.vertices.push(u[y]),w.colors.push(new THREE.Color(i[y]));var x=new THREE.Line(w,new THREE.LineBasicMaterial({linewidth:t,vertexColors:!0}));this.mdl.add(x),2===r?this.prevHighlightObjects.push(x):this.objects.push(x)}u=null}}},iCn3D.prototype.createCylinderCurve=function(e,t,i,n,r){var o,s,a,c=null;for(a in e){var l=e[a];if(!l.het&&-1!=t.indexOf(l.name)){if(null!==c&&o===l.chain&&s+1===l.resi&&Math.abs(c.coord.x-l.coord.x)<8&&Math.abs(c.coord.y-l.coord.y)<8&&Math.abs(c.coord.z-l.coord.z)<8){var d=c.coord.clone().add(l.coord).multiplyScalar(.5);if(r)1===r&&(this.createCylinder(c.coord,d,i,c.color,r),this.createCylinder(d,l.coord,i,l.color,r),this.createSphere(l,i,!0,1,r));else if(n){var h=this.createSingleLine(c.coord,d,c.color,!1);this.mdl.add(h),this.objects.push(h),h=this.createSingleLine(d,l.coord,l.color,!1),this.mdl.add(h),this.objects.push(h)}else this.createCylinder(c.coord,d,i,c.color),this.createCylinder(d,l.coord,i,l.color),this.createSphere(l,i,!0,1,r)}c=l,o=l.chain,s=l.resi,2===r&&this.createBox(l,void 0,void 0,void 0,void 0,r)}}null!==c&&o===l.chain&&s+1===l.resi&&Math.abs(c.coord.x-l.coord.x)<8&&Math.abs(c.coord.y-l.coord.y)<8&&Math.abs(c.coord.z-l.coord.z)<8&&(d=c.coord.add(l.coord).multiplyScalar(.5),r?1===r&&(this.createCylinder(c.coord,d,i,c.color,r),this.createCylinder(d,l.coord,i,l.color,r),this.createSphere(l,i,!0,1,r)):n?(h=this.createSingleLine(c.coord,d,c.color,!1),this.mdl.add(h),this.objects.push(h),h=this.createSingleLine(d,l.coord,l.color,!1),this.mdl.add(h),this.objects.push(h)):(this.createCylinder(c.coord,d,i,c.color),this.createCylinder(d,l.coord,i,l.color)))},iCn3D.prototype.prepareStrand=function(e,t,i,n,r,o,s,a,c,l,d,h,u,p,m,f,g){if(1!==l.length){var v=[];v.push(n[n.length-2]),v.push(n[n.length-1]),r=r||this.axisDIV;for(var y=2/(c-1),b={},_=[],w=0,x=t.length;w<x;++w)b[w]=[];var C=this.subdivide(l,n,r,void 0,void 0,f,g)[0];if(1!==C.length){for(_=[],w=0,x=void 0===m||m?l.length-2:l.length;w<x;++w){for(var S=0,E=t.length;S<E;++S)b[S].push(e[S][w]);_.push(n[w])}if(_.push(n[w]),void 0===m||m)for(w=0,x=t.length;w<x;++w)L=y*t[w]-1,I=C.length-1-r,O=l.length-2,D=new THREE.Vector3(C[I].x+d[O].x*L,C[I].y+d[O].y*L,C[I].z+d[O].z*L),b[w].push(D);var M,T=[];for(w=0,x=t.length;w<x;++w)M=this.subdivide(b[w],_,r,u,s),b[w]=M[0],n=M[2],0===w&&(T=M[1]);if(h?this.createStrip(b[0],b[1],n,r,o,s,!0,void 0,p,T,f,g):this.createCurveSub(b[0],i,n,r,s,a,!0,void 0,p,T,f,g),void 0===m||m){for(_=[],T=[],S=0,E=t.length;S<E;++S){for(b[S]=[],w=r*(l.length-2),x=r*(l.length-1);u[parseInt(w/r)]&&w<x;w+=r)for(var A=parseInt(w/r),k=0;k<r;++k){L=1.8*(L=y*t[S]-1)*(r-k)/r;var R=parseInt(w/r);(D=new THREE.Vector3(C[w+k].x+d[R].x*L,C[w+k].y+d[R].y*L,C[w+k].z+d[R].z*L)).smoothen=!0,b[S].push(D),_.push(v[0]),0===S&&T.push(A)}var D,L=0,I=C.length-1,O=l.length-1;(D=new THREE.Vector3(C[I].x+d[O].x*L,C[I].y+d[O].y*L,C[I].z+d[O].z*L)).smoothen=!0,b[S].push(D),_.push(v[1]),0===S&&T.push(I)}C=[],h?this.createStrip(b[0],b[1],_,r,o,s,!0,void 0,void 0,T,f,g):this.createCurveSub(b[0],i,_,r,s,a,!0,void 0,void 0,T,f,g)}for(var w in b){k=0;for(var P=b[w].length;k<P;++k)b[w][k]=null;b[w]=[]}b={}}}},iCn3D.prototype.createStripArrow=function(e,t,i,n,r,o,s,a,c,l,d,h,u,p,m,f){var g=[],v=[];g.push(e),g.push(t),v.push(a),v.push(c),this.prepareStrand(g,v,void 0,i,n,r,o,void 0,s,l,d,!0,h,u,p,m,f),g=[],v=[]},iCn3D.prototype.createStrip=function(e,t,i,n,r,o,s,a,c,l,d,h){if(!(e.length<2)){if(n=n||this.axisDIV,!s){var u=this.subdivide(e,i,n,a,o,d,h,!0),p=this.subdivide(t,i,n,a,o,d,h,!0);e=u[0],t=p[0],i=u[2]}if(!(e.length<2)){if(this.setCalphaDrawnCoord(e,n,c),1===o){var m=this.coilWidth/2;if(void 0!==l){for(var f,g,v=[],y=[],b=0,_=e.length;b<_;++b){if((f=l[b])!==g&&f!==g+1&&void 0!==g||b===_-1){var w=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(v),v.length,m,4,!1);(H=new THREE.Mesh(w,this.matShader)).renderOrder=this.renderOrderPicking,this.mdl.add(H),this.prevHighlightObjects.push(H),w=null;var x=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(y),y.length,m,4,!1);(H=new THREE.Mesh(x,this.matShader)).renderOrder=this.renderOrderPicking,this.mdl.add(H),this.prevHighlightObjects.push(H),x=null,v=[],y=[]}v.push(e[b]),y.push(t[b]),g=f}v=[],y=[]}else w=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(e),e.length,m,4,!1),(H=new THREE.Mesh(w,this.matShader)).renderOrder=this.renderOrderPicking,this.mdl.add(H),this.prevHighlightObjects.push(H),w=null,x=new THREE.TubeGeometry(new THREE.CatmullRomCurve3(t),t.length,m,4,!1),(H=new THREE.Mesh(x,this.matShader)).renderOrder=this.renderOrderPicking,this.mdl.add(H),this.prevHighlightObjects.push(H),x=null}else{for(var C,S,E,M,T,A=new THREE.Geometry,k=A.vertices,R=A.faces,D=(b=0,e.length);b<D;++b)k.push(S=e[b]),k.push(S),k.push(E=t[b]),k.push(E),b<D-1&&(C=t[b].clone().sub(e[b]).cross(e[b+1].clone().sub(e[b])).normalize().multiplyScalar(r)),k.push(M=e[b].clone().add(C)),k.push(M),k.push(T=t[b].clone().add(C)),k.push(T);var L=[[0,2,-6,-8],[-4,-2,6,4],[7,3,-5,-1],[-3,-7,1,5]];for(b=1,D=e.length;b<D;++b)for(var I=8*b,O=new THREE.Color(i[b-1]),P=0;P<4;++P)R.push(new THREE.Face3(I+L[P][0],I+L[P][1],I+L[P][2],void 0,O)),R.push(new THREE.Face3(I+L[P][3],I+L[P][0],I+L[P][2],void 0,O));var H,N=k.length-8;for(b=0;b<4;++b)k.push(k[2*b]),k.push(k[N+2*b]);N+=8,R.push(new THREE.Face3(N,N+2,N+6,void 0,R[0].color)),R.push(new THREE.Face3(N+4,N,N+6,void 0,R[0].color)),R.push(new THREE.Face3(N+1,N+5,N+7,void 0,R[R.length-3].color)),R.push(new THREE.Face3(N+3,N+1,N+7,void 0,R[R.length-3].color)),A.computeFaceNormals(),A.computeVertexNormals(!1),2===o?(H=new THREE.Mesh(A,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:this.frac,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),this.mdl.add(H),this.prevHighlightObjects.push(H)):(H=new THREE.Mesh(A,new THREE.MeshPhongMaterial({specular:this.frac,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),this.mdl.add(H),this.objects.push(H))}e=null,t=null}}},iCn3D.prototype.createStrand=function(e,t,i,n,r,o,s,a,c){var l=!!n,d={};if(this.bAllAtoms)d=e;else{var h,u,p,m,f,g,v,y=0,b=Object.keys(e).length;for(var _ in d=this.cloneHash(e),e){if(h=e[_].structure+"_"+e[_].chain,u=parseInt(e[_].resi),p=e[_],void 0===m&&(g=e[_]),h!==m&&void 0!==m||u!==W&&u!==W+1&&void 0!==W||y===b-1){h!==m&&void 0!==m||u!==W&&u!==W+1&&void 0!==W?v=f:y===b-1&&(v=p);var w=g.resi;if("coil"!==g.ss&&!g.ssbegin){for(var x=g.resi-1;x>0&&this.residues.hasOwnProperty(E=g.structure+"_"+g.chain+"_"+x);--x)if((Q=this.getFirstCalphaAtomObj(this.residues[E])).ss===g.ss&&Q.ssbegin){w=Q.resi;break}for(x=w;x<g.resi;++x)d=this.unionHash(d,this.hash2Atoms(this.residues[E=g.structure+"_"+g.chain+"_"+x]))}3===this.pk&&1===c&&"coil"===g.ss&&this.residues.hasOwnProperty(E=g.structure+"_"+g.chain+"_"+(g.resi-1))&&(d=this.unionHash(d,this.hash2Atoms(this.residues[E])),e=this.unionHash(e,this.hash2Atoms(this.residues[E])));var C=v.resi;if("coil"!==v.ss&&!v.ssend&&!v.notshow){var S=this.getLastAtomObj(this.chains[v.structure+"_"+v.chain]).resi;for(x=v.resi+1;x<=S&&this.residues.hasOwnProperty(E=v.structure+"_"+v.chain+"_"+x);++x)if((Q=this.getFirstCalphaAtomObj(this.residues[E])).ss===v.ss&&Q.ssend){C=Q.resi;break}for(x=v.resi+1;x<=C;++x){var E;d=this.unionHash(d,this.hash2Atoms(this.residues[E=v.structure+"_"+v.chain+"_"+x]))}}3===this.pk&&1===c&&"coil"===v.ss&&this.residues.hasOwnProperty(E=v.structure+"_"+v.chain+"_"+(v.resi+1))&&(d=this.unionHash(d,this.hash2Atoms(this.residues[E])),e=this.unionHash(e,this.hash2Atoms(this.residues[E]))),v.notshow&&(v.notshow=void 0),g=p}m=h,W=u,f=p,++y}}2===c&&(n?(n=!1,t=null,i=null,r=null,o=null,a=void 0):(n=!0,t=2,i=void 0,r=void 0,o=void 0,a=this.ribbonthickness)),t=t||this.strandDIV,i=i||this.axisDIV,r=r||this.coilWidth,s=s||!1,o=o||this.helixSheetWidth;for(var M={},T=0;T<t;++T)M[T]=[];var A,k,R=[],D=[],L=[],I=[],O=[],P=null,H=null,N=null,z=null,F=null,U=null,B=null,j=null,G=!1,V=null,$=null,W=null,q=null,Y=null,X=!1,Z=!1,K={};this.bCalphaOnly=this.isCalphaPhosOnly(d);var J={};for(var x in d){var Q;J[E=(Q=d[x]).structure+"_"+Q.chain+"_"+Q.resi]=1}var ee=Object.keys(J).length,te=0,ie=Object.keys(this.hAtoms).length==Object.keys(this.atoms).length,ne=[];for(var x in d)if(("O"===(Q=d[x]).name||"CA"===Q.name)&&!Q.het&&("CA"===Q.name&&(e.hasOwnProperty(x)&&("helix"!==Q.ss&&"sheet"!==Q.ss||Q.ssend||Q.ssbegin)&&(K[x]=Q),P=Q.coord,N=Q.color,q=Q.serial,ne.push(Q.serial)),"O"===Q.name||this.bCalphaOnly&&"CA"===Q.name)){null==P&&(P=Q.coord,N=Q.color,q=Q.serial),"O"===Q.name&&(H=Q.coord);var re=!0;if(A!==Q.chain&&(re=!1),Q.ssend&&"sheet"===Q.ss?X=!0:Q.ssend&&"helix"===Q.ss&&(Z=!0),F){O.push(1===c||2===c?this.hColor:U),k="coil"!==j&&"coil"===Q.ss?r:G&&Q.ssbegin?r:"coil"===j?r:o;var oe=4;"O"===Q.name?(ge=F.clone(),null!=z?ge.sub(z):(z=F.clone(),ne.length>oe+1?(ge=z.clone(),ve=this.atoms[ne[ne.length-1-oe-1]].coord.clone(),ge.sub(ve)):ge=new THREE.Vector3(Math.random(),Math.random(),Math.random()))):this.bCalphaOnly&&"CA"===Q.name&&(ne.length>oe+1?(ge=z.clone(),ve=this.atoms[ne[ne.length-1-oe-1]].coord.clone(),ge.sub(ve)):ge=new THREE.Vector3(Math.random(),Math.random(),Math.random())),ge.normalize(),ge.multiplyScalar(k),null!==B&&ge.dot(B)<0&&ge.negate(),B=ge;for(var se=0,ae=2/(t-1);se<t;++se){var ce=ae*se-1,le=new THREE.Vector3(z.x+B.x*ce,z.y+B.y*ce,z.z+B.z*ce);s||"sheet"!==j||(le.smoothen=!0),M[se].push(le)}R.push(z),D.push(B),e.hasOwnProperty($)?(L.push(W),I.push(Y)):(L.push(0),I.push(0)),++te}if((Q.ssbegin||Q.ssend||te===ee-1)&&M[0].length>0&&re){var de="CA",he=[],ue=[],pe=this.atoms[$].structure+"_"+this.atoms[$].chain+"_"+(this.atoms[$].resi-1).toString();he=void 0!==(_e=this.getAtomCoordFromResi(pe,de))?[_e]:[];var me=this.atoms[$].structure+"_"+this.atoms[$].chain+"_"+(this.atoms[$].resi+1).toString(),fe=this.getAtomCoordFromResi(me,de);void 0!==fe&&ue.push(fe);var ge,ve,ye=this.atoms[$].structure+"_"+this.atoms[$].chain+"_"+(this.atoms[$].resi+2).toString(),be=this.getAtomCoordFromResi(ye,de);for(void 0!==be&&ue.push(be),O.push(1===c||2===c?this.hColor:U),k=Q.ssend&&"sheet"===Q.ss?0:"coil"===j&&Q.ssbegin?r:G&&Q.ssbegin?r:"coil"===Q.ss?r:o,oe=4,"O"===Q.name?(ge=H.clone()).sub(P):this.bCalphaOnly&&"CA"===Q.name&&(ne.length>oe?(ge=P.clone(),ve=this.atoms[ne[ne.length-1-oe]].coord.clone(),ge.sub(ve)):ge=new THREE.Vector3(Math.random(),Math.random(),Math.random())),ge.normalize(),ge.multiplyScalar(k),null!==B&&ge.dot(B)<0&&ge.negate(),B=ge,se=0,ae=2/(t-1);se<t;++se)ce=ae*se-1,le=new THREE.Vector3(P.x+B.x*ce,P.y+B.y*ce,P.z+B.z*ce),s||"sheet"!==j||(le.smoothen=!0),M[se].push(le);for(V=Q.serial,R.push(P),D.push(B),e.hasOwnProperty(V)?(L.push(Q.resi),I.push(q)):(L.push(0),I.push(0)),se=0;!n&&se<t;++se)X?this.createCurveSubArrow(M[se],1,O,i,c,l,t,se,R,D,L,I,!0,he,ue):Z&&(ie?this.createCurveSub(M[se],1,O,i,c,l,!1,L,I,void 0,he,ue):this.createCurveSubArrow(M[se],1,O,i,c,l,t,se,R,D,L,I,!1,he,ue));for(n&&(X?this.createStripArrow(M[0],M[t-1],O,i,a,c,t,0,t-1,R,D,L,I,!0,he,ue):Z?ie?this.createStrip(M[0],M[t-1],O,i,a,c,!1,L,I,void 0,he,ue):this.createStripArrow(M[0],M[t-1],O,i,a,c,t,0,t-1,R,D,L,I,!0,he,ue):2===c&&this.createStrip(M[0],M[t-1],O,i,a,c,!1,L,I,void 0,he,ue)),T=0;T<t;++T)M[T]=[];O=[],R=[],D=[],L=[],I=[],X=!1,Z=!1}if(A!==Q.chain&&M[0].length>0){var _e;for(de="CA",pe=this.atoms[$].structure+"_"+this.atoms[$].chain+"_"+(this.atoms[$].resi-1).toString(),he=void 0!==(_e=this.getAtomCoordFromResi(pe,de))?[_e]:[],ue=[],se=0;!n&&se<t;++se)X?this.createCurveSubArrow(M[se],1,O,i,c,l,t,se,R,D,L,I,!0,he,ue):Z&&(ie?this.createCurveSub(M[se],1,O,i,c,l,!1,L,I,void 0,he,ue):this.createCurveSubArrow(M[se],1,O,i,c,l,t,se,R,D,L,I,!1,he,ue));for(n&&(X?this.createStripArrow(M[0],M[t-1],O,i,a,c,t,0,t-1,R,D,L,I,!0,he,ue):Z&&(ie?this.createStrip(M[0],M[t-1],O,i,a,c,!1,L,I,void 0,he,ue):this.createStripArrow(M[0],M[t-1],O,i,a,c,t,0,t-1,R,D,L,I,!1,he,ue))),T=0;T<t;++T)M[T]=[];O=[],R=[],D=[],L=[],I=[],X=!1,Z=!1}A=Q.chain,j=Q.ss,G=Q.ssend,$=Q.serial,W=Q.resi,Y=q,z=P,F=Q.coord,U=N}ne=[],this.createTube(K,"CA",r,c),K={},M={}},iCn3D.prototype.createTubeSub=function(e,t,i,n,r,o){if(!(e.length<2)){var s=this.tubeDIV,a=this.axisDIV,c=1/s,l=1/a,d=new THREE.Geometry,h=this.subdivide(e,t,a,void 0,void 0,r,o),u=h[0];t=h[2];for(var p,m=new THREE.Vector3,f=0,g=u.length;f<g;++f){var v,y,b,_,w=(f-1)*l;if(0===f)v=i[0];else if(w%1==0)v=i[w];else{var x=Math.floor(w),C=w-x;v=i[x]*C+i[x+1]*(1-C)}f<g-1?(y=u[f].clone().sub(u[f+1]),b=new THREE.Vector3(0,-y.z,y.y).normalize().multiplyScalar(v),_=y.clone().cross(b).normalize().multiplyScalar(v),m.dot(b)<0&&(b.negate(),_.negate()),m=b,p=_):(b=m,_=p);for(var S=0;S<s;++S){var E=2*Math.PI*c*S;d.vertices.push(u[f].clone().add(b.clone().multiplyScalar(Math.cos(E))).add(_.clone().multiplyScalar(Math.sin(E))))}}var M,T=0;for(f=0,g=u.length-1;f<g;++f){var A=new THREE.Color(t[f]),k=0,R=d.vertices[T].clone().sub(d.vertices[T+s]).lengthSq(),D=d.vertices[T].clone().sub(d.vertices[T+s+1]).lengthSq();for(R>D&&(R=D,k=1),S=0;S<s;++S)d.faces.push(new THREE.Face3(T+S,T+(S+k)%s+s,T+(S+1)%s,void 0,A)),d.faces.push(new THREE.Face3(T+(S+1)%s,T+(S+k)%s+s,T+(S+k+1)%s+s,void 0,A));T+=s}d.computeFaceNormals(),d.computeVertexNormals(!1),2===n?(M=new THREE.Mesh(d,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:this.frac,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),this.mdl.add(M)):1===n?((M=new THREE.Mesh(d,this.matShader)).renderOrder=this.renderOrderPicking,this.mdl.add(M)):(M=new THREE.Mesh(d,new THREE.MeshPhongMaterial({specular:this.frac,shininess:30,emissive:0,vertexColors:THREE.FaceColors,side:THREE.DoubleSide})),this.mdl.add(M)),1===n||2===n?this.prevHighlightObjects.push(M):this.objects.push(M)}},iCn3D.prototype.getAtomCoordFromResi=function(e,t){if(this.residues.hasOwnProperty(e))for(var i in this.residues[e])if(this.atoms[i].name===t&&!this.atoms[i].het)return void 0!==this.atoms[i].coord2?this.atoms[i].coord2:this.atoms[i].coord},iCn3D.prototype.createTube=function(e,t,i,n){var r,o,s,a,c,l,d,h,u=[],p=[],m=[],f=[],g=[],v=0,y=[];for(var b in e)if((c=e[b]).name===t&&!c.het){if(0==v&&(a=c),v>0&&(r!==c.chain||Math.abs(c.coord.x-s.coord.x)>6||Math.abs(c.coord.y-s.coord.y)>6||Math.abs(c.coord.z-s.coord.z)>6||o+1!==c.resi&&(Math.abs(c.coord.x-s.coord.x)>3||Math.abs(c.coord.y-s.coord.y)>3||Math.abs(c.coord.z-s.coord.z)>3))){if(2!==n){var _=a.structure+"_"+a.chain+"_"+(a.resi-1).toString();f=void 0!==(l=this.getAtomCoordFromResi(_,t))?[l]:[];var w=s.structure+"_"+s.chain+"_"+(s.resi+1).toString();void 0!==(d=this.getAtomCoordFromResi(w,t))&&g.push(d);var x=s.structure+"_"+s.chain+"_"+(s.resi+2).toString();void 0!==(h=this.getAtomCoordFromResi(x,t))&&g.push(h),y.push({pnts:u,colors:p,radii:m,prevone:f,nexttwo:g})}u=[],p=[],m=[],f=[],g=[],a=c,v=0}u.push(c.coord),m.push(i||(c.b>0&&c.b<=100?.01*c.b:c.b>100?1:this.coilWidth)),p.push(c.color),1===v&&(p[p.length-2]=c.color),r=c.chain,o=c.resi,2!==n||c.ssbegin||this.createBox(c,void 0,void 0,1.2,void 0,n),++v,s=c}2!==n&&(f=[],void 0!==a&&(_=a.structure+"_"+a.chain+"_"+(a.resi-1).toString(),f=void 0!==(l=this.getAtomCoordFromResi(_,t))?[l]:[]),g=[],void 0!==c&&(w=c.structure+"_"+c.chain+"_"+(c.resi+1).toString(),void 0!==(d=this.getAtomCoordFromResi(w,t))&&g.push(d),x=c.structure+"_"+c.chain+"_"+(c.resi+2).toString(),void 0!==(h=this.getAtomCoordFromResi(x,t))&&g.push(h)),y.push({pnts:u,colors:p,radii:m,prevone:f,nexttwo:g}));b=0;for(var C=y.length;b<C;++b)this.createTubeSub(u=y[b].pnts,p=y[b].colors,m=y[b].radii,n,f=y[b].prevone,g=y[b].nexttwo);y=[]},iCn3D.prototype.createCylinderHelix=function(e,t,i){var n,r,o,s=null,a={},c={};for(o in e){var l=e[o];l.het||(("helix"!==l.ss&&"sheet"!==l.ss||l.ssend||l.ssbegin)&&(a[l.serial]=l),"sheet"===l.ss&&(c[l.serial]=l),"CA"===l.name&&("helix"===l.ss&&l.ssend&&(null!==s&&n===l.chain&&r<l.resi&&(1===i||2===i?this.createCylinder(s.coord,l.coord,t,this.hColor,i):this.createCylinder(s.coord,l.coord,t,l.color)),s=null),null===s&&"helix"===l.ss&&l.ssbegin&&(s=l,n=l.chain,r=l.resi)))}1===i||2===i?(Object.keys(a).length>0&&this.createTube(a,"CA",this.coilWidth,i),Object.keys(c).length>0&&this.createStrand(c,void 0,void 0,!0,0,this.helixSheetWidth,!1,2*this.ribbonthickness,i)):(Object.keys(a).length>0&&this.createTube(a,"CA",this.coilWidth),Object.keys(c).length>0&&this.createStrand(c,void 0,void 0,!0,0,this.helixSheetWidth,!1,2*this.ribbonthickness))},iCn3D.prototype.drawNucleicAcidStick=function(e,t){var i,n,r,o=null,s=null;for(r in e){var a=e[r];void 0===a||a.het||(a.resi===n&&a.chain===i||(null!==o&&null!==s&&this.createCylinder(new THREE.Vector3(o.coord.x,o.coord.y,o.coord.z),new THREE.Vector3(s.coord.x,s.coord.y,s.coord.z),this.cylinderRadius,o.color,t),o=null,s=null),"O3'"!==a.name&&"O3*"!==a.name||(o=a),"  A"===a.resn||"  G"===a.resn||" DA"===a.resn||" DG"===a.resn?"N1"===a.name&&(s=a):"N3"===a.name&&(s=a),n=a.resi,i=a.chain)}null!==o&&null!==s&&this.createCylinder(new THREE.Vector3(o.coord.x,o.coord.y,o.coord.z),new THREE.Vector3(s.coord.x,s.coord.y,s.coord.z),this.cylinderRadius,o.color,t)},iCn3D.prototype.isCalphaPhosOnly=function(e){var t=!1,i=0,n=0;for(var r in e){if(!(i<50))break;"CA"!==e[r].name&&"P"!==e[r].name&&"O3'"!==e[r].name&&"O3*"!==e[r].name&&++n,++i}return n<.5*i&&(t=!0),t},iCn3D.prototype.drawCartoonNucleicAcid=function(e,t,i,n){this.drawStrandNucleicAcid(e,2,t,!0,void 0,i,n)},iCn3D.prototype.drawStrandNucleicAcid=function(e,t,i,n,r,o,s){var a,c,l;2===s&&(t=void 0,o=void 0),r=r||this.nucleicAcidWidth,i=i||this.axisDIV,t=t||this.nucleicAcidStrandDIV;var d=[];for(l=0;l<t;l++)d[l]=[];var h,u,p,m=[],f=null;for(a in e){var g=e[a];if(void 0!==g&&("O3'"===g.name||"OP2"===g.name||"O3*"===g.name||"O2P"===g.name)&&!g.het)if("O3'"===g.name||"O3*"===g.name){if(h!==g.chain||u+1!==g.resi){if(p&&f)for(c=0;c<t;c++){var v=2/(t-1)*c-1;d[c].push(new THREE.Vector3(p.x+f.x*v,p.y+f.y*v,p.z+f.z*v))}for(n&&this.createStrip(d[0],d[1],m,i,o,s),c=0;!o&&c<t;c++)this.createCurveSub(d[c],1,m,i,s);for(d=[],l=0;l<t;l++)d[l]=[];m=[],f=null}p=new THREE.Vector3(g.coord.x,g.coord.y,g.coord.z),h=g.chain,u=g.resi,m.push(1===s||2===s?this.hColor:g.color)}else if("OP2"===g.name||"O2P"===g.name){if(!p){f=null;continue}var y=new THREE.Vector3(g.coord.x,g.coord.y,g.coord.z);for(y.sub(p),y.normalize().multiplyScalar(r),null!==f&&y.dot(f)<0&&y.negate(),f=y,c=0;c<t;c++)v=2/(t-1)*c-1,d[c].push(new THREE.Vector3(p.x+f.x*v,p.y+f.y*v,p.z+f.z*v));p=null}}if(p&&f)for(c=0;c<t;c++)v=2/(t-1)*c-1,d[c].push(new THREE.Vector3(p.x+f.x*v,p.y+f.y*v,p.z+f.z*v));for(n&&this.createStrip(d[0],d[1],m,i,o,s),c=0;!o&&c<t;c++)this.createCurveSub(d[c],1,m,i,s)},iCn3D.prototype.createSingleLine=function(e,t,i,n,r){var o,s=new THREE.Geometry;return o=n?new THREE.LineDashedMaterial({linewidth:1,color:i,dashSize:r,gapSize:.5*r}):new THREE.LineBasicMaterial({linewidth:1,color:i}),s.vertices.push(e),s.vertices.push(t),n&&s.computeLineDistances(),new THREE.LineSegments(s,o)},iCn3D.prototype.createBox=function(e,t,i,n,r,o){var s;void 0===t&&(t=.8),void 0===i&&(i=!1),void 0===n&&(n=.8),o?(void 0===r&&(r=this.hColor),s=new THREE.Mesh(this.boxGeometry,new THREE.MeshPhongMaterial({transparent:!0,opacity:.5,specular:this.frac,shininess:30,emissive:0,color:r}))):(void 0===r&&(r=e.color),s=new THREE.Mesh(this.boxGeometry,new THREE.MeshPhongMaterial({specular:this.frac,shininess:30,emissive:0,color:r}))),s.scale.x=s.scale.y=s.scale.z=i?t:(this.vdwRadii[e.elem]||t)*(n||1),s.position.copy(e.coord),this.mdl.add(s),o?this.prevHighlightObjects.push(s):this.objects.push(s)},iCn3D.prototype.makeTextSprite=function(e,t){void 0===t&&(t={});var i,n,r,o=t.hasOwnProperty("fontface")?t.fontface:"Arial",s=t.hasOwnProperty("fontsize")?t.fontsize:18,a=t.hasOwnProperty("alpha")?t.alpha:1,c=!0,l=!1;t.hasOwnProperty("bSchematic")&&t.bSchematic&&(l=!0,s=40),t.hasOwnProperty("backgroundColor")&&void 0!==t.backgroundColor?(i=this.hexToRgb(t.backgroundColor,a),n=t.hasOwnProperty("borderColor")?this.hexToRgb(t.borderColor,a):{r:0,g:0,b:0,a:1},r=t.hasOwnProperty("borderThickness")?t.borderThickness:4):(c=!1,i=void 0,n=void 0,r=0);var d=t.hasOwnProperty("textColor")&&void 0!==t.textColor?this.hexToRgb(t.textColor,1):{r:255,g:255,b:0,a:1},h=document.createElement("canvas"),u=h.getContext("2d");u.font="Bold "+s+"px "+o;var p=u.measureText(e).width,m=p+2*r,f=s+2*r;l&&(m>f?f=m:m=f);var g=3*this.maxD/100,v=.8*p/f;h.width=m,h.height=f,u.clearRect(0,0,m,f),c&&(u.fillStyle="rgba("+i.r+","+i.g+","+i.b+","+i.a+")",u.strokeStyle="rgba("+n.r+","+n.g+","+n.b+","+n.a+")",u.lineWidth=r,l?this.circle(u,0,0,m,f,.35*m):this.roundRect(u,0,0,m,f,0)),u.font="Bold "+s+"px "+o,u.textAlign="center",u.textBaseline="middle",u.fillStyle="rgba("+d.r+", "+d.g+", "+d.b+", 1.0)",u.strokeStyle="rgba("+d.r+", "+d.g+", "+d.b+", 1.0)",u.fillText(e,.5*m,.5*f);var y=new THREE.Texture(h);y.needsUpdate=!0;var b=new THREE.SpriteMaterial({map:y,depthTest:!1,depthWrite:!1});b.map.minFilter=THREE.LinearFilter;var _=new THREE.Sprite(b);return _.scale.set(l?g:v*g,g,1),_},iCn3D.prototype.roundRect=function(e,t,i,n,r,o){e.beginPath(),e.moveTo(t+o,i),e.lineTo(t+n-o,i),e.quadraticCurveTo(t+n,i,t+n,i+o),e.lineTo(t+n,i+r-o),e.quadraticCurveTo(t+n,i+r,t+n-o,i+r),e.lineTo(t+o,i+r),e.quadraticCurveTo(t,i+r,t,i+r-o),e.lineTo(t,i+o),e.quadraticCurveTo(t,i,t+o,i),e.closePath(),e.fill(),e.stroke()},iCn3D.prototype.circle=function(e,t,i,n,r,o){e.beginPath(),e.arc(t+n/2,i+r/2,o,0,2*Math.PI,!0),e.closePath(),e.fill(),e.stroke()},iCn3D.prototype.createLabelRepresentation=function(e){for(var t in e)for(var i=void 0!==e[t]?e[t]:[],n=0,r=i.length;n<r;++n){var o=i[n];0==o.size&&(o.size=void 0),0==o.color&&(o.color=void 0),0==o.background&&(o.background=void 0);var s,a=void 0!==o.size?o.size:this.LABELSIZE,c=void 0!==o.color?o.color:"#ffff00",l=void 0!==o.background?o.background:"#cccccc",d=void 0!==o.alpha?o.alpha:1;if(l=o.background,void 0!==c&&void 0!==l&&c.toLowerCase()===l.toLowerCase()&&(c="#888888"),Object.keys(this.proteins).length+Object.keys(this.nucleotides).length>0){var h=this.getFirstAtomObj(this.hAtoms);void 0!==h&&this.chemicals.hasOwnProperty(h.serial)}(s=this.makeTextSprite(o.text,void 0!==o.bSchematic&&o.bSchematic?{fontsize:parseInt(a),textColor:c,borderColor:l,backgroundColor:l,alpha:d,bSchematic:1}:1===o.text.length?{fontsize:parseInt(a),textColor:c,borderColor:l,backgroundColor:l,alpha:d,bSchematic:1}:{fontsize:parseInt(a),textColor:c,borderColor:l,backgroundColor:l,alpha:d,bSchematic:0})).position.set(o.position.x,o.position.y,o.position.z),this.mdl.add(s)}},iCn3D.prototype.setAtmClr=function(e,t){for(var i in e){var n=this.atoms[i];n.color=(new THREE.Color).setHex(t),this.atomPrevColors[i]=n.color}},iCn3D.prototype.updateChainsColor=function(e){var t=e.structure+"_"+e.chain;void 0!==this.chainsColor[t]&&(this.chainsColor[t]=e.color)},iCn3D.prototype.setMmdbChainColor=function(e){this.applyOriginalColor(this.hash2Atoms(void 0===e?this.hAtoms:e));var t=this.unionHash(this.chemicals,this.ions);for(var i in t){var n=this.atoms[i];n.color=this.atomColors[n.elem]||this.defaultAtomColor,this.atomPrevColors[i]=n.color}},iCn3D.prototype.setConservationColor=function(e,t){for(var i in this.setMmdbChainColor(e),this.alnChainsSeq)for(var n=this.alnChainsSeq[i],r=0,o=n.length;r<o;++r){var s=i+"_"+n[r].resi;for(var a in this.residues[s])if(e.hasOwnProperty(a)){var c=t?new THREE.Color(n[r].color):new THREE.Color(n[r].color2);this.atoms[a].color=c,this.atomPrevColors[a]=c}}},iCn3D.prototype.setColorByOptions=function(e,t,i){if(void 0!==e)if(void 0!==i&&i)for(var n in t)this.atomPrevColors[n]=(g=this.atoms[n]).color;else if(0===e.color.indexOf("#"))for(var n in t)(g=this.atoms[n]).color=(new THREE.Color).setStyle(e.color.toLowerCase()),this.atomPrevColors[n]=g.color;else switch(e.color.toLowerCase()){case"spectrum":var r=0,o=0;for(var n in t)(g=this.atoms[n]).het||++o;var a=1/o;for(var n in t)(g=this.atoms[n]).color=g.het?this.atomColors[g.elem]||this.defaultAtomColor:(new THREE.Color).setHSL(2/3*(1-r++*a),1,.45),this.atomPrevColors[n]=g.color;break;case"chain":if(void 0!==this.chainsColor&&Object.keys(this.chainsColor).length>0)this.setMmdbChainColor();else{var c=-1,l="",d=this.stdChainColors.length;for(var n in t)(g=this.atoms[n]).chain!=l&&(++c,c%=d),g.color=this.stdChainColors[c],Object.keys(this.chainsColor).length>0&&this.updateChainsColor(g),this.atomPrevColors[n]=g.color,l=g.chain}break;case"secondary structure":for(var n in this.sheetcolor="green",t)(g=this.atoms[n]).color=g.het?this.atomColors[g.elem]||this.defaultAtomColor:this.ssColors[g.ss]||new THREE.Color(16711935),this.atomPrevColors[n]=g.color;break;case"secondary structure yellow":for(var n in this.sheetcolor="yellow",t)(g=this.atoms[n]).color=g.het?this.atomColors[g.elem]||this.defaultAtomColor:this.ssColors2[g.ss]||new THREE.Color(16711935),this.atomPrevColors[n]=g.color;break;case"residue":for(var n in t)(g=this.atoms[n]).color=g.het?this.atomColors[g.elem]||this.defaultAtomColor:this.residueColors[g.resn]||this.defaultResidueColor,this.atomPrevColors[n]=g.color;break;case"charge":for(var n in t)(g=this.atoms[n]).color=g.het?this.defaultAtomColor:this.chargeColors[g.resn]||this.defaultResidueColor,this.atomPrevColors[n]=g.color;break;case"hydrophobic":for(var n in t)(g=this.atoms[n]).color=g.het?this.defaultAtomColor:this.hydrophobicColors[g.resn]||this.defaultResidueColor,this.atomPrevColors[n]=g.color;break;case"atom":for(var n in t)(g=this.atoms[n]).color=this.atomColors[g.elem]||this.defaultAtomColor,this.atomPrevColors[n]=g.color;break;case"b factor":for(var n in this.middB=50,this.spanBinv1=.02,this.spanBinv2=.02,t){if(void 0===(g=this.atoms[n]).b||0==parseInt(1e3*g.b))g.color=(new THREE.Color).setRGB(0,1,0);else{var h=g.b;h>100&&(h=100),g.color=h<this.middB?(new THREE.Color).setRGB(1-(s=(this.middB-h)*this.spanBinv1),1-s,1):(new THREE.Color).setRGB(1,1-(s=(h-this.middB)*this.spanBinv2),1-s)}this.atomPrevColors[n]=g.color}break;case"b factor percentile":var u=1e3,p=-1e3;if(!this.bfactorArray){for(var n in this.bfactorArray=[],this.atoms)u>(g=this.atoms[n]).b&&(u=g.b),p<g.b&&(p=g.b),this.bfactorArray.push(g.b);this.bfactorArray.sort(function(e,t){return e-t})}var m=this.bfactorArray.length;for(var n in t){if(void 0===(g=this.atoms[n]).b||0==parseInt(1e3*g.b)||0==this.bfactorArray.length)g.color=(new THREE.Color).setRGB(0,1,0);else{var f=this.bfactorArray.indexOf(g.b)/m;g.color=f<.5?(new THREE.Color).setRGB(2*f,2*f,1):(new THREE.Color).setRGB(1,2*(1-f),2*(1-f))}this.atomPrevColors[n]=g.color}break;case"identity":case"conserved":this.setConservationColor(t,!0);break;case"conservation":this.setConservationColor(t,!1);break;case"white":this.setAtmClr(t,16777215);break;case"grey":this.setAtmClr(t,8947848);break;case"red":this.setAtmClr(t,16711680);break;case"green":this.setAtmClr(t,65280);break;case"blue":this.setAtmClr(t,255);break;case"magenta":this.setAtmClr(t,16711935);break;case"yellow":this.setAtmClr(t,16776960);break;case"cyan":this.setAtmClr(t,65535);break;case"custom":break;default:for(var n in t){var g;(g=this.atoms[n]).color=(new THREE.Color).setStyle("#"+e.color.toLowerCase()),this.atomPrevColors[n]=g.color}}},iCn3D.prototype.applyDisplayOptions=function(e,t,i){void 0===e&&(e=this.opts);var n={},r={},o={};if(1===i&&Object.keys(t).length<Object.keys(this.atoms).length){for(var s in o=this.hash2Atoms(t),n=this.getResiduesFromAtoms(t)){u=s;var a=s.lastIndexOf("_"),c=s.substr(0,a+1),l=parseInt(s.substr(a+1)),d=c+(l-1).toString(),h=c+(l+1).toString();n.hasOwnProperty(d)||n.hasOwnProperty(d)||(r[s]=1)}if(1===Object.keys(o).length&&Object.keys(this.residues[u]).length>1&&"sphere"!==o[Object.keys(o)[0]].style&&"dot"!==o[Object.keys(o)[0]].style){if(void 0===this.bCid||!this.bCid)for(var s in o)this.createBox(m=o[s],void 0,void 0,1,void 0,i)}else for(var u in r){var p=this.getFirstCalphaAtomObj(this.residues[u]);if(d=(m=p).structure+"_"+m.chain+"_"+parseInt(m.resi-1),h=m.structure+"_"+m.chain+"_"+parseInt(m.resi+1),"cylinder and plate"===m.style&&"helix"===m.ss)for(var s in this.residues[u]){var m;this.createBox(m=this.atoms[s],void 0,void 0,1,void 0,i)}else if("ribbon"===m.style&&"coil"===m.ss||"strand"===m.style&&"coil"===m.ss||"o3 trace"===m.style||"schematic"===m.style||"c alpha trace"===m.style||"b factor tube"===m.style||"cylinder and plate"===m.style&&"helix"!==m.ss){if(void 0!==p&&void 0!==p.style2&&"nothing"!==p.style2)continue;if(!(y=!1)&&this.residues.hasOwnProperty(h)){var f=Object.keys(this.residues[h])[0],g=this.hash2Atoms(this.residues[h])[f];if(m.style===g.style&&!g.ssbegin||g.ssbegin){var v=this.residues[h];if(t=this.unionHash(t,v),y=!0,g.ssbegin)for(var s in v)this.atoms[s].notshow=!0}}!y&&this.residues.hasOwnProperty(d)&&(f=Object.keys(this.residues[d])[0],g=this.hash2Atoms(this.residues[d])[f],m.style===g.style&&(t=this.unionHash(t,this.residues[d]),y=!0))}else if("ribbon"===m.style&&"coil"!==m.ss&&m.ssend||"strand"===m.style&&"coil"!==m.ss&&m.ssend){if(void 0!==p&&void 0!==p.style2&&"nothing"!==p.style2)continue;var y;!(y=!1)&&this.residues.hasOwnProperty(h)&&(f=Object.keys(this.residues[h])[0],g=this.hash2Atoms(this.residues[h])[f],t=this.unionHash(t,this.residues[h]),y=!0)}}o={}}this.setStyle2Atoms(t),this.bAllAtoms=!1,t&&void 0!==t&&(this.bAllAtoms=Object.keys(t).length===Object.keys(this.atoms).length);var b=.5*this.cylinderRadius;void 0!==this.labels&&delete this.labels.schematic;var _=!1;if(i){var w=this.getResiduesFromCalphaAtoms(this.hAtoms),x=this.intHash(this.hAtoms,this.proteins);n=this.getResiduesFromAtoms(x),Object.keys(n)>Object.keys(w)&&(_=!0)}for(var C in this.style2atoms){var S=this.style2atoms[C],E=this.isCalphaPhosOnly(this.hash2Atoms(S));if("ribbon"!==C||i&&(!i||_))if("strand"!==C||i&&(!i||_))if("cylinder and plate"!==C||i&&(!i||_))if("nucleotide cartoon"===C)E?this.createCylinderCurve(this.hash2Atoms(S),["P"],this.traceRadius,!1,i):(this.drawCartoonNucleicAcid(this.hash2Atoms(S),null,this.ribbonthickness,i),2!==i&&this.drawNucleicAcidStick(this.hash2Atoms(S),i));else if("o3 trace"===C)this.createCylinderCurve(this.hash2Atoms(S),E?["P"]:["O3'","O3*"],this.traceRadius,!1,i);else if("schematic"===C){var M=this.getFirstAtomObj(S);this.chemicals.hasOwnProperty(M.serial)?(this.addNonCarbonAtomLabels(this.hash2Atoms(S)),bSchematic=!0,this.createStickRepresentation(this.hash2Atoms(S),b,b,void 0,i,bSchematic)):(this.addResiudeLabels(this.hash2Atoms(S),!0),this.createCylinderCurve(this.hash2Atoms(S),E?["P"]:["O3'","O3*"],this.traceRadius,!1,i),this.createCylinderCurve(this.hash2Atoms(S),["CA"],this.traceRadius,!1,i))}else"c alpha trace"===C?this.createCylinderCurve(this.hash2Atoms(S),["CA"],this.traceRadius,!1,i):"b factor tube"===C?this.createTube(this.hash2Atoms(S),"CA",null,i):"lines"===C?1===i?this.createStickRepresentation(this.hash2Atoms(S),this.hlLineRadius,this.hlLineRadius,void 0,i):this.createLineRepresentation(this.hash2Atoms(S),i):"stick"===C?this.createStickRepresentation(this.hash2Atoms(S),this.cylinderRadius,this.cylinderRadius,void 0,i):"ball and stick"===C?this.createStickRepresentation(this.hash2Atoms(S),this.cylinderRadius,.5*this.cylinderRadius,this.dotSphereScale,i):"sphere"===C?this.createSphereRepresentation(this.hash2Atoms(S),this.sphereRadius,void 0,void 0,i):"dot"===C&&this.createSphereRepresentation(this.hash2Atoms(S),this.sphereRadius,!1,this.dotSphereScale,i);else this.createCylinderHelix(this.hash2Atoms(S),this.cylinderHelixRadius,i);else this.createStrand(this.hash2Atoms(S),null,null,null,null,null,!1,void 0,i);else this.createStrand(this.hash2Atoms(S),2,void 0,!0,void 0,void 0,!1,this.ribbonthickness,i)}this.cnt>this.maxmaxatomcnt&&this.init_base(),void 0!==this.labels&&Object.keys(this.labels).length>0&&(this.hideLabels(),this.createLabelRepresentation(this.labels))},iCn3D.prototype.hideLabels=function(){if(void 0!==this.mdl)for(var e=0,t=this.mdl.children.length;e<t;++e){var i=this.mdl.children[e];void 0!==i&&"Sprite"===i.type&&this.mdl.remove(i)}},iCn3D.prototype.setStyle2Atoms=function(e){for(var t in this.style2atoms={},e)void 0===this.style2atoms[this.atoms[t].style]&&(this.style2atoms[this.atoms[t].style]={}),this.style2atoms[this.atoms[t].style][t]=1,void 0!==this.atoms[t].style2&&"nothing"!==this.atoms[t].style2&&(void 0===this.style2atoms[this.atoms[t].style2]&&(this.style2atoms[this.atoms[t].style2]={}),this.style2atoms[this.atoms[t].style2][t]=1)},iCn3D.prototype.setAtomStyleByOptions=function(e){if(void 0===e&&(e=this.opts),void 0!==e.proteins)for(var t in this.intHash(this.hAtoms,this.proteins))this.atoms[t].style=e.proteins.toLowerCase();if(void 0!==e.sidec&&"nothing"!==e.sidec)for(var t in this.intHash(this.hAtoms,this.sidec))this.atoms[t].style2=e.sidec.toLowerCase();if(void 0!==e.chemicals)for(var t in this.intHash(this.hAtoms,this.chemicals))this.atoms[t].style=e.chemicals.toLowerCase();if(void 0!==e.ions)for(var t in this.intHash(this.hAtoms,this.ions))this.atoms[t].style=e.ions.toLowerCase();if(void 0!==e.water)for(var t in this.intHash(this.hAtoms,this.water))this.atoms[t].style=e.water.toLowerCase();if(void 0!==e.nucleotides)for(var t in this.intHash(this.hAtoms,this.nucleotides))this.atoms[t].style=e.nucleotides.toLowerCase()},iCn3D.prototype.rebuildSceneBase=function(e){if(jQuery.extend(this.opts,e),this.cam_z=2*this.maxD,void 0!==this.scene)for(var t=this.scene.children.length-1;t>=0;t--)this.scene.remove(this.scene.children[t]);else this.scene=new THREE.Scene;if(void 0!==this.scene_ghost)for(t=this.scene_ghost.children.length-1;t>=0;t--)this.scene_ghost.remove(this.scene_ghost.children[t]);else this.scene_ghost=new THREE.Scene;this.directionalLight=new THREE.DirectionalLight(16777215,1),this.directionalLight.position.set(0,0,this.cam_z>0?1:-1);var i=new THREE.AmbientLight(4210752);this.scene.add(this.directionalLight),this.scene.add(i),this.mdl=new THREE.Object3D,this.mdlImpostor=new THREE.Object3D,this.scene.add(this.mdl),this.scene.add(this.mdlImpostor),this.mdl_ghost=new THREE.Object3D,this.scene_ghost.add(this.mdl_ghost),this.objects=[],this.objects_ghost=[],this.raycaster=new THREE.Raycaster,this.projector=new THREE.Projector,this.mouse=new THREE.Vector2;var n=this.backgroundColors[this.opts.background.toLowerCase()];"transparent"===this.opts.background.toLowerCase()?this.renderer.setClearColor(n,0):this.renderer.setClearColor(n,1),this.perspectiveCamera=new THREE.PerspectiveCamera(20,this.container.whratio,.1,1e4),this.perspectiveCamera.position.set(0,0,this.cam_z),this.perspectiveCamera.lookAt(new THREE.Vector3(0,0,0)),this.orthographicCamera=new THREE.OrthographicCamera,this.orthographicCamera.position.set(0,0,this.cam_z),this.orthographicCamera.lookAt(new THREE.Vector3(0,0,0)),this.cams={perspective:this.perspectiveCamera,orthographic:this.orthographicCamera}},iCn3D.prototype.setCamera=function(){if(this.cam=this.cams[this.opts.camera.toLowerCase()],this.cam===this.perspectiveCamera){var e=void 0!==this.biomtMatrices&&this.biomtMatrices.length*this.cnt>10*this.maxatomcnt?1:2;this.cam.position.z=this.cam_z>0?this.maxD*e:-this.maxD*e,this.cam.near="yes"===this.opts.slab?2*this.maxD:.1,this.cam.far=1e4,this.controls=new THREE.TrackballControls(this.cam,document.getElementById(this.id),this)}else this.cam===this.orthographicCamera&&(this.cam.right=void 0!==this.biomtMatrices&&this.biomtMatrices.length*this.cnt>10*this.maxatomcnt?this.maxD/2*1.5:this.maxD/2*2.5,this.cam.left=-this.cam.right,this.cam.top=this.cam.right/this.container.whratio,this.cam.bottom=-this.cam.right/this.container.whratio,this.cam.near="yes"===this.opts.slab?2*this.maxD:0,this.cam.far=1e4,this.controls=new THREE.OrthographicTrackballControls(this.cam,document.getElementById(this.id),this));this.cam.updateProjectionMatrix()},iCn3D.prototype.render=function(){this.directionalLight.position.copy(this.cam.position),this.renderer.gammaInput=!0,this.renderer.gammaOutput=!0,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.render(this.scene,this.cam)},iCn3D.prototype.clearImpostors=function(){this.posArray=[],this.colorArray=[],this.pos2Array=[],this.color2Array=[],this.radiusArray=[],this.posArraySphere=[],this.colorArraySphere=[],this.radiusArraySphere=[]},iCn3D.prototype.applyTransformation=function(e,t,i){var n={update:!1};n._zoomFactor=e,n.mouseChange=new THREE.Vector2,n.mouseChange.copy(t),n.quaternion=new THREE.Quaternion,n.quaternion.copy(i),this.controls.update(n)},iCn3D.prototype.applyCenterOptions=function(e){switch(void 0===e&&(e=this.opts),e.rotationcenter.toLowerCase()){case"molecule center":void 0!==this.center&&this.setRotationCenter(this.center);break;case"pick center":void 0!==this.pAtom&&this.setRotationCenter(this.pAtom.coord);break;case"display center":var t=this.centerAtoms(this.dAtoms).center;this.setRotationCenter(t);break;case"highlight center":t=this.centerAtoms(this.hAtoms).center,this.setRotationCenter(t)}},iCn3D.prototype.setRotationCenter=function(e){this.mdl.position.set(0,0,0),this.mdlImpostor.position.set(0,0,0),this.mdl_ghost.position.set(0,0,0),this.mdl.position.sub(e),this.mdlImpostor.position.sub(e),this.mdl_ghost.position.sub(e)},iCn3D.prototype.applyOriginalColor=function(e){for(var t in void 0===e&&(e=this.atoms),e){var i=e[t],n=i.structure+"_"+i.chain;i.color=this.chainsColor.hasOwnProperty(n)?this.chainsColor[n]:this.atomColors[i.elem],this.atomPrevColors[t]=i.color}},iCn3D.prototype.onBeforeRender=function(e,t,i,n,r){var o=r.uniforms,s=[];if(o.objectId&&(o.objectId.value=SupportsReadPixelsFloat?this.id:this.id/255,s.push("objectId")),(o.modelViewMatrixInverse||o.modelViewMatrixInverseTranspose||o.modelViewProjectionMatrix||o.modelViewProjectionMatrixInverse)&&this.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,this.matrixWorld),o.modelViewMatrixInverse&&(o.modelViewMatrixInverse.value.getInverse(this.modelViewMatrix),s.push("modelViewMatrixInverse")),o.modelViewMatrixInverseTranspose&&(o.modelViewMatrixInverse?o.modelViewMatrixInverseTranspose.value.copy(o.modelViewMatrixInverse.value).transpose():o.modelViewMatrixInverseTranspose.value.getInverse(this.modelViewMatrix).transpose(),s.push("modelViewMatrixInverseTranspose")),o.modelViewProjectionMatrix&&(i.updateProjectionMatrix(),o.modelViewProjectionMatrix.value.multiplyMatrices(i.projectionMatrix,this.modelViewMatrix),s.push("modelViewProjectionMatrix")),o.modelViewProjectionMatrixInverse){var a=new THREE.Matrix4;o.modelViewProjectionMatrix?(a.copy(o.modelViewProjectionMatrix.value),o.modelViewProjectionMatrixInverse.value.getInverse(a)):(i.updateProjectionMatrix(),a.multiplyMatrices(i.projectionMatrix,this.modelViewMatrix),o.modelViewProjectionMatrixInverse.value.getInverse(a)),s.push("modelViewProjectionMatrixInverse")}if(o.projectionMatrix&&(i.updateProjectionMatrix(),o.projectionMatrix.value.copy(i.projectionMatrix),s.push("projectionMatrix")),o.projectionMatrixInverse&&(i.updateProjectionMatrix(),o.projectionMatrixInverse.value.getInverse(i.projectionMatrix),s.push("projectionMatrixInverse")),s.length){var c=e.properties.get(r);if(c.program){var l=e.getContext(),d=c.program;l.useProgram(d.program);var h=d.getUniforms();s.forEach(function(e){h.setValue(l,e,o[e].value)})}}},iCn3D.prototype.setParametersForShader=function(e){var t=this.backgroundColors[this.opts.background.toLowerCase()],i=1.5*this.maxD,n=3*this.maxD,r=void 0!==e?e:1;this.uniforms=THREE.UniformsUtils.merge([THREE.UniformsLib.common,{modelViewMatrix:{value:new THREE.Matrix4},modelViewMatrixInverse:{value:new THREE.Matrix4},modelViewMatrixInverseTranspose:{value:new THREE.Matrix4},modelViewProjectionMatrix:{value:new THREE.Matrix4},modelViewProjectionMatrixInverse:{value:new THREE.Matrix4},projectionMatrix:{value:new THREE.Matrix4},projectionMatrixInverse:{value:new THREE.Matrix4},diffuse:{type:"v3",value:[1,1,1]},emissive:{type:"v3",value:[0,0,0]},roughness:{type:"f",value:.5},metalness:{type:"f",value:.3},opacity:{type:"f",value:r},nearClip:{type:"f",value:.1},ortho:{type:"f",value:0},shrink:{type:"f",value:.13},fogColor:{type:"v3",value:[t.r,t.g,t.b]},fogNear:{type:"f",value:i},fogFar:{type:"f",value:n},fogDensity:{type:"f",value:2}},THREE.UniformsLib.ambient,THREE.UniformsLib.lights]),this.defines={USE_COLOR:1,NEAR_CLIP:1,CAP:1},"yes"===this.opts.fog&&(this.defines.USE_FOG=1,"orthographic"===this.opts.camera&&(this.defines.FOG_EXP2=1)),this.bExtFragDepth&&(this.defines.USE_LOGDEPTHBUF_EXT=1)},iCn3D.prototype.drawImpostorShader=function(){this.setParametersForShader(),this.createImpostorShaderSphere("SphereImpostor"),this.createImpostorShaderCylinder("CylinderImpostor")},iCn3D.prototype.getShader=function(e){return $NGL_shaderTextHash[e].replace(/#include\s+(\S+)/gim,function(e,t){var i;return THREE.ShaderChunk.hasOwnProperty(t)&&(i=THREE.ShaderChunk[t]),i||""})},iCn3D.prototype.createImpostorShaderBase=function(e,t,i,n,r,o,s,a,c){var l=new THREE.ShaderMaterial({defines:this.defines,uniforms:this.uniforms,vertexShader:this.getShader(e+".vert"),fragmentShader:this.getShader(e+".frag"),depthTest:!0,depthWrite:!0,needsUpdate:!0,lights:!0});l.extensions.fragDepth=!0,"CylinderImpostor"==e?this.CylinderImpostorMaterial=l:"SphereImpostor"==e&&(this.SphereImpostorMaterial=l);for(var d,h,u=o*s,p=o*a,m=new(u>65535?Uint32Array:Uint16Array)(p),f=0;f<o;f++){h=f*s,m.set(i,d=f*a);for(var g=0;g<a;++g)m[d+g]+=h}var v=new THREE.BufferGeometry;m&&(v.setIndex(new THREE.BufferAttribute(m,1)),v.getIndex().setDynamic(!0));var y={f:1,v2:2,v3:3,c:3};for(var b in r){var _,w=r[b];_=new Float32Array(u*y[w.type]),v.addAttribute(b,new THREE.BufferAttribute(_,y[w.type]).setDynamic(!0))}var x,C,S,E,M,T=v.attributes;for(var b in n){x=n[b],C=(w=T[b]).itemSize,S=w.array;for(var A=0;A<o;++A){E=(p=A*C)*s;for(var k=0;k<s;++k){M=E+C*k;for(var R=0;R<C;++R)S[M+R]=x[p+R]}}w.needsUpdate=!0}var D=v.attributes.mapping.array;for(f=0;f<o;f++)D.set(t,f*c*s);var L=new THREE.Mesh(v,l);L.frustumCulled=!1,L.scale.x=L.scale.y=L.scale.z=1,"CylinderImpostor"==e?L.type="Cylinder":"SphereImpostor"==e&&(L.type="Sphere"),L.onBeforeRender=this.onBeforeRender,this.mdlImpostor.add(L)},iCn3D.prototype.createImpostorShaderCylinder=function(e){var t=this,i=new Float32Array(t.posArray),n=new Float32Array(t.colorArray),r=new Float32Array(t.pos2Array),o=new Float32Array(t.color2Array),s=new Float32Array(t.radiusArray),a=new Float32Array([-1,1,-1,-1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,-1,1]),c=new Uint16Array([0,1,2,1,4,2,2,4,3,4,5,3]),l={position1:i,color:n,position2:r,color2:o,radius:s};this.createImpostorShaderBase(e,a,c,l,{position1:{type:"v3",value:null},color:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"v3",value:null},radius:{type:"f",value:null},mapping:{type:"v3",value:null}},i.length/3,6,12,3),l=null,i=null,n=null,r=null,o=null,s=null,t.posArray=null,t.colorArray=null,t.pos2Array=null,t.color2Array=null,t.radiusArray=null},iCn3D.prototype.createImpostorShaderSphere=function(e){var t=this,i=new Float32Array(t.posArraySphere),n=new Float32Array(t.colorArraySphere),r=new Float32Array(t.radiusArraySphere),o=new Float32Array([-1,1,-1,-1,1,1,1,-1]),s=new Uint16Array([0,1,2,1,3,2]),a={position:i,color:n,radius:r};this.createImpostorShaderBase(e,o,s,a,{position:{type:"v3",value:null},color:{type:"v3",value:null},radius:{type:"f",value:null},mapping:{type:"v2",value:null}},i.length/3,4,6,2),a=null,i=null,n=null,r=null,t.posArraySphere=null,t.colorArraySphere=null,t.radiusArraySphere=null},iCn3D.prototype.positionFromGeometry=function(e){for(var t,i,n=e.geometry,r=n.vertices,o=e.position,s=e.scale,a=e.matrix,c=r.length,l=[],d=0;d<c;d++)t=3*d,i="SphereGeometry"==n.type||"BoxGeometry"==n.type?r[d].clone().multiply(s).add(o):"CylinderGeometry"==n.type?r[d].clone().applyMatrix4(a):r[d],l[t+0]=i.x,l[t+1]=i.y,l[t+2]=i.z;return l},iCn3D.prototype.colorFromGeometry=function(e){var t=e.geometry,i=new THREE.Color(1,1,1);"SphereGeometry"!=t.type&&"BoxGeometry"!=t.type&&"CylinderGeometry"!=t.type||void 0!==e.material&&(i=e.material.color);for(var n,r,o,s,a,c=t.faces,l=c.length,d=[],h=0;h<l;h++)r=c[h],"Surface"==t.type?(o=r.vertexColors[0],s=r.vertexColors[1],a=r.vertexColors[2]):"SphereGeometry"==t.type||"BoxGeometry"==t.type||"CylinderGeometry"==t.type?(o=i,s=i,a=i):(o=r.color,s=r.color,a=r.color),d[0+(n=3*r.a)]=o.r,d[n+1]=o.g,d[n+2]=o.b,d[0+(n=3*r.b)]=s.r,d[n+1]=s.g,d[n+2]=s.b,d[0+(n=3*r.c)]=a.r,d[n+1]=a.g,d[n+2]=a.b;return d},iCn3D.prototype.indexFromGeometry=function(e){for(var t,i,n=e.geometry.faces,r=n.length,o=[],s=0;s<r;s++)o[0+(t=3*s)]=(i=n[s]).a,o[t+1]=i.b,o[t+2]=i.c;return o},iCn3D.prototype.normalFromGeometry=function(e){for(var t,i,n,r,o,s,a=e.geometry.faces,c=a.length,l=[],d=0;d<c;d++)o=(n=(i=a[d]).vertexNormals)[1],s=n[2],l[0+(t=3*i.a)]=(r=n[0]).x,l[t+1]=r.y,l[t+2]=r.z,l[0+(t=3*i.b)]=o.x,l[t+1]=o.y,l[t+2]=o.z,l[0+(t=3*i.c)]=s.x,l[t+1]=s.y,l[t+2]=s.z;return l},iCn3D.prototype.hashvalue2array=function(e){var t=[];for(var i in e)t.push(e[i]);return t},iCn3D.prototype.drawSymmetryMates=function(){this.bInstanced&&Object.keys(this.atoms).length*this.biomtMatrices.length>this.maxatomcnt?this.drawSymmetryMatesInstancing():this.drawSymmetryMatesNoInstancing()},iCn3D.prototype.drawSymmetryMatesNoInstancing=function(){if(void 0!==this.biomtMatrices&&0!=this.biomtMatrices.length){var e=1,t=this.center.clone(),i=new THREE.Matrix4;i.identity();for(var n=0;n<this.biomtMatrices.length;n++){var r=this.biomtMatrices[n];if(void 0!==r&&!r.equals(i)){var o=this.mdl.clone();o.applyMatrix(r),this.mdl.add(o),(o=this.mdlImpostor.clone()).applyMatrix(r);for(var s=o.children.length-1;s>=0;s--)o.children[s].onBeforeRender=this.onBeforeRender;this.mdlImpostor.add(o),(o=this.mdl_ghost.clone()).applyMatrix(r),this.mdl_ghost.add(o);var a=this.center.clone();a.applyMatrix4(r),t.add(a),++e}}void 0!==this.bSetInstancing&&this.bSetInstancing?(this.maxD=this.maxDAssembly,this.center=this.centerAssembly.clone(),this.setCenter(this.center),this.setCamera()):(this.maxD*=Math.sqrt(e),this.center=t.multiplyScalar(1/e),this.maxDAssembly=this.maxD,this.centerAssembly=this.center.clone(),this.setCenter(this.center),this.setCamera()),this.bSetInstancing=!0}},iCn3D.prototype.createInstancedGeometry=function(e){var t=e.geometry,i=new THREE.InstancedBufferGeometry,n=[],r=[],o=[],s=[],a=[],c=[],l=[],d=[];if(t.vertices&&t.faces){this.instancedMaterial=this.getInstancedMaterial("Instancing");var h=this.positionFromGeometry(e),u=this.normalFromGeometry(e),p=this.colorFromGeometry(e),m=this.indexFromGeometry(e);n=n.concat(h),r=r.concat(u),o=o.concat(p),s=s.concat(m);for(var f=[],g="CylinderGeometry"==t.type?1:0,v=0,y=n.length/3;v<y;++v)f.push(g);i.addAttribute("position",new THREE.BufferAttribute(new Float32Array(n),3)),i.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(r),3)),i.addAttribute("color",new THREE.BufferAttribute(new Float32Array(o),3)),i.addAttribute("cylinder",new THREE.BufferAttribute(new Float32Array(f),1)),i.setIndex(new THREE.BufferAttribute(new Uint32Array(s),1)),h=null,u=null,p=null,m=null}else if(this.bImpo&&void 0!==t.attributes.color2){this.instancedMaterial=this.getInstancedMaterial("CylinderInstancing"),h=this.hashvalue2array(t.attributes.position1.array),p=this.hashvalue2array(t.attributes.color.array);var b=this.hashvalue2array(t.attributes.position2.array),_=this.hashvalue2array(t.attributes.color2.array),w=(m=this.hashvalue2array(t.index.array),this.hashvalue2array(t.attributes.radius.array)),x=this.hashvalue2array(t.attributes.mapping.array);n=n.concat(h),o=o.concat(p),l=l.concat(b),d=d.concat(_),s=s.concat(m),a=a.concat(w),c=c.concat(x),i.addAttribute("position1",new THREE.BufferAttribute(new Float32Array(n),3)),i.addAttribute("color",new THREE.BufferAttribute(new Float32Array(o),3)),i.addAttribute("position2",new THREE.BufferAttribute(new Float32Array(l),3)),i.addAttribute("color2",new THREE.BufferAttribute(new Float32Array(d),3)),i.addAttribute("radius",new THREE.BufferAttribute(new Float32Array(a),1)),i.addAttribute("mapping",new THREE.BufferAttribute(new Float32Array(c),3)),i.setIndex(new THREE.BufferAttribute(new Uint32Array(s),1)),h=null,p=null,b=null,_=null,m=null,w=null,x=null}else this.bImpo&&void 0!==t.attributes.color&&(this.instancedMaterial=this.getInstancedMaterial("SphereInstancing"),h=this.hashvalue2array(t.attributes.position.array),p=this.hashvalue2array(t.attributes.color.array),m=this.hashvalue2array(t.index.array),w=this.hashvalue2array(t.attributes.radius.array),x=this.hashvalue2array(t.attributes.mapping.array),n=n.concat(h),o=o.concat(p),s=s.concat(m),a=a.concat(w),c=c.concat(x),i.addAttribute("position",new THREE.BufferAttribute(new Float32Array(n),3)),i.addAttribute("color",new THREE.BufferAttribute(new Float32Array(o),3)),i.addAttribute("radius",new THREE.BufferAttribute(new Float32Array(a),1)),i.addAttribute("mapping",new THREE.BufferAttribute(new Float32Array(c),2)),i.setIndex(new THREE.BufferAttribute(new Uint32Array(s),1)),h=null,p=null,m=null,w=null,x=null);n=null,r=null,o=null,s=null,a=null,c=null,l=null,d=null;var C=new THREE.InstancedBufferAttribute(new Float32Array(this.matricesElements1),4),S=new THREE.InstancedBufferAttribute(new Float32Array(this.matricesElements2),4),E=new THREE.InstancedBufferAttribute(new Float32Array(this.matricesElements3),4),M=new THREE.InstancedBufferAttribute(new Float32Array(this.matricesElements4),4);return i.addAttribute("matrix1",C),i.addAttribute("matrix2",S),i.addAttribute("matrix3",E),i.addAttribute("matrix4",M),i},iCn3D.prototype.getInstancedMaterial=function(e){var t=new THREE.ShaderMaterial({defines:this.defines,uniforms:this.uniforms,vertexShader:this.getShader(e+".vert"),fragmentShader:this.getShader(e+".frag"),depthTest:!0,depthWrite:!0,needsUpdate:!0,lights:!0});return t.extensions.fragDepth=!0,t.extensions.derivatives="#extension GL_OES_standard_derivatives : enable",t},iCn3D.prototype.drawSymmetryMatesInstancing=function(){if(void 0!==this.biomtMatrices&&0!=this.biomtMatrices.length){var e=1,t=this.center.clone();if(this.setParametersForShader(),void 0===this.bSetInstancing||!this.bSetInstancing){this.matricesElements1=[],this.matricesElements2=[],this.matricesElements3=[],this.matricesElements4=[];var i=new THREE.Matrix4;i.identity();for(var n=0;n<this.biomtMatrices.length;n++){var r=this.biomtMatrices[n];if(void 0!==r){var o=r.toArray();if(!r.equals(i)){this.matricesElements1.push(o[0],o[1],o[2],o[3]),this.matricesElements2.push(o[4],o[5],o[6],o[7]),this.matricesElements3.push(o[8],o[9],o[10],o[11]),this.matricesElements4.push(o[12],o[13],o[14],o[15]);var s=this.center.clone();s.applyMatrix4(r),t.add(s),++e}}}}n=0;for(var a=this.mdl.children.length;n<a;++n)if("Sprite"!==(l=this.mdl.children[n]).type){var c=this.createInstancedGeometry(l);(d=new THREE.Mesh(c,this.instancedMaterial)).onBeforeRender=this.onBeforeRender,d.frustumCulled=!1,c=void 0,this.mdl.add(d)}for(n=0,a=this.mdlImpostor.children.length;n<a;++n){var l,d;c=this.createInstancedGeometry(l=this.mdlImpostor.children[n]),(d=new THREE.Mesh(c,this.instancedMaterial)).onBeforeRender=this.onBeforeRender,d.frustumCulled=!1,c=null,this.mdlImpostor.add(d)}void 0!==this.bSetInstancing&&this.bSetInstancing?(this.maxD=this.maxDAssembly,this.center=this.centerAssembly.clone(),this.setCenter(this.center),this.setCamera()):(this.maxD*=Math.sqrt(e),this.center=t.multiplyScalar(1/e),this.maxDAssembly=this.maxD,this.centerAssembly=this.center.clone(),this.setCenter(this.center),this.setCamera()),this.bSetInstancing=!0}},iCn3D.prototype.cloneHash=function(e){var t={};for(var i in e)t[i]=e[i];return t},iCn3D.prototype.residueName2Abbr=function(e){switch(void 0!==e&&" "!==e.charAt(0)&&" "===e.charAt(1)&&(e=e.charAt(0)),e){case"  A":return"A";case"  C":return"C";case"  G":return"G";case"  T":return"T";case"  U":return"U";case"  I":return"I";case" DA":return"A";case" DC":return"C";case" DG":return"G";case" DT":return"T";case" DU":return"U";case" DI":return"I";case"ALA":return"A";case"ARG":return"R";case"ASN":return"N";case"ASP":return"D";case"CYS":return"C";case"GLU":return"E";case"GLN":return"Q";case"GLY":return"G";case"HIS":return"H";case"ILE":return"I";case"LEU":return"L";case"LYS":return"K";case"MET":return"M";case"PHE":return"F";case"PRO":return"P";case"SER":return"S";case"THR":return"T";case"TRP":return"W";case"TYR":return"Y";case"VAL":return"V";case"SEC":return"U";case"HOH":case"WAT":return"O";default:return e}},iCn3D.prototype.intHash=function(e,t){var i={};if(Object.keys(e).length<Object.keys(t).length)for(var n in e)void 0!==t&&t[n]&&(i[n]=e[n]);else for(var n in t)void 0!==e&&e[n]&&(i[n]=t[n]);return e={},t={},i},iCn3D.prototype.exclHash=function(e,t){var i={};for(var n in e)n in t||(i[n]=e[n]);return e={},t={},i},iCn3D.prototype.unionHash=function(e,t){return this.unionHashNotInPlace(e,t)},iCn3D.prototype.unionHashNotInPlace=function(e,t){var i=jQuery.extend({},e,t);return e={},t={},i},iCn3D.prototype.intHash2Atoms=function(e,t){return this.hash2Atoms(this.intHash(e,t))},iCn3D.prototype.exclHash2Atoms=function(e,t){return this.hash2Atoms(this.exclHash(e,t))},iCn3D.prototype.unionHash2Atoms=function(e,t){return this.hash2Atoms(this.unionHash(e,t))},iCn3D.prototype.hash2Atoms=function(e){var t={};for(var i in e)t[i]=this.atoms[i];return e={},t},iCn3D.prototype.exportCanvas=function(){this.render(),window.open(this.renderer.domElement.toDataURL("image/png"))},iCn3D.prototype.zoomIn=function(e){var t={};t._zoomFactor=1-e,t.update=!0,this.controls.update(t),this.render()},iCn3D.prototype.zoomOut=function(e){var t={};t._zoomFactor=1+e,t.update=!0,this.controls.update(t),this.render()},iCn3D.prototype.rotateLeft=function(e){var t=new THREE.Vector3(0,1,0),i=-e/180*Math.PI;t.applyQuaternion(this.cam.quaternion).normalize();var n=new THREE.Quaternion;n.setFromAxisAngle(t,-i);var r={};r.quaternion=n,r.update=!0,this.controls.update(r),this.render()},iCn3D.prototype.rotateRight=function(e){var t=new THREE.Vector3(0,1,0),i=e/180*Math.PI;t.applyQuaternion(this.cam.quaternion).normalize();var n=new THREE.Quaternion;n.setFromAxisAngle(t,-i);var r={};r.quaternion=n,r.update=!0,this.controls.update(r),this.render()},iCn3D.prototype.rotateUp=function(e){var t=new THREE.Vector3(1,0,0),i=-e/180*Math.PI;t.applyQuaternion(this.cam.quaternion).normalize();var n=new THREE.Quaternion;n.setFromAxisAngle(t,-i);var r={};r.quaternion=n,r.update=!0,this.controls.update(r),this.render()},iCn3D.prototype.rotateDown=function(e){var t=new THREE.Vector3(1,0,0),i=e/180*Math.PI;t.applyQuaternion(this.cam.quaternion).normalize();var n=new THREE.Quaternion;n.setFromAxisAngle(t,-i);var r={};r.quaternion=n,r.update=!0,this.controls.update(r),this.render()},iCn3D.prototype.translateLeft=function(e){var t=new THREE.Vector2(0,0);t.x-=e/100;var i={};i.mouseChange=t,i.update=!0,this.controls.update(i),this.render()},iCn3D.prototype.translateRight=function(e){var t=new THREE.Vector2(0,0);t.x+=e/100;var i={};i.mouseChange=t,i.update=!0,this.controls.update(i),this.render()},iCn3D.prototype.translateUp=function(e){var t=new THREE.Vector2(0,0);t.y-=e/100;var i={};i.mouseChange=t,i.update=!0,this.controls.update(i),this.render()},iCn3D.prototype.translateDown=function(e){var t=new THREE.Vector2(0,0);t.y+=e/100;var i={};i.mouseChange=t,i.update=!0,this.controls.update(i),this.render()},iCn3D.prototype.showPickingHilight=function(e){this.bShift||this.bCtrl||this.removeHlObjects(),this.pickedAtomList={},1===this.pk?this.pickedAtomList[e.serial]=1:2===this.pk?this.pickedAtomList=this.residues[e.structure+"_"+e.chain+"_"+e.resi]:3===this.pk?this.pickedAtomList=this.selectStrandHelixFromAtom(e):4===this.pk&&(this.pickedAtomList=this.chains[e.structure+"_"+e.chain]),this.bShowHighlight=0!==this.pk;var t=Object.keys(this.hAtoms).length==Object.keys(this.atoms).length?{}:this.intHash(this.hAtoms,this.pickedAtomList),i=Object.keys(t).length;if(this.bShift||this.bCtrl)if(this.bShift){if(void 0===this.prevPickedAtomList)this.hAtoms=this.unionHash(this.hAtoms,this.pickedAtomList);else{var n=this.getFirstAtomObj(this.prevPickedAtomList),r=this.getFirstAtomObj(this.pickedAtomList);if(n.structure+"_"+n.chain!=r.structure+"_"+r.chain)this.hAtoms=this.unionHash(this.hAtoms,this.pickedAtomList);else for(var o=this.unionHash(this.prevPickedAtomList,this.pickedAtomList),s=this.getFirstAtomObj(o),a=this.getLastAtomObj(o),c=s.serial;c<=a.serial;++c)this.hAtoms[c]=1}this.prevPickedAtomList=this.cloneHash(this.pickedAtomList)}else this.bCtrl&&(this.hAtoms=i>0?this.exclHash(this.hAtoms,this.pickedAtomList):this.unionHash(this.hAtoms,this.pickedAtomList));else this.hAtoms=this.cloneHash(this.pickedAtomList);this.removeHlObjects(),this.addHlObjects()},iCn3D.prototype.showPicking=function(e,t,i){this.showPickingBase(e,t,i)},iCn3D.prototype.showPickingBase=function(e,t,i){void 0===t&&void 0===i&&this.showPickingHilight(e)},iCn3D.prototype.removeHlObjects=function(){for(var e in this.prevHighlightObjects)this.mdl.remove(this.prevHighlightObjects[e]);for(var e in this.prevHighlightObjects=[],this.prevHighlightObjects_ghost)this.mdl.remove(this.prevHighlightObjects_ghost[e]);this.prevHighlightObjects_ghost=[]},iCn3D.prototype.addHlObjects=function(e,t,i){void 0===e&&(e=this.hColor),void 0===i&&(i=this.hAtoms),this.applyDisplayOptions(this.opts,this.intHash(i,this.dAtoms),this.bHighlight),(void 0===t||t)&&this.render()},iCn3D.prototype.resetOrientation=function(){var e=!1;if(this.commands.length>0){var t=this.commands[0].split("|||");if(2==t.length){var i=JSON.parse(t[1]);this._zoomFactor=i.factor,this.mouseChange.x=i.mouseChange.x,this.mouseChange.y=i.mouseChange.y,this.quaternion._x=i.quaternion._x,this.quaternion._y=i.quaternion._y,this.quaternion._z=i.quaternion._z,this.quaternion._w=i.quaternion._w,e=!0}}e||(this._zoomFactor=1,this.mouseChange=new THREE.Vector2(0,0),this.quaternion=new THREE.Quaternion(0,0,0,1)),this.maxD=this.oriMaxD,this.center=this.oriCenter.clone(),"show"==this.ori_chemicalbinding?this.bSkipChemicalbinding=!1:"hide"==this.ori_chemicalbinding&&(this.bSkipChemicalbinding=!0)},iCn3D.prototype.getAtomsFromPosition=function(e,t){var i;for(i in null==t&&(t=1),this.atoms){var n=this.atoms[i];if(this.ions.hasOwnProperty(i)&&"sphere"===this.opts.ions){var r=this.vdwRadii[n.elem];if(Math.abs(n.coord.x-e.x)-r>t)continue;if(Math.abs(n.coord.y-e.y)-r>t)continue;if(Math.abs(n.coord.z-e.z)-r>t)continue}else{if(n.coord.x<e.x-t||n.coord.x>e.x+t)continue;if(n.coord.y<e.y-t||n.coord.y>e.y+t)continue;if(n.coord.z<e.z-t||n.coord.z>e.z+t)continue}return n}return null},iCn3D.prototype.getFirstAtomObj=function(e){if(null==e)return this.atoms[0];var t=Object.keys(e);return this.atoms[t[0]]},iCn3D.prototype.getFirstCalphaAtomObj=function(e){if(null==e)return this.atoms[0];var t;for(var i in e)if("CA"==this.atoms[i].name){t=i;break}return void 0!==t?this.atoms[t]:this.getFirstAtomObj(e)},iCn3D.prototype.getLastAtomObj=function(e){var t=Object.keys(e);return this.atoms[t[t.length-1]]},iCn3D.prototype.hexToRgb=function(e,t){var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16),a:t}:null},iCn3D.prototype.selectStrandHelixFromAtom=function(e){var t=e,i=e,n={},r=t.resi;if(!t.ssbegin){for(var o=t.resi-1;o>0&&this.residues.hasOwnProperty(c=t.structure+"_"+t.chain+"_"+o);--o)if(r=(e=this.getFirstCalphaAtomObj(this.residues[c])).resi,"coil"!==t.ss&&e.ss===t.ss&&e.ssbegin||"coil"===t.ss&&e.ss!==t.ss){"coil"===t.ss&&e.ss!==t.ss&&(r=e.resi+1);break}for(o=r;o<=t.resi;++o)n=this.unionHash(n,this.hash2Atoms(this.residues[c=t.structure+"_"+t.chain+"_"+o]))}var s=i.resi,a=this.getLastAtomObj(this.chains[i.structure+"_"+i.chain]).resi;for(o=i.resi+1;o<=a&&this.residues.hasOwnProperty(c=i.structure+"_"+i.chain+"_"+o);++o)if(s=(e=this.getFirstCalphaAtomObj(this.residues[c])).resi,"coil"!==i.ss&&e.ss===i.ss&&e.ssend||"coil"===i.ss&&e.ss!==i.ss){"coil"===i.ss&&e.ss!==i.ss&&(s=e.resi-1);break}for(o=i.resi+1;o<=s;++o){var c;n=this.unionHash(n,this.hash2Atoms(this.residues[c=i.structure+"_"+i.chain+"_"+o]))}return n},iCn3D.prototype.addNonCarbonAtomLabels=function(e){var t=this.intHash(this.hAtoms,e);for(var i in void 0===this.labels.schematic&&(this.labels.schematic=[]),t){var n=this.atoms[i];if(this.residues.hasOwnProperty(n.structure+"_"+n.chain+"_"+n.resi)&&"C"!==n.elem){var r={};r.position=n.coord,r.bSchematic=1,r.text=n.elem,r.size=18,r.color="#"+n.color.getHexString(),r.background="#FFFFFF",this.labels.schematic.push(r)}}this.removeHlObjects()},iCn3D.prototype.addResiudeLabels=function(e,t,i){void 0===i&&(i=1);var n=this.intHash(this.hAtoms,e);t?void 0===this.labels.schematic&&(this.labels.schematic=[]):void 0===this.labels.residue&&(this.labels.residue=[]);var r="";for(var o in n){var s=this.atoms[o],a={},c=s.structure+"_"+s.chain+"_"+s.resi;if(!s.het&&("CA"===s.name||"O3'"===s.name||"O3*"===s.name)||this.water.hasOwnProperty(s.serial)||this.ions.hasOwnProperty(s.serial)||this.chemicals.hasOwnProperty(s.serial)&&c!==r){a.position=s.coord,a.bSchematic=0,t&&(a.bSchematic=1),a.text=this.residueName2Abbr(s.resn),a.size=18;var l=s.color.getHexString().toUpperCase();a.color="CCCCCC"===l||"C8C8C8"===l?"#888888":"#"+l,a.background="#CCCCCC",t?this.labels.schematic.push(a):this.labels.residue.push(a)}r=c}this.removeHlObjects()},iCn3D.prototype.setCenter=function(e){this.mdl.position.set(0,0,0),this.mdlImpostor.position.set(0,0,0),this.mdl_ghost.position.set(0,0,0),this.mdl.position.sub(e),this.mdlImpostor.position.sub(e),this.mdl_ghost.position.sub(e)},iCn3D.prototype.getResiduesFromAtoms=function(e){var t={};for(var i in e)t[this.atoms[i].structure+"_"+this.atoms[i].chain+"_"+this.atoms[i].resi]=1;return t},iCn3D.prototype.getResiduesFromCalphaAtoms=function(e){var t={};for(var i in e)("CA"==this.atoms[i].name&&this.proteins.hasOwnProperty(i)||!this.proteins.hasOwnProperty(i))&&(t[this.atoms[i].structure+"_"+this.atoms[i].chain+"_"+this.atoms[i].resi]=1);return t},function(e){"use strict";var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,i=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),n=i&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),r=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,o=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,s=(i||r)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,s,a,c,l,d,h,u,p;if(!(t=e.match(o)))throw new Error("invalid data URI");for(s=t[2]?t[1]:"text/plain"+(t[3]||";charset=US-ASCII"),a=!!t[4],c=e.slice(t[0].length),l=a?atob(c):decodeURIComponent(c),d=new ArrayBuffer(l.length),h=new Uint8Array(d),u=0;u<l.length;u+=1)h[u]=l.charCodeAt(u);return i?new Blob([n?h:d],{type:s}):((p=new r).append(d),p.getBlob(s))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,i,n){var r=this;setTimeout(function(){e(n&&t.toDataURL&&s?s(r.toDataURL(i,n)):r.mozGetAsFile("blob",i))})}:t.toDataURL&&s&&(t.toBlob=function(e,t,i){var n=this;setTimeout(function(){e(s(n.toDataURL(t,i)))})})),"function"==typeof define&&define.amd?define(function(){return s}):"object"==typeof module&&module.exports?module.exports=s:e.dataURLtoBlob=s}(window);var saveAs=saveAs||function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=function(){return e.URL||e.webkitURL||e},i=e.document.createElementNS("http://www.w3.org/1999/xhtml","a"),n="download"in i,r=/constructor/i.test(e.HTMLElement)||e.safari,o=/CriOS\/[\d]+/.test(navigator.userAgent),s=e.setImmediate||e.setTimeout,a=function(e){s(function(){throw e},0)},c=function(e){setTimeout(function(){"string"==typeof e?t().revokeObjectURL(e):e.remove()},4e4)},l=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},d=function(d,h,u){u||(d=l(d));var p,m=this,f="application/octet-stream"===(d?d.type:void 0),g=function(){!function(e,t,i){for(var n=(t=[].concat(t)).length;n--;){var r=e["on"+t[n]];if("function"==typeof r)try{r.call(e,e)}catch(o){a(o)}}}(m,"writestart progress write writeend".split(" "))};if(m.readyState=m.INIT,n)return p||(p=t().createObjectURL(d)),void s(function(){var e,t;i.href=p,i.download=h,e=i,t=new MouseEvent("click"),e.dispatchEvent(t),g(),c(p),m.readyState=m.DONE},0);!function(){if((o||f&&r)&&e.FileReader){var i=new FileReader;return i.onloadend=function(){var t=o?i.result:i.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,m.readyState=m.DONE,g()},i.readAsDataURL(d),void(m.readyState=m.INIT)}p||(p=t().createObjectURL(d)),f?e.location.href=p:e.open(p,"_blank")||(e.location.href=p),m.readyState=m.DONE,g(),c(p)}()},h=d.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,i){return t=t||e.name||"download",i||(e=l(e)),navigator.msSaveOrOpenBlob(e,t)}:(h.abort=function(){},h.readyState=h.INIT=0,h.WRITING=1,h.DONE=2,h.error=h.onwritestart=h.onprogress=h.onwrite=h.onabort=h.onerror=h.onwriteend=null,function(e,t,i){return new d(e,t||e.name||"download",i)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this),$3Dmol=$3Dmol||{};$3Dmol.MarchingCubeInitializer=function(){var e={march:function(e,o,s,a){var c,l=!!a.fulltable,d=a.hasOwnProperty("origin")&&a.origin.hasOwnProperty("x")?a.origin:{x:0,y:0,z:0},h=!!a.voxel,u=a.matrix,p=a.nX||0,m=a.nY||0,f=a.nZ||0,g=a.scale||1;c=a.unitCube?a.unitCube:{x:g,y:g,z:g};var v,y,b=new Int32Array(p*m*f);for(v=0,y=b.length;v<y;++v)b[v]=-1;var _=function(e,t,i,n,r,s){var a={x:0,y:0,z:0},l=r;!(n&1<<r)&&!!(n&1<<s)&&(l=s),1&l&&i++,2&l&&t++,4&l&&e++,u?a={x:(a=(a=new $3Dmol.Vector3(e,t,i)).applyMatrix4(u)).x,y:a.y,z:a.z}:(a.x=d.x+c.x*e,a.y=d.y+c.y*t,a.z=d.z+c.z*i);var p=(m*e+t)*f+i;return h?(o.push(a),o.length-1):(b[p]<0&&(b[p]=o.length,o.push(a)),b[p])},w=new Int32Array(12),x=l?n:t,C=l?r:i;for(v=0;v<p-1;++v)for(var S=0;S<m-1;++S)for(var E=0;E<f-1;++E){for(var M=0,T=0;T<8;++T)M|=!!(2&e[(m*(v+((4&T)>>2))+S+((2&T)>>1))*f+E+(1&T)])<<T;if(0!==M&&255!==M){var A=x[M];if(0!==A){var k=C[M];1&A&&(w[0]=_(v,S,E,M,0,1)),2&A&&(w[1]=_(v,S,E,M,1,3)),4&A&&(w[2]=_(v,S,E,M,3,2)),8&A&&(w[3]=_(v,S,E,M,2,0)),16&A&&(w[4]=_(v,S,E,M,4,5)),32&A&&(w[5]=_(v,S,E,M,5,7)),64&A&&(w[6]=_(v,S,E,M,7,6)),128&A&&(w[7]=_(v,S,E,M,6,4)),256&A&&(w[8]=_(v,S,E,M,0,4)),512&A&&(w[9]=_(v,S,E,M,1,5)),1024&A&&(w[10]=_(v,S,E,M,3,7)),2048&A&&(w[11]=_(v,S,E,M,2,6));for(var R=0;R<k.length;R+=3){var D=w[k[R]],L=w[k[R+1]],I=w[k[R+2]];h&&R>=3&&(o.push(o[D]),D=o.length-1,o.push(o[L]),L=o.length-1,o.push(o[I]),I=o.length-1),s.push(D),s.push(L),s.push(I)}}}}},laplacianSmooth:function(e,t,i){var n,r,o,s,a,c=new Array(t.length);for(n=0,r=t.length;n<r;n++)c[n]={x:0,y:0,z:0};var l,d=new Array(20);for(n=0;n<20;n++)d[n]=new Array(t.length);for(n=0,r=t.length;n<r;n++)d[0][n]=0;for(n=0,r=i.length/3;n<r;n++){var h=3*n,u=3*n+1,p=3*n+2;for(l=!0,o=0,s=d[0][i[h]];o<s;o++)if(i[u]==d[o+1][i[h]]){l=!1;break}for(l&&(d[0][i[h]]++,d[d[0][i[h]]][i[h]]=i[u]),l=!0,o=0,s=d[0][i[h]];o<s;o++)if(i[p]==d[o+1][i[h]]){l=!1;break}for(l&&(d[0][i[h]]++,d[d[0][i[h]]][i[h]]=i[p]),l=!0,o=0,s=d[0][i[u]];o<s;o++)if(i[h]==d[o+1][i[u]]){l=!1;break}for(l&&(d[0][i[u]]++,d[d[0][i[u]]][i[u]]=i[h]),l=!0,o=0,s=d[0][i[u]];o<s;o++)if(i[p]==d[o+1][i[u]]){l=!1;break}for(l&&(d[0][i[u]]++,d[d[0][i[u]]][i[u]]=i[p]),l=!0,o=0;o<d[0][i[p]];o++)if(i[h]==d[o+1][i[p]]){l=!1;break}for(l&&(d[0][i[p]]++,d[d[0][i[p]]][i[p]]=i[h]),l=!0,o=0,s=d[0][i[p]];o<s;o++)if(i[u]==d[o+1][i[p]]){l=!1;break}l&&(d[0][i[p]]++,d[d[0][i[p]]][i[p]]=i[u])}for(a=0;a<e;a++){for(n=0,r=t.length;n<r;n++)if(d[0][n]<3)c[n].x=t[n].x,c[n].y=t[n].y,c[n].z=t[n].z;else if(3==d[0][n]||4==d[0][n]){for(c[n].x=0,c[n].y=0,c[n].z=0,o=0,s=d[0][n];o<s;o++)c[n].x+=t[d[o+1][n]].x,c[n].y+=t[d[o+1][n]].y,c[n].z+=t[d[o+1][n]].z;c[n].x+=.5*t[n].x,c[n].y+=.5*t[n].y,c[n].z+=.5*t[n].z,c[n].x/=.5+d[0][n],c[n].y/=.5+d[0][n],c[n].z/=.5+d[0][n]}else{for(c[n].x=0,c[n].y=0,c[n].z=0,o=0,s=d[0][n];o<s;o++)c[n].x+=t[d[o+1][n]].x,c[n].y+=t[d[o+1][n]].y,c[n].z+=t[d[o+1][n]].z;c[n].x+=1*t[n].x,c[n].y+=1*t[n].y,c[n].z+=1*t[n].z,c[n].x/=1+d[0][n],c[n].y/=1+d[0][n],c[n].z/=1+d[0][n]}for(n=0,r=t.length;n<r;n++)t[n].x=c[n].x,t[n].y=c[n].y,t[n].z=c[n].z}},edgeTable:[0,0,0,0,0,0,0,2816,0,0,0,1792,0,3328,3584,3840,0,0,0,138,0,21,0,134,0,0,0,652,0,2067,3865,3600,0,0,0,42,0,0,0,294,0,0,21,28,0,3875,1049,3360,0,168,162,170,0,645,2475,2210,0,687,293,172,4010,3747,3497,3232,0,0,0,0,0,69,0,900,0,0,0,1792,138,131,1608,1920,0,81,0,2074,84,85,84,86,0,81,0,3676,330,1105,1881,1616,0,0,0,42,0,69,0,502,0,0,21,3580,138,2035,1273,1520,2816,104,2337,106,840,581,367,102,2816,3695,3429,3180,1898,1635,1385,1120,0,0,0,0,0,0,0,3910,0,0,69,588,42,2083,41,2880,0,0,0,1722,0,2293,4095,3830,0,255,757,764,2538,2291,3065,2800,0,0,81,338,0,3925,1119,3414,84,855,85,340,2130,2899,89,2384,1792,712,194,1162,4036,3781,3535,3270,708,719,197,204,3018,2755,2505,2240,0,0,0,0,168,420,168,1958,162,162,676,2988,170,163,680,928,3328,3096,3328,3642,52,53,1855,1590,2340,2111,2869,2620,298,51,825,560,3584,3584,3090,3482,1668,1941,1183,1430,146,2975,2069,2460,154,915,153,400,3840,3592,3329,3082,1796,1541,1295,1030,2818,2575,2309,2060,778,515,265,0]},t=new Uint32Array(e.edgeTable),i=e.triTable=[[],[],[],[],[],[],[],[11,9,8],[],[],[],[8,10,9],[],[10,8,11],[9,11,10],[8,10,9,8,11,10],[],[],[],[1,7,3],[],[4,2,0],[],[2,1,7],[],[],[],[2,7,3,2,9,7],[],[1,4,11,1,0,4],[3,8,0,11,9,4,11,10,9],[4,11,9,11,10,9],[],[],[],[5,3,1],[],[],[],[2,5,8,2,1,5],[],[],[2,4,0],[3,2,4],[],[0,9,1,8,10,5,8,11,10],[3,4,0,3,10,4],[5,8,10,8,11,10],[],[3,5,7],[7,1,5],[1,7,3,1,5,7],[],[9,2,0,9,7,2],[0,3,8,1,7,11,1,5,7],[11,1,7,1,5,7],[],[9,1,0,5,3,2,5,7,3],[8,2,5,8,0,2],[2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[],[],[],[],[],[0,6,2],[],[7,2,9,7,9,8],[],[],[],[8,10,9],[7,1,3],[7,1,0],[6,9,3,6,10,9],[7,10,8,10,9,8],[],[6,0,4],[],[11,1,4,11,3,1],[2,4,6],[2,0,4,2,4,6],[2,4,6],[1,4,2,4,6,2],[],[6,0,4],[],[2,11,3,6,9,4,6,10,9],[8,6,1,8,1,3],[10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[],[],[],[5,3,1],[],[0,6,2],[],[7,4,8,5,2,1,5,6,2],[],[],[2,4,0],[7,4,8,2,11,3,10,5,6],[7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[9,11,8],[3,5,6],[0,5,11,0,11,8],[6,3,5,3,1,5],[3,9,6,3,8,9],[9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[],[],[],[],[],[],[],[1,10,2,9,11,6,9,8,11],[],[],[6,0,2],[3,6,9,3,2,6],[3,5,1],[0,5,1,0,11,5],[0,3,5],[6,9,11,9,8,11],[],[],[],[4,5,9,7,1,10,7,3,1],[],[11,6,7,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[],[],[0,6,4],[8,6,4,8,1,6],[],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[4,2,6],[1,0,9,2,4,8,2,6,4],[2,4,0,2,6,4],[8,2,4,2,6,4],[11,4,1,11,6,4],[0,9,1,4,11,6,4,8,11],[3,6,0,6,4,0],[8,6,4,8,11,6],[10,8,9],[6,3,9,6,7,3],[6,7,1],[10,7,1,7,3,1],[7,11,6,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2],[1,0,9,3,6,7,3,2,6],[7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[],[],[],[],[5,3,7],[8,5,2,8,7,5],[5,3,7],[1,10,2,5,8,7,5,9,8],[1,7,5],[1,7,5],[9,2,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[0,7,1,7,5,1],[9,3,5,3,7,5],[9,7,5,9,8,7],[8,10,11],[3,4,10,3,10,11],[8,10,11],[5,9,4,1,11,3,1,10,11],[2,4,5],[5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[2,8,5,2,11,8],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[11,9,10],[11,9,10],[1,11,4,1,10,11],[8,7,4,11,1,10,11,3,1],[2,7,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[1,7,4],[3,2,11,4,8,7,9,1,0],[11,4,2,4,0,2],[2,11,3,7,4,8],[4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[3,9,11,9,10,11],[0,10,8,10,11,8],[10,3,1,10,11,3],[2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]],n=[0,265,515,778,2060,2309,2575,2822,1030,1295,1541,1804,3082,3331,3593,3840,400,153,915,666,2460,2197,2975,2710,1430,1183,1941,1692,3482,3219,3993,3728,560,825,51,314,2620,2869,2111,2358,1590,1855,1077,1340,3642,3891,3129,3376,928,681,419,170,2988,2725,2479,2214,1958,1711,1445,1196,4010,3747,3497,3232,2240,2505,2755,3018,204,453,719,966,3270,3535,3781,4044,1226,1475,1737,1984,2384,2137,2899,2650,348,85,863,598,3414,3167,3925,3676,1370,1107,1881,1616,2800,3065,2291,2554,764,1013,255,502,3830,4095,3317,3580,1786,2035,1273,1520,2912,2665,2403,2154,876,613,367,102,3942,3695,3429,3180,1898,1635,1385,1120,1120,1385,1635,1898,3180,3429,3695,3942,102,367,613,876,2154,2403,2665,2912,1520,1273,2035,1786,3580,3317,4095,3830,502,255,1013,764,2554,2291,3065,2800,1616,1881,1107,1370,3676,3925,3167,3414,598,863,85,348,2650,2899,2137,2384,1984,1737,1475,1226,4044,3781,3535,3270,966,719,453,204,3018,2755,2505,2240,3232,3497,3747,4010,1196,1445,1711,1958,2214,2479,2725,2988,170,419,681,928,3376,3129,3891,3642,1340,1077,1855,1590,2358,2111,2869,2620,314,51,825,560,3728,3993,3219,3482,1692,1941,1183,1430,2710,2975,2197,2460,666,915,153,400,3840,3593,3331,3082,1804,1541,1295,1030,2822,2575,2309,2060,778,515,265,0],r=[[],[8,3,0],[9,0,1],[8,3,1,8,1,9],[11,2,3],[11,2,0,11,0,8],[11,2,3,0,1,9],[2,1,11,1,9,11,11,9,8],[10,1,2],[8,3,0,1,2,10],[9,0,2,9,2,10],[3,2,8,2,10,8,8,10,9],[10,1,3,10,3,11],[1,0,10,0,8,10,10,8,11],[0,3,9,3,11,9,9,11,10],[8,10,9,8,11,10],[8,4,7],[3,0,4,3,4,7],[1,9,0,8,4,7],[9,4,1,4,7,1,1,7,3],[2,3,11,7,8,4],[7,11,4,11,2,4,4,2,0],[3,11,2,4,7,8,9,0,1],[2,7,11,2,1,7,1,4,7,1,9,4],[10,1,2,8,4,7],[2,10,1,0,4,7,0,7,3],[4,7,8,0,2,10,0,10,9],[2,7,3,2,9,7,7,9,4,2,10,9],[8,4,7,11,10,1,11,1,3],[11,4,7,1,4,11,1,11,10,1,0,4],[3,8,0,7,11,4,11,9,4,11,10,9],[7,11,4,4,11,9,11,10,9],[9,5,4],[3,0,8,4,9,5],[5,4,0,5,0,1],[4,8,5,8,3,5,5,3,1],[11,2,3,9,5,4],[9,5,4,8,11,2,8,2,0],[3,11,2,1,5,4,1,4,0],[8,5,4,2,5,8,2,8,11,2,1,5],[2,10,1,9,5,4],[0,8,3,5,4,9,10,1,2],[10,5,2,5,4,2,2,4,0],[3,4,8,3,2,4,2,5,4,2,10,5],[5,4,9,1,3,11,1,11,10],[0,9,1,4,8,5,8,10,5,8,11,10],[3,4,0,3,10,4,4,10,5,3,11,10],[4,8,5,5,8,10,8,11,10],[9,5,7,9,7,8],[0,9,3,9,5,3,3,5,7],[8,0,7,0,1,7,7,1,5],[1,7,3,1,5,7],[11,2,3,8,9,5,8,5,7],[9,2,0,9,7,2,2,7,11,9,5,7],[0,3,8,2,1,11,1,7,11,1,5,7],[2,1,11,11,1,7,1,5,7],[1,2,10,5,7,8,5,8,9],[9,1,0,10,5,2,5,3,2,5,7,3],[5,2,10,8,2,5,8,5,7,8,0,2],[10,5,2,2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[11,7,6],[0,8,3,11,7,6],[9,0,1,11,7,6],[7,6,11,3,1,9,3,9,8],[2,3,7,2,7,6],[8,7,0,7,6,0,0,6,2],[1,9,0,3,7,6,3,6,2],[7,6,2,7,2,9,2,1,9,7,9,8],[1,2,10,6,11,7],[2,10,1,7,6,11,8,3,0],[11,7,6,10,9,0,10,0,2],[7,6,11,3,2,8,8,2,10,8,10,9],[6,10,7,10,1,7,7,1,3],[6,10,1,6,1,7,7,1,0,7,0,8],[9,0,3,6,9,3,6,10,9,6,3,7],[6,10,7,7,10,8,10,9,8],[8,4,6,8,6,11],[11,3,6,3,0,6,6,0,4],[0,1,9,4,6,11,4,11,8],[1,9,4,11,1,4,11,3,1,11,4,6],[3,8,2,8,4,2,2,4,6],[2,0,4,2,4,6],[1,9,0,3,8,2,2,8,4,2,4,6],[9,4,1,1,4,2,4,6,2],[10,1,2,11,8,4,11,4,6],[10,1,2,11,3,6,6,3,0,6,0,4],[0,2,10,0,10,9,4,11,8,4,6,11],[2,11,3,6,9,4,6,10,9],[8,4,6,8,6,1,6,10,1,8,1,3],[1,0,10,10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[9,5,4,7,6,11],[4,9,5,3,0,8,11,7,6],[6,11,7,4,0,1,4,1,5],[6,11,7,4,8,5,5,8,3,5,3,1],[4,9,5,6,2,3,6,3,7],[9,5,4,8,7,0,0,7,6,0,6,2],[4,0,1,4,1,5,6,3,7,6,2,3],[7,4,8,5,2,1,5,6,2],[6,11,7,1,2,10,9,5,4],[11,7,6,8,3,0,1,2,10,9,5,4],[11,7,6,10,5,2,2,5,4,2,4,0],[7,4,8,2,11,3,10,5,6],[4,9,5,6,10,7,7,10,1,7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[5,6,9,6,11,9,9,11,8],[0,9,5,0,5,3,3,5,6,3,6,11],[0,1,5,0,5,11,5,6,11,0,11,8],[11,3,6,6,3,5,3,1,5],[9,5,6,3,9,6,3,8,9,3,6,2],[5,6,9,9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[1,2,10,5,6,9,9,6,11,9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[10,6,5],[8,3,0,10,6,5],[0,1,9,5,10,6],[10,6,5,9,8,3,9,3,1],[3,11,2,10,6,5],[6,5,10,2,0,8,2,8,11],[1,9,0,6,5,10,11,2,3],[1,10,2,5,9,6,9,11,6,9,8,11],[1,2,6,1,6,5],[0,8,3,2,6,5,2,5,1],[5,9,6,9,0,6,6,0,2],[9,6,5,3,6,9,3,9,8,3,2,6],[11,6,3,6,5,3,3,5,1],[0,5,1,0,11,5,5,11,6,0,8,11],[0,5,9,0,3,5,3,6,5,3,11,6],[5,9,6,6,9,11,9,8,11],[10,6,5,4,7,8],[5,10,6,7,3,0,7,0,4],[5,10,6,0,1,9,8,4,7],[4,5,9,6,7,10,7,1,10,7,3,1],[7,8,4,2,3,11,10,6,5],[11,6,7,10,2,5,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[7,8,4,5,1,2,5,2,6],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,8,0,7,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,4,5,8,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[10,6,4,10,4,9],[8,3,0,9,10,6,9,6,4],[1,10,0,10,6,0,0,6,4],[8,6,4,8,1,6,6,1,10,8,3,1],[2,3,11,6,4,9,6,9,10],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,11,6,3,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[9,1,4,1,2,4,4,2,6],[1,0,9,3,2,8,2,4,8,2,6,4],[2,4,0,2,6,4],[3,2,8,8,2,4,2,6,4],[1,4,9,11,4,1,11,1,3,11,6,4],[0,9,1,4,11,6,4,8,11],[11,6,3,3,6,0,6,4,0],[8,6,4,8,11,6],[6,7,10,7,8,10,10,8,9],[9,3,0,6,3,9,6,9,10,6,7,3],[6,1,10,6,7,1,7,0,1,7,8,0],[6,7,10,10,7,1,7,3,1],[7,11,6,3,8,2,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2,2,9,1,7,8,9],[1,0,9,3,6,7,3,2,6],[8,0,7,7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[11,7,5,11,5,10],[3,0,8,7,5,10,7,10,11],[9,0,1,10,11,7,10,7,5],[3,1,9,3,9,8,7,10,11,7,5,10],[10,2,5,2,3,5,5,3,7],[5,10,2,8,5,2,8,7,5,8,2,0],[9,0,1,10,2,5,5,2,3,5,3,7],[1,10,2,5,8,7,5,9,8],[2,11,1,11,7,1,1,7,5],[0,8,3,2,11,1,1,11,7,1,7,5],[9,0,2,9,2,7,2,11,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[8,7,0,0,7,1,7,5,1],[0,3,9,9,3,5,3,7,5],[9,7,5,9,8,7],[4,5,8,5,10,8,8,10,11],[3,0,4,3,4,10,4,5,10,3,10,11],[0,1,9,4,5,8,8,5,10,8,10,11],[5,9,4,1,11,3,1,10,11],[3,8,4,3,4,2,2,4,5,2,5,10],[10,2,5,5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[8,4,5,2,8,5,2,11,8,2,5,1],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[4,5,8,8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[7,4,11,4,9,11,11,9,10],[3,0,8,7,4,11,11,4,9,11,9,10],[11,7,4,1,11,4,1,10,11,1,4,0],[8,7,4,11,1,10,11,3,1],[2,3,7,2,7,9,7,4,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[2,11,7,2,7,1,1,7,4,1,4,9],[3,2,11,4,8,7,9,1,0],[7,4,11,11,4,2,4,0,2],[2,11,3,7,4,8],[9,1,4,4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[0,9,3,3,9,11,9,10,11],[1,10,0,0,10,8,10,11,8],[10,3,1,10,11,3],[3,8,2,2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[2,11,1,1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]];return e},$3Dmol.MarchingCube=$3Dmol.MarchingCubeInitializer(),"undefined"==typeof console&&(console={log:function(){}}),$3Dmol.ProteinSurface=function(e){var t,n,r=0,o=0,s=0,a=2,c=0,l=0,d=0,h=0,u=null,p=null,m=null,f=0,g=0,v=0,y=0,b=0,_=0,w={H:1.2,Li:1.82,Na:2.27,K:2.75,C:1.7,N:1.55,O:1.52,F:1.47,P:1.8,S:1.8,CL:1.75,BR:1.85,SE:1.9,ZN:1.39,CU:1.4,NI:1.63,X:2},x=function(e){return e.elem&&void 0!==w[e.elem]?e.elem:"X"},C={},S={},E=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])];this.getFacesAndVertices=function(e){var i,c,l={};for(i=0,c=e.length;i<c;i++)l[e[i]]=1;var d=n;for(i=0,c=d.length;i<c;i++)d[i].x=d[i].x/a-r,d[i].y=d[i].y/a-o,d[i].z=d[i].z/a-s;var h=[];for(i=0,c=t.length;i<c;i+=3){var f=t[i],g=t[i+1],v=t[i+2],y=d[g].atomid,b=d[v].atomid,_=d[f].atomid;y<_&&(_=y),b<_&&(_=b),l[_]&&f!==g&&g!==v&&f!==v&&h.push({a:f,b:g,c:v})}return u=null,p=null,m=null,{vertices:d,faces:h}},this.initparm=function(t,i,n){var w=1/a*5.5;f=t[0][0],y=t[1][0],g=t[0][1],b=t[1][1],v=t[0][2],_=t[1][2],i?(f-=1.4+w,g-=1.4+w,v-=1.4+w,y+=1.4+w,b+=1.4+w,_+=1.4+w):(f-=w,g-=w,v-=w,y+=w,b+=w,_+=w),f=Math.floor(f*a)/a,g=Math.floor(g*a)/a,v=Math.floor(v*a)/a,y=Math.ceil(y*a)/a,b=Math.ceil(b*a)/a,_=Math.ceil(_*a)/a,r=-f,o=-g,s=-v;var x=128;if(b-g>(a=y-f)&&(a=b-g),_-v>a&&(a=_-v),a=(x-1)/a,x=Math.floor(2*x/a),a=2,x>e){var C=e/x;x=Math.floor(e),a*=C}d=Math.ceil(a*(y-f))+1,l=Math.ceil(a*(b-g))+1,c=Math.ceil(a*(_-v))+1,this.boundingatom(i),h=1.4*a,u=new Uint8Array(d*l*c),p=new Float64Array(d*l*c),m=new Int32Array(d*l*c)},this.boundingatom=function(e){var t,i,n,r=[];for(var o in flagradius=e,w)if(w.hasOwnProperty(o)){var s=w[o];for(r[o]=e?(s+1.4)*a+.5:s*a+.5,n=r[o]*r[o],S[o]=Math.floor(r[o])+1,C[o]=new Int32Array(S[o]*S[o]),indx=0,j=0;j<S[o];j++)for(k=0;k<S[o];k++)(t=j*j+k*k)>n?C[o][indx]=-1:(i=Math.sqrt(n-t),C[o][indx]=Math.floor(i)),indx++}},this.fillvoxels=function(e,t){var i,n;for(i=0,n=u.length;i<n;i++)u[i]=0,p[i]=-1,m[i]=-1;for(i in t){var r=e[t[i]];void 0!==r&&this.fillAtom(r,e)}for(i=0,n=u.length;i<n;i++)1&u[i]&&(u[i]|=2)},this.fillAtom=function(e,t){var i,n,h,p,f,g,v,y,b,_,w,E,M,T,A,k,R,D,L;i=Math.floor(.5+a*(e.coord.x+r)),n=Math.floor(.5+a*(e.coord.y+o)),h=Math.floor(.5+a*(e.coord.z+s));var I=x(e),O=0,P=l*c;for(_=0,L=S[I];_<L;_++)for(w=0;w<L;w++){if(-1!=C[I][O])for(k=-1;k<2;k++)for(R=-1;R<2;R++)for(D=-1;D<2;D++)if(0!==k&&0!==R&&0!==D)for(v=k*_,b=D*w,E=0;E<=C[I][O];E++)if(T=n+(y=E*R),A=h+b,!((M=i+v)<0||T<0||A<0||M>=d||T>=l||A>=c)){var H=M*P+T*c+A;if(1&u[H]){var N=t[m[H]];N.serial!=e.serial&&v*v+y*y+b*b<(p=i+v-Math.floor(.5+a*(N.x+r)))*p+(f=n+y-Math.floor(.5+a*(N.y+o)))*f+(g=h+b-Math.floor(.5+a*(N.z+s)))*g&&(m[H]=e.serial)}else u[H]|=1,m[H]=e.serial}O++}},this.fillvoxelswaals=function(e,t){var i,n;for(i=0,n=u.length;i<n;i++)u[i]&=-3;for(i in t){var r=e[t[i]];void 0!==r&&this.fillAtomWaals(r,e)}},this.fillAtomWaals=function(e,t){var i,n,h,p,f,g,v,y,b,_,w,E,M,T,A,k,R,D,L,I=0;i=Math.floor(.5+a*(e.coord.x+r)),n=Math.floor(.5+a*(e.coord.y+o)),h=Math.floor(.5+a*(e.coord.z+s));var O=x(e),P=l*c;for(M=0,L=S[O];M<L;M++)for(T=0;T<L;T++){if(-1!=C[O][I])for(k=-1;k<2;k++)for(R=-1;R<2;R++)for(D=-1;D<2;D++)if(0!==k&&0!==R&&0!==D)for(v=k*M,b=D*T,A=0;A<=C[O][I];A++)if(w=n+(y=A*R),E=h+b,!((_=i+v)<0||w<0||E<0||_>=d||w>=l||E>=c)){var H=_*P+w*c+E;if(2&u[H]){var N=t[m[H]];N.serial!=e.serial&&v*v+y*y+b*b<(p=i+v-Math.floor(.5+a*(N.x+r)))*p+(f=n+y-Math.floor(.5+a*(N.y+o)))*f+(g=h+b-Math.floor(.5+a*(N.z+s)))*g&&(m[H]=e.serial)}else u[H]|=2,m[H]=e.serial}I++}},this.buildboundary=function(){var e=l*c;for(i=0;i<d;i++)for(j=0;j<c;j++)for(k=0;k<l;k++){var t=i*e+k*c+j;if(1&u[t])for(var n=0;n<26;){var r=i+E[n][0],o=j+E[n][2],s=k+E[n][1];if(r>-1&&r<d&&s>-1&&s<l&&o>-1&&o<c&&!(1&u[r*e+s*c+o])){u[t]|=4;break}n++}}};var M=function(e,t,i){var n=new Int32Array(e*t*i*3);this.set=function(e,r,o,s){var a=3*((e*t+r)*i+o);n[a]=s.ix,n[a+1]=s.iy,n[a+2]=s.iz},this.get=function(e,r,o){var s=3*((e*t+r)*i+o);return{ix:n[s],iy:n[s+1],iz:n[s+2]}}};this.fastdistancemap=function(){var e,t,i,n,r,o=new M(d,l,c),s=l*c,m=h*h,f=[],g=[];for(e=0;e<d;e++)for(t=0;t<l;t++)for(i=0;i<c;i++)if(u[r=e*s+t*c+i]&=-3,1&u[r]&&4&u[r]){var v={ix:e,iy:t,iz:i};o.set(e,t,i,v),f.push(v),p[r]=0,u[r]|=2,u[r]&=-5}do{for(g=this.fastoneshell(f,o),f=[],e=0,n=g.length;e<n;e++)u[r=s*g[e].ix+c*g[e].iy+g[e].iz]&=-5,p[r]<=1.0404*m&&f.push({ix:g[e].ix,iy:g[e].iy,iz:g[e].iz})}while(0!==f.length);f=[],g=[],o=null;var y=a-.5;y<0&&(y=0);var b=m-.5/(.1+y);for(e=0;e<d;e++)for(t=0;t<l;t++)for(i=0;i<c;i++)u[r=e*s+t*c+i]&=-5,1&u[r]&&(2&u[r]&&!(2&u[r]&&p[r]>=b)||(u[r]|=4))},this.fastoneshell=function(e,t){var i,n,r,o,s,a,h,m,f,g,v,y,b=[];if(0===e.length)return b;tnv={ix:-1,iy:-1,iz:-1};var _=l*c;for(h=0,f=e.length;h<f;h++)for(v=t.get(i=e[h].ix,n=e[h].iy,r=e[h].iz),m=0;m<6;m++)tnv.ix=i+E[m][0],tnv.iy=n+E[m][1],tnv.iz=r+E[m][2],tnv.ix<d&&tnv.ix>-1&&tnv.iy<l&&tnv.iy>-1&&tnv.iz<c&&tnv.iz>-1&&(y=tnv.ix*_+c*tnv.iy+tnv.iz,1&u[y]&&!(2&u[y])?(t.set(tnv.ix,tnv.iy,r+E[m][2],v),o=tnv.ix-v.ix,s=tnv.iy-v.iy,a=tnv.iz-v.iz,p[y]=g=o*o+s*s+a*a,u[y]|=2,u[y]|=4,b.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):1&u[y]&&2&u[y]&&(g=(o=tnv.ix-v.ix)*o+(s=tnv.iy-v.iy)*s+(a=tnv.iz-v.iz)*a)<p[y]&&(t.set(tnv.ix,tnv.iy,tnv.iz,v),p[y]=g,4&u[y]||(u[y]|=4,b.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz}))));for(h=0,f=e.length;h<f;h++)for(v=t.get(i=e[h].ix,n=e[h].iy,r=e[h].iz),m=6;m<18;m++)tnv.ix=i+E[m][0],tnv.iy=n+E[m][1],tnv.iz=r+E[m][2],tnv.ix<d&&tnv.ix>-1&&tnv.iy<l&&tnv.iy>-1&&tnv.iz<c&&tnv.iz>-1&&(y=tnv.ix*_+c*tnv.iy+tnv.iz,1&u[y]&&!(2&u[y])?(t.set(tnv.ix,tnv.iy,r+E[m][2],v),o=tnv.ix-v.ix,s=tnv.iy-v.iy,a=tnv.iz-v.iz,p[y]=g=o*o+s*s+a*a,u[y]|=2,u[y]|=4,b.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):1&u[y]&&2&u[y]&&(g=(o=tnv.ix-v.ix)*o+(s=tnv.iy-v.iy)*s+(a=tnv.iz-v.iz)*a)<p[y]&&(t.set(tnv.ix,tnv.iy,tnv.iz,v),p[y]=g,4&u[y]||(u[y]|=4,b.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz}))));for(h=0,f=e.length;h<f;h++)for(v=t.get(i=e[h].ix,n=e[h].iy,r=e[h].iz),m=18;m<26;m++)tnv.ix=i+E[m][0],tnv.iy=n+E[m][1],tnv.iz=r+E[m][2],tnv.ix<d&&tnv.ix>-1&&tnv.iy<l&&tnv.iy>-1&&tnv.iz<c&&tnv.iz>-1&&(y=tnv.ix*_+c*tnv.iy+tnv.iz,1&u[y]&&!(2&u[y])?(t.set(tnv.ix,tnv.iy,r+E[m][2],v),o=tnv.ix-v.ix,s=tnv.iy-v.iy,a=tnv.iz-v.iz,p[y]=g=o*o+s*s+a*a,u[y]|=2,u[y]|=4,b.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):1&u[y]&&2&u[y]&&(g=(o=tnv.ix-v.ix)*o+(s=tnv.iy-v.iy)*s+(a=tnv.iz-v.iz)*a)<p[y]&&(t.set(tnv.ix,tnv.iy,tnv.iz,v),p[y]=g,4&u[y]||(u[y]|=4,b.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz}))));return b},this.marchingcubeinit=function(e){for(var t=0,i=u.length;t<i;t++)1==e?u[t]&=-5:4==e?(u[t]&=-3,4&u[t]&&(u[t]|=2),u[t]&=-5):2==e?4&u[t]&&2&u[t]?u[t]&=-5:4&u[t]&&!(2&u[t])&&(u[t]|=2):3==e&&(u[t]&=-5)},this.marchingcube=function(e){this.marchingcubeinit(e),$3Dmol.MarchingCube.march(u,n=[],t=[],{smooth:1,nX:d,nY:l,nZ:c});for(var i=l*c,r=0,o=n.length;r<o;r++)n[r].atomid=m[n[r].x*i+c*n[r].y+n[r].z];$3Dmol.MarchingCube.laplacianSmooth(1,n,t)}},$3Dmol.SetupSurface=function(e){var t=new $3Dmol.ProteinSurface(e.threshbox);t.initparm(e.extent,1!==e.type),t.fillvoxels(e.allatoms,e.extendedAtoms),t.buildboundary(),2===e.type&&(t.fastdistancemap(),t.boundingatom(!1),t.fillvoxelswaals(e.allatoms,e.extendedAtoms)),t.marchingcube(),t.vpBits=null,t.vpDistance=null,t.vpAtomID=null;var i=t.getFacesAndVertices(e.atomsToShow);return t.faces=null,t.verts=null,i},"undefined"==typeof console&&(console={log:function(){}}),$3Dmol.ElectronMap=function(e){var t,n,r,o,s,a=1.5,c={},l=0,d=0,h=0,u=2,p=0,m=0,f=0,g=null,v=null,y=0,b=0,_=0,w=0,x=0,C=0,S=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])];this.getFacesAndVertices=function(e,i){var n,r,a={};for(n=0,r=i.length;n<r;n++)a[i[n]]=1;var c=s;for(n=0,r=c.length;n<r;n++){var p=new THREE.Vector3(c[n].x,c[n].y,c[n].z).applyMatrix4(t);c[n].x=p.x/u-l,c[n].y=p.y/u-d,c[n].z=p.z/u-h}var m=[];for(n=0,r=o.length;n<r;n+=3){var f=o[n],y=o[n+1],b=o[n+2];f!==y&&y!==b&&f!==b&&m.push({a:f,b:y,c:b})}return g=null,v=null,{vertices:c,faces:m}},this.initparm=function(e,i,o,s,S,E,M,T,A,k){a=void 0!==(n=e).max?n.min+(n.max-n.min)*s/100:void 0!==n.mean?n.mean+n.sigma*s:s,c=i,t=o,maxdist=E,r=k,l=-(y=0),d=-(b=0),h=-(_=0);var R=(w=n.xExtent-1)-y;(x=n.yExtent-1)-b>R&&(R=x-b),(C=n.zExtent-1)-_>R&&(R=C-_),u=1,boxLength=R,f=Math.ceil(u*(w-y))+1,m=Math.ceil(u*(x-b))+1,p=Math.ceil(u*(C-_))+1,g=new Uint8Array(f*m*p),v=new Uint8Array(f*m*p)},this.fillvoxels=function(e,i){var o,s,l,d;for(o=0,d=g.length;o<d;o++)g[o]=0,v[o]=0;var h=(new THREE.Matrix4).getInverse(t),u=[];maxdist=parseInt(maxdist);var f=m*p;for(var y in i){var b=e[i[y]],_=new THREE.Vector3(b.coord.x,b.coord.y,b.coord.z).applyMatrix4(h);for(o=Math.floor(_.x)-maxdist,d=Math.ceil(_.x)+maxdist;o<=d;++o)if(!(o<0||o>n.xExtent-1))for(s=Math.floor(_.y)-maxdist,jl=Math.ceil(_.y)+maxdist;s<=jl;++s)if(!(s<0||s>n.yExtent-1))for(l=Math.floor(_.z)-maxdist,kl=Math.ceil(_.z)+maxdist;l<=kl;++l)l<0||l>n.zExtent-1||u.push(w=o*f+s*p+l)}for(o=0,d=u.length;o<d;++o){var w=u[o];"2fofc"==r?g[w]=c[w]>=a?1:0:"fofc"==r?(g[w]=c[w]>=a||c[w]<=-a?1:0,v[w]=c[w]>=0?1:0):"em"==r&&(g[w]=c[w]>=a?1:0)}for(o=0,d=g.length;o<d;o++)1&g[o]&&(g[o]|=2)},this.buildboundary=function(){var e=m*p;for(i=0;i<f;i++)for(j=0;j<p;j++)for(k=0;k<m;k++){var t=i*e+k*p+j;if(1&g[t])for(var n=0;n<26;){var r=i+S[n][0],o=j+S[n][2],s=k+S[n][1];if(r>-1&&r<f&&s>-1&&s<m&&o>-1&&o<p&&!(1&g[r*e+s*p+o])){g[t]|=4;break}n++}}},this.marchingcubeinit=function(e){for(var t=0,i=g.length;t<i;t++)1==e?g[t]&=-5:4==e?(g[t]&=-3,4&g[t]&&(g[t]|=2),g[t]&=-5):2==e?4&g[t]&&2&g[t]?g[t]&=-5:4&g[t]&&!(2&g[t])&&(g[t]|=2):g[t]&=-5},this.marchingcube=function(e){this.marchingcubeinit(e),$3Dmol.MarchingCube.march(g,s=[],o=[],{smooth:1,nX:f,nY:m,nZ:p});for(var t=m*p,i=0,n=s.length;i<n;i++)s[i].atomid=v[s[i].x*t+p*s[i].y+s[i].z];$3Dmol.MarchingCube.laplacianSmooth(1,s,o)}},$3Dmol.SetupMap=function(e){var t=new $3Dmol.ElectronMap;t.initparm(e.header,e.data,e.matrix,e.isovalue,e.center,e.maxdist,e.pmin,e.pmax,e.water,e.type),t.fillvoxels(e.allatoms,e.extendedAtoms),t.buildboundary(),t.marchingcube(),t.vpBits=null,t.vpAtomID=null;var i=t.getFacesAndVertices(e.allatoms,e.atomsToShow);return t.faces=null,t.verts=null,i},iCn3D.prototype.createSurfaceRepresentation=function(e,t,i,n){var r=this;if(0!=Object.keys(e).length){var o;null==n&&(n=1),this.opacity=n;var s,a=this.getExtent(e);s=this.bConsiderNeighbors?Object.keys(this.unionHash(e,this.getAtomsWithinAtom(this.atoms,e,5))):Object.keys(e);var c,l=1,d=!(10==parseInt(10*n)||i||this.bInstanced&&Object.keys(this.atoms).length*this.biomtMatrices.length>this.maxatomcnt);11==t?c=$3Dmol.SetupMap({allatoms:this.atoms,atomsToShow:Object.keys(e),extendedAtoms:s,water:this.water,header:r.mapData.header2,data:r.mapData.data2,matrix:r.mapData.matrix2,isovalue:r.mapData.sigma2,center:this.center,maxdist:l,pmin:this.pmin,pmax:this.pmax,type:"2fofc"}):12==t?c=$3Dmol.SetupMap({allatoms:this.atoms,atomsToShow:Object.keys(e),extendedAtoms:s,water:this.water,header:r.mapData.header,data:r.mapData.data,matrix:r.mapData.matrix,isovalue:r.mapData.sigma,center:this.center,maxdist:l,pmin:this.pmin,pmax:this.pmax,type:"fofc"}):13==t?(l=3,c=$3Dmol.SetupMap({allatoms:this.atoms,atomsToShow:Object.keys(e),extendedAtoms:s,water:this.water,header:r.mapData.headerEm,data:r.mapData.dataEm,matrix:r.mapData.matrixEm,isovalue:r.mapData.sigmaEm,center:this.center,maxdist:l,pmin:this.pmin,pmax:this.pmax,type:"em"})):c=$3Dmol.SetupSurface({extent:a,allatoms:this.atoms,atomsToShow:Object.keys(e),extendedAtoms:s,type:t,threshbox:d?60:this.threshbox});var h=c.vertices,u=c.faces,p=new THREE.Color("#00FFFF"),m=new THREE.Color("#00FF00"),f=new THREE.Color("#ff0000"),g=new THREE.Color("#00FFFF");(o=new THREE.Geometry).vertices=h.map(function(e){var t=new THREE.Vector3(e.x,e.y,e.z);return t.atomid=e.atomid,t}),o.faces=u.map(function(e){var i=["a","b","c"].map(function(i){return 11==t?p:12==t?o.vertices[e[i]].atomid?m:f:13==t?g:r.atoms[o.vertices[e[i]].atomid].color});return new THREE.Face3(e.a,e.b,e.c,void 0,i)}),o.computeVertexNormals(!0),o.colorsNeedUpdate=!0,o.normalsNeedUpdate=!0,o.type="Surface";var v=JSON.parse(JSON.stringify(o)).data.normals;if(d){for(var y={},b=0,_=u.length;b<_;++b){var w=u[b].b,x=u[b].c;void 0===y[C=u[b].a]&&(y[C]=[]),y[C].push(w),y[C].push(x)}for(var C in y){var S=new THREE.Geometry;S.vertices=[],S.faces=[];var E=y[C];for(b=0,_=E.length;b<_;b+=2){w=E[b],x=E[b+1],S.vertices.push(new THREE.Vector3(h[C].x,h[C].y,h[C].z)),S.vertices.push(new THREE.Vector3(h[w].x,h[w].y,h[w].z)),S.vertices.push(new THREE.Vector3(h[x].x,h[x].y,h[x].z));var M=[];M.push(r.atoms[h[C].atomid].color),M.push(r.atoms[h[w].atomid].color),M.push(r.atoms[h[x].atomid].color);var T=[];T.push(v[C]),T.push(v[w]),T.push(v[x]);var A=b/2*3;S.faces.push(new THREE.Face3(A,A+1,A+2,T,M))}S.colorsNeedUpdate=!0,S.type="Surface";var k=new THREE.Mesh(S,new THREE.MeshPhongMaterial({specular:this.frac,shininess:10,emissive:0,vertexColors:THREE.VertexColors,wireframe:i,opacity:n,transparent:!0,side:THREE.DoubleSide})),R=new THREE.Vector3(0,0,0);for(b=0,_=k.geometry.vertices.length;b<_;++b)R=R.add(k.geometry.vertices[b]);var D=R.multiplyScalar(1/k.geometry.vertices.length).sub(r.oriCenter).applyMatrix4(r.cam.matrixWorldInverse);k.renderOrder=r.cam_z>0?-parseInt(D.z):parseInt(D.z),k.onBeforeRender=function(e,t,i,n,o,s){for(var a=new THREE.Vector3(0,0,0),c=0,l=this.geometry.vertices.length;c<l;++c)a=a.add(this.geometry.vertices[c]);var d=a.multiplyScalar(1/this.geometry.vertices.length).sub(r.oriCenter).applyMatrix4(r.cam.matrixWorldInverse);this.renderOrder=r.cam_z>0?-parseInt(d.z):parseInt(d.z)},r.mdl.add(k),11==t||12==t?this.prevMaps.push(k):13==t?this.prevEmmaps.push(k):this.prevSurfaces.push(k)}}else(k=new THREE.Mesh(o,new THREE.MeshPhongMaterial({specular:this.frac,shininess:10,emissive:0,vertexColors:THREE.VertexColors,wireframe:i,opacity:n,transparent:!0,side:THREE.DoubleSide}))).renderOrder=0,r.mdl.add(k),11==t||12==t?this.prevMaps.push(k):13==t?this.prevEmmaps.push(k):this.prevSurfaces.push(k);c=null,h=null,u=null,o=null}},iCn3D.prototype.buildAxes=function(e){var t=new THREE.Object3D;t.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0+e,0,0),16711680,!1,.5)),t.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0-e,0,0),8388608,!0,.5)),t.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0+e,0),65280,!1,.5)),t.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0-e,0),32768,!0,.5)),t.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,0+e),255,!1,.5)),t.add(this.createSingleLine(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,0-e),128,!0,.5)),this.scene.add(t)},iCn3D.prototype.createLines=function(e){if(void 0!==e)for(var t in e)for(var i=e[t],n=0,r=i.length;n<r;++n){var o=i[n],s=o.position1,a=o.position2,c=!!o.dashed&&o.dashed,l=this.lineRadius,d="#"+o.color.replace(/\#/g,""),h=new THREE.Color(d);if(c)for(var u,p,m=s.distanceTo(a),f=parseInt(m/.3),g=a.clone().sub(s).multiplyScalar(.3/m),v=0;v<f;++v)v%2==1&&(u=s.clone().add(g.clone().multiplyScalar(v)),p=s.clone().add(g.clone().multiplyScalar(v+1)),"stabilizer"==t?this.createBrick(u,p,l,h):this.createCylinder(u,p,l,h));else"stabilizer"==t?this.createBrick(s,a,l,h):this.createCylinder(s,a,l,h)}},iCn3D.prototype.createBrick=function(e,t,i,n){var r=new THREE.CylinderGeometry(1,1,1,4,1),o=new THREE.Mesh(r,new THREE.MeshPhongMaterial({specular:this.frac,shininess:30,emissive:0,color:n}));o.position.copy(e).add(t).multiplyScalar(.5),o.matrixAutoUpdate=!1,o.lookAt(t.clone().sub(e)),o.updateMatrix(),o.matrix.multiply((new THREE.Matrix4).makeScale(i,i,e.distanceTo(t))).multiply((new THREE.Matrix4).makeRotationX(.5*Math.PI)),this.mdl.add(o)},iCn3D.prototype.applyPrevColor=function(){for(var e in this.atoms)this.atoms[e].color=this.atomPrevColors[e]},iCn3D.prototype.applyChemicalbindingOptions=function(e){var t;if(void 0===e&&(e=this.opts),"show"===e.chemicalbinding){if(void 0!==this.chemicals&&Object.keys(this.chemicals).length>0&&(t=this.hash2Atoms(this.chemicals)),void 0!==t){var i=this.getAtomsWithinAtom(this.atoms,t,4);this.opts.hbonds="yes",Object.keys(i).length>0&&this.calculateChemicalHbonds(t,i,parseFloat(3.5)),this.zoominSelection(this.unionHash(t,i))}}else"hide"===e.chemicalbinding&&(this.hideHbonds(),this.zoominSelection(this.atoms))},iCn3D.prototype.hideHbonds=function(){for(var e in this.opts.hbonds="no",void 0===this.lines&&(this.lines={}),this.lines.hbond=[],this.hbondpnts=[],this.atoms)this.atoms[e].style2="nothing";for(var e in this.sidec)this.atoms[e].style2=this.opts.sidec;for(var e in this.water)this.atoms[e].style=this.opts.water},iCn3D.prototype.applySsbondsOptions=function(e){if(void 0===e&&(e=this.opts),"yes"===e.ssbonds.toLowerCase()&&void 0!==this.ssbondpnts){var t,i,n=new THREE.Color(16776960),r=Object.keys(this.structures);this.bAlternate?(t=this.ALTERNATE_STRUCTURE,i=this.ALTERNATE_STRUCTURE+1):(t=0,i=r.length),this.lines.ssbond=[];for(var o=t,s=i;o<s;++o){var a=r[o];if(void 0!==this.ssbondpnts[a])for(var c=Math.floor(this.ssbondpnts[a].length/2)-1;c>=0;c--){var l,d,h=this.ssbondpnts[a][2*c],u=this.ssbondpnts[a][2*c+1],p={color:"#FFFF00",dashed:!0},m=!1;for(var f in this.residues[h])if("SG"===this.atoms[f].name){l=this.atoms[f].serial,p.position1=this.atoms[f].coord,p.serial1=this.atoms[f].serial,m=!0;break}if(!m)for(var f in this.residues[h])if("CA"===this.atoms[f].name){p.position1=this.atoms[f].coord,p.serial1=this.atoms[f].serial,m=!0;break}for(var f in m=!1,this.residues[u])if("SG"===this.atoms[f].name){d=this.atoms[f].serial,p.position2=this.atoms[f].coord,p.serial2=this.atoms[f].serial,m=!0;break}if(!m)for(var f in this.residues[u])if("CA"===this.atoms[f].name){p.position2=this.atoms[f].coord,p.serial2=this.atoms[f].serial,m=!0;break}if(void 0===p.serial1||void 0===p.serial2||this.dAtoms.hasOwnProperty(p.serial1)||this.dAtoms.hasOwnProperty(p.serial2))if(void 0===p.position1||void 0===p.position2||p.position1.distanceTo(p.position2)>3)this.ssbondpnts[a].splice(2*c,2);else{var g,v,y=this.atoms[l].bonds.indexOf(d);-1!=y&&(g=this.atoms[l].bonds.slice(0,y),v=this.atoms[l].bonds.slice(y+1),this.atoms[l].bonds=g.concat(v)),-1!=(y=this.atoms[d].bonds.indexOf(l))&&(g=this.atoms[d].bonds.slice(0,y),v=this.atoms[d].bonds.slice(y+1),this.atoms[d].bonds=g.concat(v)),this.lines.ssbond.push(p),this.createCylinder(p.position1,p.position2,this.cylinderRadius,n);var b=this.unionHash(this.residues[h],this.residues[u]),_=this.intHash(b,this.sidec),w=this.intHash(b,this.calphas);for(var f in _=this.unionHash(_,w))this.atoms[f].style2="stick"}}}}},iCn3D.prototype.applyMapOptions=function(e){switch(void 0===e&&(e=this.opts),e.mapwireframe){case"yes":e.mapwireframe=!0;break;case"no":e.mapwireframe=!1}var t,i;switch(t=this.intHash(this.dAtoms,this.hAtoms),i=this.hash2Atoms(t),e.map.toLowerCase()){case"2fofc":this.createSurfaceRepresentation(i,11,e.mapwireframe);break;case"fofc":this.createSurfaceRepresentation(i,12,e.mapwireframe);break;case"nothing":this.removeMaps()}},iCn3D.prototype.applyEmmapOptions=function(e){switch(void 0===e&&(e=this.opts),e.emmapwireframe){case"yes":e.emmapwireframe=!0;break;case"no":e.emmapwireframe=!1}var t,i;switch(t=this.intHash(this.dAtoms,this.hAtoms),i=this.hash2Atoms(t),e.emmap.toLowerCase()){case"em":this.createSurfaceRepresentation(i,13,e.emmapwireframe);break;case"nothing":this.removeEmmaps()}},iCn3D.prototype.setFog=function(){var e=this.backgroundColors[this.opts.background.toLowerCase()];"yes"===this.opts.fog?"perspective"===this.opts.camera?this.scene.fog=new THREE.Fog(e,1.5*this.maxD,3*this.maxD):"orthographic"===this.opts.camera&&(this.scene.fog=void 0):this.scene.fog=void 0},iCn3D.prototype.alternateStructures=function(){var e=Object.keys(this.hAtoms).length,t=Object.keys(this.atoms).length;this.dAtoms={};for(var i=Object.keys(this.structures),n=0,r=i.length;n<r;++n){var o=i[n];if(n>this.ALTERNATE_STRUCTURE||this.ALTERNATE_STRUCTURE===r-1&&0===n){for(var s in this.structures[o])this.dAtoms=this.unionHash(this.dAtoms,this.chains[this.structures[o][s]]);this.ALTERNATE_STRUCTURE=n;break}}e<t&&(this.dAtoms=this.intHash(this.dAtoms,this.hAtoms),this.bShowHighlight=!1,this.opts.rotationcenter="highlight center"),this.removeSurfaces(),this.applySurfaceOptions(),this.removeMaps(),this.applyMapOptions(),this.removeEmmaps(),this.applyEmmapOptions(),this.draw(),this.bShowHighlight=!0,this.opts.rotationcenter="molecule center"},iCn3D.prototype.updateStabilizer=function(){if(this.stabilizerpnts=[],void 0!==this.pairArray)for(var e=0,t=this.pairArray.length;e<t;e+=2){var i=this.getResidueRepPos(this.pairArray[e]),n=this.getResidueRepPos(this.pairArray[e+1]);this.stabilizerpnts.push(i),this.stabilizerpnts.push(n)}},iCn3D.prototype.getResidueRepPos=function(e){var t,i=this.atoms[e],n=i.structure+"_"+i.chain+"_"+i.resi;if(this.proteins.hasOwnProperty(e)||this.nucleotides.hasOwnProperty(e))for(var r in this.residues[n]){var o=this.atoms[r];if("N3"===o.name){t=this.atoms[r].coord;break}if("CA"===o.name&&"coil"==o.ss){t=this.atoms[r].coord;break}if("CA"===o.name&&("helix"==o.ss||"sheet"==o.ss)){t=void 0!==this.atoms[r].coord2?this.atoms[r].coord2:this.atoms[r].coord;break}}else t=i.coord;return void 0===t&&(t=i.coord),t},iCn3D.prototype.applySurfaceOptions=function(e){switch(void 0===e&&(e=this.opts),e.wireframe){case"yes":e.wireframe=!0;break;case"no":e.wireframe=!1}var t,i;switch(e.opacity=parseFloat(e.opacity),t=this.intHash(this.dAtoms,this.hAtoms),"nothing"===e.water&&(t=this.exclHash(t,this.water)),i=this.hash2Atoms(t),e.surface.toLowerCase()){case"van der waals surface":this.createSurfaceRepresentation(i,1,e.wireframe,e.opacity);break;case"solvent accessible surface":this.createSurfaceRepresentation(i,3,e.wireframe,e.opacity);break;case"molecular surface":this.createSurfaceRepresentation(i,2,e.wireframe,e.opacity);break;case"van der waals surface with context":this.createSurfaceRepresentation(i,1,e.wireframe,e.opacity);break;case"solvent accessible surface with context":this.createSurfaceRepresentation(i,3,e.wireframe,e.opacity);break;case"molecular surface with context":this.createSurfaceRepresentation(i,2,e.wireframe,e.opacity);break;case"nothing":this.removeSurfaces()}},iCn3D.prototype.applyOtherOptions=function(e){if(void 0===e&&(e=this.opts),this.lines.hbond=[],"yes"===e.hbonds.toLowerCase())for(var t="#00FF00",i=this.hbondpnts,n=0,r=Math.floor(i.length/2);n<r;n++)(o={}).position1=i[2*n].coord,o.serial1=i[2*n].serial,o.position2=i[2*n+1].coord,o.serial2=i[2*n+1].serial,o.color=t,o.dashed=!0,(void 0===o.serial1||void 0===o.serial2||this.dAtoms.hasOwnProperty(o.serial1)||this.dAtoms.hasOwnProperty(o.serial2))&&(void 0===this.lines.hbond&&(this.lines.hbond=[]),this.lines.hbond.push(o));if(void 0!==this.pairArray&&this.pairArray.length>0)for(this.updateStabilizer(),t="#FFFFFF",i=this.stabilizerpnts,this.lines.stabilizer=[],n=0,r=Math.floor(i.length/2);n<r;n++){var o;(o={}).position1=i[2*n],o.position2=i[2*n+1],o.color=t,o.dashed=!1,this.lines.stabilizer.push(o)}if(this.createLines(this.lines),void 0!==this.prevMaps){n=0;for(var s=this.prevMaps.length;n<s;++n)this.mdl.add(this.prevMaps[n])}if(void 0!==this.prevEmmaps)for(n=0,s=this.prevEmmaps.length;n<s;++n)this.mdl.add(this.prevEmmaps[n]);if(void 0!==this.prevSurfaces)for(n=0,s=this.prevSurfaces.length;n<s;++n)this.mdl.add(this.prevSurfaces[n]);switch(this.applyCenterOptions(e),e.axis.toLowerCase()){case"yes":this.axis=!0,this.buildAxes(this.maxD/2);break;case"no":this.axis=!1}switch(e.pk.toLowerCase()){case"atom":this.pk=1;break;case"no":this.pk=0;break;case"residue":this.pk=2;break;case"strand":this.pk=3}},iCn3D.prototype.rebuildScene=function(e){this.rebuildSceneBase(e),void 0!==this.bSkipChemicalbinding&&this.bSkipChemicalbinding||this.applyChemicalbindingOptions(),this.bSkipChemicalbinding=!0,this.applySsbondsOptions(),this.applyDisplayOptions(this.opts,this.dAtoms),this.applyOtherOptions(),this.setFog(),this.setCamera(),this.scene_ghost.updateMatrixWorld(!0)},iCn3D.prototype.draw=function(){this.rebuildScene(),this.bImpo&&this.drawImpostorShader(),this.applyPrevColor(),void 0!==this.biomtMatrices&&this.biomtMatrices.length>1&&(this.bAssembly?this.drawSymmetryMates():this.centerSelection());var e=void 0!==this.hAtoms?Object.keys(this.hAtoms).length:0;e>0&&e<Object.keys(this.dAtoms).length&&(this.removeHlObjects(),(void 0===this.bShowHighlight||this.bShowHighlight)&&this.addHlObjects()),!0===this.bRender&&(this.applyTransformation(this._zoomFactor,this.mouseChange,this.quaternion),this.render()),this.clearImpostors()},iCn3D.prototype.calculateChemicalHbonds=function(e,t,i){if(0!==Object.keys(e).length&&0!==Object.keys(t).length){var n,r={},o=i*i;for(var s in e)"N"!==(l=e[s]).elem&&"O"!==l.elem&&"F"!==l.elem||(r[l.structure+"_"+l.chain+"_"+l.resi+"_"+l.name]=l);var a={},c={};for(var s in t){var l;if("N"===(l=t[s]).elem||"O"===l.elem||"F"===l.elem)for(var d in n=l.structure+"_"+l.chain+"_"+l.resi,r){var h=Math.abs(l.coord.x-r[d].coord.x);if(!(h>i)){var u=Math.abs(l.coord.y-r[d].coord.y);if(!(u>i)){var p=Math.abs(l.coord.z-r[d].coord.z);p>i||h*h+u*u+p*p>o||(this.hbondpnts.push({serial:l.serial,coord:l.coord}),this.hbondpnts.push({serial:r[d].serial,coord:r[d].coord}),a=this.unionHash(a,this.residues[l.structure+"_"+l.chain+"_"+l.resi]),a=this.unionHash(a,this.residues[r[d].structure+"_"+r[d].chain+"_"+r[d].resi]),c[n]=1)}}}}for(var m=Object.keys(c),f=(s=0,m.length);s<f;++s)for(var d in this.residues[m[s]])this.atoms[d].style2="stick";return a}},iCn3D.prototype.getChainsFromAtoms=function(e){var t={};for(var i in e){var n=this.atoms[i];t[n.structure+"_"+n.chain]=1}return t},iCn3D.prototype.getNeighboringAtoms=function(e,t,i){var n=this.getExtent(t),r=(n[2][0]-n[0][0])*(n[2][0]-n[0][0])+(n[2][1]-n[0][1])*(n[2][1]-n[0][1])+(n[2][2]-n[0][2])*(n[2][2]-n[0][2]),o=(n[2][0]-n[1][0])*(n[2][0]-n[1][0])+(n[2][1]-n[1][1])*(n[2][1]-n[1][1])+(n[2][2]-n[1][2])*(n[2][2]-n[1][2]),s=Math.sqrt(r>o?r:o),a=(s+i)*(s+i),c={};for(var l in e){var d=this.atoms[l];d.serial in t||d.coord.x<n[0][0]-i||d.coord.x>n[1][0]+i||d.coord.y<n[0][1]-i||d.coord.y>n[1][1]+i||d.coord.z<n[0][2]-i||d.coord.z>n[1][2]+i||(d.coord.x-n[2][0])*(d.coord.x-n[2][0])+(d.coord.y-n[2][1])*(d.coord.y-n[2][1])+(d.coord.z-n[2][2])*(d.coord.z-n[2][2])<a&&(c[d.serial]=d)}return c},iCn3D.prototype.getAtomsWithinAtom=function(e,t,i){var n=this.getNeighboringAtoms(e,t,i),r={};for(var o in t){var s=this.atoms[o],a=this.vdwRadii[s.elem]||this.defaultRadius;for(var c in n){var l=n[c];l.serial in t||(l.coord.x-s.coord.x)*(l.coord.x-s.coord.x)+(l.coord.y-s.coord.y)*(l.coord.y-s.coord.y)+(l.coord.z-s.coord.z)*(l.coord.z-s.coord.z)<(a+i)*(a+i)&&(r[l.serial]=l)}}return r},iCn3D.prototype.getExtent=function(e){var t,i=ymin=zmin=9999,n=ymax=zmax=-9999,r=ysum=zsum=cnt=0;for(t in e){var o=this.atoms[t];cnt++,r+=o.coord.x,ysum+=o.coord.y,zsum+=o.coord.z,i=i<o.coord.x?i:o.coord.x,ymin=ymin<o.coord.y?ymin:o.coord.y,zmin=zmin<o.coord.z?zmin:o.coord.z,n=n>o.coord.x?n:o.coord.x,ymax=ymax>o.coord.y?ymax:o.coord.y,zmax=zmax>o.coord.z?zmax:o.coord.z}return[[i,ymin,zmin],[n,ymax,zmax],[r/cnt,ysum/cnt,zsum/cnt]]},iCn3D.prototype.centerAtoms=function(e){var t=new THREE.Vector3(9999,9999,9999),i=new THREE.Vector3(-9999,-9999,-9999),n=new THREE.Vector3,r=0;for(var o in e){var s=this.atoms[o].coord;n.add(s),t.min(s),i.max(s),++r}var a=i.distanceTo(t);return{center:n.multiplyScalar(1/r),maxD:a}},iCn3D.prototype.removeSurfaces=function(){for(var e=0,t=this.prevSurfaces.length;e<t;++e)this.mdl.remove(this.prevSurfaces[e]);this.prevSurfaces=[]},iCn3D.prototype.removeLastSurface=function(){this.prevSurfaces.length>0&&(this.mdl.remove(this.prevSurfaces[this.prevSurfaces.length-1]),this.prevSurfaces.slice(this.prevSurfaces.length-1,1))},iCn3D.prototype.removeMaps=function(){for(var e=0,t=this.prevMaps.length;e<t;++e)this.mdl.remove(this.prevMaps[e]);this.prevMaps=[]},iCn3D.prototype.removeEmmaps=function(){for(var e=0,t=this.prevEmmaps.length;e<t;++e)this.mdl.remove(this.prevEmmaps[e]);this.prevEmmaps=[]},iCn3D.prototype.removeLastMap=function(){this.prevMaps.length>0&&(this.mdl.remove(this.prevMaps[this.prevMaps.length-1]),this.prevMaps.slice(this.prevMaps.length-1,1))},iCn3D.prototype.removeLastEmmap=function(){this.prevEmmaps.length>0&&(this.mdl.remove(this.prevEmmaps[this.prevEmmaps.length-1]),this.prevEmmaps.slice(this.prevEmmaps.length-1,1))},iCn3D.prototype.zoominSelection=function(e){if(void 0===e&&(e=this.hash2Atoms(this.hAtoms)),Object.keys(e).length>1){var t=this.centerAtoms(e);this.maxD=t.maxD,this.maxD<5&&(this.maxD=5),this.mdl.position.set(0,0,0),this.mdlImpostor.position.set(0,0,0),this.mdl_ghost.position.set(0,0,0),this.mdl.position.sub(t.center),this.mdlImpostor.position.sub(t.center),this.mdl_ghost.position.sub(t.center),this.center=t.center,this.setCamera()}},iCn3D.prototype.centerSelection=function(e){if(this.resetOrientation(),void 0===e&&(e=this.hash2Atoms(this.hAtoms)),Object.keys(e).length>1){var t=this.centerAtoms(e);this.center=t.center,this.setCenter(this.center),this.setCamera()}};var iCn3DUI=function(e){var t=this;this.REVISION="2.7.4",t.bFullUi=!0,t.cfg=e,t.divid=t.cfg.divid,t.pre=t.divid+"_",t.inputid="",t.setOperation="or",t.WIDTH=400,t.HEIGHT=400,t.RESIDUE_WIDTH=10,t.MENU_HEIGHT=40,t.MENU_WIDTH=750,t.LESSWIDTH=20,t.LESSWIDTH_RESIZE=20,t.LESSHEIGHT=20,t.ROT_DIR="right",t.bHideSelection=!0,t.CMD_HEIGHT=.8*t.MENU_HEIGHT,t.EXTRAHEIGHT=t.MENU_HEIGHT+t.CMD_HEIGHT,null!=t.cfg.showmenu&&0==t.cfg.showmenu&&(t.EXTRAHEIGHT-=t.MENU_HEIGHT),null!=t.cfg.showcommand&&0==t.cfg.showcommand&&(t.EXTRAHEIGHT-=t.CMD_HEIGHT),t.GREY8="#888888",t.GREYB="#BBBBBB",t.GREYC="#CCCCCC",t.GREYD="#DDDDDD",t.ORANGE="#FFA500",t.b62ResArray=["A","R","N","D","C","Q","E","G","H","I","L","K","M","F","P","S","T","W","Y","V","B","Z","X","*"],t.b62Matrix=[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0,-4],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1,-4],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1,-4],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1,-4],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2,-4],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1,-4],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1,-4],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1,-4],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1,-4],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1,-4],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1,-4],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1,-4],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1,-4],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1,-4],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2,-4],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0,-4],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0,-4],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2,-4],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1,-4],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1,-4],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1,-4],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1,-4],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1,-4],[-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,-4,1]],t.opts={},t.opts.camera="perspective",t.opts.background="transparent",t.opts.color="chain",t.opts.proteins="ribbon",t.opts.sidec="nothing",t.opts.nucleotides="nucleotide cartoon",t.opts.surface="nothing",t.opts.opacity="1.0",t.opts.wireframe="no",t.opts.map="nothing",t.opts.mapwireframe="yes",t.opts.emmap="nothing",t.opts.emmapwireframe="yes",t.opts.chemicals="stick",t.opts.water="nothing",t.opts.ions="sphere",t.opts.hbonds="no",t.opts.ssbonds="yes",t.opts.rotationcenter="molecule center",t.opts.axis="no",t.opts.fog="no",t.opts.slab="no",t.opts.pk="residue",t.opts.chemicalbinding="hide",void 0!==t.cfg.align&&(t.opts.color="identity"),void 0!==t.cfg.blast_rep_id&&(t.opts.color="conservation"),void 0!==t.cfg.cid&&(t.opts.color="atom"),void 0!==t.cfg.options&&jQuery.extend(t.opts,t.cfg.options),t.init(),t.modifyIcn3d()};if(iCn3DUI.prototype={constructor:iCn3DUI,init:function(){var e=this;e.bSelectResidue=!1,e.bSelectAlignResidue=!1,e.selectedResidues={},e.bAnnoShown=!1,e.bSetChainsAdvancedMenu=!1,e.b2DShown=!1,e.bCrashed=!1,e.prevCommands="",e.bAddCommands=!0,e.bAddLogs=!0,e.bNotLoadStructure=!1,e.bInitial=!0,$("#"+e.pre+"dl_annotations").html(""),$("#"+e.pre+"dl_2ddgm").html("")},modifyIcn3d:function(){this.modifyIcn3dshowPicking()},switchHighlightLevelUp:function(){var e=this;if(e.icn3d.bShift||e.icn3d.bCtrl||e.icn3d.removeHlObjects(),1===e.icn3d.highlightlevel){e.icn3d.highlightlevel=2;var t=e.icn3d.getFirstAtomObj(e.icn3d.pickedAtomList);e.icn3d.hAtoms=e.icn3d.bShift||e.icn3d.bCtrl?e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.residues[t.structure+"_"+t.chain+"_"+t.resi]):e.icn3d.cloneHash(e.icn3d.residues[t.structure+"_"+t.chain+"_"+t.resi])}else if(2===e.icn3d.highlightlevel)e.icn3d.highlightlevel=3,t=e.icn3d.getFirstAtomObj(e.icn3d.pickedAtomList),e.icn3d.hAtoms=e.icn3d.bShift||e.icn3d.bCtrl?e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.selectStrandHelixFromAtom(t)):e.icn3d.cloneHash(e.icn3d.selectStrandHelixFromAtom(t));else if(3===e.icn3d.highlightlevel)e.icn3d.highlightlevel=4,t=e.icn3d.getFirstAtomObj(e.icn3d.pickedAtomList),e.icn3d.hAtoms=e.icn3d.bShift||e.icn3d.bCtrl?e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.chains[t.structure+"_"+t.chain]):e.icn3d.cloneHash(e.icn3d.chains[t.structure+"_"+t.chain]);else if(4===e.icn3d.highlightlevel||5===e.icn3d.highlightlevel){e.icn3d.highlightlevel=5,t=e.icn3d.getFirstAtomObj(e.icn3d.pickedAtomList),e.icn3d.bShift||e.icn3d.bCtrl||(e.icn3d.hAtoms={});for(var i=e.icn3d.structures[t.structure],n=0,r=i.length;n<r;++n)e.icn3d.hAtoms=e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.chains[i[n]])}e.icn3d.addHlObjects(),e.updateHlAll()},switchHighlightLevelDown:function(){var e=this;if(e.icn3d.removeHlObjects(),2!==e.icn3d.highlightlevel&&1!==e.icn3d.highlightlevel||1!==Object.keys(e.icn3d.pickedAtomList).length)if(3===e.icn3d.highlightlevel){var t={};for(var i in e.icn3d.pickedAtomList)residueid=e.icn3d.atoms[i].structure+"_"+e.icn3d.atoms[i].chain+"_"+e.icn3d.atoms[i].resi,t[residueid]=1;if(1===Object.keys(t).length){e.icn3d.highlightlevel=2;var n=e.icn3d.getFirstAtomObj(e.icn3d.pickedAtomList);e.icn3d.hAtoms=e.icn3d.bShift||e.icn3d.bCtrl?e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.residues[n.structure+"_"+n.chain+"_"+n.resi]):e.icn3d.cloneHash(e.icn3d.residues[n.structure+"_"+n.chain+"_"+n.resi])}}else 4===e.icn3d.highlightlevel?(e.icn3d.highlightlevel=3,n=e.icn3d.getFirstAtomObj(e.icn3d.pickedAtomList),e.icn3d.hAtoms=e.icn3d.bShift||e.icn3d.bCtrl?e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.selectStrandHelixFromAtom(n)):e.icn3d.cloneHash(e.icn3d.selectStrandHelixFromAtom(n))):5===e.icn3d.highlightlevel&&(e.icn3d.highlightlevel=4,n=e.icn3d.getFirstAtomObj(e.icn3d.pickedAtomList),e.icn3d.hAtoms=e.icn3d.bShift||e.icn3d.bCtrl?e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.chains[n.structure+"_"+n.chain]):e.icn3d.cloneHash(e.icn3d.chains[n.structure+"_"+n.chain]));else e.icn3d.highlightlevel=1,e.icn3d.hAtoms=e.icn3d.cloneHash(e.icn3d.pickedAtomList),e.icn3d.hAtoms=e.icn3d.bShift||e.icn3d.bCtrl?e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.pickedAtomList):e.icn3d.cloneHash(e.icn3d.pickedAtomList);e.icn3d.addHlObjects(),e.updateHlAll()},switchHighlightLevel:function(){var e=this;$(document).bind("keydown",function(t){38===t.keyCode?(t.preventDefault(),0!=Object.keys(e.icn3d.pickedAtomList).length&&e.icn3d.hAtoms.hasOwnProperty(e.icn3d.getFirstAtomObj(e.icn3d.pickedAtomList).serial)||(e.icn3d.pickedAtomList=e.icn3d.cloneHash(e.icn3d.hAtoms)),e.switchHighlightLevelUp(),e.setLogCmd("highlight level up",!0)):40===t.keyCode&&(t.preventDefault(),0!=Object.keys(e.icn3d.pickedAtomList).length&&e.icn3d.hAtoms.hasOwnProperty(e.icn3d.getFirstAtomObj(e.icn3d.pickedAtomList).serial)||(e.icn3d.pickedAtomList=e.icn3d.cloneHash(e.icn3d.hAtoms)),e.switchHighlightLevelDown(),e.setLogCmd("highlight level down",!0))})},allCustomEvents:function(){},setCustomDialogs:function(){return""},modifyIcn3dshowPicking:function(){var e=this;iCn3D.prototype.showPicking=function(t,i,n){if(void 0!==e.cfg.cid&&(this.pk=1),e.icn3d.highlightlevel=e.icn3d.pk,this.showPickingBase(t,i,n),void 0!==i&&void 0!==n){null!=e.cfg.showmenu&&1==e.cfg.showmenu&&(n+=e.MENU_HEIGHT);var r=1==this.pk?t.resn+t.resi+"@"+t.name:t.resn+t.resi;Object.keys(e.icn3d.structures).length>1?(r=t.structure+" "+r,$("#"+e.pre+"popup").css("width","100px")):$("#"+e.pre+"popup").css("width","80px"),$("#"+e.pre+"popup").html(r),$("#"+e.pre+"popup").css("top",n).css("left",i+20).show()}else{var o=this.id.split("_");e.pre=o[0]+"_",e.updateHlAll();var s={};s.factor=this._zoomFactor,s.mouseChange=this.mouseChange,s.quaternion={},s.quaternion._x=parseFloat(this.quaternion._x).toPrecision(5),s.quaternion._y=parseFloat(this.quaternion._y).toPrecision(5),s.quaternion._z=parseFloat(this.quaternion._z).toPrecision(5),s.quaternion._w=parseFloat(this.quaternion._w).toPrecision(5),e.bAddCommands&&(this.commands.push("pickatom "+t.serial+"|||"+e.getTransformationStr(s)),this.optsHistory.push(this.cloneHash(this.opts)),this.optsHistory[this.optsHistory.length-1].hlatomcount=Object.keys(this.hAtoms).length,e.isSessionStorageSupported()&&e.saveCommandsToSession(),e.STATENUMBER=this.commands.length),this.logs.push("pickatom "+t.serial+" (chain: "+t.structure+"_"+t.chain+", residue: "+t.resn+", number: "+t.resi+", atom: "+t.name+")"),$("#"+e.pre+"logtext").length&&$("#"+e.pre+"logtext").val("> "+this.logs.join("\n> ")+"\n> ").scrollTop($("#"+e.pre+"logtext")[0].scrollHeight)}}},show3DStructure:function(){var e=this;return e.deferred=$.Deferred(function(){var t,i;e.isSessionStorageSupported()&&e.getCommandsBeforeCrash(),e.setViewerWidthHeight(),t=-1!==e.cfg.width.toString().indexOf("%")?e.WIDTH*e.cfg.width.substr(0,e.cfg.width.toString().indexOf("%"))/100-e.LESSWIDTH:e.cfg.width,i=-1!==e.cfg.height.toString().indexOf("%")?e.HEIGHT*e.cfg.height.substr(0,e.cfg.height.toString().indexOf("%"))/100-e.EXTRAHEIGHT-e.LESSHEIGHT:e.cfg.height,e.realWidth=t,e.realHeight=i,e.setTopMenusHtml(e.divid),e.allEventFunctions(),e.allCustomEvents();var n=0;if((null==e.cfg.showmenu||e.cfg.showmenu)&&(n+=e.MENU_HEIGHT),(null==e.cfg.showcommand||e.cfg.showcommand)&&(n+=e.CMD_HEIGHT),null!=e.cfg.showmenu&&0==e.cfg.showmenu?e.hideMenu():e.showMenu(),null!=e.cfg.showtitle&&0==e.cfg.showtitle?$("#"+e.pre+"title").hide():$("#"+e.pre+"title").show(),$("#"+e.pre+"viewer").width(t).height(parseInt(i)+n),$("#"+e.pre+"canvas").width(t).height(parseInt(i)),e.icn3d=new iCn3D(e.pre+"canvas"),e.isMobile()||(e.icn3d.scaleFactor=2),e.handleContextLost(),e.icn3d.setWidthHeight(t,i),e.icn3d.ori_chemicalbinding=e.opts.chemicalbinding,void 0!==e.cfg.bCalphaOnly&&(e.icn3d.bCalphaOnly=e.cfg.bCalphaOnly),e.icn3d.opts=e.icn3d.cloneHash(e.opts),e.STATENUMBER=e.icn3d.commands.length,e.isSessionStorageSupported()&&e.bCrashed){e.bCrashed=!1;var r=e.commandsBeforeCrash.split("|||")[0],o=r.substr(r.lastIndexOf(" ")+1);if(o===e.cfg.mmtfid||o===e.cfg.pdbid||o===e.cfg.mmdbid||o===e.cfg.gi||o===e.cfg.blast_rep_id||o===e.cfg.cid||o===e.cfg.mmcifid||o===e.cfg.align)return void e.loadScript(e.commandsBeforeCrash,!0)}if(e.icn3d.molTitle="",void 0!==e.cfg.url){var s=e.cfg.url.split("|"),a=s[0],c=s[1];e.icn3d.molTitle="",e.inputid=void 0,e.setLogCmd("load url "+c+" | type "+a,!0),e.downloadUrl(c,a)}else if(void 0!==e.cfg.mmtfid)e.inputid=e.cfg.mmtfid,e.setLogCmd("load mmtf "+e.cfg.mmtfid,!0),e.downloadMmtf(e.cfg.mmtfid);else if(void 0!==e.cfg.pdbid)e.inputid=e.cfg.pdbid,e.setLogCmd("load pdb "+e.cfg.pdbid,!0),e.downloadPdb(e.cfg.pdbid);else if(void 0!==e.cfg.mmdbid)e.inputid=e.cfg.mmdbid,e.setLogCmd("load mmdb "+e.cfg.mmdbid+" | parameters "+e.cfg.inpara,!0),e.downloadMmdb(e.cfg.mmdbid);else if(void 0!==e.cfg.gi)e.setLogCmd("load gi "+e.cfg.gi,!0),e.downloadGi(e.cfg.gi);else if(void 0!==e.cfg.blast_rep_id)e.setLogCmd("load seq_struct_ids "+e.cfg.query_id+","+e.cfg.blast_rep_id,!0),e.downloadBlast_rep_id(e.cfg.query_id+","+e.cfg.blast_rep_id);else if(void 0!==e.cfg.cid)e.inputid=e.cfg.cid,c="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+e.inputid+"/description/jsonp",$.ajax({url:c,dataType:"jsonp",tryCount:0,retryLimit:1,success:function(t){void 0!==t.InformationList&&void 0!==t.InformationList.Information&&(e.icn3d.molTitle=t.InformationList.Information[0].Title)},error:function(e,t,i){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}}),e.setLogCmd("load cid "+e.cfg.cid,!0),e.downloadCid(e.cfg.cid);else if(void 0!==e.cfg.mmcifid)e.inputid=e.cfg.mmcifid,e.setLogCmd("load mmcif "+e.cfg.mmcifid,!0),e.downloadMmcif(e.cfg.mmcifid);else if(void 0!==e.cfg.align){var l=e.cfg.align.split(",");6===l.length?e.inputid=l[0]+"_"+l[3]:2===l.length&&(e.inputid=l[0]+"_"+l[1]),e.setLogCmd("load alignment "+e.cfg.align+" | parameters "+e.cfg.inpara,!0),e.downloadAlignment(e.cfg.align)}else void 0!==e.cfg.command&&""!==e.cfg.command?e.loadScript(e.cfg.command):alert('Please use the "File" menu to retrieve a structure of interest or to display a local file.')}),e.deferred.promise()},hideMenu:function(){var e=this;void 0!==$("#"+e.pre+"mnlist")[0]&&($("#"+e.pre+"mnlist")[0].style.display="none"),void 0!==$("#"+e.pre+"mnLogSection")[0]&&($("#"+e.pre+"mnLogSection")[0].style.display="none"),void 0!==$("#"+e.pre+"cmdlog")[0]&&($("#"+e.pre+"cmdlog")[0].style.display="none"),$("#"+e.pre+"title")[0].style.margin="10px 0 0 10px"},showMenu:function(){var e=this;void 0!==$("#"+e.pre+"mnlist")[0]&&($("#"+e.pre+"mnlist")[0].style.display="block"),void 0!==$("#"+e.pre+"mnLogSection")[0]&&($("#"+e.pre+"mnLogSection")[0].style.display="block"),void 0!==$("#"+e.pre+"cmdlog")[0]&&($("#"+e.pre+"cmdlog")[0].style.display="block")},saveSelectionIfSelected:function(e,t){var i=this;if(i.bSelectResidue||i.bSelectAlignResidue){var n=$("#"+i.pre+"seq_command_name2").val().replace(/\s+/g,"_");""===n&&(n=$("#"+i.pre+"alignseq_command_name").val().replace(/\s+/g,"_")),""!==n&&i.saveSelection(n,n),i.bSelectResidue=!1,i.bSelectAlignResidue=!1}},setOption:function(e,t){var i=this;if(i.icn3d.opts[e]=t,i.saveSelectionIfSelected(),"color"===e){i.icn3d.setColorByOptions(i.icn3d.opts,i.icn3d.hAtoms),i.icn3d.draw();var n=i.icn3d.getResiduesFromCalphaAtoms(i.icn3d.hAtoms);i.changeSeqColor(Object.keys(n))}else"surface"===e||"opacity"===e||"wireframe"===e?("opacity"!==e&&"wireframe"!==e||i.icn3d.removeLastSurface(),i.icn3d.applySurfaceOptions(),i.icn3d.draw()):"map"===e||"mapwireframe"===e?("mapwireframe"===e&&i.icn3d.removeLastMap(),i.icn3d.applyMapOptions(),i.icn3d.draw()):"emmap"===e||"emmapwireframe"===e?("emmapwireframe"===e&&i.icn3d.removeLastEmmap(),i.icn3d.applyEmmapOptions(),i.icn3d.draw()):"chemicalbinding"===e?(i.icn3d.bSkipChemicalbinding=!1,i.icn3d.draw()):i.icn3d.draw()},setStyle:function(e,t){var i=this,n={};switch(e){case"proteins":n=i.icn3d.intHash(i.icn3d.hAtoms,i.icn3d.proteins);break;case"sidec":n=i.icn3d.intHash(i.icn3d.hAtoms,i.icn3d.sidec),calpha_atoms=i.icn3d.intHash(i.icn3d.hAtoms,i.icn3d.calphas),n=i.icn3d.unionHash(n,calpha_atoms);break;case"nucleotides":n=i.icn3d.intHash(i.icn3d.hAtoms,i.icn3d.nucleotides);break;case"chemicals":n=i.icn3d.intHash(i.icn3d.hAtoms,i.icn3d.chemicals);break;case"ions":n=i.icn3d.intHash(i.icn3d.hAtoms,i.icn3d.ions);break;case"water":n=i.icn3d.intHash(i.icn3d.hAtoms,i.icn3d.water)}if("sidec"===e)for(var r in n)i.icn3d.atoms[r].style2=t;else for(var r in n)i.icn3d.atoms[r].style=t;i.icn3d.opts[e]=t,i.saveSelectionIfSelected(),i.icn3d.draw()},setLogCmd:function(e,t,i){var n=this;if(""===e.trim())return!1;-1!==(s=e.indexOf("|||"))&&(e=e.substr(0,s));var r={};if(r.factor=n.icn3d._zoomFactor,r.mouseChange=n.icn3d.mouseChange,r.quaternion={},r.quaternion._x=parseFloat(n.icn3d.quaternion._x).toPrecision(5),r.quaternion._y=parseFloat(n.icn3d.quaternion._y).toPrecision(5),r.quaternion._z=parseFloat(n.icn3d.quaternion._z).toPrecision(5),r.quaternion._w=parseFloat(n.icn3d.quaternion._w).toPrecision(5),t&&n.bAddCommands)if(n.STATENUMBER<n.icn3d.commands.length){var o=n.icn3d.commands[n.STATENUMBER-1],s=o.indexOf("|||");e!==o.substr(0,s)&&(n.icn3d.commands=n.icn3d.commands.slice(0,n.STATENUMBER),n.icn3d.commands.push(e+"|||"+n.getTransformationStr(r)),n.icn3d.optsHistory.push(n.icn3d.cloneHash(n.icn3d.opts)),n.icn3d.optsHistory[n.icn3d.optsHistory.length-1].hlatomcount=Object.keys(n.icn3d.hAtoms).length,n.isSessionStorageSupported()&&n.saveCommandsToSession(),n.STATENUMBER=n.icn3d.commands.length)}else n.icn3d.commands.push(e+"|||"+n.getTransformationStr(r)),n.icn3d.optsHistory.push(n.icn3d.cloneHash(n.icn3d.opts)),void 0!==n.icn3d.hAtoms&&(n.icn3d.optsHistory[n.icn3d.optsHistory.length-1].hlatomcount=Object.keys(n.icn3d.hAtoms).length),n.isSessionStorageSupported()&&n.saveCommandsToSession(),n.STATENUMBER=n.icn3d.commands.length;n.bAddLogs&&n.cfg.showcommand&&(n.icn3d.logs.push(e),$("#"+n.pre+"logtext").val("> "+n.icn3d.logs.join("\n> ")+"\n> ").scrollTop($("#"+n.pre+"logtext")[0].scrollHeight)),n.adjustIcon()},renderStructure:function(){var e=this;e.bInitial?(void 0!==e.cfg.command&&""!==e.cfg.command?(e.icn3d.bRender=!1,jQuery.extend(e.icn3d.opts,e.opts),e.icn3d.draw()):(jQuery.extend(e.icn3d.opts,e.opts),e.icn3d.draw()),Object.keys(e.icn3d.structures).length>1?$("#"+e.pre+"alternate").show():$("#"+e.pre+"alternate").hide()):(e.saveSelectionIfSelected(),e.icn3d.draw()),e.bInitial&&void 0!==e.cfg.command&&""!==e.cfg.command&&(e.icn3d.bRender=!0,e.loadScript(e.cfg.command)),setTimeout(function(){e.bInitial?(void 0!==e.cfg.showsets&&e.cfg.showsets&&e.showSets(),void 0!==e.cfg.align&&(seqObj=e.getAlignSequencesAnnotations(Object.keys(e.icn3d.alnChains),void 0,void 0,!1),$("#"+e.pre+"dl_sequence2").html(seqObj.sequencesHtml),$("#"+e.pre+"dl_sequence2").width(e.RESIDUE_WIDTH*seqObj.maxSeqCnt+200)),void 0!==e.cfg.showanno&&e.cfg.showanno&&(e.setLogCmd("view annotations",!0),e.showAnnotations())):e.updateHlAll(),e.bInitial=!1},0)},exportCustomAtoms:function(){for(var e=this,t="",i=void 0!==e.icn3d.defNames2Residues?Object.keys(e.icn3d.defNames2Residues).sort():[],n=0,r=i.length;n<r;++n){var o=e.icn3d.defNames2Residues[s=i[n]];e.icn3d.defNames2Command[s].replace(/,/g,", "),t+=s+"\tselect ",t+=e.residueids2spec(o),t+="\n"}for(n=0,r=(i=void 0!==e.icn3d.defNames2Atoms?Object.keys(e.icn3d.defNames2Atoms).sort():[]).length;n<r;++n){var s,a=e.icn3d.defNames2Atoms[s=i[n]];e.icn3d.defNames2Command[s].replace(/,/g,", "),(o=e.atoms2residues(a)).length>0&&(t+=s+"\tselect ",t+=e.residueids2spec(o),t+="\n")}return t},atoms2residues:function(e){for(var t={},i=0,n=e.length;i<n;++i)t[e[i]]=1;var r=this.icn3d.getResiduesFromCalphaAtoms(t);return Object.keys(r)},residueids2spec:function(e){var t="";if(void 0!==e){for(var i,n,r,o,s,a,c,l=e.sort(function(e,t){if(""!==e&&!isNaN(e))return parseInt(e)-parseInt(t);var i=e.lastIndexOf("_"),n=t.lastIndexOf("_");if(e.substr(0,i)<t.substr(0,n))return-1;if(e.substr(0,i)>t.substr(0,n))return 1;if(e.substr(0,i)==t.substr(0,n)){if(parseInt(e.substr(i+1))<parseInt(t.substr(n+1)))return-1;if(parseInt(e.substr(i+1))>parseInt(t.substr(n+1)))return 1;if(parseInt(e.substr(i+1))==parseInt(t.substr(n+1)))return 0}}),d="",h=0,u=1!=Object.keys(this.icn3d.structures).length,p=0,m=l.length;p<m;++p){var f=l[p];r=f.lastIndexOf("_"),i=f.substr(0,r),n=parseInt(f.substr(r+1)),o=d.indexOf("_"),s=d.substr(0,o),a=d.substr(o+1),d!==i?(p>0&&(t+=h===c?u?"$"+s+"."+a+":"+c+" or ":"."+a+":"+c+" or ":u?"$"+s+"."+a+":"+c+"-"+h+" or ":"."+a+":"+c+"-"+h+" or "),c=n):d===i&&n!==h+1&&(t+=h===c?u?"$"+s+"."+a+":"+c+" or ":"."+a+":"+c+" or ":u?"$"+s+"."+a+":"+c+"-"+h+" or ":"."+a+":"+c+"-"+h+" or ",c=n),d=i,h=n}o=d.indexOf("_"),s=d.substr(0,o),a=d.substr(o+1),t+=h===c?u?"$"+s+"."+a+":"+c:"."+a+":"+c:u?"$"+s+"."+a+":"+c+"-"+h:"."+a+":"+c+"-"+h}return t},pickCustomSphere:function(e){var t=this,i="select zone cutoff "+e,n={};for(var r in t.icn3d.hAtoms)n[r]=t.icn3d.atoms[r];var o=t.icn3d.getAtomsWithinAtom(t.icn3d.atoms,n,parseFloat(e)),s={};for(var r in o){var a=o[r];s[p=a.structure+"_"+a.chain+"_"+a.resi]=1}var c,l,d=Object.keys(s);t.icn3d.hAtoms={};for(var h=0,u=d.length;h<u;++h){var p=d[h];for(var r in t.icn3d.residues[p])t.icn3d.hAtoms[r]=1}t.icn3d.dAtoms=t.icn3d.cloneHash(t.icn3d.atoms);var m=t.icn3d.getFirstAtomObj(n);c="sphere."+m.chain+":"+t.icn3d.residueName2Abbr(m.resn.substr(0,3))+m.resi+"-"+$("#"+t.pre+"radius_aroundsphere").val()+"A",l="select a sphere around currently selected "+Object.keys(t.icn3d.hAtoms).length+" atoms with a radius of "+e+" angstrom",t.addCustomSelection(d,c,l,i,!0),t.saveSelectionIfSelected(),t.icn3d.draw()},showHbonds:function(e){var t=this;t.icn3d.opts.hbonds="yes",t.icn3d.opts.water="dot";var i="hbonds "+e,n={};for(var r in t.icn3d.atoms)!t.icn3d.hAtoms.hasOwnProperty(r)&&t.icn3d.dAtoms.hasOwnProperty(r)&&(n[r]=t.icn3d.atoms[r]);var o=t.icn3d.getFirstAtomObj(t.icn3d.hAtoms);if(Object.keys(n).length>0&&Object.keys(t.icn3d.hAtoms).length>0){var s=t.icn3d.calculateChemicalHbonds(n,t.icn3d.intHash2Atoms(t.icn3d.dAtoms,t.icn3d.hAtoms),parseFloat(e)),a={};for(var r in s)a[t.icn3d.atoms[r].structure+"_"+t.icn3d.atoms[r].chain+"_"+t.icn3d.atoms[r].resi]=1;for(var c in t.icn3d.hAtoms={},a)for(var r in t.icn3d.residues[c])t.icn3d.hAtoms[r]=1,t.icn3d.atoms[r].style2="stick";var l="hbonds_"+o.serial;t.addCustomSelection(Object.keys(a),l,"all atoms that are hydrogen-bonded with the selected atoms",i,!0),t.saveSelectionIfSelected(),t.icn3d.draw()}},showSsbonds:function(){var e=this;e.icn3d.opts.ssbonds="yes";for(var t={},i=Object.keys(e.icn3d.structures),n=0,r=i.length;n<r;++n){var o=i[n];if(void 0!==e.icn3d.ssbondpnts[o])for(var s=0,a=Math.floor(e.icn3d.ssbondpnts[o].length/2);s<a;s++){var c=e.icn3d.ssbondpnts[o][2*s],l=e.icn3d.ssbondpnts[o][2*s+1];t[c]=1,t[l]=1,e.icn3d.hAtoms=e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.residues[c]),e.icn3d.hAtoms=e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.residues[l])}}Object.keys(t).length>0&&(e.addCustomSelection(Object.keys(t),"ssbonds","all atoms that have disulfide bonds","disulfide bonds",!0),e.saveSelectionIfSelected(),e.icn3d.draw())},addLine:function(e,t,i,n,r,o,s,a,c){var l=this,d={};d.position1=new THREE.Vector3(e,t,i),d.position2=new THREE.Vector3(n,r,o),d.color=s,d.dashed=a,void 0===l.icn3d.lines[c]&&(l.icn3d.lines[c]=[]),void 0!==c?l.icn3d.lines[c].push(d):l.icn3d.lines.custom.push(d),l.icn3d.removeHlObjects()},back:function(){var e=this;e.backForward=!0,e.STATENUMBER--,e.bAddCommands=!1,e.bAddLogs=!1,e.bNotLoadStructure=!0,e.STATENUMBER<1?e.STATENUMBER=1:e.execCommands(0,e.STATENUMBER-1,e.STATENUMBER),e.adjustIcon(),e.bAddCommands=!0,e.bAddLogs=!0},forward:function(){var e=this;e.backForward=!0,e.STATENUMBER++,e.bAddCommands=!1,e.bAddLogs=!1,e.bNotLoadStructure=!0,e.STATENUMBER>e.icn3d.commands.length?e.STATENUMBER=e.icn3d.commands.length:e.execCommands(0,e.STATENUMBER-1,e.STATENUMBER),e.adjustIcon(),e.bAddCommands=!0,e.bAddLogs=!0},toggleSelection:function(){var e=this;if(e.bHideSelection){for(var t in e.icn3d.dAtoms)e.icn3d.hAtoms.hasOwnProperty(t)&&delete e.icn3d.dAtoms[t];e.bHideSelection=!1}else e.icn3d.dAtoms=e.icn3d.unionHash(e.icn3d.dAtoms,e.icn3d.hAtoms),e.bHideSelection=!0;e.icn3d.draw()},adjustIcon:function(){var e=this;1===e.STATENUMBER?$("#"+e.pre+"back").hasClass("icn3d-middleIcon")&&($("#"+e.pre+"back").toggleClass("icn3d-middleIcon"),$("#"+e.pre+"back").toggleClass("icn3d-endIcon")):$("#"+e.pre+"back").hasClass("icn3d-endIcon")&&($("#"+e.pre+"back").toggleClass("icn3d-middleIcon"),$("#"+e.pre+"back").toggleClass("icn3d-endIcon")),e.STATENUMBER===e.icn3d.commands.length?$("#"+e.pre+"forward").hasClass("icn3d-middleIcon")&&($("#"+e.pre+"forward").toggleClass("icn3d-middleIcon"),$("#"+e.pre+"forward").toggleClass("icn3d-endIcon")):$("#"+e.pre+"forward").hasClass("icn3d-endIcon")&&($("#"+e.pre+"forward").toggleClass("icn3d-middleIcon"),$("#"+e.pre+"forward").toggleClass("icn3d-endIcon"))},toggle:function(e,t,i,n){$("#"+e).toggleClass("ui-icon-plus"),$("#"+e).toggleClass("ui-icon-minus"),$("#"+t).toggleClass("ui-icon-plus"),$("#"+t).toggleClass("ui-icon-minus"),$("#"+e).toggleClass("icn3d-shown"),$("#"+e).toggleClass("icn3d-hidden"),$("#"+t).toggleClass("icn3d-shown"),$("#"+t).toggleClass("icn3d-hidden"),$("#"+i).toggleClass("icn3d-shown"),$("#"+i).toggleClass("icn3d-hidden"),$("#"+n).toggleClass("icn3d-shown"),$("#"+n).toggleClass("icn3d-hidden")},selectComplement:function(){var e=this,t={};for(var i in e.icn3d.atoms)e.icn3d.hAtoms.hasOwnProperty(i)||(t[i]=1);e.icn3d.hAtoms=e.icn3d.cloneHash(t),e.updateHlAll()},saveCommandsToSession:function(){var e=this.icn3d.commands.join("\n"),t=decodeURIComponent(e);sessionStorage.setItem("commands",t)},addChainLabels:function(e){var t=this,i=t.icn3d.intHash(t.icn3d.hAtoms,e);void 0===t.icn3d.labels.chain&&(t.icn3d.labels.chain=[]);var n=t.icn3d.getChainsFromAtoms(i);for(var r in n){var o={};o.position=t.icn3d.centerAtoms(t.icn3d.chains[r]).center;var s=r.indexOf("_"),a=r.substr(s+1),c=t.getProteinName(r);c.length>20&&(c=c.substr(0,20)+"..."),o.text="Chain "+a+": "+c,o.size=18;var l=t.icn3d.getFirstCalphaAtomObj(t.icn3d.chains[r]).color.getHexString().toUpperCase();o.color="CCCCCC"===l||"C8C8C8"===l?"#888888":"#"+l,o.background="#CCCCCC",t.icn3d.labels.chain.push(o)}t.icn3d.removeHlObjects()},addTerminiLabels:function(e){var t=this,i=t.icn3d.unionHash(t.icn3d.proteins,t.icn3d.nucleotides),n=t.icn3d.intHash(t.icn3d.dAtoms,i),r=t.icn3d.intHash(n,e);void 0===t.icn3d.labels.chain&&(t.icn3d.labels.chain=[]);var o=t.icn3d.getChainsFromAtoms(r);for(var s in o){var a=t.icn3d.intHash(n,t.icn3d.chains[s]),c=Object.keys(a),l=t.icn3d.atoms[c[0]],d=t.icn3d.atoms[c[c.length-1]],h={},u={};h.position=l.coord,u.position=d.coord,h.text="N-",u.text="C-",t.icn3d.nucleotides.hasOwnProperty(l.serial)&&(h.text="5'",u.text="3'"),h.size=18,u.size=18;var p=l.color.getHexString().toUpperCase(),m=d.color.getHexString().toUpperCase();h.color="CCCCCC"===p||"C8C8C8"===p?"#888888":"#"+p,u.color="CCCCCC"===m||"C8C8C8"===m?"#888888":"#"+m,h.background="#CCCCCC",u.background="#CCCCCC",t.icn3d.labels.chain.push(h),t.icn3d.labels.chain.push(u)}t.icn3d.removeHlObjects()},getCommandsBeforeCrash:function(){var e=this;window.addEventListener("load",function(){sessionStorage.setItem("good_exit","pending")}),window.addEventListener("beforeunload",function(){sessionStorage.setItem("good_exit","true")}),sessionStorage.getItem("good_exit")&&"pending"===sessionStorage.getItem("good_exit")&&(e.isMac()||(e.bCrashed=!0),e.commandsBeforeCrash=sessionStorage.getItem("commands"),e.commandsBeforeCrash||(e.commandsBeforeCrash=""))},addLineFromPicking:function(e){var t=this,i=$("#"+t.pre+e+"color").val(),n="stabilizer"!=e;t.setLogCmd("add line | x1 "+t.icn3d.pAtom.coord.x.toPrecision(4)+" y1 "+t.icn3d.pAtom.coord.y.toPrecision(4)+" z1 "+t.icn3d.pAtom.coord.z.toPrecision(4)+" | x2 "+t.icn3d.pAtom2.coord.x.toPrecision(4)+" y2 "+t.icn3d.pAtom2.coord.y.toPrecision(4)+" z2 "+t.icn3d.pAtom2.coord.z.toPrecision(4)+" | color "+i+" | dashed "+n+" | type "+e,!0),t.addLine(t.icn3d.pAtom.coord.x,t.icn3d.pAtom.coord.y,t.icn3d.pAtom.coord.z,t.icn3d.pAtom2.coord.x,t.icn3d.pAtom2.coord.y,t.icn3d.pAtom2.coord.z,i,n,e),t.icn3d.pickpair=!1},setEntrezLinks:function(e){var t,i=Object.keys(this.icn3d.structures);1===i.length?(this.setLogCmd("Entrez "+e+" about PDB "+i[0]+": "+(t="https://www.ncbi.nlm.nih.gov/"+e+"/?term="+i[0]),!1),window.open(t,"_blank")):2===i.length&&(this.setLogCmd("Entrez "+e+" about PDB "+i[0]+" OR "+i[1]+": "+(t="https://www.ncbi.nlm.nih.gov/"+e+"/?term="+i[0]+" OR "+i[1]),!1),window.open(t,"_blank"))},shareLink:function(){var e=this,t=e.shareLinkUrl();e.bInputfile?alert("Share Link does NOT work when the data is from custom files. Please save 'iCn3D PNG Image' in the File menu and open it in iCn3D."):t.length>4e3?alert("The url is more than 4000 characters and may not work. Please save 'iCn3D PNG Image' or 'State File' and open them in iCn3D."):(e.setLogCmd("share link: "+t,!1),$.ajax({url:"https://firebasedynamiclinks.googleapis.com/v1/shortLinks?key=AIzaSyBxl9CgM0dY5lagHL4UOhEpLWE1fuwdnvc",type:"POST",data:{longDynamicLink:"https://icn3d.page.link/?link="+encodeURIComponent(t)},dataType:"json",success:function(i){var n="Problem in getting shortened URL";void 0!==i.shortLink&&(n=i.shortLink),$("#"+e.pre+"ori_url").val(t),$("#"+e.pre+"short_url").val(n),e.openDialog(e.pre+"dl_copyurl","Copy a Share Link URL")},error:function(i,n,r){$("#"+e.pre+"ori_url").val(t),$("#"+e.pre+"short_url").val("Problem in getting shortened URL"),e.openDialog(e.pre+"dl_copyurl","Copy a Share Link URL")}}))},exportInteractions:function(){var e=this,t="<html><body><b>Interacting residues</b>:<br/><table border=1 cellpadding=0 cellspacing=0><tr><th>Base Chain: Residues</th><th>Interacting Chain</th></tr>";for(var i in e.chainname2residues)for(var n in e.chainname2residues[i]){var r=i.substr(0,i.indexOf("_"))+"_"+n.substr(0,n.indexOf(" "));t+="<tr><td>"+i+": ",t+=e.residueids2spec(e.chainname2residues[i][n]),t+="</td><td>"+r+"</td></tr>"}e.saveFile((e.inputid?e.inputid:"custom")+"_interactions.html","html",t+="</table><br/></body></html>")},saveColor:function(){for(var e in this.icn3d.atoms){var t=this.icn3d.atoms[e];t.colorSave=t.color.clone()}},applySavedColor:function(){var e=this;for(var t in e.icn3d.atoms){var i=e.icn3d.atoms[t];void 0!==i.colorSave&&(i.color=i.colorSave.clone())}e.icn3d.draw(),e.changeSeqColor(Object.keys(e.icn3d.residues))},saveStyle:function(){for(var e in this.icn3d.atoms){var t=this.icn3d.atoms[e];t.styleSave=t.style,void 0!==t.style2&&(t.style2Save=t.style2)}},applySavedStyle:function(){for(var e in this.icn3d.atoms){var t=this.icn3d.atoms[e];void 0!==t.styleSave&&(t.style=t.styleSave),void 0!==t.style2Save&&(t.style2=t.style2Save)}this.icn3d.draw()},clickBack:function(){var e=this;$("#"+e.pre+"back").add("#"+e.pre+"mn6_back").click(function(t){t.preventDefault(),e.setLogCmd("back",!1),e.back()})},clickForward:function(){var e=this;$("#"+e.pre+"forward").add("#"+e.pre+"mn6_forward").click(function(t){t.preventDefault(),e.setLogCmd("forward",!1),e.forward()})},clickToggle:function(){var e=this;$("#"+e.pre+"toggle").add("#"+e.pre+"mn2_toggle").click(function(t){e.toggleSelection(),e.setLogCmd("toggle selection",!0)})},clickHlColorYellow:function(){var e=this;$("#"+e.pre+"mn2_hl_clrYellow").click(function(t){e.setLogCmd("set highlight color yellow",!0),e.icn3d.hColor=new THREE.Color(16776960),e.icn3d.matShader=e.icn3d.setOutlineColor("yellow"),e.icn3d.draw()})},clickHlColorGreen:function(){var e=this;$("#"+e.pre+"mn2_hl_clrGreen").click(function(t){e.setLogCmd("set highlight color green",!0),e.icn3d.hColor=new THREE.Color(65280),e.icn3d.matShader=e.icn3d.setOutlineColor("green"),e.icn3d.draw()})},clickHlColorRed:function(){var e=this;$("#"+e.pre+"mn2_hl_clrRed").click(function(t){e.setLogCmd("set highlight color red",!0),e.icn3d.hColor=new THREE.Color(16711680),e.icn3d.matShader=e.icn3d.setOutlineColor("red"),e.icn3d.draw()})},clickHlStyleOutline:function(){var e=this;$("#"+e.pre+"mn2_hl_styleOutline").click(function(t){e.setLogCmd("set highlight style outline",!0),e.icn3d.bHighlight=1,e.showHighlight()})},clickHlStyleObject:function(){var e=this;$("#"+e.pre+"mn2_hl_styleObject").click(function(t){e.setLogCmd("set highlight style 3d",!0),e.icn3d.bHighlight=2,e.showHighlight()})},clickHlStyleNone:function(){var e=this;$("#"+e.pre+"mn2_hl_styleNone").click(function(t){t.stopImmediatePropagation(),e.clearHighlight(),e.setLogCmd("clear selection",!0)})},clickAlternate:function(){var e=this;$("#"+e.pre+"alternate").add("#"+e.pre+"mn2_alternate").click(function(t){e.icn3d.bAlternate=!0,e.icn3d.alternateStructures(),e.icn3d.bAlternate=!1,e.setLogCmd("alternate structures",!1)})},clkMn1_mmtfid:function(){var e=this;$("#"+e.pre+"mn1_mmtfid").click(function(t){e.openDialog(e.pre+"dl_mmtfid","Please input MMTF ID")})},clkMn1_pdbid:function(){var e=this;$("#"+e.pre+"mn1_pdbid").click(function(t){e.openDialog(e.pre+"dl_pdbid","Please input PDB ID")})},clkMn1_align:function(){var e=this;$("#"+e.pre+"mn1_align").click(function(t){e.openDialog(e.pre+"dl_align","Align two 3D structures")})},clkMn1_pdbfile:function(){var e=this;$("#"+e.pre+"mn1_pdbfile").click(function(t){e.openDialog(e.pre+"dl_pdbfile","Please input PDB File")})},clkMn1_mol2file:function(){var e=this;$("#"+e.pre+"mn1_mol2file").click(function(t){e.openDialog(e.pre+"dl_mol2file","Please input Mol2 File")})},clkMn1_sdffile:function(){var e=this;$("#"+e.pre+"mn1_sdffile").click(function(t){e.openDialog(e.pre+"dl_sdffile","Please input SDF File")})},clkMn1_xyzfile:function(){var e=this;$("#"+e.pre+"mn1_xyzfile").click(function(t){e.openDialog(e.pre+"dl_xyzfile","Please input XYZ File")})},clkMn1_urlfile:function(){var e=this;$("#"+e.pre+"mn1_urlfile").click(function(t){e.openDialog(e.pre+"dl_urlfile","Load data by URL")})},clkMn1_mmciffile:function(){var e=this;$("#"+e.pre+"mn1_mmciffile").click(function(t){e.openDialog(e.pre+"dl_mmciffile","Please input mmCIF File")})},clkMn1_mmcifid:function(){var e=this;$("#"+e.pre+"mn1_mmcifid").click(function(t){e.openDialog(e.pre+"dl_mmcifid","Please input mmCIF ID")})},clkMn1_mmdbid:function(){var e=this;$("#"+e.pre+"mn1_mmdbid").click(function(t){e.openDialog(e.pre+"dl_mmdbid","Please input MMDB ID")})},clkMn1_blast_rep_id:function(){var e=this;$("#"+e.pre+"mn1_blast_rep_id").click(function(t){e.openDialog(e.pre+"dl_blast_rep_id","Align sequence to structure")})},clkMn1_gi:function(){var e=this;$("#"+e.pre+"mn1_gi").click(function(t){e.openDialog(e.pre+"dl_gi","Please input protein gi")})},clkMn1_cid:function(){var e=this;$("#"+e.pre+"mn1_cid").click(function(t){e.openDialog(e.pre+"dl_cid","Please input PubChem CID")})},clkMn1_pngimage:function(){var e=this;$("#"+e.pre+"mn1_pngimage").click(function(t){e.openDialog(e.pre+"dl_pngimage","Please input the PNG image")})},clkMn1_state:function(){var e=this;$("#"+e.pre+"mn1_state").click(function(t){e.openDialog(e.pre+"dl_state","Please input the state file")})},clkMn1_selection:function(){var e=this;$("#"+e.pre+"mn1_selection").click(function(t){e.openDialog(e.pre+"dl_selection","Please input the selection file")})},clkMn1_exportState:function(){var e=this;$("#"+e.pre+"mn1_exportState").click(function(t){e.setLogCmd("export state file",!1),e.saveFile((e.inputid?e.inputid:"custom")+"_statefile.txt","command")})},exportStlFile:function(e){var t=this;void 0!==t.icn3d.biomtMatrices&&t.icn3d.biomtMatrices.length>1&&t.icn3d.bAssembly&&(t.icn3d.threshbox=180/Math.pow(t.icn3d.biomtMatrices.length,.33),t.icn3d.removeSurfaces(),t.icn3d.applySurfaceOptions(),t.icn3d.removeMaps(),t.icn3d.applyMapOptions(),t.icn3d.removeEmmaps(),t.icn3d.applyEmmapOptions());var i=t.saveStlFile(),n=t.inputid?t.inputid:"custom";if(t.saveFile(n+e+".stl","binary",i),void 0!==t.icn3d.biomtMatrices&&t.icn3d.biomtMatrices.length>1&&t.icn3d.bAssembly&&Object.keys(t.icn3d.dAtoms).length*t.icn3d.biomtMatrices.length>t.icn3d.maxAtoms3DMultiFile){alert(t.icn3d.biomtMatrices.length+" files will be generated for this assembly. Please merge these files using some software and 3D print the merged file.");var r=new THREE.Matrix4;r.identity();for(var o=1,s=0;s<t.icn3d.biomtMatrices.length;s++){var a=t.icn3d.biomtMatrices[s];if(void 0!==a&&!a.equals(r)){var c=100*(s+1);setTimeout((function(r,o){i=t.saveStlFile(r),t.saveFile(n+e+o+".stl","binary",i),i=""}).bind(this,a,o),c),++o}}t.icn3d.threshbox=180}},exportVrmlFile:function(e){var t=this;void 0!==t.icn3d.biomtMatrices&&t.icn3d.biomtMatrices.length>1&&t.icn3d.bAssembly&&(t.icn3d.threshbox=180/Math.pow(t.icn3d.biomtMatrices.length,.33),t.icn3d.removeSurfaces(),t.icn3d.applySurfaceOptions(),t.icn3d.removeMaps(),t.icn3d.applyMapOptions(),t.icn3d.removeEmmaps(),t.icn3d.applyEmmapOptions());var i=t.saveVrmlFile(),n=t.inputid?t.inputid:"custom";if(t.saveFile(n+e+".vrml","text",i),void 0!==t.icn3d.biomtMatrices&&t.icn3d.biomtMatrices.length>1&&t.icn3d.bAssembly&&Object.keys(t.icn3d.dAtoms).length*t.icn3d.biomtMatrices.length>t.icn3d.maxAtoms3DMultiFile){alert(t.icn3d.biomtMatrices.length+" files will be generated for this assembly. Please merge these files using some software and 3D print the merged file.");var r=new THREE.Matrix4;r.identity();for(var o=1,s=0;s<t.icn3d.biomtMatrices.length;s++){var a=t.icn3d.biomtMatrices[s];if(void 0!==a&&!a.equals(r)){var c=100*(s+1);setTimeout((function(r,o){i=t.saveVrmlFile(r),t.saveFile(n+e+o+".vrml","text",i),i=""}).bind(this,a,o),c),++o}}t.icn3d.threshbox=180}},clkMn1_exportStl:function(){var e=this;$("#"+e.pre+"mn1_exportStl").click(function(t){e.setLogCmd("export stl file",!1),e.exportStlFile("")})},clkMn1_exportVrml:function(){var e=this;$("#"+e.pre+"mn1_exportVrml").click(function(t){e.setLogCmd("export vrml file",!1),e.exportVrmlFile("")})},clkMn1_exportStlStab:function(){var e=this;$("#"+e.pre+"mn1_exportStlStab").click(function(t){e.setLogCmd("export stl stabilizer file",!1),e.hideStabilizer(),e.resetAfter3Dprint(),e.addStabilizer(),e.exportStlFile("_stab")})},clkMn1_exportVrmlStab:function(){var e=this;$("#"+e.pre+"mn1_exportVrmlStab").click(function(t){e.setLogCmd("export vrml stabilizer file",!1),e.hideStabilizer(),e.resetAfter3Dprint(),e.addStabilizer(),e.exportVrmlFile("_stab")})},clkMn6_exportInteraction:function(){var e=this;$("#"+e.pre+"mn6_exportInteraction").click(function(t){e.setLogCmd("export interactions",!1),e.exportInteractions()})},clkMn1_exportCanvas:function(){var e=this;$("#"+e.pre+"mn1_exportCanvas").add("#"+e.pre+"saveimage").click(function(t){e.setLogCmd("export canvas",!1),e.saveFile((e.inputid?e.inputid:"custom")+"_image_icn3d_loadable.png","png")})},clkMn1_exportCounts:function(){var e=this;$("#"+e.pre+"mn1_exportCounts").click(function(t){e.setLogCmd("export counts",!1);var i="<html><body><b>Total Count for atoms with coordinates</b>:<br/><table border=1><tr><th>Structure Count</th><th>Chain Count</th><th>Residue Count</th><th>Atom Count</th></tr>";i+="<tr><td>"+Object.keys(e.icn3d.structures).length+"</td><td>"+Object.keys(e.icn3d.chains).length+"</td><td>"+Object.keys(e.icn3d.residues).length+"</td><td>"+Object.keys(e.icn3d.atoms).length+"</td></tr>",i+="</table><br/>",i+="<b>Counts by Chain for atoms with coordinates</b>:<br/><table border=1><tr><th>Structure</th><th>Chain</th><th>Residue Count</th><th>Atom Count</th></tr>";for(var n=Object.keys(e.icn3d.chains),r=0,o=n.length;r<o;++r){var s=n[r],a=s.indexOf("_"),c=s.substr(0,a),l=s.substr(a+1),d={},h=e.icn3d.chains[s];for(var u in h)d[e.icn3d.atoms[u].resi]=1;i+="<tr><td>"+c+"</td><td>"+l+"</td><td>"+Object.keys(d).length+"</td><td>"+Object.keys(e.icn3d.chains[s]).length+"</td></tr>"}e.saveFile((e.inputid?e.inputid:"custom")+"_counts.html","html",i+="</table><br/></body></html>")})},clkMn1_exportSelections:function(){var e=this;$("#"+e.pre+"mn1_exportSelections").click(function(t){e.setLogCmd("export all selections",!1);var i=e.exportCustomAtoms();e.saveFile((e.inputid?e.inputid:"custom")+"_selections.txt","text",[i])})},clkMn1_sharelink:function(){var e=this;$("#"+e.pre+"mn1_sharelink").click(function(t){e.shareLink()})},clkMn1_link_structure:function(){var e=this;$("#"+e.pre+"mn1_link_structure").click(function(t){var i=e.getLinkToStructureSummary(!0);window.open(i,"_blank")})},clkMn1_link_bind:function(){var e=this;$("#"+e.pre+"mn1_link_bind").click(function(t){url="https://www.ncbi.nlm.nih.gov/pccompound?LinkName=pccompound_structure&from_uid="+e.inputid,e.setLogCmd("link to 3D protein structures bound to CID "+e.inputid+": "+url,!1),window.open(url,"_blank")})},clkMn1_link_vast:function(){var e=this;$("#"+e.pre+"mn1_link_vast").click(function(t){if(void 0===e.inputid)e.setLogCmd("link to compounds "+e.icn3d.molTitle+": "+(i="https://www.ncbi.nlm.nih.gov/pccompound?term="+e.icn3d.molTitle),!1);else{if(void 0!==e.cfg.cid)e.setLogCmd("link to compounds with structure similar to CID "+e.inputid+": "+(i="https://www.ncbi.nlm.nih.gov/pccompound?LinkName=pccompound_pccompound_3d&from_uid="+e.inputid),!1);else{var i,n=e.inputid.split("_");1===n.length?e.setLogCmd("link to structures similar to "+e.inputid+": "+(i="https://www.ncbi.nlm.nih.gov/Structure/vastplus/vastplus.cgi?uid="+e.inputid),!1):2===n.length&&e.setLogCmd("link to structures similar to "+n[0]+": "+(i="https://www.ncbi.nlm.nih.gov/Structure/vastplus/vastplus.cgi?uid="+n[0]),!1)}window.open(i,"_blank")}})},clkMn1_link_pubmed:function(){var e=this;$("#"+e.pre+"mn1_link_pubmed").click(function(t){if(void 0===e.inputid)e.setLogCmd("link to literature about "+e.icn3d.molTitle+": "+(n="https://www.ncbi.nlm.nih.gov/pubmed/?term="+e.icn3d.molTitle),!1),window.open(n,"_blank");else if(void 0!==e.pmid)1===(i=e.pmid.toString().split("_")).length?e.setLogCmd("link to PubMed ID "+e.pmid+": "+(n="https://www.ncbi.nlm.nih.gov/pubmed/"+e.pmid),!1):2===i.length&&e.setLogCmd("link to PubMed IDs "+i[0]+", "+i[1]+": "+(n="https://www.ncbi.nlm.nih.gov/pubmed/?term="+i[0]+" OR "+i[1]),!1),window.open(n,"_blank");else if(isNaN(e.inputid)){var i,n;1===(i=e.inputid.toString().split("_")).length?e.setLogCmd("link to literature about PDB "+e.inputid+": "+(n="https://www.ncbi.nlm.nih.gov/pubmed/?term="+e.inputid),!1):2===i.length&&e.setLogCmd("link to literature about PDB "+i[0]+" OR "+i[1]+": "+(n="https://www.ncbi.nlm.nih.gov/pubmed/?term="+i[0]+" OR "+i[1]),!1),window.open(n,"_blank")}else void 0!==e.cfg.cid?alert("No literature information is available for this compound in the SDF file."):alert("No literature information is available for this structure.")})},clkMn1_link_protein:function(){var e=this;$("#"+e.pre+"mn1_link_protein").click(function(t){for(var i=Object.keys(e.icn3d.structures),n=Object.keys(e.icn3d.chains),r="",o=0,s=n.length;o<s;++o){var a=e.icn3d.getFirstCalphaAtomObj(e.icn3d.chains[n[o]]);e.icn3d.proteins.hasOwnProperty(a.serial)&&6==n[o].length&&(r+=n[o]+"[accession] OR ")}r.length>0&&(r=r.substr(0,r.length-4));var c="https://www.ncbi.nlm.nih.gov/protein/?term="+r;e.setLogCmd("link to Entrez protein about PDB "+i+": "+c,!1),window.open(c,"_blank")})},clkMn2_selectannotations:function(){var e=this;$("#"+e.pre+"mn6_selectannotations").click(function(t){e.showAnnotations(),e.setLogCmd("view annotations",!0)})},clkMn2_selectall:function(){var e=this;$("#"+e.pre+"mn2_selectall").click(function(t){e.setLogCmd("select all",!0),e.selectAll(),e.removeHlAll(),e.icn3d.draw()}),$("#"+e.pre+"clearall").click(function(t){e.setLogCmd("clear all",!0),e.bSelectResidue=!1,e.selectAll(),e.removeHlAll(),e.icn3d.draw()})},clkMn2_selectcomplement:function(){var e=this;$("#"+e.pre+"mn2_selectcomplement").click(function(t){Object.keys(e.icn3d.hAtoms).length<Object.keys(e.icn3d.atoms).length&&(e.setLogCmd("select complement",!0),e.selectComplement())})},clkMn2_selectsidechains:function(){var e=this;$("#"+e.pre+"mn2_selectsidechains").click(function(t){e.setLogCmd("select side chains",!0),e.selectSideChains()})},clkMn2_alignment:function(){var e=this;$("#"+e.pre+"mn2_alignment").click(function(t){e.openDialog(e.pre+"dl_alignment","Select residues in aligned sequences")})},clkMn2_command:function(){var e=this;$("#"+e.pre+"mn2_command").click(function(t){e.openDialog(e.pre+"dl_advanced2","Select by specification")})},clkMn2_definedsets:function(){var e=this;$("#"+e.pre+"mn2_definedsets").add("#"+e.pre+"definedsets").click(function(t){e.showSets(),e.setLogCmd("defined sets",!0)}),$("#"+e.pre+"setOr").click(function(t){e.setOperation="or"}),$("#"+e.pre+"setAnd").click(function(t){e.setOperation="and"}),$("#"+e.pre+"setNot").click(function(t){e.setOperation="not"})},clkMn2_pkNo:function(){var e=this;$("#"+e.pre+"mn2_pkNo").click(function(t){e.icn3d.pk=0,e.icn3d.opts.pk="no",e.setLogCmd("set pk off",!0),e.icn3d.draw(),e.icn3d.removeHlObjects()})},clkMn2_pkYes:function(){var e=this;$("#"+e.pre+"mn2_pkYes").click(function(t){e.icn3d.pk=1,e.icn3d.opts.pk="atom",e.setLogCmd("set pk atom",!0)})},clkMn2_pkResidue:function(){var e=this;$("#"+e.pre+"mn2_pkResidue").click(function(t){e.icn3d.pk=2,e.icn3d.opts.pk="residue",e.setLogCmd("set pk residue",!0)})},clkMn2_pkStrand:function(){var e=this;$("#"+e.pre+"mn2_pkStrand").click(function(t){e.icn3d.pk=3,e.icn3d.opts.pk="strand",e.setLogCmd("set pk strand",!0)})},clkMn2_pkChain:function(){var e=this;$("#"+e.pre+"mn2_pkChain").click(function(t){e.icn3d.pk=4,e.icn3d.opts.pk="chain",e.setLogCmd("set pk chain",!0)})},clkMn2_aroundsphere:function(){var e=this;$("#"+e.pre+"mn2_aroundsphere").click(function(t){e.openDialog(e.pre+"dl_aroundsphere","Select a sphere around current selection")})},clkMn2_select_chain:function(){var e=this;$("#"+e.pre+"mn2_select_chain").add("#"+e.pre+"definedSets").click(function(t){e.openDialog(e.pre+"dl_select_chain","Select Structure/Chain/Custom Selection")})},clkMn3_proteinsRibbon:function(){var e=this;$("#"+e.pre+"mn3_proteinsRibbon").click(function(t){e.setStyle("proteins","ribbon"),e.setLogCmd("style proteins ribbon",!0)})},clkMn3_proteinsStrand:function(){var e=this;$("#"+e.pre+"mn3_proteinsStrand").click(function(t){e.setStyle("proteins","strand"),e.setLogCmd("style proteins strand",!0)})},clkMn3_proteinsCylinder:function(){var e=this;$("#"+e.pre+"mn3_proteinsCylinder").click(function(t){e.setStyle("proteins","cylinder and plate"),e.setLogCmd("style proteins cylinder and plate",!0)})},clkMn3_proteinsSchematic:function(){var e=this;$("#"+e.pre+"mn3_proteinsSchematic").click(function(t){e.setStyle("proteins","schematic"),e.setLogCmd("style proteins schematic",!0)})},clkMn3_proteinsCalpha:function(){var e=this;$("#"+e.pre+"mn3_proteinsCalpha").click(function(t){e.setStyle("proteins","c alpha trace"),e.setLogCmd("style proteins c alpha trace",!0)})},clkMn3_proteinsBfactor:function(){var e=this;$("#"+e.pre+"mn3_proteinsBfactor").click(function(t){e.setStyle("proteins","b factor tube"),e.setLogCmd("style proteins b factor tube",!0)})},clkMn3_proteinsLines:function(){var e=this;$("#"+e.pre+"mn3_proteinsLines").click(function(t){e.setStyle("proteins","lines"),e.setLogCmd("style proteins lines",!0)})},clkMn3_proteinsStick:function(){var e=this;$("#"+e.pre+"mn3_proteinsStick").click(function(t){e.setStyle("proteins","stick"),e.setLogCmd("style proteins stick",!0)})},clkMn3_proteinsBallstick:function(){var e=this;$("#"+e.pre+"mn3_proteinsBallstick").click(function(t){e.setStyle("proteins","ball and stick"),e.setLogCmd("style proteins ball and stick",!0)})},clkMn3_proteinsSphere:function(){var e=this;$("#"+e.pre+"mn3_proteinsSphere").click(function(t){e.setStyle("proteins","sphere"),e.setLogCmd("style proteins sphere",!0)})},clkMn3_proteinsNo:function(){var e=this;$("#"+e.pre+"mn3_proteinsNo").click(function(t){e.setStyle("proteins","nothing"),e.setLogCmd("style proteins nothing",!0)})},clkMn3_sidecLines:function(){var e=this;$("#"+e.pre+"mn3_sidecLines").click(function(t){e.setStyle("sidec","lines"),e.setLogCmd("style sidec lines",!0)})},clkMn3_sidecStick:function(){var e=this;$("#"+e.pre+"mn3_sidecStick").click(function(t){e.setStyle("sidec","stick"),e.setLogCmd("style sidec stick",!0)})},clkMn3_sidecBallstick:function(){var e=this;$("#"+e.pre+"mn3_sidecBallstick").click(function(t){e.setStyle("sidec","ball and stick"),e.setLogCmd("style sidec ball and stick",!0)})},clkMn3_sidecSphere:function(){var e=this;$("#"+e.pre+"mn3_sidecSphere").click(function(t){e.setStyle("sidec","sphere"),e.setLogCmd("style sidec sphere",!0)})},clkMn3_sidecNo:function(){var e=this;$("#"+e.pre+"mn3_sidecNo").click(function(t){e.setStyle("sidec","nothing"),e.setLogCmd("style sidec nothing",!0)})},clkMn3_nuclCartoon:function(){var e=this;$("#"+e.pre+"mn3_nuclCartoon").click(function(t){e.setStyle("nucleotides","nucleotide cartoon"),e.setLogCmd("style nucleotides nucleotide cartoon",!0)})},clkMn3_nuclSchematic:function(){var e=this;$("#"+e.pre+"mn3_nuclSchematic").click(function(t){e.setStyle("nucleotides","schematic"),e.setLogCmd("style nucleotides schematic",!0)})},clkMn3_nuclPhos:function(){var e=this;$("#"+e.pre+"mn3_nuclPhos").click(function(t){e.setStyle("nucleotides","o3 trace"),e.setLogCmd("style nucleotides o3 trace",!0)})},clkMn3_nuclLines:function(){var e=this;$("#"+e.pre+"mn3_nuclLines").click(function(t){e.setStyle("nucleotides","lines"),e.setLogCmd("style nucleotides lines",!0)})},clkMn3_nuclStick:function(){var e=this;$("#"+e.pre+"mn3_nuclStick").click(function(t){e.setStyle("nucleotides","stick"),e.setLogCmd("style nucleotides stick",!0)})},clkMn3_nuclBallstick:function(){var e=this;$("#"+e.pre+"mn3_nuclBallstick").click(function(t){e.setStyle("nucleotides","ball and stick"),e.setLogCmd("style nucleotides ball and stick",!0)})},clkMn3_nuclSphere:function(){var e=this;$("#"+e.pre+"mn3_nuclSphere").click(function(t){e.setStyle("nucleotides","sphere"),e.setLogCmd("style nucleotides sphere",!0)})},clkMn3_nuclNo:function(){var e=this;$("#"+e.pre+"mn3_nuclNo").click(function(t){e.setStyle("nucleotides","nothing"),e.setLogCmd("style nucleotides nothing",!0)})},clkMn3_ligLines:function(){var e=this;$("#"+e.pre+"mn3_ligLines").click(function(t){e.setStyle("chemicals","lines"),e.setLogCmd("style chemicals lines",!0)})},clkMn3_ligStick:function(){var e=this;$("#"+e.pre+"mn3_ligStick").click(function(t){e.setStyle("chemicals","stick"),e.setLogCmd("style chemicals stick",!0)})},clkMn3_ligBallstick:function(){var e=this;$("#"+e.pre+"mn3_ligBallstick").click(function(t){e.setStyle("chemicals","ball and stick"),e.setLogCmd("style chemicals ball and stick",!0)})},clkMn3_ligSchematic:function(){var e=this;$("#"+e.pre+"mn3_ligSchematic").click(function(t){e.setStyle("chemicals","schematic"),e.setLogCmd("style chemicals schematic",!0)})},clkMn3_ligSphere:function(){var e=this;$("#"+e.pre+"mn3_ligSphere").click(function(t){e.setStyle("chemicals","sphere"),e.setLogCmd("style chemicals sphere",!0)})},clkMn3_ligNo:function(){var e=this;$("#"+e.pre+"mn3_ligNo").click(function(t){e.setStyle("chemicals","nothing"),e.setLogCmd("style chemicals nothing",!0)})},clkMn3_ionsSphere:function(){var e=this;$("#"+e.pre+"mn3_ionsSphere").click(function(t){e.setStyle("ions","sphere"),e.setLogCmd("style ions sphere",!0)})},clkMn3_ionsDot:function(){var e=this;$("#"+e.pre+"mn3_ionsDot").click(function(t){e.setStyle("ions","dot"),e.setLogCmd("style ions dot",!0)})},clkMn3_ionsNo:function(){var e=this;$("#"+e.pre+"mn3_ionsNo").click(function(t){e.setStyle("ions","nothing"),e.setLogCmd("style ions nothing",!0)})},clkMn3_waterSphere:function(){var e=this;$("#"+e.pre+"mn3_waterSphere").click(function(t){e.setStyle("water","sphere"),e.setLogCmd("style water sphere",!0)})},clkMn3_waterDot:function(){var e=this;$("#"+e.pre+"mn3_waterDot").click(function(t){e.setStyle("water","dot"),e.setLogCmd("style water dot",!0)})},clkMn3_waterNo:function(){var e=this;$("#"+e.pre+"mn3_waterNo").click(function(t){e.setStyle("water","nothing"),e.setLogCmd("style water nothing",!0)})},clkMn4_clrSpectrum:function(){var e=this;$("#"+e.pre+"mn4_clrSpectrum").click(function(t){e.setOption("color","spectrum"),e.setLogCmd("color spectrum",!0)})},clkMn4_clrChain:function(){var e=this;$("#"+e.pre+"mn4_clrChain").click(function(t){e.setOption("color","chain"),e.setLogCmd("color chain",!0)})},clkMn4_clrSSGreen:function(){var e=this;$("#"+e.pre+"mn4_clrSSGreen").click(function(t){e.icn3d.sheetcolor="green",e.setOption("color","secondary structure"),e.setLogCmd("color secondary structure",!0)})},clkMn4_clrSSYellow:function(){var e=this;$("#"+e.pre+"mn4_clrSSYellow").click(function(t){e.icn3d.sheetcolor="yellow",e.setOption("color","secondary structure yellow"),e.setLogCmd("color secondary structure yellow",!0)})},clkMn4_clrResidue:function(){var e=this;$("#"+e.pre+"mn4_clrResidue").click(function(t){e.setOption("color","residue"),e.setLogCmd("color residue",!0)})},clkMn4_clrCharge:function(){var e=this;$("#"+e.pre+"mn4_clrCharge").click(function(t){e.setOption("color","charge"),e.setLogCmd("color charge",!0)})},clkMn4_clrHydrophobic:function(){var e=this;$("#"+e.pre+"mn4_clrHydrophobic").click(function(t){e.setOption("color","hydrophobic"),e.setLogCmd("color hydrophobic",!0)})},clkMn4_clrAtom:function(){var e=this;$("#"+e.pre+"mn4_clrAtom").click(function(t){e.setOption("color","atom"),e.setLogCmd("color atom",!0)})},clkMn4_clrBfactor:function(){var e=this;$("#"+e.pre+"mn4_clrBfactor").click(function(t){e.setOption("color","b factor"),e.setLogCmd("color b factor",!0)})},clkMn4_clrBfactorNorm:function(){var e=this;$("#"+e.pre+"mn4_clrBfactorNorm").click(function(t){e.setOption("color","b factor percentile"),e.setLogCmd("color b factor percentile",!0)})},clkMn4_clrIdentity:function(){var e=this;$("#"+e.pre+"mn4_clrIdentity").click(function(t){e.setOption("color","identity"),e.setLogCmd("color identity",!0)})},clkMn4_clrConserved:function(){var e=this;$("#"+e.pre+"mn4_clrConserved").click(function(t){e.setOption("color","conservation"),e.setLogCmd("color conservation",!0)})},clkMn4_clrRed:function(){var e=this;$("#"+e.pre+"mn4_clrRed").click(function(t){e.setOption("color","red"),e.setLogCmd("color red",!0)})},clkMn4_clrGreen:function(){var e=this;$("#"+e.pre+"mn4_clrGreen").click(function(t){e.setOption("color","green"),e.setLogCmd("color green",!0)})},clkMn4_clrBlue:function(){var e=this;$("#"+e.pre+"mn4_clrBlue").click(function(t){e.setOption("color","blue"),e.setLogCmd("color blue",!0)})},clkMn4_clrMagenta:function(){var e=this;$("#"+e.pre+"mn4_clrMagenta").click(function(t){e.setOption("color","magenta"),e.setLogCmd("color magenta",!0)})},clkMn4_clrYellow:function(){var e=this;$("#"+e.pre+"mn4_clrYellow").click(function(t){e.setOption("color","yellow"),e.setLogCmd("color yellow",!0)})},clkMn4_clrCyan:function(){var e=this;$("#"+e.pre+"mn4_clrCyan").click(function(t){e.setOption("color","cyan"),e.setLogCmd("color cyan",!0)})},clkMn4_clrWhite:function(){var e=this;$("#"+e.pre+"mn4_clrWhite").click(function(t){e.setOption("color","white"),e.setLogCmd("color white",!0)})},clkMn4_clrGrey:function(){var e=this;$("#"+e.pre+"mn4_clrGrey").click(function(t){e.setOption("color","grey"),e.setLogCmd("color grey",!0)})},clkMn4_clrCustom:function(){var e=this;$("#"+e.pre+"mn4_clrCustom").click(function(t){e.openDialog(e.pre+"dl_clr","Color picker")})},clkMn4_clrSave:function(){var e=this;$("#"+e.pre+"mn4_clrSave").click(function(t){e.saveColor(),e.setLogCmd("save color",!0)})},clkMn4_clrApplySave:function(){var e=this;$("#"+e.pre+"mn4_clrApplySave").click(function(t){e.applySavedColor(),e.setLogCmd("apply saved color",!0)})},clkMn3_styleSave:function(){var e=this;$("#"+e.pre+"mn3_styleSave").click(function(t){e.saveStyle(),e.setLogCmd("save style",!0)})},clkMn3_styleApplySave:function(){var e=this;$("#"+e.pre+"mn3_styleApplySave").click(function(t){e.applySavedStyle(),e.setLogCmd("apply saved style",!0)})},clkMn5_neighborsYes:function(){var e=this;$("#"+e.pre+"mn5_neighborsYes").click(function(t){e.icn3d.bConsiderNeighbors=!0,e.icn3d.removeLastSurface(),e.icn3d.applySurfaceOptions(),e.icn3d.render(),e.setLogCmd("set surface neighbors on",!0)})},clkMn5_neighborsNo:function(){var e=this;$("#"+e.pre+"mn5_neighborsNo").click(function(t){e.icn3d.bConsiderNeighbors=!1,e.icn3d.removeLastSurface(),e.icn3d.applySurfaceOptions(),e.icn3d.render(),e.setLogCmd("set surface neighbors off",!0)})},clkMn5_surfaceVDW:function(){var e=this;$("#"+e.pre+"mn5_surfaceVDW").click(function(t){e.icn3d.bConsiderNeighbors=!1,e.setOption("surface","Van der Waals surface"),e.setLogCmd("set surface Van der Waals surface",!0)})},clkMn5_surfaceSAS:function(){var e=this;$("#"+e.pre+"mn5_surfaceSAS").click(function(t){e.icn3d.bConsiderNeighbors=!1,e.setOption("surface","solvent accessible surface"),e.setLogCmd("set surface solvent accessible surface",!0)})},clkMn5_surfaceMolecular:function(){var e=this;$("#"+e.pre+"mn5_surfaceMolecular").click(function(t){e.icn3d.bConsiderNeighbors=!1,e.setOption("surface","molecular surface"),e.setLogCmd("set surface molecular surface",!0)})},clkMn5_surfaceVDWContext:function(){var e=this;$("#"+e.pre+"mn5_surfaceVDWContext").click(function(t){e.icn3d.bConsiderNeighbors=!0,e.setOption("surface","Van der Waals surface with context"),e.setLogCmd("set surface Van der Waals surface with context",!0)})},clkMn5_surfaceSASContext:function(){var e=this;$("#"+e.pre+"mn5_surfaceSASContext").click(function(t){e.icn3d.bConsiderNeighbors=!0,e.setOption("surface","solvent accessible surface with context"),e.setLogCmd("set surface solvent accessible surface with context",!0)})},clkMn5_surfaceMolecularContext:function(){var e=this;$("#"+e.pre+"mn5_surfaceMolecularContext").click(function(t){e.icn3d.bConsiderNeighbors=!0,e.setOption("surface","molecular surface with context"),e.setLogCmd("set surface molecular surface with context",!0)})},clkMn5_surfaceNo:function(){var e=this;$("#"+e.pre+"mn5_surfaceNo").click(function(t){e.setOption("surface","nothing"),e.setLogCmd("set surface nothing",!0)})},clkMn5_opacity10:function(){var e=this;$("#"+e.pre+"mn5_opacity10").click(function(t){e.setOption("opacity","1.0"),e.setLogCmd("set surface opacity 1.0",!0)})},clkMn5_opacity09:function(){var e=this;$("#"+e.pre+"mn5_opacity09").click(function(t){e.setOption("opacity","0.9"),e.setLogCmd("set surface opacity 0.9",!0)})},clkMn5_opacity08:function(){var e=this;$("#"+e.pre+"mn5_opacity08").click(function(t){e.setOption("opacity","0.8"),e.setLogCmd("set surface opacity 0.8",!0)})},clkMn5_opacity07:function(){var e=this;$("#"+e.pre+"mn5_opacity07").click(function(t){e.setOption("opacity","0.7"),e.setLogCmd("set surface opacity 0.7",!0)})},clkMn5_opacity06:function(){var e=this;$("#"+e.pre+"mn5_opacity06").click(function(t){e.setOption("opacity","0.6"),e.setLogCmd("set surface opacity 0.6",!0)})},clkMn5_opacity05:function(){var e=this;$("#"+e.pre+"mn5_opacity05").click(function(t){e.setOption("opacity","0.5"),e.setLogCmd("set surface opacity 0.5",!0)})},clkMn5_opacity04:function(){var e=this;$("#"+e.pre+"mn5_opacity04").click(function(t){e.setOption("opacity","0.4"),e.setLogCmd("set surface opacity 0.4",!0)})},clkMn5_opacity03:function(){var e=this;$("#"+e.pre+"mn5_opacity03").click(function(t){e.setOption("opacity","0.3"),e.setLogCmd("set surface opacity 0.3",!0)})},clkMn5_opacity02:function(){var e=this;$("#"+e.pre+"mn5_opacity02").click(function(t){e.setOption("opacity","0.2"),e.setLogCmd("set surface opacity 0.2",!0)})},clkMn5_opacity01:function(){var e=this;$("#"+e.pre+"mn5_opacity01").click(function(t){e.setOption("opacity","0.1"),e.setLogCmd("set surface opacity 0.1",!0)})},clkMn5_wireframeYes:function(){var e=this;$("#"+e.pre+"mn5_wireframeYes").click(function(t){e.setOption("wireframe","yes"),e.setLogCmd("set surface wireframe on",!0)})},clkMn5_wireframeNo:function(){var e=this;$("#"+e.pre+"mn5_wireframeNo").click(function(t){e.setOption("wireframe","no"),e.setLogCmd("set surface wireframe off",!0)})},clkMn5_elecmap2fofc:function(){var e=this;$("#"+e.pre+"mn5_elecmap2fofc").click(function(t){e.openDialog(e.pre+"dl_elecmap2fofc","2Fo-Fc Electron Density Map")})},clkMn5_elecmapfofc:function(){var e=this;$("#"+e.pre+"mn5_elecmapfofc").click(function(t){e.openDialog(e.pre+"dl_elecmapfofc","Fo-Fc Electron Density Map")})},clkMn5_elecmapNo:function(){var e=this;$("#"+e.pre+"mn5_elecmapNo").add("#"+e.pre+"elecmapNo2").add("#"+e.pre+"elecmapNo3").click(function(t){e.setOption("map","nothing"),e.setLogCmd("set map nothing",!0)})},clickApplymap2fofc:function(){var e=this;$("#"+e.pre+"applymap2fofc").click(function(t){t.preventDefault();var i=parseFloat($("#"+e.pre+"sigma2fofc").val());e.Dsn6Parser(e.inputid,"2fofc",i),e.setLogCmd("set map 2fofc sigma "+i+";",!0)})},clickApplymapfofc:function(){var e=this;$("#"+e.pre+"applymapfofc").click(function(t){t.preventDefault();var i=parseFloat($("#"+e.pre+"sigmafofc").val());e.Dsn6Parser(e.inputid,"fofc",i),e.setLogCmd("set map fofc sigma "+i+";",!0)})},clkMn5_mapwireframeYes:function(){var e=this;$("#"+e.pre+"mn5_mapwireframeYes").click(function(t){e.setOption("mapwireframe","yes"),e.setLogCmd("set map wireframe on",!0)})},clkMn5_mapwireframeNo:function(){var e=this;$("#"+e.pre+"mn5_mapwireframeNo").click(function(t){e.setOption("mapwireframe","no"),e.setLogCmd("set map wireframe off",!0)})},clkMn5_emmap:function(){var e=this;$("#"+e.pre+"mn5_emmap").click(function(t){e.openDialog(e.pre+"dl_emmap","EM Density Map")})},clkMn5_emmapNo:function(){var e=this;$("#"+e.pre+"mn5_emmapNo").add("#"+e.pre+"emmapNo2").click(function(t){e.setOption("emmap","nothing"),e.setLogCmd("set emmap nothing",!0)})},clickApplyemmap:function(){var e=this;$("#"+e.pre+"applyemmap").click(function(t){t.preventDefault();var i=parseFloat($("#"+e.pre+"empercentage").val());e.DensityCifParser(e.inputid,"em",i,e.icn3d.emd),e.setLogCmd("set emmap percentage "+i+";",!0)})},clkMn5_emmapwireframeYes:function(){var e=this;$("#"+e.pre+"mn5_emmapwireframeYes").click(function(t){e.setOption("emmapwireframe","yes"),e.setLogCmd("set emmap wireframe on",!0)})},clkMn5_emmapwireframeNo:function(){var e=this;$("#"+e.pre+"mn5_emmapwireframeNo").click(function(t){e.setOption("emmapwireframe","no"),e.setLogCmd("set emmap wireframe off",!0)})},clkMn6_assemblyYes:function(){var e=this;$("#"+e.pre+"mn6_assemblyYes").click(function(t){e.icn3d.bAssembly=!0,e.setLogCmd("set assembly on",!0),e.icn3d.draw()})},clkMn6_assemblyNo:function(){var e=this;$("#"+e.pre+"mn6_assemblyNo").click(function(t){e.icn3d.bAssembly=!1,e.setLogCmd("set assembly off",!0),e.icn3d.draw()})},clkMn6_addlabelResidues:function(){var e=this;$("#"+e.pre+"mn6_addlabelResidues").click(function(t){e.icn3d.addResiudeLabels(e.icn3d.hAtoms),e.saveSelectionIfSelected(),e.setLogCmd("add residue labels",!0),e.icn3d.draw()})},clkMn6_addlabelChains:function(){var e=this;$("#"+e.pre+"mn6_addlabelChains").click(function(t){e.addChainLabels(e.icn3d.hAtoms),e.saveSelectionIfSelected(),e.setLogCmd("add chain labels",!0),e.icn3d.draw()})},clkMn6_addlabelTermini:function(){var e=this;$("#"+e.pre+"mn6_addlabelTermini").click(function(t){e.addTerminiLabels(e.icn3d.hAtoms),e.saveSelectionIfSelected(),e.setLogCmd("add terminal labels",!0),e.icn3d.draw()})},clkMn6_addlabelYes:function(){var e=this;$("#"+e.pre+"mn6_addlabelYes").click(function(t){e.openDialog(e.pre+"dl_addlabel","Add custom labels by selection"),e.icn3d.pk=1,e.icn3d.opts.pk="atom",e.icn3d.pickpair=!0,e.icn3d.pAtomNum=0})},clkMn6_addlabelSelection:function(){var e=this;$("#"+e.pre+"mn6_addlabelSelection").click(function(t){e.openDialog(e.pre+"dl_addlabelselection","Add custom labels by the current selection")})},clkMn2_saveselection:function(){var e=this;$("#"+e.pre+"mn2_saveselection").click(function(t){e.openDialog(e.pre+"dl_saveselection","Save the current selection")})},clkMn6_addlabelNo:function(){var e=this;$("#"+e.pre+"mn6_addlabelNo").add("#"+e.pre+"removeLabels").click(function(t){for(var i in e.icn3d.pickpair=!1,e.setLogCmd("set labels off",!0),e.icn3d.labels)e.icn3d.labels[i]=[];e.icn3d.draw()})},clkMn6_distanceYes:function(){var e=this;$("#"+e.pre+"mn6_distanceYes").click(function(t){e.openDialog(e.pre+"dl_distance","Measure the distance of atoms"),e.icn3d.pk=1,e.icn3d.opts.pk="atom",e.icn3d.pickpair=!0,e.icn3d.pAtomNum=0,e.bMeasureDistance=!0})},clkMn6_distanceNo:function(){var e=this;$("#"+e.pre+"mn6_distanceNo").click(function(t){e.icn3d.pickpair=!1,e.setLogCmd("set lines off",!0),e.icn3d.labels.distance=[],e.icn3d.lines.distance=[],e.icn3d.pk=2,e.icn3d.draw()})},clkMn2_selectedcenter:function(){var e=this;$("#"+e.pre+"mn2_selectedcenter").add("#"+e.pre+"zoomin_selection").click(function(t){e.icn3d.zoominSelection(),e.icn3d.draw(),e.setLogCmd("zoom selection",!0)})},clkMn6_center:function(){var e=this;$("#"+e.pre+"mn6_center").click(function(t){e.icn3d.centerSelection(),e.icn3d.draw(),e.setLogCmd("center selection",!0)})},clkMn6_resetOrientation:function(){var e=this;$("#"+e.pre+"mn6_resetOrientation").add("#"+e.pre+"resetOrientation").click(function(t){e.icn3d.resetOrientation(),e.icn3d.applyOriginalColor(),e.icn3d.draw(),e.setLogCmd("reset orientation",!0)})},clkMn6_chemicalbindingshow:function(){var e=this;$("#"+e.pre+"mn6_chemicalbindingshow").add("#"+e.pre+"chemicalbindingshow").click(function(t){e.setOption("chemicalbinding","show"),e.setLogCmd("set chemicalbinding show",!0)})},clkMn6_chemicalbindinghide:function(){var e=this;$("#"+e.pre+"mn6_chemicalbindinghide").add("#"+e.pre+"chemicalbindinghide").click(function(t){e.setOption("chemicalbinding","hide"),e.setLogCmd("set chemicalbinding hide",!0)})},clkMn6_rotateleft:function(){var e=this;$("#"+e.pre+"mn6_rotateleft").click(function(t){e.setLogCmd("rotate left",!0),e.icn3d.bStopRotate=!1,e.icn3d.rotateCount=0,e.icn3d.rotateCountMax=6e3,e.ROT_DIR="left",e.rotStruc("left")})},clkMn6_rotateright:function(){var e=this;$("#"+e.pre+"mn6_rotateright").click(function(t){e.setLogCmd("rotate right",!0),e.icn3d.bStopRotate=!1,e.icn3d.rotateCount=0,e.icn3d.rotateCountMax=6e3,e.ROT_DIR="right",e.rotStruc("right")})},clkMn6_rotateup:function(){var e=this;$("#"+e.pre+"mn6_rotateup").click(function(t){e.setLogCmd("rotate up",!0),e.icn3d.bStopRotate=!1,e.icn3d.rotateCount=0,e.icn3d.rotateCountMax=6e3,e.ROT_DIR="up",e.rotStruc("up")})},clkMn6_rotatedown:function(){var e=this;$("#"+e.pre+"mn6_rotatedown").click(function(t){e.setLogCmd("rotate down",!0),e.icn3d.bStopRotate=!1,e.icn3d.rotateCount=0,e.icn3d.rotateCountMax=6e3,e.ROT_DIR="down",e.rotStruc("down")})},clkMn6_cameraPers:function(){var e=this;$("#"+e.pre+"mn6_cameraPers").click(function(t){e.setOption("camera","perspective"),e.setLogCmd("set camera perspective",!0)})},clkMn6_cameraOrth:function(){var e=this;$("#"+e.pre+"mn6_cameraOrth").click(function(t){e.setOption("camera","orthographic"),e.setLogCmd("set camera orthographic",!0)})},clkMn6_bkgdBlack:function(){var e=this;$("#"+e.pre+"mn6_bkgdBlack").click(function(t){e.setOption("background","black"),e.setLogCmd("set background black",!0)})},clkMn6_bkgdGrey:function(){var e=this;$("#"+e.pre+"mn6_bkgdGrey").click(function(t){e.setOption("background","grey"),e.setLogCmd("set background grey",!0)})},clkMn6_bkgdWhite:function(){var e=this;$("#"+e.pre+"mn6_bkgdWhite").click(function(t){e.setOption("background","white"),e.setLogCmd("set background white",!0)})},clkMn6_bkgdTransparent:function(){var e=this;$("#"+e.pre+"mn6_bkgdTransparent").click(function(t){e.setOption("background","transparent"),e.setLogCmd("set background transparent",!0)})},clkMn6_showfogYes:function(){var e=this;$("#"+e.pre+"mn6_showfogYes").click(function(t){e.setOption("fog","yes"),e.setLogCmd("set fog on",!0)})},clkMn6_showfogNo:function(){var e=this;$("#"+e.pre+"mn6_showfogNo").click(function(t){e.setOption("fog","no"),e.setLogCmd("set fog off",!0)})},clkMn6_showslabYes:function(){var e=this;$("#"+e.pre+"mn6_showslabYes").click(function(t){e.setOption("slab","yes"),e.setLogCmd("set slab on",!0)})},clkMn6_showslabNo:function(){var e=this;$("#"+e.pre+"mn6_showslabNo").click(function(t){e.setOption("slab","no"),e.setLogCmd("set slab off",!0)})},clkMn6_showaxisYes:function(){var e=this;$("#"+e.pre+"mn6_showaxisYes").click(function(t){e.setOption("axis","yes"),e.setLogCmd("set axis on",!0)})},clkMn6_showaxisNo:function(){var e=this;$("#"+e.pre+"mn6_showaxisNo").click(function(t){e.setOption("axis","no"),e.setLogCmd("set axis off",!0)})},clkMn6_hbondsYes:function(){var e=this;$("#"+e.pre+"mn6_hbondsYes").click(function(t){e.openDialog(e.pre+"dl_hbonds","Hydrogen bonds to selection")})},clkMn6_hbondsNo:function(){var e=this;$("#"+e.pre+"mn6_hbondsNo").click(function(t){e.setLogCmd("set hbonds off",!0),e.icn3d.hideHbonds(),e.icn3d.draw()})},clkmn1_stabilizerYes:function(){var e=this;$("#"+e.pre+"mn1_stabilizerYes").click(function(t){e.addStabilizer(),e.prepareFor3Dprint(),e.setLogCmd("stabilizer",!0)})},clkmn1_stabilizerNo:function(){var e=this;$("#"+e.pre+"mn1_stabilizerNo").click(function(t){e.setLogCmd("set stabilizer off",!0),e.hideStabilizer(),e.icn3d.draw()})},clkmn1_stabilizerOne:function(){var e=this;$("#"+e.pre+"mn1_stabilizerOne").click(function(t){e.openDialog(e.pre+"dl_stabilizer","Add One Stabilizer"),e.icn3d.pk=1,e.icn3d.opts.pk="atom",e.icn3d.pickpair=!0,e.icn3d.pAtomNum=0})},clkmn1_stabilizerRmOne:function(){var e=this;$("#"+e.pre+"mn1_stabilizerRmOne").click(function(t){e.openDialog(e.pre+"dl_stabilizer_rm","Remove One Stabilizer"),e.icn3d.pk=1,e.icn3d.opts.pk="atom",e.icn3d.pickpair=!0,e.icn3d.pAtomNum=0})},clkmn1_thicknessSet:function(){var e=this;$("#"+e.pre+"mn1_thicknessSet").click(function(t){e.openDialog(e.pre+"dl_thickness","Set Thickness for 3D Printing")})},clkmn5_setThickness:function(){var e=this;$("#"+e.pre+"mn3_setThickness").click(function(t){e.openDialog(e.pre+"dl_thickness2","Set Thickness")})},clkmn1_thicknessReset:function(){var e=this;$("#"+e.pre+"mn1_thicknessReset").click(function(t){e.setLogCmd("reset thickness",!0),e.bSetThickness=!1,e.resetAfter3Dprint(),e.icn3d.draw()})},clkMn6_ssbondsYes:function(){var e=this;$("#"+e.pre+"mn6_ssbondsYes").click(function(t){e.setLogCmd("disulfide bonds",!0),e.showSsbonds()})},clkMn6_ssbondsNo:function(){var e=this;$("#"+e.pre+"mn6_ssbondsNo").click(function(t){e.icn3d.opts.ssbonds="no",e.setLogCmd("set disulfide bonds off",!0),e.icn3d.lines.ssbond=[],e.setStyle("sidec","nothing")})},clkMn6_clbondsYes:function(){var e=this;$("#"+e.pre+"mn6_clbondsYes").click(function(t){e.setLogCmd("cross linkage",!0),e.icn3d.bShowCrossResidueBond=!0,e.setStyle("proteins","lines")})},clkMn6_clbondsNo:function(){var e=this;$("#"+e.pre+"mn6_clbondsNo").click(function(t){e.icn3d.opts.clbonds="no",e.setLogCmd("set cross linkage off",!0),e.icn3d.bShowCrossResidueBond=!1,e.setStyle("proteins","ribbon")})},clickViewswitch:function(){var e=this;$("#"+e.pre+"anno_summary").click(function(t){t.preventDefault(),e.setAnnoViewAndDisplay("overview"),e.setLogCmd("set view overview",!0)}),$("#"+e.pre+"anno_details").click(function(t){t.preventDefault(),e.setAnnoViewAndDisplay("detailed view"),e.setLogCmd("set view detailed view",!0)})},clickShow_annotations:function(){var e=this;$("#"+e.pre+"show_annotations").click(function(t){e.showAnnotations(),e.setLogCmd("view annotations",!0)})},clickShowallchains:function(){var e=this;$("#"+e.pre+"showallchains").click(function(t){e.showAnnoAllChains(),e.setLogCmd("show annotations all chains",!0)})},clickShow_alignsequences:function(){var e=this;$("#"+e.pre+"show_alignsequences").click(function(t){e.openDialog(e.pre+"dl_alignment","Select residues in aligned sequences")})},clickShow_2ddgm:function(){var e=this;$("#"+e.pre+"show_2ddgm").add("#"+e.pre+"mn2_2ddgm").click(function(t){if(e.openDialog(e.pre+"dl_2ddgm","Interactions"),!e.b2DShown)if(void 0!==e.cfg.align){var i=Object.keys(e.icn3d.structures);e.set2DDiagramsForAlign(i[0].toUpperCase(),i[1].toUpperCase())}else e.download2Ddgm(e.inputid.toUpperCase());e.setLogCmd("view interactions",!0)})},clickSearchSeq:function(){var e=this;$(document).on("click","#"+e.pre+"search_seq_button",function(t){t.stopImmediatePropagation();var i=$("#"+e.pre+"search_seq").val();isNaN(i)&&-1==i.indexOf("$")&&-1==i.indexOf(".")&&-1==i.indexOf(":")&&-1==i.indexOf("@")&&(i=":"+i);var n=i;e.selectByCommand(i,n,i),e.setLogCmd("select "+i+" | name "+n,!0)})},clickReload_mmtf:function(){var e=this;$("#"+e.pre+"reload_mmtf").click(function(t){t.preventDefault(),dialog.dialog("close"),e.setLogCmd("load mmtf "+$("#"+e.pre+"mmtfid").val(),!1),window.open("https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?mmtfid="+$("#"+e.pre+"mmtfid").val(),"_blank")})},clickReload_pdb:function(){var e=this;$("#"+e.pre+"reload_pdb").click(function(t){t.preventDefault(),dialog.dialog("close"),e.setLogCmd("load pdb "+$("#"+e.pre+"pdbid").val(),!1),window.open("https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?pdbid="+$("#"+e.pre+"pdbid").val(),"_blank")})},clickReload_align_refined:function(){var e=this;$("#"+e.pre+"reload_align_refined").click(function(t){t.preventDefault(),dialog.dialog("close");var i=$("#"+e.pre+"alignid1").val()+","+$("#"+e.pre+"alignid2").val();e.setLogCmd("load alignment "+i+" | parameters &atype=1",!1),window.open("https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?align="+i+"&showalignseq=1&atype=1","_blank")})},clickReload_align_ori:function(){var e=this;$("#"+e.pre+"reload_align_ori").click(function(t){t.preventDefault(),dialog.dialog("close");var i=$("#"+e.pre+"alignid1").val()+","+$("#"+e.pre+"alignid2").val();e.setLogCmd("load alignment "+i+" | parameters &atype=0",!1),window.open("https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?align="+i+"&showalignseq=1&atype=0","_blank")})},clickReload_mmcif:function(){var e=this;$("#"+e.pre+"reload_mmcif").click(function(t){t.preventDefault(),dialog.dialog("close"),e.setLogCmd("load mmcif "+$("#"+e.pre+"mmcifid").val(),!1),window.open("https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?mmcifid="+$("#"+e.pre+"mmcifid").val(),"_blank")})},clickReload_mmdb:function(){var e=this;$("#"+e.pre+"reload_mmdb").click(function(t){t.preventDefault(),dialog.dialog("close"),e.setLogCmd("load mmdb "+$("#"+e.pre+"mmdbid").val(),!1),window.open("https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?mmdbid="+$("#"+e.pre+"mmdbid").val(),"_blank")})},clickReload_blast_rep_id:function(){var e=this;$("#"+e.pre+"reload_blast_rep_id").click(function(t){t.preventDefault(),dialog.dialog("close");var i=$("#"+e.pre+"query_id").val(),n=encodeURIComponent($("#"+e.pre+"query_fasta").val()),r=$("#"+e.pre+"blast_rep_id").val();e.setLogCmd("load seq_struc_ids "+i+","+r,!1),i=""!==i&&void 0!==i?i:n,window.open("https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?from=icn3d&blast_rep_id="+r+"&query_id="+i,"_blank")})},clickReload_gi:function(){var e=this;$("#"+e.pre+"reload_gi").click(function(t){t.preventDefault(),dialog.dialog("close"),e.setLogCmd("load gi "+$("#"+e.pre+"gi").val(),!1),window.open("https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?gi="+$("#"+e.pre+"gi").val(),"_blank")})},clickReload_cid:function(){var e=this;$("#"+e.pre+"reload_cid").click(function(t){t.preventDefault(),dialog.dialog("close"),e.setLogCmd("load cid "+$("#"+e.pre+"cid").val(),!1),window.open("https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?cid="+$("#"+e.pre+"cid").val(),"_blank")})},clickReload_pngimage:function(){var e=this;$("#"+e.pre+"reload_pngimage").click(function(t){t.preventDefault(),dialog.dialog("close"),$(".ui-dialog-content").dialog("close"),e.init(),e.icn3d.init();var i=$("#"+e.pre+"pngimage")[0].files[0];if(i){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");var n=new FileReader;n.onload=function(t){var i=t.target.result,n=i.indexOf("Share Link: "),r=i.indexOf("Start of data file======\n");if(-1==n&&-1==r)alert('Please load a PNG image saved by clicking "Save Datas > PNG Image" in the Data menu...');else if(-1!=n){var o=i.substr(n+"Share Link: ".length);e.setLogCmd("load iCn3D PNG image "+$("#"+e.pre+"pngimage").val(),!1),window.open(o)}else if(-1!=r){e.bInputfile=!0;var s=i.indexOf("End of data file======\n"),a=i.substr(r+"Start of data file======\n".length,s-r-"Start of data file======\n".length),c=i.indexOf("Start of state file======\n"),l=i.indexOf("End of state file======\n"),d=i.substr(c+"Start of state file======\n".length,l-c-"Start of state file======\n".length),h=i.indexOf("Start of type file======\n"),u=i.indexOf("End of type file======\n"),p=i.substr(h+"Start of type file======\n".length,u-h-"Start of type file======\n".length-1);"pdb"===p?$.when(e.loadPdbData(a)).then(function(){e.icn3d.commands=[],e.icn3d.optsHistory=[],e.loadScript(d,!0)}):("mol2"===p?e.loadMol2Data(a):"sdf"===p?e.loadSdfData(a):"xyz"===p?e.loadXyzData(a):"mmcif"===p&&e.loadMmcifData(a),e.icn3d.commands=[],e.icn3d.optsHistory=[],e.loadScript(d,!0)),e.setLogCmd("load iCn3D PNG image "+$("#"+e.pre+"pngimage").val(),!1)}},n.readAsText(i)}else alert("Please select a file before clicking 'Load'")})},clickReload_state:function(){var e=this;$("#"+e.pre+"reload_state").click(function(t){t.preventDefault(),dialog.dialog("close"),$(".ui-dialog-content").dialog("close"),e.bInputfile||(e.init(),e.icn3d.init());var i=$("#"+e.pre+"state")[0].files[0];if(i){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");var n=new FileReader;n.onload=function(t){var i=t.target.result;e.setLogCmd("load state file "+$("#"+e.pre+"state").val(),!1),e.icn3d.commands=[],e.icn3d.optsHistory=[],e.loadScript(i,!0)},n.readAsText(i)}else alert("Please select a file before clicking 'Load'")})},clickReload_selectionfile:function(){var e=this;$("#"+e.pre+"reload_selectionfile").click(function(t){t.preventDefault(),dialog.dialog("close");var i=$("#"+e.pre+"selectionfile")[0].files[0];if(i){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");var n=new FileReader;n.onload=function(t){e.loadSelection(t.target.result),e.setLogCmd("load selection file "+$("#"+e.pre+"selectionfile").val(),!1)},n.readAsText(i)}else alert("Please select a file before clicking 'Load'")})},clickReload_pdbfile:function(){var e=this;$("#"+e.pre+"reload_pdbfile").click(function(t){t.preventDefault(),e.bInitial=!0,dialog.dialog("close"),$(".ui-dialog-content").dialog("close");var i=$("#"+e.pre+"pdbfile")[0].files[0];if(i){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");var n=new FileReader;n.onload=function(t){var i=t.target.result;e.setLogCmd("load pdb file "+$("#"+e.pre+"pdbfile").val(),!1),e.icn3d.molTitle="",e.init(),e.icn3d.init(),e.bInputfile=!0,e.InputfileData=i,e.InputfileType="pdb",e.loadPdbData(i)},n.readAsText(i)}else alert("Please select a file before clicking 'Load'")})},clickReload_mol2file:function(){var e=this;$("#"+e.pre+"reload_mol2file").click(function(t){t.preventDefault(),e.bInitial=!0,dialog.dialog("close"),$(".ui-dialog-content").dialog("close");var i=$("#"+e.pre+"mol2file")[0].files[0];if(i){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");var n=new FileReader;n.onload=function(t){var i=t.target.result;e.setLogCmd("load mol2 file "+$("#"+e.pre+"mol2file").val(),!1),e.icn3d.molTitle="",e.inputid=void 0,e.init(),e.icn3d.init(),e.bInputfile=!0,e.InputfileData=i,e.InputfileType="mol2",e.loadMol2Data(i)},n.readAsText(i)}else alert("Please select a file before clicking 'Load'")})},clickReload_sdffile:function(){var e=this;$("#"+e.pre+"reload_sdffile").click(function(t){t.preventDefault(),e.bInitial=!0,dialog.dialog("close"),$(".ui-dialog-content").dialog("close");var i=$("#"+e.pre+"sdffile")[0].files[0];if(i){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");var n=new FileReader;n.onload=function(t){var i=t.target.result;e.setLogCmd("load sdf file "+$("#"+e.pre+"sdffile").val(),!1),e.icn3d.molTitle="",e.inputid=void 0,e.init(),e.icn3d.init(),e.bInputfile=!0,e.InputfileData=i,e.InputfileType="sdf",e.loadSdfData(i)},n.readAsText(i)}else alert("Please select a file before clicking 'Load'")})},clickReload_xyzfile:function(){var e=this;$("#"+e.pre+"reload_xyzfile").click(function(t){t.preventDefault(),e.bInitial=!0,dialog.dialog("close"),$(".ui-dialog-content").dialog("close");var i=$("#"+e.pre+"xyzfile")[0].files[0];if(i){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");var n=new FileReader;n.onload=function(t){var i=t.target.result;e.setLogCmd("load xyz file "+$("#"+e.pre+"xyzfile").val(),!1),e.icn3d.molTitle="",e.inputid=void 0,e.init(),e.icn3d.init(),e.bInputfile=!0,e.InputfileData=i,e.InputfileType="xyz",e.loadXyzData(i)},n.readAsText(i)}else alert("Please select a file before clicking 'Load'")})},clickReload_urlfile:function(){var e=this;$("#"+e.pre+"reload_urlfile").click(function(t){t.preventDefault(),e.bInitial=!0,dialog.dialog("close"),$(".ui-dialog-content").dialog("close");var i=$("#"+e.pre+"filetype").val(),n=$("#"+e.pre+"urlfile").val();e.init(),e.icn3d.init(),e.bInputfile=!0,e.downloadUrl(n,i)})},clickReload_mmciffile:function(){var e=this;$("#"+e.pre+"reload_mmciffile").click(function(t){t.preventDefault(),e.bInitial=!0,dialog.dialog("close"),$(".ui-dialog-content").dialog("close");var i=$("#"+e.pre+"mmciffile")[0].files[0];if(i){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");var n=new FileReader;n.onload=function(t){var i=t.target.result;e.setLogCmd("load mmcif file "+$("#"+e.pre+"mmciffile").val(),!1),e.icn3d.molTitle="",e.icn3d.bCid=void 0,$.ajax({url:"//www.ncbi.nlm.nih.gov/Structure/mmcifparser/mmcifparser.cgi",type:"POST",data:{mmciffile:i},dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){$("#"+e.pre+"wait")&&$("#"+e.pre+"wait").show(),$("#"+e.pre+"canvas")&&$("#"+e.pre+"canvas").hide(),$("#"+e.pre+"cmdlog")&&$("#"+e.pre+"cmdlog").hide()},complete:function(){$("#"+e.pre+"wait")&&$("#"+e.pre+"wait").hide(),$("#"+e.pre+"canvas")&&$("#"+e.pre+"canvas").show(),$("#"+e.pre+"cmdlog")&&$("#"+e.pre+"cmdlog").show()},success:function(t){e.init(),e.icn3d.init(),e.bInputfile=!0,e.InputfileData=t,e.InputfileType="mmcif",e.loadMmcifData(t)},error:function(e,t,i){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})},n.readAsText(i)}else alert("Please select a file before clicking 'Load'")})},clickApplycustomcolor:function(){var e=this;$("#"+e.pre+"applycustomcolor").click(function(t){t.preventDefault(),dialog.dialog("close"),e.setOption("color",$("#"+e.pre+"colorcustom").val()),e.setLogCmd("color "+$("#"+e.pre+"colorcustom").val(),!0)})},clickApplypick_aroundsphere:function(){var e=this;$("#"+e.pre+"applypick_aroundsphere").click(function(t){t.preventDefault(),dialog.dialog("close");var i=parseFloat($("#"+e.pre+"radius_aroundsphere").val()),n="select zone cutoff "+i;e.pickCustomSphere(i),e.updateHlAll(),e.setLogCmd(n,!0)})},clickApplyhbonds:function(){var e=this;$("#"+e.pre+"applyhbonds").click(function(t){t.preventDefault(),dialog.dialog("close");var i=parseFloat($("#"+e.pre+"hbondthreshold").val()),n="hbonds "+i;e.showHbonds(i),e.setLogCmd(n,!0)})},clickApplypick_labels:function(){var e=this;$("#"+e.pre+"applypick_labels").click(function(t){t.preventDefault(),dialog.dialog("close");var i=$("#"+e.pre+"labeltext").val(),n=$("#"+e.pre+"labelsize").val(),r=$("#"+e.pre+"labelcolor").val(),o=$("#"+e.pre+"labelbkgd").val();if("0"!==n&&""!==n&&"undefined"!==n||(n=0),"0"!==r&&""!==r&&"undefined"!==r||(r=0),"0"!==o&&""!==o&&"undefined"!==o||(o=0),void 0===e.icn3d.pAtom||void 0===e.icn3d.pAtom2)alert("Please pick another atom");else{var s=(e.icn3d.pAtom.coord.x+e.icn3d.pAtom2.coord.x)/2,a=(e.icn3d.pAtom.coord.y+e.icn3d.pAtom2.coord.y)/2,c=(e.icn3d.pAtom.coord.z+e.icn3d.pAtom2.coord.z)/2;e.addLabel(i,s,a,c,n,r,o,"custom"),e.icn3d.pickpair=!1;var l="",d="",h="";0!=n&&(l=" | size "+n),0!=r&&(d=" | color "+r),0!=o&&(h=" | background "+o),e.setLogCmd("add label "+i+" | x "+s.toPrecision(4)+" y "+a.toPrecision(4)+" z "+c.toPrecision(4)+l+d+h+" | type custom",!0),e.icn3d.draw()}})},clickApplyselection_labels:function(){var e=this;$("#"+e.pre+"applyselection_labels").click(function(t){t.preventDefault(),dialog.dialog("close");var i=$("#"+e.pre+"labeltext2").val(),n=$("#"+e.pre+"labelsize2").val(),r=$("#"+e.pre+"labelcolor2").val(),o=$("#"+e.pre+"labelbkgd2").val();"0"!==n&&""!==n&&"undefined"!==n||(n=0),"0"!==r&&""!==r&&"undefined"!==r||(r=0),"0"!==o&&""!==o&&"undefined"!==o||(o=0);var s=e.icn3d.centerAtoms(e.icn3d.hash2Atoms(e.icn3d.hAtoms)),a=s.center.x,c=s.center.y,l=s.center.z;e.addLabel(i,a,c,l,n,r,o,"custom");var d="",h="",u="";0!=n&&(d=" | size "+n),0!=r&&(h=" | color "+r),0!=o&&(u=" | background "+o),e.setLogCmd("add label "+i+" | x "+a.toPrecision(4)+" y "+c.toPrecision(4)+" z "+l.toPrecision(4)+d+h+u+" | type custom",!0),e.icn3d.draw()})},clickApplypick_stabilizer:function(){var e=this;$("#"+e.pre+"applypick_stabilizer").click(function(t){t.preventDefault(),dialog.dialog("close"),void 0===e.icn3d.pAtom||void 0===e.icn3d.pAtom2?alert("Please pick another atom"):(e.icn3d.pickpair=!1,e.setLogCmd("add one stabilizer | "+e.icn3d.pAtom.serial+" "+e.icn3d.pAtom2.serial,!0),void 0===e.icn3d.pairArray&&(e.icn3d.pairArray=[]),e.icn3d.pairArray.push(e.icn3d.pAtom.serial),e.icn3d.pairArray.push(e.icn3d.pAtom2.serial),e.setThichknessFor3Dprint(),e.icn3d.draw())})},pickColor:function(){var e=this,t=new CP(document.querySelector("#"+e.pre+"colorcustom"));t.on("change",function(e){this.target.value=e}),$("#"+e.pre+"colorcustom").on("input keyup paste cut",function(){var i=$("#"+e.pre+"colorcustom").val();t.set("#"+i).enter()})},clickApplypick_stabilizer_rm:function(){var e=this;$("#"+e.pre+"applypick_stabilizer_rm").click(function(t){if(t.preventDefault(),dialog.dialog("close"),void 0===e.icn3d.pAtom||void 0===e.icn3d.pAtom2)alert("Please pick another atom");else{e.icn3d.pickpair=!1,e.setLogCmd("remove one stabilizer | "+e.icn3d.pAtom.serial+" "+e.icn3d.pAtom2.serial,!0);var i=[];i.push(e.icn3d.pAtom.serial),i.push(e.icn3d.pAtom2.serial),e.removeOneStabilizer(i),e.icn3d.draw()}})},clickApplypick_measuredistance:function(){var e=this;$("#"+e.pre+"applypick_measuredistance").click(function(t){if(t.preventDefault(),dialog.dialog("close"),e.bMeasureDistance=!1,void 0===e.icn3d.pAtom||void 0===e.icn3d.pAtom2)alert("Please pick another atom");else{var i=$("#"+e.pre+"linecolor").val(),n=(e.icn3d.pAtom.coord.x+e.icn3d.pAtom2.coord.x)/2,r=(e.icn3d.pAtom.coord.y+e.icn3d.pAtom2.coord.y)/2,o=(e.icn3d.pAtom.coord.z+e.icn3d.pAtom2.coord.z)/2;e.addLineFromPicking("distance");var s=(parseInt(10*e.icn3d.pAtom.coord.distanceTo(e.icn3d.pAtom2.coord))/10).toString()+" A";e.addLabel(s,n,r,o,0,i,0,"distance");var a="";0!=i&&(a=" | color "+i),e.setLogCmd("add label "+s+" | x "+n.toPrecision(4)+" y "+r.toPrecision(4)+" z "+o.toPrecision(4)+a+" | type distance",!0),e.icn3d.draw(),e.icn3d.pk=2}})},clickApply_thickness:function(){var e=this;$("#"+e.pre+"apply_thickness_3dprint").click(function(t){t.preventDefault(),e.bSetThickness=!0,e.icn3d.lineRadius=parseFloat($("#"+e.pre+"linerad_3dprint").val()),e.icn3d.coilWidth=parseFloat($("#"+e.pre+"coilrad_3dprint").val()),e.icn3d.cylinderRadius=parseFloat($("#"+e.pre+"stickrad_3dprint").val()),e.icn3d.traceRadius=parseFloat($("#"+e.pre+"stickrad_3dprint").val()),e.icn3d.dotSphereScale=parseFloat($("#"+e.pre+"ballscale_3dprint").val()),e.icn3d.ribbonthickness=parseFloat($("#"+e.pre+"ribbonthick_3dprint").val()),e.icn3d.helixSheetWidth=parseFloat($("#"+e.pre+"prtribbonwidth_3dprint").val()),e.icn3d.nucleicAcidWidth=parseFloat($("#"+e.pre+"nucleotideribbonwidth_3dprint").val()),e.setLogCmd("set thickness | linerad "+e.icn3d.lineRadius+" | coilrad "+e.icn3d.coilWidth+" | stickrad "+e.icn3d.cylinderRadius+" | tracerad "+e.icn3d.traceRadius+" | ribbonthick "+e.icn3d.ribbonthickness+" | proteinwidth "+e.icn3d.helixSheetWidth+" | nucleotidewidth "+e.icn3d.nucleicAcidWidth+" | ballscale "+e.icn3d.dotSphereScale,!0),e.icn3d.draw()}),$("#"+e.pre+"apply_thickness_style").click(function(t){t.preventDefault(),e.bSetThickness=!0,e.icn3d.lineRadius=parseFloat($("#"+e.pre+"linerad_style").val()),e.icn3d.coilWidth=parseFloat($("#"+e.pre+"coilrad_style").val()),e.icn3d.cylinderRadius=parseFloat($("#"+e.pre+"stickrad_style").val()),e.icn3d.traceRadius=parseFloat($("#"+e.pre+"stickrad_style").val()),e.icn3d.dotSphereScale=parseFloat($("#"+e.pre+"ballscale_style").val()),e.icn3d.ribbonthickness=parseFloat($("#"+e.pre+"ribbonthick_style").val()),e.icn3d.helixSheetWidth=parseFloat($("#"+e.pre+"prtribbonwidth_style").val()),e.icn3d.nucleicAcidWidth=parseFloat($("#"+e.pre+"nucleotideribbonwidth_style").val()),e.setLogCmd("set thickness | linerad "+e.icn3d.lineRadius+" | coilrad "+e.icn3d.coilWidth+" | stickrad "+e.icn3d.cylinderRadius+" | tracerad "+e.icn3d.traceRadius+" | ribbonthick "+e.icn3d.ribbonthickness+" | proteinwidth "+e.icn3d.helixSheetWidth+" | nucleotidewidth "+e.icn3d.nucleicAcidWidth+" | ballscale "+e.icn3d.dotSphereScale,!0),e.icn3d.draw()})},clickReset:function(){var e=this;$("#"+e.pre+"reset").click(function(t){e.icn3d.maxD=e.icn3d.oriMaxD,e.icn3d.center=e.icn3d.oriCenter.clone(),e.icn3d.reinitAfterLoad(),e.renderFinalStep(1),e.setMode("all"),e.setLogCmd("reset",!0),e.removeSeqChainBkgd(),e.removeSeqResidueBkgd(),e.removeHl2D(),e.removeHlMenus()})},clickToggleHighlight:function(){var e=this;$("#"+e.pre+"toggleHighlight").add("#"+e.pre+"toggleHighlight2").click(function(t){t.stopImmediatePropagation(),e.toggleHighlight()}),$(document).on("click","#"+e.pre+"seq_clearselection",function(t){t.stopImmediatePropagation(),dialog.dialog("close"),e.clearHighlight()}),$(document).on("click","#"+e.pre+"seq_clearselection2",function(t){t.stopImmediatePropagation(),t.preventDefault(),e.clearHighlight(),e.setLogCmd("clear selection",!0)}),$(document).on("click","#"+e.pre+"alignseq_clearselection",function(t){t.stopImmediatePropagation(),e.clearHighlight(),e.setLogCmd("clear selection",!0)})},pressCommandtext:function(){var e=this;$("#"+e.pre+"logtext").keypress(function(t){if(e.bAddLogs=!1,13==(t.keyCode?t.keyCode:t.which)){t.preventDefault();var i=$(this).val();e.icn3d.bRender=!0;var n=i.split("\n"),r=n[n.length-1].substr(2).trim();if(e.icn3d.logs.push(r),$("#"+e.pre+"logtext").val("> "+e.icn3d.logs.join("\n> ")+"\n> ").scrollTop($("#"+e.pre+"logtext")[0].scrollHeight),""!==r){var o={};o.factor=e.icn3d._zoomFactor,o.mouseChange=e.icn3d.mouseChange,o.quaternion=e.icn3d.quaternion,e.icn3d.commands.push(r+"|||"+e.getTransformationStr(o)),e.icn3d.optsHistory.push(e.icn3d.cloneHash(e.icn3d.opts)),e.icn3d.optsHistory[e.icn3d.optsHistory.length-1].hlatomcount=Object.keys(e.icn3d.hAtoms).length,e.isSessionStorageSupported()&&e.saveCommandsToSession(),e.STATENUMBER=e.icn3d.commands.length,-1!==r.indexOf("load")?e.applyCommandLoad(r):-1!==r.indexOf("set map")&&-1===r.indexOf("set map wireframe")?e.applyCommandMap(r):0==r.indexOf("view annotations")?e.applyCommandAnnotationsAndCddSite(r):0==r.indexOf("set annotation clinvar")||0==r.indexOf("set annotation snp")?e.applyCommandSnpClinvar(r):0==r.indexOf("set annotation 3ddomain")?e.applyCommand3ddomain(r):0==r.indexOf("set annotation all")?($.when(e.applyCommandSnpClinvar(r)).then(e.applyCommandSnpClinvar(r)),e.setAnnoTabAll()):e.applyCommand(r+"|||"+e.getTransformationStr(o)),e.saveSelectionIfSelected(),e.icn3d.draw()}}e.bAddLogs=!0})},clickSeqSaveSelection:function(){var e=this;$(document).on("click","#"+e.pre+"seq_saveselection",function(t){t.stopImmediatePropagation(),dialog.dialog("close"),$("#"+e.pre+"dl_definedsets").hasClass("ui-dialog-content")&&$("#"+e.pre+"dl_definedsets").dialog("isOpen")||e.openDialog(e.pre+"dl_definedsets","Select sets"),e.bSelectResidue=!1;var i=$("#"+e.pre+"seq_command_name").val().replace(/\s+/g,"_");e.saveSelection(i,i)}),$(document).on("click","#"+e.pre+"seq_saveselection2",function(t){t.stopImmediatePropagation(),$("#"+e.pre+"dl_definedsets").hasClass("ui-dialog-content")&&$("#"+e.pre+"dl_definedsets").dialog("isOpen")||e.openDialog(e.pre+"dl_definedsets","Select sets"),e.bSelectResidue=!1;var i=$("#"+e.pre+"seq_command_name2").val().replace(/\s+/g,"_");e.saveSelection(i,i)})},clickAlignSeqSaveSelection:function(){var e=this;$(document).on("click","#"+e.pre+"alignseq_saveselection",function(t){t.stopImmediatePropagation(),$("#"+e.pre+"dl_definedsets").hasClass("ui-dialog-content")&&$("#"+e.pre+"dl_definedsets").dialog("isOpen")||e.openDialog(e.pre+"dl_definedsets","Select sets"),e.bSelectAlignResidue=!1;var i=$("#"+e.pre+"alignseq_command_name").val().replace(/\s+/g,"_");e.saveSelection(i,i)})},clickOutputSelection:function(){var e=this;$(document).on("click","."+e.pre+"outputselection",function(t){t.stopImmediatePropagation(),e.bSelectResidue=!1,e.bSelectAlignResidue=!1,e.setLogCmd("output selection",!0),e.outputSelection()})},bindMouseup:function(){var e=this;$("accordion").bind("mouseup touchend",function(t){e.icn3d.controls&&(e.icn3d.controls.noRotate=!1,e.icn3d.controls.noZoom=!1,e.icn3d.controls.noPan=!1)})},bindMousedown:function(){var e=this;$("accordion").bind("mousedown touchstart",function(t){e.icn3d.controls&&(e.icn3d.controls.noRotate=!0,e.icn3d.controls.noZoom=!0,e.icn3d.controls.noPan=!0)})},expandShrink:function(){$(document).on("click",".icn3d-expand",function(e){e.stopImmediatePropagation();var t=$(this).attr("id"),i=t.lastIndexOf("_"),n=t.substr(0,i);$("#"+n).show(),$("#"+n+"_expand").hide(),$("#"+n+"_shrink").show()}),$(document).on("click",".icn3d-shrink",function(e){e.stopImmediatePropagation();var t=$(this).attr("id"),i=t.lastIndexOf("_"),n=t.substr(0,i);$("#"+n).hide(),$("#"+n+"_expand").show(),$("#"+n+"_shrink").hide()})},scrollAnno:function(){var e=this;window.onscroll=function(t){"detailed view"==e.view&&0==$(window).scrollTop()&&0==$(window).scrollTop()&&0==$("#"+e.pre+"dl_selectannotations").scrollTop()?e.showFixedTitle():e.hideFixedTitle()},$("#"+e.pre+"dl_selectannotations").scroll(function(){"detailed view"==e.view&&0==$(window).scrollTop()&&0==$(window).scrollTop()&&0==$("#"+e.pre+"dl_selectannotations").scrollTop()?e.showFixedTitle():e.hideFixedTitle()})},allEventFunctions:function(){var e=this;e.clickModeswitch(),e.clickViewswitch(),e.isMobile()?(e.selectSequenceMobile(),e.selectChainMobile()):e.selectSequenceNonMobile(),e.clickBack(),e.clickForward(),e.clickToggle(),e.clickHlColorYellow(),e.clickHlColorGreen(),e.clickHlColorRed(),e.clickHlStyleOutline(),e.clickHlStyleObject(),e.clickHlStyleNone(),e.clickAlternate(),e.clkMn1_mmtfid(),e.clkMn1_pdbid(),e.clkMn1_align(),e.clkMn1_pdbfile(),e.clkMn1_mol2file(),e.clkMn1_sdffile(),e.clkMn1_xyzfile(),e.clkMn1_urlfile(),e.clkMn1_mmciffile(),e.clkMn1_mmcifid(),e.clkMn1_mmdbid(),e.clkMn1_blast_rep_id(),e.clkMn1_gi(),e.clkMn1_cid(),e.clkMn1_pngimage(),e.clkMn1_state(),e.clkMn1_selection(),e.clkMn1_exportState(),e.clkMn1_exportStl(),e.clkMn1_exportVrml(),e.clkMn1_exportStlStab(),e.clkMn1_exportVrmlStab(),e.clkMn6_exportInteraction(),e.clkMn1_exportCanvas(),e.clkMn1_exportCounts(),e.clkMn1_exportSelections(),e.clkMn1_sharelink(),e.clkMn1_link_structure(),e.clkMn1_link_bind(),e.clkMn1_link_vast(),e.clkMn1_link_pubmed(),e.clkMn1_link_protein(),e.clkMn2_selectannotations(),e.clkMn2_selectcomplement(),e.clkMn2_selectsidechains(),e.clkMn2_selectall(),e.clkMn2_alignment(),e.clkMn2_command(),e.clkMn2_definedsets(),e.clkMn2_pkYes(),e.clkMn2_pkNo(),e.clkMn2_pkResidue(),e.clkMn2_pkStrand(),e.clkMn2_pkChain(),e.clkMn2_aroundsphere(),e.clkMn2_select_chain(),e.clkMn3_proteinsRibbon(),e.clkMn3_proteinsStrand(),e.clkMn3_proteinsCylinder(),e.clkMn3_proteinsSchematic(),e.clkMn3_proteinsCalpha(),e.clkMn3_proteinsBfactor(),e.clkMn3_proteinsLines(),e.clkMn3_proteinsStick(),e.clkMn3_proteinsBallstick(),e.clkMn3_proteinsSphere(),e.clkMn3_proteinsNo(),e.clkMn3_sidecLines(),e.clkMn3_sidecStick(),e.clkMn3_sidecBallstick(),e.clkMn3_sidecSphere(),e.clkMn3_sidecNo(),e.clkMn3_nuclCartoon(),e.clkMn3_nuclSchematic(),e.clkMn3_nuclPhos(),e.clkMn3_nuclLines(),e.clkMn3_nuclStick(),e.clkMn3_nuclBallstick(),e.clkMn3_nuclSphere(),e.clkMn3_nuclNo(),e.clkMn3_ligLines(),e.clkMn3_ligStick(),e.clkMn3_ligBallstick(),e.clkMn3_ligSchematic(),e.clkMn3_ligSphere(),e.clkMn3_ligNo(),e.clkMn3_ionsSphere(),e.clkMn3_ionsDot(),e.clkMn3_ionsNo(),e.clkMn3_waterSphere(),e.clkMn3_waterDot(),e.clkMn3_waterNo(),e.clkMn4_clrSpectrum(),e.clkMn4_clrChain(),e.clkMn4_clrSSGreen(),e.clkMn4_clrSSYellow(),e.clkMn4_clrResidue(),e.clkMn4_clrCharge(),e.clkMn4_clrHydrophobic(),e.clkMn4_clrAtom(),e.clkMn4_clrBfactor(),e.clkMn4_clrBfactorNorm(),e.clkMn4_clrConserved(),e.clkMn4_clrIdentity(),e.clkMn4_clrRed(),e.clkMn4_clrGreen(),e.clkMn4_clrBlue(),e.clkMn4_clrMagenta(),e.clkMn4_clrYellow(),e.clkMn4_clrCyan(),e.clkMn4_clrWhite(),e.clkMn4_clrGrey(),e.clkMn4_clrCustom(),e.clkMn4_clrSave(),e.clkMn4_clrApplySave(),e.clkMn3_styleSave(),e.clkMn3_styleApplySave(),e.clkMn5_neighborsYes(),e.clkMn5_neighborsNo(),e.clkMn5_surfaceVDW(),e.clkMn5_surfaceSAS(),e.clkMn5_surfaceMolecular(),e.clkMn5_surfaceVDWContext(),e.clkMn5_surfaceSASContext(),e.clkMn5_surfaceMolecularContext(),e.clkMn5_surfaceNo(),e.clkMn5_opacity10(),e.clkMn5_opacity09(),e.clkMn5_opacity08(),e.clkMn5_opacity07(),e.clkMn5_opacity06(),e.clkMn5_opacity05(),e.clkMn5_opacity04(),e.clkMn5_opacity03(),e.clkMn5_opacity02(),e.clkMn5_opacity01(),e.clkMn5_wireframeYes(),e.clkMn5_wireframeNo(),e.clkMn5_elecmap2fofc(),e.clkMn5_elecmapfofc(),e.clkMn5_elecmapNo(),e.clkMn5_mapwireframeYes(),e.clkMn5_mapwireframeNo(),e.clkMn5_emmap(),e.clkMn5_emmapNo(),e.clickApplyemmap(),e.clkMn5_emmapwireframeYes(),e.clkMn5_emmapwireframeNo(),e.clkMn6_assemblyYes(),e.clkMn6_assemblyNo(),e.clkMn6_addlabelResidues(),e.clkMn6_addlabelChains(),e.clkMn6_addlabelTermini(),e.clkMn6_addlabelYes(),e.clkMn6_addlabelSelection(),e.clkMn2_saveselection(),e.clkMn6_addlabelNo(),e.clkMn6_distanceYes(),e.clkmn1_stabilizerOne(),e.clkmn1_stabilizerRmOne(),e.clkmn1_thicknessSet(),e.clkmn5_setThickness(),e.clkmn1_thicknessReset(),e.clkMn6_distanceNo(),e.clkMn2_selectedcenter(),e.clkMn6_center(),e.clkMn6_resetOrientation(),e.clkMn6_chemicalbindingshow(),e.clkMn6_chemicalbindinghide(),e.clkMn6_rotateleft(),e.clkMn6_rotateright(),e.clkMn6_rotateup(),e.clkMn6_rotatedown(),e.clkMn6_cameraPers(),e.clkMn6_cameraOrth(),e.clkMn6_bkgdBlack(),e.clkMn6_bkgdGrey(),e.clkMn6_bkgdWhite(),e.clkMn6_bkgdTransparent(),e.clkMn6_showfogYes(),e.clkMn6_showfogNo(),e.clkMn6_showslabYes(),e.clkMn6_showslabNo(),e.clkMn6_showaxisYes(),e.clkMn6_showaxisNo(),e.clkMn6_hbondsYes(),e.clkMn6_hbondsNo(),e.clkmn1_stabilizerYes(),e.clkmn1_stabilizerNo(),e.clkMn6_ssbondsYes(),e.clkMn6_ssbondsNo(),e.clkMn6_clbondsYes(),e.clkMn6_clbondsNo(),e.clickCustomAtoms(),e.clickShow_selected(),e.clickShow_annotations(),e.clickShowallchains(),e.clickShow_alignsequences(),e.clickShow_2ddgm(),e.clickCommand_apply(),e.clickSearchSeq(),e.clickReload_pdb(),e.clickReload_align_refined(),e.clickReload_align_ori(),e.clickReload_mmtf(),e.clickReload_pdbfile(),e.clickReload_mol2file(),e.clickReload_sdffile(),e.clickReload_xyzfile(),e.clickReload_urlfile(),e.clickReload_mmciffile(),e.clickReload_mmcif(),e.clickReload_mmdb(),e.clickReload_blast_rep_id(),e.clickReload_gi(),e.clickReload_cid(),e.clickReload_pngimage(),e.clickReload_state(),e.clickReload_selectionfile(),e.clickApplycustomcolor(),e.clickApplypick_aroundsphere(),e.clickApplyhbonds(),e.clickApplymap2fofc(),e.clickApplymapfofc(),e.clickApplypick_labels(),e.clickApplyselection_labels(),e.clickApplypick_measuredistance(),e.clickApplypick_stabilizer(),e.clickApplypick_stabilizer_rm(),e.pickColor(),e.clickApply_thickness(),e.clickReset(),e.clickToggleHighlight(),e.pressCommandtext(),e.clickSeqSaveSelection(),e.clickAlignSeqSaveSelection(),e.clickOutputSelection(),e.click2Ddgm(),e.bindMouseup(),e.bindMousedown(),e.windowResize(),e.setTabs(),e.clickAddTrack(),e.clickDefineHelix(),e.clickDefineSheet(),e.clickDefineCoil(),e.clickDeleteSets(),e.clickAddTrackButton(),e.expandShrink(),e.scrollAnno(),e.switchHighlightLevel()}},"undefined"==typeof jQuery)throw new Error("iCn3DUI requires jQuery");if(void 0===iCn3D)throw new Error("iCn3DUI requires iCn3D");iCn3DUI.prototype.rotStruc=function(e,t){var i=this;if(i.icn3d.bStopRotate)return!1;if(i.icn3d.rotateCount>i.icn3d.rotateCountMax)return i.icn3d.resetOrientation(),!1;if(++i.icn3d.rotateCount,void 0!==t&&t)if("left"===e)i.ROT_DIR="left";else if("right"===e)i.ROT_DIR="right";else if("up"===e)i.ROT_DIR="up";else{if("down"!==e)return!1;i.ROT_DIR="down"}if("left"===e&&"left"===i.ROT_DIR)i.icn3d.rotateLeft(1);else if("right"===e&&"right"===i.ROT_DIR)i.icn3d.rotateRight(1);else if("up"===e&&"up"===i.ROT_DIR)i.icn3d.rotateUp(1);else{if("down"!==e||"down"!==i.ROT_DIR)return!1;i.icn3d.rotateDown(1)}setTimeout(function(){i.rotStruc(e)},100)},iCn3DUI.prototype.showTitle=function(){var e=this;if(void 0!==e.icn3d.molTitle&&""!==e.icn3d.molTitle){var t=e.icn3d.molTitle;if(void 0===e.inputid)e.icn3d.molTitle.length>40&&(t=e.icn3d.molTitle.substr(0,40)+"..."),$("#"+e.pre+"title").html(t);else if(void 0!==e.cfg.cid){var i=e.getLinkToStructureSummary();$("#"+e.pre+"title").html("PubChem CID <a href='"+i+"' target='_blank' style='color:"+e.GREYD+"'>"+e.inputid.toUpperCase()+"</a>: "+t)}else void 0!==e.cfg.align?$("#"+e.pre+"title").html(t):(i=e.getLinkToStructureSummary(),e.icn3d.molTitle.length>40&&(t=e.icn3d.molTitle.substr(0,40)+"..."),$("#"+e.pre+"title").html("PDB ID <a href='"+i+"' target='_blank' style='color:"+e.GREYD+"'>"+e.inputid.toUpperCase()+"</a>: "+t))}else $("#"+e.pre+"title").html("")},iCn3DUI.prototype.getLinkToStructureSummary=function(e){var t=this,i="https://www.ncbi.nlm.nih.gov/structure/?term=";if(i=void 0!==t.cfg.cid?"https://www.ncbi.nlm.nih.gov/pccompound/?term=":-1!==t.inputid.indexOf(",")?"https://www.ncbi.nlm.nih.gov/structure/?term=":"https://www.ncbi.nlm.nih.gov/Structure/pdb/",void 0===t.inputid)i="https://www.ncbi.nlm.nih.gov/pccompound/?term="+t.molTitle;else{var n=t.inputid.split("_");1===n.length?(i+=t.inputid,void 0!==e&&e&&t.setLogCmd("link to Structure Summary "+t.inputid+": "+i,!1)):2===n.length&&(i+=n[0]+" OR "+n[1],void 0!==e&&e&&t.setLogCmd("link to structures "+n[0]+" and "+n[1]+": "+i,!1))}return i},iCn3DUI.prototype.isIE=function(){return!!(window.navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.match(/Trident.*rv\:11\./))},iCn3DUI.prototype.passFloat32=function(e,t){var i=e.length;t||(t=new Uint8Array(4*i));for(var n=this.getDataView(t),r=0;r<i;++r)n.setFloat32(4*r,e[r],!0);return this.getUint8View(t)},iCn3DUI.prototype.passInt8=function(e,t){var i=e.length;t||(t=new Uint8Array(1*i));for(var n=this.getDataView(t),r=0;r<i;++r)n.setInt8(1*r,e[r],!0);return this.getUint8View(t)},iCn3DUI.prototype.passInt16=function(e,t){var i=e.length;t||(t=new Uint8Array(2*i));for(var n=this.getDataView(t),r=0;r<i;++r)n.setInt16(2*r,e[r],!0);return this.getUint8View(t)},iCn3DUI.prototype.passInt32=function(e,t){var i=e.length;t||(t=new Uint8Array(4*i));for(var n=this.getDataView(t),r=0;r<i;++r)n.setInt32(4*r,e[r],!0);return this.getUint8View(t)},iCn3DUI.prototype.getUint8View=function(e){return this.getView(Uint8Array,e)},iCn3DUI.prototype.getDataView=function(e){return this.getView(DataView,e)},iCn3DUI.prototype.getView=function(e,t,i){return t?new e(t.buffer,t.byteOffset,t.byteLength/(i||1)):void 0},iCn3DUI.prototype.getBlobFromBufferAndText=function(e,t){for(var i=new Uint8Array(e),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=this.passInt8([t.charCodeAt(r)])[0];var o=[];return o.push(new Blob([i],{type:"application/octet-stream"})),o.push(new Blob([n],{type:"application/octet-stream"})),new Blob(o,{type:"image/png"})},iCn3DUI.prototype.getTransformationStr=function(e){var t={factor:1,mouseChange:{x:0,y:0},quaternion:{_x:0,_y:0,_z:0,_w:1}};return t.factor=parseFloat(e.factor).toPrecision(5),t.mouseChange.x=parseFloat(e.mouseChange.x).toPrecision(5),t.mouseChange.y=parseFloat(e.mouseChange.y).toPrecision(5),t.quaternion._x=parseFloat(e.quaternion._x).toPrecision(5),t.quaternion._y=parseFloat(e.quaternion._y).toPrecision(5),t.quaternion._z=parseFloat(e.quaternion._z).toPrecision(5),t.quaternion._w=parseFloat(e.quaternion._w).toPrecision(5),"1.0000"==t.factor&&(t.factor=1),"0.0000"==t.mouseChange.x&&(t.mouseChange.x=0),"0.0000"==t.mouseChange.y&&(t.mouseChange.y=0),"0.0000"==t.quaternion._x&&(t.quaternion._x=0),"0.0000"==t.quaternion._y&&(t.quaternion._y=0),"0.0000"==t.quaternion._z&&(t.quaternion._z=0),"1.0000"==t.quaternion._w&&(t.quaternion._w=1),JSON.stringify(t)},iCn3DUI.prototype.saveFile=function(e,t,i){var n,r=this;if("command"===t){for(var o="",s=0,a=r.icn3d.commands.length;s<a;++s){var c=r.icn3d.commands[s].trim();if(s==a-1){var l=c.split("|||"),d={};d.factor=r.icn3d._zoomFactor,d.mouseChange=r.icn3d.mouseChange,d.quaternion=r.icn3d.quaternion,c=l[0]+"|||"+r.getTransformationStr(d)}o+=c+"\n"}var h=decodeURIComponent(o);n=new Blob([h],{type:"text;charset=utf-8;"})}else if("png"===t){r.icn3d.render();var u=!0;if(window.File&&window.FileReader&&window.FileList&&window.Blob||(u=!1),r.isIE()){if(n=r.icn3d.renderer.domElement.msToBlob(),u){var p=new FileReader;p.onload=function(t){var i=t.target.result,o=r.shareLinkUrl(),s="";r.bInputfile?(s+="\nStart of type file======\n",s+=r.InputfileType+"\n",s+="End of type file======\n",s+="Start of data file======\n",s+=r.InputfileData,s+="End of data file======\n",s+="Start of state file======\n",s+=o,s+="End of state file======\n"):s+="\nShare Link: "+o,n=r.getBlobFromBufferAndText(i,s),saveAs(n,e)},p.readAsArrayBuffer(n)}}else r.icn3d.renderer.domElement.toBlob(function(t){if(u){var i=new FileReader;i.onload=function(t){var i=t.target.result,o=r.shareLinkUrl(),s="";r.bInputfile?(s+="\nStart of type file======\n",s+=r.InputfileType+"\n",s+="End of type file======\n",s+="Start of data file======\n",s+=r.InputfileData,s+="End of data file======\n",s+="Start of state file======\n",s+=o,s+="End of state file======\n"):s+="\nShare Link: "+o,n=r.getBlobFromBufferAndText(i,s),saveAs(n,e)},i.readAsArrayBuffer(t)}else saveAs(n=t,e)})}else"html"===t?(o=i,h=decodeURIComponent(o),n=new Blob([h],{type:"text/html;charset=utf-8;"})):"text"===t?(h=i,n=new Blob(h,{type:"text;charset=utf-8;"})):"binary"===t&&(h=i,n=new Blob(h,{type:"application/octet-stream"}));"png"!==t&&saveAs(n,e)},iCn3DUI.prototype.isMobile=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},iCn3DUI.prototype.isMac=function(){return/Mac/i.test(navigator.userAgent)},iCn3DUI.prototype.isSessionStorageSupported=function(){try{return sessionStorage.setItem("test","1"),sessionStorage.removeItem("test"),!0}catch(e){return!1}},iCn3DUI.prototype.resizeCanvas=function(e,t,i,n){var r=this;if(void 0!==i&&i||void 0!==r.cfg.resize&&r.cfg.resize){var o=t;$("#"+r.pre+"canvas").width(e).height(o),$("#"+r.pre+"viewer").width(e).height(t),r.icn3d.setWidthHeight(e,o),(void 0===n||n)&&r.icn3d.draw()}},iCn3DUI.prototype.handleContextLost=function(){var e=this,t=$("#"+e.pre+"canvas")[0];t.addEventListener("webglcontextlost",function(e){e.preventDefault()},!1),t.addEventListener("webglcontextrestored",function(t){console.log("WebGL context was lost. Reset WebGLRenderer and launch iCn3D again."),e.icn3d.renderer=new THREE.WebGLRenderer({canvas:e.icn3d.container.get(0),antialias:!0,preserveDrawingBuffer:!0,alpha:!0}),e.icn3d.draw()},!1)},iCn3DUI.prototype.windowResize=function(){var e=this;void 0!==e.cfg.resize&&e.cfg.resize&&!e.isMobile()&&$(window).resize(function(){e.WIDTH=$(window).width(),e.HEIGHT=$(window).height(),void 0!==e.icn3d&&e.resizeCanvas(e.WIDTH-e.LESSWIDTH_RESIZE,e.HEIGHT-e.LESSHEIGHT-e.EXTRAHEIGHT)})},iCn3DUI.prototype.setViewerWidthHeight=function(){var e=this;e.WIDTH=$(window).width(),e.HEIGHT=$(window).height();var t=$("#"+e.pre+"viewer").width(),i=$("#"+e.pre+"viewer").height();t&&e.WIDTH>t&&(e.WIDTH=t),i&&e.HEIGHT>i&&(e.HEIGHT=i),e.isMac()&&e.isMobile()&&(e.WIDTH<e.MENU_WIDTH&&(e.WIDTH=e.MENU_WIDTH),e.HEIGHT=$(window).height()/$(window).width()*e.MENU_WIDTH),-1===e.cfg.width.toString().indexOf("%")&&(e.WIDTH=parseInt(e.cfg.width)+e.LESSWIDTH),-1===e.cfg.height.toString().indexOf("%")&&(e.HEIGHT=parseInt(e.cfg.height)+e.EXTRAHEIGHT+e.LESSHEIGHT)},iCn3DUI.prototype.shareLinkUrl=function(){var e=this,t="https://www.ncbi.nlm.nih.gov/Structure/icn3d/full.html?",i=-1;void 0!==e.cfg.inpara&&(i=e.cfg.inpara.indexOf("&command="));var n=-1!==i?e.cfg.inpara.substr(0,i):e.cfg.inpara,r=0;void 0!==n?(t+=n.substr(1)+"&command=",r=1):(t+="command=",r=0),e.bInputfile&&(r=0);var o={};o.factor=e.icn3d._zoomFactor,o.mouseChange=e.icn3d.mouseChange,o.quaternion=e.icn3d.quaternion;for(var s=!1,a="",c=r,l=e.icn3d.commands.length;c<l;++c){s=!0;var d=e.icn3d.commands[c].split("|||")[0].trim();c===l-1?(1!==c&&0!==c&&(t+="; "),t+=d+"|||"+e.getTransformationStr(o)):1===c?t+=d:1!==c&&c!==l-1&&(t+="; "+d),a+=e.icn3d.commands[c]+"\n"}return s||(t=t.substr(0,t.length-9)),e.bInputfile&&(t=a),t},iCn3DUI.prototype.addLabel=function(e,t,i,n,r,o,s,a){var c=this,l={};"0"!==r&&""!==r&&"undefined"!==r||(r=void 0),"0"!==o&&""!==o&&"undefined"!==o||(o=void 0),"0"!==s&&""!==s&&"undefined"!==s||(s=void 0);var d=new THREE.Vector3;d.x=t,d.y=i,d.z=n,l.position=d,l.text=e,l.size=r,l.color=o,l.background=s,void 0===c.icn3d.labels[a]&&(c.icn3d.labels[a]=[]),void 0!==a?c.icn3d.labels[a].push(l):c.icn3d.labels.custom.push(l),c.icn3d.removeHlObjects()},iCn3DUI.prototype.showLoading=function(){var e=this;$("#"+e.pre+"wait")&&$("#"+e.pre+"wait").show(),$("#"+e.pre+"canvas")&&$("#"+e.pre+"canvas").hide(),$("#"+e.pre+"cmdlog")&&$("#"+e.pre+"cmdlog").hide()},iCn3DUI.prototype.hideLoading=function(){var e=this;void 0!==e.bCommandLoad&&e.bCommandLoad||($("#"+e.pre+"wait")&&$("#"+e.pre+"wait").hide(),$("#"+e.pre+"canvas")&&$("#"+e.pre+"canvas").show(),$("#"+e.pre+"cmdlog")&&$("#"+e.pre+"cmdlog").show())},iCn3DUI.prototype.downloadMmcif=function(e){var t,i=this;t="https://files.rcsb.org/view/"+e+".cif",i.icn3d.bCid=void 0,$.ajax({url:t,dataType:"text",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){i.showLoading()},complete:function(){i.hideLoading()},success:function(e){t="https://www.ncbi.nlm.nih.gov/Structure/mmcifparser/mmcifparser.cgi",$.ajax({url:t,type:"POST",data:{mmciffile:e},dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){i.showLoading()},complete:function(){i.hideLoading()},success:function(e){i.loadMmcifData(e)},error:function(e,t,i){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})},error:function(e,t,i){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})},iCn3DUI.prototype.downloadMmcifSymmetry=function(e,t){var i=this;return i.deferredSymmetry=$.Deferred(function(){i.downloadMmcifSymmetryBase(e,t)}),i.deferredSymmetry.promise()},iCn3DUI.prototype.downloadMmcifSymmetryBase=function(e,t){var i,n=this;i=n.isMac()?"https://files.rcsb.org/view/"+e+".cif":"https://files.rcsb.org/header/"+e+".cif",n.icn3d.bCid=void 0,$.ajax({url:i,dataType:"text",cache:!0,tryCount:0,retryLimit:1,success:function(r){i="https://www.ncbi.nlm.nih.gov/Structure/mmcifparser/mmcifparser.cgi",$.ajax({url:i,type:"POST",data:{mmcifheader:r},dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,success:function(i){if(void 0!==i.emd&&(n.icn3d.emd=i.emd),n.bAssemblyUseAsu&&n.loadMmcifSymmetry(i),"mmtfid"===t&&void 0!==i.missingseq){for(var r=0,o="",s={},a=0,c=i.missingseq.length;a<c;++a){var l=i.missingseq[a].resn,d=i.missingseq[a].chain,h=i.missingseq[a].resi,u=e+"_"+d;void 0===s[u]&&(s[u]=[]);var p={};p.resi=h,p.name=n.icn3d.residueName2Abbr(l).toLowerCase(),d!=o&&(r=0),!isNaN(h)&&(""==o||d!=o||d==o&&h>r)&&(s[u].push(p),r=h,o=d)}n.icn3d.adjustSeq(s)}void 0!==n.deferredSymmetry&&n.deferredSymmetry.resolve()},error:function(e,t,i){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):void 0!==n.deferredSymmetry&&n.deferredSymmetry.resolve()}})},error:function(e,t,i){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})},iCn3DUI.prototype.loadMmcifData=function(e){var t=this;if(void 0===e.atoms)return alert("invalid atoms data."),!1;t.icn3d.init(),void 0!==e.emd&&(t.icn3d.emd=e.emd),void 0!==t.icn3d.emd?($("#"+t.pre+"mapWrapper1").hide(),$("#"+t.pre+"mapWrapper2").hide(),$("#"+t.pre+"mapWrapper3").hide()):($("#"+t.pre+"emmapWrapper1").hide(),$("#"+t.pre+"emmapWrapper2").hide(),$("#"+t.pre+"emmapWrapper3").hide()),t.loadAtomDataIn(e,e.mmcif,"mmcifid"),void 0===t.cfg.align&&1==Object.keys(t.icn3d.structures).length&&$("#"+t.pre+"alternateWrapper").hide();for(var i=void 0!==e.assembly?e.assembly:[],n=0,r=i.length;n<r;++n){null==t.icn3d.biomtMatrices[n]&&(t.icn3d.biomtMatrices[n]=(new THREE.Matrix4).identity());for(var o=0,s=i[n].length;o<s;++o)t.icn3d.biomtMatrices[n].elements[o]=i[n][o]}void 0!==t.icn3d.biomtMatrices&&t.icn3d.biomtMatrices.length>1?($("#"+t.pre+"assemblyWrapper").show(),t.icn3d.asuCnt=t.icn3d.biomtMatrices.length):$("#"+t.pre+"assemblyWrapper").hide(),t.icn3d.setAtomStyleByOptions(t.opts),t.icn3d.setColorByOptions(t.opts,t.icn3d.atoms),t.renderStructure(),void 0!==t.cfg.rotate&&t.rotStruc(t.cfg.rotate,!0),void 0!==t.deferred&&t.deferred.resolve(),void 0!==t.deferred2&&t.deferred2.resolve()},iCn3DUI.prototype.loadMmcifSymmetry=function(e){for(var t=e.assembly,i=0,n=t.length;i<n;++i){var r=new THREE.Matrix4;r.fromArray(t[i]),this.icn3d.biomtMatrices[i]=r}this.icn3d.asuCnt=this.icn3d.biomtMatrices.length},iCn3DUI.prototype.parseMmdbData=function(e){var t=this;if(void 0===e.atoms&&void 0===e.molid2rescount)return alert("invalid MMDB data."),!1;t.icn3d.init(),t.interactionData={moleculeInfor:e.moleculeInfor,intrac:e.intrac,intracResidues:e.intracResidues},t.mmdb_data=e;var i=void 0!==e.pdbId?e.pdbId:e.mmdbId;t.inputid=i;var n=e.moleculeInfor,r={},o={},s={};t.icn3d.chainsColor={},t.icn3d.chainsGene={};var a={};for(var c in n){var l="#"+("000000"+n[c].color.toString(16)).slice(-6),d=n[c].chain.trim();void 0===a[d]?a[d]=1:++a[d];var h=i+"_"+(1===a[d]?d:d+a[d].toString());r[c]=l,o[h]=c,s[c]=h,t.icn3d.chainsColor[h]=new THREE.Color(l),t.icn3d.chainsGene[h]={geneId:n[c].geneId,geneSymbol:n[c].geneSymbol,geneDesc:n[c].geneDesc}}void 0!==t.icn3d.chemicals&&Object.keys(t.icn3d.chemicals).length>0&&Object.keys(t.icn3d.chemicals),t.icn3d.molid2color=r,t.icn3d.chain2molid=o,t.icn3d.molid2chain=s,$("#"+t.pre+"accordion5").show(),t.loadAtomDataIn(e,i,"mmdbid"),t.bAssemblyUseAsu=void 0!==e.asuAtomCount,$.when(t.downloadMmcifSymmetry(i)).then(function(){t.downloadMmdbPart2()})},iCn3DUI.prototype.downloadMmdb=function(e,t){var i,n=this;i=void 0!==t&&t?"https://www.ncbi.nlm.nih.gov/Structure/mmdb/mmdb_strview.cgi?v=2&program=icn3d&b=1&s=1&ft=1&gi="+e:"https://www.ncbi.nlm.nih.gov/Structure/mmdb/mmdb_strview.cgi?v=2&program=icn3d&b=1&s=1&ft=1&uid="+e,n.icn3d.bCid=void 0,void 0!==n.cfg.inpara&&(i+=n.cfg.inpara),void 0===n.chainids2resids&&(n.chainids2resids={}),$.ajax({url:i,dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){n.showLoading()},complete:function(){n.hideLoading()},success:function(r){n.icn3d.isCalphaPhosOnly(r.atoms)||r.atomCount<=n.icn3d.maxatomcnt?n.parseMmdbData(r):(r=null,$.ajax({url:i+"&complexity=2",dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){n.showLoading()},complete:function(){n.hideLoading()},success:function(e){n.parseMmdbData(e)},error:function(i,r,o){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):t?alert("This gi "+e+" has no corresponding 3D structure..."):alert("This mmdbid "+e+" with the parameters "+n.cfg.inpara+" may not have 3D structure data. Please visit the summary page for details: https://www.ncbi.nlm.nih.gov/Structure/pdb/"+e)}}))},error:function(i,r,o){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):t?alert("This gi "+e+" has no corresponding 3D structure..."):alert("This mmdbid "+e+" with the parameters "+n.cfg.inpara+" may not have 3D structure data. Please visit the summary page for details: https://www.ncbi.nlm.nih.gov/Structure/pdb/"+e)}})},iCn3DUI.prototype.downloadMmdbPart2=function(){var e=this;e.bAssemblyUseAsu?($("#"+e.pre+"assemblyWrapper").show(),e.icn3d.bAssembly=!0):($("#"+e.pre+"assemblyWrapper").hide(),e.icn3d.bAssembly=!1),void 0!==e.icn3d.emd?($("#"+e.pre+"mapWrapper1").hide(),$("#"+e.pre+"mapWrapper2").hide(),$("#"+e.pre+"mapWrapper3").hide()):($("#"+e.pre+"emmapWrapper1").hide(),$("#"+e.pre+"emmapWrapper2").hide(),$("#"+e.pre+"emmapWrapper3").hide()),e.icn3d.setAtomStyleByOptions(e.opts),void 0!==e.cfg.blast_rep_id?e.icn3d.setColorByOptions(e.opts,e.icn3d.atoms):e.icn3d.setColorByOptions(e.opts,e.icn3d.atoms,!0),e.renderStructure(),void 0!==e.cfg.rotate&&e.rotStruc(e.cfg.rotate,!0),e.html2ddgm="",void 0!==e.cfg.show2d&&e.cfg.show2d&&(e.openDialog(e.pre+"dl_2ddgm","Interactions"),e.bFullUi&&e.download2Ddgm(e.inputid.toUpperCase())),void 0===e.cfg.align&&1==Object.keys(e.icn3d.structures).length&&null!==$("#"+e.pre+"alternateWrapper")&&$("#"+e.pre+"alternateWrapper").hide(),void 0!==e.deferred&&e.deferred.resolve(),void 0!==e.deferred2&&e.deferred2.resolve()},iCn3DUI.prototype.downloadGi=function(e){this.icn3d.bCid=void 0,this.downloadMmdb(e,!0)},iCn3DUI.prototype.downloadBlast_rep_id=function(e){var t=this;t.icn3d.bCid=void 0;var i=e.split(",");t.cfg.query_id=i[0],t.cfg.blast_rep_id=i[1];var n=t.cfg.blast_rep_id.split("_")[0];t.downloadMmdb(n)},iCn3DUI.prototype.getMissingResidues=function(e,t,i){for(var n=this,r=-9999,o=0,s=!0,a=0,c=e.length;a<c;++a){var l,d;"mmdbid"===t?(l=e[a][1],d=0):"mmcifid"===t?(l=n.icn3d.residueName2Abbr(l=e[a][1]),d=0):"align"===t&&(l=e[a][2],d=1),""===l&&(l="x");var h={};h.resi=a+1;var u=parseInt(e[a][d]),p=a==c-1?9999:parseInt(e[a+1][d]);if(0!==u||0===u&&(-1===r||1==p)){if(h.name=l.toLowerCase(),s&&o>0){void 0===n.countNextresiArray[i]&&(n.countNextresiArray[i]=[]);var m=[o,parseInt(e[a][0])];n.countNextresiArray[i].push(m),o=0}s=!1}else h.name=l.toLowerCase(),++o,s=!0;void 0===n.icn3d.chainsSeq[i]&&(n.icn3d.chainsSeq[i]=[]),h.resi%10==0&&h.resi.toString(),n.icn3d.chainsSeq[i].push(h),r=u}},iCn3DUI.prototype.loadAtomDataIn=function(e,t,i,n){var r=this,o=new THREE.Vector3(9999,9999,9999),s=new THREE.Vector3(-9999,-9999,-9999),a=new THREE.Vector3,c=e.atoms,l=0,d=0,h={},u={};r.pmid=e.pubmedId;var p={},m={},f={};if(r.chainid2title={},r.chainid2sid={},"align"===i){r.pmid="";var g=-1!==r.cfg.inpara.indexOf("atype=1")?"Invariant Core ":"";r.icn3d.molTitle=g+"Structure Alignment of ";for(var v=0,y=e.alignedStructures[0].length;v<y;++v){var b=e.alignedStructures[0][v];1===v&&(r.icn3d.secondId=b.pdbId);for(var _=b.pdbId,w=b.mmdbId,x=b.serialInterval[0],C=b.serialInterval[1];x<=C;++x)h[x]=_.toString(),u[w]=_;for(x=0,C=b.molecules.length;x<C;++x){var S=b.molecules[x].kind,E=b.molecules[x].name,M=b.molecules[x].sequence,T=b.molecules[x].sid,A=_+"_"+(L=b.molecules[x].chain);r.bFullUi&&(p[A]=M),m[A]=S,r.chainid2title[A]=E,void 0!==T&&(r.chainid2sid[A]=T)}r.icn3d.molTitle+='<a href="https://www.ncbi.nlm.nih.gov/Structure/mmdb/mmdbsrv.cgi?uid='+b.pdbId.toUpperCase()+'" target="_blank" style="color: '+r.GREYD+';">'+b.pdbId.toUpperCase()+"</a>",void 0!==b.descr&&(r.pmid+=b.descr.pubmedid),0===v&&(r.icn3d.molTitle+=" and ",void 0!==b.descr&&(r.pmid+="_"))}r.icn3d.molTitle+=" from VAST+"}else if(void 0!==e.descr&&(r.icn3d.molTitle+=e.descr.name),"mmdbid"===i){_=e.pdbId;var k={};for(var R in e.moleculeInfor){A=_+"_"+(L=e.moleculeInfor[R].chain.trim()),k.hasOwnProperty(L)?(++k[L],A+=k[L]):k[L]=1;var D=e.moleculeInfor[R].color;T=e.moleculeInfor[R].sid,m[A]=S=e.moleculeInfor[R].kind,f[A]=D,void 0!==T&&(r.chainid2sid[A]=T)}}if(r.countNextresiArray={},r.bFullUi)if("mmdbid"===i||"mmcifid"===i)for(var L in e.sequences)r.getMissingResidues(e.sequences[L],i,A=t+"_"+L);else if("align"===i)for(var A in p)r.getMissingResidues(p[A],i,A);var I={},O="",P="",H="",N="",z="",F="",U=(d=0,!0),B=!1,j="";r.mmdbMolidResid2mmdbChainResi={};var G=r.icn3d.isCalphaPhosOnly(c),V=0;for(var v in biopolymerChainsHash={},c){var $;if(I[v]=++l,(ie=c[v]).serial=l,"mmdbid"===i||"mmcifid"===i?$=t:"align"===i&&($=h[l]),"mmdbid"===i||"align"===i?(ie.resi_ori=parseInt(ie.resi),ie.resi=ie.ids.r):ie.resi=parseInt(ie.resi),void 0!==ie.chain||"mmdbid"!==i&&"align"!==i)ie.chain=""===ie.chain?"Misc":ie.chain;else if("mmdbid"===i)if(void 0!==r.icn3d.molid2chain[R=ie.ids.m]){var W=r.icn3d.molid2chain[R].indexOf("_");ie.chain=r.icn3d.molid2chain[R].substr(W+1)}else{var q="Misc";++V,"solvent"!==m[z]&&"HOH"!==ie.resn||(ie.resi=V),ie.chain=q}else"align"===i&&(void 0!==r.icn3d.pdbid_molid2chain[$+"_"+(R=ie.ids.m)]?ie.chain=r.icn3d.pdbid_molid2chain[$+"_"+R]:(q="Misc",++V,"solvent"!==m[z]&&"HOH"!==ie.resn||(ie.resi=V),ie.chain=q));ie.chain=ie.chain.trim(),"mmdbid"!==i&&"align"!==i||(ie.structure=$),(z=(N=ie.structure)+"_"+ie.chain)!==P&&(d=0),ie.coord="mmdbid"===i?new THREE.Vector3(ie.coord[0],ie.coord[1],ie.coord[2]):new THREE.Vector3(ie.coord.x,ie.coord.y,ie.coord.z);var Y=r.icn3d.residueName2Abbr(ie.resn.substr(0,3));"mmdbid"!==i&&"align"!==i||!r.bFullUi||(r.mmdbMolidResid2mmdbChainResi[$+"_"+ie.ids.m+"_"+ie.ids.r]=$+"_"+ie.chain+"_"+ie.resi),o.min(ie.coord),s.max(ie.coord),a.add(ie.coord);var X=void 0===r.cfg.mmcifid?"protein"===m[z]:"p"===ie.mt,Z=void 0===r.cfg.mmcifid?"nucleotide"===m[z]:"n"===ie.mt,K=void 0===r.cfg.mmcifid?"solvent"===m[z]:"s"===ie.mt,J=void 0===r.cfg.mmcifid?"ligand"===m[z]||void 0!==m[z]&&-1!==m[z].indexOf("other")||void 0===m[z]:"l"===ie.mt;"Misc"!==ie.chain&&"other"!==m[z]||"protein"===biopolymerChainsHash[z]||"nucleotide"===biopolymerChainsHash[z]||(biopolymerChainsHash[z]="CA"===ie.name?"protein":"P"===ie.name?"nucleotide":"chemical"),X||Z?(X?(r.icn3d.proteins[l]=1,"CA"===ie.name&&(r.icn3d.calphas[l]=1),"N"!==ie.name&&"CA"!==ie.name&&"C"!==ie.name&&"O"!==ie.name&&(r.icn3d.sidec[l]=1)):Z&&(r.icn3d.nucleotides[l]=1,("O3'"==ie.name||"O3*"==ie.name||G&&"P"==ie.name)&&(r.icn3d.nucleotidesO3[l]=1)),ie.het=!1):K?(r.icn3d.water[l]=1,ie.het=!0):J&&("HOH"===ie.resn||"O"===ie.resn?r.icn3d.water[l]=1:ie.elem===ie.resn?r.icn3d.ions[l]=1:r.icn3d.chemicals[l]=1,ie.het=!0),"mmdbid"===i?ie.color=ie.het?r.icn3d.atomColors[ie.elem]||r.icn3d.defaultAtomColor:void 0!==f[z]?new THREE.Color(f[z]):r.icn3d.chargeColors[ie.resn]:void 0!==ie.color&&(ie.color=new THREE.Color(ie.color))," "!==ie.resn.charAt(0)&&" "===ie.resn.charAt(1)&&(ie.resn=ie.resn.charAt(0)),"HOH"==ie.resn&&(r.icn3d.water[l]=1),r.icn3d.atoms[l]=ie,r.icn3d.dAtoms[l]=1,r.icn3d.hAtoms[l]=1,void 0===r.icn3d.chains[A=ie.structure+"_"+ie.chain]&&(r.icn3d.chains[A]={}),r.icn3d.chains[A][l]=1;var Q=ie.structure+"_"+ie.chain+"_"+ie.resi;void 0===r.icn3d.residues[Q]&&(r.icn3d.residues[Q]={}),r.icn3d.residues[Q][l]=1,(F=z+"_"+ie.resi)!==H&&z!==P&&(U=!0,1!==l&&(void 0===r.icn3d.structures[O]&&(r.icn3d.structures[O]=[]),r.icn3d.structures[O].push(P))),r.icn3d.residueId2Name[Q]=Y;var ee="-";if("helix"===ie.ss?ee="H":"sheet"===ie.ss?ee="E":ie.het||Z?ee="o":!ie.het&&r.icn3d.residueColors.hasOwnProperty(ie.resn.toUpperCase())?ee="c":"coil"===ie.ss&&(ee="c"),r.icn3d.secondaries[ie.structure+"_"+ie.chain+"_"+ie.resi]=ee,(ie.resi!=d||R!=j)&&r.bFullUi)if(void 0===r.icn3d.chainsSeq[A]&&(r.icn3d.chainsSeq[A]=[],U=!1),U&&!B&&void 0!==r.icn3d.chainsSeq[A][ie.resi-1])r.icn3d.chainsSeq[A][ie.resi-1].name=Y;else if(!U||!r.icn3d.chainsSeq[A].hasOwnProperty(ie.resi-1)){var te={};te.resi=ie.resi,te.name=Y,ie.resi%10==0&&ie.resi.toString(),r.icn3d.chainsSeq[A].push(te),B=!0}d=ie.resi,O=N,P=z,H=F,j=R}for(var A in biopolymerChainsHash)if(!(Object.keys(r.icn3d.chains[A]).length<10)&&"chemical"!==biopolymerChainsHash[A])for(var l in r.icn3d.chains[A]){var ie=r.icn3d.atoms[l];delete r.icn3d.chemicals[l],ie.het=!1,"protein"===biopolymerChainsHash[A]?(r.icn3d.proteins[l]=1,"CA"===ie.name&&(r.icn3d.calphas[l]=1),"N"!==ie.name&&"CA"!==ie.name&&"C"!==ie.name&&"O"!==ie.name&&(r.icn3d.sidec[l]=1)):"nucleotide"===biopolymerChainsHash[A]&&(r.icn3d.nucleotides[l]=1,("O3'"==ie.name||"O3*"==ie.name||G&&"P"==ie.name)&&(r.icn3d.nucleotidesO3[l]=1))}if(e.atoms={},void 0===r.icn3d.structures[N]&&(r.icn3d.structures[N]=[]),r.icn3d.structures[N].push(z),"mmcifid"!==i)for(var v in r.icn3d.atoms){var ne=void 0===r.icn3d.atoms[v].bonds?0:r.icn3d.atoms[v].bonds.length;for(x=0;x<ne;++x)r.icn3d.atoms[v].bonds[x]=I[r.icn3d.atoms[v].bonds[x]]}if(r.icn3d.cnt=l,(r.icn3d.cnt>r.icn3d.maxatomcnt||void 0!==r.icn3d.biomtMatrices&&r.icn3d.biomtMatrices.length*r.icn3d.cnt>10*r.icn3d.maxatomcnt)&&(r.opts.proteins="c alpha trace",r.opts.nucleotides="o3 trace"),r.icn3d.pmin=o,r.icn3d.pmax=s,r.icn3d.maxD=s.distanceTo(o),r.icn3d.center=a.multiplyScalar(1/r.icn3d.cnt),r.icn3d.maxD<5&&(r.icn3d.maxD=5),r.icn3d.oriMaxD=r.icn3d.maxD,r.icn3d.oriCenter=r.icn3d.center.clone(),"mmdbid"===i){if(void 0!==(ce=e.disulfides))for(v=0,y=ce.length;v<y;++v){var re=r.icn3d.atoms[ce[v][0].ca],oe=r.icn3d.atoms[ce[v][1].ca],se=re.structure+"_"+re.chain+"_"+re.resi,ae=oe.structure+"_"+oe.chain+"_"+oe.resi;void 0===r.icn3d.ssbondpnts[re.structure]&&(r.icn3d.ssbondpnts[re.structure]=[]),r.icn3d.ssbondpnts[re.structure].push(se),r.icn3d.ssbondpnts[re.structure].push(ae)}}else if("mmcifid"===i){var ce;if(void 0!==(ce=e.disulfides)){for(void 0===r.icn3d.ssbondpnts[t]&&(r.icn3d.ssbondpnts[t]=[]),v=0,y=ce.length;v<y;++v)ae=ce[v][1],r.icn3d.ssbondpnts[t].push(se=ce[v][0]),r.icn3d.ssbondpnts[t].push(ae);for(var le=Object.keys(r.icn3d.structures),de=0,he=le.length;de<he;++de)if((b=le[de])!=t)for(void 0===r.icn3d.ssbondpnts[b]&&(r.icn3d.ssbondpnts[b]=[]),x=0,C=r.icn3d.ssbondpnts[t].length;x<C;++x){var ue=r.icn3d.ssbondpnts[t][x],pe=(W=ue.indexOf("_"),b+ue.substr(W));r.icn3d.ssbondpnts[b].push(pe)}}}else if("align"===i){var me={};for(var A in p)if("protein"==m[A])for(M=p[A],b=A.substr(0,A.indexOf("_")),v=0,y=M.length;v<y;++v)"C"==M[v][2]&&(null==me[b]&&(me[b]=[]),me[b].push(A+"_"+M[v][0]));for(var b in me){var fe=me[b];for(v=0,y=fe.length;v<y;++v)for(x=v+1,C=fe.length;x<C;++x){se=fe[v],ae=fe[x];var ge=void 0,ve=void 0;for(var l in r.icn3d.residues[se])if("S"==r.icn3d.atoms[l].elem){ge=r.icn3d.atoms[l].coord;break}for(var l in r.icn3d.residues[ae])if("S"==r.icn3d.atoms[l].elem){ve=r.icn3d.atoms[l].coord;break}void 0!==ge&&void 0!==ve&&(Math.abs(ge.x-ve.x)>4||Math.abs(ge.y-ve.y)>4||Math.abs(ge.z-ve.z)>4||(distSqr=(ge.x-ve.x)*(ge.x-ve.x)+(ge.y-ve.y)*(ge.y-ve.y)+(ge.z-ve.z)*(ge.z-ve.z),distSqr<16&&(void 0===r.icn3d.ssbondpnts[b]&&(r.icn3d.ssbondpnts[b]=[]),r.icn3d.ssbondpnts[b].push(se),r.icn3d.ssbondpnts[b].push(ae))))}}}"align"===i&&void 0!==n&&r.bFullUi&&r.setSeqAlign(n,e.alignedStructures),r.showTitle(),e={}},iCn3DUI.prototype.downloadMmtf=function(e){var t=this;MMTF.fetchReduced(e,function(i){10*i.numAtoms>t.icn3d.maxatomcnt?t.parseMmtfData(i,!1):(i=null,MMTF.fetch(e,function(e){t.parseMmtfData(e,!0)},function(e){console.error(e)}))},function(e){console.error(e)})},iCn3DUI.prototype.parseMmtfData=function(e,t){var i=this;i.icn3d.init();var n=new THREE.Vector3(9999,9999,9999),r=new THREE.Vector3(-9999,-9999,-9999),o=new THREE.Vector3,s=e.structureId;if(i.icn3d.molTitle=e.title,void 0!==e.bioAssemblyList&&void 0!==e.bioAssemblyList[0]&&e.bioAssemblyList[0].transformList.length>1){i.icn3d.biomtMatrices=[];for(var a=0,c=e.bioAssemblyList[0].transformList.length;a<c;++a){var l=(new THREE.Matrix4).fromArray(e.bioAssemblyList[0].transformList[a].matrix).transpose();i.icn3d.biomtMatrices.push(l)}}void 0!==i.icn3d.biomtMatrices&&i.icn3d.biomtMatrices.length>1?($("#"+i.pre+"assemblyWrapper").show(),i.icn3d.asuCnt=i.icn3d.biomtMatrices.length):$("#"+i.pre+"assemblyWrapper").hide();var d,h,u,p,m,f,g,v,y,b,_,w,x,C,S,E={},M=[],T="coil",A="",k=0,R=0;for(MMTF.traverse(e,{onModel:function(e){d=0===e.modelIndex?s:s+(e.modelIndex+1).toString()},onChain:function(e){var t=d+"_"+(h=e.chainName);void 0===i.icn3d.structures[d]&&(i.icn3d.structures[d]=[]),i.icn3d.structures[d].push(t)},onGroup:function(e){u=e.groupName;var t=d+"_"+h+"_"+(p=e.groupId);m=0===e.secStruct||2===e.secStruct||4===e.secStruct?"helix":3===e.secStruct?"sheet":-1===e.secStruct?"other":"coil";var n=!1;if(h!==A){if("coil"!==m&&"other"!==m?(f=!0,g=!1):(f=!1,g=!1),"coil"!==T&&"other"!==T){var r=d+"_"+A+"_"+k.toString();for(var o in i.icn3d.residues[r])i.icn3d.atoms[o].ssbegin=!1,i.icn3d.atoms[o].ssend=!0}}else m!==T?"coil"===T||"other"===T?(f=!0,g=!1):"coil"===m||"other"===m?(n=!0,f=!1,g=!1):("sheet"===T&&"helix"===m||"helix"===T&&"sheet"===m)&&(n=!0,f=!0,g=!1):(f=!1,g=!1);if(n)for(var o in r=d+"_"+h+"_"+(p-1).toString(),i.icn3d.residues[r])i.icn3d.atoms[o].ssbegin=!1,i.icn3d.atoms[o].ssend=!0;T=m,A=h,k=p,v=!1,y=!1,b=!1,"non-polymer"===e.chemCompType.toLowerCase()||"other"===e.chemCompType.toLowerCase()||-1!==e.chemCompType.toLowerCase().indexOf("saccharide")?v=!0:-1!==e.chemCompType.toLowerCase().indexOf("peptide")?y=!0:-1!==e.chemCompType.toLowerCase().indexOf("dna")||-1!==e.chemCompType.toLowerCase().indexOf("rna")?b=!0:y=!0;var s=d+"_"+h,a={};a.resi=p,a.name=i.icn3d.residueName2Abbr(u),i.icn3d.residueId2Name[t]=a.name,a.resi%10==0&&a.resi.toString();var c="-";"helix"===m?c="H":"sheet"===m?c="E":"coil"===m?c="c":"other"===m&&(c="o"),void 0===i.icn3d.chainsSeq[s]&&(i.icn3d.chainsSeq[s]=[]),i.bFullUi&&i.icn3d.chainsSeq[s].push(a),i.icn3d.secondaries[t]=c},onAtom:function(e){if(_=e.element,w=e.atomName,x=new THREE.Vector3(e.xCoord,e.yCoord,e.zCoord),C=e.bFactor,S=e.altLoc,"\0"===e.altLoc&&(S=""),""===S||"A"===S){++R,"SG"===w&&M.push(R),E[e.atomIndex]=R,i.icn3d.atoms[R]={het:v,serial:R,name:w,alt:S,resn:u,structure:d,chain:h,resi:p,coord:x,b:C,elem:_,bonds:[],bondOrder:[],ss:m,ssbegin:f,ssend:g},n.min(x),r.max(x),o.add(x);var s=d+"_"+h,a=s+"_"+p;void 0===i.icn3d.chains[s]&&(i.icn3d.chains[s]={}),i.icn3d.chains[s][R]=1,void 0===i.icn3d.residues[a]&&(i.icn3d.residues[a]={}),i.icn3d.residues[a][R]=1,y?(i.icn3d.proteins[R]=1,"CA"===w&&(i.icn3d.calphas[R]=1),"N"!==w&&"CA"!==w&&"C"!==w&&"O"!==w&&(i.icn3d.sidec[R]=1)):b?(i.icn3d.nucleotides[R]=1,(!t||"O3'"!=w&&"O3*"!=w)&&(t||"P"!=w)||(i.icn3d.nucleotidesO3[R]=1)):_.toLowerCase()===u.toLowerCase()?i.icn3d.ions[R]=1:"HOH"===u||"WAT"===u||"SQL"===u||"H2O"===u||"W"===u||"DOD"===u||"D3O"===u?i.icn3d.water[R]=1:i.icn3d.chemicals[R]=1,i.icn3d.dAtoms[R]=1,i.icn3d.hAtoms[R]=1}},onBond:function(e){var t=E[e.atomIndex1],n=E[e.atomIndex2];if(E.hasOwnProperty(e.atomIndex1)&&E.hasOwnProperty(e.atomIndex2)&&(i.icn3d.atoms[t].bonds.push(n),i.icn3d.atoms[n].bonds.push(t),v)){var r=e.bondOrder;i.icn3d.atoms[t].bondOrder.push(r),i.icn3d.atoms[n].bondOrder.push(r),2===r?(i.icn3d.doublebonds[t+"_"+n]=1,i.icn3d.doublebonds[n+"_"+t]=1):3===r&&(i.icn3d.triplebonds[t+"_"+n]=1,i.icn3d.triplebonds[n+"_"+t]=1)}}}),a=0,c=M.length;a<c;++a)for(var D=a+1;D<c;++D){var L=M[D],I=i.icn3d.atoms[M[a]],O=i.icn3d.atoms[L];if(-1!==$.inArray(L,I.bonds)){var P=I.structure+"_"+I.chain+"_"+I.resi,H=O.structure+"_"+O.chain+"_"+O.resi;void 0===i.icn3d.ssbondpnts[I.structure]&&(i.icn3d.ssbondpnts[I.structure]=[]),i.icn3d.ssbondpnts[I.structure].push(P),i.icn3d.ssbondpnts[I.structure].push(H)}}i.icn3d.cnt=R,(i.icn3d.cnt>i.icn3d.maxatomcnt||void 0!==i.icn3d.biomtMatrices&&i.icn3d.biomtMatrices.length*i.icn3d.cnt>10*i.icn3d.maxatomcnt)&&(i.opts.proteins="c alpha trace",i.opts.nucleotides="o3 trace"),i.icn3d.pmin=n,i.icn3d.pmax=r,i.icn3d.maxD=r.distanceTo(n),i.icn3d.center=o.multiplyScalar(1/i.icn3d.cnt),i.icn3d.maxD<5&&(i.icn3d.maxD=5),i.icn3d.oriMaxD=i.icn3d.maxD,i.icn3d.oriCenter=i.icn3d.center.clone(),void 0===i.cfg.align&&1==Object.keys(i.icn3d.structures).length&&$("#"+i.pre+"alternateWrapper").hide(),i.icn3d.setAtomStyleByOptions(i.opts),i.icn3d.setColorByOptions(i.opts,i.icn3d.atoms),i.renderStructure(),i.showTitle(),void 0!==i.cfg.rotate&&i.rotStruc(i.cfg.rotate,!0),void 0!==i.deferred&&i.deferred.resolve(),void 0!==i.deferred2&&i.deferred2.resolve()},iCn3DUI.prototype.downloadPdb=function(e){var t,i=this;t="https://files.rcsb.org/view/"+e+".pdb",i.icn3d.bCid=void 0,$.ajax({url:t,dataType:"text",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){i.showLoading()},complete:function(){i.hideLoading()},success:function(e){i.loadPdbData(e)},error:function(e,t,i){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})},iCn3DUI.prototype.downloadUrl=function(e,t){var i=this;i.icn3d.bCid=void 0,$.ajax({url:e,dataType:"text",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){$("#"+i.pre+"wait")&&$("#"+i.pre+"wait").show(),$("#"+i.pre+"canvas")&&$("#"+i.pre+"canvas").hide(),$("#"+i.pre+"cmdlog")&&$("#"+i.pre+"cmdlog").hide()},complete:function(){$("#"+i.pre+"wait")&&$("#"+i.pre+"wait").hide(),$("#"+i.pre+"canvas")&&$("#"+i.pre+"canvas").show(),$("#"+i.pre+"cmdlog")&&$("#"+i.pre+"cmdlog").show()},success:function(e){i.InputfileData=e,i.InputfileType=t,"pdb"===t?i.loadPdbData(e):"mol2"===t?i.loadMol2Data(e):"sdf"===t?i.loadSdfData(e):"xyz"===t?i.loadXyzData(e):"mmcif"===t&&i.loadMmcifData(e)},error:function(e,t,i){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})},iCn3DUI.prototype.loadPdbData=function(e){var t=this;if(t.icn3d.loadPDB(e),void 0!==t.icn3d.biomtMatrices&&t.icn3d.biomtMatrices.length>1?($("#"+t.pre+"assemblyWrapper").show(),t.icn3d.asuCnt=t.icn3d.biomtMatrices.length):$("#"+t.pre+"assemblyWrapper").hide(),void 0!==t.icn3d.emd?($("#"+t.pre+"mapWrapper1").hide(),$("#"+t.pre+"mapWrapper2").hide(),$("#"+t.pre+"mapWrapper3").hide()):($("#"+t.pre+"emmapWrapper1").hide(),$("#"+t.pre+"emmapWrapper2").hide(),$("#"+t.pre+"emmapWrapper3").hide()),!t.icn3d.bSecondaryStructure)return t.deferredSecondary=$.Deferred(function(){var i=t.icn3d.isCalphaPhosOnly(t.icn3d.hash2Atoms(t.icn3d.proteins));t.loadPdbDataBase(e,i?"1":"0")}),t.deferredSecondary.promise();t.loadPdbDataRender()},iCn3DUI.prototype.loadPdbDataBase=function(e,t){var i=this;$.ajax({url:"https://www.ncbi.nlm.nih.gov/Structure/mmcifparser/mmcifparser.cgi",type:"POST",data:{dssp:"t",calphaonly:t,pdbfile:e},dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,success:function(e){var t=e;if(-1===JSON.stringify(e).indexOf("Oops there was a problem"))for(var n in i.icn3d.chainsSeq)for(var r=n.indexOf("_"),o=n.substr(r+1),s=i.icn3d.chainsSeq[n],a="coil",c=0,l=s.length;c<l;++c){var d,h=s[c].resi,u=o+"_"+h,p="c";t.hasOwnProperty(u)&&(p=t[u]),d="H"===p?"helix":"E"===p?"sheet":"coil";var m=n+"_"+h;i.icn3d.secondaries[m]=p;var f=0;if(d!==a?"coil"===a?(ssbegin=!0,ssend=!1):"coil"===d?(f=2,ssbegin=!1,ssend=!1):("sheet"===a&&"helix"===d||"helix"===a&&"sheet"===d)&&(f=1,ssbegin=!0,ssend=!1):(ssbegin=!1,ssend=!1),1==f){var g=n+"_"+(h-1).toString();for(var v in i.icn3d.residues[g])i.icn3d.atoms[v].ssbegin=!0,i.icn3d.atoms[v].ssend=!1}else if(2==f)for(var v in g=n+"_"+(h-1).toString(),i.icn3d.residues[g])i.icn3d.atoms[v].ssbegin=!1,i.icn3d.atoms[v].ssend=!0;for(var v in i.icn3d.residues[m])i.icn3d.atoms[v].ss=d,i.icn3d.atoms[v].ssbegin=ssbegin,i.icn3d.atoms[v].ssend=ssend;a=d}i.loadPdbDataRender(),void 0!==i.deferredSecondary&&i.deferredSecondary.resolve()},error:function(e,t,n){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):(i.loadPdbDataRender(),void 0!==i.deferredSecondary&&i.deferredSecondary.resolve())}})},iCn3DUI.prototype.loadPdbDataRender=function(){var e=this;e.pmid=e.icn3d.pmid,void 0===e.cfg.align&&1==Object.keys(e.icn3d.structures).length&&$("#"+e.pre+"alternateWrapper").hide(),e.icn3d.setAtomStyleByOptions(e.opts),e.icn3d.setColorByOptions(e.opts,e.icn3d.atoms),e.renderStructure(),e.showTitle(),void 0!==e.cfg.rotate&&e.rotStruc(e.cfg.rotate,!0),void 0!==e.deferred&&e.deferred.resolve(),void 0!==e.deferred2&&e.deferred2.resolve()},iCn3DUI.prototype.downloadCid=function(e){var t=this,i="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+e+"/record/SDF/?record_type=3d&response_type=display";t.opts.pk="atom",t.opts.chemicals="ball and stick",t.icn3d.opts.pk="atom",t.icn3d.opts.chemicals="ball and stick",t.icn3d.bCid=!0,$.ajax({url:i,dataType:"text",cache:!0,tryCount:0,retryLimit:1,beforeSend:function(){t.showLoading()},complete:function(){t.hideLoading()},success:function(i){var n=t.loadSdfAtomData(i,e);void 0===t.cfg.align&&1==Object.keys(t.icn3d.structures).length&&$("#"+t.pre+"alternateWrapper").hide(),n?(t.icn3d.setAtomStyleByOptions(t.opts),t.icn3d.setColorByOptions(t.opts,t.icn3d.atoms),t.renderStructure(),void 0!==t.cfg.rotate&&t.rotStruc(t.cfg.rotate,!0),void 0!==t.deferred&&t.deferred.resolve(),void 0!==t.deferred2&&t.deferred2.resolve()):alert("The SDF of CID "+e+" has the wrong format...")},error:function(e,t,i){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}}).fail(function(){alert("This CID may not have 3D structure...")})},iCn3DUI.prototype.loadSdfData=function(e){var t=this,i=t.loadSdfAtomData(e);void 0===t.cfg.align&&1==Object.keys(t.icn3d.structures).length&&$("#"+t.pre+"alternateWrapper").hide(),i?(t.icn3d.setAtomStyleByOptions(t.opts),t.icn3d.setColorByOptions(t.opts,t.icn3d.atoms),t.renderStructure(),void 0!==t.cfg.rotate&&t.rotStruc(t.cfg.rotate,!0),void 0!==t.deferred&&t.deferred.resolve(),void 0!==t.deferred2&&t.deferred2.resolve()):alert("The SDF file has the wrong format...")},iCn3DUI.prototype.loadSdfAtomData=function(e,t){var i=this,n=e.split(/\r?\n|\r/);if(n.length<4)return!1;i.icn3d.init();var r=t||1,o=r,s=r+"_A",a=s+"_1",c=parseInt(n[3].substr(0,3));if(isNaN(c)||c<=0)return!1;var l=parseInt(n[3].substr(3,3)),d=4;if(n.length<d+c+l)return!1;var h,u,p=c,m={},f={},g={},v=1;for(h=0;h<p;h++){u=n[d],d++;var y=u.substr(31,3).replace(/ /g,"");if("H"!==y){var b=parseFloat(u.substr(0,10)),_=parseFloat(u.substr(10,10)),w=parseFloat(u.substr(20,10)),x=new THREE.Vector3(b,_,w);i.icn3d.atoms[v]={het:!0,serial:v,name:y,resn:"LIG",structure:r,chain:"A",resi:1,coord:x,b:0,elem:y,bonds:[],ss:"coil",ssbegin:!1,ssend:!1,bondOrder:[]},g[v]=1,m[h]=v,++v}else f[h]=1}for(i.icn3d.dAtoms=g,i.icn3d.hAtoms=g,i.icn3d.structures[o]=[s],i.icn3d.chains[s]=g,i.icn3d.residues[a]=g,i.icn3d.residueId2Name[a]="LIG",void 0===i.icn3d.chainsSeq[s]&&(i.icn3d.chainsSeq[s]=[]),i.icn3d.chainsSeq[s].push({resi:1,name:"LIG"}),h=0;h<l;h++){u=n[d],d++;var C=parseInt(u.substr(0,3))-1+0,S=parseInt(u.substr(3,3))-1+0,E=u.substr(6,3).trim();if(!f.hasOwnProperty(C)&&!f.hasOwnProperty(S)){var M=m[C],T=m[S];i.icn3d.atoms[M].bonds.push(T),i.icn3d.atoms[M].bondOrder.push(E),i.icn3d.atoms[T].bonds.push(M),i.icn3d.atoms[T].bondOrder.push(E),"2"==E?(i.icn3d.doublebonds[M+"_"+T]=1,i.icn3d.doublebonds[T+"_"+M]=1):"3"==E&&(i.icn3d.triplebonds[M+"_"+T]=1,i.icn3d.triplebonds[T+"_"+M]=1)}}return i.setMaxD(),i.showTitle(),!0},iCn3DUI.prototype.setMaxD=function(){var e=this,t=new THREE.Vector3(9999,9999,9999),i=new THREE.Vector3(-9999,-9999,-9999),n=new THREE.Vector3,r=0;for(var o in e.icn3d.atoms){var s=e.icn3d.atoms[o],a=s.coord;n.add(a),t.min(a),i.max(a),++r,s.het&&(-1!==$.inArray(s.elem,e.icn3d.ionsArray)?e.icn3d.ions[s.serial]=1:e.icn3d.chemicals[s.serial]=1)}e.icn3d.pmin=t,e.icn3d.pmax=i,e.icn3d.cnt=r,e.icn3d.maxD=e.icn3d.pmax.distanceTo(e.icn3d.pmin),e.icn3d.center=n.multiplyScalar(1/e.icn3d.cnt),e.icn3d.maxD<5&&(e.icn3d.maxD=5),e.icn3d.oriMaxD=e.icn3d.maxD,e.icn3d.oriCenter=e.icn3d.center.clone()},iCn3DUI.prototype.saveStlFile=function(e){var t=this;if(Object.keys(t.icn3d.dAtoms).length>7e4)return alert("Please display a subset of the structure to export 3D files. Then merge the files for 3D printing..."),[""];t.prepareFor3Dprint();for(var i=0,n=0,r=t.icn3d.mdl.children.length;n<r;++n)if("Sprite"!==(a=t.icn3d.mdl.children[n]).type&&void 0!==(c=a.geometry.faces))for(var o=0,s=c.length;o<s;++o)++i;for(n=0,r=t.icn3d.mdl_ghost.children.length;n<r;++n){var a,c;if("Sprite"!==(a=t.icn3d.mdl_ghost.children[n]).type&&void 0!==(c=a.geometry.faces))for(o=0,s=c.length;o<s;++o)++i}var l=[],d=new Uint8Array(84),h="STL file for the structure(s) ",u=Object.keys(t.icn3d.structures);for(n=0,r=u.length;n<r;++n)h+=u[n],n<r-1&&(h+=", ");for(h.length>80&&(h=h.substr(0,80)),n=0;n<80;++n)d[n]=n<h.length?t.passInt8([h.charCodeAt(n)])[0]:t.passInt8([" ".charCodeAt(0)])[0];if(d=void 0!==t.icn3d.biomtMatrices&&t.icn3d.biomtMatrices.length>1&&t.icn3d.bAssembly&&Object.keys(t.icn3d.dAtoms).length*t.icn3d.biomtMatrices.length<=t.icn3d.maxAtoms3DMultiFile?t.updateArray(d,t.passInt32([i*t.icn3d.biomtMatrices.length]),80):t.updateArray(d,t.passInt32([i]),80),l.push(new Blob([d],{type:"application/octet-stream"})),l=t.processStlMeshGroup(t.icn3d.mdl,l,e),l=t.processStlMeshGroup(t.icn3d.mdl_ghost,l,e),void 0!==t.icn3d.biomtMatrices&&t.icn3d.biomtMatrices.length>1&&t.icn3d.bAssembly&&Object.keys(t.icn3d.dAtoms).length*t.icn3d.biomtMatrices.length<=t.icn3d.maxAtoms3DMultiFile){var p=new THREE.Matrix4;for(p.identity(),n=0;n<t.icn3d.biomtMatrices.length;n++){var m=t.icn3d.biomtMatrices[n];void 0!==m&&(m.equals(p)||(l=t.processStlMeshGroup(t.icn3d.mdl,l,m),l=t.processStlMeshGroup(t.icn3d.mdl_ghost,l,m)))}}return l},iCn3DUI.prototype.updateArray=function(e,t,i){for(var n=0,r=t.length;n<r;++n)e[i+n]=t[n];return e},iCn3DUI.prototype.processStlMeshGroup=function(e,t,i){for(var n=this,r=0,o=e.children.length;r<o;++r){var s=e.children[r];if("Sprite"!==s.type){var a=s.geometry,c=a.vertices,l=a.faces;if(void 0!==l){for(var d=s.position,h=s.scale,u=s.matrix,p=new Uint8Array(50*l.length),m=0,f=0,g=l.length;f<g;++f){var v,y,b,_=l[f].a,w=l[f].b,x=l[f].c,C=l[f].normal;"SphereGeometry"==a.type||"BoxGeometry"==a.type?(v=c[_].clone().multiply(h).add(d),y=c[w].clone().multiply(h).add(d),b=c[x].clone().multiply(h).add(d)):"CylinderGeometry"==a.type?(v=c[_].clone().applyMatrix4(u),y=c[w].clone().applyMatrix4(u),b=c[x].clone().applyMatrix4(u)):(v=c[_].clone(),y=c[w].clone(),b=c[x].clone()),void 0!==C?(void 0!==i&&C.applyMatrix4(i),p=n.updateArray(p,n.passFloat32([C.x,C.y,C.z]),m),m+=12):(p=n.updateArray(p,n.passFloat32([0,0,0]),m),m+=12),void 0!==i&&(v.applyMatrix4(i),y.applyMatrix4(i),b.applyMatrix4(i)),p=n.updateArray(p,n.passFloat32([v.x,v.y,v.z]),m),m+=12,p=n.updateArray(p,n.passFloat32([y.x,y.y,y.z]),m),m+=12,p=n.updateArray(p,n.passFloat32([b.x,b.y,b.z]),m),m+=12,v=y=b=void 0,p=n.updateArray(p,n.passInt16([0]),m),m+=2}t.push(new Blob([p],{type:"application/octet-stream"})),p=null}}}return t},iCn3DUI.prototype.saveVrmlFile=function(e){var t=this;if(Object.keys(t.icn3d.dAtoms).length>5e4)return alert("Please display a subset of the structure to export 3D files. Then merge the files for 3D printing..."),[""];t.prepareFor3Dprint();var i=[];i.push("#VRML V2.0 utf8\n");var n=0,r=t.processVrmlMeshGroup(t.icn3d.mdl,i,n,e);if(i=(r=t.processVrmlMeshGroup(t.icn3d.mdl_ghost,i=r.vrmlStrArray,n=r.vertexCnt,e)).vrmlStrArray,n=r.vertexCnt,void 0!==t.icn3d.biomtMatrices&&t.icn3d.biomtMatrices.length>1&&t.icn3d.bAssembly&&Object.keys(t.icn3d.dAtoms).length*t.icn3d.biomtMatrices.length<=t.icn3d.maxAtoms3DMultiFile){var o=new THREE.Matrix4;o.identity();for(var s=0;s<t.icn3d.biomtMatrices.length;s++){var a=t.icn3d.biomtMatrices[s];void 0!==a&&(a.equals(o)||(r=t.processVrmlMeshGroup(t.icn3d.mdl,i,n,a),i=(r=t.processVrmlMeshGroup(t.icn3d.mdl_ghost,i=r.vrmlStrArray,n=r.vertexCnt,a)).vrmlStrArray,n=r.vertexCnt))}}return i},iCn3DUI.prototype.processVrmlMeshGroup=function(e,t,i,n){for(var r=0,o=e.children.length;r<o;++r){var s=e.children[r];if("Sprite"!==s.type){var a=s.geometry,c="Surface"==a.type,l=a.vertices;if(void 0!==l){i+=l.length;var d=a.faces,h=s.position,u=s.scale,p=s.matrix,m=new THREE.Color(1,1,1);"SphereGeometry"!=a.type&&"BoxGeometry"!=a.type&&"CylinderGeometry"!=a.type||void 0!==s.material&&(m=s.material.color),t.push("Shape {\n"),t.push("geometry IndexedFaceSet {\n"),t.push("coord Coordinate { point [ ");for(var f=[],g=0,v=l.length;g<v;++g){var y;y="SphereGeometry"==a.type||"BoxGeometry"==a.type?l[g].clone().multiply(u).add(h):"CylinderGeometry"==a.type?l[g].clone().applyMatrix4(p):l[g].clone(),void 0!==n&&y.applyMatrix4(n),t.push(y.x.toPrecision(5)+" "+y.y.toPrecision(5)+" "+y.z.toPrecision(5)),y=void 0,g<v-1&&t.push(", "),f.push(new THREE.Color(1,1,1))}t.push(" ] }\n");var b="",_="";if(c){for(g=0,v=d.length;g<v;++g)b+=(w=d[g].a)+" "+(x=d[g].b)+" "+(C=d[g].c),g<v-1&&(b+=", -1, "),f[w]=d[g].vertexColors[0],f[x]=d[g].vertexColors[1],f[C]=d[g].vertexColors[2];for(g=0,v=f.length;g<v;++g)_+=(S=f[g]).r.toPrecision(3)+" "+S.g.toPrecision(3)+" "+S.b.toPrecision(3),g<v-1&&(_+=", ");t.push("coordIndex [ "+b+" ]\n"),t.push("color Color { color [ "+_+" ] } colorPerVertex TRUE\n")}else{for(g=0,v=d.length;g<v;++g){var w,x,C;b+=(w=d[g].a)+" "+(x=d[g].b)+" "+(C=d[g].c),g<v-1&&(b+=", -1, "),f[w]=S="SphereGeometry"==a.type||"BoxGeometry"==a.type||"CylinderGeometry"==a.type?m:d[g].color,f[x]=S,f[C]=S}for(g=0,v=f.length;g<v;++g){var S;_+=(S=f[g]).r.toPrecision(3)+" "+S.g.toPrecision(3)+" "+S.b.toPrecision(3),g<v-1&&(_+=", ")}t.push("coordIndex [ "+b+" ]\n"),t.push("color Color { color [ "+_+" ] } colorPerVertex TRUE\n")}t.push("  }\n"),t.push("}\n")}}}return{vrmlStrArray:t,vertexCnt:i}},iCn3DUI.prototype.setThichknessFor3Dprint=function(){var e=this;e.icn3d.lineRadius=1,e.icn3d.coilWidth=1.2,e.icn3d.cylinderRadius=.8,e.icn3d.traceRadius=1,e.icn3d.dotSphereScale=.6,e.icn3d.sphereRadius=1.5,e.icn3d.ribbonthickness=1,e.icn3d.helixSheetWidth=2,e.icn3d.nucleicAcidWidth=1.4},iCn3DUI.prototype.prepareFor3Dprint=function(){var e=this;if(e.icn3d.bShowHighlight=!1,e.icn3d.removeHlObjects(),e.bDashedLines=!1,e.bSetThickness||void 0!==e.cfg.cid||e.setThichknessFor3Dprint(),void 0!==e.icn3d.lines.hbond)for(var t=0,i=e.icn3d.lines.hbond.length;t<i;++t)e.icn3d.lines.hbond[t].dashed=!1,e.bDashedLines=!0;if(void 0!==e.icn3d.lines.distance)for(t=0,i=e.icn3d.lines.distance.length;t<i;++t)e.icn3d.lines.distance[t].dashed=!1,e.bDashedLines=!0;e.icn3d.draw()},iCn3DUI.prototype.resetAfter3Dprint=function(){var e=this;if(void 0!==e.icn3d.lines.hbond)for(var t=0,i=e.icn3d.lines.hbond.length;t<i;++t)e.icn3d.lines.hbond[t].dashed=!0;if(void 0!==e.icn3d.lines.distance)for(t=0,i=e.icn3d.lines.distance.length;t<i;++t)e.icn3d.lines.distance[t].dashed=!0;e.icn3d.lineRadius=.1,e.icn3d.coilWidth=.3,e.icn3d.cylinderRadius=.4,e.icn3d.traceRadius=.4,e.icn3d.dotSphereScale=.3,e.icn3d.sphereRadius=1.5,e.icn3d.cylinderHelixRadius=1.6,e.icn3d.ribbonthickness=.2,e.icn3d.helixSheetWidth=1.3,e.icn3d.nucleicAcidWidth=.8},iCn3DUI.prototype.removeOneStabilizer=function(e){for(var t,i=this,n=0,r=i.icn3d.pairArray.length;n<r;n+=2){var o=i.getResidueRepAtom(i.icn3d.pairArray[n]),s=i.getResidueRepAtom(i.icn3d.pairArray[n+1]);if(null!=e)for(var a=0,c=e.length;a<c;a+=2){var l=i.getResidueRepAtom(e[a]),d=i.getResidueRepAtom(e[a+1]);if(o.serial==l.serial&&s.serial==d.serial||o.serial==d.serial&&s.serial==l.serial){t=n;break}}if(void 0!==t)break}void 0!==t&&i.icn3d.pairArray.splice(t,2)},iCn3DUI.prototype.outputSelection=function(){var e=this,t={};for(var i in e.icn3d.hAtoms)t[e.icn3d.atoms[i].structure+"_"+e.icn3d.atoms[i].chain+"_"+e.icn3d.atoms[i].resi]=1;for(var n=Object.keys(t).sort(function(e,t){if(""!==e&&!isNaN(e))return parseInt(e)-parseInt(t);var i=e.lastIndexOf("_"),n=t.lastIndexOf("_");if(e.substr(0,i)<t.substr(0,i))return-1;if(e.substr(0,i)>t.substr(0,i))return 1;if(e.substr(0,i)==t.substr(0,i)){if(parseInt(e.substr(i+1))<parseInt(t.substr(n+1)))return-1;if(parseInt(e.substr(i+1))>parseInt(t.substr(n+1)))return 1;if(parseInt(e.substr(i+1))==parseInt(t.substr(n+1)))return 0}}),r="<table><tr><th>Structure</th><th>Chain</th><th>Residue Number</th></tr>",o=(i=0,n.length);i<o;++i){var s=n[i].indexOf("_"),a=n[i].lastIndexOf("_");r+="<tr><td>"+n[i].substr(0,s)+"</td><td>"+n[i].substr(s+1,a-s-1)+"</td><td>"+n[i].substr(a+1)+"</td></tr>"}e.saveFile((e.inputid?e.inputid:"custom")+"_residues.txt","html",r)},iCn3DUI.prototype.addStabilizer=function(){var e=this;if(e.icn3d.opts.water="dot",Object.keys(e.icn3d.dAtoms).length>0){var t={};for(var i in e.icn3d.dAtoms)!e.icn3d.nucleotides.hasOwnProperty((R=e.icn3d.atoms[i]).serial)||"N1"!==R.name&&"N2"!==R.name&&"N3"!==R.name&&"N4"!==R.name&&"N6"!==R.name&&"O2"!==R.name&&"O6"!==R.name||(t[R.structure+"_"+R.chain+"_"+R.resi+"_"+R.name]=R);var n=(E=Object.keys(t)).length;for(void 0===e.icn3d.pairArray&&(e.icn3d.pairArray=[]),i=0;i<n;++i)for(var r=i+1;r<n;++r){var o=E[i],s=E[r],a=Math.abs(t[o].coord.x-t[s].coord.x);if(!(a>3.5)){var c=Math.abs(t[o].coord.y-t[s].coord.y);if(!(c>3.5)){var l=Math.abs(t[o].coord.z-t[s].coord.z);if(!(l>3.5)){var d=a*a+c*c+l*l;d>12.25||d<3.2*3.2||(e.icn3d.pairArray.push(t[o].serial),e.icn3d.pairArray.push(t[s].serial))}}}}var h={};for(var i in e.icn3d.dAtoms)h[w=(R=e.icn3d.atoms[i]).structure+"_"+R.chain+"_"+R.resi]=1;var u={};for(var i in e.icn3d.chemicals)h.hasOwnProperty(w=(R=e.icn3d.atoms[i]).structure+"_"+R.chain+"_"+R.resi)&&(u[w]=1);for(var i in e.icn3d.ions)h.hasOwnProperty(w=(R=e.icn3d.atoms[i]).structure+"_"+R.chain+"_"+R.resi)&&(u[w]=1);for(var p=Object.keys(e.icn3d.chains),m=(i=0,p.length);i<m;++i){for(var f=p[i],g=0,v=0,y=(r=0,e.icn3d.chainsSeq[f].length);r<y;++r)"c"!=e.icn3d.secondaries[w=f+"_"+e.icn3d.chainsSeq[f][r].resi]&&"E"!=e.icn3d.secondaries[w]&&"H"!=e.icn3d.secondaries[w]||(g%3!=0&&e.icn3d.chainsSeq[f][r].resi==v+1||h.hasOwnProperty(w)&&(u[w]=1),++g,v=e.icn3d.chainsSeq[f][r].resi);"c"!=e.icn3d.secondaries[w]&&"E"!=e.icn3d.secondaries[w]&&"H"!=e.icn3d.secondaries[w]||h.hasOwnProperty(w)&&(u[w]=1)}var b=Object.keys(u);void 0===e.icn3d.pairArray&&(e.icn3d.pairArray=[]);var _=e.icn3d.exclHash(e.icn3d.dAtoms,e.icn3d.water);for(i=0,m=b.length;i<m;++i){var w,x=e.icn3d.secondaries[w=b[i]],C=e.icn3d.getNeighboringAtoms(_,e.icn3d.hash2Atoms(e.icn3d.residues[w]),6),S=Object.keys(C).sort(),E=Object.keys(e.icn3d.residues[w]).sort(),M=!1;if(e.icn3d.proteins.hasOwnProperty(E[0])){E=[E[0]],M=!0;var T=parseInt(w.substr(w.lastIndexOf("_")+1)),A={};for(var k in C)if(!e.icn3d.chemicals.hasOwnProperty(k)&&!e.icn3d.ions.hasOwnProperty(k)){var R=e.icn3d.atoms[k];("c"==x&&(R.resi>T+1||R.resi<T-1)||"E"==x&&(R.resi>T+2||R.resi<T-2)||"H"==x&&(R.resi>T+4||R.resi<T-4))&&(A[k]=1)}S=Object.keys(A).sort()}if(S.length>0&&E.length>0)if(M){var D=parseInt((S.length+.5)/2);e.icn3d.pairArray.push(E[0]),e.icn3d.pairArray.push(S[D])}else{var L=parseInt(S.length/11);for(r=0,y=E.length;r<y;++r)if(r%10==0){var I=parseInt(r/10)*L;D=I<S.length?I:S.length-1,e.icn3d.pairArray.push(E[r]),e.icn3d.pairArray.push(S[D]),E.length<11&&(e.icn3d.pairArray.push(E[r]),e.icn3d.pairArray.push(S[S.length-1]))}}}}},iCn3DUI.prototype.hideStabilizer=function(){var e=this;for(var t in e.icn3d.pairArray=[],e.icn3d.lines.stabilizer=[],e.icn3d.stabilizerpnts=[],e.icn3d.water)e.icn3d.atoms[t].style=e.icn3d.opts.water},iCn3DUI.prototype.getResidueRepPos=function(e){var t,i=this,n=i.icn3d.atoms[e],r=n.structure+"_"+n.chain+"_"+n.resi;if(i.icn3d.proteins.hasOwnProperty(e)||i.icn3d.nucleotides.hasOwnProperty(e))for(var o in i.icn3d.residues[r]){var s=i.icn3d.atoms[o];if("N3"===s.name){t=i.icn3d.atoms[o].coord;break}if("CA"===s.name&&"coil"==s.ss){t=i.icn3d.atoms[o].coord;break}if("CA"===s.name&&("helix"==s.ss||"sheet"==s.ss)){t=void 0!==i.icn3d.atoms[o].coord2?i.icn3d.atoms[o].coord2:i.icn3d.atoms[o].coord;break}}else t=n.coord;return void 0===t&&(t=n.coord),t},iCn3DUI.prototype.getResidueRepAtom=function(e){var t,i=this,n=i.icn3d.atoms[e],r=n.structure+"_"+n.chain+"_"+n.resi;if(i.icn3d.proteins.hasOwnProperty(e)||i.icn3d.nucleotides.hasOwnProperty(e))for(var o in i.icn3d.residues[r]){var s=i.icn3d.atoms[o];if("CA"===s.name||"N3"===s.name){t=i.icn3d.atoms[o];break}}else t=n;return void 0===t&&(t=n),t},iCn3DUI.prototype.downloadAlignment=function(e){var t=this;t.opts.proteins="c alpha trace",t.icn3d.opts.proteins="c alpha trace",t.bFullUi&&t.isMac()&&t.isMobile&&(t.MENU_WIDTH=950,t.setViewerWidthHeight(),t.resizeCanvas(t.WIDTH-t.LESSWIDTH,t.HEIGHT-t.LESSHEIGHT,!0,!1));var i=e.split(","),n="ids="+e,r="https://www.ncbi.nlm.nih.gov/Structure/vastplus/vastplus.cgi?v=2&cmd=c&b=1&s=1&w3d&"+n,o="https://www.ncbi.nlm.nih.gov/Structure/vastplus/vastplus.cgi?v=2&cmd=c1&b=1&s=1&d=1&"+n;void 0!==t.cfg.inpara&&(r+=t.cfg.inpara,o+=t.cfg.inpara),t.icn3d.bCid=void 0,t.icn3d.pdbid_chain2title={},void 0===t.chainids2resids&&(t.chainids2resids={});var s=$.ajax({url:o,dataType:"jsonp",cache:!0}),a={};s.then(function(e){if(void 0===(a=e.seqalign))return alert("These two MMDB IDs "+i+" do not have 3D alignment data."),!1;t.icn3d.pdbid_molid2chain={},t.icn3d.chainsColor={};for(var n=0,o=2;n<o;++n){var s=void 0!==(u=e.alignedStructures[0][n]).pdbId?u.pdbId:u.mmdbId,c={};for(var l in u.molecules){var d=u.molecules[l].chain.trim();void 0===c[d]?c[d]=1:++c[d];var h=1===c[d]?d:d+c[d].toString();t.icn3d.pdbid_molid2chain[s+"_"+l]=h,"p"!==u.molecules[l].kind&&"n"!==u.molecules[l].kind||(t.icn3d.chainsColor[s+"_"+h]=new THREE.Color(t.GREY8))}}for(n=0,o=2;n<o;++n){s=(u=e.alignedStructures[0][n]).pdbId;var u,p=u.molecules;for(var m in p)t.icn3d.pdbid_chain2title[s+"_"+p[m].chain]=p[m].name}for(t.alignmolid2color=[],t.alignmolid2color[0]={},t.alignmolid2color[1]={},n=0,o=a.length;n<o;++n){var f=a[n][1].moleculeId;t.alignmolid2color[0][a[n][0].moleculeId]=(n+1).toString(),t.alignmolid2color[1][f]=(n+1).toString()}return $.ajax({url:r,dataType:"jsonp",cache:!0,beforeSend:function(){t.showLoading()},complete:function(){t.hideLoading()}})}).done(function(e){if(void 0===e.atoms)return alert("invalid atoms data."),!1;t.icn3d.init(),t.loadAtomDataIn(e,void 0,"align",a),void 0===t.cfg.align&&1==Object.keys(t.icn3d.structures).length&&$("#"+t.pre+"alternateWrapper").hide();var i={};for(var n in t.icn3d.atoms)i[n]=1;t.icn3d.dAtoms=i,t.icn3d.hAtoms=i,t.icn3d.setAtomStyleByOptions(t.opts),t.icn3d.setColorByOptions(t.opts,t.icn3d.atoms),t.mmdbidArray=[],n=0;for(var r=e.alignedStructures[0].length;n<r;++n)t.mmdbidArray.push(e.alignedStructures[0][n].pdbId);t.renderStructure(),void 0!==t.cfg.rotate&&t.rotStruc(t.cfg.rotate,!0),t.html2ddgm="",void 0!==t.cfg.showalignseq&&t.cfg.showalignseq&&t.openDialog(t.pre+"dl_alignment","Select residues in aligned sequences"),void 0!==t.cfg.show2d&&t.cfg.show2d&&t.bFullUi&&t.set2DDiagramsForAlign(t.mmdbidArray[0].toUpperCase(),t.mmdbidArray[1].toUpperCase()),void 0!==t.deferred&&t.deferred.resolve(),void 0!==t.deferred2&&t.deferred2.resolve()})},iCn3DUI.prototype.set2DDiagramsForAlign=function(e,t){var i=this;i.openDialog(i.pre+"dl_2ddgm","Interactions");var n="https://www.ncbi.nlm.nih.gov/Structure/mmdb/mmdb_strview.cgi?v=2&program=icn3d&uid="+e+"&intrac=1",r="https://www.ncbi.nlm.nih.gov/Structure/mmdb/mmdb_strview.cgi?v=2&program=icn3d&uid="+t+"&intrac=1";void 0!==i.cfg.inpara&&(n+=i.cfg.inpara,r+=i.cfg.inpara),$.ajax({url:n,dataType:"jsonp",cache:!0}).then(function(t){return i.interactionData1=t,i.html2ddgm="",i.draw2Ddgm(t,e,0),void 0!==i.cfg.show2d&&i.cfg.show2d&&i.openDialog(i.pre+"dl_2ddgm","Interactions"),$.ajax({url:r,dataType:"jsonp",cache:!0})}).done(function(e){i.interactionData2=e,i.draw2Ddgm(e,t,1),i.html2ddgm+="<br>"+i.set2DdgmNote(!0),$("#"+i.pre+"dl_2ddgm").html(i.html2ddgm),i.b2DShown=!0,void 0!==i.deferredViewinteraction&&i.deferredViewinteraction.resolve()})},iCn3DUI.prototype.download2Ddgm=function(e,t){this.set2DDiagrams(e)},iCn3DUI.prototype.set2DDiagrams=function(e){var t=this;t.openDialog(t.pre+"dl_2ddgm","Interactions"),void 0!==t.b2DShown&&t.b2DShown||(t.html2ddgm="",t.draw2Ddgm(t.interactionData,e),t.html2ddgm+="<br>"+t.set2DdgmNote(),$("#"+t.pre+"dl_2ddgm").html(t.html2ddgm)),t.b2DShown=!0},iCn3DUI.prototype.setSeqAlign=function(e,t){var i=this,n=t[0][0].pdbId,r=t[0][1].pdbId;i.conservedName1=n+"_cons",i.nonConservedName1=n+"_ncons",i.notAlignedName1=n+"_nalign",i.conservedName2=r+"_cons",i.nonConservedName2=r+"_ncons",i.notAlignedName2=r+"_nalign",i.consHash1={},i.nconsHash1={},i.nalignHash1={},i.consHash2={},i.nconsHash2={},i.nalignHash2={};for(var o=0,s=e.length;o<s;++o){for(var a=e[o][0],c=i.icn3d.pdbid_molid2chain[n+"_"+a.moleculeId],l=n+"_"+c,d={},h=a.sequence.length,u=-1,p=!1,m=0,f=a.sequence.length;m<f;++m)1==(b=a.sequence[m][3]?1:0)&&(m<h&&!p&&(h=m,p=!0),m>u&&(u=m)),d[m]={resi:C=a.sequence[m][0],resn:S="~"===a.sequence[m][2]?"-":a.sequence[m][2],aligned:b};var g=i.icn3d.pdbid_molid2chain[r+"_"+(a=e[o][1]).moleculeId],v=r+"_"+g;void 0===i.icn3d.alnChainsAnTtl[l]&&(i.icn3d.alnChainsAnTtl[l]=[]),void 0===i.icn3d.alnChainsAnTtl[l][0]&&(i.icn3d.alnChainsAnTtl[l][0]=[]),void 0===i.icn3d.alnChainsAnTtl[l][1]&&(i.icn3d.alnChainsAnTtl[l][1]=[]),void 0===i.icn3d.alnChainsAnTtl[l][2]&&(i.icn3d.alnChainsAnTtl[l][2]=[]),void 0===i.icn3d.alnChainsAnTtl[l][3]&&(i.icn3d.alnChainsAnTtl[l][3]=[]),void 0===i.icn3d.alnChainsAnTtl[l][4]&&(i.icn3d.alnChainsAnTtl[l][4]=[]),void 0===i.icn3d.alnChainsAnTtl[l][5]&&(i.icn3d.alnChainsAnTtl[l][5]=[]),void 0===i.icn3d.alnChainsAnTtl[l][6]&&(i.icn3d.alnChainsAnTtl[l][6]=[]),i.icn3d.alnChainsAnTtl[l][0].push(v),i.icn3d.alnChainsAnTtl[l][1].push(l),i.icn3d.alnChainsAnTtl[l][2].push(""),i.icn3d.alnChainsAnTtl[l][3].push(""),i.icn3d.alnChainsAnTtl[l][4].push(v),i.icn3d.alnChainsAnTtl[l][5].push(l),i.icn3d.alnChainsAnTtl[l][6].push("");var y=1;for(m=h;m<=u;++m){var b,_,w,x,C=a.sequence[m][0],S="~"===a.sequence[m][2]?"-":a.sequence[m][2];2===(b=d[m].aligned+(a.sequence[m][3]?1:0))?(d[m].resn===S?(_="#FF0000",x="icn3d-cons",i.consHash1[l+"_"+d[m].resi]=1,i.consHash2[v+"_"+C]=1):(_="#0000FF",x="icn3d-ncons",i.nconsHash1[l+"_"+d[m].resi]=1,i.nconsHash2[v+"_"+C]=1),w="#"+i.getColorhexFromBlosum62(d[m].resn,S)):(_=i.GREY8,x="icn3d-nalign",i.nalignHash1[l+"_"+d[m].resi]=1,i.nalignHash2[v+"_"+C]=1),void 0===i.icn3d.alnChainsSeq[l]&&(i.icn3d.alnChainsSeq[l]=[]);var E={};E.mmdbid=n,E.chain=c,E.resi=d[m].resi,E.resn=""===E.resi||"icn3d-nalign"===x?d[m].resn.toLowerCase():d[m].resn,E.aligned=b,E.color=""===E.resi?i.GREYC:_,E.color2=""===E.resi?i.GREYC:w,E.class=x,i.icn3d.alnChainsSeq[l].push(E),""!==d[m].resi&&(void 0===i.icn3d.alnChains[l]&&(i.icn3d.alnChains[l]={}),$.extend(i.icn3d.alnChains[l],i.icn3d.residues[l+"_"+d[m].resi])),void 0===i.icn3d.alnChainsSeq[v]&&(i.icn3d.alnChainsSeq[v]=[]),(E={}).mmdbid=r,E.chain=g,E.resi=C,E.resn=""===E.resi||"icn3d-nalign"===x?S.toLowerCase():S,E.aligned=b,E.color=""===E.resi?i.GREYC:_,E.color2=""===E.resi?i.GREYC:w,E.class=x,i.icn3d.alnChainsSeq[v].push(E),""!==E.resi&&(void 0===i.icn3d.alnChains[v]&&(i.icn3d.alnChains[v]={}),$.extend(i.icn3d.alnChains[v],i.icn3d.residues[v+"_"+C])),void 0===i.icn3d.alnChainsAnno[l]&&(i.icn3d.alnChainsAnno[l]=[]),void 0===i.icn3d.alnChainsAnno[l][0]&&(i.icn3d.alnChainsAnno[l][0]=[]),void 0===i.icn3d.alnChainsAnno[l][1]&&(i.icn3d.alnChainsAnno[l][1]=[]),void 0===i.icn3d.alnChainsAnno[l][2]&&(i.icn3d.alnChainsAnno[l][2]=[]),void 0===i.icn3d.alnChainsAnno[l][3]&&(i.icn3d.alnChainsAnno[l][3]=[]),m===h&&(void 0===i.icn3d.alnChainsAnno[l][4]&&(i.icn3d.alnChainsAnno[l][4]=[]),void 0===i.icn3d.alnChainsAnno[l][5]&&(i.icn3d.alnChainsAnno[l][5]=[]),void 0===i.icn3d.alnChainsAnno[l][6]&&(i.icn3d.alnChainsAnno[l][6]=[]),i.icn3d.alnChainsAnno[l][4].push(i.icn3d.pdbid_chain2title[v]),i.icn3d.alnChainsAnno[l][5].push(i.icn3d.pdbid_chain2title[l]),i.icn3d.alnChainsAnno[l][6].push(""));var M=i.icn3d.secondaries[l+"_"+d[m].resi],T=i.icn3d.secondaries[v+"_"+C];i.icn3d.alnChainsAnno[l][0].push(void 0!==T?T:"-"),i.icn3d.alnChainsAnno[l][1].push(void 0!==M?M:"-");var A=".";y%5==0&&(A="*"),y%10==0&&(A="|"),i.icn3d.alnChainsAnno[l][2].push(A);var k="";y%10==0&&(k=y.toString()),i.icn3d.alnChainsAnno[l][3].push(k),++y}}e={}},iCn3DUI.prototype.loadMol2Data=function(e){var t=this,i=t.loadMol2AtomData(e);void 0===t.cfg.align&&1==Object.keys(t.icn3d.structures).length&&$("#"+t.pre+"alternateWrapper").hide(),i?(t.icn3d.setAtomStyleByOptions(t.opts),t.icn3d.setColorByOptions(t.opts,t.icn3d.atoms),t.renderStructure(),void 0!==t.cfg.rotate&&t.rotStruc(t.cfg.rotate,!0),void 0!==t.deferred&&t.deferred.resolve(),void 0!==t.deferred2&&t.deferred2.resolve()):alert("The Mol2 file has the wrong format...")},iCn3DUI.prototype.loadMol2AtomData=function(e){var t=this,i=e.split(/\r?\n|\r/);if(i.length<4)return!1;t.icn3d.init();for(var n,r,o={},s=0,a=0,c=1,l=!1,d=!1,h={},u={},p=0,m=i.length;p<m;++p){var f=i[p].trim();if(""!==f&&"#"!==f.substr(0,1)){if("@<TRIPOS>MOLECULE"==f){t.icn3d.molTitle=i[p+1].trim();var g=i[p+2].trim().replace(/\s+/g," ").split(" ");n=g[0],r=g[1],p+=4}else"@<TRIPOS>ATOM"==f?(c=1,l=!0,++p):"@<TRIPOS>BOND"==f?(d=!0,l=!1,++p):"@<TRIPOS>SUBSTRUCTURE"==f&&(d=!1,++p);if(""!==(f=i[p].trim())&&"#"!==f.substr(0,1)){if(l&&s<n){var v=f.replace(/\s+/g," ").split(" "),y=parseInt(v[0]);h[y]=c;var b,_=v[1],w=parseFloat(v[2]),x=parseFloat(v[3]),C=parseFloat(v[4]),S=new THREE.Vector3(w,x,C),E=v[5],M=E.indexOf(".");"H"===(b=-1===M?E:E.substr(0,M))&&b===E?u[y]=1:(t.icn3d.atoms[c]={het:!0,serial:c,name:_,resn:"LIG",structure:1,chain:"A",resi:1,coord:S,b:0,elem:b,bonds:[],ss:"coil",ssbegin:!1,ssend:!1,bondOrder:[]},o[c]=1,++c),++s}if(d&&a<r){var T=f.replace(/\s+/g," ").split(" "),A=parseInt(T[1]),k=parseInt(T[2]),R=T[3],D=R;if("am"===R&&(D="1"),"ar"===R&&(D="1.5"),!(u.hasOwnProperty(A)||u.hasOwnProperty(k)||"1"!==D&&"2"!==D&&"3"!==D&&"1.5"!==D)){var L=D,I=h[A],O=h[k];t.icn3d.atoms[I].bonds.push(O),t.icn3d.atoms[I].bondOrder.push(L),t.icn3d.atoms[O].bonds.push(I),t.icn3d.atoms[O].bondOrder.push(L),"2"==L?(t.icn3d.doublebonds[I+"_"+O]=1,t.icn3d.doublebonds[O+"_"+I]=1):"3"==L?(t.icn3d.triplebonds[I+"_"+O]=1,t.icn3d.triplebonds[O+"_"+I]=1):"1.5"==L&&(t.icn3d.aromaticbonds[I+"_"+O]=1,t.icn3d.aromaticbonds[O+"_"+I]=1)}++a}}}}return t.icn3d.dAtoms=o,t.icn3d.hAtoms=o,t.icn3d.structures[1]=["1_A"],t.icn3d.chains["1_A"]=o,t.icn3d.residues["1_A_1"]=o,t.icn3d.residueId2Name["1_A_1"]="LIG",void 0===t.icn3d.chainsSeq["1_A"]&&(t.icn3d.chainsSeq["1_A"]=[]),t.icn3d.chainsSeq["1_A"].push({resi:1,name:"LIG"}),t.setMaxD(),t.showTitle(),!0},iCn3DUI.prototype.loadXyzData=function(e){var t=this,i=t.loadXyzAtomData(e);void 0===t.cfg.align&&1==Object.keys(t.icn3d.structures).length&&$("#"+t.pre+"alternateWrapper").hide(),i?(t.icn3d.setAtomStyleByOptions(t.opts),t.icn3d.setColorByOptions(t.opts,t.icn3d.atoms),t.renderStructure(),void 0!==t.cfg.rotate&&t.rotStruc(t.cfg.rotate,!0),void 0!==t.deferred&&t.deferred.resolve(),void 0!==t.deferred2&&t.deferred2.resolve()):alert("The XYZ file has the wrong format...")},iCn3DUI.prototype.setXyzAtomSeq=function(e,t,i,n){var r=this;r.icn3d.dAtoms=r.icn3d.unionHash(r.icn3d.dAtoms,e),r.icn3d.hAtoms=r.icn3d.unionHash(r.icn3d.hAtoms,e),r.icn3d.structures[t]=[i],r.icn3d.chains[i]=e,r.icn3d.residues[n]=e,r.icn3d.residueId2Name[n]="LIG",void 0===r.icn3d.chainsSeq[i]&&(r.icn3d.chainsSeq[i]=[]),r.icn3d.chainsSeq[i].push({resi:1,name:"LIG"});for(var o=Object.keys(e),s=0,a=o.length;s<a;++s)for(var c=r.icn3d.atoms[o[s]],l=s+1,d=o.length;l<d;++l){var h=r.icn3d.atoms[o[l]],u=1.2*(r.icn3d.covalentRadii[c.elem]+r.icn3d.covalentRadii[h.elem]);Math.abs(c.coord.x-h.coord.x)>u||Math.abs(c.coord.y-h.coord.y)>u||Math.abs(c.coord.z-h.coord.z)>u||r.icn3d.hasCovalentBond(c,h)&&(r.icn3d.atoms[o[s]].bonds.push(o[l]),r.icn3d.atoms[o[l]].bonds.push(o[s]))}},iCn3DUI.prototype.loadXyzAtomData=function(e){var t=this,i=e.split(/\r?\n|\r/);if(i.length<3)return!1;t.icn3d.init();var n,r,o,s={},a=0,c=1;t.icn3d.molTitle="";for(var l=0,d=i.length;l<d;++l){var h=i[l].trim();if(""!==h&&(""===h||isNaN(h)||(0!==l&&t.setXyzAtomSeq(s,a,n,r),s={},r=(n=(o=++a)+"_A")+"_1",parseInt(h),a>1&&(t.icn3d.molTitle+="; "),t.icn3d.molTitle+=i[l+1].trim(),l+=2),""!==(h=i[l].trim()))){var u=h.replace(/,/," ").replace(/\s+/g," ").split(" "),p=u[0],m=parseFloat(u[1]),f=parseFloat(u[2]),g=parseFloat(u[3]),v=new THREE.Vector3(m,f,g);t.icn3d.atoms[c]={het:!0,serial:c,name:p,resn:"LIG",structure:o,chain:"A",resi:1,coord:v,b:0,elem:p,bonds:[],ss:"coil",ssbegin:!1,ssend:!1,bondOrder:[]},s[c]=1,++c}}return t.setXyzAtomSeq(s,a,n,r),t.setMaxD(),t.showTitle(),!0},iCn3DUI.prototype.Dsn6Parser=function(e,t,i){var n,r=this;if(n="https://edmaps.rcsb.org/maps/"+e.toLowerCase()+"_"+t+".dsn6",bCid=void 0,"2fofc"==t&&r.bAjax2fofc)r.icn3d.mapData.sigma2=i,r.setOption("map",t);else if("fofc"==t&&r.bAjaxfofc)r.icn3d.mapData.sigma=i,r.setOption("map",t);else{var o=new XMLHttpRequest;o.open("GET",n,!0),o.responseType="arraybuffer",o.onreadystatechange=function(){4==this.readyState?(r.hideLoading(),200==this.status?(r.loadDsn6Data(o.response,t,i),"2fofc"==t?r.bAjax2fofc=!0:"fofc"==t&&(r.bAjaxfofc=!0),r.setOption("map",t)):alert("RCSB server has no corresponding eletron density map for this structure."),void 0!==r.deferredMap&&r.deferredMap.resolve()):r.showLoading()},o.send()}},iCn3DUI.prototype.loadDsn6Data=function(e,t,i){var n,r,o=this,s={},a=e.buffer&&e.buffer instanceof ArrayBuffer?e.buffer:e,c=new Int16Array(a),l=new Uint8Array(a),d=String.fromCharCode.apply(null,l.subarray(0,512));if(0==d.indexOf(":-)"))s.xStart=parseInt(d.substr(10,5)),s.yStart=parseInt(d.substr(15,5)),s.zStart=parseInt(d.substr(20,5)),s.xExtent=parseInt(d.substr(32,5)),s.yExtent=parseInt(d.substr(38,5)),s.zExtent=parseInt(d.substr(42,5)),s.xRate=parseInt(d.substr(52,5)),s.yRate=parseInt(d.substr(58,5)),s.zRate=parseInt(d.substr(62,5)),s.xlen=1*parseFloat(d.substr(73,10)),s.ylen=1*parseFloat(d.substr(83,10)),s.zlen=1*parseFloat(d.substr(93,10)),s.alpha=parseFloat(d.substr(103,10)),s.beta=parseFloat(d.substr(113,10)),s.gamma=parseFloat(d.substr(123,10)),n=parseFloat(d.substr(138,12))/100,r=parseInt(d.substr(155,8)),s.sigma=100*parseFloat(d.substr(170,12));else{if(100!==c[18])for(var h=0,u=c.length;h<u;++h){var p=c[h];c[h]=(255&p)<<8|p>>8&255}s.zStart=c[2],s.xStart=c[0],s.yStart=c[1],s.xExtent=c[3],s.yExtent=c[4],s.zExtent=c[5],s.xRate=c[6],s.yRate=c[7],s.zRate=c[8];var m=1/c[17],f=1*m;s.xlen=c[9]*f,s.ylen=c[10]*f,s.zlen=c[11]*f,s.alpha=c[12]*m,s.beta=c[13]*m,s.gamma=c[14]*m,n=c[15]/100,r=c[16]}for(var g=new Float32Array(s.xExtent*s.yExtent*s.zExtent),v=512,y=Math.ceil(s.xExtent/8),b=Math.ceil(s.yExtent/8),_=Math.ceil(s.zExtent/8),w=0;w<_;++w)for(var x=0;x<b;++x)for(var C=0;C<y;++C)for(var S=0;S<8;++S)for(var E=8*w+S,M=0;M<8;++M){var T=8*x+M;for(h=0;h<8;++h){var A=8*C+h;if(!(A<s.xExtent&&T<s.yExtent&&E<s.zExtent)){v+=8-h;break}g[(A*s.yExtent+T)*s.zExtent+E]=(l[v]-r)/n,++v}}"2fofc"==t?(o.icn3d.mapData.header2=s,o.icn3d.mapData.data2=g,o.icn3d.mapData.matrix2=o.getMatrix(s),o.icn3d.mapData.type2=t,o.icn3d.mapData.sigma2=i):(o.icn3d.mapData.header=s,o.icn3d.mapData.data=g,o.icn3d.mapData.matrix=o.getMatrix(s),o.icn3d.mapData.type=t,o.icn3d.mapData.sigma=i)},iCn3DUI.prototype.getMatrix=function(e){var t=e,i=[t.xlen,0,0],n=[t.ylen*Math.cos(Math.PI/180*t.gamma),t.ylen*Math.sin(Math.PI/180*t.gamma),0],r=[t.zlen*Math.cos(Math.PI/180*t.beta),t.zlen*(Math.cos(Math.PI/180*t.alpha)-Math.cos(Math.PI/180*t.gamma)*Math.cos(Math.PI/180*t.beta))/Math.sin(Math.PI/180*t.gamma),0];r[2]=Math.sqrt(t.zlen*t.zlen*Math.sin(Math.PI/180*t.beta)*Math.sin(Math.PI/180*t.beta)-r[1]*r[1]);var o=[[],i,n,r],s=[0,t.xRate,t.yRate,t.zRate],a=[0,1,2,3],c=new THREE.Matrix4;return c.set(o[a[1]][0]/s[a[1]],o[a[2]][0]/s[a[2]],o[a[3]][0]/s[a[3]],0,o[a[1]][1]/s[a[1]],o[a[2]][1]/s[a[2]],o[a[3]][1]/s[a[3]],0,o[a[1]][2]/s[a[1]],o[a[2]][2]/s[a[2]],o[a[3]][2]/s[a[3]],0,0,0,0,1),c.multiply((new THREE.Matrix4).makeTranslation(t.xStart,t.yStart,t.zStart)),c},iCn3DUI.prototype.DensityCifParser=function(e,t,i,n){var r,o=this,s=o.isMobile()?0:4;if("2fofc"==t||"fofc"==t?r="https://www.ebi.ac.uk/pdbe/densities/x-ray/"+e.toLowerCase()+"/cell?detail="+s:"em"==t&&(r="https://www.ebi.ac.uk/pdbe/densities/emd/"+n.toLowerCase()+"/cell?detail="+s),bCid=void 0,"2fofc"==t&&o.bAjax2fofc)o.icn3d.mapData.sigma2=i,o.setOption("map",t);else if("fofc"==t&&o.bAjaxfofc)o.icn3d.mapData.sigma=i,o.setOption("map",t);else if("em"==t&&o.bAjaxEm)o.icn3d.mapData.sigmaEm=i,o.setOption("emmap",t);else{var a=new XMLHttpRequest;a.open("GET",r,!0),a.responseType="arraybuffer",a.onreadystatechange=function(){4==this.readyState?(o.hideLoading(),200==this.status?(o.parseChannels(a.response,t,i),"2fofc"==t||"fofc"==t?(o.bAjax2fofc=!0,o.bAjaxfofc=!0,o.setOption("map",t)):"em"==t&&(o.bAjaxEm=!0,o.setOption("emmap",t))):"2fofc"==t||"fofc"==t?alert("Density server at EBI has no corresponding electron density map for this structure."):"em"==t&&alert("Density server at EBI has no corresponding EM density map for this structure."),void 0!==o.deferredEmmap&&o.deferredEmmap.resolve()):o.showLoading()},a.send()}},iCn3DUI.prototype.parseChannels=function(e,t,i){var n=this,r=n.BinaryParse(e);if("2fofc"==t||"fofc"==t){var o=n.getChannel(r,"2FO-FC"),s=n.getChannel(r,"FO-FC");n.icn3d.mapData.header2={xExtent:(p=(m=o).box.sampleCount)[0],yExtent:p[1],zExtent:p[2],mean:m.valuesInfo.mean,sigma:m.valuesInfo.sigma},n.icn3d.mapData.data2=m.data;var a=m.box.origin,c=m.box.dimensions,l=m.spacegroup.basis,d=(new THREE.Matrix4).makeScale(c[0]/p[0],c[1]/p[1],c[2]/p[2]),h=(new THREE.Matrix4).makeTranslation(a[0],a[1],a[2]),u=(new THREE.Matrix4).set(l.x[0],l.y[0],l.z[0],0,0,l.y[1],l.z[1],0,0,0,l.z[2],0,0,0,0,1).multiply(h).multiply(d);n.icn3d.mapData.matrix2=u,n.icn3d.mapData.type2=t,n.icn3d.mapData.sigma2=i,n.icn3d.mapData.header={xExtent:(p=(m=s).box.sampleCount)[0],yExtent:p[1],zExtent:p[2],mean:m.valuesInfo.mean,sigma:m.valuesInfo.sigma},n.icn3d.mapData.data=m.data,a=m.box.origin,c=m.box.dimensions,l=m.spacegroup.basis,d=(new THREE.Matrix4).makeScale(c[0]/p[0],c[1]/p[1],c[2]/p[2]),h=(new THREE.Matrix4).makeTranslation(a[0],a[1],a[2]),u=(new THREE.Matrix4).set(l.x[0],l.y[0],l.z[0],0,0,l.y[1],l.z[1],0,0,0,l.z[2],0,0,0,0,1).multiply(h).multiply(d),n.icn3d.mapData.matrix=u,n.icn3d.mapData.type=t,n.icn3d.mapData.sigma=i}else if("em"==t){var p,m=n.getChannel(r,"EM");n.icn3d.mapData.headerEm={xExtent:(p=m.box.sampleCount)[0],yExtent:p[1],zExtent:p[2],max:m.valuesInfo.max,min:m.valuesInfo.min},n.icn3d.mapData.dataEm=m.data,a=m.box.origin,c=m.box.dimensions,l=m.spacegroup.basis,d=(new THREE.Matrix4).makeScale(c[0]/p[0],c[1]/p[1],c[2]/p[2]),h=(new THREE.Matrix4).makeTranslation(a[0],a[1],a[2]),u=(new THREE.Matrix4).set(l.x[0],l.y[0],l.z[0],0,0,l.y[1],l.z[1],0,0,0,l.z[2],0,0,0,0,1).multiply(h).multiply(d),n.icn3d.mapData.matrixEm=u,n.icn3d.mapData.typeEm=t,n.icn3d.mapData.sigmaEm=i}},iCn3DUI.prototype.getChannel=function(e,t){for(var i,n=e.toJSON(),r=0,o=n.length;r<o;++r)n[r].id==t&&(i=e.dataBlocks[r]);return this.CIFParse(i)},iCn3DUI.prototype.CIFParse=function(e){var t=e.getCategory("_volume_data_3d_info");if(t){if(e.getCategory("_volume_data_3d")){var i={name:t.getColumn("name").getString(0),axisOrder:y("axis_order"),origin:y("origin"),dimensions:y("dimensions"),sampleCount:y("sample_count"),spacegroupNumber:0|b("spacegroup_number"),cellSize:y("spacegroup_cell_size"),cellAngles:y("spacegroup_cell_angles"),mean:b("mean_sampled"),sigma:b("sigma_sampled")},n=[0,0,0];n[i.axisOrder[0]]=0,n[i.axisOrder[1]]=1,n[i.axisOrder[2]]=2;var r,o,s,a,c,l,d,h,u,p,m,f,g=_(i.sampleCount),v=function(e,t,i,n){for(var r=new Float32Array(t[0]*t[1]*t[2]),o=[0,0,0],s=n[0],a=n[1],c=n[2],l=i[0],d=i[1],h=i[2],u=t[2],p=t[1]*t[2],m=0,f=e.getFloat(0),g=f,v=0;v<h;v++){o[2]=v;for(var y=0;y<d;y++){o[1]=y;for(var b=0;b<l;b++){o[0]=b;var _=e.getFloat(m);m+=1,r[o[c]+o[a]*u+o[s]*p]=_,_<f?f=_:_>g&&(g=_)}}}return{data:r,min:f,max:g}}(e.getCategory("_volume_data_3d").getColumn("values"),g,i.sampleCount,n);return{name:i.name,spacegroup:(r=i.spacegroupNumber,o=i.cellSize,s=i.cellAngles,a=Math.PI/180*s[0],c=Math.PI/180*s[1],l=Math.PI/180*s[2],d=o[0],h=o[1],u=o[2],p=Math.cos(c),m=(Math.cos(a)-Math.cos(c)*Math.cos(l))/Math.sin(l),f=Math.sqrt(1-p*p-m*m),{number:r,size:o,angles:s,basis:{x:[d,0,0],y:[Math.cos(l)*h,Math.sin(l)*h,0],z:[p*u,m*u,f*u]}}),box:{origin:_(i.origin),dimensions:_(i.dimensions),sampleCount:g},data:v.data,valuesInfo:{min:v.min,max:v.max,mean:i.mean,sigma:i.sigma}}}conole.log("_volume_data_3d category is missing.")}else conole.log("_volume_data_3d_info category is missing.");function y(e){for(var i=[0,0,0],n=0;n<3;n++)i[n]=t.getColumn(e+"["+n+"]").getFloat(0);return i}function b(e){return t.getColumn(e).getFloat(0)}function _(e){return[e[n[0]],e[n[1]],e[n[2]]]}},iCn3DUI.prototype.BinaryParse=function(e){var t=new Uint8Array(e),i=this.MessagePackParse({buffer:t,offset:0,dataView:new DataView(t.buffer)}),n=function(){function e(e){this.additionalData={},this.header=e.header,this.categoryList=e.categories.map(function(e){return new r(e)}),this.categoryMap=new Map;for(var t=0,i=this.categoryList;t<i.length;t++){var n=i[t];this.categoryMap.set(n.name,n)}}return Object.defineProperty(e.prototype,"categories",{get:function(){return this.categoryList},enumerable:!0,configurable:!0}),e.prototype.getCategory=function(e){return this.categoryMap.get(e)},e.prototype.toJSON=function(){return{id:this.header,categories:this.categoryList.map(function(e){return e.toJSON()}),additionalData:this.additionalData}},e}(),r=function(){function e(e){this.name=e.name,this.columnCount=e.columns.length,this.rowCount=e.rowCount,this.columnNameList=[],this.encodedColumns=new Map;for(var t=0,i=e.columns;t<i.length;t++){var n=i[t];this.encodedColumns.set(n.name,n),this.columnNameList.push(n.name)}}Object.defineProperty(e.prototype,"columnNames",{get:function(){return this.columnNameList},enumerable:!0,configurable:!0});var t=function(){function e(){this.isDefined=!1}return e.prototype.getString=function(e){return null},e.prototype.getInteger=function(e){return 0},e.prototype.getFloat=function(e){return 0},e.prototype.getValuePresence=function(e){return 1},e.prototype.areValuesEqual=function(e,t){return!0},e.prototype.stringEquals=function(e,t){return null===t},e}();return e.prototype.getColumn=function(e){var i=this.encodedColumns.get(e);return i?m(i):t},e.prototype.toJSON=function(){for(var e=this,t=[],i=this.columnNameList.map(function(t){return{name:t,column:e.getColumn(t)}}),n=0;n<this.rowCount;n++){for(var r={},o=0,s=i;o<s.length;o++){var a=s[o],c=a.column.getValuePresence(n);r[a.name]=0===c?a.column.getString(n):1===c?".":"?"}t[n]=r}return{name:this.name,columns:this.columnNames,rows:t}},e}();function o(e,t){switch(e){case 1:return new Int8Array(t);case 2:return new Int16Array(t);case 3:return new Int32Array(t);case 4:return new Uint8Array(t);case 5:return new Uint16Array(t);case 6:return new Uint32Array(t);default:throw new Error("Unsupported integer data type.")}}function s(e,t){switch(e){case 32:return new Float32Array(t);case 33:return new Float64Array(t);default:throw new Error("Unsupported floating data type.")}}var a,c,l,d=(a=new ArrayBuffer(2),c=new Uint8Array(a),l=new Uint16Array(a),c[0]=170,c[1]=187,48042===l[0]);function h(e,t,i){return new i(d?e.buffer:function(e,t){for(var i=new ArrayBuffer(e.length),n=new Uint8Array(i),r=0,o=e.length;r<o;r+=t)for(var s=0;s<t;s++)n[r+t-s-1]=e[r+s];return i}(e,t))}function u(e,t){switch(t.kind){case"ByteArray":switch(t.type){case 4:return e;case 1:return function(e){return new Int8Array(e.buffer,e.byteOffset)}(e);case 2:return function(e){return h(e,2,Int16Array)}(e);case 5:return function(e){return h(e,2,Uint16Array)}(e);case 3:return function(e){return h(e,4,Int32Array)}(e);case 6:return function(e){return h(e,4,Uint32Array)}(e);case 32:return function(e){return h(e,4,Float32Array)}(e);case 33:return function(e){return h(e,8,Float64Array)}(e);default:throw new Error("Unsupported ByteArray type.")}case"FixedPoint":return function(e,t){for(var i=e.length,n=s(t.srcType,i),r=1/t.factor,o=0;o<i;o++)n[o]=r*e[o];return n}(e,t);case"IntervalQuantization":return function(e,t){for(var i=e.length,n=s(t.srcType,i),r=(t.max-t.min)/(t.numSteps-1),o=t.min,a=0;a<i;a++)n[a]=o+r*e[a];return n}(e,t);case"RunLength":return function(e,t){for(var i=o(t.srcType,t.srcSize),n=0,r=0,s=e.length;r<s;r+=2)for(var a=e[r],c=e[r+1],l=0;l<c;++l)i[n++]=a;return i}(e,t);case"Delta":return function(e,t){var i=e.length,n=o(t.srcType,i);if(!i)return n;n[0]=e[0]+(0|t.origin);for(var r=1;r<i;++r)n[r]=e[r]+n[r-1];return n}(e,t);case"IntegerPacking":return function(e,t){return t.isUnsigned?function(e,t){for(var i=1===t.byteCount?255:65535,n=e.length,r=new Int32Array(t.srcSize),o=0,s=0;o<n;){for(var a=0,c=e[o];c===i;)a+=c,c=e[++o];r[s]=a+=c,o++,s++}return r}(e,t):function(e,t){for(var i=1===t.byteCount?127:32767,n=-i-1,r=e.length,o=new Int32Array(t.srcSize),s=0,a=0;s<r;){for(var c=0,l=e[s];l===i||l===n;)c+=l,l=e[++s];o[a]=c+=l,s++,a++}return o}(e,t)}(e,t);case"StringArray":return function(e,t){for(var i=t.stringData,n=p({encoding:t.offsetEncoding,data:t.offsets}),r=p({encoding:t.dataEncoding,data:e}),o=Object.create(null),s=new Array(r.length),a=0,c=0,l=r;c<l.length;c++){var d=l[c];if(d<0)s[a++]=null;else{var h=o[d];void 0===h&&(h=i.substring(n[d],n[d+1]),o[d]=h),s[a++]=h}}return s}(e,t)}}function p(e){for(var t=e.data,i=e.encoding.length-1;i>=0;i--)t=u(t,e.encoding[i]);return t}function m(e){if(!e.data.data)return _UndefinedColumn;var t=p(e.data),i=void 0;return e.mask&&(i=p(e.mask)),t.buffer&&t.byteLength&&t.BYTES_PER_ELEMENT?i?new y(t,i):new v(t):i?new _(t,i):new b(t)}function f(e,t,i){var n=0,r=1;for(45===e.charCodeAt(t)&&(r=-1,t++);t<i;t++){var o=e.charCodeAt(t)-48;if(o>9||o<0)return r*n|0;n=10*n+o|0}return r*n}function g(e,t,i){var n=1,r=0,o=0,s=1;for(45===e.charCodeAt(t)&&(n=-1,++t);t<i;){var a=e.charCodeAt(t)-48;if(!(a>=0&&a<10)){if(-2===a){for(++t;t<i;){if(!((a=e.charCodeAt(t)-48)>=0&&a<10))return 53===a||21===a?parseScientific(n*(r+o/s),e,t+1,i):n*(r+o/s);o=10*o+a,s*=10,++t}return n*(r+o/s)}if(53===a||21===a)return parseScientific(n*r,e,t+1,i);break}r=10*r+a,++t}return n*r}var v=function(){function e(e){this.data=e,this.isDefined=!0}return e.prototype.getString=function(e){return""+this.data[e]},e.prototype.getInteger=function(e){return 0|this.data[e]},e.prototype.getFloat=function(e){return 1*this.data[e]},e.prototype.stringEquals=function(e,t){return this.data[e]===g(t,0,t.length)},e.prototype.areValuesEqual=function(e,t){return this.data[e]===this.data[t]},e.prototype.getValuePresence=function(e){return 0},e}(),y=function(){function e(e,t){this.data=e,this.mask=t,this.isDefined=!0}return e.prototype.getString=function(e){return 0===this.mask[e]?""+this.data[e]:null},e.prototype.getInteger=function(e){return 0===this.mask[e]?this.data[e]:0},e.prototype.getFloat=function(e){return 0===this.mask[e]?this.data[e]:0},e.prototype.stringEquals=function(e,t){return 0===this.mask[e]?this.data[e]===g(t,0,t.length):null==t},e.prototype.areValuesEqual=function(e,t){return this.data[e]===this.data[t]},e.prototype.getValuePresence=function(e){return this.mask[e]},e}(),b=function(){function e(e){this.data=e,this.isDefined=!0}return e.prototype.getString=function(e){return this.data[e]},e.prototype.getInteger=function(e){var t=this.data[e];return f(t,0,t.length)},e.prototype.getFloat=function(e){var t=this.data[e];return g(t,0,t.length)},e.prototype.stringEquals=function(e,t){return this.data[e]===t},e.prototype.areValuesEqual=function(e,t){return this.data[e]===this.data[t]},e.prototype.getValuePresence=function(e){return 0},e}(),_=function(){function e(e,t){this.data=e,this.mask=t,this.isDefined=!0}return e.prototype.getString=function(e){return 0===this.mask[e]?this.data[e]:null},e.prototype.getInteger=function(e){if(0!==this.mask[e])return 0;var t=this.data[e];return f(t||"",0,(t||"").length)},e.prototype.getFloat=function(e){if(0!==this.mask[e])return 0;var t=this.data[e];return g(t||"",0,(t||"").length)},e.prototype.stringEquals=function(e,t){return this.data[e]===t},e.prototype.areValuesEqual=function(e,t){return this.data[e]===this.data[t]},e.prototype.getValuePresence=function(e){return this.mask[e]},e}();return new(function(){function e(e){this.dataBlocks=e.dataBlocks.map(function(e){return new n(e)})}return e.prototype.toJSON=function(){return this.dataBlocks.map(function(e){return e.toJSON()})},e}())(i)},iCn3DUI.prototype.MessagePackParse=function(e){var t=this;function i(e,i){for(var n={},r=0;r<i;r++)n[t.MessagePackParse(e)]=t.MessagePackParse(e);return n}function n(e,t){for(var i=new Uint8Array(t),n=e.offset,r=0;r<t;r++)i[r]=e.buffer[r+n];return e.offset+=t,i}function r(e,i){for(var n=new Array(i),r=0;r<i;r++)n[r]=t.MessagePackParse(e);return n}function o(e,t){var i=function(e,t,i){for(var n=c,r=void 0,o=[],s=0,a=t,l=t+i;a<l;a++){var d=e[a];0==(128&d)?o[s++]=n[d]:192==(224&d)?o[s++]=n[(15&d)<<6|63&e[++a]]:224==(240&d)?o[s++]=String.fromCharCode((15&d)<<12|(63&e[++a])<<6|(63&e[++a])<<0):240==(248&d)?o[s++]=String.fromCharCode((7&d)<<18|(63&e[++a])<<12|(63&e[++a])<<6|(63&e[++a])<<0):throwError("Invalid byte "+d.toString(16)),512===s&&((r=r||[])[r.length]=o.join(""),s=0)}return r?(s>0&&(r[r.length]=o.slice(0,s).join("")),r.join("")):o.slice(0,s).join("")}(e.buffer,e.offset,t);return e.offset+=t,i}var s,a,c=function(){for(var e=[],t=0;t<1024;t++)e[t]=String.fromCharCode(t);return e}(),l=e.buffer[e.offset];if(0==(128&l))return e.offset++,l;if(128==(240&l))return a=15&l,e.offset++,i(e,a);if(144==(240&l))return a=15&l,e.offset++,r(e,a);if(160==(224&l))return a=31&l,e.offset++,o(e,a);if(224==(224&l))return s=e.dataView.getInt8(e.offset),e.offset++,s;switch(l){case 192:return e.offset++,null;case 194:return e.offset++,!1;case 195:return e.offset++,!0;case 196:return a=e.dataView.getUint8(e.offset+1),e.offset+=2,n(e,a);case 197:return a=e.dataView.getUint16(e.offset+1),e.offset+=3,n(e,a);case 198:return a=e.dataView.getUint32(e.offset+1),e.offset+=5,n(e,a);case 202:return s=e.dataView.getFloat32(e.offset+1),e.offset+=5,s;case 203:return s=e.dataView.getFloat64(e.offset+1),e.offset+=9,s;case 204:return s=e.buffer[e.offset+1],e.offset+=2,s;case 205:return s=e.dataView.getUint16(e.offset+1),e.offset+=3,s;case 206:return s=e.dataView.getUint32(e.offset+1),e.offset+=5,s;case 208:return s=e.dataView.getInt8(e.offset+1),e.offset+=2,s;case 209:return s=e.dataView.getInt16(e.offset+1),e.offset+=3,s;case 210:return s=e.dataView.getInt32(e.offset+1),e.offset+=5,s;case 217:return a=e.dataView.getUint8(e.offset+1),e.offset+=2,o(e,a);case 218:return a=e.dataView.getUint16(e.offset+1),e.offset+=3,o(e,a);case 219:return a=e.dataView.getUint32(e.offset+1),e.offset+=5,o(e,a);case 220:return a=e.dataView.getUint16(e.offset+1),e.offset+=3,r(e,a);case 221:return a=e.dataView.getUint32(e.offset+1),e.offset+=5,r(e,a);case 222:return a=e.dataView.getUint16(e.offset+1),e.offset+=3,i(e,a);case 223:return a=e.dataView.getUint32(e.offset+1),e.offset+=5,i(e,a)}},iCn3DUI.prototype.showAnnotations=function(){var e=this;if(e.openDialog(e.pre+"dl_selectannotations","Sequences and Annotations"),(void 0===e.bAssemblyNote||!e.bAssemblyNote)&&void 0!==e.icn3d.asuCnt){var t="     <br><div id='"+e.pre+"assembly_note' style='margin-left:5px;'><span class='icn3d-annoLargeTitle'>Assembly Tips:</span> Only the asymmetric unit is shown in the sequence window.<br>Click \"Assembly\" in the menu \"View\" to switch between asymmetric unit and biological assembly (<b>"+e.icn3d.asuCnt+"</b> asymmetric unit).</div>";$("#"+e.pre+"dl_annotations_tabs").append(t),e.bAssemblyNote=!0}if(void 0===e.bAnnoShown||!e.bAnnoShown){var i=Object.keys(e.icn3d.chains);void 0===e.giSeq&&(e.giSeq={}),void 0===e.currClin&&(e.currClin={}),void 0===e.resi2disease_nonempty&&(e.resi2disease_nonempty={}),void 0===e.baseResi&&(e.baseResi={}),void 0===e.matchedPos&&(e.matchedPos={});var n=$("#"+e.pre+"dl_selectannotations").dialog("option","width");for(var r in e.seqAnnWidth=n-120-60-50,e.maxAnnoLength=1,e.icn3d.chainsSeq)e.icn3d.chainsSeq[r].length>e.maxAnnoLength&&(e.maxAnnoLength=e.icn3d.chainsSeq[r].length);var o={},s={},a={};e.protein_chainid={};for(var c=0,l=i.length;c<l;++c){Math.round(i[c].indexOf("_"));var d,h=e.icn3d.getFirstCalphaAtomObj(e.icn3d.chains[i[c]]),u=i[c].substr(i[c].indexOf("_")+1);if(-1!==u.indexOf("_")?(u=u.substr(0,u.indexOf("_")),d=i[c].substr(0,i[c].indexOf("_"))+"_"+u):d=i[c],e.icn3d.proteins.hasOwnProperty(h.serial))e.protein_chainid[i[c]]=d;else if(e.icn3d.nucleotides.hasOwnProperty(h.serial))o[i[c]]=d;else if(e.icn3d.chainsSeq[i[c]].length>1)s[i[c]]=d;else{var p=i[c]+"_"+e.icn3d.chainsSeq[i[c]][0].resi;void 0===a[v=e.icn3d.chainsSeq[i[c]][0].name]&&(a[v]=[]),a[v].push(p)}if((void 0!==e.cfg.pdbid||void 0!==e.cfg.mmcifid||void 0!==e.cfg.mmtfid)&&(e.icn3d.proteins.hasOwnProperty(h.serial)||e.icn3d.nucleotides.hasOwnProperty(h.serial)))for(var m=0,f=e.icn3d.chainsSeq[i[c]].length;m<f;++m){var g=e.icn3d.chainsSeq[i[c]][m];if(""!==g.name&&"-"!==g.name&&g.name==g.name.toUpperCase()){if(h=e.icn3d.getFirstCalphaAtomObj(e.icn3d.residues[p=i[c]+"_"+g.resi]),e.icn3d.proteins.hasOwnProperty(h.serial)||e.icn3d.nucleotides.hasOwnProperty(h.serial))continue;var v=g.name.trim();void 0===a[v]&&(a[v]=[]),a[v].push(p)}}}if(void 0===e.cfg.blast_rep_id){if(e.bFullUi)if(void 0!==e.cfg.mmtfid){var y=i[0].substr(0,i[0].indexOf("_"));$.when(e.downloadMmcifSymmetry(y,"mmtfid")).then(function(){e.showAnnoSeqData(o,s,a)})}else e.showAnnoSeqData(o,s,a)}else if(void 0!==e.cfg.blast_rep_id){var b={targets:e.cfg.blast_rep_id,queries:e.cfg.query_id};if(void 0!==e.cfg.query_from_to){var _=e.cfg.query_from_to.split(":");for(c=0,l=_.length;c<l;++c)_[c]=parseInt(_[c])-1;b.queries=e.cfg.query_id+":"+_.join(":")}if(void 0!==e.cfg.target_from_to){var w=e.cfg.target_from_to.split(":");for(c=0,l=w.length;c<l;++c)w[c]=parseInt(w[c])-1;b.targets=e.cfg.blast_rep_id+":"+w.join(":")}$.ajax({url:"https://www.ncbi.nlm.nih.gov/Structure/pwaln/pwaln.fcgi?from=querytarget",type:"POST",data:b,dataType:"jsonp",tryCount:0,retryLimit:1,success:function(t){e.seqStructAlignData=t,e.showAnnoSeqData(o,s,a)},error:function(e,t,i){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})}}e.bAnnoShown=!0},iCn3DUI.prototype.showAnnoSeqData=function(e,t,i){var n=this;n.getAnnotationData();var r=0;for(var o in e)n.getSequenceData(o,e[o],"nucleotide",r),++r;for(var o in n.interactChainChainbase=n.icn3d.unionHash(n.protein_chainid,e),r=0,t)n.getSequenceData(o,t[o],"chemical",r),++r;for(var s in n.interactChainChainbase=n.icn3d.unionHash(n.interactChainChainbase,t),n.ssbondChainChainbase=n.icn3d.unionHash(n.protein_chainid,t),i)n.getCombinedSequenceData(s,i[s],r),++r;n.enableHlSeq(),setTimeout(function(){n.hideAllAnno(),n.clickCdd()},0)},iCn3DUI.prototype.enableHlSeq=function(){var e=this;e.isMobile()?(e.selectSequenceMobile(),e.selectChainMobile()):e.selectSequenceNonMobile(),Object.keys(e.icn3d.hAtoms).length<Object.keys(e.icn3d.dAtoms).length&&e.updateHlSeq()},iCn3DUI.prototype.updateSnpClinvar=function(){var e=this;if(void 0===e.bSnpClinvarShown||!e.bSnpClinvarShown)for(var t in e.protein_chainid)e.showSnpClinvar(t,e.protein_chainid[t]);e.bSnpClinvarShown=!0},iCn3DUI.prototype.updateDomain=function(){void 0!==this.bDomainShown&&this.bDomainShown||this.showDomainAll(),this.bDomainShown=!0},iCn3DUI.prototype.updateInteraction=function(){var e=this;if(void 0===e.bInteractionShown||!e.bInteractionShown)for(var t in e.interactChainChainbase)e.showInteraction(t,e.interactChainChainbase[t]);e.bInteractionShown=!0},iCn3DUI.prototype.updateSsbond=function(){var e=this;if(void 0===e.bSSbondShown||!e.bSSbondShown)for(var t in e.ssbondChainChainbase)e.showSsbond(t,e.interactChainChainbase[t]);e.bSSbondShown=!0},iCn3DUI.prototype.getAnDiv=function(e,t){var i="Loading "+t+"...";return"custom"==t?i="":"domain"==t&&(i="Loading 3D "+t+"..."),"<div id='"+this.pre+t+"_"+e+"'><div id='"+this.pre+"tt_"+t+"_"+e+"' class='icn3d-fixed-pos' style='display:none!important'></div><div id='"+this.pre+"dt_"+t+"_"+e+"' style='display:none'>"+i+"</div><div id='"+this.pre+"ov_"+t+"_"+e+"'>"+i+"</div></div>"},iCn3DUI.prototype.addButton=function(e,t,i,n,r,o){return"<div class='"+t+"' chainid='"+e+"' style='display:inline-block; font-size:11px; font-weight:bold; width:"+r+"px!important;'><button style='-webkit-appearance:"+o+"; height:18px; width:"+r+"px;'><span style='white-space:nowrap; margin-left:-3px;' title='"+n+"'>"+i+"</span></button></div>"},iCn3DUI.prototype.conservativeReplacement=function(e,t){var i=this,n=-1!==i.b62ResArray.indexOf(e)?i.b62ResArray.indexOf(e):i.b62ResArray.length-1,r=-1!==i.b62ResArray.indexOf(t)?i.b62ResArray.indexOf(t):i.b62ResArray.length-1;return i.b62Matrix[n][r]>0},iCn3DUI.prototype.getColorhexFromBlosum62=function(e,t){var i,n,r=this,o=-1!==r.b62ResArray.indexOf(e)?r.b62ResArray.indexOf(e):r.b62ResArray.length-1,s=-1!==r.b62ResArray.indexOf(t)?r.b62ResArray.indexOf(t):r.b62ResArray.length-1,a=r.b62Matrix[o][s];return void 0===a?"333333":a>0?"DD"+(n=(i=221-parseInt(a/11*221))<10?"0"+i.toString(16):i.toString(16))+n:(n=(i=221-parseInt(-1*a/4*221))<10?"0"+i.toString(16):i.toString(16))+n+"DD"},iCn3DUI.prototype.getAnnotationData=function(){var e=this,t=$.map(e.protein_chainid,function(e){return e}),i=0;for(var n in e.protein_chainid){var r=e.isMobile()?"none":"button",o=e.getProteinName(n),s="<div id='"+e.pre+"anno_"+n+"' class='icn3d-annotation'>"+(0==i?"<span class='icn3d-annoLargeTitle'><b>Proteins</b>: </span><br><br>":"")+"<span style='font-weight:bold;'>Annotations of "+n+"</span>: <a class='icn3d-blue' href='https://www.ncbi.nlm.nih.gov/protein?term="+n+"' target='_blank' title='"+o+"'>"+o+"</a>"+(e.icn3d.chainsGene[n]&&e.icn3d.chainsGene[n].geneId?" (Gene: <a href='https://www.ncbi.nlm.nih.gov/gene/"+e.icn3d.chainsGene[n].geneId+"' target='_blank' title='"+e.icn3d.chainsGene[n].geneDesc+"'>"+e.icn3d.chainsGene[n].geneSymbol+"</a>)":"")+"&nbsp;&nbsp;&nbsp;"+e.addButton(n,"icn3d-addtrack","Add Track","Add a custom track",60,r)+"&nbsp;&nbsp;&nbsp;"+e.addButton(n,"icn3d-helixsets","Helix Sets",'Define sets for each helix in this chain and add them to the menu of "Defined Sets"',60,r)+"&nbsp;"+e.addButton(n,"icn3d-sheetsets","Sheet Sets",'Define sets for each sheet in this chain and add them to the menu of "Defined Sets"',60,r)+"&nbsp;"+e.addButton(n,"icn3d-coilsets","Coil Sets",'Define sets for each coil in this chain and add them to the menu of "Defined Sets"',60,r);$("#"+e.pre+"dl_annotations").append(s),$("#"+e.pre+"anno_"+n).append(e.getAnDiv(n,"giseq")),$("#"+e.pre+"anno_"+n).append(e.getAnDiv(n,"cdd")),$("#"+e.pre+"anno_"+n).append(e.getAnDiv(n,"clinvar")),$("#"+e.pre+"anno_"+n).append(e.getAnDiv(n,"snp")),$("#"+e.pre+"anno_"+n).append(e.getAnDiv(n,"domain")),$("#"+e.pre+"anno_"+n).append(e.getAnDiv(n,"site")),$("#"+e.pre+"anno_"+n).append(e.getAnDiv(n,"interaction")),$("#"+e.pre+"anno_"+n).append(e.getAnDiv(n,"custom")),$("#"+e.pre+"anno_"+n).append(e.getAnDiv(n,"ssbond")),$("#"+e.pre+"anno_"+n).append("<br><hr><br>"),++i}e.setToolTip(),e.chain2gi={},$.ajax({url:"https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?db=protein&retmode=json&id="+t,dataType:"json",cache:!0,tryCount:0,retryLimit:1,success:function(t){for(var i in t.result)"uids"!==i&&(e.chain2gi[t.result[i].caption]=i)},error:function(e,t,i){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}}),$.ajax({url:"https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=protein&retmode=json&rettype=fasta&id="+t,dataType:"text",cache:!0,tryCount:0,retryLimit:1,success:function(t){for(var i=t.split("\n\n"),n={},r=0,o=i.length;r<o;++r){var s=i[r].split("\n");if(s.length>0){var a=(f=s[0]).split(" ")[0].split("|"),c=a[1]+"_"+a[2];s.shift();var l=s.join("");n[c]=l}}for(var d in e.protein_chainid){var h=e.protein_chainid[d];if(n.hasOwnProperty(d)){e.giSeq[d]=l=n[d];var u="";for(r=0;r<10&&r<e.icn3d.chainsSeq[d].length;++r)u+=e.icn3d.chainsSeq[d][r].name.substr(0,1);var p=l.toLowerCase().indexOf(u.toLowerCase());-1==p?(console.log("The gi sequence didn't match the protein sequence. The start of 3D protein sequence: "+u+". The gi sequence: "+l.substr(0,10)+"."),e.setAlternativeSeq(d,h)):(e.matchedPos[d]=p,e.baseResi[d]=e.icn3d.chainsSeq[d][0].resi-e.matchedPos[d]-1)}else console.log("No data were found for the protein "+d+"..."),e.setAlternativeSeq(d,h);if(e.cfg.blast_rep_id!=d)e.showSeq(d,h);else if(e.cfg.blast_rep_id==d&&void 0===e.seqStructAlignData.data){f=e.cfg.query_id.length>14?"Query: "+e.cfg.query_id.substr(0,6):isNaN(e.cfg.query_id)?"Query: "+e.cfg.query_id:"Query: gi "+e.cfg.query_id,R=void 0,y=void 0;var m="cannot be aligned";e.queryStart="",e.queryEnd="",alert("The sequence can NOT be aligned to the structure"),e.showSeq(d,h,void 0,f,R,m,y)}else if(e.cfg.blast_rep_id==d&&void 0!==e.seqStructAlignData.data){var f,g,v;f=e.cfg.query_id.length>14?"Query: "+e.cfg.query_id.substr(0,6):isNaN(e.cfg.query_id)?"Query: "+e.cfg.query_id:"Query: gi "+e.cfg.query_id,void 0!==(t=e.seqStructAlignData).data&&(g=t.data[0].query,v=(v=t.data[0].targets[d.replace(/_/g,"")]).hsps.length>0?v.hsps[0]:void 0),m="";var y="";if(e.queryStart="",e.queryEnd="",void 0!==g&&void 0!==v){var b=v.scores.e_value.toPrecision(2);b>1e-200&&(b=parseFloat(b).toExponential());var _=t.targets[d.replace(/_/g,"")].seqdata,w=g.seqdata,x=v.segs,C={};e.targetGapHash={},e.fullpos2ConsTargetpos={},e.consrvResPosArray=[];var S=0,E=0;for(e.nTotalGap=0,e.queryStart=x[0].from+1,e.queryEnd=x[x.length-1].to+1,r=0,o=x.length;r<o;++r){var M=x[r];if(r>0)if(M.orifrom-S<M.from-E)e.targetGapHash[M.orifrom]={from:E+1,to:M.from-1},e.nTotalGap+=e.targetGapHash[M.orifrom].to-e.targetGapHash[M.orifrom].from+1;else if(M.orifrom-S>M.from-E)for(var T=S+1;T<M.orifrom;++T)C[T]=-1;for(T=0;T<=M.orito-M.orifrom;++T)C[T+M.orifrom]=T+M.from;S=M.orito,E=M.to}var A=0;for(e.icn3d.alnChainsSeq[d]=[],r=0,o=_.length;r<o;++r){if(e.targetGapHash.hasOwnProperty(r))for(T=e.targetGapHash[r].from;T<=e.targetGapHash[r].to;++T)m+=w[T];if(y+=e.insertGap(d,r,"-",!0),e.targetGapHash.hasOwnProperty(r)&&(A+=e.targetGapHash[r].to-e.targetGapHash[r].from+1),C.hasOwnProperty(r)&&-1!==C[r]){m+=w[C[r]];var k=e.getColorhexFromBlosum62(_[r],w[C[r]]);_[r]==w[C[r]]?(y+=_[r],e.fullpos2ConsTargetpos[r+A]={same:1,pos:r+1,res:_[r],color:k},e.consrvResPosArray.push(r+1),e.icn3d.alnChainsSeq[d].push({resi:r+1,color:"#FF0000",color2:"#"+k})):e.conservativeReplacement(_[r],w[C[r]])?(y+="+",e.fullpos2ConsTargetpos[r+A]={same:0,pos:r+1,res:_[r],color:k},e.consrvResPosArray.push(r+1),e.icn3d.alnChainsSeq[d].push({resi:r+1,color:"#0000FF",color2:"#"+k})):(y+=" ",e.fullpos2ConsTargetpos[r+A]={same:-1,pos:r+1,res:_[r],color:k},e.icn3d.alnChainsSeq[d].push({resi:r+1,color:e.GREYC,color2:"#"+k}))}else m+="-",y+=" "}}else m+="cannot be aligned",alert("The sequence can NOT be aligned to the structure");var R="BLAST, E: "+b;e.showSeq(d,h,void 0,f,R,m,y);var D={};if(void 0!==e.consrvResPosArray)for(r=0,o=e.consrvResPosArray.length;r<o;++r)D[h+"_"+e.consrvResPosArray[r]]=1;e.selectResidueList(D,"aligned_protein",R,!1)}}e.enableHlSeq(),e.showCddSiteAll()},error:function(i,n,r){if(this.tryCount++,this.tryCount<=this.retryLimit)$.ajax(this);else{for(var o in e.enableHlSeq(),console.log("No data were found for the protein "+t+"..."),e.protein_chainid){var s=e.protein_chainid[o];e.setAlternativeSeq(o,s),e.showSeq(o,s)}e.showCddSiteAll()}}})},iCn3DUI.prototype.setAlternativeSeq=function(e,t){var i=this,n=i.icn3d.chainsSeq[e];i.giSeq[e]=[];for(var r=0,o=n.length;r<o;++r)i.giSeq[e][r]=n[r].name;i.matchedPos[e]=0,i.baseResi[e]=i.icn3d.chainsSeq[e][0].resi-i.matchedPos[e]-1},iCn3DUI.prototype.getProteinName=function(e){var t=this,i="";if(void 0===t.cfg.mmdbid&&void 0===t.cfg.gi&&void 0===t.cfg.blast_rep_id||void 0===t.mmdb_data)void 0!==t.cfg.align&&void 0!==t.chainid2title&&void 0!==t.chainid2title[e]&&(i=t.chainid2title[e]);else{var n=t.mmdb_data.moleculeInfor,r=e.substr(e.indexOf("_")+1);for(var o in n)if(n[o].chain==r){i=n[o].name.replace(/\'/g,"&prime;"),proteinName=i;break}}return i},iCn3DUI.prototype.getSequenceData=function(e,t,i,n){var r=this,o=r.getProteinName(e),s=o;s.length>40&&(s=s.substr(0,40)+"...");var a="";0==n&&("protein"==i?a="<span class='icn3d-annoLargeTitle'><b>Proteins</b>: </span><br><br>":"nucleotide"==i?a="<span class='icn3d-annoLargeTitle'><b>Nucleotides</b>: </span><br><br>":"chemical"==i&&(a="<span class='icn3d-annoLargeTitle'><b>Chemicals/Ions/Water</b>: </span><br><br>")),$("#"+r.pre+"dl_annotations").append("<div id='"+r.pre+"anno_"+e+"' class='icn3d-annotation'>"+a+"<b>"+e+"</b>: <span title='"+o+"'>"+s+"</span> </div>"),$("#"+r.pre+"anno_"+e).append(r.getAnDiv(e,"giseq")),$("#"+r.pre+"anno_"+e).append(r.getAnDiv(e,"interaction")),$("#"+r.pre+"anno_"+e).append("<br><hr><br>"),r.giSeq[e]=[];for(var c=0;c<r.icn3d.chainsSeq[e].length;++c)r.giSeq[e][c]=r.icn3d.chainsSeq[e][c].name;r.matchedPos[e]=0,r.baseResi[e]=r.icn3d.chainsSeq[e][0].resi-r.matchedPos[e]-1,r.showSeq(e,t,i)},iCn3DUI.prototype.getCombinedSequenceData=function(e,t,i){var n,r=this,o=0==i?"<span class='icn3d-annoLargeTitle'><b>Chemicals/Ions/Water</b>: </span><br><br>":"",s=t[0].lastIndexOf("_"),a=t[0].substr(0,s),c=void 0!==r.cfg.mmdbid?r.chainid2sid[a]:void 0;n=void 0!==c?"<b><a class='icn3d-blue' href='https://pubchem.ncbi.nlm.nih.gov/substance/"+c+"#section=2D-Structure' target='_blank'>"+e+" <img src='https://pubchem.ncbi.nlm.nih.gov/image/imgsrv.fcgi?sid="+c+"'></a></b>":"<b>"+e+"</b>",$("#"+r.pre+"dl_annotations").append("<div id='"+r.pre+"anno_"+e+"' class='icn3d-annotation'>"+o+n+"</div>"),$("#"+r.pre+"anno_"+e).append("<div id='"+r.pre+"giseq_"+e+"'><div id='"+r.pre+"dt_giseq_"+e+"' style='display:none'></div><div id='"+r.pre+"ov_giseq_"+e+"'></div></div>"),$("#"+r.pre+"anno_"+e).append("<br><hr><br>");var l='<div id="'+r.pre+'giseq_sequence" class="icn3d-dl_sequence">';l+='<div class="icn3d-seqTitle" anno="sequence"><span style="white-space:nowrap;" title="Chemical '+e+'">Chem. '+e+"</span></div>",l+='<span class="icn3d-residueNum" style="width:60px!important;" title="starting protein sequence number">Count: '+t.length+"</span>";for(var d=l+='<span class="icn3d-seqLine">',h=l,u=0,p=t.length;u<p;++u){var m=e,f=m;m.length>3&&(f=m.substr(0,3)),u<t.length-1&&(f+=",");var g=t[u],v=g.substr(g.lastIndexOf("_")+1);d+='<span id="giseq_'+r.pre+g+'" title="'+m+v+'" class="icn3d-residue icn3d-chemical">'+f+"</span>"}var y=r.GREY8,b=Math.round(r.seqAnnWidth*t.length/r.maxAnnoLength);b<1&&(b=1),h+='<div class="icn3d-seqTitle" style="display:inline-block; color:white; font-weight:bold; background-color:'+y+"; width:"+b+'px;">&nbsp;</div>',l="</span>",l+="<br>",d+=l+="</div>",h+=l,$("#"+r.pre+"dt_giseq_"+e).html(d),$("#"+r.pre+"ov_giseq_"+e).html(h)},iCn3DUI.prototype.insertGap=function(e,t,i,n){var r=this,o="";if(r.cfg.blast_rep_id==e&&void 0!==r.targetGapHash&&r.targetGapHash.hasOwnProperty(t))for(var s=0;s<r.targetGapHash[t].to-r.targetGapHash[t].from+1;++s)o+=void 0!==n&&n?i:"<span>"+i+"</span>";return o},iCn3DUI.prototype.insertGapOverview=function(e,t){var i=this,n="";return i.cfg.blast_rep_id==e&&void 0!==i.targetGapHash&&i.targetGapHash.hasOwnProperty(t)&&(n+='<div style="display:inline-block; background-color:#333; width:'+i.seqAnnWidth*(i.targetGapHash[t].to-i.targetGapHash[t].from+1)/(i.maxAnnoLength+i.nTotalGap)+'px; height:3px;">&nbsp;</div>'),n},iCn3DUI.prototype.showSeq=function(e,t,i,n,r,o,s){var a,c=this,l=!1;if(void 0===c.cfg.mmdbid&&void 0===c.cfg.gi&&void 0===c.cfg.blast_rep_id&&void 0===c.cfg.align){l=!0,a=[];for(var d=0;d<c.giSeq[e].length;++d)a.push(c.icn3d.chainsSeq[e][d])}else a=c.giSeq[e];var h=c.RESIDUE_WIDTH*c.giSeq[e].length+200,u=c.giSeq[e].length;u>c.maxAnnoLength&&(c.maxAnnoLength=u),$("#"+c.pre+"giseq_"+e).width(h),$("#"+c.pre+"interaction_"+e).width(h),$("#"+c.pre+"ssbond_"+e).width(h),$("#"+c.pre+"custom_"+e).length&&$("#"+c.pre+"custom_"+e).width(h),$("#"+c.pre+"clinvar_"+e).length&&$("#"+c.pre+"clinvar_"+e).width(h),$("#"+c.pre+"snp_"+e).length&&$("#"+c.pre+"snp_"+e).width(h),$("#"+c.pre+"cddsite_"+e).length&&$("#"+c.pre+"cddsite_"+e).width(h),$("#"+c.pre+"domain_"+e).length&&$("#"+c.pre+"domain_"+e).width(h);var p,m="",f="",g="";if(m+='<div class="icn3d-dl_sequence">',g+='<div class="icn3d-dl_sequence">',c.giSeq[e].length>10){p='<div class="icn3d-residueLine" style="white-space:nowrap;">';var v=c.icn3d.getFirstCalphaAtomObj(c.icn3d.chains[e]);void 0===c.cfg.mmdbid&&void 0===c.cfg.gi&&void 0===c.cfg.blast_rep_id&&void 0===c.cfg.align||void 0===v.resi_ori||v.resi_ori==v.resi||-1!=e.indexOf("Misc")?p+='<div class="icn3d-annoTitle" anno="0"></div>':p+='<div class="icn3d-annoTitle" anno="0" title="NCBI Residue Numbers">NCBI Residue Numbers</div>',g+=(p+='<span class="icn3d-residueNum"></span>')+"<br>",m+=p+'<span class="icn3d-seqLine">';for(var y=0,b=0,_=(d=0,a.length);d<_;++d)m+=c.insertGap(e,d,"-"),m+="<span>",(N=l?a[d].resi:d>=c.matchedPos[e]&&d-c.matchedPos[e]<c.icn3d.chainsSeq[e].length?c.icn3d.chainsSeq[e][d-c.matchedPos[e]].resi:c.baseResi[e]+1+d)%10==0&&(m+=N+" "),c.icn3d.residues.hasOwnProperty(z=e+"_"+N)&&(v=c.icn3d.getFirstCalphaAtomObj(c.icn3d.residues[z]),"H"==c.icn3d.secondaries[z]&&v.ssbegin?m+='<span class="icn3d-helix-color">H'+ ++y+"</span>":"E"==c.icn3d.secondaries[z]&&v.ssbegin&&(++b,"green"==c.icn3d.sheetcolor?m+='<span class="icn3d-sheet-color">S'+b+"</span>":"yellow"==c.icn3d.sheetcolor&&(m+='<span class="icn3d-sheet-colory">S'+b+"</span>"))),m+="</span>";m+='<span class="icn3d-residueNum"></span>',m+="</span>",m+="<br>",m+="</div>",g+="</div>"}for(p='<div class="icn3d-residueLine" style="white-space:nowrap;">',p+='<div class="icn3d-annoTitle" anno="0"></div>',g+=(p+='<span class="icn3d-residueNum"></span>')+"<br>",m+=p+'<span class="icn3d-seqLine">',d=0,_=a.length;d<_;++d)m+=c.insertGap(e,d,"-"),c.icn3d.residues.hasOwnProperty(z=e+"_"+(d>=c.matchedPos[e]&&d-c.matchedPos[e]<c.icn3d.chainsSeq[e].length?c.icn3d.chainsSeq[e][d-c.matchedPos[e]].resi:c.baseResi[e]+1+d))?"H"==c.icn3d.secondaries[z]?(m+=d%2==0?'<span class="icn3d-helix">':'<span class="icn3d-helix2">',m+="&nbsp;</span>"):"E"==c.icn3d.secondaries[z]?((v=c.icn3d.getFirstCalphaAtomObj(c.icn3d.residues[z])).ssend?"green"==c.icn3d.sheetcolor?m+='<span class="icn3d-sheet2">':"yellow"==c.icn3d.sheetcolor&&(m+='<span class="icn3d-sheet2y">'):"green"==c.icn3d.sheetcolor?m+='<span class="icn3d-sheet">':"yellow"==c.icn3d.sheetcolor&&(m+='<span class="icn3d-sheety">'),m+="&nbsp;</span>"):"c"==c.icn3d.secondaries[z]?m+='<span class="icn3d-coil">&nbsp;</span>':"o"==c.icn3d.secondaries[z]&&(m+='<span class="icn3d-other">&nbsp;</span>'):m+="<span>-</span>";m+='<span class="icn3d-residueNum"></span>',m+="</span>",m+="<br>",m+="</div>",m+="</div>",g+="</div></div>",p=c.cfg.blast_rep_id===e?'<div id="'+c.pre+'giseq_sequence" class="icn3d-dl_sequence" style="border: solid 1px #000;">':'<div id="'+c.pre+'giseq_sequence" class="icn3d-dl_sequence">';var w="Protein",x="Protein";void 0!==i&&("nucleotide"==i?(w="Nucl.",x="Nucleotide"):"chemical"==i&&(w="Chem.",x="Chemical")),p+='<div class="icn3d-seqTitle icn3d-link icn3d-blue" gi="'+e+'" anno="sequence" chain="'+e+'"><span style="white-space:nowrap;" title="'+x+" "+e+'">'+w+" "+e+"</span></div>",g+=(p+='<span class="icn3d-residueNum" title="starting protein sequence number">'+(c.baseResi[e]+1).toString()+"</span>")+"<br>",m+=p+(I='<span class="icn3d-seqLine">'),f+=p+I;var C=0;for(d=0,_=a.length;d<_;++d){m+=c.insertGap(e,d,"-"),void 0!==c.targetGapHash&&c.targetGapHash.hasOwnProperty(d)&&(C+=c.targetGapHash[d].to-c.targetGapHash[d].from+1);var S=l?a[d].name:a[d],E=S;if(S.length>1&&(E=S[0]+".."),c.icn3d.residues.hasOwnProperty(e+"_"+(L=d>=c.matchedPos[e]&&d-c.matchedPos[e]<c.icn3d.chainsSeq[e].length?c.icn3d.chainsSeq[e][d-c.matchedPos[e]].resi:c.baseResi[e]+1+d))){var M="333333";M=c.cfg.blast_rep_id==e&&void 0!==c.fullpos2ConsTargetpos&&void 0!==c.fullpos2ConsTargetpos[d+C]?c.fullpos2ConsTargetpos[d+C].color:(v=c.icn3d.getFirstCalphaAtomObj(c.icn3d.residues[e+"_"+L])).color?v.color.getHexString():c.icn3d.defaultAtomColor,m+='<span id="giseq_'+c.pre+e+"_"+L+'" title="'+S+L+'" class="icn3d-residue" style="color:#'+M+'">'+E+"</span>"}else m+='<span title="'+S+L+'" class="icn3d-residue">'+(E=E.toLowerCase())+"</span>"}c.cfg.blast_rep_id==e&&(c.opts.color="conservation",c.icn3d.setColorByOptions(c.opts,c.icn3d.atoms)),M=(v=c.icn3d.getFirstCalphaAtomObj(c.icn3d.chains[e])).color?v.color.getHexString():c.icn3d.defaultAtomColor;var T=Math.round(c.seqAnnWidth*a.length/c.maxAnnoLength);if(T<1&&(T=1),c.cfg.blast_rep_id!=e)f+='<div id="giseq_summary_'+c.pre+e+'" class="icn3d-seqTitle icn3d-link" gi chain="'+e+'" style="display:inline-block; color:white; font-weight:bold; background-color:#'+M+"; width:"+T+'px;">'+e+"</div>";else{var A=[];for((O=[]).push(0),d=0,_=a.length;d<_;++d)void 0!==c.targetGapHash&&c.targetGapHash.hasOwnProperty(d)&&(A.push(d-1),O.push(d));for(A.push(a.length-1),f+='<div id="giseq_summary_'+c.pre+e+'" class="icn3d-seqTitle icn3d-link" gi chain="'+e+'" style="width:'+T+'px;">',d=0,_=O.length;d<_;++d)f+=c.insertGapOverview(e,O[d]),f+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+M+"; width:"+Math.round(c.seqAnnWidth*(A[d]-O[d]+1)/(c.maxAnnoLength+c.nTotalGap))+'px;" class="icn3d-seqTitle icn3d-link icn3d-blue" anno="sequence" gi chain="'+e+'" title="'+e+'">'+e+"</div>";f+="</div>"}if(p='<span class="icn3d-residueNum" title="ending protein sequence number">'+L+"</span>",p+="</span>",m+=p+="<br>",f+=p,c.cfg.blast_rep_id==e){if(void 0!==s&&""!==s){p='<div class="icn3d-seqTitle icn3d-link icn3d-blue" blast="" posarray="'+c.consrvResPosArray.toString()+'" title="'+r+'" setname="'+e+'_blast" anno="sequence" chain="'+e+'"><span style="white-space:nowrap;" title="'+r+'">'+r+"</span></div>",g+=(p+='<span class="icn3d-residueNum"></span>')+"<br>",m+=p+(I='<span class="icn3d-seqLine">'),f+=p+I;var k=0,R=0,D=c.queryStart;for(d=0,_=s.length;d<_;++d)if("-"==(E=s[d]))m+="<span>-</span>";else if(" "==E)m+="<span> </span>";else{var L;c.icn3d.residues.hasOwnProperty(e+"_"+(L=c.fullpos2ConsTargetpos[d].pos))?m+='<span id="giseq_'+c.pre+e+"_"+L+'" title="'+c.fullpos2ConsTargetpos[d].res+L+'" class="icn3d-residue" style="color:#'+(M=c.fullpos2ConsTargetpos[d].color)+'">'+E+"</span>":m+='<span class="icn3d-residue">'+(E=E.toLowerCase())+"</span>",f+=c.insertGapOverview(e,d),(H=Math.round(c.seqAnnWidth*d/(c.maxAnnoLength+c.nTotalGap)-k-R))<0&&(H=0),f+='<div style="display:inline-block; width:'+H+'px;">&nbsp;</div>',f+='<div style="display:inline-block; background-color:#F00; width:1px;" title="'+E+L+'">&nbsp;</div>',k+=H,R+=1,++D}p='<span class="icn3d-residueNum"></span>',p+="</span>",m+=p+="<br>",f+=p}var I;for(p='<div class="icn3d-annoTitle" anno="sequence" chain="'+e+'"><span style="white-space:nowrap;" title="'+n+'">'+n+"</span></div>",g+=(p+='<span class="icn3d-residueNum" title="starting protein sequence number">'+c.queryStart+"</span>")+"<br>",m+=p+(I='<span class="icn3d-seqLine" style="font-weight: bold;">'),f+=p+I,D=c.queryStart,d=0,_=o.length;d<_;++d)" "==(E=o[d])||"-"==E?m+="<span>-</span>":(void 0===c.fullpos2ConsTargetpos||void 0===c.fullpos2ConsTargetpos[d]||c.icn3d.residues.hasOwnProperty(e+"_"+c.fullpos2ConsTargetpos[d].pos)?m+='<span title="'+E+D+'" class="icn3d-residue">'+E+"</span>":m+='<span title="'+(E=E.toLowerCase())+D+'" class="icn3d-residue">'+E+"</span>",++D);M=(v=c.icn3d.getFirstCalphaAtomObj(c.icn3d.chains[e])).color?v.color.getHexString():c.icn3d.defaultAtomColor;var O=[],P=(A=[],"-");for(d=0,_=o.length;d<_;++d)"-"!=(E=o[d])&&"-"==P?O.push(d):"-"==E&&"-"!=P&&A.push(d-1),P=E;for("-"!=P&&A.push(o.length-1),d=0,_=O.length;d<_;++d){var H;f+='<div style="display:inline-block; width:'+(H=0==d?Math.round(c.seqAnnWidth*O[d]/(c.maxAnnoLength+c.nTotalGap)):Math.round(c.seqAnnWidth*(O[d]-A[d-1]-1)/(c.maxAnnoLength+c.nTotalGap)))+'px;">&nbsp;</div>',f+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+M+"; width:"+Math.round(c.seqAnnWidth*(A[d]-O[d]+1)/(c.maxAnnoLength+c.nTotalGap))+'px;" anno="sequence" chain="'+e+'" title="'+n+'">'+n+"</div>"}p='<span class="icn3d-residueNum" title="ending protein sequence number">'+c.queryEnd+"</span>",p+="</span>",m+=p+="<br>",f+=p}if(m+="</div>",f+="</div>",g+="</div>",c.giSeq[e].length>10&&(v=c.icn3d.getFirstCalphaAtomObj(c.icn3d.chains[e]),(void 0!==c.cfg.mmdbid||void 0!==c.cfg.gi||void 0!==c.cfg.blast_rep_id||void 0!==c.cfg.align)&&void 0!==v.resi_ori&&v.resi_ori!=v.resi&&-1==e.indexOf("Misc"))){for(p='<div class="icn3d-dl_sequence">',p+='<div class="icn3d-residueLine" style="white-space:nowrap;">',p+='<div class="icn3d-annoTitle" anno="0" title="PDB Residue Numbers">PDB Residue Numbers</div>',g+=(p+='<span class="icn3d-residueNum"></span>')+"<br>",m+=p+'<span class="icn3d-seqLine">',d=0,_=a.length;d<_;++d){var N,z;if(m+=c.insertGap(e,d,"-"),d>=c.matchedPos[e]&&d-c.matchedPos[e]<c.icn3d.chainsSeq[e].length)if(c.icn3d.residues.hasOwnProperty(z=e+"_"+(N=c.icn3d.chainsSeq[e][d-c.matchedPos[e]].resi))){var F=(v=c.icn3d.getFirstCalphaAtomObj(c.icn3d.residues[z])).resi_ori;m+="<span>",F%10==0&&(m+=F+" "),m+="</span>"}else m+="<span></span>";else m+="<span></span>"}m+='<span class="icn3d-residueNum"></span>',m+="</span>",m+="<br>",m+="</div>",m+="</div>",g+="</div></div>"}$("#"+c.pre+"dt_giseq_"+e).html(m),$("#"+c.pre+"ov_giseq_"+e).html(f),$("#"+c.pre+"tt_giseq_"+e).html(g)},iCn3DUI.prototype.navClinVar=function(e){var t=this;t.currClin[e]=-1,$(document).on("click","#"+t.pre+e+"_prevclin",function(i){i.stopImmediatePropagation();var n=void 0!==t.resi2disease_nonempty[e]?Object.keys(t.resi2disease_nonempty[e]).length:0;--t.currClin[e],t.currClin[e]<0&&(t.currClin[e]=n-1),t.showClinVarLabelOn3D(e)}),$(document).on("click","#"+t.pre+e+"_nextclin",function(i){i.stopImmediatePropagation();var n=void 0!==t.resi2disease_nonempty[e]?Object.keys(t.resi2disease_nonempty[e]).length:0;++t.currClin[e],t.currClin[e]>n-1&&(t.currClin[e]=0),t.showClinVarLabelOn3D(e)})},iCn3DUI.prototype.showClinVarLabelOn3D=function(e){var t,i=this,n=Object.keys(i.resi2disease_nonempty[e]);t=e+"_"+n[i.currClin[e]];for(var r="",o=i.resi2disease_nonempty[e][n[i.currClin[e]]],s=0,a=o.length;s<a;++s)if(""!=o[s]&&"not specified"!=o[s]&&"not provided"!=o[s]){r=o[s];break}var c=i.icn3d.centerAtoms(i.icn3d.hash2Atoms(i.icn3d.residues[t]));r.length>30&&(r=r.substr(0,30)+"..."),i.removeSelection(),null==i.icn3d.labels&&(i.icn3d.labels={}),i.icn3d.labels.clinvar=[];var l=i.icn3d.LABELSIZE;for(var d in i.addLabel(r,c.center.x+1,c.center.y+1,c.center.z+1,l,"#FFFF00",void 0,"clinvar"),i.icn3d.hAtoms={},i.icn3d.residues[t])i.icn3d.hAtoms[d]=1;$("#clinvar_"+i.pre+t).addClass("icn3d-highlightSeq"),$("#"+i.pre+"modeswitch")[0].checked||i.setMode("selection"),i.icn3d.draw()},iCn3DUI.prototype.getSnpLine=function(e,t,i,n,r,o,s,a,c,l,d,h,u,p,m,f){var g=this,v="",y=p?"clinvar":"snp";if(d)v+=p?'<div class="icn3d-seqTitle icn3d-link icn3d-blue icn3d-clinvar-path" clinvar="clinvar" posarray="'+l+'" shorttitle="ClinVar" setname="'+h+'_ClinVar" anno="sequence" chain="'+h+'" title="ClinVar">ClinVar</div>':'<div class="icn3d-seqTitle icn3d-link icn3d-blue" clinvar="clinvar" posarray="'+c+'" shorttitle="SNP" setname="'+h+'_SNP" anno="sequence" chain="'+h+'" title="SNP">SNP</div>';else if(2==e&&p){var b=g.isMobile()?"none":"button";v+='<div id="'+g.pre+h+'_prevclin" style="display:inline-block; font-size:11px; font-weight:bold; width:60px!important;"><button class="link" style="-webkit-appearance:'+b+'; height:18px; width:55px;"><span style="white-space:nowrap; margin-left:-40px;" title="Show the previous ClinVar on structure">&lt; ClinVar</span></button></div>',v+='<div id="'+g.pre+h+'_nextclin" style="display:inline-block; font-size:11px; font-weight:bold; width:60px!important;"><button class="link" style="-webkit-appearance:'+b+'; height:18px; width:55px;"><span style="white-space:nowrap; margin-left:-40px;" title="Show the next ClinVar on structure">ClinVar &gt;</span></button></div>'}else v+='<div class="icn3d-seqTitle"></div>';for(var _=y,w=0,x=0,C={},S={},E=1,M=g.giSeq[h].length;E<=M;++E)if(void 0!==s[E]){++w;for(var T="",A=0,k=i[E].length;A<k&&!f;++A){for(var R=o[E][A].split("; "),D=a[E][A].split("; "),L="",I=0,O=R.length;I<O;++I)""!=R[I]&&"not specified"!=R[I]&&"not provided"!=R[I]&&(L+=R[I]+" ("+D[I]+"); ");""!=L&&(C[E]="icn3d-clinvar",A==e-2&&(S[E]="icn3d-clinvar",-1!=L.indexOf("Pathogenic")&&(S[E]="icn3d-clinvar-path"))),T+=L+" | "}-1!=T.indexOf("Pathogenic")&&(C[E]="icn3d-clinvar-path"),"icn3d-clinvar"!=C[E]&&"icn3d-clinvar-path"!=C[E]||++x}if(0==w)return $("#"+g.pre+"dt_clinvar_"+h).html(""),$("#"+g.pre+"ov_clinvar_"+h).html(""),$("#"+g.pre+"tt_clinvar_"+h).html(""),$("#"+g.pre+"dt_snp_"+h).html(""),$("#"+g.pre+"ov_snp_"+h).html(""),$("#"+g.pre+"tt_snp_"+h).html(""),"";if(0==x&&p)return $("#"+g.pre+"dt_clinvar_"+h).html(""),$("#"+g.pre+"ov_clinvar_"+h).html(""),$("#"+g.pre+"tt_clinvar_"+h).html(""),"";var P=p?x:w;if(g.bClinvarCnt=0!=x,v+=1==e?'<span class="icn3d-residueNum" title="residue count">'+P+" Res</span>":'<span class="icn3d-residueNum"></span>',void 0!==m&&m)return v+"<br>";v+='<span class="icn3d-seqLine">';var H="",N=0,z=0;for(E=1,M=g.giSeq[h].length;E<=M;++E)if(u){if(void 0!==s[E]){var F=j=g.giSeq[h][E-1];j.length>1&&(F=j[0]+"..");var U=(V=E>=g.matchedPos[h]&&E-1-g.matchedPos[h]<g.icn3d.chainsSeq[h].length?g.icn3d.chainsSeq[h][E-1-g.matchedPos[h]].resi:g.baseResi[h]+1+E-1)+F+">";for(T="",A=0,k=i[E].length;A<k;++A)if(U+=i[E][A],!f){for(R=o[E][A].split("; "),D=a[E][A].split("; "),L="",I=0,O=R.length;I<O;++I)""!=R[I]&&"not specified"!=R[I]&&"not provided"!=R[I]&&(L+=R[I]+" ("+D[I]+"); ");T+=L+" | "}v+=g.insertGapOverview(h,E-1);var B=g.cfg.blast_rep_id==h?Math.round(g.seqAnnWidth*(E-1)/(g.maxAnnoLength+g.nTotalGap)-N-z):Math.round(g.seqAnnWidth*(E-1)/g.maxAnnoLength-N-z);B<0&&(B=0),p&&"icn3d-clinvar"!=C[E]&&"icn3d-clinvar-path"!=C[E]||(B>0&&(v+='<div style="display:inline-block; width:'+B+'px;">&nbsp;</div>'),v+='<div style="display:inline-block; background-color:#000; width:1px;" title="'+U+'">&nbsp;</div>',N+=B,z+=1)}}else if(v+=g.insertGap(h,E-1,"-"),void 0!==s[E])if(p||1!=e){var j;F=j=g.giSeq[h][E-1],j.length>1&&(F=j[0]+"..");var G,V=E>=g.matchedPos[h]&&E-1-g.matchedPos[h]<g.icn3d.chainsSeq[h].length?g.icn3d.chainsSeq[h][E-1-g.matchedPos[h]].resi:g.baseResi[h]+1+E-1,W="",q=(U="<div class='snptip'>",k=i[E].length,0),Y=0;if(2==e?(q=0,Y=1):3==e&&(q=1,Y=k),p){G=1;var X=0;for(A=q;A<k&&A<Y;++A){for(R=o[E][A].split("; "),D=a[E][A].split("; "),L="",Z=0,I=0,O=R.length;I<O;++I)""!=R[I]&&"not specified"!=R[I]&&"not provided"!=R[I]&&(Z>0?L+="; ":0!==A&&1!==A||(H='disease="'+R[I]+'"'),L+=R[I]+" ("+D[I]+")",++Z);""!=L&&(X<G&&(W+=i[E][A]),U+=V+F+">"+i[E][A],U+=": "+L,U+="<br>Links: <a href='https://www.ncbi.nlm.nih.gov/clinvar/?term="+r[E][A]+"[AlleleID]' target='_blank'>ClinVar</a>, <a href='https://www.ncbi.nlm.nih.gov/snp/?term="+n[E][A]+"' target='_blank'>dbSNP (rs"+n[E][A]+")</a>",A<k-1&&(U+="<br><br>"),++X)}X>G&&3==e&&(W+="..")}else{for(G=2,A=q;A<k&&A<Y;++A)if(A<G&&(W+=i[E][A]),U+=V+F+">"+i[E][A],f)A<k-1&&(U+="<br>");else{R=o[E][A].split("; "),D=a[E][A].split("; "),L="";var Z=0;for(I=0,O=R.length;I<O;++I)""!=R[I]&&"not specified"!=R[I]&&"not provided"!=R[I]&&(Z>0?L+="; ":0!==A&&1!==A||(H='disease="'+R[I]+'"'),L+=R[I]+" ("+D[I]+")",++Z);""!=L?(U+=": "+L,U+="<br>Links: <a href='https://www.ncbi.nlm.nih.gov/clinvar/?term="+r[E][A]+"[AlleleID]' target='_blank'>ClinVar</a>, <a href='https://www.ncbi.nlm.nih.gov/snp/?term="+n[E][A]+"' target='_blank'>dbSNP (rs"+n[E][A]+")</a>"):U+="<br>Link: <a href='https://www.ncbi.nlm.nih.gov/snp/?term="+n[E][A]+"' target='_blank'>dbSNP (rs"+n[E][A]+")</a>",A<k-1&&(U+="<br><br>")}k>G&&3==e&&(W+="..")}U+="</div>",v+=p?"icn3d-clinvar"==C[E]||"icn3d-clinvar-path"==C[E]?1==e?"<span>&dArr;</span>":""==W||" "==W?"<span>-</span>":'<span id="'+_+"_"+g.pre+h+"_"+V+'" label title="'+U+'" '+H+' class="icn3d-tooltip icn3d-residue '+S[E]+'">'+W+"</span>":"<span>-</span>":""==W||" "==W?"<span>-</span>":f?'<span id="'+_+"_"+g.pre+h+"_"+V+'" label title="'+U+'" class="icn3d-residue '+S[E]+'">'+W+"</span>":'<span id="'+_+"_"+g.pre+h+"_"+V+'" label title="'+U+'" '+H+' class="icn3d-tooltip icn3d-residue '+S[E]+'">'+W+"</span>"}else v+="<span>&dArr;</span>";else v+="<span>-</span>";return v+=1==e?'<span class="icn3d-residueNum" title="residue count">&nbsp;'+P+" Residues</span>":'<span class="icn3d-residueNum"></span>',(v+="</span>")+"<br>"},iCn3DUI.prototype.processSnpClinvar=function(e,t,i,n){var r=this,o='<div id="'+r.pre+t+'_snpseq_sequence" class="icn3d-dl_sequence">',s=o,a=o,c='<div id="'+r.pre+t+'_clinvarseq_sequence" class="icn3d-dl_sequence">',l=c,d=c,h=e.split("\n"),u={},p={},m={};r.resi2disease_nonempty[t]={};for(var f={},g={},v={},y={},b={},_="",w=0,x=h.length;w<x;++w)if(""!=h[w]){var C=h[w].split("\t"),S=C[3];if(S==_)continue;_=S;var E=S.substr(0,S.length-3),M=Math.round(E),T=(S.substr(S.length-3,1),S.substr(S.length-1,1)),A=n?"":C[4],k=n?"":C[5],R=n?"":C[6],D=n?"":C[7];y[M+r.baseResi[t]]=1,""!=R&&(b[M+r.baseResi[t]]=1),p[M]=w+1,void 0===u[M]&&(u[M]=[]),u[M].push(T),void 0===g[M]&&(g[M]=[]),g[M].push(A),void 0===v[M]&&(v[M]=[]),v[M].push(k),void 0===m[M]&&(m[M]=[]),m[M].push(R),""!=R&&(void 0===r.resi2disease_nonempty[t][M]&&(r.resi2disease_nonempty[t][M]=[]),r.resi2disease_nonempty[t][M].push(R)),void 0===f[M]&&(f[M]=[]),f[M].push(D)}var L=Object.keys(y),I=Object.keys(b),O=!1;o+=r.getSnpLine(1,3,u,g,v,m,p,f,L,I,1,t,!1,O,void 0,n),o+=r.getSnpLine(2,3,u,g,v,m,p,f,L,I,0,t,!1,O,void 0,n),o+=r.getSnpLine(3,3,u,g,v,m,p,f,L,I,0,t,!1,O,void 0,n),a+=r.getSnpLine(1,3,u,g,v,m,p,f,L,I,1,t,!1,O,!0,n),a+=r.getSnpLine(2,3,u,g,v,m,p,f,L,I,0,t,!1,O,!0,n),a+=r.getSnpLine(3,3,u,g,v,m,p,f,L,I,0,t,!1,O,!0,n),s+=r.getSnpLine(1,3,u,g,v,m,p,f,L,I,1,t,!0,O,void 0,n),o+="</div>",s+="</div>",a+="</div>",$("#"+r.pre+"dt_snp_"+t).html(o),$("#"+r.pre+"ov_snp_"+t).html(s),$("#"+r.pre+"tt_snp_"+t).html(a),!n&&r.bClinvarCnt?(c+=r.getSnpLine(1,3,u,g,v,m,p,f,L,I,1,t,!1,O=!0,void 0,n),c+=r.getSnpLine(2,3,u,g,v,m,p,f,L,I,0,t,!1,O,void 0,n),c+=r.getSnpLine(3,3,u,g,v,m,p,f,L,I,0,t,!1,O,void 0,n),d+=r.getSnpLine(1,3,u,g,v,m,p,f,L,I,1,t,!1,O,!0,n),d+=r.getSnpLine(2,3,u,g,v,m,p,f,L,I,0,t,!1,O,!0,n),d+=r.getSnpLine(3,3,u,g,v,m,p,f,L,I,0,t,!1,O,!0,n),l+=r.getSnpLine(1,3,u,g,v,m,p,f,L,I,1,t,!0,O,void 0,n),c+="</div>",l+="</div>",d+="</div>",$("#"+r.pre+"dt_clinvar_"+t).html(c),$("#"+r.pre+"ov_clinvar_"+t).html(l),$("#"+r.pre+"tt_clinvar_"+t).html(d),r.navClinVar(t,i)):($("#"+r.pre+"dt_clinvar_"+t).html(""),$("#"+r.pre+"ov_clinvar_"+t).html(""),$("#"+r.pre+"tt_clinvar_"+t).html("")),r.enableHlSeq(),r.bAjaxSnpClinvar=!0,void 0!==r.deferredSnpClinvar&&r.deferredSnpClinvar.resolve()},iCn3DUI.prototype.showSnpClinvar=function(e,t){var i=this;$.ajax({url:"https://www.ncbi.nlm.nih.gov/projects/SNP/beVarSearch_mt.cgi?appname=iCn3D&format=bed&report=pdb2bed&acc="+t,dataType:"text",cache:!0,tryCount:0,retryLimit:1,success:function(n){""!=n?i.processSnpClinvar(n,e,t,!1):void 0!==i.chain2gi&&Object.keys(i.chain2gi).length>0?i.showSnpClinvarAlt(e,t,i.chain2gi[t]):$.ajax({url:"https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?db=protein&retmode=json&id="+t,dataType:"json",cache:!0,tryCount:0,retryLimit:1,success:function(n){var r;for(var o in n.result)"uids"!==o&&(r=o);i.showSnpClinvarAlt(e,t,r)},error:function(t,n,r){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):i.processNoSnpClinvar(e)}})},error:function(t,n,r){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):i.processNoSnpClinvar(e)}})},iCn3DUI.prototype.showSnpClinvarAlt=function(e,t,i){var n=this;void 0!==i?$.ajax({url:"https://www.ncbi.nlm.nih.gov/projects/SNP/beVarSearch.cgi?appname=iCn3D&format=bed&report=pdb2bed&gi="+i,dataType:"text",cache:!0,tryCount:0,retryLimit:1,success:function(i){""!=i?n.processSnpClinvar(i,e,t,!0):n.processNoSnpClinvar(e)},error:function(t,i,r){this.tryCount++,this.tryCount<=this.retryLimit?$.ajax(this):n.processNoSnpClinvar(e)}}):console.log("No gi was found for the chain "+t+"...")},iCn3DUI.prototype.processNoSnpClinvar=function(e){var t=this;console.log("No SNP data were found for the protein "+e+"..."),$("#"+t.pre+"dt_clinvar_"+e).html(""),$("#"+t.pre+"ov_clinvar_"+e).html(""),$("#"+t.pre+"dt_snp_"+e).html(""),$("#"+t.pre+"ov_snp_"+e).html(""),t.enableHlSeq(),t.bAjaxSnpClinvar=!0,void 0!==t.deferredSnpClinvar&&t.deferredSnpClinvar.resolve()},iCn3DUI.prototype.showCddSiteAll=function(){var e=this,t=$.map(e.protein_chainid,function(e){return e}),i=Object.keys(e.protein_chainid);$.ajax({url:"https://www.ncbi.nlm.nih.gov/Structure/cdannots/cdannots.fcgi?fmt&queries="+t,dataType:"jsonp",cache:!0,tryCount:0,retryLimit:1,success:function(t){for(var n={},r=0,o=t.data.length;r<o;++r){var s=t.data[r];n[K=i[r]]=1;for(var a='<div id="'+e.pre+K+'_cddseq_sequence" class="icn3d-cdd icn3d-dl_sequence">',c=a,l=a,d=s.doms,h=void 0!==d?d.length:0,u=0;u<h;++u){var p=d[u].acc,m=d[u].type;m="domain";var f=d[u].title.split(":")[0],g=d[u].defline;(F=m+": "+f).length>14&&(F=F.substr(0,14)+"...");for(var v=m+": "+f,y=d[u].locs,b=0,_=y.length;b<_;++b){for(var w=[],x=[],C={},S=0,E=0,M=y[b].segs.length;E<M;++E){var T=Math.round(y[b].segs[E].from),A=Math.round(y[b].segs[E].to);w.push(T+e.baseResi[K]),x.push(A+e.baseResi[K]);for(var k=T;k<=A;++k)C[k]=1;S+=A-T+1}l+=(U='<div class="icn3d-seqTitle icn3d-link icn3d-blue" domain="'+p+'" from="'+w+'" to="'+x+'" shorttitle="'+F+'" setname="'+K+"_"+m+"_"+u+"_"+b+'" anno="sequence" chain="'+K+'" title="'+v+'">'+F+" </div>")+(B='<span class="icn3d-residueNum" title="residue count">'+S.toString()+" Res</span>")+"<br>",a+=U+B+(j='<span class="icn3d-seqLine">'),c+='<div style="width:20px; display:inline-block;"><span id="'+e.pre+K+"_"+p+"_"+b+'_cddseq_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+e.pre+K+"_"+p+"_"+b+'_cddseq_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div>',c+='<div style="width:100px!important;" class="icn3d-seqTitle icn3d-link icn3d-blue" domain="'+p+'" from="'+w+'" to="'+x+'" shorttitle="'+F+'" index="'+u+'" setname="'+K+"_"+m+"_"+u+"_"+b+'" anno="sequence" chain="'+K+'" title="'+v+'">'+F+" </div>",c+=B+j;for(var R=m+u.toString(),D=(k=0,e.giSeq[K].length);k<D;++k)if(a+=e.insertGap(K,k,"-"),C.hasOwnProperty(k)){var L=Y=e.giSeq[K][k];Y.length>1&&(L=Y[0]+".."),a+='<span id="'+R+"_"+e.pre+K+"_"+(X=k>=e.matchedPos[K]&&k-e.matchedPos[K]<e.icn3d.chainsSeq[K].length?e.icn3d.chainsSeq[K][k-e.matchedPos[K]].resi:e.baseResi[K]+1+k)+'" title="'+L+X+'" class="icn3d-residue">'+Y+"</span>"}else a+="<span>-</span>";var I=e.icn3d.getFirstCalphaAtomObj(e.icn3d.chains[K]),O=I.color?I.color.getHexString():e.icn3d.defaultAtomColor;if(e.cfg.blast_rep_id!=K)for(k=0,D=w.length;k<D;++k)c+='<div style="display:inline-block; width:'+(Z=0==k?Math.round(e.seqAnnWidth*w[k]/e.maxAnnoLength):Math.round(e.seqAnnWidth*(w[k]-x[k-1]-1)/e.maxAnnoLength))+'px;">&nbsp;</div>',c+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+O+"; width:"+Math.round(e.seqAnnWidth*(x[k]-w[k]+1)/e.maxAnnoLength)+'px;" class="icn3d-seqTitle icn3d-link icn3d-blue" domain="'+(u+1).toString()+'" from="'+w+'" to="'+x+'" shorttitle="'+F+'" index="'+u+'" setname="'+K+"_domain_"+u+"_"+b+'" id="'+K+"_domain_"+u+"_"+b+'" anno="sequence" chain="'+K+'" title="'+v+'">'+f+" </div>";else{var P=[],H=[];for(k=0,D=w.length;k<D;++k){P.push(w[k]);for(var N=w[k];N<=x[k];++N)void 0!==e.targetGapHash&&e.targetGapHash.hasOwnProperty(N)&&(H.push(N-1),P.push(N));H.push(x[k])}for(k=0,D=P.length;k<D;++k)c+=e.insertGapOverview(K,P[k]),c+='<div style="display:inline-block; width:'+(Z=0==k?Math.round(e.seqAnnWidth*P[k]/(e.maxAnnoLength+e.nTotalGap)):Math.round(e.seqAnnWidth*(P[k]-H[k-1]-1)/(e.maxAnnoLength+e.nTotalGap)))+'px;">&nbsp;</div>',c+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+O+"; width:"+Math.round(e.seqAnnWidth*(H[k]-P[k]+1)/(e.maxAnnoLength+e.nTotalGap))+'px;" class="icn3d-seqTitle icn3d-link icn3d-blue" domain="'+(u+1).toString()+'" from="'+P+'" to="'+H+'" shorttitle="'+F+'" index="'+u+'" setname="'+K+"_domain_"+u+"_"+b+'" id="'+K+"_domain_"+u+"_"+b+'" anno="sequence" chain="'+K+'" title="'+v+'">'+f+" </div>"}j='<span class="icn3d-residueNum" title="residue count">&nbsp;'+S.toString()+" Residues</span>",j+="</span>",a+=j+="<br>",c+=j,c+='<div id="'+e.pre+K+"_"+p+"_"+b+'_cddseq" style="display:none; white-space:normal;" class="icn3d-box">'+g+' (<a href="https://www.ncbi.nlm.nih.gov/Structure/cdd/cddsrv.cgi?uid='+p+'" target="_blank" class="icn3d-blue">open details view...</a>)</div>'}}a+="</div>",c+="</div>",l+="</div>",$("#"+e.pre+"dt_cdd_"+K).html(a),$("#"+e.pre+"ov_cdd_"+K).html(c),$("#"+e.pre+"tt_cdd_"+K).html(l),c=a='<div id="'+e.pre+K+'_siteseq_sequence" class="icn3d-dl_sequence">',l=a;var z=t.data[r].sites;for(h=void 0!==z?z.length:0,u=0;u<h;++u){var F,U,B,j;f=z[u].srcdom,m=z[u].type,S=z[u].sz,(F="site: "+z[u].title).length>17&&(F=F.substr(0,17)+"..."),v=z[u].title;var G=z[u].locs[0].coords,V=[];for(k=0,D=G.length;k<D;++k)V.push(Math.round(G[k])+e.baseResi[K]);l+=(U='<div class="icn3d-seqTitle icn3d-link icn3d-blue" site="site" posarray="'+V.toString()+'" shorttitle="'+F+'" setname="'+K+"_site_"+u+'" anno="sequence" chain="'+K+'" title="'+v+'">'+F+" </div>")+(B='<span class="icn3d-residueNum" title="residue count">'+S.toString()+" Res</span>")+"<br>",a+=U+B+(j='<span class="icn3d-seqLine">'),c+=U+B+j,R="site"+u.toString();var W=0,q=0;for(k=0,D=e.giSeq[K].length;k<D;++k)if(a+=e.insertGap(K,k,"-"),-1!=G.indexOf(k)){var Y,X,Z;L=Y=e.giSeq[K][k],Y.length>1&&(L=Y[0]+".."),a+='<span id="'+R+"_"+e.pre+K+"_"+(X=k>=e.matchedPos[K]&&k-e.matchedPos[K]<e.icn3d.chainsSeq[K].length?e.icn3d.chainsSeq[K][k-e.matchedPos[K]].resi:e.baseResi[K]+1+k)+'" title="'+L+X+'" class="icn3d-residue">'+Y+"</span>",c+=e.insertGapOverview(K,k),(Z=e.cfg.blast_rep_id==K?Math.round(e.seqAnnWidth*k/(e.maxAnnoLength+e.nTotalGap)-W-q):Math.round(e.seqAnnWidth*k/e.maxAnnoLength-W-q))<0&&(Z=0),c+='<div style="display:inline-block; width:'+Z+'px;">&nbsp;</div>',c+='<div style="display:inline-block; background-color:#000; width:1px;" title="'+L+X+'">&nbsp;</div>',W+=Z,q+=1}else a+="<span>-</span>";j='<span class="icn3d-residueNum" title="residue count">&nbsp;'+S.toString()+" Residues</span>",j+="</span>",a+=j+="<br>",c+=j}a+="</div>",c+="</div>",l+="</div>",$("#"+e.pre+"dt_site_"+K).html(a),$("#"+e.pre+"ov_site_"+K).html(c),$("#"+e.pre+"tt_site_"+K).html(l)}for(var K in e.protein_chainid)n.hasOwnProperty(K)||($("#"+e.pre+"dt_cdd_"+K).html(""),$("#"+e.pre+"ov_cdd_"+K).html(""),$("#"+e.pre+"tt_cdd_"+K).html(""),$("#"+e.pre+"dt_site_"+K).html(""),$("#"+e.pre+"ov_site_"+K).html(""),$("#"+e.pre+"tt_site_"+K).html(""));e.enableHlSeq(),e.bAjaxCddSite=!0,void 0!==e.deferredAnnoCddSite&&e.deferredAnnoCddSite.resolve()},error:function(i,n,r){if(this.tryCount++,this.tryCount<=this.retryLimit)$.ajax(this);else{for(var o in console.log("No CDD data were found for the protein "+t+"..."),e.protein_chainid)$("#"+e.pre+"dt_cdd_"+o).html(""),$("#"+e.pre+"ov_cdd_"+o).html(""),$("#"+e.pre+"tt_cdd_"+o).html(""),$("#"+e.pre+"dt_site_"+o).html(""),$("#"+e.pre+"ov_site_"+o).html(""),$("#"+e.pre+"tt_site_"+o).html("");e.enableHlSeq(),e.bAjaxCddSite=!0,void 0!==e.deferredAnnoCddSite&&e.deferredAnnoCddSite.resolve()}}})},iCn3DUI.prototype.showDomainPerStructure=function(e){var t=this,i=Object.keys(t.icn3d.structures),n=i[e],r="https://www.ncbi.nlm.nih.gov/Structure/mmdb/mmdb_strview.cgi?v=2&program=icn3d&domain&molinfor&uid="+n;if(0==e&&void 0!==t.mmdb_data)for(var o in t.protein_chainid)-1!==o.indexOf(n)&&t.showDomainWithData(o,t.mmdb_data);else if(void 0!==t.mmdb_dataArray[e])for(var o in t.protein_chainid)-1!==o.indexOf(n)&&t.showDomainWithData(o,t.mmdb_dataArray[e]);else $.ajax({url:r,dataType:"json",cache:!0,tryCount:0,retryLimit:1,success:function(r){for(var o in t.mmdb_dataArray[e]=r,t.protein_chainid)-1!==o.indexOf(n)&&t.showDomainWithData(o,t.mmdb_dataArray[e]);if(t.enableHlSeq(),t.bAjax3ddomain=!0,t.bAjaxDoneArray[e]=!0,void 0!==t.deferred3ddomain)if(void 0===t.cfg.align)t.deferred3ddomain.resolve();else{for(var s=!0,a=0,c=i.length;a<c;++a)s=s&&t.bAjaxDoneArray[a];s&&t.deferred3ddomain.resolve()}},error:function(e,r,o){if(this.tryCount++,this.tryCount<=this.retryLimit)$.ajax(this);else{for(var s in console.log("No 3D domain data were found for the protein "+n+"..."),t.protein_chainid)-1!==s.indexOf(n)&&($("#"+t.pre+"dt_domain_"+s).html(""),$("#"+t.pre+"ov_domain_"+s).html(""),$("#"+t.pre+"tt_domain_"+s).html(""));if(t.enableHlSeq(),t.bAjax3ddomain=!0,bAjaxDone1=!0,void 0!==t.deferred3ddomain)if(void 0===t.cfg.align)t.deferred3ddomain.resolve();else{for(var a=!0,c=0,l=i.length;c<l;++c)a=a&&t.bAjaxDoneArray[c];a&&t.deferred3ddomain.resolve()}}}})},iCn3DUI.prototype.showDomainAll=function(){var e=this,t=Object.keys(e.icn3d.structures);e.mmdb_dataArray=[],e.bAjaxDoneArray=[];for(var i=0,n=t.length;i<n;++i)e.bAjaxDoneArray[i]=!1;for(i=0,n=t.length;i<n;++i)e.showDomainPerStructure(i)},iCn3DUI.prototype.showDomainWithData=function(e,t){var i,n,r,o=this,s='<div id="'+o.pre+e+'_domainseq_sequence" class="icn3d-dl_sequence">',a=s,c=s,l=e.indexOf("_"),d=e.substr(l+1),h=t.moleculeInfor;for(var u in h)if(h[u].chain===d){r=u,n=h[u].name;break}void 0!==r&&void 0!==t.domains[r]&&(i=t.domains[r].domains),void 0===i&&(i=[]);for(var p=0,m=i.length;p<m;++p){for(var f="3D domain "+(p+1).toString()+" of "+n,g=f.length>17?f.substr(0,17)+"...":f,v=i[p].intervals,y={},b=[],_=[],w={},x=0,C=0,S=v.length;C<S;++C){var E=Math.round(v[C][0])-1,M=Math.round(v[C][1])-1;if(domainStr=E+","+M,!y.hasOwnProperty(domainStr)){y[domainStr]=1,b.push(E+o.baseResi[e]),_.push(M+o.baseResi[e]),x+=M-E+1;for(var T=E;T<=M;++T)w[T+1]=1}}var A='<div class="icn3d-seqTitle icn3d-link icn3d-blue" 3ddomain="'+(p+1).toString()+'" from="'+b+'" to="'+_+'" shorttitle="'+g+'" index="'+p+'" setname="'+e+"_3d_domain_"+p+'" anno="sequence" chain="'+e+'" title="'+f+'">'+g+" </div>",k='<span class="icn3d-residueNum" title="residue count">'+x.toString()+" Res</span>";c+=A+k+"<br>";var R='<span class="icn3d-seqLine">';s+=A+k+R,a+=A+k+R;var D="domain3d"+p.toString();for(C=0,S=o.giSeq[e].length;C<S;++C)if(s+=o.insertGap(e,C,"-"),w.hasOwnProperty(C+1)){var L=o.giSeq[e][C],I=L;L.length>1&&(I=L[0]+".."),s+='<span id="'+D+"_"+o.pre+e+"_"+(l=C>=o.matchedPos[e]&&C-o.matchedPos[e]<o.icn3d.chainsSeq[e].length?o.icn3d.chainsSeq[e][C-o.matchedPos[e]].resi:o.baseResi[e]+1+C)+'" title="'+I+l+'" class="icn3d-residue">'+L+"</span>"}else s+="<span>-</span>";var O=o.icn3d.getFirstCalphaAtomObj(o.icn3d.chains[e]),P=O.color?O.color.getHexString():o.icn3d.defaultAtomColor;if(o.cfg.blast_rep_id!=e)for(C=0,S=b.length;C<S;++C)a+='<div style="display:inline-block; width:'+(0==C?Math.round(o.seqAnnWidth*b[C]/o.maxAnnoLength):Math.round(o.seqAnnWidth*(b[C]-_[C-1]-1)/o.maxAnnoLength))+'px;">&nbsp;</div>',a+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+P+"; width:"+Math.round(o.seqAnnWidth*(_[C]-b[C]+1)/o.maxAnnoLength)+'px;" class="icn3d-seqTitle icn3d-link icn3d-blue" 3ddomain="'+(p+1).toString()+'" from="'+b+'" to="'+_+'" shorttitle="'+g+'" index="'+p+'" setname="'+e+"_3d_domain_"+p+'" id="'+e+"_3d_domain_"+p+'" anno="sequence" chain="'+e+'" title="'+f+'">3D domain '+(p+1).toString()+"</div>";else{var H=[],N=[];for(C=0,S=b.length;C<S;++C){for(H.push(b[C]),T=b[C];T<=_[C];++T)void 0!==o.targetGapHash&&o.targetGapHash.hasOwnProperty(T)&&(N.push(T-1),H.push(T));N.push(_[C])}for(C=0,S=H.length;C<S;++C)a+=o.insertGapOverview(e,H[C]),a+='<div style="display:inline-block; width:'+(0==C?Math.round(o.seqAnnWidth*H[C]/(o.maxAnnoLength+o.nTotalGap)):Math.round(o.seqAnnWidth*(H[C]-N[C-1]-1)/(o.maxAnnoLength+o.nTotalGap)))+'px;">&nbsp;</div>',a+='<div style="display:inline-block; color:white!important; font-weight:bold; background-color:#'+P+"; width:"+Math.round(o.seqAnnWidth*(N[C]-H[C]+1)/(o.maxAnnoLength+o.nTotalGap))+'px;" class="icn3d-seqTitle icn3d-link icn3d-blue" 3ddomain="'+(p+1).toString()+'" from="'+H+'" to="'+N+'" shorttitle="'+g+'" index="'+p+'" setname="'+e+"_3d_domain_"+p+'" id="'+e+"_3d_domain_"+p+'" anno="sequence" chain="'+e+'" title="'+f+'">3D domain '+(p+1).toString()+"</div>"}R='<span class="icn3d-residueNum" title="residue count">&nbsp;'+x.toString()+" Residues</span>",R+="</span>",s+=R+="<br>",a+=R}s+="</div>",a+="</div>",c+="</div>",$("#"+o.pre+"dt_domain_"+e).html(s),$("#"+o.pre+"ov_domain_"+e).html(a),$("#"+o.pre+"tt_domain_"+e).html(c)},iCn3DUI.prototype.showInteraction=function(e,t){var i=this;void 0!==i.chainname2residues||void 0===i.cfg.mmdbid&&void 0===i.cfg.gi&&void 0===i.cfg.blast_rep_id&&void 0===i.cfg.align?i.showInteraction_base(e,t):setTimeout(function(){i.showInteraction_base(e,t)},1e3)},iCn3DUI.prototype.showInteraction_base=function(e,t){var i=this;void 0===i.chainname2residues&&(i.chainname2residues={});var n=Object.keys(i.icn3d.chains),r=e;if(!((N=Math.round(r.indexOf("_")))>4)){var o=i.icn3d.getFirstCalphaAtomObj(i.icn3d.chains[r]);if(void 0===i.chainname2residues[r]){i.chainname2residues[r]={};var s=n.length;if(s>100&&void 0===i.cfg.mmdbid&&void 0===i.cfg.gi&&void 0===i.cfg.blast_rep_id&&void 0===i.cfg.align)return $("#"+i.pre+"dt_interaction_"+e).html(""),void $("#"+i.pre+"ov_interaction_"+e).html("");for(var a=0;a<s;++a){var c=n[a];if(c!==r&&c.substr(0,c.indexOf("_"))===r.substr(0,r.indexOf("_"))&&!((N=Math.round(r.indexOf("_")))>4)){var l,d=i.icn3d.getFirstCalphaAtomObj(i.icn3d.chains[c]);i.icn3d.chemicals.hasOwnProperty(d.serial)?l="chemical":i.icn3d.nucleotides.hasOwnProperty(d.serial)?l="nucleotide":i.icn3d.ions.hasOwnProperty(d.serial)?l="ion":i.icn3d.proteins.hasOwnProperty(d.serial)?l="protein":i.icn3d.water.hasOwnProperty(d.serial)&&(l="water");var h=i.icn3d.getAtomsWithinAtom(i.icn3d.hash2Atoms(i.icn3d.chains[r]),i.icn3d.hash2Atoms(i.icn3d.chains[c]),4);if(0!=Object.keys(h).length){var u={};for(var p in h)u[(o=i.icn3d.atoms[p]).structure+"_"+o.chain+"_"+o.resi]=1;var m=c.substr(c.indexOf("_")+1)+" ("+l+")";i.chainname2residues[r][m]=Object.keys(u)}}}}var f='<div id="'+i.pre+e+'_interseq_sequence" class="icn3d-dl_sequence">',g=f,v=f,y=0;for(var b in i.chainname2residues[e]){var _=i.chainname2residues[e][b],w="Interact ."+b;w.length>17&&(w=w.substr(0,17)+"...");for(var x="Interact ."+b,C=[],S=0,E=_.length;S<E;++S){var M=_[S],T=Math.round(M.substr(_[S].lastIndexOf("_")+1)),A=Object.keys(i.icn3d.residues[M])[0];(i.icn3d.proteins.hasOwnProperty(A)||i.icn3d.nucleotides.hasOwnProperty(A))&&C.push(T)}var k=C.length;if(0!=k){var R=b.replace(/\s/g,""),D='<div class="icn3d-seqTitle icn3d-link icn3d-blue" interaction="'+(y+1).toString()+'" posarray="'+C.toString()+'" shorttitle="'+w+'" setname="'+e+"_"+R+'" anno="sequence" chain="'+e+'" title="'+x+'">'+w+" </div>",L='<span class="icn3d-residueNum" title="residue count">'+k.toString()+" Res</span>";v+=D+L+"<br>";var I='<span class="icn3d-seqLine">';f+=D+L+I,g+=D+L+I;var O="inter"+y.toString(),P=0,H=0;for(S=0,E=i.giSeq[e].length;S<E;++S)if(f+=i.insertGap(e,S,"-"),-1!=C.indexOf(S+1+i.baseResi[e])){var N,z=i.giSeq[e][S],F=z;z.length>1&&(F=z[0]+".."),f+='<span id="'+O+"_"+i.pre+e+"_"+(N=S>=i.matchedPos[e]&&S-i.matchedPos[e]<i.icn3d.chainsSeq[e].length?i.icn3d.chainsSeq[e][S-i.matchedPos[e]].resi:i.baseResi[e]+1+S)+'" title="'+z+N+'" class="icn3d-residue">'+F+"</span>",g+=i.insertGapOverview(e,S);var U=i.cfg.blast_rep_id==e?Math.round(i.seqAnnWidth*S/(i.maxAnnoLength+i.nTotalGap)-P-H):Math.round(i.seqAnnWidth*S/i.maxAnnoLength-P-H);U<0&&(U=0),g+='<div style="display:inline-block; width:'+U+'px;">&nbsp;</div>',g+='<div style="display:inline-block; background-color:#000; width:1px;" title="'+F+N+'">&nbsp;</div>',P+=U,H+=1}else f+="<span>-</span>";I='<span class="icn3d-residueNum" title="residue count">&nbsp;'+k.toString()+" Residues</span>",I+="</span>",f+=I+="<br>",g+=I,++y}}f+="</div>",g+="</div>",v+="</div>",$("#"+i.pre+"dt_interaction_"+e).html(f),$("#"+i.pre+"ov_interaction_"+e).html(g),$("#"+i.pre+"tt_interaction_"+e).html(v),i.isMobile()?(i.selectSequenceMobile(),i.selectChainMobile()):i.selectSequenceNonMobile()}},iCn3DUI.prototype.showSsbond=function(e,t){var i=this;void 0===i.icn3d.ssbondpnts?setTimeout(function(){i.showSsbond_base(e,t)},1e3):i.showSsbond_base(e,t)},iCn3DUI.prototype.showSsbond_base=function(e,t){var i=this,n=(Object.keys(i.icn3d.chains),t),r=(i.icn3d.getFirstCalphaAtomObj(i.icn3d.chains[n]),'<div id="'+i.pre+e+'_ssbondseq_sequence" class="icn3d-dl_sequence">'),o=r,s=r,a={},c=n.substr(0,n.indexOf("_")),l=i.icn3d.ssbondpnts[c];if(void 0===l)return $("#"+i.pre+"dt_ssbond_"+e).html(""),$("#"+i.pre+"ov_ssbond_"+e).html(""),void $("#"+i.pre+"tt_ssbond_"+e).html("");for(var d=0,h=l.length;d<h;d+=2){var u=l[d],p=l[d+1],m=u.substr(0,u.lastIndexOf("_")),f=p.substr(0,p.lastIndexOf("_"));n===m&&(void 0===a[u]&&(a[u]=[]),a[u].push(p)),n===f&&(void 0===a[p]&&(a[p]=[]),a[p].push(u))}var g=Object.keys(a);(R="Disulfide Bonds").length>17&&(R=R.substr(0,17)+"...");var v=R,y=[];for(d=0,h=g.length;d<h;++d){var b=g[d],_=Math.round(b.substr(g[d].lastIndexOf("_")+1));y.push(_)}if(0===y.length)return $("#"+i.pre+"dt_ssbond_"+e).html(""),$("#"+i.pre+"ov_ssbond_"+e).html(""),void $("#"+i.pre+"tt_ssbond_"+e).html("");var w=y.length,x='<div class="icn3d-seqTitle icn3d-link icn3d-blue" ssbond="" posarray="'+y.toString()+'" shorttitle="'+R+'" setname="'+e+'_ssbond" anno="sequence" chain="'+e+'" title="'+v+'">'+R+" </div>",C='<span class="icn3d-residueNum" title="residue count">'+w.toString()+" Res</span>";s+=x+C+"<br>";var S='<span class="icn3d-seqLine">';r+=x+C+S,o+=x+C+S;var E=0,M=0;for(d=0,h=i.giSeq[e].length;d<h;++d)if(r+=i.insertGap(e,d,"-"),-1!=y.indexOf(d+1+i.baseResi[e])){var T=i.giSeq[e][d],A=T;T.length>1&&(A=T[0]+"..");var k=d>=i.matchedPos[e]&&d-i.matchedPos[e]<i.icn3d.chainsSeq[e].length?i.icn3d.chainsSeq[e][d-i.matchedPos[e]].resi:i.baseResi[e]+1+d,R="Residue "+(b=e+"_"+(d+1+i.baseResi[e]).toString())+" has disulfide bond with";if(void 0!==a[b])for(var D=0,L=a[b].length;D<L;++D)R+=" residue "+a[b][D];r+='<span id="ssbond_'+i.pre+e+"_"+k+'" title="'+R+'" class="icn3d-residue">'+A+"</span>",o+=i.insertGapOverview(e,d);var I=i.cfg.blast_rep_id==e?Math.round(i.seqAnnWidth*d/(i.maxAnnoLength+i.nTotalGap)-E-M):Math.round(i.seqAnnWidth*d/i.maxAnnoLength-E-M);I<0&&(I=0),o+='<div style="display:inline-block; width:'+I+'px;">&nbsp;</div>',o+='<div style="display:inline-block; background-color:#000; width:1px;" title="'+R+'">&nbsp;</div>',E+=I,M+=1}else r+="<span>-</span>";S='<span class="icn3d-residueNum" title="residue count">&nbsp;'+w.toString()+" Residues</span>",S+="</span>",r+=S+="<br>",o+=S,r+="</div>",o+="</div>",s+="</div>",$("#"+i.pre+"dt_ssbond_"+e).html(r),$("#"+i.pre+"ov_ssbond_"+e).html(o),$("#"+i.pre+"tt_ssbond_"+e).html(s)},iCn3DUI.prototype.hideAllAnno=function(){var e=this;$("[id^="+e.pre+"site]").hide(),$("[id^="+e.pre+"snp]").hide(),$("[id^="+e.pre+"clinvar]").hide(),$("[id^="+e.pre+"cdd]").hide(),$("[id^="+e.pre+"domain]").hide(),$("[id^="+e.pre+"interaction]").hide(),$("[id^="+e.pre+"custom]").hide(),$("[id^="+e.pre+"ssbond]").hide()},iCn3DUI.prototype.setAnnoTabAll=function(){var e=this;$("#"+e.pre+"anno_all").length&&($("#"+e.pre+"anno_all")[0].checked=!0),$("#"+e.pre+"anno_binding").length&&($("#"+e.pre+"anno_binding")[0].checked=!0),$("#"+e.pre+"anno_snp").length&&($("#"+e.pre+"anno_snp")[0].checked=!0),$("#"+e.pre+"anno_clinvar").length&&($("#"+e.pre+"anno_clinvar")[0].checked=!0),$("#"+e.pre+"anno_cdd").length&&($("#"+e.pre+"anno_cdd")[0].checked=!0),$("#"+e.pre+"anno_3dd").length&&($("#"+e.pre+"anno_3dd")[0].checked=!0),$("#"+e.pre+"anno_interact").length&&($("#"+e.pre+"anno_interact")[0].checked=!0),$("#"+e.pre+"anno_custom").length&&($("#"+e.pre+"anno_custom")[0].checked=!0),$("#"+e.pre+"anno_ssbond").length&&($("#"+e.pre+"anno_ssbond")[0].checked=!0),$("[id^="+e.pre+"site]").show(),$("[id^="+e.pre+"snp]").show(),$("[id^="+e.pre+"clinvar]").show(),$("[id^="+e.pre+"cdd]").show(),$("[id^="+e.pre+"domain]").show(),$("[id^="+e.pre+"interaction]").show(),$("[id^="+e.pre+"custom]").show(),$("[id^="+e.pre+"ssbond]").show(),e.updateSnpClinvar(),e.updateDomain(),e.updateInteraction(),e.updateSsbond()},iCn3DUI.prototype.hideAnnoTabAll=function(){var e=this;$("#"+e.pre+"anno_all").length&&($("#"+e.pre+"anno_all")[0].checked=!1),$("#"+e.pre+"anno_binding").length&&($("#"+e.pre+"anno_binding")[0].checked=!1),$("#"+e.pre+"anno_snp").length&&($("#"+e.pre+"anno_snp")[0].checked=!1),$("#"+e.pre+"anno_clinvar").length&&($("#"+e.pre+"anno_clinvar")[0].checked=!1),$("#"+e.pre+"anno_cdd").length&&($("#"+e.pre+"anno_cdd")[0].checked=!1),$("#"+e.pre+"anno_3dd").length&&($("#"+e.pre+"anno_3dd")[0].checked=!1),$("#"+e.pre+"anno_interact").length&&($("#"+e.pre+"anno_interact")[0].checked=!1),$("#"+e.pre+"anno_custom").length&&($("#"+e.pre+"anno_custom")[0].checked=!1),$("#"+e.pre+"anno_ssbond").length&&($("#"+e.pre+"anno_ssbond")[0].checked=!1),e.hideAllAnno()},iCn3DUI.prototype.setAnnoTabCustom=function(){$("[id^="+this.pre+"custom]").show(),$("#"+this.pre+"anno_custom").length&&($("#"+this.pre+"anno_custom")[0].checked=!0)},iCn3DUI.prototype.hideAnnoTabCustom=function(){$("[id^="+this.pre+"custom]").hide(),$("#"+this.pre+"anno_custom").length&&($("#"+this.pre+"anno_custom")[0].checked=!1)},iCn3DUI.prototype.setAnnoTabClinvar=function(){$("[id^="+this.pre+"clinvar]").show(),$("#"+this.pre+"anno_clinvar").length&&($("#"+this.pre+"anno_clinvar")[0].checked=!0),this.updateSnpClinvar()},iCn3DUI.prototype.hideAnnoTabClinvar=function(){$("[id^="+this.pre+"clinvar]").hide(),$("#"+this.pre+"anno_clinvar").length&&($("#"+this.pre+"anno_clinvar")[0].checked=!1)},iCn3DUI.prototype.setAnnoTabSnp=function(){$("[id^="+this.pre+"snp]").show(),$("#"+this.pre+"anno_snp").length&&($("#"+this.pre+"anno_snp")[0].checked=!0),this.updateSnpClinvar()},iCn3DUI.prototype.hideAnnoTabSnp=function(){$("[id^="+this.pre+"snp]").hide(),$("#"+this.pre+"anno_snp").length&&($("#"+this.pre+"anno_snp")[0].checked=!1)},iCn3DUI.prototype.setAnnoTabCdd=function(){$("[id^="+this.pre+"cdd]").show(),$("#"+this.pre+"anno_cdd").length&&($("#"+this.pre+"anno_cdd")[0].checked=!0)},iCn3DUI.prototype.hideAnnoTabCdd=function(){$("[id^="+this.pre+"cdd]").hide(),$("#"+this.pre+"anno_cdd").length&&($("#"+this.pre+"anno_cdd")[0].checked=!1)},iCn3DUI.prototype.setAnnoTab3ddomain=function(){$("[id^="+this.pre+"domain]").show(),$("#"+this.pre+"anno_3dd").length&&($("#"+this.pre+"anno_3dd")[0].checked=!0),this.updateDomain()},iCn3DUI.prototype.hideAnnoTab3ddomain=function(){$("[id^="+this.pre+"domain]").hide(),$("#"+this.pre+"anno_3dd").length&&($("#"+this.pre+"anno_3dd")[0].checked=!1)},iCn3DUI.prototype.setAnnoTabSite=function(){$("[id^="+this.pre+"site]").show(),$("#"+this.pre+"anno_binding").length&&($("#"+this.pre+"anno_binding")[0].checked=!0)},iCn3DUI.prototype.hideAnnoTabSite=function(){$("[id^="+this.pre+"site]").hide(),$("#"+this.pre+"anno_binding").length&&($("#"+this.pre+"anno_binding")[0].checked=!1)},iCn3DUI.prototype.setAnnoTabInteraction=function(){$("[id^="+this.pre+"interaction]").show(),$("#"+this.pre+"anno_interact").length&&($("#"+this.pre+"anno_interact")[0].checked=!0),this.updateInteraction()},iCn3DUI.prototype.hideAnnoTabInteraction=function(){$("[id^="+this.pre+"interaction]").hide(),$("#"+this.pre+"anno_interact").length&&($("#"+this.pre+"anno_interact")[0].checked=!1)},iCn3DUI.prototype.setAnnoTabSsbond=function(){$("[id^="+this.pre+"ssbond]").show(),$("#"+this.pre+"anno_ssbond").length&&($("#"+this.pre+"anno_ssbond")[0].checked=!0),this.updateSsbond()},iCn3DUI.prototype.hideAnnoTabSsbond=function(){$("[id^="+this.pre+"ssbond]").hide(),$("#"+this.pre+"anno_ssbond").length&&($("#"+this.pre+"anno_ssbond")[0].checked=!1)},iCn3DUI.prototype.setTabs=function(){var e=this;$("#"+e.pre+"dl_addtrack_tabs").tabs(),$("#"+e.pre+"dl_anno_view_tabs").tabs(),$("#"+e.pre+"anno_all").click(function(t){$("#"+e.pre+"anno_all")[0].checked?(e.setAnnoTabAll(),e.setLogCmd("set annotation all",!0)):(e.hideAnnoTabAll(),e.setLogCmd("hide annotation all",!0))}),$("#"+e.pre+"anno_binding").click(function(t){$("#"+e.pre+"anno_binding")[0].checked?(e.setAnnoTabSite(),e.setLogCmd("set annotation site",!0)):(e.hideAnnoTabSite(),e.setLogCmd("hide annotation site",!0))}),$("#"+e.pre+"anno_snp").click(function(t){$("#"+e.pre+"anno_snp")[0].checked?(e.setAnnoTabSnp(),e.setLogCmd("set annotation snp",!0)):(e.hideAnnoTabSnp(),e.setLogCmd("hide annotation snp",!0))}),$("#"+e.pre+"anno_clinvar").click(function(t){$("#"+e.pre+"anno_clinvar")[0].checked?(e.setAnnoTabClinvar(),e.setLogCmd("set annotation clinvar",!0)):(e.hideAnnoTabClinvar(),e.setLogCmd("hide annotation clinvar",!0))}),$("#"+e.pre+"anno_cdd").click(function(t){e.clickCdd()}),$("#"+e.pre+"anno_3dd").click(function(t){$("#"+e.pre+"anno_3dd")[0].checked?(e.setAnnoTab3ddomain(),e.setLogCmd("set annotation 3ddomain",!0)):(e.hideAnnoTab3ddomain(),e.setLogCmd("hide annotation 3ddomain",!0))}),$("#"+e.pre+"anno_interact").click(function(t){$("#"+e.pre+"anno_interact")[0].checked?(e.setAnnoTabInteraction(),e.setLogCmd("set annotation interaction",!0)):(e.hideAnnoTabInteraction(),e.setLogCmd("hide annotation interaction",!0))}),$("#"+e.pre+"anno_custom").click(function(t){$("#"+e.pre+"anno_custom")[0].checked?(e.setAnnoTabCustom(),e.setLogCmd("set annotation custom",!0)):(e.hideAnnoTabCustom(),e.setLogCmd("hide annotation custom",!0))}),$("#"+e.pre+"anno_ssbond").click(function(t){$("#"+e.pre+"anno_ssbond")[0].checked?(e.setAnnoTabSsbond(),e.setLogCmd("set annotation ssbond",!0)):(e.hideAnnoTabSsbond(),e.setLogCmd("hide annotation ssbond",!0))})},iCn3DUI.prototype.clickCdd=function(){var e=this;$("[id^="+e.pre+"cdd]").length>0&&($("#"+e.pre+"anno_cdd")[0].checked?(e.setAnnoTabCdd(),e.setLogCmd("set annotation cdd",!0)):(e.hideAnnoTabCdd(),e.setLogCmd("hide annotation cdd",!0)))},iCn3DUI.prototype.setToolTip=function(){$("[id^="+this.pre+"snp]").add("[id^="+this.pre+"clinvar]").add("[id^="+this.pre+"ssbond]").tooltip({content:function(){return $(this).prop("title")},show:null,close:function(e,t){t.tooltip.hover(function(){$(this).stop(!0).fadeTo(400,1)},function(){$(this).fadeOut("200",function(){$(this).remove()})})}})},iCn3DUI.prototype.showAnnoSelectedChains=function(){var e=this,t={};for(var i in e.icn3d.hAtoms)t[n=(r=e.icn3d.atoms[i]).structure+"_"+r.chain]=1;for(var n in $("#"+e.pre+"dl_annotations > .icn3d-annotation").hide(),t){$("#"+e.pre+"anno_"+n).length&&$("#"+e.pre+"anno_"+n).show();var r=e.icn3d.getFirstCalphaAtomObj(e.icn3d.chains[n]),o=e.icn3d.residueName2Abbr(r.resn.substr(0,3));$("#"+e.pre+"anno_"+o).show()}},iCn3DUI.prototype.showAnnoAllChains=function(){$("#"+this.pre+"dl_annotations > .icn3d-annotation").show()},iCn3DUI.prototype.setAnnoView=function(e){"detailed view"===e?(this.view="detailed view",$("#"+this.pre+"dl_anno_view_tabs").tabs("option","active",1)):(this.view="overview",$("#"+this.pre+"dl_anno_view_tabs").tabs("option","active",0))},iCn3DUI.prototype.showFixedTitle=function(){var e=this,t="display:block;";$("[id^="+e.pre+"tt_giseq]").attr("style",t),$("[id^="+e.pre+"tt_custom]").attr("style",t),$("[id^="+e.pre+"tt_site]").attr("style",t),$("[id^="+e.pre+"tt_snp]").attr("style",t),$("[id^="+e.pre+"tt_clinvar]").attr("style",t),$("[id^="+e.pre+"tt_cdd]").attr("style",t),$("[id^="+e.pre+"tt_domain]").attr("style",t),$("[id^="+e.pre+"tt_interaction]").attr("style",t),$("[id^="+e.pre+"tt_ssbond]").attr("style",t)},iCn3DUI.prototype.hideFixedTitle=function(){var e=this,t="display:none!important;";$("[id^="+e.pre+"tt_giseq]").attr("style",t),$("[id^="+e.pre+"tt_custom]").attr("style",t),$("[id^="+e.pre+"tt_site]").attr("style",t),$("[id^="+e.pre+"tt_snp]").attr("style",t),$("[id^="+e.pre+"tt_clinvar]").attr("style",t),$("[id^="+e.pre+"tt_cdd]").attr("style",t),$("[id^="+e.pre+"tt_domain]").attr("style",t),$("[id^="+e.pre+"tt_interaction]").attr("style",t),$("[id^="+e.pre+"tt_ssbond]").attr("style",t)},iCn3DUI.prototype.setAnnoViewAndDisplay=function(e){var t=this;if("detailed view"===e){t.setAnnoView("detailed view");var i="display:block;";$("[id^="+t.pre+"dt_giseq]").attr("style",i),$("[id^="+t.pre+"dt_custom]").attr("style",i),$("[id^="+t.pre+"dt_site]").attr("style",i),$("[id^="+t.pre+"dt_snp]").attr("style",i),$("[id^="+t.pre+"dt_clinvar]").attr("style",i),$("[id^="+t.pre+"dt_cdd]").attr("style",i),$("[id^="+t.pre+"dt_domain]").attr("style",i),$("[id^="+t.pre+"dt_interaction]").attr("style",i),$("[id^="+t.pre+"dt_ssbond]").attr("style",i),$("#"+t.pre+"seqguide_wrapper").attr("style",i),i="display:none;",$("[id^="+t.pre+"ov_giseq]").attr("style",i),$("[id^="+t.pre+"ov_custom]").attr("style",i),$("[id^="+t.pre+"ov_site]").attr("style",i),$("[id^="+t.pre+"ov_snp]").attr("style",i),$("[id^="+t.pre+"ov_clinvar]").attr("style",i),$("[id^="+t.pre+"ov_cdd]").attr("style",i),$("[id^="+t.pre+"ov_domain]").attr("style",i),$("[id^="+t.pre+"ov_interaction]").attr("style",i),$("[id^="+t.pre+"ov_ssbond]").attr("style",i)}else t.setAnnoView("overview"),t.hideFixedTitle(),i="display:none;",$("[id^="+t.pre+"dt_giseq]").attr("style",i),$("[id^="+t.pre+"dt_custom]").attr("style",i),$("[id^="+t.pre+"dt_site]").attr("style",i),$("[id^="+t.pre+"dt_snp]").attr("style",i),$("[id^="+t.pre+"dt_clinvar]").attr("style",i),$("[id^="+t.pre+"dt_cdd]").attr("style",i),$("[id^="+t.pre+"dt_domain]").attr("style",i),$("[id^="+t.pre+"dt_interaction]").attr("style",i),$("[id^="+t.pre+"dt_ssbond]").attr("style",i),$("#"+t.pre+"seqguide_wrapper").attr("style",i),i="display:block;",$("[id^="+t.pre+"ov_giseq]").attr("style",i),$("[id^="+t.pre+"ov_custom]").attr("style",i),$("[id^="+t.pre+"ov_site]").attr("style",i),$("[id^="+t.pre+"ov_snp]").attr("style",i),$("[id^="+t.pre+"ov_clinvar]").attr("style",i),$("[id^="+t.pre+"ov_cdd]").attr("style",i),$("[id^="+t.pre+"ov_domain]").attr("style",i),$("[id^="+t.pre+"ov_interaction]").attr("style",i),$("[id^="+t.pre+"ov_ssbond]").attr("style",i)},iCn3DUI.prototype.clickAddTrack=function(){var e=this;$(document).on("click",".icn3d-addtrack",function(t){t.stopImmediatePropagation(),$("#"+e.pre+"anno_custom")[0].checked=!0,$("[id^="+e.pre+"custom]").show();var i=$(this).attr("chainid");$("#"+e.pre+"track_chainid").val(i),e.openDialog(e.pre+"dl_addtrack","Add track for Chain: "+i),$("#"+e.pre+"track_gi").focus()})},iCn3DUI.prototype.clickDefineHelix=function(){var e=this;$(document).on("click",".icn3d-helixsets",function(t){t.stopImmediatePropagation();var i=$(this).attr("chainid");e.defineSecondary(i,"helix"),e.setLogCmd("define helix sets | chain "+i,!0)})},iCn3DUI.prototype.clickDefineSheet=function(){var e=this;$(document).on("click",".icn3d-sheetsets",function(t){t.stopImmediatePropagation();var i=$(this).attr("chainid");e.defineSecondary(i,"sheet"),e.setLogCmd("define sheet sets | chain "+i,!0)})},iCn3DUI.prototype.clickDefineCoil=function(){var e=this;$(document).on("click",".icn3d-coilsets",function(t){t.stopImmediatePropagation();var i=$(this).attr("chainid");e.defineSecondary(i,"coil"),e.setLogCmd("define coil sets | chain "+i,!0)})},iCn3DUI.prototype.clickDeleteSets=function(){var e=this;$("#"+e.pre+"deletesets").click(function(t){e.deleteSelectedSets(),e.setLogCmd("delete selected sets",!0)})},iCn3DUI.prototype.defineSecondary=function(e,t){var i=this;$("#"+i.pre+"dl_definedsets").hasClass("ui-dialog-content")&&$("#"+i.pre+"dl_definedsets").dialog("isOpen")||i.openDialog(i.pre+"dl_definedsets","Select sets");var n,r,o={},s=!1,a=0,c=0,l=e+"_C(Nterm";i.icn3d.hAtoms={};for(var d=0,h=i.icn3d.chainsSeq[e].length;d<h;++d){var u=e+"_"+i.icn3d.chainsSeq[e][d].resi;if(i.icn3d.residues.hasOwnProperty(u)){var p=i.icn3d.getFirstCalphaAtomObj(i.icn3d.residues[u]);currSS=i.icn3d.secondaries[u],"H"==currSS?(p.ssbegin&&(++a,Object.keys(o).length>0&&(r=n+"H"+a+")","coil"==t&&(i.selectResidueList(o,r,r,s,!0),s||(s=!0)),o={})),n=e+"_H"+a,o[u]=1,p.ssend&&(l=e+"_C(H"+a,"helix"==t&&(i.selectResidueList(o,n,n,s,!0),s||(s=!0)),o={})):"E"==currSS?(p.ssbegin&&(++c,Object.keys(o).length>0&&(r=n+"S"+c+")","coil"==t&&(i.selectResidueList(o,r,r,s,!0),s||(s=!0)),o={})),n=e+"_S"+c,o[u]=1,p.ssend&&(l=e+"_C(S"+c,"sheet"==t&&(i.selectResidueList(o,n,n,s,!0),s||(s=!0)),o={})):(n=l+"-",o[u]=1)}}Object.keys(o).length>0&&(r=n+"Cterm)","coil"==t&&i.selectResidueList(o,r,r,s,!0))},iCn3DUI.prototype.simplifyText=function(e){var t,i="",n=!1,r=-1;for(t=0,il=e.length;t<il;++t)"-"==e[t]||" "==e[t]?(n&&t!==r&&(i+=r+1==t-1?(r+1+1).toString()+" "+e.substr(r+1,t-1-r)+", ":(r+1+1).toString()+"-"+(t-1+1).toString()+" "+e.substr(r+1,t-1-r)+", ",n=!1),r=t):n=!0;return n&&t==il&&(i+=r+1==t-1?(r+1+1).toString()+" "+e.substr(r+1,t-1-r)+", ":(r+1+1).toString()+"-"+(t-1+1).toString()+" "+e.substr(r+1,t-1-r)+", "),i},iCn3DUI.prototype.alignSequenceToStructure=function(e,t,i){var n,r;void 0!==t.data&&(n=t.data[0].query,r=(r=t.data[0].targets[e.replace(/_/g,"")]).hsps[0]);var o="";if(void 0!==n&&void 0!==r){var s=r.scores.e_value.toPrecision(2);s>1e-200&&(s=parseFloat(s).toExponential());for(var a=t.targets[e.replace(/_/g,"")].seqdata,c=n.seqdata,l=r.segs,d={},h=0,u=l.length;h<u;++h)for(var p=l[h],m=0;m<=p.orito-p.orifrom;++m)d[m+p.orifrom]=m+p.from;for(h=0,u=a.length;h<u;++h)d.hasOwnProperty(h)?o+=c[d[h]]:o+="-";i+=", E: "+s}else o+="cannot be aligned";this.showNewTrack(e,i,o,void 0,d),this.setLogCmd("add track | chainid "+e+" | title "+i+" | text "+this.simplifyText(o),!0)},iCn3DUI.prototype.clickAddTrackButton=function(){var e=this;$(document).on("click","#"+e.pre+"addtrack_button1",function(t){t.stopImmediatePropagation(),dialog.dialog("close");var i=$("#"+e.pre+"track_chainid").val(),n=$("#"+e.pre+"track_gi").val(),r=isNaN(n)?"Acc "+n:"gi "+n;$.ajax({url:"https://www.ncbi.nlm.nih.gov/Structure/pwaln/pwaln.fcgi?from=track",type:"POST",data:{targets:i,queries:n},dataType:"jsonp",tryCount:0,retryLimit:1,success:function(t){e.alignSequenceToStructure(i,t,r)},error:function(e,t,i){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})}),$(document).on("click","#"+e.pre+"addtrack_button2",function(t){t.stopImmediatePropagation(),dialog.dialog("close");var i=$("#"+e.pre+"track_chainid").val(),n=$("#"+e.pre+"track_fasta").val(),r="fasta "+n.substr(0,5);$.ajax({url:"https://www.ncbi.nlm.nih.gov/Structure/pwaln/pwaln.fcgi?from=track",type:"POST",data:{targets:i,queries:n},dataType:"jsonp",tryCount:0,retryLimit:1,success:function(t){e.alignSequenceToStructure(i,t,r)},error:function(e,t,i){this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)}})}),$(document).on("click","#"+e.pre+"addtrack_button3",function(t){t.stopImmediatePropagation(),dialog.dialog("close");var i=$("#"+e.pre+"track_chainid").val(),n=$("#"+e.pre+"track_bed")[0].files[0];if(n){window.File&&window.FileReader&&window.FileList&&window.Blob||alert("The File APIs are not fully supported in this browser.");var r=new FileReader;r.onload=function(t){for(var n,r=t.target.result.split("\n"),o=!1,s=!1,a=0,c=r.length;a<c;++a)if("browser"!=r[a].substr(0,7))if("track"==r[a].substr(0,5)){if(-1!=r[a].toLowerCase().indexOf("itemrgb")&&(o=!0),-1!=r[a].toLowerCase().indexOf("colorbystrand=")){s=!0;var l=r[a].toLowerCase().indexOf("colorbystrand="),d=r[a].substr(l),h=d.indexOf('"');if(-1!=h){var u=d.substr(h+1),p=u.indexOf('"');-1!=h&&(n=u.substr(0,p).split(" "))}}}else{if(""==r[a])continue;var m=r[a].replace(/\s+/g," ").split(" ");(m.length>8||m.length<6)&&(s=!1),m.length<9&&(o=!1);var f=m[1];if(m.length>5)var g=m[5];if(m.length>8)var v=m[8];var y=m[3],b="51,51,51";o?b=v:s&&("+"==g&&n.length>0?b=n[0]:"-"==g&&n.length>1?b=n[1]:"."==g&&n.length>2&&(b=n[2]));for(var _="",w=[],x=0,C=m[2];x<C;++x)x<f?(_+="-",w.push("")):(_+=e.giSeq[i][x],w.push("rgb("+b+")"));e.showNewTrack(i,y,_,w),e.setLogCmd("add track | chainid "+i+" | title "+y+" | text "+e.simplifyText(_),!0)}},r.readAsText(n)}else alert("Please select a file...")}),$(document).on("click","#"+e.pre+"addtrack_button4",function(t){t.stopImmediatePropagation(),dialog.dialog("close");var i=$("#"+e.pre+"track_chainid").val(),n=$("#"+e.pre+"track_title").val(),r=$("#"+e.pre+"track_text").val();e.showNewTrack(i,n,e.getFullText(r)),e.setLogCmd("add track | chainid "+i+" | title "+n+" | text "+r,!0)}),$(document).on("click","#"+e.pre+"addtrack_button5",function(t){t.stopImmediatePropagation(),dialog.dialog("close");for(var i=$("#"+e.pre+"track_chainid").val(),n=$("#"+e.pre+"track_selection").val(),r="",o=e.icn3d.intHash(e.icn3d.hAtoms,e.icn3d.chains[i]),s=e.icn3d.getResiduesFromCalphaAtoms(o),a=[],c=0,l=e.giSeq[i].length;c<l;++c){var d=e.giSeq[i][c],h=d;d.length>1&&(h=d[0]);var u=c>=e.matchedPos[i]&&c-e.matchedPos[i]<e.icn3d.chainsSeq[i].length?e.icn3d.chainsSeq[i][c-e.matchedPos[i]].resi:e.baseResi[i]+1+c;if(s.hasOwnProperty(i+"_"+u)){var p=e.icn3d.getFirstCalphaAtomObj(e.icn3d.residues[i+"_"+u]).color.getHexString();r+=h,a.push("#"+p)}else r+="-",a.push("")}e.showNewTrack(i,n,r,a),e.setLogCmd("add track | chainid "+i+" | title "+n+" | text "+e.simplifyText(r),!0)})},iCn3DUI.prototype.showNewTrack=function(e,t,i,n,r){var o=this,s=!1;"cannot be aligned"==i&&(s=!0);var a=i.replace(/-/g,"").length;if(a>o.giSeq[e].length&&(a=o.giSeq[e].length),i.length>o.giSeq[e].length)i=i.substr(0,o.giSeq[e].length);else if(i.length<o.giSeq[e].length&&!s){for(var c="",l=0,d=o.giSeq[e].length-i.length;l<d;++l)c+="-";i+=c}var h=t.replace(/\s/g,"_").replace(/\./g,"dot").replace(/\W/g,"");h.length>20&&(h=h.substr(0,20));var u=o.RESIDUE_WIDTH*i.length+200;$("#"+o.pre+"dt_custom_"+e).append("<div id='"+o.pre+"dt_custom_"+e+"_"+h+"'></div>"),$("#"+o.pre+"dt_custom_"+e+"_"+h).width(u),$("#"+o.pre+"ov_custom_"+e).append("<div id='"+o.pre+"ov_custom_"+e+"_"+h+"'></div>"),$("#"+o.pre+"ov_custom_"+e+"_"+h).width(u),$("#"+o.pre+"tt_custom_"+e).append("<div id='"+o.pre+"tt_custom_"+e+"_"+h+"'></div>"),$("#"+o.pre+"tt_custom_"+e+"_"+h).width(u);var p='<div id="'+o.pre+'giseq_sequence" class="icn3d-dl_sequence">',m=p,f=p,g='<div class="icn3d-seqTitle" gi="'+e+'" anno="sequence" chain="'+e+'"><span style="white-space:nowrap;">'+t+"</span></div>",v='<span class="icn3d-residueNum" title="residue count">'+a.toString()+" Pos</span>";f+=g+v+"<br>",p+=g+v+(E='<span class="icn3d-seqLine">'),m+=g+v+E;var y=e.indexOf("_"),b="cst"+e.substr(y),_=0,w=0;for(l=0,d=i.length;l<d;++l){p+=o.insertGap(e,l,"-");var x=i.charAt(l);if(" "!=x&&"-"!=x){var C=o.icn3d.chainsSeq[e][l].resi-o.matchedPos[e];void 0!==r&&(C=r[l]+1),p+=void 0!==n&&""!=n[l]?'<span id="'+b+"_"+o.pre+e+"_"+C+'" title="'+x+C+'" class="icn3d-residue" style="color:'+n[l]+'">'+x+"</span>":'<span id="'+b+"_"+o.pre+e+"_"+C+'" title="'+x+C+'" class="icn3d-residue">'+x+"</span>",m+=o.insertGapOverview(e,l);var S=o.cfg.blast_rep_id==e?Math.round(o.seqAnnWidth*l/(o.maxAnnoLength+o.nTotalGap)-_-w):Math.round(o.seqAnnWidth*l/o.maxAnnoLength-_-w);S<0&&(S=0),m+='<div style="display:inline-block; width:'+S+'px;">&nbsp;</div>',m+=void 0!==n&&""!=n[l]?'<div style="display:inline-block; background-color:'+n[l]+'; width:1px;" title="'+x+(l+1).toString()+'">&nbsp;</div>':'<div style="display:inline-block; background-color:#333; width:1px;" title="'+x+(l+1).toString()+'">&nbsp;</div>',_+=S,w+=1}else p+=s?"<span>"+x+"</span>":"<span>-</span>"}var E='<span class="icn3d-residueNum" title="residue count">'+a.toString()+" Pos</span>";E+="</span>",E+="<br>",p+=E+="</div>",m+=E,f+="</div>",$("#"+o.pre+"dt_custom_"+e+"_"+h).html(p),$("#"+o.pre+"ov_custom_"+e+"_"+h).html(m),$("#"+o.pre+"tt_custom_"+e+"_"+h).html(f)},iCn3DUI.prototype.checkGiSeq=function(e,t,i,n){var r=this;return!(n>20)&&(void 0!==r.giSeq&&void 0!==r.giSeq[e]?(i=r.getFullText(i),r.showNewTrack(e,t,i),!1):void setTimeout(function(){r.checkGiSeq(e,t,i,n+1)},100))},iCn3DUI.prototype.getFullText=function(e){for(var t="",i=e.split(","),n=-1,r=0,o=i.length;r<o;++r){var s=i[r].trim();if(0!=s.length){var a=s.split(" ");if(2===a.length){var c,l,d=a[1],h=a[0].split("-");if(2==h.length)c=h[0]-1,l=h[1]-1;else{if(1!=h.length)continue;l=c=h[0]-1}for(var u=0;u<c-n-1;++u)t+="-";var p=l-c+1;for(t+=d.length>p?d.substr(0,p):d,u=0;u<p-d.length;++u)t+="-";n=l}}}return t},iCn3DUI.prototype.clickShow_selected=function(){var e=this;$("#"+e.pre+"show_selected").add("#"+e.pre+"mn2_show_selected").click(function(t){e.showSelection(),e.setLogCmd("show selection",!0)})},iCn3DUI.prototype.showSelection=function(e){var t=this;t.icn3d.dAtoms={},t.icn3d.dAtoms=t.icn3d.cloneHash(t.icn3d.hAtoms);var i=t.icn3d.centerAtoms(t.icn3d.hash2Atoms(t.icn3d.dAtoms));t.icn3d.maxD=i.maxD,t.icn3d.maxD<5&&(t.icn3d.maxD=5),t.icn3d.opts.rotationcenter="display center",t.saveSelectionIfSelected(),t.icn3d.draw(),t.update2DdgmContent(),t.updateHl2D(),t.showAnnoSelectedChains()},iCn3DUI.prototype.clickModeswitch=function(){var e=this;$("#"+e.pre+"modeswitch").click(function(t){$("#"+e.pre+"modeswitch")[0].checked?e.setModeAndDisplay("selection"):e.setModeAndDisplay("all")}),$("#"+e.pre+"mn6_modeall").click(function(t){e.setModeAndDisplay("all")}),$("#"+e.pre+"mn6_modeselection").click(function(t){e.setModeAndDisplay("selection")})},iCn3DUI.prototype.selectAll=function(){var e=this;for(var t in e.icn3d.hAtoms={},e.icn3d.chains)e.icn3d.hAtoms=e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.chains[t]),e.icn3d.dAtoms=e.icn3d.unionHash(e.icn3d.dAtoms,e.icn3d.chains[t]);e.icn3d.removeHlObjects(),e.removeHl2D(),e.removeHlMenus(),e.bSelectResidue=!1,e.bSelectAlignResidue=!1,e.removeSeqResidueBkgd(),e.update2DdgmContent(),$("#"+e.pre+"dl_annotations > .icn3d-annotation").show(),e.setMode("all")},iCn3DUI.prototype.setModeAndDisplay=function(e){var t=this;"all"===e?(t.setMode("all"),t.icn3d.prevHighlightAtoms=t.icn3d.cloneHash(t.icn3d.hAtoms),t.setLogCmd("set mode all",!0),t.selectAll(),t.icn3d.draw()):(t.setMode("selection"),void 0!==t.icn3d.prevHighlightAtoms?t.icn3d.hAtoms=t.icn3d.cloneHash(t.icn3d.prevHighlightAtoms):t.selectAll(),t.setLogCmd("set mode selection",!0),t.updateHlAll())},iCn3DUI.prototype.setMode=function(e){var t=this;"all"===e?($("#"+t.pre+"modeall").show(),$("#"+t.pre+"modeselection").hide(),$("#"+t.pre+"modeswitch")[0].checked=!1,$("#"+t.pre+"style").hasClass("icn3d-modeselection")&&$("#"+t.pre+"style").removeClass("icn3d-modeselection"),$("#"+t.pre+"color").hasClass("icn3d-modeselection")&&$("#"+t.pre+"color").removeClass("icn3d-modeselection")):($("#"+t.pre+"modeall").hide(),$("#"+t.pre+"modeselection").show(),$("#"+t.pre+"modeswitch")[0].checked=!0,$("#"+t.pre+"style").hasClass("icn3d-modeselection")||$("#"+t.pre+"style").addClass("icn3d-modeselection"),$("#"+t.pre+"color").hasClass("icn3d-modeselection")||$("#"+t.pre+"color").addClass("icn3d-modeselection"))},iCn3DUI.prototype.saveSelection=function(e,t){var i=this;i.selectedResidues={},i.selectedResidues=i.icn3d.getResiduesFromCalphaAtoms(i.icn3d.hAtoms),Object.keys(i.selectedResidues).length>0&&(i.selectResidueList(i.selectedResidues,e,t),i.updateSelectionNameDesc(),i.setLogCmd("select "+i.residueids2spec(Object.keys(i.selectedResidues))+" | name "+e,!0))},iCn3DUI.prototype.removeSelection=function(){var e=this;e.bAnnotations||e.removeSeqChainBkgd(),e.icn3d.bCtrl||e.icn3d.bShift||(e.removeSeqResidueBkgd(),e.removeSeqChainBkgd()),e.selectedResidues={},e.bSelectResidue=!1,e.icn3d.hAtoms={},e.icn3d.removeHlObjects(),e.removeHl2D()},iCn3DUI.prototype.updateSelectionNameDesc=function(){var e=this,t=Object.keys(e.icn3d.defNames2Residues).length+Object.keys(e.icn3d.defNames2Atoms).length;$("#"+e.pre+"seq_command_name").val("seq_"+t),$("#"+e.pre+"seq_command_name2").val("seq_"+t),$("#"+e.pre+"alignseq_command_name").val("alseq_"+t)},iCn3DUI.prototype.selectAChain=function(e,t,i,n){var r=this,o=(t=t.replace(/\s/g,""),void 0!==i||i?"select alignChain "+e:"select chain "+e);void 0!==n&&n?(r.icn3d.hAtoms=r.icn3d.unionHash(r.icn3d.hAtoms,r.icn3d.chains[e]),void 0===r.menuHlHash&&(r.menuHlHash={})):(r.icn3d.hAtoms={},r.menuHlHash={}),r.menuHlHash[e]=1;for(var s=i?r.icn3d.alnChainsSeq[e]:r.icn3d.chainsSeq[e],a={},c=0,l=s.length;c<l;++c){var d=s[c],h=e+"_"+d.resi,u=d.name;if(""!==u&&"-"!==u)for(var p in a[h]=1,r.icn3d.residues[h])r.icn3d.hAtoms[p]=1}void 0!==r.icn3d.defNames2Atoms&&r.icn3d.defNames2Atoms.hasOwnProperty(e)||void 0!==r.icn3d.defNames2Residues&&r.icn3d.defNames2Residues.hasOwnProperty(e)||r.addCustomSelection(Object.keys(a),t,t,o,!0),r.updateHlAll(i?void 0:Object.keys(r.menuHlHash),void 0,n,!0)},iCn3DUI.prototype.selectResidueList=function(e,t,i,n,r){var o=this;if(Object.keys(e).length>0){for(var s in void 0!==n&&n?void 0===o.menuHlHash&&(o.menuHlHash={}):(o.icn3d.hAtoms={},o.menuHlHash={}),e)for(var a in o.icn3d.residues[s])o.icn3d.hAtoms[a]=1;t=t.replace(/\s/g,""),o.menuHlHash[t]=1;var c="select "+o.residueids2spec(Object.keys(e)),l=Object.keys(e);o.addCustomSelection(l,t,i,c,!0),(void 0===r||r)&&o.updateHlAll(Object.keys(o.menuHlHash),void 0,n)}},iCn3DUI.prototype.addCustomSelection=function(e,t,i,n,r){var o=this;r?o.icn3d.defNames2Residues[t]=e:o.icn3d.defNames2Atoms[t]=e,o.icn3d.defNames2Command[t]=n,o.icn3d.defNames2Descr[t]=i,o.updateHlMenus([t])},iCn3DUI.prototype.selectSideChains=function(){var e=this,t=e.icn3d.cloneHash(e.icn3d.hAtoms);for(var i in e.icn3d.hAtoms={},t)e.icn3d.proteins.hasOwnProperty(i)&&"CA"!==e.icn3d.atoms[i].name&&(e.icn3d.hAtoms[i]=1);e.showHighlight()},iCn3DUI.prototype.clickCommand_apply=function(){var e=this;$("#"+e.pre+"command_apply").click(function(t){t.preventDefault();var i=$("#"+e.pre+"command").val(),n=$("#"+e.pre+"command_name").val().replace(/;/g,"_").replace(/\s+/g,"_");e.selectByCommand(i,n,n),e.setLogCmd("select "+i+" | name "+n,!0)}),$("#"+e.pre+"command_apply2").click(function(t){t.preventDefault();var i=$("#"+e.pre+"command2").val(),n=$("#"+e.pre+"command_name2").val().replace(/;/g,"_").replace(/\s+/g,"_");e.selectByCommand(i,n,n),e.setLogCmd("select "+i+" | name "+n,!0)})},iCn3DUI.prototype.selectCombinedSets=function(e,t){for(var i=e.split(" "),n=[],r=[],o=[],s="or",a=0,c=i.length;a<c;++a)"or"!==i[a]&&"and"!==i[a]&&"not"!==i[a]?"or"===s?n.push(i[a]):"and"===s?r.push(i[a]):"not"===s&&o.push(i[a]):s=i[a];null!==i&&this.combineSets(n,r,o,t)},iCn3DUI.prototype.selectByCommand=function(e,t,i){var n=this;if(0===e.indexOf("saved atoms")){var r=e.substr(h=12);n.selectCombinedSets(r,t)}else{for(var o=e.replace(/ AND /g," and ").replace(/ OR /g," or ").replace(/ or and /g," and ").replace(/ and /g," or and ").replace(/ or not /g," not ").replace(/ not /g," or not "),s=("select"===o.trim().substr(0,6)?o.trim().substr(7):o.trim()).split(" or "),a={},c=0,l=s.length;c<l;++c){var d=s[c].trim().replace(/\s+/g," "),h=d.indexOf(" ");n.icn3d.hAtoms={},"and"===d.substr(0,h).toLowerCase()?(n.applyCommand("select "+d.substr(h+1)),a=n.icn3d.intHash(a,n.icn3d.hAtoms)):"not"===d.substr(0,h).toLowerCase()?(n.applyCommand("select "+d.substr(h+1)),a=n.icn3d.exclHash(a,n.icn3d.hAtoms)):(n.applyCommand("select "+d),a=n.icn3d.unionHash(a,n.icn3d.hAtoms))}n.icn3d.hAtoms=n.icn3d.cloneHash(a);var u=Object.keys(n.icn3d.hAtoms);""!==t&&(n.addCustomSelection(u,t,i,e,!1),n.changeCustomAtoms([t]))}},iCn3DUI.prototype.selectBySpec=function(e,t,i,n){var r=this;e="select"===e.trim().substr(0,6)?e.trim().substr(7):e.trim(),r.icn3d.hAtoms={};for(var o,s=e.replace(/\s+/g," ").replace(/ AND /g," and ").split(" and "),a={},c={},l=!0,d=0,h=s.length;d<h;++d){var u,p,m,f,g=s[d].indexOf("$"),v=s[d].indexOf("."),y=s[d].indexOf(":"),b=s[d].indexOf("@"),_=s[d];-1===b?f="*":(f=_.substr(b+1),_=_.substr(0,b)),-1===y?m="*":(m=_.substr(y+1),_=_.substr(0,y)),-1===v?p="*":(p=_.substr(v+1),_=_.substr(0,v)),-1===g?u="*":(u=_.substr(g+1),_=_.substr(0,g)),"*"!==f&&(l=!1);var w,x,C,S,E=[],M=[];if(E="*"===u?Object.keys(r.icn3d.structures):u.split(","),"*"===p)for(var T=Object.keys(r.icn3d.chains),A=0,k=T.length;A<k;++A)w=(x=T[A]).substr(0,x.indexOf("_")),-1!==E.toString().toLowerCase().indexOf(w.toLowerCase())&&M.push(x);else for(A=0,k=E.length;A<k;++A){w=E[A];var R=p.split(",");for(var D in R)M.push(w+"_"+R[D])}var L=m.split(",");for(A=0,k=L.length;A<k;++A){var I,O=!1,P=L[A].indexOf("-"),H=!1,N=!1;-1!==P?(C=L[A].substr(0,P),S=L[A].substr(P+1),O=!0):""===L[A]||isNaN(L[A])?"*"===L[A]?H=!0:"proteins"!==L[A]&&"nucleotides"!==L[A]&&"chemicals"!==L[A]&&"ions"!==L[A]&&"water"!==L[A]&&(I=L[A].toUpperCase(),N=!0):(S=C=L[A],O=!0);for(var z=0,F=M.length;z<F;++z)if(x=M[z],O)for(D=parseInt(C);D<=parseInt(S);++D){var U=x+"_"+D;for(var B in 0===d?a[U]=1:a.hasOwnProperty(U)||delete a[U],r.icn3d.residues[U])"*"!==f&&f!==r.icn3d.atoms[B].name||(0===d?c[B]=1:c.hasOwnProperty(B)||delete c[B])}else if(x in r.icn3d.chains){var j=r.icn3d.chains[x];for(var B in j)if(r.icn3d.atoms[B].resn.substr(0,3).toUpperCase(),H||"proteins"===L[A]&&B in r.icn3d.proteins||"nucleotides"===L[A]&&B in r.icn3d.nucleotides||"chemicals"===L[A]&&B in r.icn3d.chemicals||"ions"===L[A]&&B in r.icn3d.ions||"water"===L[A]&&B in r.icn3d.water){if(0===d)a[x+"_"+r.icn3d.atoms[B].resi]=1;else{var G=x+"_"+r.icn3d.atoms[B].resi;a.hasOwnProperty(G)||delete a[G]}"*"!==f&&f!==r.icn3d.atoms[B].name||(0===d?c[B]=1:c.hasOwnProperty(B)||delete c[B])}if(N){for(var V="",$=[],W=0,q=r.icn3d.chainsSeq[x].length;W<q;++W)V+=1==r.icn3d.chainsSeq[x][W].name.length?r.icn3d.chainsSeq[x][W].name:r.icn3d.chainsSeq[x][W].name.substr(0,1),$.push(r.icn3d.chainsSeq[x][W].resi);V=V.toUpperCase();for(var Y=I.replace(/x/gi,"."),X=[],Z=new RegExp(Y,"i"),K=V,J=Q=K.search(Z);-1!==Q;)X.push(J),J+=(Q=(K=K.substr(Q+1)).search(Z))+1;for(W=0,q=X.length;W<q;++W)for(var Q=X[W],ee=0,te=I.length;ee<te;++ee)for(var B in U=x+"_"+$[ee+Q],0===d?a[U]=1:a.hasOwnProperty(U)||delete a[U],r.icn3d.residues[U])"*"!==f&&f!==r.icn3d.atoms[B].name||(0===d?c[B]=1:c.hasOwnProperty(B)||delete c[B])}}}}r.icn3d.hAtoms=r.icn3d.cloneHash(c),(void 0===n||n)&&r.updateHlAll(),o=l?Object.keys(a):Object.keys(c),""!=t&&(r.addCustomSelection(o,t,i,e,l),r.changeCustomAtoms([t]))},iCn3DUI.prototype.showSets=function(){var e=this;e.openDialog(e.pre+"dl_definedsets","Select sets"),$("#"+e.pre+"dl_setsmenu").show(),$("#"+e.pre+"dl_setoperations").show(),$("#"+e.pre+"dl_command").hide(),$("#"+e.pre+"atomsCustom").resizable(),void 0!==e.bSetChainsAdvancedMenu&&e.bSetChainsAdvancedMenu||(e.setPredefinedInMenu(),e.bSetChainsAdvancedMenu=!0),e.updateHlMenus()},iCn3DUI.prototype.clickCustomAtoms=function(){var e=this;$("#"+e.pre+"atomsCustom").change(function(t){var i=$(this).val();null!==i&&(e.changeCustomAtoms(i,!1),e.setLogCmd("select saved atoms "+i.join(" "+e.setOperation+" "),!0),e.bSelectResidue=!1)}),$("#"+e.pre+"atomsCustom").focus(function(t){e.isMobile()&&$("#"+e.pre+"atomsCustom").val("")})},iCn3DUI.prototype.deleteSelectedSets=function(){for(var e=this,t=$("#"+e.pre+"atomsCustom").val(),i=0;i<t.length;++i){var n=t[i];(void 0!==e.icn3d.defNames2Atoms&&e.icn3d.defNames2Atoms.hasOwnProperty(n)||void 0!==e.icn3d.defNames2Residues&&e.icn3d.defNames2Residues.hasOwnProperty(n))&&(void 0!==e.icn3d.defNames2Atoms&&e.icn3d.defNames2Atoms.hasOwnProperty(n)&&delete e.icn3d.defNames2Atoms[n],void 0!==e.icn3d.defNames2Residues&&e.icn3d.defNames2Residues.hasOwnProperty(n)&&delete e.icn3d.defNames2Residues[n])}e.updateHlMenus()},iCn3DUI.prototype.changeCustomAtoms=function(e,t){var i=this;i.icn3d.hAtoms={};for(var n=0;n<e.length;++n){var r=e[n];if(void 0!==i.icn3d.defNames2Atoms&&i.icn3d.defNames2Atoms.hasOwnProperty(r)||void 0!==i.icn3d.defNames2Residues&&i.icn3d.defNames2Residues.hasOwnProperty(r)){if(void 0!==i.icn3d.defNames2Atoms&&i.icn3d.defNames2Atoms.hasOwnProperty(r))for(var o=0,s=(d=i.icn3d.defNames2Atoms[r]).length;o<s;++o)i.icn3d.hAtoms[d[o]]=1;if(void 0!==i.icn3d.defNames2Residues&&i.icn3d.defNames2Residues.hasOwnProperty(r)){var a=i.icn3d.defNames2Residues[r],c={};for(o=0,s=a.length;o<s;++o)c=i.icn3d.unionHash(c,i.icn3d.residues[a[o]]);i.icn3d.hAtoms=i.icn3d.unionHash(i.icn3d.hAtoms,c)}}}i.updateHlAll(e,t),i.showAnnoSelectedChains(),$("#"+i.pre+"command").val(""),$("#"+i.pre+"command_name").val(""),n=0;for(var l=e.length;n<l;++n){var d=i.icn3d.defNames2Atoms[e[n]];if(0===n)$("#"+i.pre+"command").val("saved atoms "+e[n]),$("#"+i.pre+"command_name").val(e[n]);else{var h=$("#"+i.pre+"command").val();$("#"+i.pre+"command").val(h+" "+i.setOperation+" "+e[n]),h=$("#"+i.pre+"command_name").val(),$("#"+i.pre+"command_name").val(h+" "+i.setOperation+" "+e[n])}}},iCn3DUI.prototype.setHAtomsFromSets=function(e,t){for(var i=this,n=0;n<e.length;++n){var r=e[n];if(void 0!==i.icn3d.defNames2Atoms&&i.icn3d.defNames2Atoms.hasOwnProperty(r)||void 0!==i.icn3d.defNames2Residues&&i.icn3d.defNames2Residues.hasOwnProperty(r)){if(void 0!==i.icn3d.defNames2Atoms&&i.icn3d.defNames2Atoms.hasOwnProperty(r)){var o=i.icn3d.defNames2Atoms[r];if("or"===t)for(var s=0,a=o.length;s<a;++s)i.icn3d.hAtoms[o[s]]=1;else if("and"===t){var c={};for(s=0,a=o.length;s<a;++s)c[o[s]]=1;i.icn3d.hAtoms=i.icn3d.intHash(i.icn3d.hAtoms,c)}else if("not"===t)for(s=0,a=o.length;s<a;++s)i.icn3d.hAtoms[o[s]]=void 0}if(void 0!==i.icn3d.defNames2Residues&&i.icn3d.defNames2Residues.hasOwnProperty(r)){var l=i.icn3d.defNames2Residues[r];for(c={},s=0,a=l.length;s<a;++s)c=i.icn3d.unionHash(c,i.icn3d.residues[l[s]]);"or"===t?i.icn3d.hAtoms=i.icn3d.unionHash(i.icn3d.hAtoms,c):"and"===t?i.icn3d.hAtoms=i.icn3d.intHash(i.icn3d.hAtoms,c):"not"===t&&(i.icn3d.hAtoms=i.icn3d.exclHash(i.icn3d.hAtoms,c))}}}},iCn3DUI.prototype.updateAdvancedCommands=function(e,t){for(var i=this,n=" "+t+" ",r=0,o=e.length;r<o;++r)if(0===r&&"or"==t)$("#"+i.pre+"command").val("saved atoms "+e[r]),$("#"+i.pre+"command_name").val(e[r]);else{var s=$("#"+i.pre+"command").val();$("#"+i.pre+"command").val(s+n+e[r]),s=$("#"+i.pre+"command_name").val(),$("#"+i.pre+"command_name").val(s+n+e[r])}},iCn3DUI.prototype.combineSets=function(e,t,i,n){var r=this;if(r.icn3d.hAtoms={},r.setHAtomsFromSets(e,"or"),0==Object.keys(r.icn3d.hAtoms).length&&(r.icn3d.hAtoms=r.icn3d.cloneHash(r.icn3d.atoms)),r.setHAtomsFromSets(t,"and"),r.setHAtomsFromSets(i,"not"),r.updateHlAll(),r.showAnnoSelectedChains(),$("#"+r.pre+"command").val(""),$("#"+r.pre+"command_name").val(""),r.updateAdvancedCommands(e,"or"),r.updateAdvancedCommands(t,"and"),r.updateAdvancedCommands(i,"not"),void 0!==n){var o="select "+$("#"+r.pre+"command").val();$("#"+r.pre+"command_name").val(n),r.addCustomSelection(Object.keys(r.icn3d.hAtoms),n,n,o,!1)}},iCn3DUI.prototype.setProtNuclLigInMenu=function(){var e=this;for(var t in e.icn3d.chains)Object.keys(e.icn3d.proteins).length>0&&(e.icn3d.defNames2Residues.proteins=Object.keys(e.icn3d.getResiduesFromAtoms(e.icn3d.proteins)),e.icn3d.defNames2Descr.proteins="proteins",e.icn3d.defNames2Command.proteins="select :proteins"),Object.keys(e.icn3d.nucleotides).length>0&&(e.icn3d.defNames2Residues.nucleotides=Object.keys(e.icn3d.getResiduesFromAtoms(e.icn3d.nucleotides)),e.icn3d.defNames2Descr.nucleotides="nucleotides",e.icn3d.defNames2Command.nucleotides="select :nucleotides"),Object.keys(e.icn3d.chemicals).length>0&&(e.icn3d.defNames2Residues.chemicals=Object.keys(e.icn3d.getResiduesFromAtoms(e.icn3d.chemicals)),e.icn3d.defNames2Descr.chemicals="chemicals",e.icn3d.defNames2Command.chemicals="select :chemicals"),Object.keys(e.icn3d.ions).length>0&&(e.icn3d.defNames2Residues.ions=Object.keys(e.icn3d.getResiduesFromAtoms(e.icn3d.ions)),e.icn3d.defNames2Descr.ions="ions",e.icn3d.defNames2Command.ions="select :ions"),Object.keys(e.icn3d.water).length>0&&(e.icn3d.defNames2Residues.water=Object.keys(e.icn3d.getResiduesFromAtoms(e.icn3d.water)),e.icn3d.defNames2Descr.water="water",e.icn3d.defNames2Command.water="select :water")},iCn3DUI.prototype.setChainsInMenu=function(){var e=this;for(var t in e.icn3d.chains)if(e.icn3d.chainsSeq[t].length>1){e.icn3d.defNames2Residues[t]=Object.keys(e.icn3d.getResiduesFromAtoms(e.icn3d.chains[t])),e.icn3d.defNames2Descr[t]=t;var i=t.indexOf("_"),n=t.substr(0,i),r=t.substr(i+1);e.icn3d.defNames2Command[t]="select $"+n+"."+r}},iCn3DUI.prototype.loadScript=function(e,t){var i=this;i.bCommandLoad=!0,i.icn3d.bRender=!1,i.icn3d.bStopRotate=!0,e=e.replace(/\+/g," ").replace(/;/g,"\n");var n=[];i.icn3d.commands.length>0&&(n[0]=i.icn3d.commands[0]),i.icn3d.commands=e.trim().split("\n"),i.STATENUMBER=i.icn3d.commands.length,i.icn3d.commands=n.concat(i.icn3d.commands),i.STATENUMBER=i.icn3d.commands.length,i.execCommands(void 0!==t&&t?0:1,i.STATENUMBER-1,i.STATENUMBER)},iCn3DUI.prototype.loadSelection=function(e){for(var t=e.trim().split("\n"),i=0,n=t.length;i<n;++i){var r=t[i].split("\t"),o=r[0],s=r[1],a=s.indexOf(" ");this.selectByCommand(s.substr(a+1),o,o,!1)}},iCn3DUI.prototype.execCommands=function(e,t,i){var n=this;n.icn3d.bRender=!1,n.icn3d.reinitAfterLoad(),n.icn3d.opts=n.icn3d.cloneHash(n.opts),n.execCommandsBase(e,t,i)},iCn3DUI.prototype.execCommandsBase=function(e,t,i){for(var n=this,r=e;r<=t;++r){var o=r===i-1;if(-1!==n.icn3d.commands[r].indexOf("load"))return 0===t&&e===t?void(n.bNotLoadStructure?(n.icn3d.hAtoms=n.icn3d.cloneHash(n.icn3d.atoms),1===n.icn3d.commands.length&&(n.bAddCommands=!0),o&&n.renderFinalStep(i)):$.when(n.applyCommandLoad(n.icn3d.commands[r])).then(function(){1===n.icn3d.commands.length&&(n.bAddCommands=!0),o&&n.renderFinalStep(i)})):void(n.bNotLoadStructure?(n.icn3d.hAtoms=n.icn3d.cloneHash(n.icn3d.atoms),void 0!==n.backForward&&n.backForward&&n.renderFinalStep(1),n.execCommandsBase(r+1,t,i)):$.when(n.applyCommandLoad(n.icn3d.commands[r])).then(function(){void 0!==n.backForward&&n.backForward&&n.renderFinalStep(1),n.execCommandsBase(r+1,t,i)}));if(0==n.icn3d.commands[r].trim().indexOf("set map")&&-1==n.icn3d.commands[r].trim().indexOf("set map wireframe")){if(3==(a=n.icn3d.commands[r].trim().substr(8).split(" ")).length&&"sigma"==a[1]){var s=a[0];return void(("2fofc"!=s||void 0!==n.bAjax2fofc&&n.bAjax2fofc)&&("fofc"!=s||void 0!==n.bAjaxfofc&&n.bAjaxfofc)?(n.applyCommandMap(n.icn3d.commands[r].trim()),n.execCommandsBase(r+1,t,i)):$.when(n.applyCommandMap(n.icn3d.commands[r].trim())).then(function(){n.execCommandsBase(r+1,t,i)}))}}else if(0==n.icn3d.commands[r].trim().indexOf("set emmap")&&-1==n.icn3d.commands[r].trim().indexOf("set emmap wireframe")){var a;if(2==(a=n.icn3d.commands[r].trim().substr(10).split(" ")).length&&"percentage"==a[0])return void(void 0!==n.bAjaxEm&&n.bAjaxEm?(n.applyCommandEmmap(n.icn3d.commands[r].trim()),n.execCommandsBase(r+1,t,i)):$.when(n.applyCommandEmmap(n.icn3d.commands[r].trim())).then(function(){n.execCommandsBase(r+1,t,i)}))}else{if(0==n.icn3d.commands[r].trim().indexOf("view annotations")){var c=n.icn3d.commands[r].split("|||");return void(Object.keys(n.icn3d.proteins).length>0&&(void 0===n.bAjaxCddSite||!n.bAjaxCddSite)?$.when(n.applyCommandAnnotationsAndCddSite(c[0].trim())).then(function(){n.execCommandsBase(r+1,t,i)}):(Object.keys(n.icn3d.proteins).length>0&&n.applyCommandAnnotationsAndCddSiteBase(c[0].trim()),n.execCommandsBase(r+1,t,i)))}if(0==n.icn3d.commands[r].trim().indexOf("set annotation clinvar")||0==n.icn3d.commands[r].trim().indexOf("set annotation snp"))return c=n.icn3d.commands[r].split("|||"),void(Object.keys(n.icn3d.proteins).length>0&&(void 0===n.bAjaxSnpClinvar||!n.bAjaxSnpClinvar)?$.when(n.applyCommandSnpClinvar(c[0].trim())).then(function(){n.execCommandsBase(r+1,t,i)}):(Object.keys(n.icn3d.proteins).length>0&&n.applyCommandSnpClinvar(c[0].trim()),n.execCommandsBase(r+1,t,i)));if(0==n.icn3d.commands[r].trim().indexOf("set annotation 3ddomain"))return c=n.icn3d.commands[r].split("|||"),void(Object.keys(n.icn3d.proteins).length>0&&void 0===n.mmdb_data&&(void 0===n.bAjax3ddomain||!n.bAjax3ddomain)?$.when(n.applyCommand3ddomain(c[0].trim())).then(function(){n.execCommandsBase(r+1,t,i)}):(Object.keys(n.icn3d.proteins).length>0&&n.applyCommand3ddomain(c[0].trim()),n.execCommandsBase(r+1,t,i)));if(0==n.icn3d.commands[r].trim().indexOf("set annotation all"))return c=n.icn3d.commands[r].split("|||"),void(!(Object.keys(n.icn3d.proteins).length>0)||void 0!==n.bAjaxSnpClinvar&&n.bAjaxSnpClinvar||void 0!==n.bAjax3ddomain&&n.bAjax3ddomain&&void 0!==n.mmdb_data?Object.keys(n.icn3d.proteins).length>0&&(void 0===n.bAjaxSnpClinvar||!n.bAjaxSnpClinvar)?$.when(n.applyCommandSnpClinvar(c[0].trim())).then(function(){n.setAnnoTabAll(),n.execCommandsBase(r+1,t,i)}):Object.keys(n.icn3d.proteins).length>0&&(void 0===n.bAjax3ddomain||!n.bAjax3ddomain||void 0===n.mmdb_data)?$.when(n.applyCommand3ddomain(c[0].trim())).then(function(){n.setAnnoTabAll(),n.execCommandsBase(r+1,t,i)}):(Object.keys(n.icn3d.proteins).length>0&&(void 0!==n.bAjaxSnpClinvar&&n.bAjaxSnpClinvar||void 0!==n.bAjax3ddomain&&n.bAjax3ddomain&&void 0!==n.mmdb_data?void 0!==n.bAjaxSnpClinvar&&n.bAjaxSnpClinvar?void 0!==n.bAjax3ddomain&&n.bAjax3ddomain&&void 0!==n.mmdb_data||n.applyCommand3ddomainBase(c[0].trim()):n.applyCommandSnpClinvarBase(c[0].trim()):(n.applyCommandSnpClinvarBase(c[0].trim()),n.applyCommand3ddomainBase(c[0].trim()))),n.setAnnoTabAll(),n.execCommandsBase(r+1,t,i)):$.when(n.applyCommandSnpClinvar(c[0].trim())).then(n.applyCommand3ddomain(c[0].trim())).then(function(){n.setAnnoTabAll(),n.execCommandsBase(r+1,t,i)}));if(0==n.icn3d.commands[r].trim().indexOf("view interactions")&&void 0!==n.cfg.align)return c=n.icn3d.commands[r].split("|||"),void(void 0!==n.b2DShown&&n.b2DShown?n.execCommandsBase(r+1,t,i):$.when(n.applyCommandViewinteraction(c[0].trim())).then(function(){n.execCommandsBase(r+1,t,i)}));n.applyCommand(n.icn3d.commands[r])}}r===i&&(n.bCommandLoad=!1,n.hideLoading(),r+1===n.icn3d.commands.length&&(n.bAddCommands=!0),n.renderFinalStep(i))},iCn3DUI.prototype.renderFinalStep=function(e){var t=this;t.icn3d.bRender=!0;var i=t.icn3d.commands[e-1].split("|||");if(2==i.length){var n=JSON.parse(i[1]);t.icn3d._zoomFactor=n.factor,t.icn3d.mouseChange.x=n.mouseChange.x,t.icn3d.mouseChange.y=n.mouseChange.y,t.icn3d.quaternion._x=n.quaternion._x,t.icn3d.quaternion._y=n.quaternion._y,t.icn3d.quaternion._z=n.quaternion._z,t.icn3d.quaternion._w=n.quaternion._w}if(1===e||Object.keys(t.icn3d.hAtoms).length===Object.keys(t.icn3d.atoms).length||void 0!==t.icn3d.optsHistory[e-1]&&t.icn3d.optsHistory[e-1].hasOwnProperty("hlatomcount")&&t.icn3d.optsHistory[e-1].hlatomcount===Object.keys(t.icn3d.atoms).length)if(1===e&&(t.icn3d.setAtomStyleByOptions(t.icn3d.optsHistory[e-1]),t.icn3d.setColorByOptions(t.icn3d.optsHistory[e-1],t.icn3d.hAtoms)),t.icn3d.optsHistory.length>=e){var r=t.icn3d.optsHistory[e-1].pk;"no"===r?t.icn3d.pk=0:"atom"===r?t.icn3d.pk=1:"residue"===r?t.icn3d.pk=2:"strand"===r&&(t.icn3d.pk=3),1===e&&t.icn3d.applyOriginalColor(),t.updateHlAll(),jQuery.extend(t.icn3d.opts,t.icn3d.optsHistory[e-1]),t.icn3d.draw()}else t.updateHlAll(),t.icn3d.draw();else t.icn3d.draw()},iCn3DUI.prototype.applyCommandLoad=function(e){var t=this;return t.deferred2=$.Deferred(function(){t.bAddCommands=!1;var i=e.split("|||")[0].replace(/\s\s/g," ").trim().toLowerCase();if(-1!==i.indexOf("load")){var n=i.split(" | "),r=n[0];if(n.length>1){var o=n[n.length-1].indexOf(" ");t.cfg.inpara=n[n.length-1].substr(o+1),"undefined"===t.cfg.inpara&&(t.cfg.inpara="")}var s=r.substr(r.lastIndexOf(" ")+1);if(t.inputid=s,-1!==i.indexOf("load mmtf"))t.cfg.mmtfid=s,t.downloadMmtf(s);else if(-1!==i.indexOf("load pdb"))t.cfg.pdbid=s,t.downloadPdb(s);else if(-1!==i.indexOf("load mmcif"))t.cfg.mmcifid=s,t.downloadMmcif(s);else if(-1!==i.indexOf("load mmdb"))t.cfg.mmdbid=s,t.downloadMmdb(s);else if(-1!==i.indexOf("load gi"))t.cfg.gi=s,t.downloadGi(s);else if(-1!==i.indexOf("load seq_struc_ids"))t.downloadBlast_rep_id(s);else if(-1!==i.indexOf("load cid"))t.cfg.cid=s,t.downloadCid(s);else if(-1!==i.indexOf("load align"))t.cfg.align=s,t.downloadAlignment(s);else if(-1!==i.indexOf("load url")){var a=n[1],c=void 0!==a?a.indexOf("type "):-1,l="pdb";-1!==c&&(l=a.substr(c+5)),t.cfg.url=s,t.downloadUrl(s,l)}}t.bAddCommands=!0}),t.deferred2.promise()},iCn3DUI.prototype.applyCommandMap=function(e){var t=this;return t.deferredMap=$.Deferred(function(){var i=e.substr(8).split(" ");3==i.length&&"sigma"==i[1]&&t.Dsn6Parser(t.inputid,i[0],i[2])}),t.deferredMap.promise()},iCn3DUI.prototype.applyCommandEmmap=function(e){var t=this;return t.deferredEmmap=$.Deferred(function(){var i=e.substr(10).split(" ");2==i.length&&"percentage"==i[0]&&t.DensityCifParser(t.inputid,"em",i[1],t.icn3d.emd)}),t.deferredEmmap.promise()},iCn3DUI.prototype.applyCommandAnnotationsAndCddSiteBase=function(e){"view annotations"==e&&(void 0!==this.cfg.showanno&&this.cfg.showanno||this.showAnnotations())},iCn3DUI.prototype.applyCommandAnnotationsAndCddSite=function(e){var t=this;return t.deferredAnnoCddSite=$.Deferred(function(){t.applyCommandAnnotationsAndCddSiteBase(e)}),t.deferredAnnoCddSite.promise()},iCn3DUI.prototype.applyCommandSnpClinvarBase=function(e){var t=e.lastIndexOf(" "),i=e.substr(t+1);"clinvar"==i?this.setAnnoTabClinvar():"snp"==i?this.setAnnoTabSnp():"all"==i&&(this.setAnnoTabClinvar(),this.setAnnoTabSnp())},iCn3DUI.prototype.applyCommandSnpClinvar=function(e){var t=this;return t.deferredSnpClinvar=$.Deferred(function(){t.applyCommandSnpClinvarBase(e)}),t.deferredSnpClinvar.promise()},iCn3DUI.prototype.applyCommand3ddomainBase=function(e){var t=e.lastIndexOf(" "),i=e.substr(t+1);"3ddomain"!=i&&"all"!=i||this.setAnnoTab3ddomain()},iCn3DUI.prototype.applyCommand3ddomain=function(e){var t=this;return t.deferred3ddomain=$.Deferred(function(){t.applyCommand3ddomainBase(e)}),t.deferred3ddomain.promise()},iCn3DUI.prototype.applyCommandViewinteractionBase=function(e){if(void 0!==this.cfg.align){var t=Object.keys(this.icn3d.structures);this.set2DDiagramsForAlign(t[0].toUpperCase(),t[1].toUpperCase())}},iCn3DUI.prototype.applyCommandViewinteraction=function(e){var t=this;return t.deferredViewinteraction=$.Deferred(function(){t.applyCommandViewinteractionBase(e)}),t.deferredViewinteraction.promise()},iCn3DUI.prototype.applyCommand=function(e){var t=this;t.bAddCommands=!1;var i=e.split("|||")[0].replace(/\s+/g," ").trim(),n=i.toLowerCase(),r=t.inputid?t.inputid:"custom";if("export state file"==n);else if("export canvas"==n)setTimeout(function(){t.saveFile(r+"_icn3d_loadable.png","png")},500);else if("export interactions"==n)t.exportInteractions();else if("export stl file"==n)setTimeout(function(){var e=t.saveStlFile();t.saveFile(r+".stl","binary",e),e=""},500);else if("export vrml file"==n)setTimeout(function(){var e=t.saveVrmlFile();t.saveFile(r+".wrl","text",e),e=""},500);else if("export stl stabilizer file"==n)setTimeout(function(){t.hideStabilizer(),t.resetAfter3Dprint(),t.addStabilizer();var e=t.saveStlFile();t.saveFile(r+"_stab.stl","binary",e),e=""},500);else if("export vrml stabilizer file"==n)setTimeout(function(){t.hideStabilizer(),t.resetAfter3Dprint(),t.addStabilizer();var e=t.saveVrmlFile();t.saveFile(r+"_stab.wrl","text",e),e=""},500);else if("select all"==n)t.selectAll();else if("select complement"==n)t.selectComplement();else if("set pk atom"==n)t.icn3d.pk=1,t.icn3d.opts.pk="atom";else if("set pk off"==n)t.icn3d.pk=0,t.icn3d.opts.pk="no",t.icn3d.draw(),t.icn3d.removeHlObjects();else if("set pk residue"==n)t.icn3d.pk=2,t.icn3d.opts.pk="residue";else if("set pk strand"==n)t.icn3d.pk=3,t.icn3d.opts.pk="strand";else if("set pk chain"==n)t.icn3d.pk=4,t.icn3d.opts.pk="chain";else if("set surface wireframe on"==n)t.icn3d.opts.wireframe="yes",t.icn3d.applySurfaceOptions();else if("set surface wireframe off"==n)t.icn3d.opts.wireframe="no",t.icn3d.applySurfaceOptions();else if("set map wireframe on"==n)t.icn3d.opts.mapwireframe="yes",t.icn3d.applyMapOptions();else if("set map wireframe off"==n)t.icn3d.opts.mapwireframe="no",t.icn3d.applyMapOptions();else if("set emmap wireframe on"==n)t.icn3d.opts.emmapwireframe="yes",t.icn3d.applyMapOptions();else if("set emmap wireframe off"==n)t.icn3d.opts.emmapwireframe="no",t.icn3d.applyMapOptions();else if("set surface neighbors on"==n)t.icn3d.bConsiderNeighbors=!0,t.icn3d.applySurfaceOptions();else if("set surface neighbors off"==n)t.icn3d.bConsiderNeighbors=!1,t.icn3d.applySurfaceOptions();else if("set axis on"==n)t.icn3d.opts.axis="yes";else if("set axis off"==n)t.icn3d.opts.axis="no";else if("set fog on"==n)t.icn3d.opts.fog="yes";else if("set fog off"==n)t.icn3d.opts.fog="no";else if("set slab on"==n)t.icn3d.opts.slab="yes";else if("set slab off"==n)t.icn3d.opts.slab="no";else if("set assembly on"==n)t.icn3d.bAssembly=!0;else if("set assembly off"==n)t.icn3d.bAssembly=!1;else if("set chemicalbinding show"==n)t.setOption("chemicalbinding","show");else if("set chemicalbinding hide"==n)t.setOption("chemicalbinding","hide");else if("set hbonds off"==n)t.icn3d.hideHbonds(),t.icn3d.draw();else if("set stabilizer off"==n)t.hideStabilizer(),t.icn3d.draw();else if("set disulfide bonds off"==n)t.icn3d.opts.ssbonds="no",t.icn3d.draw();else if("set cross linkage off"==n)t.icn3d.bShowCrossResidueBond=!1,t.setStyle("proteins","ribbon");else if("set lines off"==n)t.icn3d.labels.distance=[],t.icn3d.lines.distance=[],t.icn3d.draw();else if("set labels off"==n){for(var o in t.icn3d.labels)t.icn3d.labels[o]=[];t.icn3d.draw()}else if("set mode all"==n)t.setModeAndDisplay("all");else if("set mode selection"==n)t.setModeAndDisplay("selection");else if("set view detailed view"==n)t.setAnnoViewAndDisplay("detailed view");else if("set view overview"==n)t.setAnnoViewAndDisplay("overview");else if("set annotation custom"==n)t.setAnnoTabCustom();else if("set annotation interaction"==n)t.setAnnoTabInteraction();else if("set annotation cdd"==n)t.setAnnoTabCdd();else if("set annotation site"==n)t.setAnnoTabSite();else if("set annotation ssbond"==n)t.setAnnoTabSsbond();else if("highlight level up"==n)t.switchHighlightLevelUp();else if("highlight level down"==n)t.switchHighlightLevelDown();else if(0==n.indexOf("hide annotation")){var s=n.lastIndexOf(" ");"all"==(w=n.substr(s+1))?t.hideAnnoTabAll():"custom"==w?t.hideAnnoTabCustom():"clinvar"==w?t.hideAnnoTabClinvar():"snp"==w?t.hideAnnoTabSnp():"cdd"==w?t.hideAnnoTabCdd():"3ddomain"==w?t.hideAnnoTab3ddomain():"site"==w?t.hideAnnoTabSite():"interaction"==w?t.hideAnnoTabInteraction():"ssbond"==w&&t.hideAnnoTabSsbond()}else if("add residue labels"==n)t.icn3d.addResiudeLabels(t.icn3d.hAtoms),t.icn3d.draw();else if("add chain labels"==n)t.addChainLabels(t.icn3d.hAtoms),t.icn3d.draw();else if("add terminal labels"==n)t.addTerminiLabels(t.icn3d.hAtoms),t.icn3d.draw();else if("rotate left"==n)t.icn3d.bStopRotate=!1,t.ROT_DIR="left",t.rotStruc("left");else if("rotate right"==n)t.icn3d.bStopRotate=!1,t.ROT_DIR="right",t.rotStruc("right");else if("rotate up"==n)t.icn3d.bStopRotate=!1,t.ROT_DIR="up",t.rotStruc("up");else if("rotate down"==n)t.icn3d.bStopRotate=!1,t.ROT_DIR="down",t.rotStruc("down");else if("reset"===n)t.icn3d.reinitAfterLoad(),t.renderFinalStep(1),t.icn3d.render();else if("reset orientation"===n)t.icn3d.resetOrientation(),t.icn3d.draw();else if("reset thickness"==n)t.resetAfter3Dprint(),t.icn3d.draw();else if("clear selection"==n)t.icn3d.removeHlObjects(),t.removeHl2D(),t.icn3d.bShowHighlight=!1,t.bSelectResidue=!1;else if("zoom selection"==n)t.icn3d.zoominSelection(),t.icn3d.draw();else if("center selection"==n)t.icn3d.centerSelection(),t.icn3d.draw();else if("show selection"==n)t.showSelection();else if("output selection"==n)t.outputSelection();else if("toggle selection"==n)t.toggleSelection();else if("toggle highlight"==n)t.icn3d.prevHighlightObjects.length>0?(t.icn3d.removeHlObjects(),t.icn3d.bShowHighlight=!1):(t.icn3d.addHlObjects(),t.icn3d.bShowHighlight=!0);else if("stabilizer"==n)t.addStabilizer(),t.prepareFor3Dprint();else if("disulfide bonds"==n)t.showSsbonds();else if("cross linkage"==n)t.icn3d.bShowCrossResidueBond=!0,t.setStyle("proteins","lines");else if("back"==n)t.back();else if("forward"==n)t.forward();else if("clear all"==n)t.selectAll();else if("defined sets"==n)t.showSets();else if("delete selected sets"==n)t.deleteSelectedSets();else if("view interactions"==n)void 0===t.cfg.mmdbid&&void 0===t.cfg.gi||t.set2DDiagrams(t.inputid);else if("show annotations all chains"==n)t.showAnnoAllChains();else if("save color"==n)t.saveColor();else if("apply saved color"==n)t.applySavedColor();else if("save style"==n)t.saveStyle();else if("apply saved style"==n)t.applySavedStyle();else if("select side chains"==n)t.selectSideChains();else if(0==i.indexOf("define helix sets")){var a=i.split(" | ")[1].split(" ")[1];t.defineSecondary(a,"helix")}else if(0==i.indexOf("define sheet sets"))a=i.split(" | ")[1].split(" ")[1],t.defineSecondary(a,"sheet");else if(0==i.indexOf("define coil sets"))a=i.split(" | ")[1].split(" ")[1],t.defineSecondary(a,"coil");else if(0==i.indexOf("select interaction")){if(null!==(u=i.substr(i.lastIndexOf(" ")+1).split(","))){var c=u[0].split("_")[0];t.b2DShown||t.download2Ddgm(c.toUpperCase()),t.selectInteraction(u[0],u[1])}}else if(0==i.indexOf("select saved atoms")){var l=(z=(f=i.split(" | "))[0].replace(/,/g," or ")).substr(s=19);t.selectCombinedSets(l,F=l)}else if(-1!==i.indexOf("select chain"))for(var d=0,h=(u=i.substr(i.lastIndexOf(" ")+1).split(",")).length;d<h;++d)t.selectAChain(u[d],u[d],!1);else if(-1!==i.indexOf("select alignChain")){var u;for(d=0,h=(u=i.substr(i.lastIndexOf(" ")+1).split(",")).length;d<h;++d)t.selectAChain(u[d],"align_"+u[d],!0)}else if(0==n.indexOf("select zone cutoff")){var p=parseFloat(n.substr(n.lastIndexOf(" ")+1));t.pickCustomSphere(p)}else if(0==n.indexOf("set surface opacity")){var m=n.substr(n.lastIndexOf(" ")+1);t.icn3d.opts.opacity=m,t.icn3d.applySurfaceOptions()}else if(0==n.indexOf("set surface"))m=n.substr(12),t.icn3d.opts.surface=m,t.icn3d.applySurfaceOptions();else if(0==n.indexOf("set camera"))m=n.substr(n.lastIndexOf(" ")+1),t.icn3d.opts.camera=m;else if(0==n.indexOf("set background"))m=n.substr(n.lastIndexOf(" ")+1),t.icn3d.opts.background=m;else if(0==i.indexOf("set thickness")){var f=n.split(" | ");for(t.bSetThickness=!0,d=1,h=f.length;d<h;++d){var g=(v=f[d].split(" "))[0];m=parseFloat(v[1]),"linerad"==g&&(t.icn3d.lineRadius=m),"coilrad"==g&&(t.icn3d.coilWidth=m),"stickrad"==g&&(t.icn3d.cylinderRadius=m),"tracerad"==g&&(t.icn3d.traceRadius=m),"ballscale"==g&&(t.icn3d.dotSphereScale=m),"ribbonthick"==g&&(t.icn3d.ribbonthickness=m),"proteinwidth"==g&&(t.icn3d.helixSheetWidth=m),"nucleotidewidth"==g&&(t.icn3d.nucleicAcidWidth=m),t.icn3d.draw()}}else if(0==n.indexOf("set highlight color"))"yellow"===(b=n.substr(20))?(t.icn3d.hColor=new THREE.Color(16776960),t.icn3d.matShader=t.icn3d.setOutlineColor("yellow")):"green"===b?(t.icn3d.hColor=new THREE.Color(65280),t.icn3d.matShader=t.icn3d.setOutlineColor("green")):"red"===b&&(t.icn3d.hColor=new THREE.Color(16711680),t.icn3d.matShader=t.icn3d.setOutlineColor("red")),t.icn3d.draw();else if(0==n.indexOf("set highlight style"))"outline"===(N=n.substr(20))?t.icn3d.bHighlight=1:"3d"===N&&(t.icn3d.bHighlight=2),t.icn3d.draw();else if(0==n.indexOf("add line")){var v=(f=n.split(" | "))[1].split(" "),y=f[2].split(" "),b=f[3].substr(f[3].lastIndexOf(" ")+1),_="true"===f[4].substr(f[4].lastIndexOf(" ")+1),w=f[5].substr(f[5].lastIndexOf(" ")+1);t.addLine(parseFloat(v[1]),parseFloat(v[3]),parseFloat(v[5]),parseFloat(y[1]),parseFloat(y[3]),parseFloat(y[5]),b,_,w),t.icn3d.draw()}else if(0==i.indexOf("add label")){var x,C,S,E,M,T=(f=i.split(" | "))[0].substr("add label".length+1),A=!1;for(d=1,h=f.length;d<h;++d){var k=f[d].split(" ");"x"==k[0]?(A=!0,x=k[1],C=k[3],S=k[5]):"size"==k[0]?E=f[d].substr(f[d].lastIndexOf(" ")+1):"color"==k[0]?b=f[d].substr(f[d].lastIndexOf(" ")+1):"background"==k[0]?M=f[d].substr(f[d].lastIndexOf(" ")+1):"type"==k[0]&&(w=f[d].substr(f[d].lastIndexOf(" ")+1))}if(!A){var R=t.icn3d.centerAtoms(t.icn3d.hash2Atoms(t.icn3d.hAtoms));x=R.center.x,C=R.center.y,S=R.center.z}t.addLabel(T,x,C,S,E,b,M,w),t.icn3d.draw()}else if(0==i.indexOf("add track")){a=(f=i.split(" | "))[1].substr(8);var D=f[2].substr(6);T=f[3].substr(5),$("#"+t.pre+"anno_custom")[0].checked=!0,$("[id^="+t.pre+"custom]").show(),t.checkGiSeq(a,D,T,0)}else if(0==n.indexOf("remove one stabilizer")){v=(f=n.split(" | "))[1].split(" ");var L=[];L.push(parseInt(v[0])),L.push(parseInt(v[1])),t.removeOneStabilizer(L),t.icn3d.draw()}else if(0==n.indexOf("add one stabilizer"))v=(f=n.split(" | "))[1].split(" "),void 0===t.icn3d.pairArray&&(t.icn3d.pairArray=[]),t.icn3d.pairArray.push(parseInt(v[0])),t.icn3d.pairArray.push(parseInt(v[1])),t.icn3d.draw();else if(0==n.indexOf("pickatom")){var I=parseInt(n.substr(n.lastIndexOf(" ")+1));t.icn3d.pAtom=t.icn3d.atoms[I],t.icn3d.showPicking(t.icn3d.pAtom)}else if(0==n.indexOf("hbonds")){var O=parseFloat(n.substr(n.indexOf(" ")+1));isNaN(O)||t.showHbonds(O)}else if(0==n.indexOf("color"))b=n.substr(n.indexOf(" ")+1),t.icn3d.opts.color=b,t.icn3d.setColorByOptions(t.icn3d.opts,t.icn3d.hAtoms),t.updateHlAll();else if(0==n.indexOf("style")){var P=n.substr(n.indexOf(" ")+1),H=P.substr(0,P.indexOf(" ")),N=P.substr(P.indexOf(" ")+1);t.setStyle(H,N)}else if(0==n.indexOf("select")&&-1!==n.indexOf("name")){var z="",F="",U="";for(d=0,h=(f=i.split(" | ")).length;d<h;++d)-1!==(g=f[d]).indexOf("select")?z=g.substr(g.indexOf(" ")+1):-1!==g.indexOf("name")&&(F=g.substr(g.indexOf(" ")+1));t.selectByCommand(z,F,U=F)}else-1===n.indexOf("select $")&&-1===n.indexOf("select .")&&-1===n.indexOf("select :")&&-1===n.indexOf("select @")||(z=(f=i.split(" | "))[0].substr(f[0].indexOf(" ")+1),F="",U="",f.length>1&&(F=f[1].substr(f[1].indexOf(" ")+1)),f.length>2&&(U=f[2].substr(f[2].indexOf(" ")+1)),-1!==z.indexOf(" or ")?t.selectByCommand(z,F,U):t.selectBySpec(z,F,U));t.setLogCmd(i,!1),t.bAddCommands=!0},iCn3DUI.prototype.selectResidues=function(e,t){var i=this;if(void 0!==e&&""!==e){e=e.substr(e.indexOf("_")+1),i.bSelectResidue=!0,$(t).toggleClass("icn3d-highlightSeq");var n=e.substr(e.indexOf("_")+1);if(i.icn3d.residues.hasOwnProperty(n))if($(t).hasClass("icn3d-highlightSeq")){for(var r in i.icn3d.residues[n])i.icn3d.hAtoms[r]=1;if(i.selectedResidues[n]=1,i.bAnnotations&&void 0!==$(t).attr("disease")){var o=$(t).attr("disease"),s=i.icn3d.centerAtoms(i.icn3d.hash2Atoms(i.icn3d.residues[n]));o.length>15&&(o=o.substr(0,15)+"..."),i.addLabel(o,s.center.x,s.center.y,s.center.z,i.icn3d.LABELSIZE,i.GREYD,void 0,"custom")}}else{for(var a in i.icn3d.residues[n])delete i.icn3d.hAtoms[a];delete i.selectedResidues[n],i.icn3d.removeHlObjects()}}},iCn3DUI.prototype.selectTitle=function(e){var t=this;if($(e).hasClass("icn3d-seqTitle")){var i,n,r,o=$(e).attr("chain");if(t.bAlignSeq?t.bSelectAlignResidue=!1:t.bSelectResidue=!1,t.bAnnotations||t.removeSeqChainBkgd(o),t.icn3d.bCtrl||t.icn3d.bShift||(t.removeSeqResidueBkgd(),t.removeSeqChainBkgd()),$(e).toggleClass("icn3d-highlightSeq"),t.bAnnotations?(i=$(e).attr("setname"),n=$(e).attr("title")):i=t.bAlignSeq?"align_"+o:o,$(e).hasClass("icn3d-highlightSeq"))if(t.bAnnotations){if($(e).hasClass("icn3d-highlightSeq"))if(t.removeHl2D(),void 0!==$(e).attr("gi"))t.icn3d.bCtrl||t.icn3d.bShift?t.selectAChain(o,o,!1,!0):t.selectAChain(o,o,!1),t.setLogCmd("select chain "+o,!0);else{var s={};if(void 0!==$(e).attr("domain")||void 0!==$(e).attr("3ddomain")){t.hlSummaryDomain3ddomain(e);for(var a=$(e).attr("from").split(","),c=$(e).attr("to").split(","),l=0,d=a.length;l<d;++l)for(var h=parseInt(a[l]),u=parseInt(c[l]),p=h;p<=u;++p)s[m=o+"_"+(p+1).toString()]=1;t.selectResidueList(s,i,n,!(!t.icn3d.bCtrl&&!t.icn3d.bShift)),m=o+"_"+parseInt((h+u)/2).toString(),r=t.icn3d.centerAtoms(t.icn3d.hash2Atoms(t.icn3d.residues[m]))}else{var m,f=$(e).attr("posarray").split(",");for(l=0,d=f.length;l<d;++l)s[m=void 0!==$(e).attr("site")?o+"_"+(parseInt(f[l])+1).toString():o+"_"+f[l]]=1;t.selectResidueList(s,i,n,!(!t.icn3d.bCtrl&&!t.icn3d.bShift)),m=o+"_"+f[parseInt((0+f.length)/2)].toString(),r=t.icn3d.centerAtoms(t.icn3d.hash2Atoms(t.icn3d.residues[m]))}for(var g in t.icn3d.labels)"schematic"!==g&&"distance"!==g&&(t.icn3d.labels[g]=[]);t.addLabel(n,r.center.x,r.center.y,r.center.z,t.icn3d.LABELSIZE,"FFFF00",void 0,"custom"),t.icn3d.draw(),t.setLogCmd("select "+t.residueids2spec(Object.keys(s))+" | name "+i,!0)}}else t.bAlignSeq?(t.icn3d.bCtrl||t.icn3d.bShift?t.selectAChain(o,i,!0,!0):t.selectAChain(o,i,!0),t.setLogCmd("select alignChain "+o,!0)):(t.icn3d.bCtrl||t.icn3d.bShift?t.selectAChain(o,i,!1,!0):t.selectAChain(o,i,!1),t.setLogCmd("select chain "+o,!0));else t.icn3d.removeHlObjects(),t.removeHl2D(),$("#"+t.pre+"atomsCustom").val("")}},iCn3DUI.prototype.selectSequenceNonMobile=function(){var e=this;$("#"+e.pre+"dl_sequence2").add("[id^="+e.pre+"dt_giseq]").add("[id^="+e.pre+"dt_site]").add("[id^="+e.pre+"dt_snp]").add("[id^="+e.pre+"dt_clinvar]").add("[id^="+e.pre+"dt_cdd]").add("[id^="+e.pre+"dt_domain]").add("[id^="+e.pre+"dt_interaction]").add("[id^="+e.pre+"dt_ssbond]").add("[id^="+e.pre+"tt_giseq]").add("[id^="+e.pre+"tt_site]").add("[id^="+e.pre+"tt_snp]").add("[id^="+e.pre+"tt_clinvar]").add("[id^="+e.pre+"tt_cdd]").add("[id^="+e.pre+"tt_domain]").add("[id^="+e.pre+"tt_interaction]").add("[id^="+e.pre+"tt_ssbond]").selectable({stop:function(){$(this).attr("id")===e.pre+"dl_sequence2"?(e.bAlignSeq=!0,e.bAnnotations=!1):(e.bAlignSeq=!1,e.bAnnotations=!0),!1!==e.bSelectResidue||e.icn3d.bShift||e.icn3d.bCtrl||e.removeSelection(),$("span.ui-selected",this).each(function(){var t=$(this).attr("id");void 0!==t&&e.selectResidues(t,this)}),e.icn3d.addHlObjects();var t={};for(var i in e.selectedResidues){var n=i.lastIndexOf("_");t[i.substr(0,n)]=1}var r=Object.keys(t);e.updateHl2D(r),$("div.ui-selected",this).each(function(){void 0!==$(this).attr("chain")&&e.selectTitle(this)})}}),$("[id^="+e.pre+"ov_giseq]").add("[id^="+e.pre+"ov_site]").add("[id^="+e.pre+"ov_snp]").add("[id^="+e.pre+"ov_clinvar]").add("[id^="+e.pre+"ov_cdd]").add("[id^="+e.pre+"ov_domain]").add("[id^="+e.pre+"ov_interaction]").add("[id^="+e.pre+"ov_ssbond]").add("[id^="+e.pre+"tt_giseq]").add("[id^="+e.pre+"tt_site]").add("[id^="+e.pre+"tt_snp]").add("[id^="+e.pre+"tt_clinvar]").add("[id^="+e.pre+"tt_cdd]").add("[id^="+e.pre+"tt_domain]").add("[id^="+e.pre+"tt_interaction]").add("[id^="+e.pre+"tt_ssbond]").on("click",".icn3d-seqTitle",function(t){t.stopImmediatePropagation(),e.bAlignSeq=!1,e.bAnnotations=!0,e.selectTitle(this),e.hlSummaryDomain3ddomain(this)})},iCn3DUI.prototype.hlSummaryDomain3ddomain=function(e){if(void 0!==$(e).attr("domain")){var t=$(e).attr("index"),i=$(e).attr("chain");0!==$("[id^="+i+"_domain_"+t+"]").length&&$("[id^="+i+"_domain_"+t+"]").addClass("icn3d-highlightSeqBox")}void 0!==$(e).attr("3ddomain")&&(t=$(e).attr("index"),i=$(e).attr("chain"),0!==$("[id^="+i+"_3d_domain_"+t+"]").length&&$("[id^="+i+"_3d_domain_"+t+"]").addClass("icn3d-highlightSeqBox"))},iCn3DUI.prototype.selectSequenceMobile=function(){var e=this;$("#"+e.pre+"dl_sequence2").add("[id^="+e.pre+"giseq]").add("[id^="+e.pre+"site]").add("[id^="+e.pre+"clinvar]").add("[id^="+e.pre+"snp]").add("[id^="+e.pre+"cdd]").add("[id^="+e.pre+"domain]").add("[id^="+e.pre+"interaction]").add("[id^="+e.pre+"ssbond]").on("click",".icn3d-residue",function(t){t.stopImmediatePropagation(),$(this).attr("id")===e.pre+"dl_sequence2"?(e.bAlignSeq=!0,e.bAnnotations=!1):(e.bAlignSeq=!1,e.bAnnotations=!0);var i=$(this).attr("id");void 0!==i&&e.selectResidues(i,this),e.icn3d.addHlObjects();var n={};for(var r in e.selectedResidues){var o=r.lastIndexOf("_");n[r.substr(0,o)]=1}e.removeHl2D();var s=Object.keys(n);e.updateHl2D(s)})},iCn3DUI.prototype.selectChainMobile=function(){var e=this;$("#"+e.pre+"dl_sequence2").add("[id^="+e.pre+"giseq]").add("[id^="+e.pre+"site]").add("[id^="+e.pre+"clinvar]").add("[id^="+e.pre+"snp]").add("[id^="+e.pre+"cdd]").add("[id^="+e.pre+"domain]").add("[id^="+e.pre+"interaction]").add("[id^="+e.pre+"ssbond]").on("click",".icn3d-seqTitle",function(t){t.stopImmediatePropagation(),$(this).attr("id")===e.pre+"dl_sequence2"?(e.bAlignSeq=!0,e.bAnnotations=!1):(e.bAlignSeq=!1,e.bAnnotations=!0),e.selectTitle(this),e.hlSummaryDomain3ddomain(this)})},iCn3DUI.prototype.removeSeqChainBkgd=function(e){void 0===e?$(".icn3d-seqTitle").each(function(e){$(this).removeClass("icn3d-highlightSeq"),$(this).removeClass("icn3d-highlightSeqBox")}):$(".icn3d-seqTitle").each(function(t){$(this).attr("chain")!==e&&($(this).removeClass("icn3d-highlightSeq"),$(this).removeClass("icn3d-highlightSeqBox"))})},iCn3DUI.prototype.removeSeqResidueBkgd=function(){$(".icn3d-residue").each(function(e){$(this).removeClass("icn3d-highlightSeq")})},iCn3DUI.prototype.update2DdgmContent=function(){var e=this,t="";void 0!==e.cfg.mmdbid||void 0!==e.cfg.gi?(t+=e.draw2Ddgm(e.interactionData,e.inputid,void 0,!0),t+=e.set2DdgmNote(),$("#"+e.pre+"dl_2ddgm").html(t)):void 0!==e.cfg.align&&(t+=e.draw2Ddgm(e.interactionData1,e.mmdbidArray[0].toUpperCase(),0,!0),t+=e.draw2Ddgm(e.interactionData2,e.mmdbidArray[1].toUpperCase(),1,!0),t+=e.set2DdgmNote(!0),$("#"+e.pre+"dl_2ddgm").html(t))},iCn3DUI.prototype.changeSeqColor=function(e){for(var t=this,i=0,n=e.length;i<n;++i){var r=e[i];if(0!==$("[id$="+t.pre+r+"]").length){var o=t.icn3d.getFirstCalphaAtomObj(t.icn3d.residues[r]),s=void 0!==o.color?"#"+o.color.getHexString():t.icn3d.defaultAtomColor;$("[id=giseq_"+t.pre+r+"]").attr("style","color:"+s),void 0!==t.cfg.align&&$("[id=align_"+t.pre+r+"]").attr("style","color:"+s)}}},iCn3DUI.prototype.removeHlAll=function(){this.removeHlObjects(),this.removeHlSeq(),this.removeHl2D(),this.removeHlMenus()},iCn3DUI.prototype.removeHlObjects=function(){this.icn3d.removeHlObjects()},iCn3DUI.prototype.removeHlSeq=function(){this.removeSeqResidueBkgd()},iCn3DUI.prototype.removeHl2D=function(){var e=this;$("#"+e.pre+"dl_2ddgm rect").attr("stroke","#000000"),$("#"+e.pre+"dl_2ddgm circle").attr("stroke","#000000"),$("#"+e.pre+"dl_2ddgm polygon").attr("stroke","#000000"),$("#"+e.pre+"dl_2ddgm svg line").attr("stroke","#000000"),$("#"+e.pre+"dl_2ddgm rect").attr("stroke-width",1),$("#"+e.pre+"dl_2ddgm circle").attr("stroke-width",1),$("#"+e.pre+"dl_2ddgm polygon").attr("stroke-width",1),$("#"+e.pre+"dl_2ddgm line").attr("stroke-width",1)},iCn3DUI.prototype.removeHlMenus=function(){$("#"+this.pre+"atomsCustom").val("")},iCn3DUI.prototype.updateHlAll=function(e,t,i,n){var r=this;r.updateHlObjects(n),void 0!==e?r.updateHlSeqInChain(e,i):r.updateHlSeq(void 0,void 0,i),r.updateHl2D(),(void 0===t||t)&&r.updateHlMenus(e)},iCn3DUI.prototype.updateHlObjects=function(e){this.icn3d.removeHlObjects(),(Object.keys(this.icn3d.hAtoms).length<Object.keys(this.icn3d.atoms).length||e)&&this.icn3d.addHlObjects()},iCn3DUI.prototype.updateHlSeq=function(e,t,i){var n=this;void 0!==i&&i||n.removeHlSeq(),void 0===t&&(t=n.icn3d.getResiduesFromCalphaAtoms(n.icn3d.hAtoms)),Object.keys(n.icn3d.hAtoms).length<Object.keys(n.icn3d.atoms).length&&n.hlSeq(Object.keys(t)),n.changeSeqColor(Object.keys(t))},iCn3DUI.prototype.updateHlSeqInChain=function(e,t){var i=this;if(void 0!==t&&t||i.removeHlSeq(),Object.keys(i.icn3d.hAtoms).length!=Object.keys(i.icn3d.atoms).length)for(var n=0,r=e.length;n<r;++n){var o=e[n];if(-1!==Object.keys(i.icn3d.chains).indexOf(o))i.hlSeqInChain(o);else{var s=[];void 0!==i.icn3d.defNames2Residues[o]&&i.icn3d.defNames2Residues[o].length>0&&(s=i.icn3d.defNames2Residues[o]);var a={};if(void 0!==i.icn3d.defNames2Atoms[o]&&i.icn3d.defNames2Atoms[o].length>0){for(var c=0,l=i.icn3d.defNames2Atoms[o].length;c<l;++c){var d=i.icn3d.atoms[i.icn3d.defNames2Atoms[o][c]];a[d.structure+"_"+d.chain+"_"+d.resi]=1}s=s.concat(Object.keys(a))}i.hlSeq(s)}}},iCn3DUI.prototype.updateHl2D=function(e){var t=this;if(t.removeHl2D(),Object.keys(t.icn3d.hAtoms).length!=Object.keys(t.icn3d.atoms).length){if(void 0===e){var i=t.icn3d.getChainsFromAtoms(t.icn3d.hAtoms);e=Object.keys(i)}if(void 0!==e)for(var n=0,r=e.length;n<r;++n){var o=t.icn3d.intHash(t.icn3d.chains[e[n]],t.icn3d.hAtoms),s=1*Object.keys(o).length/Object.keys(t.icn3d.chains[e[n]]).length,a=t.icn3d.getFirstCalphaAtomObj(o);if(void 0!==t.icn3d.alnChains[e[n]]){var c=t.icn3d.intHash(t.icn3d.alnChains[e[n]],o);Object.keys(c).length>0&&(a=t.icn3d.getFirstCalphaAtomObj(c))}var l=void 0!==a&&void 0!==a.color?"#"+a.color.getHexString():"#FFFFFF",d=$("#"+t.pre+"dl_2ddgm g[chainid="+e[n]+"] rect[class='icn3d-hlnode']"),h=$("#"+t.pre+"dl_2ddgm g[chainid="+e[n]+"] rect[class='icn3d-basenode']");void 0!==d&&(t.highlightNode("rect",d,h,s),$(d).attr("fill",l)),d=$("#"+t.pre+"dl_2ddgm g[chainid="+e[n]+"] circle[class='icn3d-hlnode']"),h=$("#"+t.pre+"dl_2ddgm g[chainid="+e[n]+"] circle[class='icn3d-basenode']"),void 0!==d&&(t.highlightNode("circle",d,h,s),$(d).attr("fill",l)),d=$("#"+t.pre+"dl_2ddgm g[chainid="+e[n]+"] polygon[class='icn3d-hlnode']"),h=$("#"+t.pre+"dl_2ddgm g[chainid="+e[n]+"] polygon[class='icn3d-basenode']"),void 0!==d&&(t.highlightNode("polygon",d,h,s),$(d).attr("fill",l))}if(void 0!==t.lineArray2d)for(n=0,r=t.lineArray2d.length;n<r;n+=2)$("#"+t.pre+"dl_2ddgm g[chainid1="+t.lineArray2d[n]+"][chainid2="+t.lineArray2d[n+1]+"] line").attr("stroke",t.ORANGE);t.icn3d.prevHighlightAtoms=t.icn3d.cloneHash(t.icn3d.hAtoms),t.setMode("selection")}},iCn3DUI.prototype.updateHlMenus=function(e){void 0===e&&(e=[]);var t=this.setAtomMenu(e);$("#"+this.pre+"atomsCustom").length&&$("#"+this.pre+"atomsCustom").html(t)},iCn3DUI.prototype.setAtomMenu=function(e){for(var t=this,i="",n=void 0!==t.icn3d.defNames2Residues?Object.keys(t.icn3d.defNames2Residues):[],r=void 0!==t.icn3d.defNames2Atoms?Object.keys(t.icn3d.defNames2Atoms):[],o=n.concat(r).sort(),s=0,a=o.length;s<a;++s){var c,l,d=o[s];if(void 0!==t.icn3d.defNames2Atoms&&t.icn3d.defNames2Atoms.hasOwnProperty(d)){var h=t.icn3d.defNames2Atoms[d];h.length>0&&(c=t.icn3d.atoms[h[0]])}else if(void 0!==t.icn3d.defNames2Residues&&t.icn3d.defNames2Residues.hasOwnProperty(d)){var u=t.icn3d.defNames2Residues[d];u.length>0&&(l=t.icn3d.residues[u[0]])&&(c=t.icn3d.atoms[Object.keys(l)[0]])}var p=void 0!==c?c.color.getHexString():"000000";-1!=e.indexOf(d)?i+="<option value='"+d+"' style='color:#"+p+"' selected='selected'>"+d+"</option>":i+="<option value='"+d+"' style='color:#"+p+"'>"+d+"</option>"}return i},iCn3DUI.prototype.setPredefinedInMenu=function(){var e=this;if(e.setChainsInMenu(),e.setProtNuclLigInMenu(),void 0!==e.cfg.align&&e.bFullUi){e.selectResidueList(e.consHash1,e.conservedName1,e.conservedName1,!1,!1),e.selectResidueList(e.consHash2,e.conservedName2,e.conservedName2,!1,!1),e.selectResidueList(e.nconsHash1,e.nonConservedName1,e.nonConservedName1,!1,!1),e.selectResidueList(e.nconsHash2,e.nonConservedName2,e.nonConservedName2,!1,!1),e.selectResidueList(e.nalignHash1,e.notAlignedName1,e.notAlignedName1,!1,!1),e.selectResidueList(e.nalignHash2,e.notAlignedName2,e.notAlignedName2,!1,!1);var t={};for(var i in e.icn3d.alnChains)t=e.icn3d.unionHash(t,e.icn3d.alnChains[i]);var n={},r={};for(var o in t){var s=e.icn3d.atoms[o],a=s.structure+"_"+s.chain;n[a+"_"+s.resi]=1,r[a]=1}var c="select "+e.residueids2spec(Object.keys(n));e.addCustomSelection(Object.keys(n),"aligned_protein","aligned protein and nucleotides",c,!0)}},iCn3DUI.prototype.hlSeq=function(e){for(var t={},i=0,n=e.length;i<n;++i){var r=e[i];0!==$("[id$="+this.pre+r+"]").length&&$("[id$="+this.pre+r+"]").addClass("icn3d-highlightSeq");var o=r.lastIndexOf("_");t[s=r.substr(0,o)]=1}for(var s in t)0!==$("#giseq_summary_"+this.pre+s).length&&$("#giseq_summary_"+this.pre+s).addClass("icn3d-highlightSeqBox")},iCn3DUI.prototype.hlSeqInChain=function(e){for(var t=this,i=0,n=t.icn3d.chainsSeq[e].length;i<n;++i){var r=e+"_"+t.icn3d.chainsSeq[e][i].resi;0!==$("#giseq_"+t.pre+r).length&&$("#giseq_"+t.pre+r).addClass("icn3d-highlightSeq")}0!==$("#giseq_summary_"+t.pre+e).length&&$("#giseq_summary_"+t.pre+e).addClass("icn3d-highlightSeqBox")},iCn3DUI.prototype.toggleHighlight=function(){var e=this;e.icn3d.prevHighlightObjects.length>0||e.icn3d.prevHighlightObjects_ghost.length>0?e.clearHighlight():e.showHighlight(),e.setLogCmd("toggle highlight",!0)},iCn3DUI.prototype.clearHighlight=function(){var e=this;e.icn3d.labels.picking=[],e.icn3d.draw(),e.icn3d.removeHlObjects(),e.removeHl2D(),e.icn3d.render(),e.removeSeqChainBkgd(),e.removeSeqResidueBkgd(),e.bSelectResidue=!1},iCn3DUI.prototype.showHighlight=function(){this.icn3d.addHlObjects(),this.updateHlAll()},iCn3DUI.prototype.highlightChains=function(e){var t=this;t.icn3d.removeHlObjects(),t.removeHl2D(),t.icn3d.addHlObjects(),t.updateHl2D(e);for(var i={},n=0,r=e.length;n<r;++n){var o=e[n];for(var s in t.icn3d.chainsSeq[o]){var a=t.icn3d.chainsSeq[o][s];""!==a.name&&"-"!==a.name&&(i[o+"_"+a.resi]=1)}}t.hlSeq(Object.keys(i))},iCn3DUI.prototype.setTools=function(){var e="";return e+="  <div id='"+this.pre+"selection' style='display:none;'><div style='position:absolute; z-index:555; float:left; display:table-row; margin: 32px 0px 0px 3px;'>",e+="    <table style='margin-top: 3px; width:100px;'><tr valign='center'>",e+=this.setTools_base(),(e+="    </tr></table>")+"  </div></div>"},iCn3DUI.prototype.setButton=function(e,t,i,n){return"<div style='margin:3px 0px 0px 10px;'><button style='-webkit-appearance:"+e+"; height:36px;"+(this.isMobile()?" background-color:#DDDDDD;":"")+"' id='"+this.pre+t+"'><span style='white-space:nowrap' class='icn3d-commandTitle' title='"+i+"'>"+n+"</span></button></div>"},iCn3DUI.prototype.setTools_base=function(){var e=this,t="",i=e.isMobile()?"none":"button";return t+="      <td valign='top'>"+e.setButton(i,"saveimage","Save iCn3D PNG Image","Save iCn3D<br/>PNG Image")+"</td>",void 0===e.cfg.cid&&(t+="      <td valign='top'>"+e.setButton(i,"definedsets","Defined Sets","Defined<br/>Sets")+"</td>",t+="      <td valign='top'>"+e.setButton(i,"show_annotations","View sequences and annotations for each chain","View Sequences<br/>& Annotations")+"</td>",void 0!==e.cfg.align&&(t+="      <td valign='top'>"+e.setButton(i,"show_alignsequences","View the sequences of the aligned structures","Aligned<br/>Sequences")+"</td>"),void 0===e.cfg.mmdbid&&void 0===e.cfg.gi&&void 0===e.cfg.blast_rep_id&&void 0===e.cfg.align||(t+="      <td valign='top'>"+e.setButton(i,"show_2ddgm","View the interactions of the structure","View<br/>Interactions")+"</td>"),t+="      <td valign='top'>"+e.setButton(i,"chemicalbindingshow","View Chemical Binding","View Chemical<br/>Binding")+"</td>",t+="      <td valign='top'>"+e.setButton(i,"alternate","Alternate the structures",'Alternate<br/>(Key "a")')+"</td>"),t+="      <td valign='top'>"+e.setButton(i,"show_selected","View ONLY the selected atoms","View Only<br/>Selection")+"</td>",t+="      <td valign='top'>"+e.setButton(i,"toggleHighlight","Turn on and off the 3D highlight in the viewer","Toggle<br/>Highlight")+"</td>",void 0===e.cfg.cid&&(t+="      <td valign='top'>"+e.setButton(i,"removeLabels","Remove Labels","Remove<br/>Labels")+"</td>"),t},iCn3DUI.prototype.setTopMenusHtml=function(e){var t=this,i="";i+="<div style='position:relative;'>",i+="<div id='"+t.pre+"popup' class='icn3d-text icn3d-popup'></div>",i+="  \x3c!--https://forum.jquery.com/topic/looking-for-a-jquery-horizontal-menu-bar--\x3e",i+="  <div id='"+t.pre+"mnlist' style='position:absolute; z-index:999; float:left; display:table-row; margin-top: -2px;'>",i+="    <table border='0' cellpadding='0' cellspacing='0' width='100'><tr>",i+="    <td valign='top'>"+t.setMenu1()+"</td>",i+="    <td valign='top'>"+t.setMenu2()+"</td>",i+="    <td valign='top'>"+t.setMenu2b()+"</td>",i+="    <td valign='top'>"+t.setMenu3()+"</td>",i+="    <td valign='top'>"+t.setMenu4()+"</td>",i+="    <td valign='top'>"+t.setMenu5()+"</td>",i+="    <td valign='top'>"+t.setMenu6()+"</td>",i+="    <td valign='top'><div style='position:relative; margin-left:6px;'><label class='icn3d-switch'><input id='"+t.pre+"modeswitch' type='checkbox'><div class='icn3d-slider icn3d-round' style='width:34px; height:18px; margin: 6px 0px 0px 3px;' title='Left (\"All atoms\"): Style and color menu options will be applied to all atoms in the structure&#13;Right (\"Selection\"): Style and color menu options will be applied only to selected atoms'></div></label>",i+="    <div class='icn3d-commandTitle' style='min-width:40px; margin-top: 3px; white-space: nowrap;'><span id='"+t.pre+"modeall' title='Style and color menu options will be applied to all atoms in the structure'>All atoms&nbsp;&nbsp;</span><span id='"+t.pre+"modeselection' class='icn3d-modeselection' style='display:none;' title='Style and color menu options will be applied only to selected atoms'>Selection&nbsp;&nbsp;</span></div></div></td>",i+='    <td valign="top"><div class="icn3d-commandTitle" style="white-space:nowrap; margin-top:10px; border-left:solid 1px #888888"><span id="'+t.pre+'selection_expand" class="icn3d-expand icn3d-link" title="Expand">&nbsp;&nbsp;Show Toolbar&nbsp;&nbsp;</span><span id="'+t.pre+'selection_shrink" class="icn3d-shrink icn3d-link" style="display:none;" title="Shrink">&nbsp;&nbsp;Hide Toolbar&nbsp;&nbsp;</span></div></td>',i+='    <td valign="top"><div class="icn3d-commandTitle" style="white-space:nowrap; margin-top:8px; border-left:solid 1px #888888">&nbsp;&nbsp;<input type="text" id="'+t.pre+'search_seq" size="10" placeholder="one-letter seq."> <button style="white-space:nowrap;" id="'+t.pre+'search_seq_button">Search Seq.</button> <a href="https://www.ncbi.nlm.nih.gov/Structure/icn3d/icn3d.html#selectb" target="_blank" title="Specification tips">?</a></div></td>',i+="  </tr>",i+="  </table>",i+="  </div>",i+=t.setTools(),i+="  <div id='"+t.pre+"title' class='icn3d-commandTitle' style='font-size:1.2em; font-weight:normal; position:absolute; z-index:1; float:left; display:table-row; margin: 85px 0px 0px 5px; color: "+t.GREYD+"'></div>",i+="  <div id='"+t.pre+"viewer' style='position:relative; width:100%; height:100%; background-color: "+t.GREYD+";'>",i+="   <div id='"+t.pre+"mnLogSection'>",i+="    <div style='height: "+t.MENU_HEIGHT+"px;'></div>",i+="   </div>",void 0===t.cfg.mmtfid&&(i+=t.realHeight<300?"    <div id='"+t.pre+"wait' style='position:absolute; top:100px; left:50px; font-size: 1.2em; color: #444444;'>Loading data...</div>":"    <div id='"+t.pre+"wait' style='position:absolute; top:180px; left:50px; font-size: 1.8em; color: #444444;'>Loading data...</div>"),i+="    <canvas id='"+t.pre+"canvas' style='width:100%; height: 100%; background-color: #000;'>Your browser does not support WebGL.</canvas>",(void 0===t.cfg.showcommand||t.cfg.showcommand)&&(i+=t.setLogWindow()),i+="  </div>",i+="</div>",i+=t.setDialogs(),i+=t.setCustomDialogs(),$("#"+e).html(i),$("accordion").accordion({collapsible:!0,active:!1,heightStyle:"content"}),$("accordion div").removeClass("ui-accordion-content ui-corner-all ui-corner-bottom ui-widget-content"),$(".icn3d-mn").menu({position:{my:"left top",at:"right top"}}),$(".icn3d-mn").hover(function(){},function(){$("accordion").accordion("option","active","none")}),$("#"+t.pre+"accordion1").hover(function(){$("#"+t.pre+"accordion1 div").css("display","block")},function(){$("#"+t.pre+"accordion1 div").css("display","none")}),$("#"+t.pre+"accordion2").hover(function(){$("#"+t.pre+"accordion2 div").css("display","block")},function(){$("#"+t.pre+"accordion2 div").css("display","none")}),$("#"+t.pre+"accordion2b").hover(function(){$("#"+t.pre+"accordion2b div").css("display","block")},function(){$("#"+t.pre+"accordion2b div").css("display","none")}),$("#"+t.pre+"accordion3").hover(function(){$("#"+t.pre+"accordion3 div").css("display","block")},function(){$("#"+t.pre+"accordion3 div").css("display","none")}),$("#"+t.pre+"accordion4").hover(function(){$("#"+t.pre+"accordion4 div").css("display","block")},function(){$("#"+t.pre+"accordion4 div").css("display","none")}),$("#"+t.pre+"accordion5").hover(function(){$("#"+t.pre+"accordion5 div").css("display","block")},function(){$("#"+t.pre+"accordion5 div").css("display","none")}),$("#"+t.pre+"accordion6").hover(function(){$("#"+t.pre+"accordion6 div").css("display","block")},function(){$("#"+t.pre+"accordion6 div").css("display","none")})},iCn3DUI.prototype.getLink=function(e,t){return"<li><span id='"+this.pre+e+"' class='icn3d-link'>"+t+"</span></li>"},iCn3DUI.prototype.getLinkWrapper=function(e,t,i){return"<li id='"+this.pre+i+"'><span id='"+this.pre+e+"' class='icn3d-link'>"+t+"</span></li>"},iCn3DUI.prototype.getRadio=function(e,t,i,n){return"<li><label for='"+this.pre+t+"' class='icn3d-rad'><input type='radio' name='"+this.pre+e+"' id='"+this.pre+t+"'"+(void 0!==n&&n?" checked":"")+"><span class='ui-icon ui-icon-blank'></span> <span class='icn3d-rad-text'>"+i+"</span></label></li>"},iCn3DUI.prototype.setMenu1=function(){var e=this,t="";return t+="    <div class='icn3d-menu'>",t+="          <accordion id='"+e.pre+"accordion1'>",t+="<h3>File</h3>",t+="<div>",t+="<ul class='icn3d-mn'>",t+="  <li><span>Retrieve by ID</span>",t+="    <ul>",t+=e.getLink("mn1_mmdbid","MMDB ID"),t+=e.getLink("mn1_mmtfid","MMTF ID"),t+=e.getLink("mn1_pdbid","PDB ID"),t+=e.getLink("mn1_mmcifid","mmCIF ID"),t+=e.getLink("mn1_gi","NCBI gi"),t+=e.getLink("mn1_cid","PubChem CID"),t+="    </ul>",t+="  </li>",t+="  <li><span>Open File</span>",t+="    <ul>",t+=e.getLink("mn1_pdbfile","PDB File"),t+=e.getLink("mn1_mmciffile","mmCIF File"),t+=e.getLink("mn1_mol2file","Mol2 File"),t+=e.getLink("mn1_sdffile","SDF File"),t+=e.getLink("mn1_xyzfile","XYZ File"),t+=e.getLink("mn1_urlfile","Url (Same Host) "),t+="      <li>-</li>",t+=e.getLink("mn1_pngimage","iCn3D PNG Image"),t+=e.getLink("mn1_state","State/Script File"),t+=e.getLink("mn1_selection","Selection File"),t+="    </ul>",t+="  </li>",t+="  <li><span>Align</span>",t+="    <ul>",t+=e.getLink("mn1_blast_rep_id","Sequence to Structure"),t+=e.getLink("mn1_align","Structure to Structure"),t+="    </ul>",t+="  </li>",t+="  <li><span>3D Printing</span>",t+="    <ul>",void 0===e.cfg.cid?(t+=e.getLink("mn1_exportVrmlStab","VRML (Color, W/  Stabilizers)"),t+=e.getLink("mn1_exportStlStab","STL (W/  Stabilizers)"),t+="      <li>-</li>",t+=e.getLink("mn1_exportVrml","VRML (Color)"),t+=e.getLink("mn1_exportStl","STL"),t+="      <li>-</li>",t+=e.getLink("mn1_stabilizerYes","Add All  Stabilizers"),t+=e.getLink("mn1_stabilizerNo","Remove All  Stabilizers"),t+="      <li>-</li>",t+=e.getLink("mn1_stabilizerOne","Add One  Stabilizer"),t+=e.getLink("mn1_stabilizerRmOne","Remove One  Stabilizer"),t+="      <li>-</li>",t+=e.getLink("mn1_thicknessSet","Set Thickness"),t+=e.getLink("mn1_thicknessReset","Reset Thickness")):(t+=e.getLink("mn1_exportVrml","VRML (Color)"),t+=e.getLink("mn1_exportStl","STL")),t+="    </ul>",t+="  </li>",t+="  <li><span>Save Files</span>",t+="    <ul>",t+=e.getLink("mn1_exportCanvas","iCn3D PNG Image"),t+=e.getLink("mn1_exportState","State File"),t+=e.getLink("mn1_exportSelections","Selection File"),t+=e.getLink("mn1_exportCounts","Residue Counts"),void 0!==e.cfg.mmdbid&&(t+=e.getLink("mn6_exportInteraction","Interaction List")),t+="    </ul>",t+="  </li>",t+=e.getLink("mn1_sharelink","Share Link"),t+="</ul>",t+="</div>",(t+="          </accordion>")+"    </div>"},iCn3DUI.prototype.setMenu2=function(){var e=this,t="";return t+="    <div class='icn3d-menu'>",t+="          <accordion id='"+e.pre+"accordion2'>",t+="<h3>Select</h3>",t+="<div>",t+="<ul class='icn3d-mn'>",t+=e.getLink("mn2_definedsets","Defined Sets"),t+=e.getLink("mn2_selectall","All"),t+=e.getLink("mn2_aroundsphere","by Distance"),t+=e.getLink("mn2_selectcomplement","Inverse"),t+=e.getLink("mn2_selectsidechains","Side Chains"),t+=e.getLink("mn2_command","Advanced"),void 0===e.cfg.cid?(t+="  <li><span>Select on 3D</span>",t+="    <ul>",t+='  <li>"Alt"+Click: start selection</li>',t+='  <li>"Ctrl"+Click: union selection</li>',t+='  <li>"Shift"+Click: range Selection</li>',t+="  <li>-</li>",t+=e.getRadio("mn2_pk","mn2_pkChain","Chain"),t+=e.getRadio("mn2_pk","mn2_pkStrand","Strand/Helix"),t+=e.getRadio("mn2_pk","mn2_pkResidue","Residue",!0),t+=e.getRadio("mn2_pk","mn2_pkYes","Atom"),t+="    </ul>",t+="  </li>"):e.isMobile()?t+="  <li><span>Touch to pick</span>":t+='  <li><span>Picking with<br>"Alt" + Click</span>',t+="  <li>-</li>",t+=e.getLink("mn2_saveselection","Save Selection"),t+=e.getLink("clearall","Clear Selection"),t+="  <li>-</li>",t+="      <li><span>Highlight Color</span>",t+="        <ul>",t+=e.getRadio("mn2_hl_clr","mn2_hl_clrYellow","Yellow",!0),t+=e.getRadio("mn2_hl_clr","mn2_hl_clrGreen","Green"),t+=e.getRadio("mn2_hl_clr","mn2_hl_clrRed","Red"),t+="        </ul>",t+="      </li>",t+="      <li><span>Highlight Style</span>",t+="        <ul>",t+=e.getRadio("mn2_hl_style","mn2_hl_styleOutline","Outline",!0),t+=e.getRadio("mn2_hl_style","mn2_hl_styleObject","3D Objects"),t+=e.getRadio("mn2_hl_style","mn2_hl_styleNone","No Highlight"),t+="        </ul>",t+="      </li>",t+="  <li><br/></li>",t+="</ul>",t+="</div>",(t+="          </accordion>")+"    </div>"},iCn3DUI.prototype.setMenu2b=function(){var e=this,t="";return t+="    <div class='icn3d-menu'>",t+="          <accordion id='"+e.pre+"accordion2b'>",t+="<h3>View</h3>",t+="<div>",t+="<ul class='icn3d-mn'>",t+=e.getLink("mn2_show_selected","View Only <br>Selection"),t+=e.getLink("mn2_selectedcenter","Zoom in <br>Selection"),t+=e.getLink("mn6_center","Center on <br>Selection"),void 0!==e.cfg.align&&(t+=e.getLink("mn2_alternate",'Alternate (Key "a")')),t+="  <li>-</li>",void 0===e.cfg.cid&&(t+="  <li><span>Chem. Binding</span>",t+="    <ul>",t+=e.getRadio("mn6_chemicalbinding","mn6_chemicalbindingshow","Show"),t+=e.getRadio("mn6_chemicalbinding","mn6_chemicalbindinghide","Hide",!0),t+="    </ul>",t+="  </li>",t+="  <li><span>H-Bonds to</span><br/><span>Selection</span>",t+="    <ul>",t+=e.getRadio("mn6_hbonds","mn6_hbondsYes","Show"),t+=e.getRadio("mn6_hbonds","mn6_hbondsNo","Hide",!0),t+="    </ul>",t+="  </li>",t+="  <li><span>Disulfide Bonds</span>",t+="    <ul>",t+=e.getRadio("mn6_ssbonds","mn6_ssbondsYes","Show",!0),t+=e.getRadio("mn6_ssbonds","mn6_ssbondsNo","Hide"),t+="    </ul>",t+="  </li>",t+="  <li><span>Cross-Linkages</span>",t+="    <ul>",t+=e.getRadio("mn6_clbonds","mn6_clbondsYes","Show"),t+=e.getRadio("mn6_clbonds","mn6_clbondsNo","Hide",!0),t+="    </ul>",t+="  </li>",void 0===e.cfg.mmtfid&&void 0===e.cfg.pdbid&&void 0===e.cfg.mmcifid&&void 0===e.cfg.mmdbid&&void 0===e.cfg.gi&&void 0===e.cfg.blast_rep_id||(t+="  <li id='"+e.pre+"assemblyWrapper'><span>Assembly</span>",t+="    <ul>",t+=e.getRadio("mn6_assembly","mn6_assemblyYes","Biological Assembly",!0),t+=e.getRadio("mn6_assembly","mn6_assemblyNo","Asymmetric Unit"),t+="    </ul>",t+="  </li>")),t+="  <li><span>Distance</span>",t+="    <ul>",t+=e.getRadio("mn6_distance","mn6_distanceYes","Measure"),t+=e.getRadio("mn6_distance","mn6_distanceNo","Hide",!0),t+="    </ul>",t+="  </li>",t+="  <li><span>Label</span>",t+="    <ul>",t+=e.getRadio("mn6_addlabel","mn6_addlabelYes","by Picking Atoms"),t+=e.getRadio("mn6_addlabel","mn6_addlabelSelection","per Selection"),void 0===e.cfg.cid&&(t+=e.getRadio("mn6_addlabel","mn6_addlabelResidues","per Residue"),t+=e.getRadio("mn6_addlabel","mn6_addlabelChains","per Chain"),t+=e.getRadio("mn6_addlabel","mn6_addlabelTermini","N- & C-Termini")),t+=e.getRadio("mn6_addlabel","mn6_addlabelNo","Remove",!0),t+="    </ul>",t+="  </li>",t+="  <li>-</li>",t+="  <li><span>Reset</span>",t+="    <ul>",t+=e.getRadio("mn6_reset","reset","All"),t+=e.getRadio("mn6_reset","mn6_resetOrientation","Orientation"),t+="    </ul>",t+="  </li>",t+="  <li><span>Transform Hints</span>",t+="    <ul>",t+="      <li><span>Rotate</span>",t+="          <ul>",t+="<li>Left Mouse</li>",t+="<li>Key L: Left</li>",t+="<li>Key J: Right</li>",t+="<li>Key I: Up</li>",t+="<li>Key M: Down</li>",t+="          </ul>",t+="      </li>",t+="      <li><span>Zoom</span>",t+="          <ul>",t+="<li>Middle Mouse</li>",t+="<li>Key Z: Zoom in</li>",t+="<li>Key X: Zoom out</li>",t+="          </ul>",t+="      </li>",t+="      <li><span>Translate</span>",t+="          <ul>",t+="<li>Right Mouse</li>",t+="          </ul>",t+="      </li>",t+="    </ul>",t+="  </li>",t+="  <li><span>Auto Rotation</span>",t+="    <ul>",t+=e.getRadio("mn6_rotate","mn6_rotateleft","Rotate Left"),t+=e.getRadio("mn6_rotate","mn6_rotateright","Rotate Right"),t+=e.getRadio("mn6_rotate","mn6_rotateup","Rotate Up"),t+=e.getRadio("mn6_rotate","mn6_rotatedown","Rotate Down"),t+="    </ul>",t+="  </li>",t+="  <li><span>Camera</span>",t+="    <ul>",t+=e.getRadio("mn6_camera","mn6_cameraPers","Perspective",!0),t+=e.getRadio("mn6_camera","mn6_cameraOrth","Orthographic"),t+="    </ul>",t+="  </li>",t+="  <li><span>Fog</span>",t+="    <ul>",t+=e.getRadio("mn6_showfog","mn6_showfogYes","On"),t+=e.getRadio("mn6_showfog","mn6_showfogNo","Off",!0),t+="    </ul>",t+="  </li>",t+="  <li><span>Slab</span>",t+="    <ul>",t+=e.getRadio("mn6_showslab","mn6_showslabYes","On"),t+=e.getRadio("mn6_showslab","mn6_showslabNo","Off",!0),t+="    </ul>",t+="  </li>",t+="  <li><span>XYZ-axes</span>",t+="    <ul>",t+=e.getRadio("mn6_showaxis","mn6_showaxisYes","Show"),t+=e.getRadio("mn6_showaxis","mn6_showaxisNo","Hide",!0),t+="    </ul>",t+="  </li>",t+=e.getLink("mn6_back","Undo"),t+=e.getLink("mn6_forward","Redo"),t+="  <li><br/></li>",t+="</ul>",t+="</div>",(t+="          </accordion>")+"    </div>"},iCn3DUI.prototype.setMenu3=function(){var e=this,t="";return t+="    <div class='icn3d-menu'>",t+="          <accordion id='"+e.pre+"accordion3'>",t+="<h3 id='"+e.pre+"style'>Style</h3>",t+="<div>",t+="<ul class='icn3d-mn'>",void 0===e.cfg.cid&&(t+="  <li><span>Proteins</span>",t+="    <ul>",t+=void 0!==e.cfg.align?e.getRadio("mn3_proteins","mn3_proteinsRibbon","Ribbon"):e.getRadio("mn3_proteins","mn3_proteinsRibbon","Ribbon",!0),t+=e.getRadio("mn3_proteins","mn3_proteinsStrand","Strand"),t+=e.getRadio("mn3_proteins","mn3_proteinsCylinder","Cylinder and Plate"),t+=e.getRadio("mn3_proteins","mn3_proteinsSchematic","Schematic"),t+=void 0!==e.cfg.align?e.getRadio("mn3_proteins","mn3_proteinsCalpha","C Alpha Trace",!0):e.getRadio("mn3_proteins","mn3_proteinsCalpha","C Alpha Trace"),t+=e.getRadio("mn3_proteins","mn3_proteinsBfactor","B-factor Tube"),t+=e.getRadio("mn3_proteins","mn3_proteinsLines","Lines"),t+=e.getRadio("mn3_proteins","mn3_proteinsStick","Stick"),t+=e.getRadio("mn3_proteins","mn3_proteinsBallstick","Ball and Stick"),t+=e.getRadio("mn3_proteins","mn3_proteinsSphere","Sphere"),t+=e.getRadio("mn3_proteins","mn3_proteinsNo","Hide"),t+="    </ul>",t+="  </li>",t+="  <li><span>Side Chains</span>",t+="    <ul>",t+=e.getRadio("mn3_sidec","mn3_sidecLines","Lines"),t+=e.getRadio("mn3_sidec","mn3_sidecStick","Stick"),t+=e.getRadio("mn3_sidec","mn3_sidecBallstick","Ball and Stick"),t+=e.getRadio("mn3_sidec","mn3_sidecSphere","Sphere"),t+=e.getRadio("mn3_sidec","mn3_sidecNo","Hide",!0),t+="    </ul>",t+="  </li>",t+="  <li><span>Nucleotides</span>",t+="    <ul>",t+=e.getRadio("mn3_nucl","mn3_nuclCartoon","Cartoon",!0),t+=e.getRadio("mn3_nucl","mn3_nuclPhos","O3' Trace"),t+=e.getRadio("mn3_nucl","mn3_nuclSchematic","Schematic"),t+=e.getRadio("mn3_nucl","mn3_nuclLines","Lines"),t+=e.getRadio("mn3_nucl","mn3_nuclStick","Stick"),t+=e.getRadio("mn3_nucl","mn3_nuclBallstick","Ball and Stick"),t+=e.getRadio("mn3_nucl","mn3_nuclSphere","Sphere"),t+=e.getRadio("mn3_nucl","mn3_nuclNo","Hide"),t+="    </ul>",t+="  </li>"),t+="  <li><span>Chemicals</span>",t+="    <ul>",t+=e.getRadio("mn3_lig","mn3_ligLines","Lines"),void 0===e.cfg.cid?(t+=e.getRadio("mn3_lig","mn3_ligStick","Stick",!0),t+=e.getRadio("mn3_lig","mn3_ligBallstick","Ball and Stick")):(t+=e.getRadio("mn3_lig","mn3_ligStick","Stick"),t+=e.getRadio("mn3_lig","mn3_ligBallstick","Ball and Stick",!0)),t+=e.getRadio("mn3_lig","mn3_ligSchematic","Schematic"),t+=e.getRadio("mn3_lig","mn3_ligSphere","Sphere"),t+=e.getRadio("mn3_lig","mn3_ligNo","Hide"),t+="    </ul>",t+="  </li>",t+="  <li><span>Ions</span>",t+="    <ul>",t+=e.getRadio("mn3_ions","mn3_ionsSphere","Sphere",!0),t+=e.getRadio("mn3_ions","mn3_ionsDot","Dot"),t+=e.getRadio("mn3_ions","mn3_ionsNo","Hide"),t+="    </ul>",t+="  </li>",t+="  <li><span>Water</span>",t+="    <ul>",t+=e.getRadio("mn3_water","mn3_waterSphere","Sphere"),t+=e.getRadio("mn3_water","mn3_waterDot","Dot"),t+=e.getRadio("mn3_water","mn3_waterNo","Hide",!0),t+="    </ul>",t+="  </li>",t+=e.getLink("mn3_setThickness","Set Thickness"),t+="  <li>-</li>",t+=e.getLink("mn3_styleSave","Save Style"),t+=e.getLink("mn3_styleApplySave","Apply Saved Style"),t+="  <li>-</li>",t+="  <li><span>Surface Type</span>",t+="    <ul>",t+=e.getRadio("mn5_surface","mn5_surfaceVDW","Van der Waals"),t+=e.getRadio("mn5_surface","mn5_surfaceVDWContext","VDW with Context"),t+=e.getRadio("mn5_surface","mn5_surfaceMolecular","Molecular Surface"),t+=e.getRadio("mn5_surface","mn5_surfaceMolecularContext","MS with Context"),t+=e.getRadio("mn5_surface","mn5_surfaceSAS","Solvent Accessible"),t+=e.getRadio("mn5_surface","mn5_surfaceSASContext","SA with Context"),t+="    </ul>",t+="  </li>",t+=e.getLink("mn5_surfaceNo","Remove Surface"),t+="  <li><span>Surface Opacity</span>",t+="    <ul>",t+=e.getRadio("mn5_opacity","mn5_opacity10","1.0",!0),t+=e.getRadio("mn5_opacity","mn5_opacity09","0.9"),t+=e.getRadio("mn5_opacity","mn5_opacity08","0.8"),t+=e.getRadio("mn5_opacity","mn5_opacity07","0.7"),t+=e.getRadio("mn5_opacity","mn5_opacity06","0.6"),t+=e.getRadio("mn5_opacity","mn5_opacity05","0.5"),t+=e.getRadio("mn5_opacity","mn5_opacity04","0.4"),t+=e.getRadio("mn5_opacity","mn5_opacity03","0.3"),t+=e.getRadio("mn5_opacity","mn5_opacity02","0.2"),t+=e.getRadio("mn5_opacity","mn5_opacity01","0.1"),t+="    </ul>",t+="  </li>",t+="  <li><span>Surface <br>Wireframe</span>",t+="    <ul>",t+=e.getRadio("mn5_wireframe","mn5_wireframeYes","Yes"),t+=e.getRadio("mn5_wireframe","mn5_wireframeNo","No",!0),t+="    </ul>",t+="  </li>",void 0===e.cfg.cid&&(t+="  <li>-</li>",t+="  <li id='"+e.pre+"mapWrapper1'><span>Electron Density</span>",t+="    <ul>",t+=e.getRadio("mn5_elecmap","mn5_elecmap2fofc","2Fo-Fc Map"),t+=e.getRadio("mn5_elecmap","mn5_elecmapfofc","Fo-Fc Map"),t+="    </ul>",t+="  </li>",t+=e.getLinkWrapper("mn5_elecmapNo","Remove Map","mapWrapper2"),t+="  <li id='"+e.pre+"mapWrapper3'><span>Map <br>Wireframe</span>",t+="    <ul>",t+=e.getRadio("mn5_mapwireframe","mn5_mapwireframeYes","Yes",!0),t+=e.getRadio("mn5_mapwireframe","mn5_mapwireframeNo","No"),t+="    </ul>",t+="  </li>",void 0===e.cfg.mmtfid&&(t+=e.getLinkWrapper("mn5_emmap","EM Density Map","emmapWrapper1"),t+=e.getLinkWrapper("mn5_emmapNo","Remove EM Map","emmapWrapper2"),t+="  <li id='"+e.pre+"emmapWrapper3'><span>EM Map <br>Wireframe</span>",t+="    <ul>",t+=e.getRadio("mn5_emmapwireframe","mn5_emmapwireframeYes","Yes",!0),t+=e.getRadio("mn5_emmapwireframe","mn5_emmapwireframeNo","No"),t+="    </ul>",t+="  </li>")),t+="  <li>-</li>",t+="  <li><span>Background</span>",t+="    <ul>",t+=e.getRadio("mn6_bkgd","mn6_bkgdTransparent","Transparent",!0),t+=e.getRadio("mn6_bkgd","mn6_bkgdBlack","Black"),t+=e.getRadio("mn6_bkgd","mn6_bkgdGrey","Grey"),t+=e.getRadio("mn6_bkgd","mn6_bkgdWhite","White"),t+="    </ul>",t+="  </li>",t+="  <li><br/></li>",t+="</ul>",t+="</div>",(t+="          </accordion>")+"    </div>"},iCn3DUI.prototype.setMenu4=function(){var e=this,t="";return t+="    <div class='icn3d-menu'>",t+="          <accordion id='"+e.pre+"accordion4'>",t+="<h3 id='"+e.pre+"color'>Color</h3>",t+="<div>",t+="<ul class='icn3d-mn'>",void 0===e.cfg.cid?(t+=e.getRadio("mn4_clr","mn4_clrSpectrum","Spectrum"),t+="  <li><span style='padding-left:2em;'>Secondary</span>",t+="    <ul>",t+=e.getRadio("mn4_clr","mn4_clrSSGreen","Sheet in Green"),t+=e.getRadio("mn4_clr","mn4_clrSSYellow","Sheet in Yellow"),t+="    </ul>",t+=e.getRadio("mn4_clr","mn4_clrCharge","Charge"),t+=e.getRadio("mn4_clr","mn4_clrHydrophobic","Hydrophobic"),t+=void 0!==e.cfg.align||void 0!==e.cfg.blast_rep_id?e.getRadio("mn4_clr","mn4_clrChain","Chain"):e.getRadio("mn4_clr","mn4_clrChain","Chain",!0),t+=e.getRadio("mn4_clr","mn4_clrResidue","Residue"),t+=e.getRadio("mn4_clr","mn4_clrAtom","Atom"),t+="  <li><span style='padding-left:2em;'>B-factor</span>",t+="    <ul>",t+=e.getRadio("mn4_clr","mn4_clrBfactor","Original"),t+=e.getRadio("mn4_clr","mn4_clrBfactorNorm","Percentile"),t+="    </ul>",void 0!==e.cfg.align?(t+=e.getRadio("mn4_clr","mn4_clrIdentity","Identity",!0),t+=e.getRadio("mn4_clr","mn4_clrConserved","Conservation")):void 0!==e.cfg.blast_rep_id&&(t+=e.getRadio("mn4_clr","mn4_clrIdentity","Identity"),t+=e.getRadio("mn4_clr","mn4_clrConserved","Conservation",!0))):t+=e.getRadio("mn4_clr","mn4_clrAtom","Atom",!0),t+="  <li>-</li>",t+="  <li><span style='padding-left:2em;'>Unicolor</span>",t+="    <ul>",t+=e.getRadio("mn4_clr","mn4_clrRed","Red"),t+=e.getRadio("mn4_clr","mn4_clrGreen","Green"),t+=e.getRadio("mn4_clr","mn4_clrBlue","Blue"),t+=e.getRadio("mn4_clr","mn4_clrMagenta","Magenta"),t+=e.getRadio("mn4_clr","mn4_clrYellow","Yellow"),t+=e.getRadio("mn4_clr","mn4_clrCyan","Cyan"),t+=e.getRadio("mn4_clr","mn4_clrWhite","White"),t+=e.getRadio("mn4_clr","mn4_clrGrey","Grey"),t+="    </ul>",t+=e.getRadio("mn4_clr","mn4_clrCustom","Color Picker"),t+="  <li>-</li>",t+=e.getLink("mn4_clrSave","Save Color"),t+=e.getLink("mn4_clrApplySave","Apply Saved Color"),t+="  <li><br/></li>",t+="</ul>",t+="</div>",(t+="          </accordion>")+"    </div>"},iCn3DUI.prototype.setMenu5=function(){var e=this,t="";return t+="    <div class='icn3d-menu'>",t+="          <accordion id='"+e.pre+"accordion5'>",t+="<h3 id='"+e.pre+"windows' style='font-size:1.2em'>&nbsp;Windows</h3>",t+="<div>",t+="<ul class='icn3d-mn'>",void 0===e.cfg.cid&&(t+=e.getLink("mn6_selectannotations","View Sequences<br>& Annotations"),void 0!==e.cfg.align&&(t+=e.getLink("mn2_alignment","View Aligned<br>Sequences")),void 0===e.cfg.mmdbid&&void 0===e.cfg.gi&&void 0===e.cfg.blast_rep_id&&void 0===e.cfg.align||(t+=e.getLink("mn2_2ddgm","View Interactions"))),void 0!==e.cfg.cid?(t+="  <li><span>Links</span>",t+="    <ul>",t+=e.getLink("mn1_link_structure","Compound Summary"),t+=e.getLink("mn1_link_vast","Similar Compounds"),t+=e.getLink("mn1_link_bind","Structures Bound"),t+="    </ul>",t+="  </li>"):(t+="  <li><span>Links</span>",t+="    <ul>",t+=e.getLink("mn1_link_structure","Structure Summary"),t+=e.getLink("mn1_link_vast","Similar Structures"),t+=e.getLink("mn1_link_pubmed","Literature"),t+=e.getLink("mn1_link_protein","Protein"),t+="    </ul>",t+="  </li>"),t+="  <li><br/></li>",t+="</ul>",t+="</div>",(t+="          </accordion>")+"    </div>"},iCn3DUI.prototype.setMenu6=function(){var e="";return e+="    <div class='icn3d-menu'>",e+="          <accordion id='"+this.pre+"accordion6'>",e+="<h3>Help</h3>",e+="<div>",e+="<ul class='icn3d-mn'>",e+="  <li><a href='https://www.ncbi.nlm.nih.gov/Structure/icn3d/docs/icn3d_about.html' target='_blank'>About iCn3D<span style='font-size:0.9em'> "+this.REVISION+"</span></a></li>",e+="  <li><a href='https://www.ncbi.nlm.nih.gov/Structure/icn3d/docs/icn3d_help.html' target='_blank'>Help Doc</a></li>",e+="  <li><span>Web APIs</span>",e+="    <ul>",e+="<li><a href='https://www.ncbi.nlm.nih.gov/Structure/icn3d/icn3d.html#HowToUse' target='_blank'>How to Use</a></li>",e+="<li><a href='https://www.ncbi.nlm.nih.gov/Structure/icn3d/icn3d.html#parameters' target='_blank'>URL Parameters</a></li>",e+="<li><a href='https://www.ncbi.nlm.nih.gov/Structure/icn3d/icn3d.html#commands' target='_blank'>Commands</a></li>",e+="    </ul>",e+="  </li>",e+="  <li><a href='https://github.com/ncbi/icn3d' target='_blank'>Source Code</a></li>",e+="  <li>-</li>",e+="  <li><span>Transform Hints</span>",e+="    <ul>",e+="      <li><span>Rotate</span>",e+="          <ul>",e+="<li>Left Mouse</li>",e+="<li>Key L: Left</li>",e+="<li>Key J: Right</li>",e+="<li>Key I: Up</li>",e+="<li>Key M: Down</li>",e+="          </ul>",e+="      </li>",e+="      <li><span>Zoom</span>",e+="          <ul>",e+="<li>Middle Mouse</li>",e+="<li>Key Z: Zoom in</li>",e+="<li>Key X: Zoom out</li>",e+="          </ul>",e+="      </li>",e+="      <li><span>Translate</span>",e+="          <ul>",e+="<li>Right Mouse</li>",e+="          </ul>",e+="      </li>",e+="    </ul>",e+="  </li>",e+="  <li><a href='https://www.ncbi.nlm.nih.gov/Structure/icn3d/icn3d.html#HowToUseStep5' target='_blank'>Selection Hints</a></li>",e+="  <li><br/></li>",e+="</ul>",e+="</div>",(e+="          </accordion>")+"    </div>"},iCn3DUI.prototype.setLogWindow=function(){var e="";return e+="  <div id='"+this.pre+"cmdlog' style='float:left; margin-top: -5px; width: 100%;'>",(e+="    <textarea id='"+this.pre+"logtext' rows='2' style='width: 100%; height: "+this.CMD_HEIGHT+"px; padding: 0px; border: 0px; background-color: "+this.GREYD+";'></textarea>")+"  </div>"},iCn3DUI.prototype.setAdvanced=function(e){var t=this,i=void 0===e?"":e,n="<div id='"+t.pre+"dl_advanced"+i+"'>";return n+="      <table width='500'><tr><td valign='top'><table cellspacing='0'>",n+="    <tr><td><b>Select:</b></td><td><input type='text' id='"+t.pre+"command"+i+"' placeholder='$[structures].[chains]:[residues]@[atoms]' size='60'></td></tr>",n+="    <tr><td><b>Name:</b></td><td><input type='text' id='"+t.pre+"command_name"+i+"' placeholder='my_selection' size='60'></td></tr>",n+="    <tr><td colspan='2' align='left'>&nbsp;&nbsp;&nbsp;<button id='"+t.pre+"command_apply"+i+"'><b>Save Selection</b></button></td></tr>",n+="      </table></td>",n+="      </tr>",n+="      <tr><td>",n+='Specification Tips: <div style="width:20px; margin-top:6px; display:inline-block;"><span id="'+t.pre+"specguide"+i+'_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+t.pre+"specguide"+i+'_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div><br>',n+="<div id='"+t.pre+"specguide"+i+"' style='display:none; width:500px' class='icn3d-box'>",n+='  <b>Specification:</b> In the selection "$1HHO,4N7N.A,B,C:5-10,KRDE,chemicals@CA,C":',n+='  <ul><li>"$1HHO,4N7N" uses "$" to indicate structure selection.<br/>',n+='  <li>".A,B,C" uses "." to indicate chain selection.<br/>',n+='  <li>":5-10,KRDE,chemicals" uses ":" to indicate residue selection. Residue selection could be residue number (5-10), one-letter sequence (KRDE), or predefined names: "proteins", "nucleotides", "chemicals", "ions", and "water".<br/>',n+='  <li>"@CA,C" uses "@" to indicate atom selection.<br/>',n+='  <li>Partial definition is allowed, e.g., ":1-10" selects all residue IDs 1-10 in all chains.<br/>',n+='  <li>Different selections can be unioned (with "<b>or</b>", default), intersected (with "<b>and</b>"), or negated (with "<b>not</b>"). For example, ":1-10 or :K" selects all residues 1-10 and all Lys residues. ":1-10 and :K" selects all Lys residues in the range of residue number 1-10. ":1-10 or not :K" selects all residues 1-10, which are not Lys residues.</ul>',n+="  <b>Set Operation:</b>",n+='  <ul><li>Users can select multiple sets in the menu "Select > Defined Sets".<br/>',n+='  <li>Different sets can be unioned (with "<b>or</b>", default), intersected (with "<b>and</b>"), or negated (with "<b>not</b>"). For example, if the "Defined Sets" menu has four sets ":1-10", ":11-20", ":5-15", and ":7-8", the command "saved atoms :1-10 or :11-20 and :5-15 not :7-8" unions all residues 1-10 and 11-20 to get the residues 1-20, then intersects with the residues 5-15 to get the residues 5-15, then exclude the residues 7-8 to get the final residues 5-6 and 9-15.</ul>',n+="  <b>Full commands in url or command window:</b>",n+="  <ul><li>Select without saving the set: select $1HHO,4N7N.A,B,C:5-10,KRDE,chemicals@CA,C<br/>",n+="  <li>Select and save: select $1HHO,4N7N.A,B,C:5-10,KRDE,chemicals@CA,C | name my_name</ul>",n+="</div>",(n+="      </td></tr></table>")+"</div>"},iCn3DUI.prototype.setDialogs=function(){var e=this,t="";t+="\x3c!-- dialog will not be part of the form --\x3e",t+="<div id='"+e.pre+"alldialogs' class='icn3d-hidden icn3d-dialog'>",t+="<div id='"+e.pre+"dl_2ddgm' class='icn3d-dl_2ddgm'>",t+="</div>",void 0!==e.cfg.align&&(t+="<div id='"+e.pre+"dl_alignment' style='background-color:white;'>",t+="  <div id='"+e.pre+"dl_sequence2' class='icn3d-dl_sequence'>",t+="  </div>",t+="</div>"),t+="<div id='"+e.pre+"dl_definedsets'>",t+="    <div id='"+e.pre+"dl_setsmenu'>",t+="        <b>Defined Sets:</b> <br/>",t+="        <select id='"+e.pre+"atomsCustom' multiple size='6' style='min-width:130px;'>",t+="        </select>",t+="        <div style='margin: 6px 0 6px 0;'><button id='"+e.pre+"deletesets'><b>Delete Selected Sets</b></button></div>",t+='        <b>Set Operations</b>: <div style="width:20px; margin-top:6px; display:inline-block;"><span id="'+e.pre+'dl_command_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+e.pre+'dl_command_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div><br>',t+="    </div>",t+="    <div id='"+e.pre+"dl_command' style='display:none;'>",t+="      <div id='"+e.pre+"dl_setoperations'>",t+="        <label for='"+e.pre+"setOr'><input type='radio' name='"+e.pre+"setOperation' id='"+e.pre+"setOr' checked> Union (or) </label><br/>",t+="        <label for='"+e.pre+"setAnd'><input type='radio' name='"+e.pre+"setOperation' id='"+e.pre+"setAnd'> Intersection (and) </label><br/>",t+="        <label for='"+e.pre+"setNot'><input type='radio' name='"+e.pre+"setOperation' id='"+e.pre+"setNot'> Exclusion (not) </label>",t+="      </div><br>",t+=e.setAdvanced(),t+="    </div>",t+="</div>",t+=e.setAdvanced(2),t+="<div id='"+e.pre+"dl_mmtfid'>",t+="MMTF ID: <input type='text' id='"+e.pre+"mmtfid' value='1TUP' size=8> ",t+="<button id='"+e.pre+"reload_mmtf'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_pdbid'>",t+="PDB ID: <input type='text' id='"+e.pre+"pdbid' value='1TUP' size=8> ",t+="<button id='"+e.pre+"reload_pdb'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_pdbfile'>",t+="PDB File: <input type='file' id='"+e.pre+"pdbfile' size=8> ",t+="<button id='"+e.pre+"reload_pdbfile'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_align'>",t+="Enter the PDB IDs or MMDB IDs of two structures that have been found to be similar by <A HREF=' https://www.ncbi.nlm.nih.gov/Structure/vastplus/vastplus.cgi'>VAST+</A> : <br/><br/>ID1: <input type='text' id='"+e.pre+"alignid1' value='1HHO' size=8>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ID2: <input type='text' id='"+e.pre+"alignid2' value='4N7N' size=8><br/><br/>",t+="<button id='"+e.pre+"reload_align_ori'>All Matching Molecules Superposed</button>&nbsp;&nbsp;&nbsp;<button id='"+e.pre+"reload_align_refined'>Invariant Substructure Superposed</button>",t+="</div>",t+="<div id='"+e.pre+"dl_mol2file'>",t+="Mol2 File: <input type='file' id='"+e.pre+"mol2file' size=8> ",t+="<button id='"+e.pre+"reload_mol2file'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_sdffile'>",t+="SDF File: <input type='file' id='"+e.pre+"sdffile' size=8> ",t+="<button id='"+e.pre+"reload_sdffile'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_xyzfile'>",t+="XYZ File: <input type='file' id='"+e.pre+"xyzfile' size=8> ",t+="<button id='"+e.pre+"reload_xyzfile'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_urlfile'>",t+="File type: ",t+="<select id='"+e.pre+"filetype'>",t+="<option value='pdb' selected>pdb</option>",t+="<option value='mol2'>mol2</option>",t+="<option value='sdf'>sdf</option>",t+="<option value='xyz'>xyz</option>",t+="</select><br/>",t+="URL in the same host: <input type='text' id='"+e.pre+"urlfile' size=20><br/> ",t+="<button id='"+e.pre+"reload_urlfile'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_mmciffile'>",t+="mmCIF File: <input type='file' id='"+e.pre+"mmciffile' value='1TUP' size=8> ",t+="<button id='"+e.pre+"reload_mmciffile'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_mmcifid'>",t+="mmCIF ID: <input type='text' id='"+e.pre+"mmcifid' value='1TUP' size=8> ",t+="<button id='"+e.pre+"reload_mmcif'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_mmdbid'>",t+="MMDB ID: <input type='text' id='"+e.pre+"mmdbid' value='1TUP' size=8> ",t+="<button id='"+e.pre+"reload_mmdb'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_blast_rep_id' style='max-width:500px;'>",t+="Enter a Sequence ID (or FASTA sequence) and the aligned Structure ID, which can be found using the <a href='https://blast.ncbi.nlm.nih.gov/Blast.cgi?PROGRAM=blastp&PAGE_TYPE=BlastSearch&DATABASE=pdb' target='_blank'>BLAST</a> search against the pdb database with the Sequence ID or FASTA sequence as input.<br><br> ",t+="<b>Sequence ID</b> (NCBI protein accession of a sequence): <input type='text' id='"+e.pre+"query_id' value='NP_001108451.1' size=8><br> ",t+="or FASTA sequence: <br><textarea id='"+e.pre+"query_fasta' rows='5' style='width: 100%; height: "+e.MENU_HEIGHT+"px; padding: 0px; border: 0px;'></textarea><br><br>",t+="<b>Structure ID</b> (NCBI protein accession of a chain of a 3D structure): <input type='text' id='"+e.pre+"blast_rep_id' value='1TSR_A' size=8><br> ",t+="<button id='"+e.pre+"reload_blast_rep_id'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_gi'>",t+="Protein gi: <input type='text' id='"+e.pre+"gi' value='1310960' size=8> ",t+="<button id='"+e.pre+"reload_gi'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_cid'>",t+="PubChem CID: <input type='text' id='"+e.pre+"cid' value='2244' size=8> ",t+="<button id='"+e.pre+"reload_cid'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_pngimage'>",t+="iCn3D PNG image: <input type='file' id='"+e.pre+"pngimage'><br/>",t+="<button id='"+e.pre+"reload_pngimage' style='margin-top: 6px;'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_state'>",t+="State file: <input type='file' id='"+e.pre+"state'><br/>",t+="<button id='"+e.pre+"reload_state' style='margin-top: 6px;'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_selection'>",t+="Selection file: <input type='file' id='"+e.pre+"selectionfile'><br/>",t+="<button id='"+e.pre+"reload_selectionfile' style='margin-top: 6px;'>Load</button>",t+="</div>",t+="<div id='"+e.pre+"dl_clr'>",t+="Click in the input box to use the color picker:<br><br> ",t+="Custom Color: <input type='text' id='"+e.pre+"colorcustom' value='FF0000' size=8> ",t+="<button id='"+e.pre+"applycustomcolor'>Apply</button>",t+="</div>",t+="<div id='"+e.pre+"dl_hbonds'>",t+="<div style='width:400px;'>To show hydrogen bonds between other residues and the current selection, please select the threshold of H-bonds.</div><br/>",t+="  <span style='white-space:nowrap;font-weight:bold;'>Threshold: <select id='"+e.pre+"hbondthreshold'>",t+="  <option value='3.2'>3.2</option>",t+="  <option value='3.3'>3.3</option>",t+="  <option value='3.4'>3.4</option>",t+="  <option value='3.5' selected>3.5</option>",t+="  <option value='3.6'>3.6</option>",t+="  <option value='3.7'>3.7</option>",t+="  <option value='3.8'>3.8</option>",t+="  <option value='3.9'>3.9</option>",t+="  <option value='4.0'>4.0</option>",t+="  </select> &#197;</span> <span style='white-space:nowrap; margin-left:30px;'><button id='"+e.pre+"applyhbonds'>Display</button></span>",t+="</div>",t+="<div id='"+e.pre+"dl_elecmap2fofc'>",t+="  <span style='white-space:nowrap;font-weight:bold;'>Contour at: <select id='"+e.pre+"sigma2fofc'>",t+="  <option value='0'>0</option>",t+="  <option value='0.5'>0.5</option>",t+="  <option value='1'>1</option>",t+="  <option value='1.5' selected>1.5</option>",t+="  <option value='2'>2</option>",t+="  <option value='3'>3</option>",t+="  <option value='4'>4</option>",t+="  <option value='5'>5</option>",t+="  <option value='6'>6</option>",t+="  <option value='7'>7</option>",t+="  <option value='8'>8</option>",t+="  <option value='9'>9</option>",t+="  <option value='10'>10</option>",t+="  </select> &sigma;</span> <span style='white-space:nowrap; margin-left:30px;'><button id='"+e.pre+"applymap2fofc'>Display</button></span> <span style='white-space:nowrap; margin-left:30px;'><button id='"+e.pre+"elecmapNo2'>Remove Map</button></span>",t+="</div>",t+="<div id='"+e.pre+"dl_elecmapfofc'>",t+="  <span style='white-space:nowrap;font-weight:bold;'>Contour at: <select id='"+e.pre+"sigmafofc'>",t+="  <option value='0'>0</option>",t+="  <option value='0.5'>0.5</option>",t+="  <option value='1'>1</option>",t+="  <option value='1.5'>1.5</option>",t+="  <option value='2'>2</option>",t+="  <option value='3' selected>3</option>",t+="  <option value='4'>4</option>",t+="  <option value='5'>5</option>",t+="  <option value='6'>6</option>",t+="  <option value='7'>7</option>",t+="  <option value='8'>8</option>",t+="  <option value='9'>9</option>",t+="  <option value='10'>10</option>",t+="  </select> &sigma;</span> <span style='white-space:nowrap; margin-left:30px;'><button id='"+e.pre+"applymapfofc'>Display</button></span> <span style='white-space:nowrap; margin-left:30px;'><button id='"+e.pre+"elecmapNo3'>Remove Map</button></span>",t+="</div>",t+="<div id='"+e.pre+"dl_emmap'>",t+="  <span style='white-space:nowrap;font-weight:bold;'>Contour at: <select id='"+e.pre+"empercentage'>",t+="  <option value='0'>0</option>",t+="  <option value='10'>10</option>",t+="  <option value='20'>20</option>",t+="  <option value='30' selected>30</option>",t+="  <option value='40'>40</option>",t+="  <option value='50'>50</option>",t+="  <option value='60'>60</option>",t+="  <option value='70'>70</option>",t+="  <option value='80'>80</option>",t+="  <option value='90'>90</option>",t+="  <option value='100'>100</option>",t+="  </select> % of maximum EM values</span><br><span style='white-space:nowrap; margin-left:30px;'><button id='"+e.pre+"applyemmap'>Display</button></span> <span style='white-space:nowrap; margin-left:30px;'><button id='"+e.pre+"emmapNo2'>Remove EM Map</button></span>",t+="</div>",t+="<div id='"+e.pre+"dl_aroundsphere'>",t+="  <span style='white-space:nowrap'>1. Sphere with a radius: <input type='text' id='"+e.pre+"radius_aroundsphere' value='4' size='2'> &#197;</span><br/>",t+="  <span style='white-space:nowrap'>2. <button id='"+e.pre+"applypick_aroundsphere'>Display</button> the sphere around currently selected atoms</span>",t+="</div>",t+="<div id='"+e.pre+"dl_addlabel'>",t+="1. Text: <input type='text' id='"+e.pre+"labeltext' value='Text' size=4><br/>",t+="2. Size: <input type='text' id='"+e.pre+"labelsize' value='18' size=4 maxlength=2><br/>",t+="3. Color: <input type='text' id='"+e.pre+"labelcolor' value='ffff00' size=4><br/>",t+="4. Background: <input type='text' id='"+e.pre+"labelbkgd' value='cccccc' size=4><br/>",e.isMobile()?t+="  <span style='white-space:nowrap'>5. Touch TWO atoms</span><br/>":t+="  <span style='white-space:nowrap'>5. Pick TWO atoms while holding \"Alt\" key</span><br/>",t+="<span style='white-space:nowrap'>6. <button id='"+e.pre+"applypick_labels'>Display</button></span>",t+="</div>",t+="<div id='"+e.pre+"dl_addlabelselection'>",t+="1. Text: <input type='text' id='"+e.pre+"labeltext2' value='Text' size=4><br/>",t+="2. Size: <input type='text' id='"+e.pre+"labelsize2' value='18' size=4 maxlength=2><br/>",t+="3. Color: <input type='text' id='"+e.pre+"labelcolor2' value='ffff00' size=4><br/>",t+="4. Background: <input type='text' id='"+e.pre+"labelbkgd2' value='cccccc' size=4><br/>",t+="<span style='white-space:nowrap'>5. <button id='"+e.pre+"applyselection_labels'>Display</button></span>",t+="</div>",t+="<div id='"+e.pre+"dl_distance'>",e.isMobile()?t+="  <span style='white-space:nowrap'>1. Touch TWO atoms</span><br/>":t+="  <span style='white-space:nowrap'>1. Pick TWO atoms while holding \"Alt\" key</span><br/>",t+="  <span style='white-space:nowrap'>2. Color: <input type='text' id='"+e.pre+"distancecolor' value='ffff00' size=4><br/>",t+="  <span style='white-space:nowrap'>3. <button id='"+e.pre+"applypick_measuredistance'>Display</button></span>",t+="</div>",t+="<div id='"+e.pre+"dl_stabilizer'>",e.isMobile()?t+="  <span style='white-space:nowrap'>1. Touch TWO atoms</span><br/>":t+="  <span style='white-space:nowrap'>1. Pick TWO atoms while holding \"Alt\" key</span><br/>",t+="  <span style='white-space:nowrap'>2. Color: <input type='text' id='"+e.pre+"stabilizercolor' value='ffffff' size=4><br/>",t+="  <span style='white-space:nowrap'>3. <button id='"+e.pre+"applypick_stabilizer'>Add</button></span>",t+="</div>",t+="<div id='"+e.pre+"dl_stabilizer_rm'>",e.isMobile()?t+="  <span style='white-space:nowrap'>1. Touch TWO atoms</span><br/>":t+="  <span style='white-space:nowrap'>1. Pick TWO atoms while holding \"Alt\" key</span><br/>",t+="  <span style='white-space:nowrap'>2. <button id='"+e.pre+"applypick_stabilizer_rm'>Remove</button></span>",t+="</div>",t+="<div id='"+e.pre+"dl_thickness'>",t+=e.setThicknessHtml("3dprint"),t+="</div>",t+="<div id='"+e.pre+"dl_thickness2'>",t+=e.setThicknessHtml("style"),t+="</div>",t+="<div id='"+e.pre+"dl_addtrack'>",t+="     <input type='hidden' id='"+e.pre+"track_chainid' value=''>",t+="    <div id='"+e.pre+"dl_addtrack_tabs' style='border:0px;'>",t+="      <ul>",t+="        <li><a href='#"+e.pre+"tracktab1'>NCBI gi/Accession</a></li>",t+="        <li><a href='#"+e.pre+"tracktab2'>FASTA</a></li>",t+="        <li><a href='#"+e.pre+"tracktab3'>BED File</a></li>",t+="        <li><a href='#"+e.pre+"tracktab4'>Custom</a></li>",t+="        <li><a href='#"+e.pre+"tracktab5'>Current Selection</a></li>",t+="      </ul>",t+="      <div id='"+e.pre+"tracktab1'>",t+="NCBI gi/Accession: <input type='text' id='"+e.pre+"track_gi' placeholder='gi' size=16> <br><br>",t+="<button id='"+e.pre+"addtrack_button1'>Add Track</button>",t+="      </div>",t+="      <div id='"+e.pre+"tracktab2'>",t+="FASTA sequence: <br><textarea id='"+e.pre+"track_fasta' rows='5' style='width: 100%; height: "+2*e.MENU_HEIGHT+"px; padding: 0px; border: 0px;'></textarea><br><br>",t+="<button id='"+e.pre+"addtrack_button2'>Add Track</button>",t+="      </div>",t+="      <div id='"+e.pre+"tracktab3'>",t+="BED file: <input type='file' id='"+e.pre+"track_bed' size=16> <br><br>",t+="<button id='"+e.pre+"addtrack_button3'>Add Track</button>",t+="      </div>",t+="      <div id='"+e.pre+"tracktab4'>",t+="Track Title: <input type='text' id='"+e.pre+"track_title' placeholder='track title' size=16> <br><br>",t+='Track Text (e.g., "152 G, 155-156 RR" defines a character "G" at the position 152 and two continuous characters "RR" at positions from 155 to 156. The starting position is 1): <br>',t+="<textarea id='"+e.pre+"track_text' rows='5' style='width: 100%; height: "+2*e.MENU_HEIGHT+"px; padding: 0px; border: 0px;'></textarea><br><br>",t+="<button id='"+e.pre+"addtrack_button4'>Add Track</button>",t+="      </div>",t+="      <div id='"+e.pre+"tracktab5'>",t+="Track Title: <input type='text' id='"+e.pre+"track_selection' placeholder='track title' size=16> <br><br>",t+="<button id='"+e.pre+"addtrack_button5'>Add Track</button>",t+="      </div>",t+="    </div>",t+="</div>",t+="<div id='"+e.pre+"dl_saveselection'>";var i=e.icn3d?Object.keys(e.icn3d.defNames2Atoms).length:1;return t+="Name: <input type='text' id='"+e.pre+"seq_command_name' value='seq_"+i+"' size='5'> <br>",t+="<button style='white-space:nowrap;' id='"+e.pre+"seq_saveselection'>Save</button> <button style='white-space:nowrap; margin-left:20px;' id='"+e.pre+"seq_clearselection'>Clear</button><br/><br/>",t+="</div>",t+="<div id='"+e.pre+"dl_copyurl'>",t+="Please copy one of the URLs below. They work the same way.<br><br>",t+="Original URL with commands: <br><textarea id='"+e.pre+"ori_url' rows='4' style='width:100%'></textarea><br><br>",t+="Short URL: <br><input type='text' id='"+e.pre+"short_url' value='' style='width:100%'><br><br>",t+="</div>",t+="<div id='"+e.pre+"dl_selectannotations' class='icn3d-annotation' style='background-color:white;'>",t+="    <div id='"+e.pre+"dl_annotations_tabs'>",t+="<div id='"+e.pre+"dl_anno_view_tabs' style='border:0px; height:33px;'>",t+="      <ul>",t+="        <li><a href='#"+e.pre+"anno_tmp1' id='"+e.pre+"anno_summary'>Summary</a></li>",t+="        <li><a href='#"+e.pre+"anno_tmp2' id='"+e.pre+"anno_details'>Details</a></li>",t+="      </ul>",t+="      <div id='"+e.pre+"anno_tmp1'>",t+="      </div>",t+="      <div id='"+e.pre+"anno_tmp2'>",t+="      </div>",t+="</div>",t+="      <div class='icn3d-box' style='width:520px;'><b>Annotations:&nbsp;</b><br><table border=0><tr>",t+="        <td style='min-width:60px;'><input type='checkbox' id='"+e.pre+"anno_all'>All&nbsp;&nbsp;</td>",t+="        <td style='min-width:130px;'><input type='checkbox' id='"+e.pre+"anno_cdd' checked>Conserved Domains&nbsp;&nbsp;</td>",t+="        <td style='min-width:60px;'><input type='checkbox' id='"+e.pre+"anno_clinvar'>ClinVar&nbsp;&nbsp;</td>",t+="        <td style='min-width:110px;'><input type='checkbox' id='"+e.pre+"anno_binding'>Functional Sites&nbsp;&nbsp;</td>",t+="        <td style='min-width:110px;'><input type='checkbox' id='"+e.pre+"anno_ssbond'>Disulfide Bonds&nbsp;&nbsp;</td>",t+="      </tr><tr>",t+="        <td style='min-width:60px;'><input type='checkbox' id='"+e.pre+"anno_custom'>Custom&nbsp;&nbsp;</td>",t+="        <td style='min-width:130px;'><input type='checkbox' id='"+e.pre+"anno_3dd'>3D Domains&nbsp;&nbsp;</td>",t+="        <td style='min-width:60px;'><input type='checkbox' id='"+e.pre+"anno_snp'>SNPs&nbsp;&nbsp;</td>",t+="        <td style='min-width:110px;'><input type='checkbox' id='"+e.pre+"anno_interact'>Interactions&nbsp;&nbsp;</td>",t+="        <td></td>",t+="      </tr></table></div>",t+="<button style='white-space:nowrap; margin-left:5px;' id='"+e.pre+"showallchains'>Show All Chains</button><br>",t+="    <div id='"+e.pre+"seqguide_wrapper' style='display:none'><br>"+e.setSequenceGuide("2")+"</div>",t+="    </div><br/><hr><br>",t+="    <div id='"+e.pre+"dl_annotations'>",t+="    </div>",t+="</div>",(t+="</div>")+"\x3c!--/form--\x3e"},iCn3DUI.prototype.setThicknessHtml=function(e){var t=this,i="";return i+="<b>Line Radius</b>: <input type='text' id='"+t.pre+"linerad_"+e+"' value='"+("3dprint"==e?"1":"0.1")+"' size=4>&nbsp;&nbsp;&nbsp;(for stabilizers, hydrogen bonds, distance lines, default 0.1)<br/>",i+="<b>Coil Radius</b>: <input type='text' id='"+t.pre+"coilrad_"+e+"' value='"+("3dprint"==e?"1.2":"0.3")+"' size=4>&nbsp;&nbsp;&nbsp;(for coils, default 0.3)<br/>",i+="<b>Stick Radius</b>: <input type='text' id='"+t.pre+"stickrad_"+e+"' value='"+("3dprint"==e?"0.8":"0.4")+"' size=4>&nbsp;&nbsp;&nbsp;(for sticks, default 0.4)<br/>",i+="<b>Trace Radius</b>: <input type='text' id='"+t.pre+"tracerad_"+e+"' value='"+("3dprint"==e?"1":"0.2")+"' size=4>&nbsp;&nbsp;&nbsp;(for C alpha trace, O3' trace, default 0.2)<br/>",i+="<b>Ribbon Thickness</b>: <input type='text' id='"+t.pre+"ribbonthick_"+e+"' value='"+("3dprint"==e?"1":"0.2")+"' size=4>&nbsp;&nbsp;&nbsp;(for helix and sheet ribbons, nucleotide ribbons, default 0.2)<br/>",i+="<b>Protein Ribbon Width</b>: <input type='text' id='"+t.pre+"prtribbonwidth_"+e+"' value='"+("3dprint"==e?"2":"1.3")+"' size=4>&nbsp;&nbsp;&nbsp;(for helix and sheet ribbons, default 1.3)<br/>",i+="<b>Nucleotide Ribbon Width</b>: <input type='text' id='"+t.pre+"nucleotideribbonwidth_"+e+"' value='"+("3dprint"==e?"1.4":"0.8")+"' size=4>&nbsp;&nbsp;&nbsp;(for nucleotide ribbons, default 0.8)<br/>",(i+="<b>Ball Scale</b>: <input type='text' id='"+t.pre+"ballscale_"+e+"' value='"+("3dprint"==e?"0.6":"0.3")+"' size=4>&nbsp;&nbsp;&nbsp;(for styles 'Ball and Stick' and 'Dot', default 0.3)<br/>")+"<span style='white-space:nowrap'><button id='"+t.pre+"apply_thickness_"+e+"'>Preview</button></span>"},iCn3DUI.prototype.setSequenceGuide=function(e,t){var i=this,n="",r=i.icn3d?Object.keys(i.icn3d.defNames2Atoms).length:1;return t?n+="<div id='"+i.pre+"seqguide"+e+"'>":(n+='<div style="width:20px; margin-left:3px; display:inline-block;"><span id="'+i.pre+"seqguide"+e+'_expand" class="ui-icon ui-icon-plus icn3d-expand icn3d-link" style="width:15px;" title="Expand"></span><span id="'+i.pre+"seqguide"+e+'_shrink" class="ui-icon ui-icon-minus icn3d-shrink icn3d-link" style="display:none; width:15px;" title="Shrink"></span></div> ',n+="<div style='min-width:200px; display:inline-block;'><b>Selection:</b> Name: <input type='text' id='"+i.pre+"seq_command_name"+e+"' value='seq_"+r+"' size='5'> &nbsp;&nbsp;<button style='white-space:nowrap;' id='"+i.pre+"seq_saveselection"+e+"'>Save</button> <button style='white-space:nowrap; margin-left:20px;' id='"+i.pre+"seq_clearselection"+e+"'>Clear</button></div><br/>",n+="<div id='"+i.pre+"seqguide"+e+"' style='display:none; white-space:normal;' class='icn3d-box'>"),i.isMobile()?n+='<b>Select Sequences:</b> touch to select, touch again to deselect, multiple selection is allowed without Ctrl key, click "Save Selection" to save the current selection.<br/><br/>':(n+='<b>Select on 1D sequences:</b> drag to select, drag again to deselect, multiple selection is allowed without Ctrl key, click "Save Selection" to save the current selection.<br/><br/>',n+='<b>Select on 2D interaction diagram:</b> click on the nodes or lines. The nodes are chains and can be united with the Ctrl key. The lines are interactions and can NOT be united. Each click on the lines selects half of the lines, i.e., select the interacting residues in one of the two chains. The selected residues are saved in the "Select -> Advanced" menu.<br/><br/>',n+="<b>Select on 3D structures:</b> "+(i.isMobile()?"use finger to pick":'hold "Alt" and use mouse to pick')+', click the second time to deselect, hold "Ctrl" to union selection, hold "Shift" to select a range, press the up/down arrow to switch among atom/residue/strand/chain/structure, click "Save Selection" to save the current selection.<br/><br/>',n+='<b>Save the current selection</b> (either on 3D structure, 2D interactions, or 1D sequence): open the menu "Select -> Save Selection", specify the name and description for the selection, and click "Save".<br/><br/>'),n+"<b>Residue labeling:</b> standard residue with coordinates: UPPER case letter; nonstandard residue with coordinates: the first UPPER case letter plus a period except that water residue uses the letter 'O'; residue missing coordinates: lower case letter."+(i.isMac()&&!i.isMobile()?"<br/><br/><b>Turn on scroll bar:</b> System preferences -> General -> show scroll bars -> check Always":"")+"<br/></div>"},iCn3DUI.prototype.getAlignSequencesAnnotations=function(e,t,i,n){var r,o=this,s=o.isMac()&&!o.isMobile()?"<br/><b>Turn on scroll bar:</b> System preferences -> General -> show scroll bars -> check Always":"";o.isMobile()?r='<b>Select Aligned Sequences:</b> touch to select, touch again to deselect, multiple selection is allowed without Ctrl key, click "Save Selection" to save the current selection.<br/>':(r='<b>Select on 1D sequences:</b> drag to select, drag again to deselect, multiple selection is allowed without Ctrl key, click "Save Selection" to save the current selection.<br/>',r+='<b>Select on 2D interaction diagram:</b> click on the nodes or lines. The nodes are chains and can be united with the Ctrl key. The lines are interactions and can NOT be united. Each click on the lines selects half of the lines, i.e., select the interacting residues in one of the two chains. The selected residues are saved in the "Select -> Advanced" menu.<br/><br/>',r+="<b>Select on 3D structures:</b> "+(o.isMobile()?"use finger to pick":'hold "Alt" and use mouse to pick')+', click the second time to deselect, hold "Ctrl" to union selection, hold "Shift" to select a range, press the up/down arrow to switch among atom/residue/strand/chain/structure, click "Save Selection" to save the current selection.<br/>',r+='<b>Save the current selection</b> (either on 3D structure, 2D interactions, or 1D sequence): open the menu "Select -> Save Selection", specify the name and description for the selection, and click "Save".<br/><br/>'),r+="<div style='min-width:200px;'><b>Selection:</b> Name: <input type='text' id='"+o.pre+"alignseq_command_name' value='alseq_"+Object.keys(o.icn3d.defNames2Atoms).length+"' size='10'> &nbsp;&nbsp;<button style='white-space:nowrap;' id='"+o.pre+"alignseq_saveselection'>Save</button> <button style='white-space:nowrap; margin-left:20px;' id='"+o.pre+"alignseq_clearselection'>Clear</button></div><br/>",r+="<b>Residue labeling:</b> aligned residue with coordinates: UPPER case letter; non-aligned residue with coordinates: lower case letter which can be highlighted; residue missing coordinates: lower case letter which can NOT be highlighted."+s+"<br/>";var a=0,c={};if(void 0!==e)for(var l=0,d=e.length;l<d;++l)c[e[l]]=1;var h=Object.keys(o.icn3d.hAtoms).length==Object.keys(o.icn3d.atoms).length&&u&&(void 0===t||t);for(var l in h&&(o.icn3d.hAtoms={}),o.icn3d.alnChains){var u=!(void 0===e||!c.hasOwnProperty(l));h&&(o.icn3d.hAtoms=o.icn3d.unionHash(o.icn3d.hAtoms,o.icn3d.alnChains[l]));var p=[],m="",f=void 0!==o.icn3d.alnChainsSeq[l]?o.icn3d.alnChainsSeq[l].length:0;f>a&&(a=f);var g=l.indexOf("_"),v=l.substr(0,g),y=l.substr(g+1);m+="<span class='icn3d-residueNum' title='starting residue number'>"+o.icn3d.alnChainsSeq[l][0].resi+"</span>",u=!(void 0===e||!c.hasOwnProperty(l));for(var b=0,_=f;b<_;++b){var w="";""===o.icn3d.alnChainsSeq[l][b].resi||isNaN(o.icn3d.alnChainsSeq[l][b].resi)||(w=v+"_"+y+"_"+o.icn3d.alnChainsSeq[l][b].resi);var x,C="class='icn3d-residue";if((void 0===n||n)&&(u||void 0!==i&&""!==w&&-1!==i.indexOf(w))&&(C="class='icn3d-residue icn3d-highlightSeq"),C+=""===w?"'":" "+o.icn3d.alnChainsSeq[l][b].class+"'",o.icn3d.residues.hasOwnProperty(w)){var S=o.icn3d.getFirstCalphaAtomObj(o.icn3d.residues[w]);x=void 0!==S.color?"#"+S.color.getHexString()+";":"#000000;"}else x="#000000;";"#FFFFFF;"===x.toUpperCase()&&(x=o.GREYD),m+=""!==w?-1!=o.icn3d.alnChainsSeq[l][b].resi?"<span id='align_"+o.pre+w+"' "+C+" style='color:"+x+"' title='"+o.icn3d.alnChainsSeq[l][b].resn+o.icn3d.alnChainsSeq[l][b].resi+"'>"+o.icn3d.alnChainsSeq[l][b].resn+"</span>":"<span>"+o.icn3d.alnChainsSeq[l][b].resn+"</span>":"<span title='"+o.icn3d.alnChainsSeq[l][b].resn+o.icn3d.alnChainsSeq[l][b].resi+"'>"+o.icn3d.alnChainsSeq[l][b].resn+"</span>"}m+="<span class='icn3d-residueNum' title='ending residue number'>"+o.icn3d.alnChainsSeq[l][f-1].resi+"</span>";for(var E=void 0!==o.icn3d.alnChainsAnno[l]?o.icn3d.alnChainsAnno[l].length:0,M=0,T=E;M<T;++M){p[M]="";var A=0==M?o.icn3d.alnChainsAnTtl[l][4][0]:l;for(p[M]+="<span class='icn3d-residueNum'></span>",b=0,_=o.icn3d.alnChainsAnno[l][M].length;b<_;++b){var k=o.icn3d.alnChainsAnno[l][M][b];if("H"==k||"E"==k||"c"==k||"o"==k)if("H"==k)p[M]+=b%2==0?'<span class="icn3d-helix">&nbsp;</span>':'<span class="icn3d-helix2">&nbsp;</span>';else if("E"==k){if(void 0!==o.icn3d.alnChainsSeq[A][b]&&o.icn3d.residues.hasOwnProperty(w=A+"_"+o.icn3d.alnChainsSeq[A][b].resi)){var R=o.icn3d.getFirstCalphaAtomObj(o.icn3d.residues[w]);p[M]+=R.ssend?'<span class="icn3d-sheet2">&nbsp;</span>':'<span class="icn3d-sheet">&nbsp;</span>'}}else p[M]+="c"==k?'<span class="icn3d-coil">&nbsp;</span>':"o"==k?'<span class="icn3d-other">&nbsp;</span>':"<span></span>";else p[M]+="<span>"+k+"</span>"}p[M]+="<span class='icn3d-residueNum'></span>"}var D=l,L=void 0!==o.icn3d.pdbid_chain2title?o.icn3d.pdbid_chain2title[l]:"";for(M=E-1;M>=0;--M){var I=o.icn3d.alnChainsAnTtl[l][M][0];"SS"==I&&(I=""),r+="<div class='icn3d-residueLine' style='white-space:nowrap;'><div class='icn3d-seqTitle' anno='"+M+"'>"+I+"</div>"+p[M]+"<br/></div>"}r+='<div class="icn3d-seqTitle icn3d-link icn3d-blue" chain="'+l+'" anno="sequence" title="'+L+'">'+D+' </div><span class="icn3d-seqLine">'+m+"</span><br/>"}return{sequencesHtml:r,maxSeqCnt:a}},iCn3DUI.prototype.openDialogHalfWindow=function(e,t,i,n){var r,o=this;o.resizeCanvas(o.WIDTH-i-o.LESSWIDTH,o.HEIGHT-o.LESSHEIGHT-o.EXTRAHEIGHT,n),height=o.HEIGHT-o.LESSHEIGHT-o.EXTRAHEIGHT,width=i,r=o.cfg.showmenu?{my:"left top",at:"right top+40",of:"#"+o.pre+"viewer",collision:"none"}:{my:"left top",at:"right top",of:"#"+o.pre+"viewer",collision:"none"},o.cfg.resize=!1,window.dialog=$("#"+e).dialog({autoOpen:!0,title:t,height:height,width:width,modal:!1,position:r,close:function(t){var i=$("#"+o.pre+"dl_selectannotations").hasClass("ui-dialog-content"),n=$("#"+o.pre+"dl_alignment").hasClass("ui-dialog-content"),r=$("#"+o.pre+"dl_2ddgm").hasClass("ui-dialog-content"),s=$("#"+o.pre+"dl_definedsets").hasClass("ui-dialog-content"),a=!1,c=!1,l=!1,d=!1;i&&(a=$("#"+o.pre+"dl_selectannotations").dialog("isOpen")),n&&(c=$("#"+o.pre+"dl_alignment").dialog("isOpen")),r&&(l=$("#"+o.pre+"dl_2ddgm").dialog("isOpen")),s&&(d=$("#"+o.pre+"dl_definedsets").dialog("isOpen")),(e===o.pre+"dl_selectannotations"&&!c||e===o.pre+"dl_alignment"&&!a)&&(l||d?(o.resizeCanvas(o.WIDTH-o.LESSWIDTH-170,o.HEIGHT-o.LESSHEIGHT-o.EXTRAHEIGHT,!0),l&&o.openDialog2Ddgm(o.pre+"dl_2ddgm",void 0,d),d&&o.openDialog2Ddgm(o.pre+"dl_definedsets")):o.resizeCanvas(o.WIDTH-o.LESSWIDTH,o.HEIGHT-o.LESSHEIGHT-o.EXTRAHEIGHT,!0))},resize:function(t){e==o.pre+"dl_selectannotations"&&o.hideFixedTitle()}})},iCn3DUI.prototype.openDialog2Ddgm=function(e,t,i){var n,r,o=this;e===o.pre+"dl_definedsets"?(n="right top",r="Select sets"):e===o.pre+"dl_2ddgm"&&(n=void 0!==i&&i?"right top+240":"right top",r="Interactions");var s={my:"left top+"+o.MENU_HEIGHT,at:n,of:"#"+o.pre+"viewer",collision:"none"};window.dialog=$("#"+e).dialog({autoOpen:!0,title:r,height:"auto",width:170,modal:!1,position:s,close:function(e){var t=$("#"+o.pre+"dl_selectannotations").hasClass("ui-dialog-content"),i=$("#"+o.pre+"dl_alignment").hasClass("ui-dialog-content"),n=$("#"+o.pre+"dl_2ddgm").hasClass("ui-dialog-content"),r=$("#"+o.pre+"dl_definedsets").hasClass("ui-dialog-content"),s=!1,a=!1;t&&(s=$("#"+o.pre+"dl_selectannotations").dialog("isOpen")),i&&(a=$("#"+o.pre+"dl_alignment").dialog("isOpen")),n&&$("#"+o.pre+"dl_2ddgm").dialog("isOpen"),r&&$("#"+o.pre+"dl_definedsets").dialog("isOpen"),s||a||o.resizeCanvas(o.WIDTH-o.LESSWIDTH,o.HEIGHT-o.LESSHEIGHT-o.EXTRAHEIGHT,!0)}})},iCn3DUI.prototype.openDialog=function(e,t){var i=this,n=400,r=150,o=$("#"+i.pre+"dl_selectannotations").hasClass("ui-dialog-content"),s=$("#"+i.pre+"dl_alignment").hasClass("ui-dialog-content"),a=$("#"+i.pre+"dl_2ddgm").hasClass("ui-dialog-content"),c=$("#"+i.pre+"dl_definedsets").hasClass("ui-dialog-content"),l=!1,d=!1,h=!1,u=!1;if(o&&(l=$("#"+i.pre+"dl_selectannotations").dialog("isOpen")),s&&(d=$("#"+i.pre+"dl_alignment").dialog("isOpen")),a&&(h=$("#"+i.pre+"dl_2ddgm").dialog("isOpen")),c&&(u=$("#"+i.pre+"dl_definedsets").dialog("isOpen")),e===i.pre+"dl_selectannotations"||e===i.pre+"dl_alignment"){var p=.5*(i.WIDTH-i.LESSWIDTH)-85;if(i.WIDTH-i.LESSWIDTH>=i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT)i.openDialogHalfWindow(e,t,p,!0),(h||u)&&(i.resizeCanvas(i.WIDTH-i.LESSWIDTH-p-170,i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT,!0),h&&i.openDialog2Ddgm(i.pre+"dl_2ddgm",void 0,u),u&&i.openDialog2Ddgm(i.pre+"dl_definedsets"));else{i.resizeCanvas(i.WIDTH-i.LESSWIDTH,.5*(i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT),!0),r=.5*(i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT),n=i.WIDTH-i.LESSWIDTH;var m={my:"left top",at:"left bottom+32",of:"#"+i.pre+"canvas",collision:"none"};window.dialog=$("#"+e).dialog({autoOpen:!0,title:t,height:r,width:n,modal:!1,position:m,close:function(t){(e===i.pre+"dl_selectannotations"&&!d||e===i.pre+"dl_alignment"&&!l)&&(h||u?(i.resizeCanvas(i.WIDTH-i.LESSWIDTH-170,i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT,!0),h&&i.openDialog2Ddgm(i.pre+"dl_2ddgm",void 0,u),u&&i.openDialog2Ddgm(i.pre+"dl_definedsets")):i.resizeCanvas(i.WIDTH-i.LESSWIDTH,i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT,!0))},resize:function(t){e==i.pre+"dl_selectannotations"&&i.hideFixedTitle()}})}}else if(e===i.pre+"dl_2ddgm"){var f=0;i.WIDTH-i.LESSWIDTH>=i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT?((l||d)&&(f=.5*(i.WIDTH-i.LESSWIDTH)-85),i.resizeCanvas(i.WIDTH-i.LESSWIDTH-f-170,i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT,!0),i.openDialog2Ddgm(e,void 0,u)):(i.resizeCanvas(i.WIDTH-i.LESSWIDTH-f-170,.5*(i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT),!0),i.openDialog2Ddgm(e,.5*(i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT)),i.openDialog2Ddgm(e,.5*(i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT),u))}else r="auto",n="auto",e===i.pre+"dl_addtrack"&&(n="50%"),e===i.pre+"dl_definedsets"?(f=0,i.WIDTH-i.LESSWIDTH>=i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT?((l||d)&&(f=.5*(i.WIDTH-i.LESSWIDTH)-85),i.resizeCanvas(i.WIDTH-i.LESSWIDTH-f-170,i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT,!0),i.openDialog2Ddgm(e),h&&i.openDialog2Ddgm(i.pre+"dl_2ddgm",void 0,!0)):(i.resizeCanvas(i.WIDTH-i.LESSWIDTH-f-170,.5*(i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT),!0),i.openDialog2Ddgm(e,.5*(i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT)),h&&i.openDialog2Ddgm(i.pre+"dl_2ddgm",.5*(i.HEIGHT-i.LESSHEIGHT-i.EXTRAHEIGHT),!0))):(m=i.isMobile()?{my:"left top",at:"left bottom-50",of:"#"+i.pre+"canvas",collision:"none"}:{my:"left top",at:"left top+50",of:"#"+i.pre+"canvas",collision:"none"},window.dialog=$("#"+e).dialog({autoOpen:!0,title:t,height:r,width:n,modal:!1,position:m}));$(".ui-dialog .ui-button span").removeClass("ui-icon-closethick").addClass("ui-icon-close")},iCn3DUI.prototype.draw2Ddgm=function(e,t,i,n){var r=this,o={},s={},a={},c={},l={};if(void 0===e)return"";for(var d in e.moleculeInfor){var h="#"+("000000"+e.moleculeInfor[d].color.toString(16)).slice(-6),u=e.moleculeInfor[d].chain.trim();void 0===l[u]?l[u]=1:++l[u];var p=1===l[u]?u:u+l[u].toString();o[d]=q=t+"_"+p,s[d]=h,a[d]=e.moleculeInfor[d].name,c[q]=d}if(void 0===n||!n)for(var m=0,f=e.intracResidues.length;m<f;++m){var g=e.intracResidues[m],v=0;for(var d in g)q=o[d],0===v?fe=q:ge=q,++v;if(void 0!==fe&&void 0!==ge)for(var d in v=0,g){var y,b,_=g[d];0===v?(y=fe,b=ge):(y=ge,b=fe),void 0===r.chainids2resids[y]&&(r.chainids2resids[y]={}),void 0===r.chainids2resids[y][b]&&(r.chainids2resids[y][b]=[]);for(var w=0,x=_.length;w<x;++w){var C=_[w],S=r.mmdbMolidResid2mmdbChainResi[t.toUpperCase()+"_"+d+"_"+C];r.chainids2resids[y][b].push(S)}void 0===r.chainname2residues&&(r.chainname2residues={});var E,M=r.icn3d.getFirstCalphaAtomObj(r.icn3d.chains[ge=b]);r.icn3d.chemicals.hasOwnProperty(M.serial)?E="chemical":r.icn3d.nucleotides.hasOwnProperty(M.serial)?E="nucleotide":r.icn3d.ions.hasOwnProperty(M.serial)?E="ion":r.icn3d.proteins.hasOwnProperty(M.serial)?E="protein":r.icn3d.water.hasOwnProperty(M.serial)&&(E="water");var T=ge.substr(ge.indexOf("_")+1)+" ("+E+")";void 0===r.chainname2residues[y]&&(r.chainname2residues[y]={}),r.chainname2residues[y][T]=r.chainids2resids[y][b],++v}}var A="<div id='#"+r.pre+t+"'>";A+="<b>"+t.toUpperCase()+"</b><br/>",A+="<svg viewBox='0,0,150,150'>";var k={},R=[],D="",L="",I={};if(void 0!==n&&n)for(var m in r.icn3d.dAtoms)I[d=c[q=(ae=r.icn3d.atoms[m]).structure+"_"+ae.chain]]=1;var O=Object.keys(e.moleculeInfor),P=Object.keys(e.intrac),H=[];for(m=0,f=O.length;m<f;++m)-1===P.indexOf(O[m])&&H.push(O[m]);var N={};if(H.length>0)for(var d in e.intrac){for(m=0,f=(Y=e.intrac[d]).intrac.length;m<f;++m){var z=Y.intrac[m].toString();-1!==H.indexOf(z)&&(void 0===N[z]&&(N[z]=[]),N[z].push(d),R.push([z,d]))}if("rect"===Y.shape)k[d]=[(j=.5*Y.coords[0])+(re=.5*Y.coords[2]-j)/2,(G=.5*Y.coords[1])+(oe=.5*Y.coords[3]-G)/2];else if("circle"===Y.shape)k[d]=[j=.5*Y.coords[0],G=.5*Y.coords[1]];else if("poly"===Y.shape){var F=.5*Y.coords[2],U=.5*Y.coords[4],B=.5*Y.coords[5],j=se=.5*Y.coords[0],G=ve=.5*Y.coords[3];k[d]=[se,ve]}}for(var V=0,W=(v=0,O.length);v<W;++v)if(d=O[v],void 0===n||!n||I.hasOwnProperty(d)){var q,Y=e.intrac[d],X=(h="#FFFFFF",s[d]),Z="";void 0!==i&&0===i?void 0!==r.alignmolid2color&&r.alignmolid2color[0].hasOwnProperty(d)?(Z=r.alignmolid2color[0][d],X="#FF0000"):X="#FFFFFF":void 0!==i&&1===i&&(void 0!==r.alignmolid2color&&r.alignmolid2color[1].hasOwnProperty(d)?(Z=r.alignmolid2color[1][d],X="#FF0000"):X="#FFFFFF");var K=a[d],J=" ",Q=" ";if(void 0!==(q=o[d])){var ee=q.indexOf("_");J=(Q=q.substr(ee+1)).length>1?Q.substr(0,1)+"..":Q}else q="Misc";void 0===X&&(X="#FFFFFF");var te=1;if(void 0!==r.icn3d.alnChains[q]){var ie=0;for(var m in r.icn3d.alnChains[q]){var ne=r.icn3d.atoms[m].color.getHexString().toUpperCase();"FF0000"!==ne&&"00FF00"!==ne||++ie}te=1*ie/Object.keys(r.icn3d.chains[q]).length}if(te<.2&&(te=.2),-1===H.indexOf(d)){for(m=0,f=Y.intrac.length;m<f;++m)parseInt(d)<parseInt(Y.intrac[m])&&R.push([d,Y.intrac[m]]);var re,oe;if("rect"===Y.shape)D+=r.draw2DNucleotide((j=.5*Y.coords[0])+.5*(re=.5*Y.coords[2]-j),(G=.5*Y.coords[1])+.5*(oe=.5*Y.coords[3]-G),q,Q,J,K,Z,h,X,.5,te),k[d]=[j+re/2,G+oe/2];else if("circle"===Y.shape)D+=r.draw2DProtein(j=.5*Y.coords[0],G=.5*Y.coords[1],q,Q,J,K,Z,h,X,.5,te),k[d]=[j,G];else if("poly"===Y.shape){F=.5*Y.coords[2],U=.5*Y.coords[4],B=.5*Y.coords[5],j=se=.5*Y.coords[0],G=ve=.5*Y.coords[3];var se,ae=r.icn3d.getFirstAtomObj(r.icn3d.chains[q]);L+=r.draw2DChemical(j,G,q,Q,J,K,Z,h,X,.5,te),k[d]=[se,ve]}}else{var ce,le;if(void 0!==N[d]&&N[d].length>1){var de=0,he=0;for(w=0,x=N[d].length;w<x;++w)if(k.hasOwnProperty(z=N[d][w])){var ue=k[z];de+=ue[0],he+=ue[1]}ce=de/N[d].length,le=he/N[d].length}else V<5?(ce=50*(V+1)*.5,le=15):V-5<5?(ce=15,le=50*(V-5+1)*.5):le=ce=37.5,++V;j=ce,G=le,ae=r.icn3d.getFirstAtomObj(r.icn3d.chains[q]),L+=r.draw2DChemical(j,G,q,Q,J,K,Z,h,X,.5,te,!0),k[d]=[j,G]}}for(m=0,f=R.length;m<f;++m)if(g=R[m],void 0===n||!n||I.hasOwnProperty(g[0])&&I.hasOwnProperty(g[1])){var pe=k[parseInt(g[0])],me=k[parseInt(g[1])];if(void 0!==pe&&void 0!==me){var fe,ge;ge=o[g[1]];var ve,ye=(fe=o[g[0]]).indexOf("_"),be=ge.indexOf("_"),_e=fe.substr(ye+1),we=ge.substr(be+1),xe=.5*((F=pe[0])+(U=me[0])),Ce=.5*((ve=pe[1])+(B=me[1]));A+="<g class='icn3d-interaction' chainid1='"+fe+"' chainid2='"+ge+"' >",A+="<title>Interaction of chain "+_e+" with chain "+we+"</title>",A+="<line x1='"+F+"' y1='"+ve+"' x2='"+xe+"' y2='"+Ce+"' stroke='#000000' stroke-width='2' /></g>",A+="<g class='icn3d-interaction' chainid1='"+ge+"' chainid2='"+fe+"' >",A+="<title>Interaction of chain "+we+" with chain "+_e+"</title>",A+="<line x1='"+xe+"' y1='"+Ce+"' x2='"+U+"' y2='"+B+"' stroke='#000000' stroke-width='2' /></g>"}}return A+=L+D,A+="</svg>",r.html2ddgm+=A+="</div>",$("#"+r.pre+"dl_2ddgm").html(r.html2ddgm),A},iCn3DUI.prototype.set2DdgmNote=function(e){var t="<div style='width:150px'><b>Nodes</b>:<br>";return this.isMac()?(t+="<span style='margin-right:18px;'>&#9711;</span>Protein<br>",t+="<span style='margin-right:18px;'>&#9634;</span>Nucleotide<br>",t+="<span style='margin-right:18px;'>&#9826;</span>Chemical<br>",t+="<span style='margin-right:18px;display: inline-block;transform: skew(-25deg);'>&#9634;</span>Biopolymer<br>"):(t+="<span style='margin-right:18px;'>O</span>Protein<br>",t+="<span style='margin-right:18px;'>&#9634;</span>Nucleotide<br>",t+="<span style='margin-right:18px;'>&#9671;</span>Chemical<br>",t+="<span style='margin-right:18px;display: inline-block;transform: skew(-25deg);'>&#9634;</span>Biopolymer<br>"),t+="<br><b>Lines</b>:<br> Interactions at 4 &#197;<br>",void 0!==e&&e&&(t+="<b>Numbers in red</b>:<br> Aligned chains"),t+"</div><br/>"},iCn3DUI.prototype.highlightNode=function(e,t,i,n){if(n<.2&&(n=.2),"rect"===e){$(t).attr("stroke",this.ORANGE),$(t).attr("stroke-width",3);var r=Number($(i).attr("x")),o=Number($(i).attr("y")),s=Number($(i).attr("width")),a=Number($(i).attr("height"));$(t).attr("x",r+s/2*(1-n)),$(t).attr("y",o+a/2*(1-n)),$(t).attr("width",s*n),$(t).attr("height",a*n)}else if("circle"===e)$(t).attr("stroke",this.ORANGE),$(t).attr("stroke-width",3),$(t).attr("r",Number($(i).attr("r"))*n);else if("polygon"===e){$(t).attr("stroke",this.ORANGE),$(t).attr("stroke-width",3),r=Number($(i).attr("x")),o=Number($(i).attr("y"));var c=Number($(i).attr("x0d")),l=Number($(i).attr("y0d")),d=Number($(i).attr("x1d")),h=Number($(i).attr("y1d")),u=Number($(i).attr("x2d")),p=Number($(i).attr("y2d")),m=Number($(i).attr("x3d")),f=Number($(i).attr("y3d"));$(t).attr("points",(r+c*n).toString()+", "+(o+l*n).toString()+", "+(r+d*n).toString()+", "+(o+h*n).toString()+", "+(r+u*n).toString()+", "+(o+p*n).toString()+", "+(r+m*n).toString()+", "+(o+f*n).toString())}},iCn3DUI.prototype.click2Ddgm=function(){var e=this;$("#"+e.pre+"dl_2ddgm").on("click",".icn3d-node",function(t){t.stopImmediatePropagation(),Object.keys(e.icn3d.hAtoms).length<Object.keys(e.icn3d.atoms).length&&e.setMode("selection"),e.bClickInteraction=!1;var i=$(this).attr("chainid");e.icn3d.bCtrl||e.icn3d.bShift||(e.removeSelection(),e.lineArray2d=[]);var n=1;void 0!==e.icn3d.alnChains[i]&&(n=1*Object.keys(e.icn3d.alnChains[i]).length/Object.keys(e.icn3d.chains[i]).length);var r=$(this).find("rect[class='icn3d-hlnode']"),o=$(this).find("rect[class='icn3d-basenode']");e.highlightNode("rect",r,o,n),r=$(this).find("circle[class='icn3d-hlnode']"),o=$(this).find("circle[class='icn3d-basenode']"),e.highlightNode("circle",r,o,n),r=$(this).find("polygon[class='icn3d-hlnode']"),o=$(this).find("polygon[class='icn3d-basenode']"),e.highlightNode("polygon",r,o,n),e.icn3d.hAtoms=e.icn3d.bCtrl||e.icn3d.bShift?e.icn3d.unionHash(e.icn3d.hAtoms,e.icn3d.chains[i]):e.icn3d.cloneHash(e.icn3d.chains[i]),e.icn3d.bCtrl||e.icn3d.bShift?(void 0===e.chainArray2d&&(e.chainArray2d=[]),e.chainArray2d.push(i)):e.chainArray2d=[i],e.updateHlAll(e.chainArray2d),e.showAnnoSelectedChains(),e.setLogCmd("select chain "+i,!0),e.bSelectResidue=!1}),$("#"+e.pre+"dl_2ddgm").on("click",".icn3d-interaction",function(t){t.stopImmediatePropagation(),Object.keys(e.icn3d.hAtoms).length<Object.keys(e.icn3d.atoms).length&&e.setMode("selection"),e.bClickInteraction=!0;var i=$(this).attr("chainid1"),n=$(this).attr("chainid2");$(this).find("line").attr("stroke",e.ORANGE),e.selectInteraction(i,n),e.showAnnoSelectedChains(),e.setLogCmd("select interaction "+i+","+n,!0),e.bClickInteraction=!1})},iCn3DUI.prototype.selectInteraction=function(e,t){var i=this;i.removeHl2D(),i.icn3d.removeHlObjects(),i.icn3d.bCtrl||i.icn3d.bShift?(void 0===i.lineArray2d&&(i.lineArray2d=[]),i.lineArray2d.push(e),i.lineArray2d.push(t)):i.lineArray2d=[e,t],i.selectInteractionAtoms(e,t),i.icn3d.addHlObjects(),i.updateHlAll()},iCn3DUI.prototype.selectInteractionAtoms=function(e,t){var i,n=this,r=n.chainids2resids[e][t];n.icn3d.bCtrl||n.icn3d.bShift||(n.icn3d.hAtoms={});for(var o=0,s=r.length;o<s;++o)n.icn3d.hAtoms=n.icn3d.unionHash(n.icn3d.hAtoms,n.icn3d.residues[r[o]]);if(Object.keys(n.icn3d.structures).length>1)i="inter_"+e+"_"+t;else{var a=e.indexOf("_"),c=t.indexOf("_");i="inter_"+e.substr(a+1)+"_"+t.substr(c+1)}n.addCustomSelection(r,i,"select the atoms in chain "+e+" interacting with chain "+t+" in a distance of 4 angstrom","select interaction "+e+","+t,!0)},iCn3DUI.prototype.draw2DProtein=function(e,t,i,n,r,o,s,a,c,l,d){var h=20*l;return html="<g class='icn3d-node' chainid='"+i+"' >",html+="<title>Chain "+n+": "+o+"</title>",html+="<circle class='icn3d-basenode' cx='"+e+"' cy='"+t+"' r='"+h+"' fill='"+a+"' stroke-width='1' stroke='#000000' class='icn3d-node' chainid='"+i+"' />",html+="<circle class='icn3d-hlnode' cx='"+e+"' cy='"+t+"' r='"+(h*d).toString()+"' fill='"+c+"' stroke-width='1' stroke='#000000' />",html+="<text x='"+(e-0).toString()+"' y='"+(t+4).toString()+"' style='fill:#000000; font-size:10; text-anchor:middle' >"+r+"</text>",""!==s&&(html+="<text x='"+(e-0).toString()+"' y='"+(t+h+4+6).toString()+"' style='fill:"+c+"; font-size:8; font-weight:bold; text-anchor:middle' >"+s+"</text>"),html+="</g>",html},iCn3DUI.prototype.draw2DNucleotide=function(e,t,i,n,r,o,s,a,c,l,d){var h=30*l,u=30*l;return e-=.5*h,t-=.5*u,html="<g class='icn3d-node' chainid='"+i+"' >",html+="<title>Chain "+n+": "+o+"</title>",html+="<rect class='icn3d-basenode' x='"+e+"' y='"+t+"' width='"+h+"' height='"+u+"' fill='"+a+"' stroke-width='1' stroke='#000000' />",html+="<rect class='icn3d-hlnode' x='"+(e+h/2*(1-d)).toString()+"' y='"+(t+u/2*(1-d)).toString()+"' width='"+(h*d).toString()+"' height='"+(u*d).toString()+"' fill='"+c+"' stroke-width='1' stroke='#000000' />",html+="<text x='"+(e+h/2-0).toString()+"' y='"+(t+u/2+4).toString()+"' style='fill:#000000; font-size:10; text-anchor:middle' >"+r+"</text>",""!==s&&(html+="<text x='"+(e+h/2-0).toString()+"' y='"+(t+u+4+6).toString()+"' style='fill:"+c+"; font-size:8; font-weight:bold; text-anchor:middle' >"+s+"</text>"),html+="</g>",html},iCn3DUI.prototype.draw2DChemical=function(e,t,i,n,r,o,s,a,c,l,d,h){var u,p,m=30*l;if(void 0!==h&&h)var f=e-(u=.5*m/Math.sqrt(3)),g=t-(p=.5*m),v=e+3*u,y=t-p,b=e+u,_=t+p,w=e-3*u,x=t+p;else f=e-(u=.5*m),g=t,v=e,y=t+(p=.5*m),b=e+u,_=t,w=e,x=t-p;var C=f-e,S=g-t,E=v-e,M=y-t,T=b-e,A=_-t,k=w-e,R=x-t,D="<g class='icn3d-node' chainid='"+i+"' >";return D+="<title>Chain "+n+": "+o+"</title>",D+="<polygon class='icn3d-basenode' points='"+f+", "+g+","+v+", "+y+","+b+", "+_+","+w+", "+x+"' x='"+e+"' y='"+t+"' x0d='"+C+"' y0d='"+S+"' x1d='"+E+"' y1d='"+M+"' x2d='"+T+"' y2d='"+A+"' x3d='"+k+"' y3d='"+R+"' fill='"+a+"' stroke-width='1' stroke='#000000' />",D+="<polygon class='icn3d-hlnode' points='"+(e+C*d).toString()+", "+(t+S*d).toString()+","+(e+E*d).toString()+", "+(t+M*d).toString()+","+(e+T*d).toString()+", "+(t+A*d).toString()+","+(e+k*d).toString()+", "+(t+R*d).toString()+"' fill='"+c+"' stroke-width='1' stroke='#000000' />",D+="<text x='"+(e+1).toString()+"' y='"+(t+2).toString()+"' style='fill:#000000; font-size:8; text-anchor:middle' >"+r+"</text>",""!==s&&(D+="<text x='"+(e+1).toString()+"' y='"+(t+2+6).toString()+"' style='fill:"+c+"; font-size:8; font-weight:bold; text-anchor:middle' >"+s+"</text>"),D+"</g>"},function(e,t,i){var n,r="firstChild",o=setTimeout;function s(e){return void 0!==e}function a(e){return"object"==typeof e}function c(e){return Object.keys(e).length}function l(e,t,i){return e<t?t:e>i?i:e}function d(e,t){return parseInt(e,t||10)}function h(e){return Math.round(e)}function u(e){var t,i,n,r,o,s,a,c,l=+e[0],d=+e[1],u=+e[2];switch(s=u*(1-d),a=(a=u*(1-(o=6*l-(r=Math.floor(6*l)))*d))||0,c=(c=u*(1-(1-o)*d))||0,(r=r||0)%6){case 0:t=u,i=c,n=s;break;case 1:t=a,i=u,n=s;break;case 2:t=s,i=u,n=c;break;case 3:t=s,i=a,n=u;break;case 4:t=c,i=s,n=u;break;case 5:t=u,i=s,n=a}return[h(255*t),h(255*i),h(255*n)]}function p(e){return f(u(e))}function m(e){var t,i=+e[0],n=+e[1],r=+e[2],o=Math.max(i,n,r),s=Math.min(i,n,r),a=o-s,c=0===o?0:a/o,l=o/255;switch(o){case s:t=0;break;case i:t=n-r+a*(n<r?6:0),t/=6*a;break;case n:t=r-i+2*a,t/=6*a;break;case r:t=i-n+4*a,t/=6*a}return[t,c,l]}function f(e){var t=+e[2]|+e[1]<<8|+e[0]<<16;return(t="000000"+t.toString(16)).slice(-6)}function g(e){return m(v(e))}function v(e){return 3===e.length&&(e=e.replace(/./g,"$&$&")),[d(e[0]+e[1],16),d(e[2]+e[3],16),d(e[4]+e[5],16)]}function y(e){return[+e[0]/360,+e[1]/100,+e[2]/100]}function b(e){return[h(360*+e[0]),h(100*+e[1]),h(100*+e[2])]}(n=e.CP=function(i,n,d){var h=t.body,m=t.documentElement,f=this,g=e.CP,v=!1,y={},b=t.createElement("div"),_="touchstart mousedown",w="touchmove mousemove",x="touchend mouseup",C="orientationchange resize";if(!(f instanceof g))return new g(i,n);function S(e,t,i){for(var n=0,r=(e=e.split(/\s+/)).length;n<r;++n)t.addEventListener(e[n],i,!1)}function E(e,t,i){for(var n=0,r=(e=e.split(/\s+/)).length;n<r;++n)t.removeEventListener(e[n],i)}function M(e,t){var i="touches",n="clientX",r="clientY",o=t[i]?t[i][0][n]:t[n],s=t[i]?t[i][0][r]:t[r],a=T(e);return{x:o-a.l,y:s-a.t}}function T(t){var i,n,r;return t===e?(i=e.pageXOffset||m.scrollLeft,n=e.pageYOffset||m.scrollTop):(i=(r=t.getBoundingClientRect()).left,n=r.top),{l:i,t:n}}function A(e,t){for(;(e=e.parentElement)&&e!==t;);return e}function k(e){e&&e.preventDefault()}function R(t){return t===e?{w:e.innerWidth,h:e.innerHeight}:{w:t.offsetWidth,h:t.offsetHeight}}function D(e){return v||!!s(e)&&e}function L(e){v=e}function I(e,t,i){if(!s(y[e]))return f;if(s(i))s(y[e][i])&&y[e][i].apply(f,t);else for(var n in y[e])y[e][n].apply(f,t);return f}g.__instance__[i.id||i.name||c(g.__instance__)]=f,s(n)&&!0!==n||(n=_),L(g.parse(i.getAttribute("data-color")||i.value||[0,1,1])),b.className="color-picker",b.innerHTML='<div class="color-picker-control"><span class="color-picker-h"><i></i></span><span class="color-picker-sv"><i></i></span></div>';var O,P=b[r].children,H=D([0,1,1]),N=P[0],z=P[1],F=N[r],U=z[r],B=0,j=0,G=0,V=0,$=0,W=0,q=0,Y=0,X=p(H);function Z(e,t){e&&"h"!==e||I("change:h",t),e&&"sv"!==e||I("change:sv",t),I("change",t)}function K(){return b.parentNode}function J(r,o){r||((d||o||h).appendChild(b),f.visible=!0),q=R(b).w,Y=R(b).h;var s=R(z),a=R(U),c=R(N).h,m=s.w,g=s.h,v=R(F).h,y=a.w,T=a.h;if(r){function P(e){var t=e.target,n=t===i||A(t,i)===i;n?J():f.exit(),I(n?"enter":"exit",[f])}b.style.left=b.style.top="-9999px",!1!==n&&S(n,i,P),f.create=function(){return J(1),I("create",[f]),f},f.destroy=function(){return!1!==n&&E(n,i,P),f.exit(),L(!1),I("destroy",[f]),f}}else Q();function $(e){u(H);var t=u([H[0],1,1]);z.style.backgroundColor="rgb("+t.join(",")+")",L(H),k(e)}function W(e){G&&(function(e){var t=l(M(N,e).y,0,c);H[0]=(c-t)/c,F.style.top=t-v/2+"px",$(e)}(e),X=p(H),B||(I("drag:h",[X,f]),I("drag",[X,f]),Z("h",[X,f]))),V&&(function(e){var t=M(z,e),i=l(t.x,0,m),n=l(t.y,0,g);H[1]=1-(m-i)/m,H[2]=(g-n)/g,U.style.right=m-i-y/2+"px",U.style.top=n-T/2+"px",$(e)}(e),X=p(H),j||(I("drag:sv",[X,f]),I("drag",[X,f]),Z("sv",[X,f]))),B=0,j=0}function ee(e){var t=e.target,r=G?"h":"sv",o=[p(H),f],s=t===i||A(t,i)===i,a=t===b||A(t,b)===b;s||a?a&&(I("stop:"+r,o),I("stop",o),Z(r,o)):K()&&!1!==n&&(f.exit(),I("exit",[f]),Z(0,o)),G=0,V=0}function te(e){B=1,G=1,W(e),k(e),I("start:h",[X,f]),I("start",[X,f]),Z("h",[X,f])}function ie(e){j=1,V=1,W(e),k(e),I("start:sv",[X,f]),I("start",[X,f]),Z("sv",[X,f])}O=function(){H=D(H),$(),F.style.top=c-v/2-c*+H[0]+"px",U.style.right=m-y/2-m*+H[1]+"px",U.style.top=g-T/2-g*+H[2]+"px"},f.exit=function(i){return K()&&(K().removeChild(b),f.visible=!1),E(_,N,te),E(_,z,ie),E(w,t,W),E(x,t,ee),E(C,e,Q),f},O(),r||(S(_,N,te),S(_,z,ie),S(w,t,W),S(x,t,ee),S(C,e,Q))}function Q(){return f.fit()}return J(1),o(function(){var e=[p(H),f];I("create",e),Z(0,e)},0),f.fit=function(t){var n=R(e),r=R(m),o=n.w-r.w,c=n.h-m.clientHeight,d=T(e),h=T(i);if($=h.l+d.l,W=h.t+d.t+R(i).h,a(t))s(t[0])&&($=t[0]),s(t[1])&&(W=t[1]);else{var u=d.t,p=d.t+n.h-Y-c;$=l($,d.l,d.l+n.w-q-o)>>0,W=l(W,u,p)>>0}return b.style.left=$+"px",b.style.top=W+"px",I("fit",[f]),f},f.set=function(e){return s(e)?("string"==typeof e&&(e=g.parse(e)),L(e),O(),f):D()},f.get=function(e){return D(e)},f.target=i,f.picker=b,f.visible=!1,f.on=function(e,t,i){return s(e)?s(t)?(s(y[e])||(y[e]={}),s(i)||(i=c(y[e])),y[e][i]=t,f):y[e]:y},f.off=function(e,t){return s(e)?s(t)?(delete y[e][t],f):(y[e]={},f):(y={},f)},f.fire=I,f.hooks=y,f.enter=function(e){return J(0,e)},f}).version="1.3.9",n.__instance__={},n.each=function(e,t){return o(function(){var t,i=n.__instance__;for(t in i)e(i[t],t,i)},0===t?0:t||1),n},n.parse=function(e){if(a(e))return e;var t=/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*$/i.exec(e),i=/\s*hsv\s*\(\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*\)\s*$/i.exec(e);return"#"===e[0]&&e.match(/^#([\da-f]{3}|[\da-f]{6})$/i)?g(e.slice(1)):i?y([+i[1],+i[2],+i[3]]):t?m([+t[1],+t[2],+t[3]]):[0,1,1]},n._HSV2RGB=u,n._HSV2HEX=p,n._RGB2HSV=m,n._HEX2HSV=g,n._HEX2RGB=function(e){return function(e){return[+e[0]/255,+e[1]/255,+e[2]/255]}(v(e))},n.HSV2RGB=function(e){return u(y(e))},n.HSV2HEX=function(e){return p(y(e))},n.RGB2HSV=function(e){return b(m(e))},n.RGB2HEX=f,n.HEX2HSV=function(e){return b(g(e))},n.HEX2RGB=v}(window,document),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){function t(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.regional.en=e.extend(!0,{},this.regional[""]),this.regional["en-US"]=e.extend(!0,{},this.regional.en),this.dpDiv=n(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function n(t){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.on("mouseout",i,function(){e(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).removeClass("ui-datepicker-next-hover")}).on("mouseover",i,r)}function r(){e.datepicker._isDisabledDatepicker(p.inline?p.dpDiv.parent()[0]:p.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).addClass("ui-datepicker-next-hover"))}function o(t,i){for(var n in e.extend(t,i),i)null==i[n]&&(t[n]=i[n]);return t}function s(e){return function(){var t=this.element.val();e.apply(this,arguments),this._refresh(),t!==this.element.val()&&this._trigger("change")}}e.ui=e.ui||{},e.ui.version="1.12.1";var a=0,c=Array.prototype.slice;e.cleanData=function(t){return function(i){var n,r,s;for(s=0;null!=(r=i[s]);s++)try{(n=e._data(r,"events"))&&n.remove&&e(r).triggerHandler("remove")}catch(o){}t(i)}}(e.cleanData),e.widget=function(t,i,n){var r,o,s,a={},c=t.split(".")[0],l=c+"-"+(t=t.split(".")[1]);return n||(n=i,i=e.Widget),e.isArray(n)&&(n=e.extend.apply(null,[{}].concat(n))),e.expr[":"][l.toLowerCase()]=function(t){return!!e.data(t,l)},e[c]=e[c]||{},r=e[c][t],o=e[c][t]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new o(e,t)},e.extend(o,r,{version:n.version,_proto:e.extend({},n),_childConstructors:[]}),(s=new i).options=e.widget.extend({},s.options),e.each(n,function(t,n){return e.isFunction(n)?void(a[t]=function(){function e(){return i.prototype[t].apply(this,arguments)}function r(e){return i.prototype[t].apply(this,e)}return function(){var t,i=this._super,o=this._superApply;return this._super=e,this._superApply=r,t=n.apply(this,arguments),this._super=i,this._superApply=o,t}}()):void(a[t]=n)}),o.prototype=e.widget.extend(s,{widgetEventPrefix:r&&s.widgetEventPrefix||t},a,{constructor:o,namespace:c,widgetName:t,widgetFullName:l}),r?(e.each(r._childConstructors,function(t,i){var n=i.prototype;e.widget(n.namespace+"."+n.widgetName,o,i._proto)}),delete r._childConstructors):i._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){for(var i,n,r=c.call(arguments,1),o=0,s=r.length;s>o;o++)for(i in r[o])n=r[o][i],r[o].hasOwnProperty(i)&&void 0!==n&&(t[i]=e.isPlainObject(n)?e.isPlainObject(t[i])?e.widget.extend({},t[i],n):e.widget.extend({},n):n);return t},e.widget.bridge=function(t,i){var n=i.prototype.widgetFullName||t;e.fn[t]=function(r){var o="string"==typeof r,s=c.call(arguments,1),a=this;return o?this.length||"instance"!==r?this.each(function(){var i,o=e.data(this,n);return"instance"===r?(a=o,!1):o?e.isFunction(o[r])&&"_"!==r.charAt(0)?(i=o[r].apply(o,s))!==o&&void 0!==i?(a=i&&i.jquery?a.pushStack(i.get()):i,!1):void 0:e.error("no such method '"+r+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; attempted to call method '"+r+"'")}):a=void 0:(s.length&&(r=e.widget.extend.apply(null,[r].concat(s))),this.each(function(){var t=e.data(this,n);t?(t.option(r||{}),t._init&&t._init()):e.data(this,n,new i(r,this))})),a}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=a++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),this.classesElementLookup={},i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){var t=this;this._destroy(),e.each(this.classesElementLookup,function(e,i){t._removeClass(i,e)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var n,r,o,s=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(s={},n=t.split("."),t=n.shift(),n.length){for(r=s[t]=e.widget.extend({},this.options[t]),o=0;n.length-1>o;o++)r[n[o]]=r[n[o]]||{},r=r[n[o]];if(t=n.pop(),1===arguments.length)return void 0===r[t]?null:r[t];r[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];s[t]=i}return this._setOptions(s),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return"classes"===e&&this._setOptionClasses(t),this.options[e]=t,"disabled"===e&&this._setOptionDisabled(t),this},_setOptionClasses:function(t){var i,n,r;for(i in t)r=this.classesElementLookup[i],t[i]!==this.options.classes[i]&&r&&r.length&&(n=e(r.get()),this._removeClass(r,i),n.addClass(this._classes({element:n,keys:i,classes:t,add:!0})))},_setOptionDisabled:function(e){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!e),e&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(t){function i(i,o){var s,a;for(a=0;i.length>a;a++)s=r.classesElementLookup[i[a]]||e(),s=e(t.add?e.unique(s.get().concat(t.element.get())):s.not(t.element).get()),r.classesElementLookup[i[a]]=s,n.push(i[a]),o&&t.classes[i[a]]&&n.push(t.classes[i[a]])}var n=[],r=this;return t=e.extend({element:this.element,classes:this.options.classes||{}},t),this._on(t.element,{remove:"_untrackClassesElement"}),t.keys&&i(t.keys.match(/\S+/g)||[],!0),t.extra&&i(t.extra.match(/\S+/g)||[]),n.join(" ")},_untrackClassesElement:function(t){var i=this;e.each(i.classesElementLookup,function(n,r){-1!==e.inArray(t.target,r)&&(i.classesElementLookup[n]=e(r.not(t.target).get()))})},_removeClass:function(e,t,i){return this._toggleClass(e,t,i,!1)},_addClass:function(e,t,i){return this._toggleClass(e,t,i,!0)},_toggleClass:function(e,t,i,n){var r="string"==typeof e||null===e,o={extra:r?t:i,keys:r?e:t,element:r?this.element:e,add:n="boolean"==typeof n?n:i};return o.element.toggleClass(this._classes(o),n),this},_on:function(t,i,n){var r,o=this;"boolean"!=typeof t&&(n=i,i=t,t=!1),n?(i=r=e(i),this.bindings=this.bindings.add(i)):(n=i,i=this.element,r=this.widget()),e.each(n,function(n,s){function a(){return t||!0!==o.options.disabled&&!e(this).hasClass("ui-state-disabled")?("string"==typeof s?o[s]:s).apply(o,arguments):void 0}"string"!=typeof s&&(a.guid=s.guid=s.guid||a.guid||e.guid++);var c=n.match(/^([\w:-]*)\s*(.*)$/),l=c[1]+o.eventNamespace,d=c[2];d?r.on(l,d,a):i.on(l,a)})},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.off(i).off(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){var i=this;return setTimeout(function(){return("string"==typeof e?i[e]:e).apply(i,arguments)},t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){this._addClass(e(t.currentTarget),null,"ui-state-hover")},mouseleave:function(t){this._removeClass(e(t.currentTarget),null,"ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){this._addClass(e(t.currentTarget),null,"ui-state-focus")},focusout:function(t){this._removeClass(e(t.currentTarget),null,"ui-state-focus")}})},_trigger:function(t,i,n){var r,o,s=this.options[t];if(n=n||{},(i=e.Event(i)).type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(r in o)r in i||(i[r]=o[r]);return this.element.trigger(i,n),!(e.isFunction(s)&&!1===s.apply(this.element[0],[i].concat(n))||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(n,r,o){"string"==typeof r&&(r={effect:r});var s,a=r?!0===r||"number"==typeof r?i:r.effect||i:t;"number"==typeof(r=r||{})&&(r={duration:r}),s=!e.isEmptyObject(r),r.complete=o,r.delay&&n.delay(r.delay),s&&e.effects&&e.effects.effect[a]?n[t](r):a!==t&&n[a]?n[a](r.duration,r.easing,o):n.queue(function(i){e(this)[t](),o&&o.call(n[0]),i()})}}),function(){function t(e,t,i){return[parseFloat(e[0])*(d.test(e[0])?t/100:1),parseFloat(e[1])*(d.test(e[1])?i/100:1)]}function i(t,i){return parseInt(e.css(t,i),10)||0}var n,r=Math.max,o=Math.abs,s=/left|center|right/,a=/top|center|bottom/,c=/[\+\-]\d+(\.[\d]+)?%?/,l=/^\w+/,d=/%$/,h=e.fn.position;e.position={scrollbarWidth:function(){if(void 0!==n)return n;var t,i,r=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=r.children()[0];return e("body").append(r),t=o.offsetWidth,r.css("overflow","scroll"),t===(i=o.offsetWidth)&&(i=r[0].clientWidth),r.remove(),n=t-i},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),n=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),r="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth;return{width:"scroll"===n||"auto"===n&&t.height<t.element[0].scrollHeight?e.position.scrollbarWidth():0,height:r?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),n=e.isWindow(i[0]),r=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:n,isDocument:r,offset:n||r?{left:0,top:0}:e(t).offset(),scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:i.outerWidth(),height:i.outerHeight()}}},e.fn.position=function(n){if(!n||!n.of)return h.apply(this,arguments);n=e.extend({},n);var d,u,p,m,f,g,v=e(n.of),y=e.position.getWithinInfo(n.within),b=e.position.getScrollInfo(y),_=(n.collision||"flip").split(" "),w={};return g=function(t){var i=t[0];return 9===i.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}(v),v[0].preventDefault&&(n.at="left top"),u=g.width,p=g.height,f=e.extend({},m=g.offset),e.each(["my","at"],function(){var e,t,i=(n[this]||"").split(" ");1===i.length&&(i=s.test(i[0])?i.concat(["center"]):a.test(i[0])?["center"].concat(i):["center","center"]),i[0]=s.test(i[0])?i[0]:"center",i[1]=a.test(i[1])?i[1]:"center",e=c.exec(i[0]),t=c.exec(i[1]),w[this]=[e?e[0]:0,t?t[0]:0],n[this]=[l.exec(i[0])[0],l.exec(i[1])[0]]}),1===_.length&&(_[1]=_[0]),"right"===n.at[0]?f.left+=u:"center"===n.at[0]&&(f.left+=u/2),"bottom"===n.at[1]?f.top+=p:"center"===n.at[1]&&(f.top+=p/2),d=t(w.at,u,p),f.left+=d[0],f.top+=d[1],this.each(function(){var s,a,c=e(this),l=c.outerWidth(),h=c.outerHeight(),g=i(this,"marginLeft"),x=i(this,"marginTop"),C=l+g+i(this,"marginRight")+b.width,S=h+x+i(this,"marginBottom")+b.height,E=e.extend({},f),M=t(w.my,c.outerWidth(),c.outerHeight());"right"===n.my[0]?E.left-=l:"center"===n.my[0]&&(E.left-=l/2),"bottom"===n.my[1]?E.top-=h:"center"===n.my[1]&&(E.top-=h/2),E.left+=M[0],E.top+=M[1],s={marginLeft:g,marginTop:x},e.each(["left","top"],function(t,i){e.ui.position[_[t]]&&e.ui.position[_[t]][i](E,{targetWidth:u,targetHeight:p,elemWidth:l,elemHeight:h,collisionPosition:s,collisionWidth:C,collisionHeight:S,offset:[d[0]+M[0],d[1]+M[1]],my:n.my,at:n.at,within:y,elem:c})}),n.using&&(a=function(e){var t=m.left-E.left,i=t+u-l,s=m.top-E.top,a=s+p-h,d={target:{element:v,left:m.left,top:m.top,width:u,height:p},element:{element:c,left:E.left,top:E.top,width:l,height:h},horizontal:0>i?"left":t>0?"right":"center",vertical:0>a?"top":s>0?"bottom":"middle"};l>u&&u>o(t+i)&&(d.horizontal="center"),h>p&&p>o(s+a)&&(d.vertical="middle"),d.important=r(o(t),o(i))>r(o(s),o(a))?"horizontal":"vertical",n.using.call(this,e,d)}),c.offset(e.extend(E,{using:a}))})},e.ui.position={fit:{left:function(e,t){var i=t.within,n=i.isWindow?i.scrollLeft:i.offset.left,o=i.width,s=e.left-t.collisionPosition.marginLeft,a=n-s,c=s+t.collisionWidth-o-n;t.collisionWidth>o?a>0&&0>=c?e.left+=a-(e.left+a+t.collisionWidth-o-n):e.left=c>0&&0>=a?n:a>c?n+o-t.collisionWidth:n:a>0?e.left+=a:c>0?e.left-=c:e.left=r(e.left-s,e.left)},top:function(e,t){var i=t.within,n=i.isWindow?i.scrollTop:i.offset.top,o=t.within.height,s=e.top-t.collisionPosition.marginTop,a=n-s,c=s+t.collisionHeight-o-n;t.collisionHeight>o?a>0&&0>=c?e.top+=a-(e.top+a+t.collisionHeight-o-n):e.top=c>0&&0>=a?n:a>c?n+o-t.collisionHeight:n:a>0?e.top+=a:c>0?e.top-=c:e.top=r(e.top-s,e.top)}},flip:{left:function(e,t){var i,n,r=t.within,s=r.width,a=r.isWindow?r.scrollLeft:r.offset.left,c=e.left-t.collisionPosition.marginLeft,l=c-a,d=c+t.collisionWidth-s-a,h="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,u="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,p=-2*t.offset[0];0>l?(0>(i=e.left+h+u+p+t.collisionWidth-s-(r.offset.left+r.scrollLeft))||o(l)>i)&&(e.left+=h+u+p):d>0&&((n=e.left-t.collisionPosition.marginLeft+h+u+p-a)>0||d>o(n))&&(e.left+=h+u+p)},top:function(e,t){var i,n,r=t.within,s=r.height,a=r.isWindow?r.scrollTop:r.offset.top,c=e.top-t.collisionPosition.marginTop,l=c-a,d=c+t.collisionHeight-s-a,h="top"===t.my[1]?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,u="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,p=-2*t.offset[1];0>l?(0>(n=e.top+h+u+p+t.collisionHeight-s-(r.offset.top+r.scrollTop))||o(l)>n)&&(e.top+=h+u+p):d>0&&((i=e.top-t.collisionPosition.marginTop+h+u+p-a)>0||d>o(i))&&(e.top+=h+u+p)}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}}}(),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,n){return!!e.data(t,n[3])}}),e.fn.extend({disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.off(".ui-disableSelection")}});var l="ui-effects-",d="ui-effects-style",h="ui-effects-animated",u=e;e.effects={effect:{}},function(e,t){function i(e,t,i){var n=d[t.type]||{};return null==e?i||!t.def?null:t.def:(e=n.floor?~~e:parseFloat(e),isNaN(e)?t.def:n.mod?(e+n.mod)%n.mod:0>e?0:e>n.max?n.max:e)}function n(i){var n=c(),r=n._rgba=[];return i=i.toLowerCase(),p(a,function(e,o){var s,a=o.re.exec(i),c=a&&o.parse(a),d=o.space||"rgba";return c?(s=n[d](c),n[l[d].cache]=s[l[d].cache],r=n._rgba=s._rgba,!1):t}),r.length?("0,0,0,0"===r.join()&&e.extend(r,o.transparent),n):o[i]}function r(e,t,i){return 1>6*(i=(i+1)%1)?e+6*(t-e)*i:1>2*i?t:2>3*i?e+6*(t-e)*(2/3-i):e}var o,s=/^([\-+])=\s*(\d+\.?\d*)/,a=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],c=e.Color=function(t,i,n,r){return new e.Color.fn.parse(t,i,n,r)},l={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},d={byte:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},h=c.support={},u=e("<p>")[0],p=e.each;u.style.cssText="background-color:rgba(1,1,1,.5)",h.rgba=u.style.backgroundColor.indexOf("rgba")>-1,p(l,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),c.fn=e.extend(c.prototype,{parse:function(r,s,a,d){if(r===t)return this._rgba=[null,null,null,null],this;(r.jquery||r.nodeType)&&(r=e(r).css(s),s=t);var h=this,u=e.type(r),m=this._rgba=[];return s!==t&&(r=[r,s,a,d],u="array"),"string"===u?this.parse(n(r)||o._default):"array"===u?(p(l.rgba.props,function(e,t){m[t.idx]=i(r[t.idx],t)}),this):"object"===u?(p(l,r instanceof c?function(e,t){r[t.cache]&&(h[t.cache]=r[t.cache].slice())}:function(t,n){var o=n.cache;p(n.props,function(e,t){if(!h[o]&&n.to){if("alpha"===e||null==r[e])return;h[o]=n.to(h._rgba)}h[o][t.idx]=i(r[e],t,!0)}),h[o]&&0>e.inArray(null,h[o].slice(0,3))&&(h[o][3]=1,n.from&&(h._rgba=n.from(h[o])))}),this):t},is:function(e){var i=c(e),n=!0,r=this;return p(l,function(e,o){var s,a=i[o.cache];return a&&(s=r[o.cache]||o.to&&o.to(r._rgba)||[],p(o.props,function(e,i){return null!=a[i.idx]?n=a[i.idx]===s[i.idx]:t})),n}),n},_space:function(){var e=[],t=this;return p(l,function(i,n){t[n.cache]&&e.push(i)}),e.pop()},transition:function(e,t){var n=c(e),r=n._space(),o=l[r],s=0===this.alpha()?c("transparent"):this,a=s[o.cache]||o.to(s._rgba),h=a.slice();return n=n[o.cache],p(o.props,function(e,r){var o=r.idx,s=a[o],c=n[o],l=d[r.type]||{};null!==c&&(null===s?h[o]=c:(l.mod&&(c-s>l.mod/2?s+=l.mod:s-c>l.mod/2&&(s-=l.mod)),h[o]=i((c-s)*t+s,r)))}),this[r](h)},blend:function(t){if(1===this._rgba[3])return this;var i=this._rgba.slice(),n=i.pop(),r=c(t)._rgba;return c(e.map(i,function(e,t){return(1-n)*r[t]+n*e}))},toRgbaString:function(){var t="rgba(",i=e.map(this._rgba,function(e,t){return null==e?t>2?1:0:e});return 1===i[3]&&(i.pop(),t="rgb("),t+i.join()+")"},toHslaString:function(){var t="hsla(",i=e.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&3>t&&(e=Math.round(100*e)+"%"),e});return 1===i[3]&&(i.pop(),t="hsl("),t+i.join()+")"},toHexString:function(t){var i=this._rgba.slice(),n=i.pop();return t&&i.push(~~(255*n)),"#"+e.map(i,function(e){return 1===(e=(e||0).toString(16)).length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),c.fn.parse.prototype=c.fn,l.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,i=e[0]/255,n=e[1]/255,r=e[2]/255,o=e[3],s=Math.max(i,n,r),a=Math.min(i,n,r),c=s-a,l=s+a,d=.5*l;return t=0===c?0:.5>=d?c/l:c/(2-l),[Math.round(a===s?0:i===s?60*(n-r)/c+360:n===s?60*(r-i)/c+120:60*(i-n)/c+240)%360,t,d,null==o?1:o]},l.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,i=e[1],n=e[2],o=e[3],s=.5>=n?n*(1+i):n+i-n*i,a=2*n-s;return[Math.round(255*r(a,s,t+1/3)),Math.round(255*r(a,s,t)),Math.round(255*r(a,s,t-1/3)),o]},p(l,function(n,r){var o=r.props,a=r.cache,l=r.to,d=r.from;c.fn[n]=function(n){if(l&&!this[a]&&(this[a]=l(this._rgba)),n===t)return this[a].slice();var r,s=e.type(n),h="array"===s||"object"===s?n:arguments,u=this[a].slice();return p(o,function(e,t){var n=h["object"===s?e:t.idx];null==n&&(n=u[t.idx]),u[t.idx]=i(n,t)}),d?((r=c(d(u)))[a]=u,r):c(u)},p(o,function(t,i){c.fn[t]||(c.fn[t]=function(r){var o,a=e.type(r),c="alpha"===t?this._hsla?"hsla":"rgba":n,l=this[c](),d=l[i.idx];return"undefined"===a?d:("function"===a&&(r=r.call(this,d),a=e.type(r)),null==r&&i.empty?this:("string"===a&&(o=s.exec(r))&&(r=d+parseFloat(o[2])*("+"===o[1]?1:-1)),l[i.idx]=r,this[c](l)))})})}),c.hook=function(t){var i=t.split(" ");p(i,function(t,i){e.cssHooks[i]={set:function(t,r){var o,s,l="";if("transparent"!==r&&("string"!==e.type(r)||(o=n(r)))){if(r=c(o||r),!h.rgba&&1!==r._rgba[3]){for(s="backgroundColor"===i?t.parentNode:t;(""===l||"transparent"===l)&&s&&s.style;)try{l=e.css(s,"backgroundColor"),s=s.parentNode}catch(a){}r=r.blend(l&&"transparent"!==l?l:"_default")}r=r.toRgbaString()}try{t.style[i]=r}catch(a){}}},e.fx.step[i]=function(t){t.colorInit||(t.start=c(t.elem,i),t.end=c(t.end),t.colorInit=!0),e.cssHooks[i].set(t.elem,t.start.transition(t.end,t.pos))}})},c.hook("backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor"),e.cssHooks.borderColor={expand:function(e){var t={};return p(["Top","Right","Bottom","Left"],function(i,n){t["border"+n+"Color"]=e}),t}},o=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(u),function(){function t(t){var i,n,r=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,o={};if(r&&r.length&&r[0]&&r[r[0]])for(n=r.length;n--;)"string"==typeof r[i=r[n]]&&(o[e.camelCase(i)]=r[i]);else for(i in r)"string"==typeof r[i]&&(o[i]=r[i]);return o}function i(t,i){var n,o,s={};for(n in i)t[n]!==(o=i[n])&&(r[n]||(e.fx.step[n]||!isNaN(parseFloat(o)))&&(s[n]=o));return s}var n=["add","remove","toggle"],r={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,i){e.fx.step[i]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(u.style(e.elem,i,e.end),e.setAttr=!0)}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(r,o,s,a){var c=e.speed(o,s,a);return this.queue(function(){var o,s=e(this),a=s.attr("class")||"",l=c.children?s.find("*").addBack():s;l=l.map(function(){return{el:e(this),start:t(this)}}),(o=function(){e.each(n,function(e,t){r[t]&&s[t+"Class"](r[t])})})(),l=l.map(function(){return this.end=t(this.el[0]),this.diff=i(this.start,this.end),this}),s.attr("class",a),l=l.map(function(){var t=this,i=e.Deferred(),n=e.extend({},c,{queue:!1,complete:function(){i.resolve(t)}});return this.el.animate(this.diff,n),i.promise()}),e.when.apply(e,l.get()).done(function(){o(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})}),c.complete.call(s[0])})})},e.fn.extend({addClass:function(t){return function(i,n,r,o){return n?e.effects.animateClass.call(this,{add:i},n,r,o):t.apply(this,arguments)}}(e.fn.addClass),removeClass:function(t){return function(i,n,r,o){return arguments.length>1?e.effects.animateClass.call(this,{remove:i},n,r,o):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(t){return function(i,n,r,o,s){return"boolean"==typeof n||void 0===n?r?e.effects.animateClass.call(this,n?{add:i}:{remove:i},r,o,s):t.apply(this,arguments):e.effects.animateClass.call(this,{toggle:i},n,r,o)}}(e.fn.toggleClass),switchClass:function(t,i,n,r,o){return e.effects.animateClass.call(this,{add:i,remove:t},n,r,o)}})}(),function(){function t(t,i,n,r){return e.isPlainObject(t)&&(i=t,t=t.effect),t={effect:t},null==i&&(i={}),e.isFunction(i)&&(r=i,n=null,i={}),("number"==typeof i||e.fx.speeds[i])&&(r=n,n=i,i={}),e.isFunction(n)&&(r=n,n=null),i&&e.extend(t,i),n=n||i.duration,t.duration=e.fx.off?0:"number"==typeof n?n:n in e.fx.speeds?e.fx.speeds[n]:e.fx.speeds._default,t.complete=r||i.complete,t}function i(t){return!(t&&"number"!=typeof t&&!e.fx.speeds[t])||"string"==typeof t&&!e.effects.effect[t]||!!e.isFunction(t)||"object"==typeof t&&!t.effect}function n(e,t){var i=t.outerWidth(),n=t.outerHeight(),r=/^rect\((-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto),?\s*(-?\d*\.?\d*px|-?\d+%|auto)\)$/.exec(e)||["",0,i,n,0];return{top:parseFloat(r[1])||0,right:"auto"===r[2]?i:parseFloat(r[2]),bottom:"auto"===r[3]?n:parseFloat(r[3]),left:parseFloat(r[4])||0}}e.expr&&e.expr.filters&&e.expr.filters.animated&&(e.expr.filters.animated=function(t){return function(i){return!!e(i).data(h)||t(i)}}(e.expr.filters.animated)),!1!==e.uiBackCompat&&e.extend(e.effects,{save:function(e,t){for(var i=0,n=t.length;n>i;i++)null!==t[i]&&e.data(l+t[i],e[0].style[t[i]])},restore:function(e,t){for(var i,n=0,r=t.length;r>n;n++)null!==t[n]&&(i=e.data(l+t[n]),e.css(t[n],i))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var i={width:t.outerWidth(!0),height:t.outerHeight(!0),float:t.css("float")},n=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),r={width:t.width(),height:t.height()},o=document.activeElement;return t.wrap(n),(t[0]===o||e.contains(t[0],o))&&e(o).trigger("focus"),n=t.parent(),"static"===t.css("position")?(n.css({position:"relative"}),t.css({position:"relative"})):(e.extend(i,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,n){i[n]=t.css(n),isNaN(parseInt(i[n],10))&&(i[n]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(r),n.css(i).show()},removeWrapper:function(t){var i=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===i||e.contains(t[0],i))&&e(i).trigger("focus")),t}}),e.extend(e.effects,{version:"1.12.1",define:function(t,i,n){return n||(n=i,i="effect"),e.effects.effect[t]=n,e.effects.effect[t].mode=i,n},scaledDimensions:function(e,t,i){if(0===t)return{height:0,width:0,outerHeight:0,outerWidth:0};var n="horizontal"!==i?(t||100)/100:1,r="vertical"!==i?(t||100)/100:1;return{height:e.height()*r,width:e.width()*n,outerHeight:e.outerHeight()*r,outerWidth:e.outerWidth()*n}},clipToBox:function(e){return{width:e.clip.right-e.clip.left,height:e.clip.bottom-e.clip.top,left:e.clip.left,top:e.clip.top}},unshift:function(e,t,i){var n=e.queue();t>1&&n.splice.apply(n,[1,0].concat(n.splice(t,i))),e.dequeue()},saveStyle:function(e){e.data(d,e[0].style.cssText)},restoreStyle:function(e){e[0].style.cssText=e.data(d)||"",e.removeData(d)},mode:function(e,t){var i=e.is(":hidden");return"toggle"===t&&(t=i?"show":"hide"),(i?"hide"===t:"show"===t)&&(t="none"),t},getBaseline:function(e,t){var i,n;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":n=0;break;case"center":n=.5;break;case"right":n=1;break;default:n=e[1]/t.width}return{x:n,y:i}},createPlaceholder:function(t){var i,n=t.css("position"),r=t.position();return t.css({marginTop:t.css("marginTop"),marginBottom:t.css("marginBottom"),marginLeft:t.css("marginLeft"),marginRight:t.css("marginRight")}).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()),/^(static|relative)/.test(n)&&(n="absolute",i=e("<"+t[0].nodeName+">").insertAfter(t).css({display:/^(inline|ruby)/.test(t.css("display"))?"inline-block":"block",visibility:"hidden",marginTop:t.css("marginTop"),marginBottom:t.css("marginBottom"),marginLeft:t.css("marginLeft"),marginRight:t.css("marginRight"),float:t.css("float")}).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).addClass("ui-effects-placeholder"),t.data(l+"placeholder",i)),t.css({position:n,left:r.left,top:r.top}),i},removePlaceholder:function(e){var t=l+"placeholder",i=e.data(t);i&&(i.remove(),e.removeData(t))},cleanUp:function(t){e.effects.restoreStyle(t),e.effects.removePlaceholder(t)},setTransition:function(t,i,n,r){return r=r||{},e.each(i,function(e,i){var o=t.cssUnit(i);o[0]>0&&(r[i]=o[0]*n+o[1])}),r}}),e.fn.extend({effect:function(){function i(t){function i(){e.isFunction(c)&&c.call(s[0]),e.isFunction(t)&&t()}var s=e(this);n.mode=d.shift(),!1===e.uiBackCompat||o?"none"===n.mode?(s[l](),i()):r.call(s[0],n,function(){s.removeData(h),e.effects.cleanUp(s),"hide"===n.mode&&s.hide(),i()}):(s.is(":hidden")?"hide"===l:"show"===l)?(s[l](),i()):r.call(s[0],n,i)}var n=t.apply(this,arguments),r=e.effects.effect[n.effect],o=r.mode,s=n.queue,a=s||"fx",c=n.complete,l=n.mode,d=[],u=function(t){var i=e(this),n=e.effects.mode(i,l)||o;i.data(h,!0),d.push(n),o&&("show"===n||n===o&&"hide"===n)&&i.show(),o&&"none"===n||e.effects.saveStyle(i),e.isFunction(t)&&t()};return e.fx.off||!r?l?this[l](n.duration,c):this.each(function(){c&&c.call(this)}):!1===s?this.each(u).each(i):this.queue(a,u).queue(a,i)},show:function(e){return function(n){if(i(n))return e.apply(this,arguments);var r=t.apply(this,arguments);return r.mode="show",this.effect.call(this,r)}}(e.fn.show),hide:function(e){return function(n){if(i(n))return e.apply(this,arguments);var r=t.apply(this,arguments);return r.mode="hide",this.effect.call(this,r)}}(e.fn.hide),toggle:function(e){return function(n){if(i(n)||"boolean"==typeof n)return e.apply(this,arguments);var r=t.apply(this,arguments);return r.mode="toggle",this.effect.call(this,r)}}(e.fn.toggle),cssUnit:function(t){var i=this.css(t),n=[];return e.each(["em","px","%","pt"],function(e,t){i.indexOf(t)>0&&(n=[parseFloat(i),t])}),n},cssClip:function(e){return e?this.css("clip","rect("+e.top+"px "+e.right+"px "+e.bottom+"px "+e.left+"px)"):n(this.css("clip"),this)},transfer:function(t,i){var n=e(this),r=e(t.to),o="fixed"===r.css("position"),s=e("body"),a=o?s.scrollTop():0,c=o?s.scrollLeft():0,l=r.offset(),d={top:l.top-a,left:l.left-c,height:r.innerHeight(),width:r.innerWidth()},h=n.offset(),u=e("<div class='ui-effects-transfer'></div>").appendTo("body").addClass(t.className).css({top:h.top-a,left:h.left-c,height:n.innerHeight(),width:n.innerWidth(),position:o?"fixed":"absolute"}).animate(d,t.duration,t.easing,function(){u.remove(),e.isFunction(i)&&i()})}}),e.fx.step.clip=function(t){t.clipInit||(t.start=e(t.elem).cssClip(),"string"==typeof t.end&&(t.end=n(t.end,t.elem)),t.clipInit=!0),e(t.elem).cssClip({top:t.pos*(t.end.top-t.start.top)+t.start.top,right:t.pos*(t.end.right-t.start.right)+t.start.right,bottom:t.pos*(t.end.bottom-t.start.bottom)+t.start.bottom,left:t.pos*(t.end.left-t.start.left)+t.start.left})}}(),function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,i){t[i]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,i=4;((t=Math.pow(2,--i))-1)/11>e;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(t,function(t,i){e.easing["easeIn"+t]=i,e.easing["easeOut"+t]=function(e){return 1-i(1-e)},e.easing["easeInOut"+t]=function(e){return.5>e?i(2*e)/2:1-i(-2*e+2)/2}})}(),e.effects.define("blind","hide",function(t,i){var n={up:["bottom","top"],vertical:["bottom","top"],down:["top","bottom"],left:["right","left"],horizontal:["right","left"],right:["left","right"]},r=e(this),o=t.direction||"up",s=r.cssClip(),a={clip:e.extend({},s)},c=e.effects.createPlaceholder(r);a.clip[n[o][0]]=a.clip[n[o][1]],"show"===t.mode&&(r.cssClip(a.clip),c&&c.css(e.effects.clipToBox(a)),a.clip=s),c&&c.animate(e.effects.clipToBox(a),t.duration,t.easing),r.animate(a,{queue:!1,duration:t.duration,easing:t.easing,complete:i})}),e.effects.define("bounce",function(t,i){var n,r,o,s=e(this),a=t.mode,c="hide"===a,l="show"===a,d=t.direction||"up",h=t.distance,u=t.times||5,p=2*u+(l||c?1:0),m=t.duration/p,f=t.easing,g="up"===d||"down"===d?"top":"left",v="up"===d||"left"===d,y=0,b=s.queue().length;for(e.effects.createPlaceholder(s),o=s.css(g),h||(h=s["top"===g?"outerHeight":"outerWidth"]()/3),l&&((r={opacity:1})[g]=o,s.css("opacity",0).css(g,v?2*-h:2*h).animate(r,m,f)),c&&(h/=Math.pow(2,u-1)),(r={})[g]=o;u>y;y++)(n={})[g]=(v?"-=":"+=")+h,s.animate(n,m,f).animate(r,m,f),h=c?2*h:h/2;c&&((n={opacity:0})[g]=(v?"-=":"+=")+h,s.animate(n,m,f)),s.queue(i),e.effects.unshift(s,b,p+1)}),e.effects.define("clip","hide",function(t,i){var n,r={},o=e(this),s=t.direction||"vertical",a="both"===s,c=a||"horizontal"===s,l=a||"vertical"===s;n=o.cssClip(),r.clip={top:l?(n.bottom-n.top)/2:n.top,right:c?(n.right-n.left)/2:n.right,bottom:l?(n.bottom-n.top)/2:n.bottom,left:c?(n.right-n.left)/2:n.left},e.effects.createPlaceholder(o),"show"===t.mode&&(o.cssClip(r.clip),r.clip=n),o.animate(r,{queue:!1,duration:t.duration,easing:t.easing,complete:i})}),e.effects.define("drop","hide",function(t,i){var n,r=e(this),o="show"===t.mode,s=t.direction||"left",a="up"===s||"down"===s?"top":"left",c="up"===s||"left"===s?"-=":"+=",l="+="===c?"-=":"+=",d={opacity:0};e.effects.createPlaceholder(r),n=t.distance||r["top"===a?"outerHeight":"outerWidth"](!0)/2,d[a]=c+n,o&&(r.css(d),d[a]=l+n,d.opacity=1),r.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:i})}),e.effects.define("explode","hide",function(t,i){function n(){v.push(this),v.length===d*h&&(u.css({visibility:"visible"}),e(v).remove(),i())}var r,o,s,a,c,l,d=t.pieces?Math.round(Math.sqrt(t.pieces)):3,h=d,u=e(this),p="show"===t.mode,m=u.show().css("visibility","hidden").offset(),f=Math.ceil(u.outerWidth()/h),g=Math.ceil(u.outerHeight()/d),v=[];for(r=0;d>r;r++)for(a=m.top+r*g,l=r-(d-1)/2,o=0;h>o;o++)s=m.left+o*f,c=o-(h-1)/2,u.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-o*f,top:-r*g}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:f,height:g,left:s+(p?c*f:0),top:a+(p?l*g:0),opacity:p?0:1}).animate({left:s+(p?0:c*f),top:a+(p?0:l*g),opacity:p?1:0},t.duration||500,t.easing,n)}),e.effects.define("fade","toggle",function(t,i){var n="show"===t.mode;e(this).css("opacity",n?0:1).animate({opacity:n?1:0},{queue:!1,duration:t.duration,easing:t.easing,complete:i})}),e.effects.define("fold","hide",function(t,i){var n=e(this),r=t.mode,o="show"===r,s="hide"===r,a=t.size||15,c=/([0-9]+)%/.exec(a),l=t.horizFirst?["right","bottom"]:["bottom","right"],d=t.duration/2,h=e.effects.createPlaceholder(n),u=n.cssClip(),p={clip:e.extend({},u)},m={clip:e.extend({},u)},f=[u[l[0]],u[l[1]]],g=n.queue().length;c&&(a=parseInt(c[1],10)/100*f[s?0:1]),p.clip[l[0]]=a,m.clip[l[0]]=a,m.clip[l[1]]=0,o&&(n.cssClip(m.clip),h&&h.css(e.effects.clipToBox(m)),m.clip=u),n.queue(function(i){h&&h.animate(e.effects.clipToBox(p),d,t.easing).animate(e.effects.clipToBox(m),d,t.easing),i()}).animate(p,d,t.easing).animate(m,d,t.easing).queue(i),e.effects.unshift(n,g,4)}),e.effects.define("highlight","show",function(t,i){var n=e(this),r={backgroundColor:n.css("backgroundColor")};"hide"===t.mode&&(r.opacity=0),e.effects.saveStyle(n),n.css({backgroundImage:"none",backgroundColor:t.color||"#ffff99"}).animate(r,{queue:!1,duration:t.duration,easing:t.easing,complete:i})}),e.effects.define("size",function(t,i){var n,r,o,s=e(this),a=["fontSize"],c=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],l=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],d=t.mode,h="effect"!==d,u=t.scale||"both",p=t.origin||["middle","center"],m=s.css("position"),f=s.position(),g=e.effects.scaledDimensions(s),v=t.from||g,y=t.to||e.effects.scaledDimensions(s,0);e.effects.createPlaceholder(s),"show"===d&&(o=v,v=y,y=o),r={from:{y:v.height/g.height,x:v.width/g.width},to:{y:y.height/g.height,x:y.width/g.width}},("box"===u||"both"===u)&&(r.from.y!==r.to.y&&(v=e.effects.setTransition(s,c,r.from.y,v),y=e.effects.setTransition(s,c,r.to.y,y)),r.from.x!==r.to.x&&(v=e.effects.setTransition(s,l,r.from.x,v),y=e.effects.setTransition(s,l,r.to.x,y))),("content"===u||"both"===u)&&r.from.y!==r.to.y&&(v=e.effects.setTransition(s,a,r.from.y,v),y=e.effects.setTransition(s,a,r.to.y,y)),p&&(n=e.effects.getBaseline(p,g),v.top=(g.outerHeight-v.outerHeight)*n.y+f.top,v.left=(g.outerWidth-v.outerWidth)*n.x+f.left,y.top=(g.outerHeight-y.outerHeight)*n.y+f.top,y.left=(g.outerWidth-y.outerWidth)*n.x+f.left),s.css(v),("content"===u||"both"===u)&&(c=c.concat(["marginTop","marginBottom"]).concat(a),l=l.concat(["marginLeft","marginRight"]),s.find("*[width]").each(function(){var i=e(this),n=e.effects.scaledDimensions(i),o={height:n.height*r.from.y,width:n.width*r.from.x,outerHeight:n.outerHeight*r.from.y,outerWidth:n.outerWidth*r.from.x},s={height:n.height*r.to.y,width:n.width*r.to.x,outerHeight:n.height*r.to.y,outerWidth:n.width*r.to.x};r.from.y!==r.to.y&&(o=e.effects.setTransition(i,c,r.from.y,o),s=e.effects.setTransition(i,c,r.to.y,s)),r.from.x!==r.to.x&&(o=e.effects.setTransition(i,l,r.from.x,o),s=e.effects.setTransition(i,l,r.to.x,s)),h&&e.effects.saveStyle(i),i.css(o),i.animate(s,t.duration,t.easing,function(){h&&e.effects.restoreStyle(i)})})),s.animate(y,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){var t=s.offset();0===y.opacity&&s.css("opacity",v.opacity),h||(s.css("position","static"===m?"relative":m).offset(t),e.effects.saveStyle(s)),i()}})}),e.effects.define("scale",function(t,i){var n=e(this),r=t.mode,o=parseInt(t.percent,10)||(0===parseInt(t.percent,10)?0:"effect"!==r?0:100),s=e.extend(!0,{from:e.effects.scaledDimensions(n),to:e.effects.scaledDimensions(n,o,t.direction||"both"),origin:t.origin||["middle","center"]},t);t.fade&&(s.from.opacity=1,s.to.opacity=0),e.effects.effect.size.call(this,s,i)}),e.effects.define("puff","hide",function(t,i){var n=e.extend(!0,{},t,{fade:!0,percent:parseInt(t.percent,10)||150});e.effects.effect.scale.call(this,n,i)}),e.effects.define("pulsate","show",function(t,i){var n=e(this),r=t.mode,o="show"===r,s=2*(t.times||5)+(o||"hide"===r?1:0),a=t.duration/s,c=0,l=1,d=n.queue().length;for((o||!n.is(":visible"))&&(n.css("opacity",0).show(),c=1);s>l;l++)n.animate({opacity:c},a,t.easing),c=1-c;n.animate({opacity:c},a,t.easing),n.queue(i),e.effects.unshift(n,d,s+1)}),e.effects.define("shake",function(t,i){var n=1,r=e(this),o=t.direction||"left",s=t.distance||20,a=t.times||3,c=2*a+1,l=Math.round(t.duration/c),d="up"===o||"down"===o?"top":"left",h="up"===o||"left"===o,u={},p={},m={},f=r.queue().length;for(e.effects.createPlaceholder(r),u[d]=(h?"-=":"+=")+s,p[d]=(h?"+=":"-=")+2*s,m[d]=(h?"-=":"+=")+2*s,r.animate(u,l,t.easing);a>n;n++)r.animate(p,l,t.easing).animate(m,l,t.easing);r.animate(p,l,t.easing).animate(u,l/2,t.easing).queue(i),e.effects.unshift(r,f,c+1)}),e.effects.define("slide","show",function(t,i){var n,r,o=e(this),s={up:["bottom","top"],down:["top","bottom"],left:["right","left"],right:["left","right"]},a=t.mode,c=t.direction||"left",l="up"===c||"down"===c?"top":"left",d="up"===c||"left"===c,h=t.distance||o["top"===l?"outerHeight":"outerWidth"](!0),u={};e.effects.createPlaceholder(o),n=o.cssClip(),r=o.position()[l],u[l]=(d?-1:1)*h+r,u.clip=o.cssClip(),u.clip[s[c][1]]=u.clip[s[c][0]],"show"===a&&(o.cssClip(u.clip),o.css(l,u[l]),u.clip=n,u[l]=r),o.animate(u,{queue:!1,duration:t.duration,easing:t.easing,complete:i})}),!1!==e.uiBackCompat&&e.effects.define("transfer",function(t,i){e(this).transfer(t,i)}),e.ui.focusable=function(t,i){var n,r,o,s,a,c=t.nodeName.toLowerCase();return"area"===c?(r=(n=t.parentNode).name,!(!t.href||!r||"map"!==n.nodeName.toLowerCase())&&(o=e("img[usemap='#"+r+"']")).length>0&&o.is(":visible")):(/^(input|select|textarea|button|object)$/.test(c)?(s=!t.disabled)&&(a=e(t).closest("fieldset")[0])&&(s=!a.disabled):s="a"===c&&t.href||i,s&&e(t).is(":visible")&&function(e){for(var t=e.css("visibility");"inherit"===t;)t=(e=e.parent()).css("visibility");return"hidden"!==t}(e(t)))},e.extend(e.expr[":"],{focusable:function(t){return e.ui.focusable(t,null!=e.attr(t,"tabindex"))}}),e.fn.form=function(){return"string"==typeof this[0].form?this.closest("form"):e(this[0].form)},e.ui.formResetMixin={_formResetHandler:function(){var t=e(this);setTimeout(function(){var i=t.data("ui-form-reset-instances");e.each(i,function(){this.refresh()})})},_bindFormResetHandler:function(){if(this.form=this.element.form(),this.form.length){var e=this.form.data("ui-form-reset-instances")||[];e.length||this.form.on("reset.ui-form-reset",this._formResetHandler),e.push(this),this.form.data("ui-form-reset-instances",e)}},_unbindFormResetHandler:function(){if(this.form.length){var t=this.form.data("ui-form-reset-instances");t.splice(e.inArray(this,t),1),t.length?this.form.data("ui-form-reset-instances",t):this.form.removeData("ui-form-reset-instances").off("reset.ui-form-reset")}}},"1.7"===e.fn.jquery.substring(0,3)&&(e.each(["Width","Height"],function(t,i){function n(t,i,n,o){return e.each(r,function(){i-=parseFloat(e.css(t,"padding"+this))||0,n&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),o&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var r="Width"===i?["Left","Right"]:["Top","Bottom"],o=i.toLowerCase(),s={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+i]=function(t){return void 0===t?s["inner"+i].call(this):this.each(function(){e(this).css(o,n(this,t)+"px")})},e.fn["outer"+i]=function(t,r){return"number"!=typeof t?s["outer"+i].call(this,t):this.each(function(){e(this).css(o,n(this,t,!0,r)+"px")})}}),e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},e.ui.escapeSelector=function(){var e=/([!"#$%&'()*+,.\/:;<=>?@[\]^`{|}~])/g;return function(t){return t.replace(e,"\\$1")}}(),e.fn.labels=function(){var t,i,n,r,o;return this[0].labels&&this[0].labels.length?this.pushStack(this[0].labels):(r=this.eq(0).parents("label"),(n=this.attr("id"))&&(o=(t=this.eq(0).parents().last()).add(t.length?t.siblings():this.siblings()),i="label[for='"+e.ui.escapeSelector(n)+"']",r=r.add(o.find(i).addBack(i))),this.pushStack(r))},e.fn.scrollParent=function(t){var i=this.css("position"),n="absolute"===i,r=t?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var t=e(this);return(!n||"static"!==t.css("position"))&&r.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==i&&o.length?o:e(this[0].ownerDocument||document)},e.extend(e.expr[":"],{tabbable:function(t){var i=e.attr(t,"tabindex"),n=null!=i;return(!n||i>=0)&&e.ui.focusable(t,n)}}),e.fn.extend({uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}}),e.widget("ui.accordion",{version:"1.12.1",options:{active:0,animate:{},classes:{"ui-accordion-header":"ui-corner-top","ui-accordion-header-collapsed":"ui-corner-all","ui-accordion-content":"ui-corner-bottom"},collapsible:!1,event:"click",header:"> li > :first-child, > :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var t=this.options;this.prevShow=this.prevHide=e(),this._addClass("ui-accordion","ui-widget ui-helper-reset"),this.element.attr("role","tablist"),t.collapsible||!1!==t.active&&null!=t.active||(t.active=0),this._processPanels(),0>t.active&&(t.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():e()}},_createIcons:function(){var t,i,n=this.options.icons;n&&(t=e("<span>"),this._addClass(t,"ui-accordion-header-icon","ui-icon "+n.header),t.prependTo(this.headers),i=this.active.children(".ui-accordion-header-icon"),this._removeClass(i,n.header)._addClass(i,null,n.activeHeader)._addClass(this.headers,"ui-accordion-icons"))},_destroyIcons:function(){this._removeClass(this.headers,"ui-accordion-icons"),this.headers.children(".ui-accordion-header-icon").remove()},_destroy:function(){var e;this.element.removeAttr("role"),this.headers.removeAttr("role aria-expanded aria-selected aria-controls tabIndex").removeUniqueId(),this._destroyIcons(),e=this.headers.next().css("display","").removeAttr("role aria-hidden aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&e.css("height","")},_setOption:function(e,t){return"active"===e?void this._activate(t):("event"===e&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(t)),this._super(e,t),"collapsible"!==e||t||!1!==this.options.active||this._activate(0),void("icons"===e&&(this._destroyIcons(),t&&this._createIcons())))},_setOptionDisabled:function(e){this._super(e),this.element.attr("aria-disabled",e),this._toggleClass(null,"ui-state-disabled",!!e),this._toggleClass(this.headers.add(this.headers.next()),null,"ui-state-disabled",!!e)},_keydown:function(t){if(!t.altKey&&!t.ctrlKey){var i=e.ui.keyCode,n=this.headers.length,r=this.headers.index(t.target),o=!1;switch(t.keyCode){case i.RIGHT:case i.DOWN:o=this.headers[(r+1)%n];break;case i.LEFT:case i.UP:o=this.headers[(r-1+n)%n];break;case i.SPACE:case i.ENTER:this._eventHandler(t);break;case i.HOME:o=this.headers[0];break;case i.END:o=this.headers[n-1]}o&&(e(t.target).attr("tabIndex",-1),e(o).attr("tabIndex",0),e(o).trigger("focus"),t.preventDefault())}},_panelKeyDown:function(t){t.keyCode===e.ui.keyCode.UP&&t.ctrlKey&&e(t.currentTarget).prev().trigger("focus")},refresh:function(){var t=this.options;this._processPanels(),!1===t.active&&!0===t.collapsible||!this.headers.length?(t.active=!1,this.active=e()):!1===t.active?this._activate(0):this.active.length&&!e.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(t.active=!1,this.active=e()):this._activate(Math.max(0,t.active-1)):t.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var e=this.headers,t=this.panels;this.headers=this.element.find(this.options.header),this._addClass(this.headers,"ui-accordion-header ui-accordion-header-collapsed","ui-state-default"),this.panels=this.headers.next().filter(":not(.ui-accordion-content-active)").hide(),this._addClass(this.panels,"ui-accordion-content","ui-helper-reset ui-widget-content"),t&&(this._off(e.not(this.headers)),this._off(t.not(this.panels)))},_refresh:function(){var t,i=this.options,n=i.heightStyle,r=this.element.parent();this.active=this._findActive(i.active),this._addClass(this.active,"ui-accordion-header-active","ui-state-active")._removeClass(this.active,"ui-accordion-header-collapsed"),this._addClass(this.active.next(),"ui-accordion-content-active"),this.active.next().show(),this.headers.attr("role","tab").each(function(){var t=e(this),i=t.uniqueId().attr("id"),n=t.next(),r=n.uniqueId().attr("id");t.attr("aria-controls",r),n.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===n?(t=r.height(),this.element.siblings(":visible").each(function(){var i=e(this),n=i.css("position");"absolute"!==n&&"fixed"!==n&&(t-=i.outerHeight(!0))}),this.headers.each(function(){t-=e(this).outerHeight(!0)}),this.headers.next().each(function(){e(this).height(Math.max(0,t-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===n&&(t=0,this.headers.next().each(function(){var i=e(this).is(":visible");i||e(this).show(),t=Math.max(t,e(this).css("height","").height()),i||e(this).hide()}).height(t))},_activate:function(t){var i=this._findActive(t)[0];i!==this.active[0]&&this._eventHandler({target:i=i||this.active[0],currentTarget:i,preventDefault:e.noop})},_findActive:function(t){return"number"==typeof t?this.headers.eq(t):e()},_setupEvents:function(t){var i={keydown:"_keydown"};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(t){var i,n,r=this.options,o=this.active,s=e(t.currentTarget),a=s[0]===o[0],c=a&&r.collapsible,l=c?e():s.next(),d=o.next(),h={oldHeader:o,oldPanel:d,newHeader:c?e():s,newPanel:l};t.preventDefault(),a&&!r.collapsible||!1===this._trigger("beforeActivate",t,h)||(r.active=!c&&this.headers.index(s),this.active=a?e():s,this._toggle(h),this._removeClass(o,"ui-accordion-header-active","ui-state-active"),r.icons&&(i=o.children(".ui-accordion-header-icon"),this._removeClass(i,null,r.icons.activeHeader)._addClass(i,null,r.icons.header)),a||(this._removeClass(s,"ui-accordion-header-collapsed")._addClass(s,"ui-accordion-header-active","ui-state-active"),r.icons&&(n=s.children(".ui-accordion-header-icon"),this._removeClass(n,null,r.icons.header)._addClass(n,null,r.icons.activeHeader)),this._addClass(s.next(),"ui-accordion-content-active")))},_toggle:function(t){var i=t.newPanel,n=this.prevShow.length?this.prevShow:t.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=n,this.options.animate?this._animate(i,n,t):(n.hide(),i.show(),this._toggleComplete(t)),n.attr({"aria-hidden":"true"}),n.prev().attr({"aria-selected":"false","aria-expanded":"false"}),i.length&&n.length?n.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===parseInt(e(this).attr("tabIndex"),10)}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(e,t,i){var n,r,o,s=this,a=0,c=e.css("box-sizing"),l=e.length&&(!t.length||e.index()<t.index()),d=this.options.animate||{},h=l&&d.down||d,u=function(){s._toggleComplete(i)};return"number"==typeof h&&(o=h),"string"==typeof h&&(r=h),r=r||h.easing||d.easing,o=o||h.duration||d.duration,t.length?e.length?(n=e.show().outerHeight(),t.animate(this.hideProps,{duration:o,easing:r,step:function(e,t){t.now=Math.round(e)}}),void e.hide().animate(this.showProps,{duration:o,easing:r,complete:u,step:function(e,i){i.now=Math.round(e),"height"!==i.prop?"content-box"===c&&(a+=i.now):"content"!==s.options.heightStyle&&(i.now=Math.round(n-t.outerHeight()-a),a=0)}})):t.animate(this.hideProps,o,r,u):e.animate(this.showProps,o,r,u)},_toggleComplete:function(e){var t=e.oldPanel,i=t.prev();this._removeClass(t,"ui-accordion-content-active"),this._removeClass(i,"ui-accordion-header-active")._addClass(i,"ui-accordion-header-collapsed"),t.length&&(t.parent()[0].className=t.parent()[0].className),this._trigger("activate",null,e)}}),e.ui.safeActiveElement=function(e){var t;try{t=e.activeElement}catch(i){t=e.body}return t||(t=e.body),t.nodeName||(t=e.body),t},e.widget("ui.menu",{version:"1.12.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().attr({role:this.options.role,tabIndex:0}),this._addClass("ui-menu","ui-widget ui-widget-content"),this._on({"mousedown .ui-menu-item":function(e){e.preventDefault()},"click .ui-menu-item":function(t){var i=e(t.target),n=e(e.ui.safeActiveElement(this.document[0]));!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(t),t.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(t):!this.element.is(":focus")&&n.closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){if(!this.previousFilter){var i=e(t.target).closest(".ui-menu-item"),n=e(t.currentTarget);i[0]===n[0]&&(this._removeClass(n.siblings().children(".ui-state-active"),null,"ui-state-active"),this.focus(t,n))}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var i=this.active||this.element.find(this.options.items).eq(0);t||this.focus(e,i)},blur:function(t){this._delay(function(){!e.contains(this.element[0],e.ui.safeActiveElement(this.document[0]))&&this.collapseAll(t)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(e){this._closeOnDocumentClick(e)&&this.collapseAll(e),this.mouseHandled=!1}})},_destroy:function(){var t=this.element.find(".ui-menu-item").removeAttr("role aria-disabled").children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled tabIndex").removeUniqueId().show(),t.children().each(function(){var t=e(this);t.data("ui-menu-submenu-caret")&&t.remove()})},_keydown:function(t){var i,n,r,o,s=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:s=!1,n=this.previousFilter||"",o=!1,r=t.keyCode>=96&&105>=t.keyCode?""+(t.keyCode-96):String.fromCharCode(t.keyCode),clearTimeout(this.filterTimer),r===n?o=!0:r=n+r,i=this._filterMenuItems(r),(i=o&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i).length||(r=String.fromCharCode(t.keyCode),i=this._filterMenuItems(r)),i.length?(this.focus(t,i),this.previousFilter=r,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}s&&t.preventDefault()},_activate:function(e){this.active&&!this.active.is(".ui-state-disabled")&&(this.active.children("[aria-haspopup='true']").length?this.expand(e):this.select(e))},refresh:function(){var t,i,n,r,o=this,s=this.options.icons.submenu,a=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,!!this.element.find(".ui-icon").length),i=a.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=e(this),i=t.prev(),n=e("<span>").data("ui-menu-submenu-caret",!0);o._addClass(n,"ui-menu-icon","ui-icon "+s),i.attr("aria-haspopup","true").prepend(n),t.attr("aria-labelledby",i.attr("id"))}),this._addClass(i,"ui-menu","ui-widget ui-widget-content ui-front"),(t=a.add(this.element).find(this.options.items)).not(".ui-menu-item").each(function(){var t=e(this);o._isDivider(t)&&o._addClass(t,"ui-menu-divider","ui-widget-content")}),r=(n=t.not(".ui-menu-item, .ui-menu-divider")).children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),this._addClass(n,"ui-menu-item")._addClass(r,"ui-menu-item-wrapper"),t.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){if("icons"===e){var i=this.element.find(".ui-menu-icon");this._removeClass(i,null,this.options.icons.submenu)._addClass(i,null,t.submenu)}this._super(e,t)},_setOptionDisabled:function(e){this._super(e),this.element.attr("aria-disabled",e+""),this._toggleClass(null,"ui-state-disabled",!!e)},focus:function(e,t){var i,n,r;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),n=this.active.children(".ui-menu-item-wrapper"),this._addClass(n,null,"ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",n.attr("id")),r=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper"),this._addClass(r,null,"ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),(i=t.children(".ui-menu")).length&&e&&/^mouse/.test(e.type)&&this._startOpening(i),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var i,n,r,o,s,a;this._hasScroll()&&(i=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,n=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,r=t.offset().top-this.activeMenu.offset().top-i-n,o=this.activeMenu.scrollTop(),s=this.activeMenu.height(),a=t.outerHeight(),0>r?this.activeMenu.scrollTop(o+r):r+a>s&&this.activeMenu.scrollTop(o+r-s+a))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active"),this._trigger("blur",e,{item:this.active}),this.active=null)},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(t){var i=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(t,i){clearTimeout(this.timer),this.timer=this._delay(function(){var n=i?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));n.length||(n=this.element),this._close(n),this.blur(t),this._removeClass(n.find(".ui-state-active"),null,"ui-state-active"),this.activeMenu=n},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false")},_closeOnDocumentClick:function(t){return!e(t.target).closest(".ui-menu").length},_isDivider:function(e){return!/[^\-\u2014\u2013\s]/.test(e.text())},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,i){var n;this.active&&(n="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),n&&n.length&&this.active||(n=this.activeMenu.find(this.options.items)[t]()),this.focus(i,n)},nextPage:function(t){var i,n,r;return this.active?void(this.isLastItem()||(this._hasScroll()?(n=this.active.offset().top,r=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return 0>(i=e(this)).offset().top-n-r}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items)[this.active?"last":"first"]()))):void this.next(t)},previousPage:function(t){var i,n,r;return this.active?void(this.isFirstItem()||(this._hasScroll()?(n=this.active.offset().top,r=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return(i=e(this)).offset().top-n+r>0}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items).first()))):void this.next(t)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,i)},_filterMenuItems:function(t){var i=t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),n=RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return n.test(e.trim(e(this).children(".ui-menu-item-wrapper").text()))})}}),e.widget("ui.autocomplete",{version:"1.12.1",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var t,i,n,r=this.element[0].nodeName.toLowerCase(),o="textarea"===r,s="input"===r;this.isMultiLine=o||!s&&this._isContentEditable(this.element),this.valueMethod=this.element[o||s?"val":"text"],this.isNewMenu=!0,this._addClass("ui-autocomplete-input"),this.element.attr("autocomplete","off"),this._on(this.element,{keydown:function(r){if(this.element.prop("readOnly"))return t=!0,n=!0,void(i=!0);t=!1,n=!1,i=!1;var o=e.ui.keyCode;switch(r.keyCode){case o.PAGE_UP:t=!0,this._move("previousPage",r);break;case o.PAGE_DOWN:t=!0,this._move("nextPage",r);break;case o.UP:t=!0,this._keyEvent("previous",r);break;case o.DOWN:t=!0,this._keyEvent("next",r);break;case o.ENTER:this.menu.active&&(t=!0,r.preventDefault(),this.menu.select(r));break;case o.TAB:this.menu.active&&this.menu.select(r);break;case o.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(r),r.preventDefault());break;default:i=!0,this._searchTimeout(r)}},keypress:function(n){if(t)return t=!1,void((!this.isMultiLine||this.menu.element.is(":visible"))&&n.preventDefault());if(!i){var r=e.ui.keyCode;switch(n.keyCode){case r.PAGE_UP:this._move("previousPage",n);break;case r.PAGE_DOWN:this._move("nextPage",n);break;case r.UP:this._keyEvent("previous",n);break;case r.DOWN:this._keyEvent("next",n)}}},input:function(e){return n?(n=!1,void e.preventDefault()):void this._searchTimeout(e)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){return this.cancelBlur?void delete this.cancelBlur:(clearTimeout(this.searching),this.close(e),void this._change(e))}}),this._initSource(),this.menu=e("<ul>").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._addClass(this.menu.element,"ui-autocomplete","ui-front"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,this.element[0]!==e.ui.safeActiveElement(this.document[0])&&this.element.trigger("focus")})},menufocus:function(t,i){var n,r;return this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type))?(this.menu.blur(),void this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)})):(r=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",t,{item:r})&&t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(r.value),void((n=i.item.attr("aria-label")||r.value)&&e.trim(n).length&&(this.liveRegion.children().hide(),e("<div>").text(n).appendTo(this.liveRegion))))},menuselect:function(t,i){var n=i.item.data("ui-autocomplete-item"),r=this.previous;this.element[0]!==e.ui.safeActiveElement(this.document[0])&&(this.element.trigger("focus"),this.previous=r,this._delay(function(){this.previous=r,this.selectedItem=n})),!1!==this._trigger("select",t,{item:n})&&this._value(n.value),this.term=this._value(),this.close(t),this.selectedItem=n}}),this.liveRegion=e("<div>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_isEventTargetInWidget:function(t){var i=this.menu.element[0];return t.target===this.element[0]||t.target===i||e.contains(i,t.target)},_closeOnClickOutside:function(e){this._isEventTargetInWidget(e)||this.close()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front, dialog")),t.length||(t=this.document[0].body),t},_initSource:function(){var t,i,n=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(i,n){n(e.ui.autocomplete.filter(t,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(t,r){n.xhr&&n.xhr.abort(),n.xhr=e.ajax({url:i,data:t,dataType:"json",success:function(e){r(e)},error:function(){r([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){var t=this.term===this._value(),i=this.menu.element.is(":visible");(!t||t&&!i&&!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey))&&(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):!1!==this._trigger("search",t)?this._search(e):void 0},_search:function(e){this.pending++,this._addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var t=++this.requestIndex;return e.proxy(function(e){t===this.requestIndex&&this.__response(e),this.pending--,this.pending||this._removeClass("ui-autocomplete-loading")},this)},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this._off(this.document,"mousedown"),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({},t,{label:t.label||t.value,value:t.value||t.label})})},_suggest:function(t){var i=this.menu.element.empty();this._renderMenu(i,t),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(),this._on(this.document,{mousedown:"_closeOnClickOutside"})},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,i){var n=this;e.each(i,function(e,i){n._renderItemData(t,i)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,i){return e("<li>").append(e("<div>").text(i.label)).appendTo(t)},_move:function(e,t){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this.isMultiLine||this._value(this.term),void this.menu.blur()):void this.menu[e](t):void this.search(null,t)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(e,t),t.preventDefault())},_isContentEditable:function(e){if(!e.length)return!1;var t=e.prop("contentEditable");return"inherit"===t?this._isContentEditable(e.parent()):"true"===t}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,i){var n=RegExp(e.ui.autocomplete.escapeRegex(i),"i");return e.grep(t,function(e){return n.test(e.label||e.value||e)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(t){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=t&&t.length?this.options.messages.results(t.length):this.options.messages.noResults,this.liveRegion.children().hide(),e("<div>").text(i).appendTo(this.liveRegion))}});var p,m=/ui-corner-([a-z]){2,6}/g;e.widget("ui.controlgroup",{version:"1.12.1",defaultElement:"<div>",options:{direction:"horizontal",disabled:null,onlyVisible:!0,items:{button:"input[type=button], input[type=submit], input[type=reset], button, a",controlgroupLabel:".ui-controlgroup-label",checkboxradio:"input[type='checkbox'], input[type='radio']",selectmenu:"select",spinner:".ui-spinner-input"}},_create:function(){this._enhance()},_enhance:function(){this.element.attr("role","toolbar"),this.refresh()},_destroy:function(){this._callChildMethod("destroy"),this.childWidgets.removeData("ui-controlgroup-data"),this.element.removeAttr("role"),this.options.items.controlgroupLabel&&this.element.find(this.options.items.controlgroupLabel).find(".ui-controlgroup-label-contents").contents().unwrap()},_initWidgets:function(){var t=this,i=[];e.each(this.options.items,function(n,r){var o,s={};return r?"controlgroupLabel"===n?((o=t.element.find(r)).each(function(){var t=e(this);t.children(".ui-controlgroup-label-contents").length||t.contents().wrapAll("<span class='ui-controlgroup-label-contents'></span>")}),t._addClass(o,null,"ui-widget ui-widget-content ui-state-default"),void(i=i.concat(o.get()))):void(e.fn[n]&&(s=t["_"+n+"Options"]?t["_"+n+"Options"]("middle"):{classes:{}},t.element.find(r).each(function(){var r=e(this),o=r[n]("instance"),a=e.widget.extend({},s);if("button"!==n||!r.parent(".ui-spinner").length){o||(o=r[n]()[n]("instance")),o&&(a.classes=t._resolveClassesValues(a.classes,o)),r[n](a);var c=r[n]("widget");e.data(c[0],"ui-controlgroup-data",o||r[n]("instance")),i.push(c[0])}}))):void 0}),this.childWidgets=e(e.unique(i)),this._addClass(this.childWidgets,"ui-controlgroup-item")},_callChildMethod:function(t){this.childWidgets.each(function(){var i=e(this).data("ui-controlgroup-data");i&&i[t]&&i[t]()})},_updateCornerClass:function(e,t){var i=this._buildSimpleOptions(t,"label").classes.label;this._removeClass(e,null,"ui-corner-top ui-corner-bottom ui-corner-left ui-corner-right ui-corner-all"),this._addClass(e,null,i)},_buildSimpleOptions:function(e,t){var i="vertical"===this.options.direction,n={classes:{}};return n.classes[t]={middle:"",first:"ui-corner-"+(i?"top":"left"),last:"ui-corner-"+(i?"bottom":"right"),only:"ui-corner-all"}[e],n},_spinnerOptions:function(e){var t=this._buildSimpleOptions(e,"ui-spinner");return t.classes["ui-spinner-up"]="",t.classes["ui-spinner-down"]="",t},_buttonOptions:function(e){return this._buildSimpleOptions(e,"ui-button")},_checkboxradioOptions:function(e){return this._buildSimpleOptions(e,"ui-checkboxradio-label")},_selectmenuOptions:function(e){var t="vertical"===this.options.direction;return{width:!!t&&"auto",classes:{middle:{"ui-selectmenu-button-open":"","ui-selectmenu-button-closed":""},first:{"ui-selectmenu-button-open":"ui-corner-"+(t?"top":"tl"),"ui-selectmenu-button-closed":"ui-corner-"+(t?"top":"left")},last:{"ui-selectmenu-button-open":t?"":"ui-corner-tr","ui-selectmenu-button-closed":"ui-corner-"+(t?"bottom":"right")},only:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"}}[e]}},_resolveClassesValues:function(t,i){var n={};return e.each(t,function(r){var o=i.options.classes[r]||"";o=e.trim(o.replace(m,"")),n[r]=(o+" "+t[r]).replace(/\s+/g," ")}),n},_setOption:function(e,t){return"direction"===e&&this._removeClass("ui-controlgroup-"+this.options.direction),this._super(e,t),"disabled"===e?void this._callChildMethod(t?"disable":"enable"):void this.refresh()},refresh:function(){var t,i=this;this._addClass("ui-controlgroup ui-controlgroup-"+this.options.direction),"horizontal"===this.options.direction&&this._addClass(null,"ui-helper-clearfix"),this._initWidgets(),t=this.childWidgets,this.options.onlyVisible&&(t=t.filter(":visible")),t.length&&(e.each(["first","last"],function(e,n){var r=t[n]().data("ui-controlgroup-data");if(r&&i["_"+r.widgetName+"Options"]){var o=i["_"+r.widgetName+"Options"](1===t.length?"only":n);o.classes=i._resolveClassesValues(o.classes,r),r.element[r.widgetName](o)}else i._updateCornerClass(t[n](),n)}),this._callChildMethod("refresh"))}}),e.widget("ui.checkboxradio",[e.ui.formResetMixin,{version:"1.12.1",options:{disabled:null,label:null,icon:!0,classes:{"ui-checkboxradio-label":"ui-corner-all","ui-checkboxradio-icon":"ui-corner-all"}},_getCreateOptions:function(){var t,i,n=this,r=this._super()||{};return this._readType(),i=this.element.labels(),this.label=e(i[i.length-1]),this.label.length||e.error("No label found for checkboxradio widget"),this.originalLabel="",this.label.contents().not(this.element[0]).each(function(){n.originalLabel+=3===this.nodeType?e(this).text():this.outerHTML}),this.originalLabel&&(r.label=this.originalLabel),null!=(t=this.element[0].disabled)&&(r.disabled=t),r},_create:function(){var e=this.element[0].checked;this._bindFormResetHandler(),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled),this._setOption("disabled",this.options.disabled),this._addClass("ui-checkboxradio","ui-helper-hidden-accessible"),this._addClass(this.label,"ui-checkboxradio-label","ui-button ui-widget"),"radio"===this.type&&this._addClass(this.label,"ui-checkboxradio-radio-label"),this.options.label&&this.options.label!==this.originalLabel?this._updateLabel():this.originalLabel&&(this.options.label=this.originalLabel),this._enhance(),e&&(this._addClass(this.label,"ui-checkboxradio-checked","ui-state-active"),this.icon&&this._addClass(this.icon,null,"ui-state-hover")),this._on({change:"_toggleClasses",focus:function(){this._addClass(this.label,null,"ui-state-focus ui-visual-focus")},blur:function(){this._removeClass(this.label,null,"ui-state-focus ui-visual-focus")}})},_readType:function(){var t=this.element[0].nodeName.toLowerCase();this.type=this.element[0].type,"input"===t&&/radio|checkbox/.test(this.type)||e.error("Can't create checkboxradio on element.nodeName="+t+" and element.type="+this.type)},_enhance:function(){this._updateIcon(this.element[0].checked)},widget:function(){return this.label},_getRadioGroup:function(){var t=this.element[0].name,i="input[name='"+e.ui.escapeSelector(t)+"']";return t?(this.form.length?e(this.form[0].elements).filter(i):e(i).filter(function(){return 0===e(this).form().length})).not(this.element):e([])},_toggleClasses:function(){var t=this.element[0].checked;this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",t),this.options.icon&&"checkbox"===this.type&&this._toggleClass(this.icon,null,"ui-icon-check ui-state-checked",t)._toggleClass(this.icon,null,"ui-icon-blank",!t),"radio"===this.type&&this._getRadioGroup().each(function(){var t=e(this).checkboxradio("instance");t&&t._removeClass(t.label,"ui-checkboxradio-checked","ui-state-active")})},_destroy:function(){this._unbindFormResetHandler(),this.icon&&(this.icon.remove(),this.iconSpace.remove())},_setOption:function(e,t){return"label"!==e||t?(this._super(e,t),"disabled"===e?(this._toggleClass(this.label,null,"ui-state-disabled",t),void(this.element[0].disabled=t)):void this.refresh()):void 0},_updateIcon:function(t){var i="ui-icon ui-icon-background ";this.options.icon?(this.icon||(this.icon=e("<span>"),this.iconSpace=e("<span> </span>"),this._addClass(this.iconSpace,"ui-checkboxradio-icon-space")),"checkbox"===this.type?(i+=t?"ui-icon-check ui-state-checked":"ui-icon-blank",this._removeClass(this.icon,null,t?"ui-icon-blank":"ui-icon-check")):i+="ui-icon-blank",this._addClass(this.icon,"ui-checkboxradio-icon",i),t||this._removeClass(this.icon,null,"ui-icon-check ui-state-checked"),this.icon.prependTo(this.label).after(this.iconSpace)):void 0!==this.icon&&(this.icon.remove(),this.iconSpace.remove(),delete this.icon)},_updateLabel:function(){var e=this.label.contents().not(this.element[0]);this.icon&&(e=e.not(this.icon[0])),this.iconSpace&&(e=e.not(this.iconSpace[0])),e.remove(),this.label.append(this.options.label)},refresh:function(){var e=this.element[0].checked,t=this.element[0].disabled;this._updateIcon(e),this._toggleClass(this.label,"ui-checkboxradio-checked","ui-state-active",e),null!==this.options.label&&this._updateLabel(),t!==this.options.disabled&&this._setOptions({disabled:t})}}]),e.widget("ui.button",{version:"1.12.1",defaultElement:"<button>",options:{classes:{"ui-button":"ui-corner-all"},disabled:null,icon:null,iconPosition:"beginning",label:null,showLabel:!0},_getCreateOptions:function(){var e,t=this._super()||{};return this.isInput=this.element.is("input"),null!=(e=this.element[0].disabled)&&(t.disabled=e),this.originalLabel=this.isInput?this.element.val():this.element.html(),this.originalLabel&&(t.label=this.originalLabel),t},_create:function(){!this.option.showLabel&!this.options.icon&&(this.options.showLabel=!0),null==this.options.disabled&&(this.options.disabled=this.element[0].disabled||!1),this.hasTitle=!!this.element.attr("title"),this.options.label&&this.options.label!==this.originalLabel&&(this.isInput?this.element.val(this.options.label):this.element.html(this.options.label)),this._addClass("ui-button","ui-widget"),this._setOption("disabled",this.options.disabled),this._enhance(),this.element.is("a")&&this._on({keyup:function(t){t.keyCode===e.ui.keyCode.SPACE&&(t.preventDefault(),this.element[0].click?this.element[0].click():this.element.trigger("click"))}})},_enhance:function(){this.element.is("button")||this.element.attr("role","button"),this.options.icon&&(this._updateIcon("icon",this.options.icon),this._updateTooltip())},_updateTooltip:function(){this.title=this.element.attr("title"),this.options.showLabel||this.title||this.element.attr("title",this.options.label)},_updateIcon:function(t,i){var n="iconPosition"!==t,r=n?this.options.iconPosition:i,o="top"===r||"bottom"===r;this.icon?n&&this._removeClass(this.icon,null,this.options.icon):(this.icon=e("<span>"),this._addClass(this.icon,"ui-button-icon","ui-icon"),this.options.showLabel||this._addClass("ui-button-icon-only")),n&&this._addClass(this.icon,null,i),this._attachIcon(r),o?(this._addClass(this.icon,null,"ui-widget-icon-block"),this.iconSpace&&this.iconSpace.remove()):(this.iconSpace||(this.iconSpace=e("<span> </span>"),this._addClass(this.iconSpace,"ui-button-icon-space")),this._removeClass(this.icon,null,"ui-wiget-icon-block"),this._attachIconSpace(r))},_destroy:function(){this.element.removeAttr("role"),this.icon&&this.icon.remove(),this.iconSpace&&this.iconSpace.remove(),this.hasTitle||this.element.removeAttr("title")},_attachIconSpace:function(e){this.icon[/^(?:end|bottom)/.test(e)?"before":"after"](this.iconSpace)},_attachIcon:function(e){this.element[/^(?:end|bottom)/.test(e)?"append":"prepend"](this.icon)},_setOptions:function(e){(void 0===e.showLabel?this.options.showLabel:e.showLabel)||(void 0===e.icon?this.options.icon:e.icon)||(e.showLabel=!0),this._super(e)},_setOption:function(e,t){"icon"===e&&(t?this._updateIcon(e,t):this.icon&&(this.icon.remove(),this.iconSpace&&this.iconSpace.remove())),"iconPosition"===e&&this._updateIcon(e,t),"showLabel"===e&&(this._toggleClass("ui-button-icon-only",null,!t),this._updateTooltip()),"label"===e&&(this.isInput?this.element.val(t):(this.element.html(t),this.icon&&(this._attachIcon(this.options.iconPosition),this._attachIconSpace(this.options.iconPosition)))),this._super(e,t),"disabled"===e&&(this._toggleClass(null,"ui-state-disabled",t),this.element[0].disabled=t,t&&this.element.blur())},refresh:function(){var e=this.element.is("input, button")?this.element[0].disabled:this.element.hasClass("ui-button-disabled");e!==this.options.disabled&&this._setOptions({disabled:e}),this._updateTooltip()}}),!1!==e.uiBackCompat&&(e.widget("ui.button",e.ui.button,{options:{text:!0,icons:{primary:null,secondary:null}},_create:function(){this.options.showLabel&&!this.options.text&&(this.options.showLabel=this.options.text),!this.options.showLabel&&this.options.text&&(this.options.text=this.options.showLabel),this.options.icon||!this.options.icons.primary&&!this.options.icons.secondary?this.options.icon&&(this.options.icons.primary=this.options.icon):this.options.icons.primary?this.options.icon=this.options.icons.primary:(this.options.icon=this.options.icons.secondary,this.options.iconPosition="end"),this._super()},_setOption:function(e,t){return"text"===e?void this._super("showLabel",t):("showLabel"===e&&(this.options.text=t),"icon"===e&&(this.options.icons.primary=t),"icons"===e&&(t.primary?(this._super("icon",t.primary),this._super("iconPosition","beginning")):t.secondary&&(this._super("icon",t.secondary),this._super("iconPosition","end"))),void this._superApply(arguments))}}),e.fn.button=function(t){return function(){return!this.length||this.length&&"INPUT"!==this[0].tagName||this.length&&"INPUT"===this[0].tagName&&"checkbox"!==this.attr("type")&&"radio"!==this.attr("type")?t.apply(this,arguments):(e.ui.checkboxradio||e.error("Checkboxradio widget missing"),0===arguments.length?this.checkboxradio({icon:!1}):this.checkboxradio.apply(this,arguments))}}(e.fn.button),e.fn.buttonset=function(){return e.ui.controlgroup||e.error("Controlgroup widget missing"),"option"===arguments[0]&&"items"===arguments[1]&&arguments[2]?this.controlgroup.apply(this,[arguments[0],"items.button",arguments[2]]):"option"===arguments[0]&&"items"===arguments[1]?this.controlgroup.apply(this,[arguments[0],"items.button"]):("object"==typeof arguments[0]&&arguments[0].items&&(arguments[0].items={button:arguments[0].items}),this.controlgroup.apply(this,arguments))}),e.extend(e.ui,{datepicker:{version:"1.12.1"}}),e.extend(t.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return o(this._defaults,e||{}),this},_attachDatepicker:function(t,i){var n,r,o;r="div"===(n=t.nodeName.toLowerCase())||"span"===n,t.id||(this.uuid+=1,t.id="dp"+this.uuid),(o=this._newInst(e(t),r)).settings=e.extend({},i||{}),"input"===n?this._connectDatepicker(t,o):r&&this._inlineDatepicker(t,o)},_newInst:function(t,i){return{id:t[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1"),input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?n(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(t,i){var n=e(t);i.append=e([]),i.trigger=e([]),n.hasClass(this.markerClassName)||(this._attachments(n,i),n.addClass(this.markerClassName).on("keydown",this._doKeyDown).on("keypress",this._doKeyPress).on("keyup",this._doKeyUp),this._autoSize(i),e.data(t,"datepicker",i),i.settings.disabled&&this._disableDatepicker(t))},_attachments:function(t,i){var n,r,o,s=this._get(i,"appendText"),a=this._get(i,"isRTL");i.append&&i.append.remove(),s&&(i.append=e("<span class='"+this._appendClass+"'>"+s+"</span>"),t[a?"before":"after"](i.append)),t.off("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),("focus"===(n=this._get(i,"showOn"))||"both"===n)&&t.on("focus",this._showDatepicker),("button"===n||"both"===n)&&(r=this._get(i,"buttonText"),o=this._get(i,"buttonImage"),i.trigger=e(this._get(i,"buttonImageOnly")?e("<img/>").addClass(this._triggerClass).attr({src:o,alt:r,title:r}):e("<button type='button'></button>").addClass(this._triggerClass).html(o?e("<img/>").attr({src:o,alt:r,title:r}):r)),t[a?"before":"after"](i.trigger),i.trigger.on("click",function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&&e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1}))},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,i,n,r,o=new Date(2009,11,20),s=this._get(e,"dateFormat");s.match(/[DM]/)&&(o.setMonth((t=function(e){for(i=0,n=0,r=0;e.length>r;r++)e[r].length>i&&(i=e[r].length,n=r);return n})(this._get(e,s.match(/MM/)?"monthNames":"monthNamesShort"))),o.setDate(t(this._get(e,s.match(/DD/)?"dayNames":"dayNamesShort"))+20-o.getDay())),e.input.attr("size",this._formatDate(e,o).length)}},_inlineDatepicker:function(t,i){var n=e(t);n.hasClass(this.markerClassName)||(n.addClass(this.markerClassName).append(i.dpDiv),e.data(t,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(t),i.dpDiv.css("display","block"))},_dialogDatepicker:function(t,i,n,r,s){var a,c,l,d,h=this._dialogInst;return h||(this.uuid+=1,this._dialogInput=e("<input type='text' id='dp"+this.uuid+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.on("keydown",this._doKeyDown),e("body").append(this._dialogInput),(h=this._dialogInst=this._newInst(this._dialogInput,!1)).settings={},e.data(this._dialogInput[0],"datepicker",h)),o(h.settings,r||{}),i=i&&i.constructor===Date?this._formatDate(h,i):i,this._dialogInput.val(i),this._pos=s?s.length?s:[s.pageX,s.pageY]:null,this._pos||(a=document.documentElement.clientWidth,c=document.documentElement.clientHeight,l=document.documentElement.scrollLeft||document.body.scrollLeft,d=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[a/2-100+l,c/2-150+d]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),h.settings.onSelect=n,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],"datepicker",h),this},_destroyDatepicker:function(t){var i,n=e(t),r=e.data(t,"datepicker");n.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),e.removeData(t,"datepicker"),"input"===i?(r.append.remove(),r.trigger.remove(),n.removeClass(this.markerClassName).off("focus",this._showDatepicker).off("keydown",this._doKeyDown).off("keypress",this._doKeyPress).off("keyup",this._doKeyUp)):("div"===i||"span"===i)&&n.removeClass(this.markerClassName).empty(),p===r&&(p=null))},_enableDatepicker:function(t){var i,n,r=e(t),o=e.data(t,"datepicker");r.hasClass(this.markerClassName)&&("input"===(i=t.nodeName.toLowerCase())?(t.disabled=!1,o.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&((n=r.children("."+this._inlineClass)).children().removeClass("ui-state-disabled"),n.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}))},_disableDatepicker:function(t){var i,n,r=e(t),o=e.data(t,"datepicker");r.hasClass(this.markerClassName)&&("input"===(i=t.nodeName.toLowerCase())?(t.disabled=!0,o.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&((n=r.children("."+this._inlineClass)).children().addClass("ui-state-disabled"),n.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;this._disabledInputs.length>t;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(t){try{return e.data(t,"datepicker")}catch(i){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(t,i,n){var r,s,a,c,l=this._getInst(t);return 2===arguments.length&&"string"==typeof i?"defaults"===i?e.extend({},e.datepicker._defaults):l?"all"===i?e.extend({},l.settings):this._get(l,i):null:(r=i||{},"string"==typeof i&&((r={})[i]=n),void(l&&(this._curInst===l&&this._hideDatepicker(),s=this._getDateDatepicker(t,!0),a=this._getMinMaxDate(l,"min"),c=this._getMinMaxDate(l,"max"),o(l.settings,r),null!==a&&void 0!==r.dateFormat&&void 0===r.minDate&&(l.settings.minDate=this._formatDate(l,a)),null!==c&&void 0!==r.dateFormat&&void 0===r.maxDate&&(l.settings.maxDate=this._formatDate(l,c)),"disabled"in r&&(r.disabled?this._disableDatepicker(t):this._enableDatepicker(t)),this._attachments(e(t),l),this._autoSize(l),this._setDate(l,s),this._updateAlternate(l),this._updateDatepicker(l))))},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var i=this._getInst(e);i&&(this._setDate(i,t),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(e,t){var i=this._getInst(e);return i&&!i.inline&&this._setDateFromField(i,t),i?this._getDate(i):null},_doKeyDown:function(t){var i,n,r,o=e.datepicker._getInst(t.target),s=!0,a=o.dpDiv.is(".ui-datepicker-rtl");if(o._keyEvent=!0,e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),s=!1;break;case 13:return(r=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",o.dpDiv))[0]&&e.datepicker._selectDay(t.target,o.selectedMonth,o.selectedYear,r[0]),(i=e.datepicker._get(o,"onSelect"))?(n=e.datepicker._formatDate(o),i.apply(o.input?o.input[0]:null,[n,o])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(o,"stepBigMonths"):-e.datepicker._get(o,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(o,"stepBigMonths"):+e.datepicker._get(o,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&e.datepicker._clearDate(t.target),s=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&e.datepicker._gotoToday(t.target),s=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,a?1:-1,"D"),s=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(o,"stepBigMonths"):-e.datepicker._get(o,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,-7,"D"),s=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,a?-1:1,"D"),s=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(o,"stepBigMonths"):+e.datepicker._get(o,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,7,"D"),s=t.ctrlKey||t.metaKey;break;default:s=!1}else 36===t.keyCode&&t.ctrlKey?e.datepicker._showDatepicker(this):s=!1;s&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var i,n,r=e.datepicker._getInst(t.target);return e.datepicker._get(r,"constrainInput")?(i=e.datepicker._possibleChars(e.datepicker._get(r,"dateFormat")),n=String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||" ">n||!i||i.indexOf(n)>-1):void 0},_doKeyUp:function(t){var i=e.datepicker._getInst(t.target);if(i.input.val()!==i.lastVal)try{e.datepicker.parseDate(e.datepicker._get(i,"dateFormat"),i.input?i.input.val():null,e.datepicker._getFormatConfig(i))&&(e.datepicker._setDateFromField(i),e.datepicker._updateAlternate(i),e.datepicker._updateDatepicker(i))}catch(n){}return!0},_showDatepicker:function(t){var i,n,r,s,a,c,l;"input"!==(t=t.target||t).nodeName.toLowerCase()&&(t=e("input",t.parentNode)[0]),e.datepicker._isDisabledDatepicker(t)||e.datepicker._lastInput===t||(i=e.datepicker._getInst(t),e.datepicker._curInst&&e.datepicker._curInst!==i&&(e.datepicker._curInst.dpDiv.stop(!0,!0),i&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),!1!==(r=(n=e.datepicker._get(i,"beforeShow"))?n.apply(t,[t,i]):{})&&(o(i.settings,r),i.lastVal=null,e.datepicker._lastInput=t,e.datepicker._setDateFromField(i),e.datepicker._inDialog&&(t.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(t),e.datepicker._pos[1]+=t.offsetHeight),s=!1,e(t).parents().each(function(){return!(s|="fixed"===e(this).css("position"))}),a={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(i),a=e.datepicker._checkOffset(i,a,s),i.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":s?"fixed":"absolute",display:"none",left:a.left+"px",top:a.top+"px"}),i.inline||(c=e.datepicker._get(i,"showAnim"),l=e.datepicker._get(i,"duration"),i.dpDiv.css("z-index",function(e){for(var t,i;e.length&&e[0]!==document;){if(("absolute"===(t=e.css("position"))||"relative"===t||"fixed"===t)&&(i=parseInt(e.css("zIndex"),10),!isNaN(i)&&0!==i))return i;e=e.parent()}return 0}(e(t))+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[c]?i.dpDiv.show(c,e.datepicker._get(i,"showOptions"),l):i.dpDiv[c||"show"](c?l:null),e.datepicker._shouldFocusInput(i)&&i.input.trigger("focus"),e.datepicker._curInst=i)))},_updateDatepicker:function(t){this.maxRows=4,p=t,t.dpDiv.empty().append(this._generateHTML(t)),this._attachHandlers(t);var i,n=this._getNumberOfMonths(t),o=n[1],s=t.dpDiv.find("."+this._dayOverClass+" a");s.length>0&&r.apply(s.get(0)),t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),o>1&&t.dpDiv.addClass("ui-datepicker-multi-"+o).css("width",17*o+"em"),t.dpDiv[(1!==n[0]||1!==n[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t===e.datepicker._curInst&&e.datepicker._datepickerShowing&&e.datepicker._shouldFocusInput(t)&&t.input.trigger("focus"),t.yearshtml&&(i=t.yearshtml,setTimeout(function(){i===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),i=t.yearshtml=null},0))},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus")},_checkOffset:function(t,i,n){var r=t.dpDiv.outerWidth(),o=t.dpDiv.outerHeight(),s=t.input?t.input.outerWidth():0,a=t.input?t.input.outerHeight():0,c=document.documentElement.clientWidth+(n?0:e(document).scrollLeft()),l=document.documentElement.clientHeight+(n?0:e(document).scrollTop());return i.left-=this._get(t,"isRTL")?r-s:0,i.left-=n&&i.left===t.input.offset().left?e(document).scrollLeft():0,i.top-=n&&i.top===t.input.offset().top+a?e(document).scrollTop():0,i.left-=Math.min(i.left,i.left+r>c&&c>r?Math.abs(i.left+r-c):0),i.top-=Math.min(i.top,i.top+o>l&&l>o?Math.abs(o+a):0),i},_findPos:function(t){for(var i,n=this._getInst(t),r=this._get(n,"isRTL");t&&("hidden"===t.type||1!==t.nodeType||e.expr.filters.hidden(t));)t=t[r?"previousSibling":"nextSibling"];return[(i=e(t).offset()).left,i.top]},_hideDatepicker:function(t){var i,n,r,o,s=this._curInst;!s||t&&s!==e.data(t,"datepicker")||this._datepickerShowing&&(i=this._get(s,"showAnim"),n=this._get(s,"duration"),r=function(){e.datepicker._tidyDialog(s)},e.effects&&(e.effects.effect[i]||e.effects[i])?s.dpDiv.hide(i,e.datepicker._get(s,"showOptions"),n,r):s.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?n:null,r),i||r(),this._datepickerShowing=!1,(o=this._get(s,"onClose"))&&o.apply(s.input?s.input[0]:null,[s.input?s.input.val():"",s]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar")},_checkExternalClick:function(t){if(e.datepicker._curInst){var i=e(t.target),n=e.datepicker._getInst(i[0]);(i[0].id!==e.datepicker._mainDivId&&0===i.parents("#"+e.datepicker._mainDivId).length&&!i.hasClass(e.datepicker.markerClassName)&&!i.closest("."+e.datepicker._triggerClass).length&&e.datepicker._datepickerShowing&&(!e.datepicker._inDialog||!e.blockUI)||i.hasClass(e.datepicker.markerClassName)&&e.datepicker._curInst!==n)&&e.datepicker._hideDatepicker()}},_adjustDate:function(t,i,n){var r=e(t),o=this._getInst(r[0]);this._isDisabledDatepicker(r[0])||(this._adjustInstDate(o,i+("M"===n?this._get(o,"showCurrentAtPos"):0),n),this._updateDatepicker(o))},_gotoToday:function(t){var i,n=e(t),r=this._getInst(n[0]);this._get(r,"gotoCurrent")&&r.currentDay?(r.selectedDay=r.currentDay,r.drawMonth=r.selectedMonth=r.currentMonth,r.drawYear=r.selectedYear=r.currentYear):(i=new Date,r.selectedDay=i.getDate(),r.drawMonth=r.selectedMonth=i.getMonth(),r.drawYear=r.selectedYear=i.getFullYear()),this._notifyChange(r),this._adjustDate(n)},_selectMonthYear:function(t,i,n){var r=e(t),o=this._getInst(r[0]);o["selected"+("M"===n?"Month":"Year")]=o["draw"+("M"===n?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(o),this._adjustDate(r)},_selectDay:function(t,i,n,r){var o,s=e(t);e(r).hasClass(this._unselectableClass)||this._isDisabledDatepicker(s[0])||((o=this._getInst(s[0])).selectedDay=o.currentDay=e("a",r).html(),o.selectedMonth=o.currentMonth=i,o.selectedYear=o.currentYear=n,this._selectDate(t,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear)))},_clearDate:function(t){var i=e(t);this._selectDate(i,"")},_selectDate:function(t,i){var n,r=e(t),o=this._getInst(r[0]);i=null!=i?i:this._formatDate(o),o.input&&o.input.val(i),this._updateAlternate(o),(n=this._get(o,"onSelect"))?n.apply(o.input?o.input[0]:null,[i,o]):o.input&&o.input.trigger("change"),o.inline?this._updateDatepicker(o):(this._hideDatepicker(),this._lastInput=o.input[0],"object"!=typeof o.input[0]&&o.input.trigger("focus"),this._lastInput=null)},_updateAlternate:function(t){var i,n,r,o=this._get(t,"altField");o&&(i=this._get(t,"altFormat")||this._get(t,"dateFormat"),n=this._getDate(t),r=this.formatDate(i,n,this._getFormatConfig(t)),e(o).val(r))},noWeekends:function(e){var t=e.getDay();return[t>0&&6>t,""]},iso8601Week:function(e){var t,i=new Date(e.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),t=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((t-i)/864e5)/7)+1},parseDate:function(t,i,n){if(null==t||null==i)throw"Invalid arguments";if(""==(i="object"==typeof i?""+i:i+""))return null;var r,o,s,a,c=0,l=(n?n.shortYearCutoff:null)||this._defaults.shortYearCutoff,d="string"!=typeof l?l:(new Date).getFullYear()%100+parseInt(l,10),h=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,u=(n?n.dayNames:null)||this._defaults.dayNames,p=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,m=(n?n.monthNames:null)||this._defaults.monthNames,f=-1,g=-1,v=-1,y=-1,b=!1,_=function(e){var i=t.length>r+1&&t.charAt(r+1)===e;return i&&r++,i},w=function(e){var t=_(e),n="@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2,r=RegExp("^\\d{"+("y"===e?n:1)+","+n+"}"),o=i.substring(c).match(r);if(!o)throw"Missing number at position "+c;return c+=o[0].length,parseInt(o[0],10)},x=function(t,n,r){var o=-1,s=e.map(_(t)?r:n,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});if(e.each(s,function(e,t){var n=t[1];return i.substr(c,n.length).toLowerCase()===n.toLowerCase()?(o=t[0],c+=n.length,!1):void 0}),-1!==o)return o+1;throw"Unknown name at position "+c},C=function(){if(i.charAt(c)!==t.charAt(r))throw"Unexpected literal at position "+c;c++};for(r=0;t.length>r;r++)if(b)"'"!==t.charAt(r)||_("'")?C():b=!1;else switch(t.charAt(r)){case"d":v=w("d");break;case"D":x("D",h,u);break;case"o":y=w("o");break;case"m":g=w("m");break;case"M":g=x("M",p,m);break;case"y":f=w("y");break;case"@":f=(a=new Date(w("@"))).getFullYear(),g=a.getMonth()+1,v=a.getDate();break;case"!":f=(a=new Date((w("!")-this._ticksTo1970)/1e4)).getFullYear(),g=a.getMonth()+1,v=a.getDate();break;case"'":_("'")?C():b=!0;break;default:C()}if(i.length>c&&(s=i.substr(c),!/^\s+/.test(s)))throw"Extra/unparsed characters found in date: "+s;if(-1===f?f=(new Date).getFullYear():100>f&&(f+=(new Date).getFullYear()-(new Date).getFullYear()%100+(d>=f?0:-100)),y>-1)for(g=1,v=y;!((o=this._getDaysInMonth(f,g-1))>=v);)g++,v-=o;if((a=this._daylightSavingAdjust(new Date(f,g-1,v))).getFullYear()!==f||a.getMonth()+1!==g||a.getDate()!==v)throw"Invalid date";return a},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:864e9*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(e,t,i){if(!t)return"";var n,r=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,o=(i?i.dayNames:null)||this._defaults.dayNames,s=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,a=(i?i.monthNames:null)||this._defaults.monthNames,c=function(t){var i=e.length>n+1&&e.charAt(n+1)===t;return i&&n++,i},l=function(e,t,i){var n=""+t;if(c(e))for(;i>n.length;)n="0"+n;return n},d=function(e,t,i,n){return c(e)?n[t]:i[t]},h="",u=!1;if(t)for(n=0;e.length>n;n++)if(u)"'"!==e.charAt(n)||c("'")?h+=e.charAt(n):u=!1;else switch(e.charAt(n)){case"d":h+=l("d",t.getDate(),2);break;case"D":h+=d("D",t.getDay(),r,o);break;case"o":h+=l("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":h+=l("m",t.getMonth()+1,2);break;case"M":h+=d("M",t.getMonth(),s,a);break;case"y":h+=c("y")?t.getFullYear():(10>t.getFullYear()%100?"0":"")+t.getFullYear()%100;break;case"@":h+=t.getTime();break;case"!":h+=1e4*t.getTime()+this._ticksTo1970;break;case"'":c("'")?h+="'":u=!0;break;default:h+=e.charAt(n)}return h},_possibleChars:function(e){var t,i="",n=!1,r=function(i){var n=e.length>t+1&&e.charAt(t+1)===i;return n&&t++,n};for(t=0;e.length>t;t++)if(n)"'"!==e.charAt(t)||r("'")?i+=e.charAt(t):n=!1;else switch(e.charAt(t)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":r("'")?i+="'":n=!0;break;default:i+=e.charAt(t)}return i},_get:function(e,t){return void 0!==e.settings[t]?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var i=this._get(e,"dateFormat"),n=e.lastVal=e.input?e.input.val():null,r=this._getDefaultDate(e),o=r,a=this._getFormatConfig(e);try{o=this.parseDate(i,n,a)||r}catch(s){n=t?"":n}e.selectedDay=o.getDate(),e.drawMonth=e.selectedMonth=o.getMonth(),e.drawYear=e.selectedYear=o.getFullYear(),e.currentDay=n?o.getDate():0,e.currentMonth=n?o.getMonth():0,e.currentYear=n?o.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(t,i,n){var r=null==i||""===i?n:"string"==typeof i?function(i){try{return e.datepicker.parseDate(e.datepicker._get(t,"dateFormat"),i,e.datepicker._getFormatConfig(t))}catch(n){}for(var r=(i.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date,o=r.getFullYear(),s=r.getMonth(),a=r.getDate(),c=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=c.exec(i);l;){switch(l[2]||"d"){case"d":case"D":a+=parseInt(l[1],10);break;case"w":case"W":a+=7*parseInt(l[1],10);break;case"m":case"M":s+=parseInt(l[1],10),a=Math.min(a,e.datepicker._getDaysInMonth(o,s));break;case"y":case"Y":o+=parseInt(l[1],10),a=Math.min(a,e.datepicker._getDaysInMonth(o,s))}l=c.exec(i)}return new Date(o,s,a)}(i):"number"==typeof i?isNaN(i)?n:function(e){var t=new Date;return t.setDate(t.getDate()+e),t}(i):new Date(i.getTime());return(r=r&&"Invalid Date"==""+r?n:r)&&(r.setHours(0),r.setMinutes(0),r.setSeconds(0),r.setMilliseconds(0)),this._daylightSavingAdjust(r)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,i){var n=!t,r=e.selectedMonth,o=e.selectedYear,s=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=s.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=s.getMonth(),e.drawYear=e.selectedYear=e.currentYear=s.getFullYear(),r===e.selectedMonth&&o===e.selectedYear||i||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(n?"":this._formatDate(e))},_getDate:function(e){return!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay))},_attachHandlers:function(t){var i=this._get(t,"stepMonths"),n="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map(function(){var t={prev:function(){e.datepicker._adjustDate(n,-i,"M")},next:function(){e.datepicker._adjustDate(n,+i,"M")},hide:function(){e.datepicker._hideDatepicker()},today:function(){e.datepicker._gotoToday(n)},selectDay:function(){return e.datepicker._selectDay(n,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return e.datepicker._selectMonthYear(n,this,"M"),!1},selectYear:function(){return e.datepicker._selectMonthYear(n,this,"Y"),!1}};e(this).on(this.getAttribute("data-event"),t[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t,i,n,r,o,s,a,c,l,d,h,u,p,m,f,g,v,y,b,_,w,x,C,S,E,M,T,A,k,R,D,L,I,O,P,H,N,z,F,U=new Date,B=this._daylightSavingAdjust(new Date(U.getFullYear(),U.getMonth(),U.getDate())),j=this._get(e,"isRTL"),G=this._get(e,"showButtonPanel"),V=this._get(e,"hideIfNoPrevNext"),$=this._get(e,"navigationAsDateFormat"),W=this._getNumberOfMonths(e),q=this._get(e,"showCurrentAtPos"),Y=this._get(e,"stepMonths"),X=1!==W[0]||1!==W[1],Z=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),K=this._getMinMaxDate(e,"min"),J=this._getMinMaxDate(e,"max"),Q=e.drawMonth-q,ee=e.drawYear;if(0>Q&&(Q+=12,ee--),J)for(t=this._daylightSavingAdjust(new Date(J.getFullYear(),J.getMonth()-W[0]*W[1]+1,J.getDate())),t=K&&K>t?K:t;this._daylightSavingAdjust(new Date(ee,Q,1))>t;)0>--Q&&(Q=11,ee--);for(e.drawMonth=Q,e.drawYear=ee,i=this._get(e,"prevText"),i=$?this.formatDate(i,this._daylightSavingAdjust(new Date(ee,Q-Y,1)),this._getFormatConfig(e)):i,n=this._canAdjustMonth(e,-1,ee,Q)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(j?"e":"w")+"'>"+i+"</span></a>":V?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(j?"e":"w")+"'>"+i+"</span></a>",r=this._get(e,"nextText"),r=$?this.formatDate(r,this._daylightSavingAdjust(new Date(ee,Q+Y,1)),this._getFormatConfig(e)):r,o=this._canAdjustMonth(e,1,ee,Q)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+r+"'><span class='ui-icon ui-icon-circle-triangle-"+(j?"w":"e")+"'>"+r+"</span></a>":V?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+r+"'><span class='ui-icon ui-icon-circle-triangle-"+(j?"w":"e")+"'>"+r+"</span></a>",s=this._get(e,"currentText"),a=this._get(e,"gotoCurrent")&&e.currentDay?Z:B,s=$?this.formatDate(s,a,this._getFormatConfig(e)):s,c=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",l=G?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(j?c:"")+(this._isInRange(e,a)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+s+"</button>":"")+(j?"":c)+"</div>":"",d=parseInt(this._get(e,"firstDay"),10),d=isNaN(d)?0:d,h=this._get(e,"showWeek"),u=this._get(e,"dayNames"),p=this._get(e,"dayNamesMin"),m=this._get(e,"monthNames"),f=this._get(e,"monthNamesShort"),g=this._get(e,"beforeShowDay"),v=this._get(e,"showOtherMonths"),y=this._get(e,"selectOtherMonths"),b=this._getDefaultDate(e),_="",x=0;W[0]>x;x++){for(C="",this.maxRows=4,S=0;W[1]>S;S++){if(E=this._daylightSavingAdjust(new Date(ee,Q,e.selectedDay)),M=" ui-corner-all",T="",X){if(T+="<div class='ui-datepicker-group",W[1]>1)switch(S){case 0:T+=" ui-datepicker-group-first",M=" ui-corner-"+(j?"right":"left");break;case W[1]-1:T+=" ui-datepicker-group-last",M=" ui-corner-"+(j?"left":"right");break;default:T+=" ui-datepicker-group-middle",M=""}T+="'>"}for(T+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+M+"'>"+(/all|left/.test(M)&&0===x?j?o:n:"")+(/all|right/.test(M)&&0===x?j?n:o:"")+this._generateMonthYearHeader(e,Q,ee,K,J,x>0||S>0,m,f)+"</div><table class='ui-datepicker-calendar'><thead><tr>",A=h?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"",w=0;7>w;w++)A+="<th scope='col'"+((w+d+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+u[k=(w+d)%7]+"'>"+p[k]+"</span></th>";for(T+=A+"</tr></thead><tbody>",R=this._getDaysInMonth(ee,Q),ee===e.selectedYear&&Q===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,R)),D=(this._getFirstDayOfMonth(ee,Q)-d+7)%7,L=Math.ceil((D+R)/7),this.maxRows=I=X&&this.maxRows>L?this.maxRows:L,O=this._daylightSavingAdjust(new Date(ee,Q,1-D)),P=0;I>P;P++){for(T+="<tr>",H=h?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(O)+"</td>":"",w=0;7>w;w++)N=g?g.apply(e.input?e.input[0]:null,[O]):[!0,""],F=(z=O.getMonth()!==Q)&&!y||!N[0]||K&&K>O||J&&O>J,H+="<td class='"+((w+d+6)%7>=5?" ui-datepicker-week-end":"")+(z?" ui-datepicker-other-month":"")+(O.getTime()===E.getTime()&&Q===e.selectedMonth&&e._keyEvent||b.getTime()===O.getTime()&&b.getTime()===E.getTime()?" "+this._dayOverClass:"")+(F?" "+this._unselectableClass+" ui-state-disabled":"")+(z&&!v?"":" "+N[1]+(O.getTime()===Z.getTime()?" "+this._currentClass:"")+(O.getTime()===B.getTime()?" ui-datepicker-today":""))+"'"+(z&&!v||!N[2]?"":" title='"+N[2].replace(/'/g,"&#39;")+"'")+(F?"":" data-handler='selectDay' data-event='click' data-month='"+O.getMonth()+"' data-year='"+O.getFullYear()+"'")+">"+(z&&!v?"&#xa0;":F?"<span class='ui-state-default'>"+O.getDate()+"</span>":"<a class='ui-state-default"+(O.getTime()===B.getTime()?" ui-state-highlight":"")+(O.getTime()===Z.getTime()?" ui-state-active":"")+(z?" ui-priority-secondary":"")+"' href='#'>"+O.getDate()+"</a>")+"</td>",O.setDate(O.getDate()+1),O=this._daylightSavingAdjust(O);T+=H+"</tr>"}++Q>11&&(Q=0,ee++),C+=T+="</tbody></table>"+(X?"</div>"+(W[0]>0&&S===W[1]-1?"<div class='ui-datepicker-row-break'></div>":""):"")}_+=C}return _+=l,e._keyEvent=!1,_},_generateMonthYearHeader:function(e,t,i,n,r,o,s,a){var c,l,d,h,u,p,m,f,g=this._get(e,"changeMonth"),v=this._get(e,"changeYear"),y=this._get(e,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",_="";if(o||!g)_+="<span class='ui-datepicker-month'>"+s[t]+"</span>";else{for(c=n&&n.getFullYear()===i,l=r&&r.getFullYear()===i,_+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",d=0;12>d;d++)(!c||d>=n.getMonth())&&(!l||r.getMonth()>=d)&&(_+="<option value='"+d+"'"+(d===t?" selected='selected'":"")+">"+a[d]+"</option>");_+="</select>"}if(y||(b+=_+(!o&&g&&v?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",o||!v)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(h=this._get(e,"yearRange").split(":"),u=(new Date).getFullYear(),m=(p=function(e){var t=e.match(/c[+\-].*/)?i+parseInt(e.substring(1),10):e.match(/[+\-].*/)?u+parseInt(e,10):parseInt(e,10);return isNaN(t)?u:t})(h[0]),f=Math.max(m,p(h[1]||"")),m=n?Math.max(m,n.getFullYear()):m,f=r?Math.min(f,r.getFullYear()):f,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";f>=m;m++)e.yearshtml+="<option value='"+m+"'"+(m===i?" selected='selected'":"")+">"+m+"</option>";e.yearshtml+="</select>",b+=e.yearshtml,e.yearshtml=null}return b+=this._get(e,"yearSuffix"),y&&(b+=(!o&&g&&v?"":"&#xa0;")+_),b+"</div>"},_adjustInstDate:function(e,t,i){var n=e.selectedYear+("Y"===i?t:0),r=e.selectedMonth+("M"===i?t:0),o=Math.min(e.selectedDay,this._getDaysInMonth(n,r))+("D"===i?t:0),s=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(n,r,o)));e.selectedDay=s.getDate(),e.drawMonth=e.selectedMonth=s.getMonth(),e.drawYear=e.selectedYear=s.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(e)},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,"min"),n=this._getMinMaxDate(e,"max"),r=i&&i>t?i:t;return n&&r>n?n:r},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,i,n){var r=this._getNumberOfMonths(e),o=this._daylightSavingAdjust(new Date(i,n+(0>t?t:r[0]*r[1]),1));return 0>t&&o.setDate(this._getDaysInMonth(o.getFullYear(),o.getMonth())),this._isInRange(e,o)},_isInRange:function(e,t){var i,n,r=this._getMinMaxDate(e,"min"),o=this._getMinMaxDate(e,"max"),s=null,a=null,c=this._get(e,"yearRange");return c&&(i=c.split(":"),n=(new Date).getFullYear(),s=parseInt(i[0],10),a=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(s+=n),i[1].match(/[+\-].*/)&&(a+=n)),(!r||t.getTime()>=r.getTime())&&(!o||t.getTime()<=o.getTime())&&(!s||t.getFullYear()>=s)&&(!a||a>=t.getFullYear())},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return{shortYearCutoff:t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,i,n){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var r=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(n,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),r,this._getFormatConfig(e))}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).on("mousedown",e.datepicker._checkExternalClick),e.datepicker.initialized=!0),0===e("#"+e.datepicker._mainDivId).length&&e("body").append(e.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!==t&&"getDate"!==t&&"widget"!==t?"option"===t&&2===arguments.length&&"string"==typeof arguments[1]?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof t?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this].concat(i)):e.datepicker._attachDatepicker(this,t)}):e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i))},e.datepicker=new t,e.datepicker.initialized=!1,e.datepicker.uuid=(new Date).getTime(),e.datepicker.version="1.12.1",e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());var f=!1;e(document).on("mouseup",function(){f=!1}),e.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.on("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).on("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!f){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,n=1===t.which,r=!("string"!=typeof this.options.cancel||!t.target.nodeName)&&e(t.target).closest(this.options.cancel).length;return!(n&&!r&&this._mouseCapture(t)&&(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(t),!this._mouseStarted)?(t.preventDefault(),0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),f=!0,0)))}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button)return this._mouseUp(t);if(!t.which)if(t.originalEvent.altKey||t.originalEvent.ctrlKey||t.originalEvent.metaKey||t.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(t)}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,t),this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,f=!1,t.preventDefault()},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),e.ui.plugin={add:function(t,i,n){var r,o=e.ui[t].prototype;for(r in n)o.plugins[r]=o.plugins[r]||[],o.plugins[r].push([i,n[r]])},call:function(e,t,i,n){var r,o=e.plugins[t];if(o&&(n||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(r=0;o.length>r;r++)e.options[o[r][0]]&&o[r][1].apply(e.element,i)}},e.ui.safeBlur=function(t){t&&"body"!==t.nodeName.toLowerCase()&&e(t).trigger("blur")},e.widget("ui.draggable",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?void(this.destroyOnClear=!0):(this._removeHandleClassName(),void this._mouseDestroy())},_mouseCapture:function(t){var i=this.options;return!(this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0||(this.handle=this._getHandle(t),!this.handle||(this._blurActiveElement(t),this._blockFrames(!0===i.iframeFix?"iframe":i.iframeFix),0)))},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map(function(){var t=e(this);return e("<div>").css("position","absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(t){var i=e.ui.safeActiveElement(this.document[0]);e(t.target).closest(i).length||e.ui.safeBlur(i)},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===e(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),!1===this._trigger("start",t)?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(t,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var n=this._uiHash();if(!1===this._trigger("drag",t,n))return this._mouseUp(new e.Event("mouseup",t)),!1;this.position=n.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,n=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(n=e.ui.ddmanager.drop(this,t)),this.dropped&&(n=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!n||"valid"===this.options.revert&&n||!0===this.options.revert||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){!1!==i._trigger("stop",t)&&i._clear()}):!1!==this._trigger("stop",t)&&this._clear(),!1},_mouseUp:function(t){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.trigger("focus"),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new e.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(t){return!this.options.handle||!!e(t.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(t){var i=this.options,n=e.isFunction(i.helper),r=n?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return r.parents("body").length||r.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),n&&r[0]===this.element[0]&&this._setPositionRelative(),r[0]===this.element[0]||/(fixed|absolute)/.test(r.css("position"))||r.css("position","absolute"),r},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,n,r=this.options,o=this.document[0];return this.relativeContainer=null,r.containment?"window"===r.containment?void(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===r.containment?void(this.containment=[0,0,e(o).width()-this.helperProportions.width-this.margins.left,(e(o).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):r.containment.constructor===Array?void(this.containment=r.containment):("parent"===r.containment&&(r.containment=this.helper[0].parentNode),void((n=(i=e(r.containment))[0])&&(t=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i))):void(this.containment=null)},_convertPositionTo:function(e,t){t||(t=this.position);var i="absolute"===e?1:-1,n=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:n?0:this.offset.scroll.top)*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:n?0:this.offset.scroll.left)*i}},_generatePosition:function(e,t){var i,n,r,o,s=this.options,a=this._isRootNode(this.scrollParent[0]),c=e.pageX,l=e.pageY;return a&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(n=this.relativeContainer.offset(),i=[this.containment[0]+n.left,this.containment[1]+n.top,this.containment[2]+n.left,this.containment[3]+n.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(c=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(l=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(c=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(l=i[3]+this.offset.click.top)),s.grid&&(r=s.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/s.grid[1])*s.grid[1]:this.originalPageY,l=i?r-this.offset.click.top>=i[1]||r-this.offset.click.top>i[3]?r:r-this.offset.click.top>=i[1]?r-s.grid[1]:r+s.grid[1]:r,o=s.grid[0]?this.originalPageX+Math.round((c-this.originalPageX)/s.grid[0])*s.grid[0]:this.originalPageX,c=i?o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-s.grid[0]:o+s.grid[0]:o),"y"===s.axis&&(c=this.originalPageX),"x"===s.axis&&(l=this.originalPageY)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:a?0:this.offset.scroll.top),left:c-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:a?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(t,i,n){return n=n||this._uiHash(),e.ui.plugin.call(this,t,[i,n,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo("absolute"),n.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,i,n)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i,n){var r=e.extend({},i,{item:n.element});n.sortables=[],e(n.options.connectToSortable).each(function(){var i=e(this).sortable("instance");i&&!i.options.disabled&&(n.sortables.push(i),i.refreshPositions(),i._trigger("activate",t,r))})},stop:function(t,i,n){var r=e.extend({},i,{item:n.element});n.cancelHelperRemoval=!1,e.each(n.sortables,function(){var e=this;e.isOver?(e.isOver=0,n.cancelHelperRemoval=!0,e.cancelHelperRemoval=!1,e._storedCSS={position:e.placeholder.css("position"),top:e.placeholder.css("top"),left:e.placeholder.css("left")},e._mouseStop(t),e.options.helper=e.options._helper):(e.cancelHelperRemoval=!0,e._trigger("deactivate",t,r))})},drag:function(t,i,n){e.each(n.sortables,function(){var r=!1,o=this;o.positionAbs=n.positionAbs,o.helperProportions=n.helperProportions,o.offset.click=n.offset.click,o._intersectsWith(o.containerCache)&&(r=!0,e.each(n.sortables,function(){return this.positionAbs=n.positionAbs,this.helperProportions=n.helperProportions,this.offset.click=n.offset.click,this!==o&&this._intersectsWith(this.containerCache)&&e.contains(o.element[0],this.element[0])&&(r=!1),r})),r?(o.isOver||(o.isOver=1,n._parent=i.helper.parent(),o.currentItem=i.helper.appendTo(o.element).data("ui-sortable-item",!0),o.options._helper=o.options.helper,o.options.helper=function(){return i.helper[0]},t.target=o.currentItem[0],o._mouseCapture(t,!0),o._mouseStart(t,!0,!0),o.offset.click.top=n.offset.click.top,o.offset.click.left=n.offset.click.left,o.offset.parent.left-=n.offset.parent.left-o.offset.parent.left,o.offset.parent.top-=n.offset.parent.top-o.offset.parent.top,n._trigger("toSortable",t),n.dropped=o.element,e.each(n.sortables,function(){this.refreshPositions()}),n.currentItem=n.element,o.fromOutside=n),o.currentItem&&(o._mouseDrag(t),i.position=o.position)):o.isOver&&(o.isOver=0,o.cancelHelperRemoval=!0,o.options._revert=o.options.revert,o.options.revert=!1,o._trigger("out",t,o._uiHash(o)),o._mouseStop(t,!0),o.options.revert=o.options._revert,o.options.helper=o.options._helper,o.placeholder&&o.placeholder.remove(),i.helper.appendTo(n._parent),n._refreshOffsets(t),i.position=n._generatePosition(t,!0),n._trigger("fromSortable",t),n.dropped=!1,e.each(n.sortables,function(){this.refreshPositions()}))})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,i,n){var r=e("body"),o=n.options;r.css("cursor")&&(o._cursor=r.css("cursor")),r.css("cursor",o.cursor)},stop:function(t,i,n){var r=n.options;r._cursor&&e("body").css("cursor",r._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i,n){var r=e(i.helper),o=n.options;r.css("opacity")&&(o._opacity=r.css("opacity")),r.css("opacity",o.opacity)},stop:function(t,i,n){var r=n.options;r._opacity&&e(i.helper).css("opacity",r._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(e,t,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(t,i,n){var r=n.options,o=!1,s=n.scrollParentNotHidden[0],a=n.document[0];s!==a&&"HTML"!==s.tagName?(r.axis&&"x"===r.axis||(n.overflowOffset.top+s.offsetHeight-t.pageY<r.scrollSensitivity?s.scrollTop=o=s.scrollTop+r.scrollSpeed:t.pageY-n.overflowOffset.top<r.scrollSensitivity&&(s.scrollTop=o=s.scrollTop-r.scrollSpeed)),r.axis&&"y"===r.axis||(n.overflowOffset.left+s.offsetWidth-t.pageX<r.scrollSensitivity?s.scrollLeft=o=s.scrollLeft+r.scrollSpeed:t.pageX-n.overflowOffset.left<r.scrollSensitivity&&(s.scrollLeft=o=s.scrollLeft-r.scrollSpeed))):(r.axis&&"x"===r.axis||(t.pageY-e(a).scrollTop()<r.scrollSensitivity?o=e(a).scrollTop(e(a).scrollTop()-r.scrollSpeed):e(window).height()-(t.pageY-e(a).scrollTop())<r.scrollSensitivity&&(o=e(a).scrollTop(e(a).scrollTop()+r.scrollSpeed))),r.axis&&"y"===r.axis||(t.pageX-e(a).scrollLeft()<r.scrollSensitivity?o=e(a).scrollLeft(e(a).scrollLeft()-r.scrollSpeed):e(window).width()-(t.pageX-e(a).scrollLeft())<r.scrollSensitivity&&(o=e(a).scrollLeft(e(a).scrollLeft()+r.scrollSpeed)))),!1!==o&&e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(n,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,i,n){var r=n.options;n.snapElements=[],e(r.snap.constructor!==String?r.snap.items||":data(ui-draggable)":r.snap).each(function(){var t=e(this),i=t.offset();this!==n.element[0]&&n.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:i.top,left:i.left})})},drag:function(t,i,n){var r,o,s,a,c,l,d,h,u,p,m=n.options,f=m.snapTolerance,g=i.offset.left,v=g+n.helperProportions.width,y=i.offset.top,b=y+n.helperProportions.height;for(u=n.snapElements.length-1;u>=0;u--)l=(c=n.snapElements[u].left-n.margins.left)+n.snapElements[u].width,h=(d=n.snapElements[u].top-n.margins.top)+n.snapElements[u].height,c-f>v||g>l+f||d-f>b||y>h+f||!e.contains(n.snapElements[u].item.ownerDocument,n.snapElements[u].item)?(n.snapElements[u].snapping&&n.options.snap.release&&n.options.snap.release.call(n.element,t,e.extend(n._uiHash(),{snapItem:n.snapElements[u].item})),n.snapElements[u].snapping=!1):("inner"!==m.snapMode&&(r=f>=Math.abs(d-b),o=f>=Math.abs(h-y),s=f>=Math.abs(c-v),a=f>=Math.abs(l-g),r&&(i.position.top=n._convertPositionTo("relative",{top:d-n.helperProportions.height,left:0}).top),o&&(i.position.top=n._convertPositionTo("relative",{top:h,left:0}).top),s&&(i.position.left=n._convertPositionTo("relative",{top:0,left:c-n.helperProportions.width}).left),a&&(i.position.left=n._convertPositionTo("relative",{top:0,left:l}).left)),p=r||o||s||a,"outer"!==m.snapMode&&(r=f>=Math.abs(d-y),o=f>=Math.abs(h-b),s=f>=Math.abs(c-g),a=f>=Math.abs(l-v),r&&(i.position.top=n._convertPositionTo("relative",{top:d,left:0}).top),o&&(i.position.top=n._convertPositionTo("relative",{top:h-n.helperProportions.height,left:0}).top),s&&(i.position.left=n._convertPositionTo("relative",{top:0,left:c}).left),a&&(i.position.left=n._convertPositionTo("relative",{top:0,left:l-n.helperProportions.width}).left)),!n.snapElements[u].snapping&&(r||o||s||a||p)&&n.options.snap.snap&&n.options.snap.snap.call(n.element,t,e.extend(n._uiHash(),{snapItem:n.snapElements[u].item})),n.snapElements[u].snapping=r||o||s||a||p)}}),e.ui.plugin.add("draggable","stack",{start:function(t,i,n){var r,o=e.makeArray(e(n.options.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});o.length&&(r=parseInt(e(o[0]).css("zIndex"),10)||0,e(o).each(function(t){e(this).css("zIndex",r+t)}),this.css("zIndex",r+o.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i,n){var r=e(i.helper),o=n.options;r.css("zIndex")&&(o._zIndex=r.css("zIndex")),r.css("zIndex",o.zIndex)},stop:function(t,i,n){var r=n.options;r._zIndex&&e(i.helper).css("zIndex",r._zIndex)}}),e.widget("ui.resizable",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(e){return parseFloat(e)||0},_isNumber:function(e){return!isNaN(parseFloat(e))},_hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var n=i&&"left"===i?"scrollLeft":"scrollTop",r=!1;return t[n]>0||(t[n]=1,r=t[n]>0,t[n]=0,r)},_create:function(){var t,i=this.options,n=this;this._addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!i.aspectRatio,aspectRatio:i.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:i.helper||i.ghost||i.animate?i.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,t={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(t),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(t),this._proportionallyResize()),this._setupHandles(),i.autoHide&&e(this.element).on("mouseenter",function(){i.disabled||(n._removeClass("ui-resizable-autohide"),n._handles.show())}).on("mouseleave",function(){i.disabled||n.resizing||(n._addClass("ui-resizable-autohide"),n._handles.hide())}),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,i=function(t){e(t).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),this.originalElement.css({position:(t=this.element).css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_setOption:function(e,t){switch(this._super(e,t),e){case"handles":this._removeHandles(),this._setupHandles()}},_setupHandles:function(){var t,i,n,r,o,s=this.options,a=this;if(this.handles=s.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=e(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),n=this.handles.split(","),this.handles={},i=0;n.length>i;i++)r="ui-resizable-"+(t=e.trim(n[i])),o=e("<div>"),this._addClass(o,"ui-resizable-handle "+r),o.css({zIndex:s.zIndex}),this.handles[t]=".ui-resizable-"+t,this.element.append(o);this._renderAxis=function(t){var i,n,r,o;for(i in t=t||this.element,this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=e(this.handles[i]),this._on(this.handles[i],{mousedown:a._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(n=e(this.handles[i],this.element),o=/sw|ne|nw|se|n|s/.test(i)?n.outerHeight():n.outerWidth(),r=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(r,o),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){a.resizing||(this.className&&(o=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),a.axis=o&&o[1]?o[1]:"se")}),s.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(t){var i,n,r=!1;for(i in this.handles)((n=e(this.handles[i])[0])===t.target||e.contains(n,t.target))&&(r=!0);return!this.options.disabled&&r},_mouseStart:function(t){var i,n,r,o=this.options,s=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),n=this._num(this.helper.css("top")),o.containment&&(i+=e(o.containment).scrollLeft()||0,n+=e(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:n},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:s.width(),height:s.height()},this.originalSize=this._helper?{width:s.outerWidth(),height:s.outerHeight()}:{width:s.width(),height:s.height()},this.sizeDiff={width:s.outerWidth()-s.width(),height:s.outerHeight()-s.height()},this.originalPosition={left:i,top:n},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,r=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===r?this.axis+"-resize":r),this._addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var i,n,r=this.originalMousePosition,o=t.pageX-r.left||0,s=t.pageY-r.top||0,a=this._change[this.axis];return this._updatePrevProperties(),!!a&&(i=a.apply(this,[t,o,s]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate("resize",t),n=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(n)||(this._updatePrevProperties(),this._trigger("resize",t,this.ui()),this._applyChanges()),!1)},_mouseStop:function(t){this.resizing=!1;var i,n,r,o,s,a,c,l=this.options,d=this;return this._helper&&(r=(n=(i=this._proportionallyResizeElements).length&&/textarea/i.test(i[0].nodeName))&&this._hasScroll(i[0],"left")?0:d.sizeDiff.height,o=n?0:d.sizeDiff.width,s={width:d.helper.width()-o,height:d.helper.height()-r},a=parseFloat(d.element.css("left"))+(d.position.left-d.originalPosition.left)||null,c=parseFloat(d.element.css("top"))+(d.position.top-d.originalPosition.top)||null,l.animate||this.element.css(e.extend(s,{top:c,left:a})),d.helper.height(d.size.height),d.helper.width(d.size.width),this._helper&&!l.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var e={};return this.position.top!==this.prevPosition.top&&(e.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(e.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(e.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(e.height=this.size.height+"px"),this.helper.css(e),e},_updateVirtualBoundaries:function(e){var t,i,n,r,o,s=this.options;o={minWidth:this._isNumber(s.minWidth)?s.minWidth:0,maxWidth:this._isNumber(s.maxWidth)?s.maxWidth:1/0,minHeight:this._isNumber(s.minHeight)?s.minHeight:0,maxHeight:this._isNumber(s.maxHeight)?s.maxHeight:1/0},(this._aspectRatio||e)&&(n=o.minWidth/this.aspectRatio,i=o.maxHeight*this.aspectRatio,r=o.maxWidth/this.aspectRatio,(t=o.minHeight*this.aspectRatio)>o.minWidth&&(o.minWidth=t),n>o.minHeight&&(o.minHeight=n),o.maxWidth>i&&(o.maxWidth=i),o.maxHeight>r&&(o.maxHeight=r)),this._vBoundaries=o},_updateCache:function(e){this.offset=this.helper.offset(),this._isNumber(e.left)&&(this.position.left=e.left),this._isNumber(e.top)&&(this.position.top=e.top),this._isNumber(e.height)&&(this.size.height=e.height),this._isNumber(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,i=this.size,n=this.axis;return this._isNumber(e.height)?e.width=e.height*this.aspectRatio:this._isNumber(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===n&&(e.left=t.left+(i.width-e.width),e.top=null),"nw"===n&&(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,n=this._isNumber(e.width)&&t.maxWidth&&t.maxWidth<e.width,r=this._isNumber(e.height)&&t.maxHeight&&t.maxHeight<e.height,o=this._isNumber(e.width)&&t.minWidth&&t.minWidth>e.width,s=this._isNumber(e.height)&&t.minHeight&&t.minHeight>e.height,a=this.originalPosition.left+this.originalSize.width,c=this.originalPosition.top+this.originalSize.height,l=/sw|nw|w/.test(i),d=/nw|ne|n/.test(i);return o&&(e.width=t.minWidth),s&&(e.height=t.minHeight),n&&(e.width=t.maxWidth),r&&(e.height=t.maxHeight),o&&l&&(e.left=a-t.minWidth),n&&l&&(e.left=a-t.maxWidth),s&&d&&(e.top=c-t.minHeight),r&&d&&(e.top=c-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_getPaddingPlusBorderDimensions:function(e){for(var t=0,i=[],n=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],r=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];4>t;t++)i[t]=parseFloat(n[t])||0,i[t]+=parseFloat(r[t])||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e,t=0,i=this.helper||this.element;this._proportionallyResizeElements.length>t;t++)e=this._proportionallyResizeElements[t],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(e)),e.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var t=this.options;this.elementOffset=this.element.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++t.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){return{left:this.originalPosition.left+t,width:this.originalSize.width-t}},n:function(e,t,i){return{top:this.originalPosition.top+i,height:this.originalSize.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,n){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,n]))},sw:function(t,i,n){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,n]))},ne:function(t,i,n){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,n]))},nw:function(t,i,n){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,n]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!==t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).resizable("instance"),n=i.options,r=i._proportionallyResizeElements,o=r.length&&/textarea/i.test(r[0].nodeName),s=o&&i._hasScroll(r[0],"left")?0:i.sizeDiff.height,a={width:i.size.width-(o?0:i.sizeDiff.width),height:i.size.height-s},c=parseFloat(i.element.css("left"))+(i.position.left-i.originalPosition.left)||null,l=parseFloat(i.element.css("top"))+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(a,l&&c?{top:l,left:c}:{}),{duration:n.animateDuration,easing:n.animateEasing,step:function(){var n={width:parseFloat(i.element.css("width")),height:parseFloat(i.element.css("height")),top:parseFloat(i.element.css("top")),left:parseFloat(i.element.css("left"))};r&&r.length&&e(r[0]).css({width:n.width,height:n.height}),i._updateCache(n),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,i,n,r,o,s,a,c=e(this).resizable("instance"),l=c.element,d=c.options.containment,h=d instanceof e?d.get(0):/parent/.test(d)?l.parent().get(0):d;h&&(c.containerElement=e(h),/document/.test(d)||d===document?(c.containerOffset={left:0,top:0},c.containerPosition={left:0,top:0},c.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(h),i=[],e(["Top","Right","Left","Bottom"]).each(function(e,n){i[e]=c._num(t.css("padding"+n))}),c.containerOffset=t.offset(),c.containerPosition=t.position(),c.containerSize={height:t.innerHeight()-i[3],width:t.innerWidth()-i[1]},n=c.containerOffset,r=c.containerSize.height,o=c.containerSize.width,s=c._hasScroll(h,"left")?h.scrollWidth:o,a=c._hasScroll(h)?h.scrollHeight:r,c.parentData={element:h,left:n.left,top:n.top,width:s,height:a}))},resize:function(t){var i,n,r,o,s=e(this).resizable("instance"),a=s.options,c=s.containerOffset,l=s.position,d=s._aspectRatio||t.shiftKey,h={top:0,left:0},u=s.containerElement,p=!0;u[0]!==document&&/static/.test(u.css("position"))&&(h=c),l.left<(s._helper?c.left:0)&&(s.size.width=s.size.width+(s._helper?s.position.left-c.left:s.position.left-h.left),d&&(s.size.height=s.size.width/s.aspectRatio,p=!1),s.position.left=a.helper?c.left:0),l.top<(s._helper?c.top:0)&&(s.size.height=s.size.height+(s._helper?s.position.top-c.top:s.position.top),d&&(s.size.width=s.size.height*s.aspectRatio,p=!1),s.position.top=s._helper?c.top:0),r=s.containerElement.get(0)===s.element.parent().get(0),o=/relative|absolute/.test(s.containerElement.css("position")),r&&o?(s.offset.left=s.parentData.left+s.position.left,s.offset.top=s.parentData.top+s.position.top):(s.offset.left=s.element.offset().left,s.offset.top=s.element.offset().top),i=Math.abs(s.sizeDiff.width+(s._helper?s.offset.left-h.left:s.offset.left-c.left)),n=Math.abs(s.sizeDiff.height+(s._helper?s.offset.top-h.top:s.offset.top-c.top)),i+s.size.width>=s.parentData.width&&(s.size.width=s.parentData.width-i,d&&(s.size.height=s.size.width/s.aspectRatio,p=!1)),n+s.size.height>=s.parentData.height&&(s.size.height=s.parentData.height-n,d&&(s.size.width=s.size.height*s.aspectRatio,p=!1)),p||(s.position.left=s.prevPosition.left,s.position.top=s.prevPosition.top,s.size.width=s.prevSize.width,s.size.height=s.prevSize.height)},stop:function(){var t=e(this).resizable("instance"),i=t.options,n=t.containerOffset,r=t.containerPosition,o=t.containerElement,s=e(t.helper),a=s.offset(),c=s.outerWidth()-t.sizeDiff.width,l=s.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(o.css("position"))&&e(this).css({left:a.left-r.left-n.left,width:c,height:l}),t._helper&&!i.animate&&/static/.test(o.css("position"))&&e(this).css({left:a.left-r.left-n.left,width:c,height:l})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).resizable("instance");e(t.options.alsoResize).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseFloat(t.width()),height:parseFloat(t.height()),left:parseFloat(t.css("left")),top:parseFloat(t.css("top"))})})},resize:function(t,i){var n=e(this).resizable("instance"),r=n.originalSize,o=n.originalPosition,s={height:n.size.height-r.height||0,width:n.size.width-r.width||0,top:n.position.top-o.top||0,left:n.position.left-o.left||0};e(n.options.alsoResize).each(function(){var t=e(this),n=e(this).data("ui-resizable-alsoresize"),r={},o=t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(o,function(e,t){var i=(n[t]||0)+(s[t]||0);i&&i>=0&&(r[t]=i||null)}),t.css(r)})},stop:function(){e(this).removeData("ui-resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).resizable("instance"),i=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}),t._addClass(t.ghost,"ui-resizable-ghost"),!1!==e.uiBackCompat&&"string"==typeof t.options.ghost&&t.ghost.addClass(this.options.ghost),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).resizable("instance");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).resizable("instance");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t,i=e(this).resizable("instance"),n=i.options,r=i.size,o=i.originalSize,s=i.originalPosition,a=i.axis,c="number"==typeof n.grid?[n.grid,n.grid]:n.grid,l=c[0]||1,d=c[1]||1,h=Math.round((r.width-o.width)/l)*l,u=Math.round((r.height-o.height)/d)*d,p=o.width+h,m=o.height+u,f=n.maxWidth&&p>n.maxWidth,g=n.maxHeight&&m>n.maxHeight,v=n.minWidth&&n.minWidth>p,y=n.minHeight&&n.minHeight>m;n.grid=c,v&&(p+=l),y&&(m+=d),f&&(p-=l),g&&(m-=d),/^(se|s|e)$/.test(a)?(i.size.width=p,i.size.height=m):/^(ne)$/.test(a)?(i.size.width=p,i.size.height=m,i.position.top=s.top-u):/^(sw)$/.test(a)?(i.size.width=p,i.size.height=m,i.position.left=s.left-h):((0>=m-d||0>=p-l)&&(t=i._getPaddingPlusBorderDimensions(this)),m-d>0?(i.size.height=m,i.position.top=s.top-u):(i.size.height=m=d-t.height,i.position.top=s.top+o.height-m),p-l>0?(i.size.width=p,i.position.left=s.left-h):(i.size.width=p=l-t.width,i.position.left=s.left+o.width-p))}}),e.widget("ui.dialog",{version:"1.12.1",options:{appendTo:"body",autoOpen:!0,buttons:[],classes:{"ui-dialog":"ui-corner-all","ui-dialog-titlebar":"ui-corner-all"},closeOnEscape:!0,closeText:"Close",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var i=e(this).css(t).offset().top;0>i&&e(this).css("top",t.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),null==this.options.title&&null!=this.originalTitle&&(this.options.title=this.originalTitle),this.options.disabled&&(this.options.disabled=!1),this._createWrapper(),this.element.show().removeAttr("title").appendTo(this.uiDialog),this._addClass("ui-dialog-content","ui-widget-content"),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&e.fn.draggable&&this._makeDraggable(),this.options.resizable&&e.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var t=this.options.appendTo;return t&&(t.jquery||t.nodeType)?e(t):this.document.find(t||"body").eq(0)},_destroy:function(){var e,t=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().css(this.originalCss).detach(),this.uiDialog.remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),(e=t.parent.children().eq(t.index)).length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},disable:e.noop,enable:e.noop,close:function(t){var i=this;this._isOpen&&!1!==this._trigger("beforeClose",t)&&(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),this.opener.filter(":focusable").trigger("focus").length||e.ui.safeBlur(e.ui.safeActiveElement(this.document[0])),this._hide(this.uiDialog,this.options.hide,function(){i._trigger("close",t)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(t,i){var n=!1,r=this.uiDialog.siblings(".ui-front:visible").map(function(){return+e(this).css("z-index")}).get(),o=Math.max.apply(null,r);return o>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",o+1),n=!0),n&&!i&&this._trigger("focus",t),n},open:function(){var t=this;return this._isOpen?void(this._moveToTop()&&this._focusTabbable()):(this._isOpen=!0,this.opener=e(e.ui.safeActiveElement(this.document[0])),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){t._focusTabbable(),t._trigger("focus")}),this._makeFocusTarget(),void this._trigger("open"))},_focusTabbable:function(){var e=this._focusedElement;e||(e=this.element.find("[autofocus]")),e.length||(e=this.element.find(":tabbable")),e.length||(e=this.uiDialogButtonPane.find(":tabbable")),e.length||(e=this.uiDialogTitlebarClose.filter(":tabbable")),e.length||(e=this.uiDialog),e.eq(0).trigger("focus")},_keepFocus:function(t){function i(){var t=e.ui.safeActiveElement(this.document[0]);this.uiDialog[0]===t||e.contains(this.uiDialog[0],t)||this._focusTabbable()}t.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=e("<div>").hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._addClass(this.uiDialog,"ui-dialog","ui-widget ui-widget-content ui-front"),this._on(this.uiDialog,{keydown:function(t){if(this.options.closeOnEscape&&!t.isDefaultPrevented()&&t.keyCode&&t.keyCode===e.ui.keyCode.ESCAPE)return t.preventDefault(),void this.close(t);if(t.keyCode===e.ui.keyCode.TAB&&!t.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),n=i.filter(":first"),r=i.filter(":last");t.target!==r[0]&&t.target!==this.uiDialog[0]||t.shiftKey?t.target!==n[0]&&t.target!==this.uiDialog[0]||!t.shiftKey||(this._delay(function(){r.trigger("focus")}),t.preventDefault()):(this._delay(function(){n.trigger("focus")}),t.preventDefault())}},mousedown:function(e){this._moveToTop(e)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var t;this.uiDialogTitlebar=e("<div>"),this._addClass(this.uiDialogTitlebar,"ui-dialog-titlebar","ui-widget-header ui-helper-clearfix"),this._on(this.uiDialogTitlebar,{mousedown:function(t){e(t.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.trigger("focus")}}),this.uiDialogTitlebarClose=e("<button type='button'></button>").button({label:e("<a>").text(this.options.closeText).html(),icon:"ui-icon-closethick",showLabel:!1}).appendTo(this.uiDialogTitlebar),this._addClass(this.uiDialogTitlebarClose,"ui-dialog-titlebar-close"),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e)}}),t=e("<span>").uniqueId().prependTo(this.uiDialogTitlebar),this._addClass(t,"ui-dialog-title"),this._title(t),this.uiDialogTitlebar.prependTo(this.uiDialog),this.uiDialog.attr({"aria-labelledby":t.attr("id")})},_title:function(e){this.options.title?e.text(this.options.title):e.html("&#160;")},_createButtonPane:function(){this.uiDialogButtonPane=e("<div>"),this._addClass(this.uiDialogButtonPane,"ui-dialog-buttonpane","ui-widget-content ui-helper-clearfix"),this.uiButtonSet=e("<div>").appendTo(this.uiDialogButtonPane),this._addClass(this.uiButtonSet,"ui-dialog-buttonset"),this._createButtons()},_createButtons:function(){var t=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),e.isEmptyObject(i)||e.isArray(i)&&!i.length?void this._removeClass(this.uiDialog,"ui-dialog-buttons"):(e.each(i,function(i,n){var r,o;n=e.isFunction(n)?{click:n,text:i}:n,n=e.extend({type:"button"},n),r=n.click,o={icon:n.icon,iconPosition:n.iconPosition,showLabel:n.showLabel,icons:n.icons,text:n.text},delete n.click,delete n.icon,delete n.iconPosition,delete n.showLabel,delete n.icons,"boolean"==typeof n.text&&delete n.text,e("<button></button>",n).button(o).appendTo(t.uiButtonSet).on("click",function(){r.apply(t.element[0],arguments)})}),this._addClass(this.uiDialog,"ui-dialog-buttons"),void this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){function t(e){return{position:e.position,offset:e.offset}}var i=this,n=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(n,r){i._addClass(e(this),"ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",n,t(r))},drag:function(e,n){i._trigger("drag",e,t(n))},stop:function(r,o){var s=o.offset.left-i.document.scrollLeft(),a=o.offset.top-i.document.scrollTop();n.position={my:"left top",at:"left"+(s>=0?"+":"")+s+" top"+(a>=0?"+":"")+a,of:i.window},i._removeClass(e(this),"ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",r,t(o))}})},_makeResizable:function(){function t(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}var i=this,n=this.options,r=n.resizable,o=this.uiDialog.css("position"),s="string"==typeof r?r:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:n.maxWidth,maxHeight:n.maxHeight,minWidth:n.minWidth,minHeight:this._minHeight(),handles:s,start:function(n,r){i._addClass(e(this),"ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",n,t(r))},resize:function(e,n){i._trigger("resize",e,t(n))},stop:function(r,o){var s=i.uiDialog.offset(),a=s.left-i.document.scrollLeft(),c=s.top-i.document.scrollTop();n.height=i.uiDialog.height(),n.width=i.uiDialog.width(),n.position={my:"left top",at:"left"+(a>=0?"+":"")+a+" top"+(c>=0?"+":"")+c,of:i.window},i._removeClass(e(this),"ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",r,t(o))}}).css("position",o)},_trackFocus:function(){this._on(this.widget(),{focusin:function(t){this._makeFocusTarget(),this._focusedElement=e(t.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var t=this._trackingInstances(),i=e.inArray(this,t);-1!==i&&t.splice(i,1)},_trackingInstances:function(){var e=this.document.data("ui-dialog-instances");return e||this.document.data("ui-dialog-instances",e=[]),e},_minHeight:function(){var e=this.options;return"auto"===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(){var e=this.uiDialog.is(":visible");e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide()},_setOptions:function(t){var i=this,n=!1,r={};e.each(t,function(e,t){i._setOption(e,t),e in i.sizeRelatedOptions&&(n=!0),e in i.resizableRelatedOptions&&(r[e]=t)}),n&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",r)},_setOption:function(t,i){var n,r,o=this.uiDialog;"disabled"!==t&&(this._super(t,i),"appendTo"===t&&this.uiDialog.appendTo(this._appendTo()),"buttons"===t&&this._createButtons(),"closeText"===t&&this.uiDialogTitlebarClose.button({label:e("<a>").text(""+this.options.closeText).html()}),"draggable"===t&&((n=o.is(":data(ui-draggable)"))&&!i&&o.draggable("destroy"),!n&&i&&this._makeDraggable()),"position"===t&&this._position(),"resizable"===t&&((r=o.is(":data(ui-resizable)"))&&!i&&o.resizable("destroy"),r&&"string"==typeof i&&o.resizable("option","handles",i),r||!1===i||this._makeResizable()),"title"===t&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var e,t,i,n=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),n.minWidth>n.width&&(n.width=n.minWidth),e=this.uiDialog.css({height:"auto",width:n.width}).outerHeight(),t=Math.max(0,n.minHeight-e),i="number"==typeof n.maxHeight?Math.max(0,n.maxHeight-e):"none","auto"===n.height?this.element.css({minHeight:t,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,n.height-e)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var t=e(this);return e("<div>").css({position:"absolute",width:t.outerWidth(),height:t.outerHeight()}).appendTo(t.parent()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(t){return!!e(t.target).closest(".ui-dialog").length||!!e(t.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var t=!0;this._delay(function(){t=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(e){t||this._allowInteraction(e)||(e.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=e("<div>").appendTo(this._appendTo()),this._addClass(this.overlay,null,"ui-widget-overlay ui-front"),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var e=this.document.data("ui-dialog-overlays")-1;e?this.document.data("ui-dialog-overlays",e):(this._off(this.document,"focusin"),this.document.removeData("ui-dialog-overlays")),this.overlay.remove(),this.overlay=null}}}),!1!==e.uiBackCompat&&e.widget("ui.dialog",e.ui.dialog,{options:{dialogClass:""},_createWrapper:function(){this._super(),this.uiDialog.addClass(this.options.dialogClass)},_setOption:function(e,t){"dialogClass"===e&&this.uiDialog.removeClass(this.options.dialogClass).addClass(t),this._superApply(arguments)}}),e.widget("ui.droppable",{version:"1.12.1",widgetEventPrefix:"drop",options:{accept:"*",addClasses:!0,greedy:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,i=this.options,n=i.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(n)?n:function(e){return e.is(n)},this.proportions=function(){return arguments.length?void(t=arguments[0]):t||(t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight})},this._addToManager(i.scope),i.addClasses&&this._addClass("ui-droppable")},_addToManager:function(t){e.ui.ddmanager.droppables[t]=e.ui.ddmanager.droppables[t]||[],e.ui.ddmanager.droppables[t].push(this)},_splice:function(e){for(var t=0;e.length>t;t++)e[t]===this&&e.splice(t,1)},_destroy:function(){this._splice(e.ui.ddmanager.droppables[this.options.scope])},_setOption:function(t,i){"accept"===t?this.accept=e.isFunction(i)?i:function(e){return e.is(i)}:"scope"===t&&(this._splice(e.ui.ddmanager.droppables[this.options.scope]),this._addToManager(i)),this._super(t,i)},_activate:function(t){var i=e.ui.ddmanager.current;this._addActiveClass(),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this._removeActiveClass(),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._addHoverClass(),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this._removeHoverClass(),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var n=i||e.ui.ddmanager.current,r=!1;return!(!n||(n.currentItem||n.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=e(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===n.options.scope&&i.accept.call(i.element[0],n.currentItem||n.element)&&g(n,e.extend(i,{offset:i.element.offset()}),i.options.tolerance,t)?(r=!0,!1):void 0}),!r&&!!this.accept.call(this.element[0],n.currentItem||n.element)&&(this._removeActiveClass(),this._removeHoverClass(),this._trigger("drop",t,this.ui(n)),this.element))},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}},_addHoverClass:function(){this._addClass("ui-droppable-hover")},_removeHoverClass:function(){this._removeClass("ui-droppable-hover")},_addActiveClass:function(){this._addClass("ui-droppable-active")},_removeActiveClass:function(){this._removeClass("ui-droppable-active")}});var g=e.ui.intersect=function(){function e(e,t,i){return e>=t&&t+i>e}return function(t,i,n,r){if(!i.offset)return!1;var o=(t.positionAbs||t.position.absolute).left+t.margins.left,s=(t.positionAbs||t.position.absolute).top+t.margins.top,a=o+t.helperProportions.width,c=s+t.helperProportions.height,l=i.offset.left,d=i.offset.top,h=l+i.proportions().width,u=d+i.proportions().height;switch(n){case"fit":return o>=l&&h>=a&&s>=d&&u>=c;case"intersect":return o+t.helperProportions.width/2>l&&h>a-t.helperProportions.width/2&&s+t.helperProportions.height/2>d&&u>c-t.helperProportions.height/2;case"pointer":return e(r.pageY,d,i.proportions().height)&&e(r.pageX,l,i.proportions().width);case"touch":return(s>=d&&u>=s||c>=d&&u>=c||d>s&&c>u)&&(o>=l&&h>=o||a>=l&&h>=a||l>o&&a>h);default:return!1}}}();e.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(t,i){var n,r,o=e.ui.ddmanager.droppables[t.options.scope]||[],s=i?i.type:null,a=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(n=0;o.length>n;n++)if(!(o[n].options.disabled||t&&!o[n].accept.call(o[n].element[0],t.currentItem||t.element))){for(r=0;a.length>r;r++)if(a[r]===o[n].element[0]){o[n].proportions().height=0;continue e}o[n].visible="none"!==o[n].element.css("display"),o[n].visible&&("mousedown"===s&&o[n]._activate.call(o[n],i),o[n].offset=o[n].element.offset(),o[n].proportions({width:o[n].element[0].offsetWidth,height:o[n].element[0].offsetHeight}))}},drop:function(t,i){var n=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&g(t,this,this.options.tolerance,i)&&(n=this._drop.call(this,i)||n),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),n},dragStart:function(t,i){t.element.parentsUntil("body").on("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var n,r,o,s=g(t,this,this.options.tolerance,i),a=!s&&this.isover?"isout":s&&!this.isover?"isover":null;a&&(this.options.greedy&&(r=this.options.scope,(o=this.element.parents(":data(ui-droppable)").filter(function(){return e(this).droppable("instance").options.scope===r})).length&&((n=e(o[0]).droppable("instance")).greedyChild="isover"===a)),n&&"isover"===a&&(n.isover=!1,n.isout=!0,n._out.call(n,i)),this[a]=!0,this["isout"===a?"isover":"isout"]=!1,this["isover"===a?"_over":"_out"].call(this,i),n&&"isout"===a&&(n.isout=!1,n.isover=!0,n._over.call(n,i)))}})},dragStop:function(t,i){t.element.parentsUntil("body").off("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}},!1!==e.uiBackCompat&&e.widget("ui.droppable",e.ui.droppable,{options:{hoverClass:!1,activeClass:!1},_addActiveClass:function(){this._super(),this.options.activeClass&&this.element.addClass(this.options.activeClass)},_removeActiveClass:function(){this._super(),this.options.activeClass&&this.element.removeClass(this.options.activeClass)},_addHoverClass:function(){this._super(),this.options.hoverClass&&this.element.addClass(this.options.hoverClass)},_removeHoverClass:function(){this._super(),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass)}}),e.widget("ui.progressbar",{version:"1.12.1",options:{classes:{"ui-progressbar":"ui-corner-all","ui-progressbar-value":"ui-corner-left","ui-progressbar-complete":"ui-corner-right"},max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.attr({role:"progressbar","aria-valuemin":this.min}),this._addClass("ui-progressbar","ui-widget ui-widget-content"),this.valueDiv=e("<div>").appendTo(this.element),this._addClass(this.valueDiv,"ui-progressbar-value","ui-widget-header"),this._refreshValue()},_destroy:function(){this.element.removeAttr("role aria-valuemin aria-valuemax aria-valuenow"),this.valueDiv.remove()},value:function(e){return void 0===e?this.options.value:(this.options.value=this._constrainedValue(e),void this._refreshValue())},_constrainedValue:function(e){return void 0===e&&(e=this.options.value),this.indeterminate=!1===e,"number"!=typeof e&&(e=0),!this.indeterminate&&Math.min(this.options.max,Math.max(this.min,e))},_setOptions:function(e){var t=e.value;delete e.value,this._super(e),this.options.value=this._constrainedValue(t),this._refreshValue()},_setOption:function(e,t){"max"===e&&(t=Math.max(this.min,t)),this._super(e,t)},_setOptionDisabled:function(e){this._super(e),this.element.attr("aria-disabled",e),this._toggleClass(null,"ui-state-disabled",!!e)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var t=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||t>this.min).width(i.toFixed(0)+"%"),this._toggleClass(this.valueDiv,"ui-progressbar-complete",null,t===this.options.max)._toggleClass("ui-progressbar-indeterminate",null,this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=e("<div>").appendTo(this.valueDiv),this._addClass(this.overlayDiv,"ui-progressbar-overlay"))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":t}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==t&&(this.oldValue=t,this._trigger("change")),t===this.options.max&&this._trigger("complete")}}),e.widget("ui.selectable",e.ui.mouse,{version:"1.12.1",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t=this;this._addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){t.elementPos=e(t.element[0]).offset(),t.selectees=e(t.options.filter,t.element[0]),t._addClass(t.selectees,"ui-selectee"),t.selectees.each(function(){var i=e(this),n=i.offset(),r={left:n.left-t.elementPos.left,top:n.top-t.elementPos.top};e.data(this,"selectable-item",{element:this,$element:i,left:r.left,top:r.top,right:r.left+i.outerWidth(),bottom:r.top+i.outerHeight(),startselected:!1,selected:i.hasClass("ui-selected"),selecting:i.hasClass("ui-selecting"),unselecting:i.hasClass("ui-unselecting")})})},this.refresh(),this._mouseInit(),this.helper=e("<div>"),this._addClass(this.helper,"ui-selectable-helper")},_destroy:function(){this.selectees.removeData("selectable-item"),this._mouseDestroy()},_mouseStart:function(t){var i=this,n=this.options;this.opos=[t.pageX,t.pageY],this.elementPos=e(this.element[0]).offset(),this.options.disabled||(this.selectees=e(n.filter,this.element[0]),this._trigger("start",t),e(n.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),n.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var n=e.data(this,"selectable-item");n.startselected=!0,t.metaKey||t.ctrlKey||(i._removeClass(n.$element,"ui-selected"),n.selected=!1,i._addClass(n.$element,"ui-unselecting"),n.unselecting=!0,i._trigger("unselecting",t,{unselecting:n.element}))}),e(t.target).parents().addBack().each(function(){var n,r=e.data(this,"selectable-item");return r?(n=!t.metaKey&&!t.ctrlKey||!r.$element.hasClass("ui-selected"),i._removeClass(r.$element,n?"ui-unselecting":"ui-selected")._addClass(r.$element,n?"ui-selecting":"ui-unselecting"),r.unselecting=!n,r.selecting=n,r.selected=n,n?i._trigger("selecting",t,{selecting:r.element}):i._trigger("unselecting",t,{unselecting:r.element}),!1):void 0}))},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){var i,n=this,r=this.options,o=this.opos[0],s=this.opos[1],a=t.pageX,c=t.pageY;return o>a&&(i=a,a=o,o=i),s>c&&(i=c,c=s,s=i),this.helper.css({left:o,top:s,width:a-o,height:c-s}),this.selectees.each(function(){var i=e.data(this,"selectable-item"),l=!1,d={};i&&i.element!==n.element[0]&&(d.left=i.left+n.elementPos.left,d.right=i.right+n.elementPos.left,d.top=i.top+n.elementPos.top,d.bottom=i.bottom+n.elementPos.top,"touch"===r.tolerance?l=!(d.left>a||o>d.right||d.top>c||s>d.bottom):"fit"===r.tolerance&&(l=d.left>o&&a>d.right&&d.top>s&&c>d.bottom),l?(i.selected&&(n._removeClass(i.$element,"ui-selected"),i.selected=!1),i.unselecting&&(n._removeClass(i.$element,"ui-unselecting"),i.unselecting=!1),i.selecting||(n._addClass(i.$element,"ui-selecting"),i.selecting=!0,n._trigger("selecting",t,{selecting:i.element}))):(i.selecting&&((t.metaKey||t.ctrlKey)&&i.startselected?(n._removeClass(i.$element,"ui-selecting"),i.selecting=!1,n._addClass(i.$element,"ui-selected"),i.selected=!0):(n._removeClass(i.$element,"ui-selecting"),i.selecting=!1,i.startselected&&(n._addClass(i.$element,"ui-unselecting"),i.unselecting=!0),n._trigger("unselecting",t,{unselecting:i.element}))),i.selected&&(t.metaKey||t.ctrlKey||i.startselected||(n._removeClass(i.$element,"ui-selected"),i.selected=!1,n._addClass(i.$element,"ui-unselecting"),i.unselecting=!0,n._trigger("unselecting",t,{unselecting:i.element})))))}),!1}},_mouseStop:function(t){var i=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each(function(){var n=e.data(this,"selectable-item");i._removeClass(n.$element,"ui-unselecting"),n.unselecting=!1,n.startselected=!1,i._trigger("unselected",t,{unselected:n.element})}),e(".ui-selecting",this.element[0]).each(function(){var n=e.data(this,"selectable-item");i._removeClass(n.$element,"ui-selecting")._addClass(n.$element,"ui-selected"),n.selecting=!1,n.selected=!0,n.startselected=!0,i._trigger("selected",t,{selected:n.element})}),this._trigger("stop",t),this.helper.remove(),!1}}),e.widget("ui.selectmenu",[e.ui.formResetMixin,{version:"1.12.1",defaultElement:"<select>",options:{appendTo:null,classes:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"},disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:!1,change:null,close:null,focus:null,open:null,select:null},_create:function(){var t=this.element.uniqueId().attr("id");this.ids={element:t,button:t+"-button",menu:t+"-menu"},this._drawButton(),this._drawMenu(),this._bindFormResetHandler(),this._rendered=!1,this.menuItems=e()},_drawButton:function(){var t,i=this,n=this._parseOption(this.element.find("option:selected"),this.element[0].selectedIndex);this.labels=this.element.labels().attr("for",this.ids.button),this._on(this.labels,{click:function(e){this.button.focus(),e.preventDefault()}}),this.element.hide(),this.button=e("<span>",{tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true",title:this.element.attr("title")}).insertAfter(this.element),this._addClass(this.button,"ui-selectmenu-button ui-selectmenu-button-closed","ui-button ui-widget"),t=e("<span>").appendTo(this.button),this._addClass(t,"ui-selectmenu-icon","ui-icon "+this.options.icons.button),this.buttonItem=this._renderButtonItem(n).appendTo(this.button),!1!==this.options.width&&this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){i._rendered||i._refreshMenu()})},_drawMenu:function(){var t=this;this.menu=e("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=e("<div>").append(this.menu),this._addClass(this.menuWrap,"ui-selectmenu-menu","ui-front"),this.menuWrap.appendTo(this._appendTo()),this.menuInstance=this.menu.menu({classes:{"ui-menu":"ui-corner-bottom"},role:"listbox",select:function(e,i){e.preventDefault(),t._setSelection(),t._select(i.item.data("ui-selectmenu-item"),e)},focus:function(e,i){var n=i.item.data("ui-selectmenu-item");null!=t.focusIndex&&n.index!==t.focusIndex&&(t._trigger("focus",e,{item:n}),t.isOpen||t._select(n,e)),t.focusIndex=n.index,t.button.attr("aria-activedescendant",t.menuItems.eq(n.index).attr("id"))}}).menu("instance"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(this._getSelectedItem().data("ui-selectmenu-item")||{})),null===this.options.width&&this._resizeButton()},_refreshMenu:function(){var e,t=this.element.find("option");this.menu.empty(),this._parseOptions(t),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup").find(".ui-menu-item-wrapper"),this._rendered=!0,t.length&&(e=this._getSelectedItem(),this.menuInstance.focus(null,e),this._setAria(e.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(e){this.options.disabled||(this._rendered?(this._removeClass(this.menu.find(".ui-state-active"),null,"ui-state-active"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.menuItems.length&&(this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",e)))},_position:function(){this.menuWrap.position(e.extend({of:this.button},this.options.position))},close:function(e){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",e))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderButtonItem:function(t){var i=e("<span>");return this._setText(i,t.label),this._addClass(i,"ui-selectmenu-text"),i},_renderMenu:function(t,i){var n=this,r="";e.each(i,function(i,o){var s;o.optgroup!==r&&(s=e("<li>",{text:o.optgroup}),n._addClass(s,"ui-selectmenu-optgroup","ui-menu-divider"+(o.element.parent("optgroup").prop("disabled")?" ui-state-disabled":"")),s.appendTo(t),r=o.optgroup),n._renderItemData(t,o)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-selectmenu-item",t)},_renderItem:function(t,i){var n=e("<li>"),r=e("<div>",{title:i.element.attr("title")});return i.disabled&&this._addClass(n,null,"ui-state-disabled"),this._setText(r,i.label),n.append(r).appendTo(t)},_setText:function(e,t){t?e.text(t):e.html("&#160;")},_move:function(e,t){var i,n,r=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex).parent("li"):(i=this.menuItems.eq(this.element[0].selectedIndex).parent("li"),r+=":not(.ui-state-disabled)"),(n="first"===e||"last"===e?i["first"===e?"prevAll":"nextAll"](r).eq(-1):i[e+"All"](r).eq(0)).length&&this.menuInstance.focus(t,n)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex).parent("li")},_toggle:function(e){this[this.isOpen?"close":"open"](e)},_setSelection:function(){var e;this.range&&(window.getSelection?((e=window.getSelection()).removeAllRanges(),e.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(t){this.isOpen&&(e(t.target).closest(".ui-selectmenu-menu, #"+e.ui.escapeSelector(this.ids.button)).length||this.close(t))}},_buttonEvents:{mousedown:function(){var e;window.getSelection?(e=window.getSelection()).rangeCount&&(this.range=e.getRangeAt(0)):this.range=document.selection.createRange()},click:function(e){this._setSelection(),this._toggle(e)},keydown:function(t){var i=!0;switch(t.keyCode){case e.ui.keyCode.TAB:case e.ui.keyCode.ESCAPE:this.close(t),i=!1;break;case e.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(t);break;case e.ui.keyCode.UP:t.altKey?this._toggle(t):this._move("prev",t);break;case e.ui.keyCode.DOWN:t.altKey?this._toggle(t):this._move("next",t);break;case e.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(t):this._toggle(t);break;case e.ui.keyCode.LEFT:this._move("prev",t);break;case e.ui.keyCode.RIGHT:this._move("next",t);break;case e.ui.keyCode.HOME:case e.ui.keyCode.PAGE_UP:this._move("first",t);break;case e.ui.keyCode.END:case e.ui.keyCode.PAGE_DOWN:this._move("last",t);break;default:this.menu.trigger(t),i=!1}i&&t.preventDefault()}},_selectFocusedItem:function(e){var t=this.menuItems.eq(this.focusIndex).parent("li");t.hasClass("ui-state-disabled")||this._select(t.data("ui-selectmenu-item"),e)},_select:function(e,t){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=e.index,this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(e)),this._setAria(e),this._trigger("select",t,{item:e}),e.index!==i&&this._trigger("change",t,{item:e}),this.close(t)},_setAria:function(e){var t=this.menuItems.eq(e.index).attr("id");this.button.attr({"aria-labelledby":t,"aria-activedescendant":t}),this.menu.attr("aria-activedescendant",t)},_setOption:function(e,t){if("icons"===e){var i=this.button.find("span.ui-icon");this._removeClass(i,null,this.options.icons.button)._addClass(i,null,t.button)}this._super(e,t),"appendTo"===e&&this.menuWrap.appendTo(this._appendTo()),"width"===e&&this._resizeButton()},_setOptionDisabled:function(e){this._super(e),this.menuInstance.option("disabled",e),this.button.attr("aria-disabled",e),this._toggleClass(this.button,null,"ui-state-disabled",e),this.element.prop("disabled",e),e?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front, dialog")),t.length||(t=this.document[0].body),t},_toggleAttr:function(){this.button.attr("aria-expanded",this.isOpen),this._removeClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"closed":"open"))._addClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"open":"closed"))._toggleClass(this.menuWrap,"ui-selectmenu-open",null,this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var e=this.options.width;return!1===e?void this.button.css("width",""):(null===e&&(e=this.element.show().outerWidth(),this.element.hide()),void this.button.outerWidth(e))},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){var e=this._super();return e.disabled=this.element.prop("disabled"),e},_parseOptions:function(t){var i=this,n=[];t.each(function(t,r){n.push(i._parseOption(e(r),t))}),this.items=n},_parseOption:function(e,t){var i=e.parent("optgroup");return{element:e,index:t,value:e.val(),label:e.text(),optgroup:i.attr("label")||"",disabled:i.prop("disabled")||e.prop("disabled")}},_destroy:function(){this._unbindFormResetHandler(),this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.labels.attr("for",this.ids.element)}}]),e.widget("ui.slider",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"slide",options:{animate:!1,classes:{"ui-slider":"ui-corner-all","ui-slider-handle":"ui-corner-all","ui-slider-range":"ui-corner-all ui-widget-header"},distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this._addClass("ui-slider ui-slider-"+this.orientation,"ui-widget ui-widget-content"),this._refresh(),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,i,n=this.options,r=this.element.find(".ui-slider-handle"),o=[];for(r.length>(i=n.values&&n.values.length||1)&&(r.slice(i).remove(),r=r.slice(0,i)),t=r.length;i>t;t++)o.push("<span tabindex='0'></span>");this.handles=r.add(e(o.join("")).appendTo(this.element)),this._addClass(this.handles,"ui-slider-handle","ui-state-default"),this.handle=this.handles.eq(0),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t).attr("tabIndex",0)})},_createRange:function(){var t=this.options;t.range?(!0===t.range&&(t.values?t.values.length&&2!==t.values.length?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?(this._removeClass(this.range,"ui-slider-range-min ui-slider-range-max"),this.range.css({left:"",bottom:""})):(this.range=e("<div>").appendTo(this.element),this._addClass(this.range,"ui-slider-range")),("min"===t.range||"max"===t.range)&&this._addClass(this.range,"ui-slider-range-"+t.range)):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this._mouseDestroy()},_mouseCapture:function(t){var i,n,r,o,s,a,c=this,l=this.options;return!l.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i=this._normValueFromMouse({x:t.pageX,y:t.pageY}),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var s=Math.abs(i-c.values(t));(n>s||n===s&&(t===c._lastChangedValue||c.values(t)===l.min))&&(n=s,r=e(this),o=t)}),!1!==this._start(t,o)&&(this._mouseSliding=!0,this._handleIndex=o,this._addClass(r,null,"ui-state-active"),r.trigger("focus"),s=r.offset(),a=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=a?{left:0,top:0}:{left:t.pageX-s.left-r.width()/2,top:t.pageY-s.top-r.height()/2-(parseInt(r.css("borderTopWidth"),10)||0)-(parseInt(r.css("borderBottomWidth"),10)||0)+(parseInt(r.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,i),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t=this._normValueFromMouse({x:e.pageX,y:e.pageY});return this._slide(e,this._handleIndex,t),!1},_mouseStop:function(e){return this._removeClass(this.handles,null,"ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,n,r,o;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),(n=i/t)>1&&(n=1),0>n&&(n=0),"vertical"===this.orientation&&(n=1-n),r=this._valueMax()-this._valueMin(),o=this._valueMin()+n*r,this._trimAlignValue(o)},_uiHash:function(e,t,i){var n={handle:this.handles[e],handleIndex:e,value:void 0!==t?t:this.value()};return this._hasMultipleValues()&&(n.value=void 0!==t?t:this.values(e),n.values=i||this.values()),n},_hasMultipleValues:function(){return this.options.values&&this.options.values.length},_start:function(e,t){return this._trigger("start",e,this._uiHash(t))},_slide:function(e,t,i){var n,r=this.value(),o=this.values();this._hasMultipleValues()&&(n=this.values(t?0:1),r=this.values(t),2===this.options.values.length&&!0===this.options.range&&(i=0===t?Math.min(n,i):Math.max(n,i)),o[t]=i),i!==r&&!1!==this._trigger("slide",e,this._uiHash(t,i,o))&&(this._hasMultipleValues()?this.values(t,i):this.value(i))},_stop:function(e,t){this._trigger("stop",e,this._uiHash(t))},_change:function(e,t){this._keySliding||this._mouseSliding||(this._lastChangedValue=t,this._trigger("change",e,this._uiHash(t)))},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),void this._change(null,0)):this._value()},values:function(t,i){var n,r,o;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),void this._change(null,t);if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this._hasMultipleValues()?this._values(t):this.value();for(n=this.options.values,r=arguments[0],o=0;n.length>o;o+=1)n[o]=this._trimAlignValue(r[o]),this._change(null,o);this._refreshValue()},_setOption:function(t,i){var n,r=0;switch("range"===t&&!0===this.options.range&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(r=this.options.values.length),this._super(t,i),t){case"orientation":this._detectOrientation(),this._removeClass("ui-slider-horizontal ui-slider-vertical")._addClass("ui-slider-"+this.orientation),this._refreshValue(),this.options.range&&this._refreshRange(i),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),n=r-1;n>=0;n--)this._change(null,n);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_setOptionDisabled:function(e){this._super(e),this._toggleClass(null,"ui-state-disabled",!!e)},_value:function(){return this._trimAlignValue(this.options.value)},_values:function(e){var t,i;if(arguments.length)return this._trimAlignValue(this.options.values[e]);if(this._hasMultipleValues()){for(t=this.options.values.slice(),i=0;t.length>i;i+=1)t[i]=this._trimAlignValue(t[i]);return t}return[]},_trimAlignValue:function(e){if(this._valueMin()>=e)return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,n=e-i;return 2*Math.abs(i)>=t&&(n+=i>0?t:-t),parseFloat(n.toFixed(5))},_calculateNewMax:function(){var e=this.options.max,t=this._valueMin(),i=this.options.step;(e=Math.round((e-t)/i)*i+t)>this.options.max&&(e-=i),this.max=parseFloat(e.toFixed(this._precision()))},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=""+e,i=t.indexOf(".");return-1===i?0:t.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshRange:function(e){"vertical"===e&&this.range.css({width:"",left:""}),"horizontal"===e&&this.range.css({height:"",bottom:""})},_refreshValue:function(){var t,i,n,r,o,s=this.options.range,a=this.options,c=this,l=!this._animateOff&&a.animate,d={};this._hasMultipleValues()?this.handles.each(function(n){i=(c.values(n)-c._valueMin())/(c._valueMax()-c._valueMin())*100,d["horizontal"===c.orientation?"left":"bottom"]=i+"%",e(this).stop(1,1)[l?"animate":"css"](d,a.animate),!0===c.options.range&&("horizontal"===c.orientation?(0===n&&c.range.stop(1,1)[l?"animate":"css"]({left:i+"%"},a.animate),1===n&&c.range[l?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:a.animate})):(0===n&&c.range.stop(1,1)[l?"animate":"css"]({bottom:i+"%"},a.animate),1===n&&c.range[l?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:a.animate}))),t=i}):(n=this.value(),r=this._valueMin(),o=this._valueMax(),d["horizontal"===this.orientation?"left":"bottom"]=(i=o!==r?(n-r)/(o-r)*100:0)+"%",this.handle.stop(1,1)[l?"animate":"css"](d,a.animate),"min"===s&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:i+"%"},a.animate),"max"===s&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:100-i+"%"},a.animate),"min"===s&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:i+"%"},a.animate),"max"===s&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:100-i+"%"},a.animate))},_handleEvents:{keydown:function(t){var i,n,r,o=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(t.preventDefault(),!this._keySliding&&(this._keySliding=!0,this._addClass(e(t.target),null,"ui-state-active"),!1===this._start(t,o)))return}switch(r=this.options.step,i=n=this._hasMultipleValues()?this.values(o):this.value(),t.keyCode){case e.ui.keyCode.HOME:n=this._valueMin();break;case e.ui.keyCode.END:n=this._valueMax();break;case e.ui.keyCode.PAGE_UP:n=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(i===this._valueMax())return;n=this._trimAlignValue(i+r);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i===this._valueMin())return;n=this._trimAlignValue(i-r)}this._slide(t,o,n)},keyup:function(t){var i=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),this._removeClass(e(t.target),null,"ui-state-active"))}}}),e.widget("ui.sortable",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,t,i){return e>=t&&t+i>e},_isFloating:function(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))},_create:function(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(e,t){this._super(e,t),"handle"===e&&this._setHandleClassName()},_setHandleClassName:function(){var t=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),e.each(this.items,function(){t._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(t,i){var n=null,r=!1,o=this;return!(this.reverting||this.options.disabled||"static"===this.options.type||(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,o.widgetName+"-item")===o?(n=e(this),!1):void 0}),e.data(t.target,o.widgetName+"-item")===o&&(n=e(t.target)),!n||this.options.handle&&!i&&(e(this.options.handle,n).find("*").addBack().each(function(){this===t.target&&(r=!0)}),!r)||(this.currentItem=n,this._removeCurrentsFromItems(),0)))},_mouseStart:function(t,i,n){var r,o,s=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),s.containment&&this._setContainment(),s.cursor&&"auto"!==s.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",s.cursor),this.storedStylesheet=e("<style>*{ cursor: "+s.cursor+" !important; }</style>").appendTo(o)),s.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",s.opacity)),s.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",s.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!n)for(r=this.containers.length-1;r>=0;r--)this.containers[r]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,n,r,o,s=this.options,a=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<s.scrollSensitivity?this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop+s.scrollSpeed:t.pageY-this.overflowOffset.top<s.scrollSensitivity&&(this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop-s.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<s.scrollSensitivity?this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft+s.scrollSpeed:t.pageX-this.overflowOffset.left<s.scrollSensitivity&&(this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft-s.scrollSpeed)):(t.pageY-this.document.scrollTop()<s.scrollSensitivity?a=this.document.scrollTop(this.document.scrollTop()-s.scrollSpeed):this.window.height()-(t.pageY-this.document.scrollTop())<s.scrollSensitivity&&(a=this.document.scrollTop(this.document.scrollTop()+s.scrollSpeed)),t.pageX-this.document.scrollLeft()<s.scrollSensitivity?a=this.document.scrollLeft(this.document.scrollLeft()-s.scrollSpeed):this.window.width()-(t.pageX-this.document.scrollLeft())<s.scrollSensitivity&&(a=this.document.scrollLeft(this.document.scrollLeft()+s.scrollSpeed))),!1!==a&&e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(r=(n=this.items[i]).item[0],(o=this._intersectsWithPointer(n))&&n.instance===this.currentContainer&&r!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==r&&!e.contains(this.placeholder[0],r)&&("semi-dynamic"!==this.options.type||!e.contains(this.element[0],r))){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(n))break;this._rearrange(t,n),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var n=this,r=this.placeholder.offset(),o=this.options.axis,s={};o&&"x"!==o||(s.left=r.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(s.top=r.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(s,parseInt(this.options.revert,10)||500,function(){n._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp(new e.Event("mouseup",{target:null})),"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),n=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&n.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!n.length&&t.key&&n.push(t.key+"="),n.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),n=[];return t=t||{},i.each(function(){n.push(e(t.item||this).attr(t.attribute||"id")||"")}),n},_intersectsWith:function(e){var t=this.positionAbs.left,i=this.positionAbs.top,n=e.left,r=n+e.width,o=e.top,s=o+e.height,a=this.offset.click.top,c=this.offset.click.left;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?("x"===this.options.axis||i+a>o&&s>i+a)&&("y"===this.options.axis||t+c>n&&r>t+c):t+this.helperProportions.width/2>n&&r>t+this.helperProportions.width-this.helperProportions.width/2&&i+this.helperProportions.height/2>o&&s>i+this.helperProportions.height-this.helperProportions.height/2},_intersectsWithPointer:function(e){var t,i,n="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),r="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width);return!(!n||!r)&&(t=this._getDragVerticalDirection(),i=this._getDragHorizontalDirection(),this.floating?"right"===i||"down"===t?2:1:t&&("down"===t?2:1))},_intersectsWithSides:function(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),n=this._getDragVerticalDirection(),r=this._getDragHorizontalDirection();return this.floating&&r?"right"===r&&i||"left"===r&&!i:n&&("down"===n&&t||"up"===n&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){function i(){a.push(this)}var n,r,o,s,a=[],c=[],l=this._connectWith();if(l&&t)for(n=l.length-1;n>=0;n--)for(r=(o=e(l[n],this.document[0])).length-1;r>=0;r--)(s=e.data(o[r],this.widgetFullName))&&s!==this&&!s.options.disabled&&c.push([e.isFunction(s.options.items)?s.options.items.call(s.element):e(s.options.items,s.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),s]);for(c.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),n=c.length-1;n>=0;n--)c[n][0].each(i);return e(a)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;t.length>i;i++)if(t[i]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i,n,r,o,s,a,c,l,d=this.items,h=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],u=this._connectWith();if(u&&this.ready)for(i=u.length-1;i>=0;i--)for(n=(r=e(u[i],this.document[0])).length-1;n>=0;n--)(o=e.data(r[n],this.widgetFullName))&&o!==this&&!o.options.disabled&&(h.push([e.isFunction(o.options.items)?o.options.items.call(o.element[0],t,{item:this.currentItem}):e(o.options.items,o.element),o]),this.containers.push(o));for(i=h.length-1;i>=0;i--)for(s=h[i][1],n=0,l=(a=h[i][0]).length;l>n;n++)(c=e(a[n])).data(this.widgetName+"-item",s),d.push({item:c,instance:s,width:0,height:0,left:0,top:0})},refreshPositions:function(t){var i,n,r,o;for(this.floating=!!this.items.length&&("x"===this.options.axis||this._isFloating(this.items[0].item)),this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset()),i=this.items.length-1;i>=0;i--)(n=this.items[i]).instance!==this.currentContainer&&this.currentContainer&&n.item[0]!==this.currentItem[0]||(r=this.options.toleranceElement?e(this.options.toleranceElement,n.item):n.item,t||(n.width=r.outerWidth(),n.height=r.outerHeight()),o=r.offset(),n.left=o.left,n.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){var i,n=(t=t||this).options;n.placeholder&&n.placeholder.constructor!==String||(i=n.placeholder,n.placeholder={element:function(){var n=t.currentItem[0].nodeName.toLowerCase(),r=e("<"+n+">",t.document[0]);return t._addClass(r,"ui-sortable-placeholder",i||t.currentItem[0].className)._removeClass(r,"ui-sortable-helper"),"tbody"===n?t._createTrPlaceholder(t.currentItem.find("tr").eq(0),e("<tr>",t.document[0]).appendTo(r)):"tr"===n?t._createTrPlaceholder(t.currentItem,r):"img"===n&&r.attr("src",t.currentItem.attr("src")),i||r.css("visibility","hidden"),r},update:function(e,r){(!i||n.forcePlaceholderSize)&&(r.height()||r.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),r.width()||r.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(n.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),n.placeholder.update(t,t.placeholder)},_createTrPlaceholder:function(t,i){var n=this;t.children().each(function(){e("<td>&#160;</td>",n.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(t){var i,n,r,o,s,a,c,l,d,h,u=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!e.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(u&&e.contains(this.containers[i].element[0],u.element[0]))continue;u=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0);if(u)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(r=1e4,o=null,s=(d=u.floating||this._isFloating(this.currentItem))?"left":"top",a=d?"width":"height",h=d?"pageX":"pageY",n=this.items.length-1;n>=0;n--)e.contains(this.containers[p].element[0],this.items[n].item[0])&&this.items[n].item[0]!==this.currentItem[0]&&(c=this.items[n].item.offset()[s],l=!1,t[h]-c>this.items[n][a]/2&&(l=!0),r>Math.abs(t[h]-c)&&(r=Math.abs(t[h]-c),o=this.items[n],this.direction=l?"up":"down"));if(!o&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return void(this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash()),this.currentContainer.containerCache.over=1));o?this._rearrange(t,o,null,!0):this._rearrange(t,null,this.containers[p].element,!0),this._trigger("change",t,this._uiHash()),this.containers[p]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(t){var i=this.options,n=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return n.parents("body").length||e("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(n[0]),n[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!n[0].style.width||i.forceHelperSize)&&n.width(this.currentItem.width()),(!n[0].style.height||i.forceHelperSize)&&n.height(this.currentItem.height()),n},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,n,r=this.options;"parent"===r.containment&&(r.containment=this.helper[0].parentNode),("document"===r.containment||"window"===r.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===r.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===r.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(r.containment)||(t=e(r.containment)[0],i=e(r.containment).offset(),n="hidden"!==e(t).css("overflow"),this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(n?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(n?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,i){i||(i=this.position);var n="absolute"===t?1:-1,r="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(r[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:r.scrollTop())*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:r.scrollLeft())*n}},_generatePosition:function(t){var i,n,r=this.options,o=t.pageX,s=t.pageY,a="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,c=/(html|body)/i.test(a[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(s=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(s=this.containment[3]+this.offset.click.top)),r.grid&&(i=this.originalPageY+Math.round((s-this.originalPageY)/r.grid[1])*r.grid[1],s=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-r.grid[1]:i+r.grid[1]:i,n=this.originalPageX+Math.round((o-this.originalPageX)/r.grid[0])*r.grid[0],o=this.containment?n-this.offset.click.left>=this.containment[0]&&n-this.offset.click.left<=this.containment[2]?n:n-this.offset.click.left>=this.containment[0]?n-r.grid[0]:n+r.grid[0]:n)),{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():c?0:a.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():c?0:a.scrollLeft())}},_rearrange:function(e,t,i,n){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var r=this.counter;this._delay(function(){r===this.counter&&this.refreshPositions(!n)})},_clear:function(e,t){function i(e,t,i){return function(n){i._trigger(e,n,t._uiHash(t))}}this.reverting=!1;var n,r=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(n in this._storedCSS)("auto"===this._storedCSS[n]||"static"===this._storedCSS[n])&&(this._storedCSS[n]="");this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&r.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||r.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(r.push(function(e){this._trigger("remove",e,this._uiHash())}),r.push((function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}).call(this,this.currentContainer)),r.push((function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}).call(this,this.currentContainer)))),n=this.containers.length-1;n>=0;n--)t||r.push(i("deactivate",this,this.containers[n])),this.containers[n].containerCache.over&&(r.push(i("out",this,this.containers[n])),this.containers[n].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!t){for(n=0;r.length>n;n++)r[n].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){!1===e.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}}),e.widget("ui.spinner",{version:"1.12.1",defaultElement:"<input>",widgetEventPrefix:"spin",options:{classes:{"ui-spinner":"ui-corner-all","ui-spinner-down":"ui-corner-br","ui-spinner-up":"ui-corner-tr"},culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var t=this._super(),i=this.element;return e.each(["min","max","step"],function(e,n){var r=i.attr(n);null!=r&&r.length&&(t[n]=r)}),t},_events:{keydown:function(e){this._start(e)&&this._keydown(e)&&e.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(e){return this.cancelBlur?void delete this.cancelBlur:(this._stop(),this._refresh(),void(this.previous!==this.element.val()&&this._trigger("change",e)))},mousewheel:function(e,t){if(t){if(!this.spinning&&!this._start(e))return!1;this._spin((t>0?1:-1)*this.options.step,e),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(e)},100),e.preventDefault()}},"mousedown .ui-spinner-button":function(t){function i(){this.element[0]===e.ui.safeActiveElement(this.document[0])||(this.element.trigger("focus"),this.previous=n,this._delay(function(){this.previous=n}))}var n;n=this.element[0]===e.ui.safeActiveElement(this.document[0])?this.previous:this.element.val(),t.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),!1!==this._start(t)&&this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(t){return e(t.currentTarget).hasClass("ui-state-active")?!1!==this._start(t)&&void this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t):void 0},"mouseleave .ui-spinner-button":"_stop"},_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap("<span>").parent().append("<a></a><a></a>")},_draw:function(){this._enhance(),this._addClass(this.uiSpinner,"ui-spinner","ui-widget ui-widget-content"),this._addClass("ui-spinner-input"),this.element.attr("role","spinbutton"),this.buttons=this.uiSpinner.children("a").attr("tabIndex",-1).attr("aria-hidden",!0).button({classes:{"ui-button":""}}),this._removeClass(this.buttons,"ui-corner-all"),this._addClass(this.buttons.first(),"ui-spinner-button ui-spinner-up"),this._addClass(this.buttons.last(),"ui-spinner-button ui-spinner-down"),this.buttons.first().button({icon:this.options.icons.up,showLabel:!1}),this.buttons.last().button({icon:this.options.icons.down,showLabel:!1}),this.buttons.height()>Math.ceil(.5*this.uiSpinner.height())&&this.uiSpinner.height()>0&&this.uiSpinner.height(this.uiSpinner.height())},_keydown:function(t){var i=this.options,n=e.ui.keyCode;switch(t.keyCode){case n.UP:return this._repeat(null,1,t),!0;case n.DOWN:return this._repeat(null,-1,t),!0;case n.PAGE_UP:return this._repeat(null,i.page,t),!0;case n.PAGE_DOWN:return this._repeat(null,-i.page,t),!0}return!1},_start:function(e){return!(!this.spinning&&!1===this._trigger("start",e)||(this.counter||(this.counter=1),this.spinning=!0,0))},_repeat:function(e,t,i){e=e||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,t,i)},e),this._spin(t*this.options.step,i)},_spin:function(e,t){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+e*this._increment(this.counter)),this.spinning&&!1===this._trigger("spin",t,{value:i})||(this._value(i),this.counter++)},_increment:function(t){var i=this.options.incremental;return i?e.isFunction(i)?i(t):Math.floor(t*t*t/5e4-t*t/500+17*t/200+1):1},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=""+e,i=t.indexOf(".");return-1===i?0:t.length-i-1},_adjustValue:function(e){var t,i,n=this.options;return i=e-(t=null!==n.min?n.min:0),e=t+(i=Math.round(i/n.step)*n.step),e=parseFloat(e.toFixed(this._precision())),null!==n.max&&e>n.max?n.max:null!==n.min&&n.min>e?n.min:e},_stop:function(e){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",e))},_setOption:function(e,t){var i,n,r;return"culture"===e||"numberFormat"===e?(i=this._parse(this.element.val()),this.options[e]=t,void this.element.val(this._format(i))):(("max"===e||"min"===e||"step"===e)&&"string"==typeof t&&(t=this._parse(t)),"icons"===e&&(n=this.buttons.first().find(".ui-icon"),this._removeClass(n,null,this.options.icons.up),this._addClass(n,null,t.up),r=this.buttons.last().find(".ui-icon"),this._removeClass(r,null,this.options.icons.down),this._addClass(r,null,t.down)),void this._super(e,t))},_setOptionDisabled:function(e){this._super(e),this._toggleClass(this.uiSpinner,null,"ui-state-disabled",!!e),this.element.prop("disabled",!!e),this.buttons.button(e?"disable":"enable")},_setOptions:s(function(e){this._super(e)}),_parse:function(e){return"string"==typeof e&&""!==e&&(e=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e),""===e||isNaN(e)?null:e},_format:function(e){return""===e?"":window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var e=this.value();return null!==e&&e===this._adjustValue(e)},_value:function(e,t){var i;""!==e&&null!==(i=this._parse(e))&&(t||(i=this._adjustValue(i)),e=this._format(i)),this.element.val(e),this._refresh()},_destroy:function(){this.element.prop("disabled",!1).removeAttr("autocomplete role aria-valuemin aria-valuemax aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:s(function(e){this._stepUp(e)}),_stepUp:function(e){this._start()&&(this._spin((e||1)*this.options.step),this._stop())},stepDown:s(function(e){this._stepDown(e)}),_stepDown:function(e){this._start()&&(this._spin((e||1)*-this.options.step),this._stop())},pageUp:s(function(e){this._stepUp((e||1)*this.options.page)}),pageDown:s(function(e){this._stepDown((e||1)*this.options.page)}),value:function(e){return arguments.length?void s(this._value).call(this,e):this._parse(this.element.val())},widget:function(){return this.uiSpinner}}),!1!==e.uiBackCompat&&e.widget("ui.spinner",e.ui.spinner,{_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml())},_uiSpinnerHtml:function(){return"<span>"},_buttonHtml:function(){return"<a></a><a></a>"}}),e.widget("ui.tabs",{version:"1.12.1",delay:300,options:{active:null,classes:{"ui-tabs":"ui-corner-all","ui-tabs-nav":"ui-corner-all","ui-tabs-panel":"ui-corner-bottom","ui-tabs-tab":"ui-corner-top"},collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var e=/#.*$/;return function(t){var i,r;i=t.href.replace(e,""),r=location.href.replace(e,"");try{i=decodeURIComponent(i)}catch(n){}try{r=decodeURIComponent(r)}catch(n){}return t.hash.length>1&&i===r}}(),_create:function(){var t=this,i=this.options;this.running=!1,this._addClass("ui-tabs","ui-widget ui-widget-content"),this._toggleClass("ui-tabs-collapsible",null,i.collapsible),this._processTabs(),i.active=this._initialActive(),e.isArray(i.disabled)&&(i.disabled=e.unique(i.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e)}))).sort()),this.active=!1!==this.options.active&&this.anchors.length?this._findActive(i.active):e(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var t=this.options.active,i=this.options.collapsible,n=location.hash.substring(1);return null===t&&(n&&this.tabs.each(function(i,r){return e(r).attr("aria-controls")===n?(t=i,!1):void 0}),null===t&&(t=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===t||-1===t)&&(t=!!this.tabs.length&&0)),!1!==t&&-1===(t=this.tabs.index(this.tabs.eq(t)))&&(t=!i&&0),!i&&!1===t&&this.anchors.length&&(t=0),t},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(t){var i=e(e.ui.safeActiveElement(this.document[0])).closest("li"),n=this.tabs.index(i),r=!0;if(!this._handlePageNav(t)){switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:n++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:r=!1,n--;break;case e.ui.keyCode.END:n=this.anchors.length-1;break;case e.ui.keyCode.HOME:n=0;break;case e.ui.keyCode.SPACE:return t.preventDefault(),clearTimeout(this.activating),void this._activate(n);case e.ui.keyCode.ENTER:return t.preventDefault(),clearTimeout(this.activating),void this._activate(n!==this.options.active&&n);default:return}t.preventDefault(),clearTimeout(this.activating),n=this._focusNextTab(n,r),t.ctrlKey||t.metaKey||(i.attr("aria-selected","false"),this.tabs.eq(n).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",n)},this.delay))}},_panelKeydown:function(t){this._handlePageNav(t)||t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.trigger("focus"))},_handlePageNav:function(t){return t.altKey&&t.keyCode===e.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):t.altKey&&t.keyCode===e.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(t,i){for(var n=this.tabs.length-1;-1!==e.inArray((t>n&&(t=0),0>t&&(t=n),t),this.options.disabled);)t=i?t+1:t-1;return t},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).trigger("focus"),e},_setOption:function(e,t){return"active"===e?void this._activate(t):(this._super(e,t),"collapsible"===e&&(this._toggleClass("ui-tabs-collapsible",null,t),t||!1!==this.options.active||this._activate(0)),"event"===e&&this._setupEvents(t),void("heightStyle"===e&&this._setupHeightStyle(t)))},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var t=this.options,i=this.tablist.children(":has(a[href])");t.disabled=e.map(i.filter(".ui-state-disabled"),function(e){return i.index(e)}),this._processTabs(),!1!==t.active&&this.anchors.length?this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active):(t.active=!1,this.active=e()),this._refresh()},_refresh:function(){this._setOptionDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._addClass(this.active,"ui-tabs-active","ui-state-active"),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var t=this,i=this.tabs,n=this.anchors,r=this.panels;this.tablist=this._getList().attr("role","tablist"),this._addClass(this.tablist,"ui-tabs-nav","ui-helper-reset ui-helper-clearfix ui-widget-header"),this.tablist.on("mousedown"+this.eventNamespace,"> li",function(t){e(this).is(".ui-state-disabled")&&t.preventDefault()}).on("focus"+this.eventNamespace,".ui-tabs-anchor",function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").attr({role:"tab",tabIndex:-1}),this._addClass(this.tabs,"ui-tabs-tab","ui-state-default"),this.anchors=this.tabs.map(function(){return e("a",this)[0]}).attr({role:"presentation",tabIndex:-1}),this._addClass(this.anchors,"ui-tabs-anchor"),this.panels=e(),this.anchors.each(function(i,n){var r,o,s,a=e(n).uniqueId().attr("id"),c=e(n).closest("li"),l=c.attr("aria-controls");t._isLocal(n)?(s=(r=n.hash).substring(1),o=t.element.find(t._sanitizeSelector(r))):(s=c.attr("aria-controls")||e({}).uniqueId()[0].id,(o=t.element.find(r="#"+s)).length||(o=t._createPanel(s)).insertAfter(t.panels[i-1]||t.tablist),o.attr("aria-live","polite")),o.length&&(t.panels=t.panels.add(o)),l&&c.data("ui-tabs-aria-controls",l),c.attr({"aria-controls":s,"aria-labelledby":a}),o.attr("aria-labelledby",a)}),this.panels.attr("role","tabpanel"),this._addClass(this.panels,"ui-tabs-panel","ui-widget-content"),i&&(this._off(i.not(this.tabs)),this._off(n.not(this.anchors)),this._off(r.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol, ul").eq(0)},_createPanel:function(t){return e("<div>").attr("id",t).data("ui-tabs-destroy",!0)},_setOptionDisabled:function(t){var i,n,r;for(e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1),r=0;n=this.tabs[r];r++)i=e(n),!0===t||-1!==e.inArray(r,t)?(i.attr("aria-disabled","true"),this._addClass(i,null,"ui-state-disabled")):(i.removeAttr("aria-disabled"),this._removeClass(i,null,"ui-state-disabled"));this.options.disabled=t,this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!0===t)},_setupEvents:function(t){var i={};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(e){e.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var i,n=this.element.parent();"fill"===t?(i=n.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var t=e(this),n=t.css("position");"absolute"!==n&&"fixed"!==n&&(i-=t.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=e(this).outerHeight(!0)}),this.panels.each(function(){e(this).height(Math.max(0,i-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===t&&(i=0,this.panels.each(function(){i=Math.max(i,e(this).height("").height())}).height(i))},_eventHandler:function(t){var i=this.options,n=this.active,r=e(t.currentTarget).closest("li"),o=r[0]===n[0],s=o&&i.collapsible,a=s?e():this._getPanelForTab(r),c=n.length?this._getPanelForTab(n):e(),l={oldTab:n,oldPanel:c,newTab:s?e():r,newPanel:a};t.preventDefault(),r.hasClass("ui-state-disabled")||r.hasClass("ui-tabs-loading")||this.running||o&&!i.collapsible||!1===this._trigger("beforeActivate",t,l)||(i.active=!s&&this.tabs.index(r),this.active=o?e():r,this.xhr&&this.xhr.abort(),c.length||a.length||e.error("jQuery UI Tabs: Mismatching fragment identifier."),a.length&&this.load(this.tabs.index(r),t),this._toggle(t,l))},_toggle:function(t,i){function n(){o.running=!1,o._trigger("activate",t,i)}function r(){o._addClass(i.newTab.closest("li"),"ui-tabs-active","ui-state-active"),s.length&&o.options.show?o._show(s,o.options.show,n):(s.show(),n())}var o=this,s=i.newPanel,a=i.oldPanel;this.running=!0,a.length&&this.options.hide?this._hide(a,this.options.hide,function(){o._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),r()}):(this._removeClass(i.oldTab.closest("li"),"ui-tabs-active","ui-state-active"),a.hide(),r()),a.attr("aria-hidden","true"),i.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),s.length&&a.length?i.oldTab.attr("tabIndex",-1):s.length&&this.tabs.filter(function(){return 0===e(this).attr("tabIndex")}).attr("tabIndex",-1),s.attr("aria-hidden","false"),i.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(t){var i,n=this._findActive(t);n[0]!==this.active[0]&&(n.length||(n=this.active),i=n.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return!1===t?e():this.tabs.eq(t)},_getIndex:function(t){return"string"==typeof t&&(t=this.anchors.index(this.anchors.filter("[href$='"+e.ui.escapeSelector(t)+"']"))),t},_destroy:function(){this.xhr&&this.xhr.abort(),this.tablist.removeAttr("role").off(this.eventNamespace),this.anchors.removeAttr("role tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeAttr("role tabIndex aria-live aria-busy aria-selected aria-labelledby aria-hidden aria-expanded")}),this.tabs.each(function(){var t=e(this),i=t.data("ui-tabs-aria-controls");i?t.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):t.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(t){var i=this.options.disabled;!1!==i&&(void 0===t?i=!1:(t=this._getIndex(t),i=e.isArray(i)?e.map(i,function(e){return e!==t?e:null}):e.map(this.tabs,function(e,i){return i!==t?i:null})),this._setOptionDisabled(i))},disable:function(t){var i=this.options.disabled;if(!0!==i){if(void 0===t)i=!0;else{if(t=this._getIndex(t),-1!==e.inArray(t,i))return;i=e.isArray(i)?e.merge([t],i).sort():[t]}this._setOptionDisabled(i)}},load:function(t,i){t=this._getIndex(t);var n=this,r=this.tabs.eq(t),o=r.find(".ui-tabs-anchor"),s=this._getPanelForTab(r),a={tab:r,panel:s},c=function(e,t){"abort"===t&&n.panels.stop(!1,!0),n._removeClass(r,"ui-tabs-loading"),s.removeAttr("aria-busy"),e===n.xhr&&delete n.xhr};this._isLocal(o[0])||(this.xhr=e.ajax(this._ajaxSettings(o,i,a)),this.xhr&&"canceled"!==this.xhr.statusText&&(this._addClass(r,"ui-tabs-loading"),s.attr("aria-busy","true"),this.xhr.done(function(e,t,r){setTimeout(function(){s.html(e),n._trigger("load",i,a),c(r,t)},1)}).fail(function(e,t){setTimeout(function(){c(e,t)},1)})))},_ajaxSettings:function(t,i,n){var r=this;return{url:t.attr("href").replace(/#.*$/,""),beforeSend:function(t,o){return r._trigger("beforeLoad",i,e.extend({jqXHR:t,ajaxSettings:o},n))}}},_getPanelForTab:function(t){var i=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}}),!1!==e.uiBackCompat&&e.widget("ui.tabs",e.ui.tabs,{_processTabs:function(){this._superApply(arguments),this._addClass(this.tabs,"ui-tab")}}),e.widget("ui.tooltip",{version:"1.12.1",options:{classes:{"ui-tooltip":"ui-corner-all ui-widget-shadow"},content:function(){var t=e(this).attr("title")||"";return e("<a>").text(t).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,track:!1,close:null,open:null},_addDescribedBy:function(t,i){var n=(t.attr("aria-describedby")||"").split(/\s+/);n.push(i),t.data("ui-tooltip-id",i).attr("aria-describedby",e.trim(n.join(" ")))},_removeDescribedBy:function(t){var i=t.data("ui-tooltip-id"),n=(t.attr("aria-describedby")||"").split(/\s+/),r=e.inArray(i,n);-1!==r&&n.splice(r,1),t.removeData("ui-tooltip-id"),(n=e.trim(n.join(" ")))?t.attr("aria-describedby",n):t.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.liveRegion=e("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this.disabledTitles=e([])},_setOption:function(t,i){var n=this;this._super(t,i),"content"===t&&e.each(this.tooltips,function(e,t){n._updateContent(t.element)})},_setOptionDisabled:function(e){this[e?"_disable":"_enable"]()},_disable:function(){var t=this;e.each(this.tooltips,function(i,n){var r=e.Event("blur");r.target=r.currentTarget=n.element[0],t.close(r,!0)}),this.disabledTitles=this.disabledTitles.add(this.element.find(this.options.items).addBack().filter(function(){var t=e(this);return t.is("[title]")?t.data("ui-tooltip-title",t.attr("title")).removeAttr("title"):void 0}))},_enable:function(){this.disabledTitles.each(function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))}),this.disabledTitles=e([])},open:function(t){var i=this,n=e(t?t.target:this.element).closest(this.options.items);n.length&&!n.data("ui-tooltip-id")&&(n.attr("title")&&n.data("ui-tooltip-title",n.attr("title")),n.data("ui-tooltip-open",!0),t&&"mouseover"===t.type&&n.parents().each(function(){var t,n=e(this);n.data("ui-tooltip-open")&&((t=e.Event("blur")).target=t.currentTarget=this,i.close(t,!0)),n.attr("title")&&(n.uniqueId(),i.parents[this.id]={element:this,title:n.attr("title")},n.attr("title",""))}),this._registerCloseHandlers(t,n),this._updateContent(n,t))},_updateContent:function(e,t){var i,n=this.options.content,r=this,o=t?t.type:null;return"string"==typeof n||n.nodeType||n.jquery?this._open(t,e,n):void((i=n.call(e[0],function(i){r._delay(function(){e.data("ui-tooltip-open")&&(t&&(t.type=o),this._open(t,e,i))})}))&&this._open(t,e,i))},_open:function(t,i,n){function r(e){l.of=e,s.is(":hidden")||s.position(l)}var o,s,a,c,l=e.extend({},this.options.position);if(n){if(o=this._find(i))return void o.tooltip.find(".ui-tooltip-content").html(n);i.is("[title]")&&(t&&"mouseover"===t.type?i.attr("title",""):i.removeAttr("title")),o=this._tooltip(i),this._addDescribedBy(i,(s=o.tooltip).attr("id")),s.find(".ui-tooltip-content").html(n),this.liveRegion.children().hide(),(c=e("<div>").html(s.find(".ui-tooltip-content").html())).removeAttr("name").find("[name]").removeAttr("name"),c.removeAttr("id").find("[id]").removeAttr("id"),c.appendTo(this.liveRegion),this.options.track&&t&&/^mouse/.test(t.type)?(this._on(this.document,{mousemove:r}),r(t)):s.position(e.extend({of:i},this.options.position)),s.hide(),this._show(s,this.options.show),this.options.track&&this.options.show&&this.options.show.delay&&(a=this.delayedShow=setInterval(function(){s.is(":visible")&&(r(l.of),clearInterval(a))},e.fx.interval)),this._trigger("open",t,{tooltip:s})}},_registerCloseHandlers:function(t,i){var n={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var n=e.Event(t);n.currentTarget=i[0],this.close(n,!0)}}};i[0]!==this.element[0]&&(n.remove=function(){this._removeTooltip(this._find(i).tooltip)}),t&&"mouseover"!==t.type||(n.mouseleave="close"),t&&"focusin"!==t.type||(n.focusout="close"),this._on(!0,i,n)},close:function(t){var i,n=this,r=e(t?t.currentTarget:this.element),o=this._find(r);return o?(i=o.tooltip,void(o.closing||(clearInterval(this.delayedShow),r.data("ui-tooltip-title")&&!r.attr("title")&&r.attr("title",r.data("ui-tooltip-title")),this._removeDescribedBy(r),o.hiding=!0,i.stop(!0),this._hide(i,this.options.hide,function(){n._removeTooltip(e(this))}),r.removeData("ui-tooltip-open"),this._off(r,"mouseleave focusout keyup"),r[0]!==this.element[0]&&this._off(r,"remove"),this._off(this.document,"mousemove"),t&&"mouseleave"===t.type&&e.each(this.parents,function(t,i){e(i.element).attr("title",i.title),delete n.parents[t]}),o.closing=!0,this._trigger("close",t,{tooltip:i}),o.hiding||(o.closing=!1)))):void r.removeData("ui-tooltip-open")},_tooltip:function(t){var i=e("<div>").attr("role","tooltip"),n=e("<div>").appendTo(i),r=i.uniqueId().attr("id");return this._addClass(n,"ui-tooltip-content"),this._addClass(i,"ui-tooltip","ui-widget ui-widget-content"),i.appendTo(this._appendTo(t)),this.tooltips[r]={element:t,tooltip:i}},_find:function(e){var t=e.data("ui-tooltip-id");return t?this.tooltips[t]:null},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_appendTo:function(e){var t=e.closest(".ui-front, dialog");return t.length||(t=this.document[0].body),t},_destroy:function(){var t=this;e.each(this.tooltips,function(i,n){var r=e.Event("blur"),o=n.element;r.target=r.currentTarget=o[0],t.close(r,!0),e("#"+i).remove(),o.data("ui-tooltip-title")&&(o.attr("title")||o.attr("title",o.data("ui-tooltip-title")),o.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}}),!1!==e.uiBackCompat&&e.widget("ui.tooltip",e.ui.tooltip,{options:{tooltipClass:null},_tooltip:function(){var e=this._superApply(arguments);return this.options.tooltipClass&&e.tooltip.addClass(this.options.tooltipClass),e}})});